# ä»é›¶åˆ°ä¸€ï¼šå¦‚ä½•æ„å»ºä¸€ä¸ªåŸºäºçŸ¥è¯†å›¾è°±çš„æ™ºèƒ½é—®ç­”åŠ©æ‰‹ï¼Ÿ


> å¦‚ä½•åˆ©ç”¨å›¾æ•°æ®åº“ä»0-1æ„å»ºä¸€ä¸ªç‰¹å®šé¢†åŸŸé—®ç­”åŠ©æ‰‹ï¼Ÿæœ¬æ–‡æ‰‹æŠŠæ‰‹å¸¦ä½ æ„å»ºä¸€ä¸ªç®€æ˜“ç‰ˆçš„ç¯®çƒé¢†åŸŸæ™ºèƒ½é—®ç­”æœºå™¨äººã€‚

<!--more-->

## å‰è¨€

ã€Œé—®ç­”æœºå™¨äººã€åœ¨æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­å¹¶ä¸å°‘è§åˆ° ï¼šæ¯”å¦‚åœ¨ä¸€äº›ç”µå•†å®¢æœã€æ™ºèƒ½é—®è¯Šã€æŠ€æœ¯æ”¯æŒç­‰äººå·¥è¾“å…¥ä¸æ²Ÿé€šç•Œé¢çš„åœºæ™¯ä¸‹ï¼Œæœºå™¨äººâ€œæ™ºèƒ½â€é—®ç­”ç³»ç»Ÿä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥åœ¨æ— éœ€äººåŠ›ã€ä¸éœ€è¦è€—è´¹ç»ˆç«¯ç”¨æˆ·å¿ƒæ™ºå»åšçŸ¥è¯†åº“ã€å•†å“æœç´¢ã€ç§‘å®¤é€‰æ‹©ç­‰ç­‰çš„æƒ…å†µä¸‹å®æ—¶ç»™å‡ºé—®é¢˜ç­”æ¡ˆã€‚

é—®ç­”æœºå™¨äººç³»ç»ŸèƒŒåçš„æŠ€æœ¯æœ‰å¤šé‡å¯èƒ½ï¼š

- åŸºäºæ£€ç´¢ï¼Œå…¨æ–‡æœç´¢æ¥è¿‘çš„é—®é¢˜
- åŸºäº[æœºå™¨å­¦ä¹ é˜…è¯»ç†è§£](https://arxiv.org/abs/1710.10723)
- åŸºäºçŸ¥è¯†å›¾è°±ï¼ˆKnowledge-Based Question Answering system: KBQAï¼‰
- å…¶ä»–

åŸºäºçŸ¥è¯†å›¾è°±æ„å»ºé—®ç­”ç³»ç»Ÿåœ¨ä»¥ä¸‹ä¸‰ä¸ªæƒ…å†µä¸‹å¾ˆæœ‰ä¼˜åŠ¿ï¼š
- å¯¹äºé¢†åŸŸç±»å‹æ˜¯ç»“æ„åŒ–æ•°æ®åœºæ™¯ï¼šç”µå•†ã€åŒ»è¯ã€ç³»ç»Ÿè¿ç»´ï¼ˆå¾®æœåŠ¡ã€æœåŠ¡å™¨ã€äº‹ä»¶ï¼‰ã€äº§å“æ”¯æŒç³»ç»Ÿç­‰ï¼Œå…¶ä¸­ä½œä¸ºé—®ç­”ç³»ç»Ÿçš„å‚è€ƒå¯¹è±¡å·²ç»æ˜¯ç»“æ„åŒ–æ•°æ®ï¼›
- é—®é¢˜çš„è§£ç­”è¿‡ç¨‹æ¶‰åŠå¤šè·³æŸ¥è¯¢ï¼Œæ¯”å¦‚â€œå§šæ˜çš„å¦»å­ä»Šå¹´æ˜¯æœ¬å‘½å¹´å—ï¼Ÿâ€ï¼Œâ€œä½ ä»¬å®¶çš„äº§å“ A å’Œ A+ çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿâ€ï¼›
- ä¸ºäº†è§£å†³å…¶ä»–éœ€æ±‚ï¼ˆé£æ§ã€æ¨èã€ç®¡ç†ï¼‰ï¼Œå·²ç»æ„å»ºäº†å›¾ç»“æ„æ•°æ®ã€çŸ¥è¯†å›¾è°±çš„æƒ…å†µã€‚

ä¸ºäº†æ–¹ä¾¿è¯»è€…æœ€å¿«é€Ÿäº†è§£å¦‚ä½•æ„å»º KBQA ç³»ç»Ÿï¼Œæˆ‘å†™äº†éå¸¸ç®€é™‹çš„å° KBQA é¡¹ç›®ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä¼šå¸¦é¢†å¤§å®¶ä»å¤´åˆ°å°¾æŠŠå®ƒæ­èµ·æ¥ã€‚

> ğŸ’¡ï¼šè¿™ä¸ªå°é¡¹ç›®å«åš Siwiï¼Œå®ƒçš„ä»£ç å°±åœ¨ GitHub ä¸Šï¼š[github.com/wey-gu/nebula-siwi](https://github.com/wey-gu/nebula-siwi/)
>
> Siwi çš„å‘éŸ³æ˜¯ï¼š`/ËˆsÉªwi/` æˆ–è€…å«ï¼š`æ€äºŒä¸º` ï¼Œå®ƒæ˜¯ä¸€ä¸ªèƒ½è§£ç­” NBA ç›¸å…³é—®é¢˜çš„æœºå™¨äººã€‚

æˆ‘ä»¬å¼€å§‹å§ã€‚

## é¸Ÿç° TL;DR

KBQA ç”¨ä¸€å¥è¯è¯´å°±æ˜¯æŠŠé—®é¢˜è§£æã€è½¬æ¢æˆåœ¨çŸ¥è¯†å›¾è°±ä¸­çš„æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å¾—åˆ°ç»“æœä¹‹åè¿›è¡Œç­›é€‰ã€ç¿»è¯‘æˆç»“æœï¼ˆå¥å­ã€å¡ç‰‡æˆ–è€…ä»»ä½•æ–¹ä¾¿äººç†è§£çš„ç­”æ¡ˆæ ¼å¼ï¼‰ã€‚

> ğŸ’¡ï¼šçŸ¥è¯†å›¾è°±çš„æ„å»ºå®é™…ä¸Šæ˜¯éå¸¸é‡è¦çš„è¿‡ç¨‹ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¸“æ³¨åœ¨ä¸²èµ·æ¥ KBQA ç³»ç»Ÿçš„éª¨æ¶ï¼Œæˆ‘ä»¬å‡è®¾éœ€æ±‚æ˜¯åŸºäºä¸€ä¸ªå·²ç»æœ‰çš„å›¾è°±ä¹‹ä¸Šï¼Œä¸ºå…¶å¢åŠ ä¸€ä¸ª QA ç³»ç»Ÿã€‚

ã€Œé—®é¢˜åˆ°å›¾è°±æŸ¥è¯¢çš„è½¬æ¢ã€æœ‰ä¸åŒçš„æ–¹æ³•å¯ä»¥å®ç°ã€‚
- å¯ä»¥æ˜¯å¯¹è¯­ä¹‰è¿›è¡Œåˆ†æï¼šç†è§£é—®é¢˜çš„æ„å›¾ï¼Œé’ˆå¯¹ä¸åŒæ„å›¾åŒ¹é…æœ€å¯èƒ½çš„é—®é¢˜ç±»å‹ï¼Œä»è€Œæ„å»ºè¿™ä¸ªç±»å‹é—®é¢˜çš„å›¾è°±æŸ¥è¯¢ï¼ŒæŸ¥å¾—ç»“æœï¼›
- ä¹Ÿå¯ä»¥æ˜¯åŸºäºä¿¡æ¯çš„æŠ½å–ï¼šä»é—®é¢˜ä¸­æŠ½å–ä¸»è¦çš„å®ä½“ï¼Œåœ¨å›¾è°±ä¸­è·å–å®ä½“çš„æ‰€æœ‰çŸ¥è¯†ã€å…³ç³»æ¡ç›®ï¼ˆå­å›¾ï¼‰ï¼Œå†å¯¹ç»“æœæ ¹æ®é—®é¢˜ä¸­çš„çº¦æŸæ¡ä»¶åŒ¹é…ã€æ’åºé€‰æ‹©ç»“æœã€‚

> ğŸ’¡ï¼šç¾å›¢æŠ€æœ¯å›¢é˜Ÿåœ¨[è¿™ç¯‡æ–‡ç« ](https://tech.meituan.com/2021/11/03/knowledge-based-question-answering-in-meituan.html)é‡Œåˆ†äº«äº†ä»–ä»¬çš„çœŸå®ä¸–ç•Œå®è·µï¼Œä¸‹å›¾æ˜¯ç¾å›¢ç»“åˆäº†æœºå™¨å­¦ä¹ å’Œ NLP çš„æ–¹æ¡ˆã€‚

![ç¾å›¢KBQAè§£å†³æ–¹æ¡ˆ](https://tva1.sinaimg.cn/large/008i3skNly1gw13r5dsw2j31g30u0430.jpg)

è€Œåœ¨ Siwi é‡Œï¼Œæˆ‘ä»¬ä¸€åˆ‡ä»ç®€ï¼Œå•ç‹¬é€‰æ‹©äº†è¯­ä¹‰åˆ†æè¿™æ¡è·¯ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯éœ€è¦äººä¸ºå»æ ‡æ³¨æˆ–è€…ç¼–ç ä¸€äº›é—®é¢˜ç±»å‹çš„æŸ¥è¯¢æ–¹å¼ï¼Œä½†å®é™…ä¸Šåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œå°¤å…¶å•ä¸€é¢†åŸŸå›¾è°±çš„åœºæ™¯ä¸‹åè€Œæ˜¯è½»é‡å´æ•ˆæœä¸å·®çš„æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¾¿äºæ–°æ‰‹ç†è§£ KBQA çš„åˆé€‚çš„å…¥é—¨æ–¹å¼ã€‚

é™¤äº†æ ¸å¿ƒçš„é—®ç­”éƒ¨åˆ†ï¼Œæˆ‘è¿˜ä¸º Siwi å¢åŠ äº†è¯­éŸ³è¯†åˆ«å’Œè¯­éŸ³å›ç­”ï¼ˆæ„Ÿè°¢æµè§ˆå™¨æ¥å£æ ‡å‡†çš„å‘å±•ï¼‰çš„åŠŸèƒ½ï¼Œäºæ˜¯ï¼Œè¿™ä¸ªé¡¹ç›®çš„ç»“æ„å’Œé—®ç­”è°ƒç”¨æµç¨‹å°±æ˜¯è¿™æ ·çš„äº†ï¼šä¸€ä¸ªè¯­éŸ³é—®é¢˜è‡ªä¸Šè€Œä¸‹åˆ†åˆ«ç»è¿‡ä¸‰ä¸ªéƒ¨åˆ†ï¼š

- åŸºäºç½‘é¡µçš„ Siwi Frontend è¯­éŸ³ã€æ–‡å­—é—®ç­”ç•Œé¢
- Python Flask å®ç°çš„ Siwi Backend/API ç³»ç»Ÿ
- [Nebula Graph](https://nebula-graph.com.cn) å¼€æºåˆ†å¸ƒå¼é«˜æ€§èƒ½å›¾æ•°æ®åº“ä¹‹ä¸Šçš„çŸ¥è¯†å›¾è°±


```asciiarmor
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                â”‚                                      â”‚
â”‚                â”‚  Speech                              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚     â”‚            Frontend â”‚   Siwi, /ËˆsÉªwi/           â”‚
â”‚     â”‚ Web_Speech_API      â”‚   A PoC of                â”‚
â”‚     â”‚                     â”‚   Dialog System           â”‚
â”‚     â”‚ Vue.JS              â”‚   With Graph Database     â”‚
â”‚     â”‚                     â”‚   Backed Knowledge Graph  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                â”‚  Sentence                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚            â”‚              Backend         â”‚       â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚       â”‚
â”‚   â”‚ â”‚ Web API, Flask      â”‚   ./app/          â”‚       â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚       â”‚
â”‚   â”‚            â”‚  Sentence    ./bot/          â”‚       â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚       â”‚
â”‚   â”‚ â”‚ Intent matching,    â”‚   ./bot/classifierâ”‚       â”‚
â”‚   â”‚ â”‚ Symentic Processing â”‚                   â”‚       â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚       â”‚
â”‚   â”‚            â”‚  Intent, Entities            â”‚       â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚       â”‚
â”‚   â”‚ â”‚ Intent Actor        â”‚   ./bot/actions   â”‚       â”‚
â”‚   â””â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                â”‚  Graph Query                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚     â”‚ Graph Database      â”‚    Nebula Graph           â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ’¡ï¼šå›¾æ•°æ®åº“ç›¸æ¯”äºå…¶ä»–çŸ¥è¯†å›¾è°±å­˜å‚¨ç³»ç»Ÿæ¥è¯´ï¼Œå› ä¸ºå…¶è®¾è®¡ä¸“æ³¨äºæ•°æ®å†…çš„æ•°æ®å…³ç³»ï¼Œéå¸¸æ“…é•¿å®æ—¶è·å–æµ·é‡æ•°æ®ä¸‹å®ä½“ä¹‹é—´çš„å¤æ‚å…³è”å…³ç³»ã€‚
>
> Nebula Graph çš„åŸç”Ÿåˆ†å¸ƒå¼è®¾è®¡å’Œ share-nothing æ¶æ„ä½¿å¾—å®ƒæ“…é•¿äºå·¨å¤§æ•°æ®é‡å’Œé«˜å¹¶å‘è¯»å†™çš„åœºæ™¯ï¼ŒåŠ ä¸Šå®ƒçš„å¼€æºç¤¾åŒºç‰¹åˆ«æ´»è·ƒï¼Œå·²ç»è¢«å›½å†…å¾ˆå¤šå›¢é˜Ÿç”¨äºæ”¯æ’‘ç”Ÿäº§ä¸Šçš„å„ç§ä¸šåŠ¡ï¼Œ[è¿™é‡Œ](https://nebula-graph.com.cn/cases/)æœ‰ä¸€äº›ä»–ä»¬åˆ†äº«çš„é€‰å‹ã€è½åœ°å®è·µã€‚

## çŸ¥è¯†å›¾è°±

Siwi æ„å»ºäºä¸€ä¸ªç¯®çƒç›¸å…³çš„çŸ¥è¯†å›¾è°±ä¹‹ä¸Šï¼Œå®ƒå…¶å®æ˜¯ Siwi é‡‡ç”¨çš„å¼€æºåˆ†å¸ƒå¼å›¾æ•°æ®åº“ [Nebula Graph](http://nebula-graph.com.cn/) ç¤¾åŒºçš„å®˜æ–¹æ–‡æ¡£é‡Œçš„ç¤ºä¾‹[æ•°æ®é›†](https://docs.nebula-graph.com.cn/master/3.ngql-guide/1.nGQL-overview/1.overview/#basketballplayer)ã€‚

åœ¨è¿™ä¸ªéå¸¸ç®€å•çš„å›¾è°±ä¹‹ä¸­ï¼Œåªæœ‰ä¸¤ç§ç‚¹ï¼š

- playerï¼Œçƒå‘˜
- teamï¼Œçƒé˜Ÿ

ä¸¤ç§å…³ç³»ï¼š

- serve æœå½¹äºï¼ˆæ¯”å¦‚ï¼šå§šæ˜ `-æœå½¹äº->` ä¼‘æ–¯é¡¿ç«ç®­ï¼‰
- follow å…³æ³¨ ï¼ˆæ¯”å¦‚ï¼šå§šæ˜ `-å…³æ³¨->` å¥¥å°¼å°”ï¼‰

> ğŸ’¡ï¼šè¿™ä¸ªæ•°æ®é›†åœ¨ Nebula ç¤¾åŒºä¸Šæœ‰ä¸€ä¸ª [åœ¨çº¿ä½“éªŒ](https://nebula-graph.com.cn/demo/) ç¯å¢ƒï¼Œä»»ä½•äººéƒ½æ— éœ€ç™»å½•ï¼Œé€šè¿‡[Nebula Graph Studio](https://docs.nebula-graph.com.cn/2.6.1/nebula-studio/about-studio/st-ug-what-is-graph-studio/) å¯è§†åŒ–æ¢ç´¢ç¯®çƒå›¾è°±ã€‚

ä¸‹å›¾å°±æ˜¯è¿™ä¸ªå›¾è°±çš„å¯è§†åŒ–æ¢ç´¢æˆªå›¾ï¼Œå¯ä»¥çœ‹åˆ°å·¦è¾¹çš„ä¸­å¿ƒèŠ‚ç‚¹å‹‡å£«é˜Ÿï¼ˆWarriorsï¼‰æœ‰æœå…°ç‰¹ï¼ˆDurantï¼‰è¿˜æœ‰å…¶ä»–å‡ ä¸ªé˜Ÿå‘˜åœ¨å…¶ä¸­æœå½¹ï¼ˆserveï¼‰ï¼›é™¤äº†æœå½¹ä¹‹å¤–ï¼Œè¿˜å¯ä»¥çœ‹åˆ°é˜Ÿå‘˜å’Œé˜Ÿå‘˜ä¹‹ä¸­ä¹Ÿæœ‰å…³æ³¨ï¼ˆfollowï¼‰çš„å…³ç³»å­˜åœ¨ã€‚

![ç¯®çƒå›¾è°±](https://nebula-website-cn.oss-cn-hangzhou.aliyuncs.com/nebula-website/images/demo/demo1.png)

æœ‰äº†è¿™ä¸ªçŸ¥è¯†å›¾è°±ï¼Œå’±ä»¬æ¥ä¸‹æ¥å°±åœ¨å®ƒä¹‹ä¸Šæ­ä¸€ä¸ªç®€å•çš„åŸºäºè¯­æ³•è§£æçš„ QA ç³»ç»Ÿå§ğŸ˜ã€‚

## Siwi-backend

```asciiarmor
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            â”‚              Backend         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚ â”‚ Web API, Flask      â”‚   ./app/          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚            â”‚  Sentence    ./bot/          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚ â”‚ Intent matching,    â”‚   ./bot/classifierâ”‚
â”‚ â”‚ Symentic Processing â”‚                   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚            â”‚  Intent, Entities            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚ â”‚ Intent Actor        â”‚   ./bot/actions   â”‚
â””â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚  Graph Query
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Graph Database      â”‚    Nebula Graph
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å¦‚ä¸Šå›¾çš„è®¾è®¡æµç¨‹ï¼ŒSiwi çš„åç«¯éƒ¨åˆ†éœ€è¦æ¥æ”¶é—®å¥ï¼Œå¤„ç†ä¹‹åè®¿é—®çŸ¥è¯†å›¾è°±ï¼ˆå›¾æ•°æ®åº“ï¼‰ï¼Œç„¶åå°†å¤„ç†ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚

### æ¥æ”¶ HTTP è¯·æ±‚(app)

å¯¹äºè¯·æ±‚ï¼Œå°±ç®€å•åœ°ç”¨ Flask ä½œä¸º web server æ¥æ¥æ”¶ HTTP çš„ POST è¯·æ±‚ï¼š

> ğŸ’¡ï¼šè¿˜ä¸ç†Ÿæ‚‰ Flask çš„åŒå­¦ï¼Œå¯ä»¥åœ¨ [freeCodeCamp ä¸Šæœç´¢ä¸€ä¸‹](https://www.freecodecamp.org/news/tag/flask/)ï¼Œæœ‰ä¸€äº›ä¸é”™çš„è¯¾ç¨‹å“ˆã€‚

ä¸‹è¾¹çš„ä»£ç å°±æ˜¯å‘Šè¯‰ Flask ï¼š

1. å¦‚æœç”¨æˆ·å‘è¿‡æ¥ `http://<server>/query` çš„ POST è¯·æ±‚ï¼Œæçš„é—®é¢˜å°±åœ¨è¯·æ±‚çš„ body é‡Œçš„ `question` çš„ Key ä¹‹ä¸‹ã€‚
2. å–å¾—é—®é¢˜ä¹‹åï¼Œè°ƒç”¨æŠŠè¯·æ±‚ä¼ ç»™  `siwi_bot` çš„ `query()`ï¼Œå¾—åˆ° `answer` ã€‚ 

ä»£ç æ®µï¼š`src/siwi/app/__init__.py`

```python
#...
from siwi.bot import bot

#...
@app.route("/query", methods=["POST"])
def query():
    request_data = request.get_json()
    question = request_data.get("question", "") # <----- 1.
    if question:
        answer = siwi_bot.query(
            request_data.get("question", ""))   # <----- 2.
    else:
        answer = "Sorry, what did you say?"
    return jsonify({"answer": answer})
```

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç° `siwi_bot`ï¼ŒçœŸæ­£å¤„ç†æé—®çš„é€»è¾‘ã€‚

### å¤„ç†è¯·æ±‚(bot)

```asciiarmor
â”‚            â”‚  Sentence    ./bot/          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚ â”‚ Intent matching,    â”‚   ./bot/classifierâ”‚
â”‚ â”‚ Symentic Processing â”‚                   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚            â”‚  Intent, Entities            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚ â”‚ Intent Actor        â”‚   ./bot/actions   â”‚
â””â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å‰è¾¹æåˆ°è¿‡ï¼ŒKBQA åŸºæœ¬ä¸Šæ˜¯

a. æŠŠé—®é¢˜è§£æã€è½¬æ¢æˆåœ¨çŸ¥è¯†å›¾è°±ä¸­çš„æŸ¥è¯¢

b. æŸ¥è¯¢å¾—åˆ°ç»“æœä¹‹åè¿›è¡Œç­›é€‰ã€ç¿»è¯‘æˆç»“æœ

è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠ a. çš„é€»è¾‘æ”¾åœ¨ `classifier` é‡Œï¼Œb. çš„é€»è¾‘æ”¾åœ¨ `actions`(actor) é‡Œã€‚

a. HTTP è¯·æ±‚çš„é—®é¢˜å¥å­ `sentence` ä¼ è¿‡æ¥ï¼Œç”¨ `classifier` è§£æå®ƒçš„æ„å›¾å’Œå¥å­å®ä½“

b. ç”¨æ„å›¾å’Œå¥å­å®ä½“æ„é€  `action`ï¼Œå¹¶é“¾æ¥å›¾æ•°æ®åº“æ‰§è¡Œï¼Œè·å–ç»“æœã€‚

ä»£ç æ®µï¼š`src/siwi/bot/bot/__init__.py`

```python
from siwi.bot.actions import SiwiActions
from siwi.bot.classifier import SiwiClassifier


class SiwiBot():
    def __init__(self, connection_pool) -> None:
        self.classifier = SiwiClassifier()
        self.actions = SiwiActions()
        self.connection_pool = connection_pool

    def query(self, sentence):
        intent = self.classifier.get(sentence) # <--- a.
        action = self.actions.get(intent)      # <--- b.
        return action.execute(self.connection_pool)
```

é¦–å…ˆå’±ä»¬æ¥è¿›ä¸€æ­¥å®ç°ä¸€ä¸‹ `SiwiClassifier` å§ã€‚

#### è¯­ä¹‰è§£æ(classifier)

`classifier ` éœ€è¦åœ¨ `get(sentence)` æ–¹æ³•é‡Œå°†å¥å­ä¸­çš„å®ä½“å’Œå¥å­çš„æ„å›¾è§£æã€åˆ†ç±»å‡ºæ¥ã€‚é€šå¸¸æ¥è¯´ï¼Œè¿™é‡Œæ˜¯éœ€è¦å€ŸåŠ©æœºå™¨å­¦ä¹ ã€NLPå»åˆ†è¯ã€åˆ†ç±»å®ç°çš„ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†å±•ç¤ºè¿™ä¸ªè¿‡ç¨‹å®é™…ä¸Šåªæ˜¯å„ç§ `if/ else`ã€‚

æˆ‘ä»¬è¿™é‡Œå®ç°äº†ä¸‰ç±»æ„å›¾çš„é—®é¢˜ï¼š

- å…³ç³»ï¼ˆAï¼ŒBï¼‰ï¼šè·å¾— A å’Œ B åœ¨å›¾è°±ä¸­çš„å…³ç³»è·¯å¾„ï¼Œæ¯”å¦‚å§šæ˜å’Œæ¹–äººé˜Ÿçš„å…³ç³»æ˜¯ï¼Ÿ
- æœå½¹æƒ…å†µï¼šæ¯”å¦‚ä¹”çº³æ£®åœ¨å“ªé‡Œæœå½¹ï¼Ÿ
- å…³æ³¨æƒ…å†µï¼šæ¯”å¦‚é‚“è‚¯å…³æ³¨äº†è°ï¼Ÿ

> â“ å¼€æ”¾é—®é¢˜ï¼š
>
> å¦‚æœçœ‹æ•™ç¨‹çš„ä½ è§‰å¾—è¿™å‡ ä¸ªé—®é¢˜å¤ªæ²¡æ„æ€äº†ï¼Œè¿™é‡Œç•™ä¸€ä¸ªå¼€æ”¾é—®é¢˜ï¼Œä½ å¯ä»¥åœ¨ Siwi é‡Œå¸®æˆ‘ä»¬å®ç°ï¼šã€Œå…±åŒå¥½å‹ï¼ˆAï¼ŒBï¼‰è·å¾— A å’Œ B çš„ä¸€åº¦å…±åŒå¥½å‹ã€è¿™ä¸ªæ„å›¾ï¼ˆæˆ–è€…æ›´é…·çš„å…¶ä»–å¥å­ï¼‰ä¹ˆï¼Ÿæ¬¢è¿æ¥ Githubï¼šgithub.com/wey-gu/nebula-siwi/ æ PR å“¦ï¼Œçœ‹çœ‹è°å…ˆå®ç°ã€‚

ä»£ç ç‰‡æ®µï¼š`src/siwi/bot/classfier/__init__.py`

```python
class SiwiClassifier():
    def get(self, sentence: str) -> dict:
        """
        Classify Sentences and Fill Slots.
        This should be done by NLP, here we fake one to demostrate
        the intent Actor --> Graph DB work flow.

        sentense:
          relation:
            - What is the relationship between Yao Ming and Lakers?
            - How does Tracy McGrady and Lakers connected?
          serving:
            - Which team had Jonathon Simmons served?
          friendship:
            - Whom does Tim Duncan follow?
            - Who are Tracy McGrady's friends?

        returns:
        {
            "entities": entities,
            "intents": intents
        }
        """
        entities = self.get_matched_entities(sentence)
        intents = self.get_matched_intents(sentence)
        return {
            "entities": entities,
            "intents": intents
        }
```

è¿™é‡Œï¼Œæˆ‘æŠŠåŒ¹é…çš„è§„åˆ™ï¼ˆç­‰ä»·äº if else...ï¼‰å†™åœ¨äº† `src/siwi/bot/test/data` ä¹‹ä¸‹çš„ YAML æ–‡ä»¶é‡Œï¼Œè¿™æ ·å¢åŠ  `classifier` ä¹‹ä¸­æ–°çš„è§„åˆ™åªéœ€è¦æ›´æ–°è¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥äº†ï¼š

##### æ„å›¾è¯†åˆ«(intent)

```python
def load_entity_data(self) -> None:
    # load data from yaml files
    module_path = f"{ siwi.__path__[0] }/bot/test/data"
    #...
    with open(f"{ module_path }/intents.yaml", "r") as file:
        self.intents = yaml.safe_load(file)["intents"]
```

å¯¹äºæ¯ä¸€ä¸ªæ„å›¾æ¥è¯´ï¼š

- `intents.<åå­—>` ä»£è¡¨åå­—
- åå­—ä¹‹åçš„ `action` ä»£è¡¨åè¾¹åœ¨è¦å®ç°çš„ç›¸åº”çš„ `xxxAction` çš„ç±»
  - æ¯”å¦‚ `RelationshipAction` å°†æ˜¯ç”¨æ¥å¤„ç†æŸ¥è¯¢å…³ç³»ï¼ˆAï¼ŒBï¼‰è¿™æ ·çš„é—®é¢˜çš„ Action ç±»
- `keywords` ä»£è¡¨åœ¨å¥å­ä¹‹ä¸­åŒ¹é…çš„å…³é”®è¯
  - æ¯”å¦‚é—®å¥é‡Œå‡ºç° serveï¼Œservedï¼Œserving çš„å­—çœ¼çš„æ—¶å€™ï¼Œå°†ä¼šåŒ¹é…æœå½¹çš„é—®é¢˜

> ğŸ’¡ï¼šå†™ if else æ¡ä»¶æ¥å¯¹åº”æ„å›¾æ˜¯ä¸å®¹æ˜“çš„ï¼Œå› ä¸ºä¸åŒæ„å›¾ä¸å¯èƒ½æ²¡æœ‰å…³é”®è¯ç›¸äº¤çš„æƒ…å†µï¼Œæˆ‘ä»¬çš„å®ç°åªæ˜¯ä¸€ä¸ªéå¸¸ç®€é™‹ã€ä¸ä¸¥è°¨çš„æ–¹å¼ã€‚åœ¨å®é™…åœºæ™¯ä¸‹ï¼Œè®­ç»ƒæ¨¡å‹å»åšåŒ¹é…æ•ˆæœä¼šæ›´å¥½ï¼Œæœ‰æ„æ€çš„æ˜¯ï¼Œé‚£äº›åšçš„æ¯”è¾ƒå¥½çš„æ¨¡å‹çš„è¾“å…¥å’Œæˆ‘ä»¬çš„ YAML çš„æ ¼å¼æ˜¯å¾ˆç±»ä¼¼çš„ã€‚

```yaml
---
intents:
  fallback:
    action:
      FallbackAction
    keywords: []
  relationship:
    action:
      RelationshipAction
    keywords:
      - between
      - relation
      - relationship
      - related
      - connect
      - correlate
  serve:
    action:
      ServeAction
    keywords:
      - serve
      - served
      - serving
  friend:
    action:
      FollowAction
    keywords:
      - follows
      - followed
      - follow
      - friend
      - friends
```

##### å®ä½“è¯†åˆ«(entity)

ç±»ä¼¼çš„ï¼Œå®ä½“è¯†åˆ«çš„éƒ¨åˆ†æœ¬è´¨ä¸Šä¹Ÿæ˜¯ if elseï¼Œåªä¸è¿‡è¿™é‡Œåˆ©ç”¨åˆ°äº†**[Ahoâ€“Corasickç®—æ³•](https://zh.wikipedia.org/wiki/AC%E8%87%AA%E5%8A%A8%E6%9C%BA%E7%AE%97%E6%B3%95)**æ¥å¸®åŠ©æœç´¢å®ä½“ï¼Œåœ¨ç”Ÿäº§ï¼ˆéç©å…·ï¼‰çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥ç”¨ NLP é‡Œçš„åˆ†è¯çš„æ–¹æ³•æ¥åšã€‚

> ğŸ’¡ï¼šå¤§å®¶å¯ä»¥å»äº†è§£ä¸€ä¸‹è¿™ä¸ª [ACè‡ªåŠ¨æœºç®—æ³•](https://zh.wikipedia.org/wiki/AC%E8%87%AA%E5%8A%A8%E6%9C%BA%E7%AE%97%E6%B3%95)

```python
def setup_entity_tree(self) -> None:
    self.entity_type_map.update({
        key: "player" for key in self.players.keys()
        })
    self.entity_type_map.update({
        key: "team" for key in self.teams.keys()
        })

    self.entity_tree = ahocorasick.Automaton()
    for index, entity in enumerate(self.entity_type_map.keys()):
        self.entity_tree.add_word(entity, (index, entity))
    self.entity_tree.make_automaton()

#...

def get_matched_entities(self, sentence: str) -> dict:
    """
    Consume a sentence to be matched with ahocorasick
    Returns a dict: {entity: entity_type}
    """
    _matched = []
    for item in self.entity_tree.iter(sentence):
        entities_matched.append(item[1][1])
    return {
        entity: self.entity_type_map[entity] for entity in _matched
    }
```

è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ `SiwiClassifier.get(sentence)` å·²ç»èƒ½è¿”å›è§£æã€åˆ†ç±»å‡ºæ¥çš„æ„å›¾å’Œå®ä½“äº†ï¼Œè¿™æ—¶å€™ï¼Œå®ƒä»¬ä¼šè¢«ä¼ ç»™ Actions æ¥è®© siwi bot çŸ¥é“å¦‚ä½•å»æ‰§è¡ŒçŸ¥è¯†å›¾è°±çš„æŸ¥è¯¢å•¦ï¼

#### æ„é€ å›¾è°±æŸ¥è¯¢(action)

è¿˜è®°å¾—å‰è¾¹çš„ bot ä»£ç é‡Œï¼Œæœ€åä¸€æ­¥ï¼Œå›¾è°±æŸ¥è¯¢çš„åŠ¨ä½œæ˜¯è¿™ä¹ˆè¢«æ„é€ çš„ï¼š

 `action = self.actions.get(intent)`

ç°åœ¨å’±ä»¬å°±æŠŠå®ƒå®ç°ä¸€ä¸‹ï¼š

1. åœ¨å‰è¾¹æåˆ°è¿‡çš„ `intents.yaml` é‡Œè·å–è¿™ä¸ªæ„å›¾é‡Œé…ç½®çš„æ„å›¾çš„ç±»åç§°

2. å¯¼å…¥ç›¸åº”çš„ Action ç±»

ä»£ç æ®µï¼š`src/bot/actions/__init__.py`

```python
class SiwiActions():
    def __init__(self) -> None:
        self.intent_map = {}
        self.load_data()

    def load_data(self) -> None:
        # load data from yaml files
        module_path = f"{ siwi.__path__[0] }/bot/test/data"

        with open(f"{ module_path }/intents.yaml", "r") as file:
            self.intent_map = yaml.safe_load(file)["intents"]

    def get(self, intent: dict):
        """
        returns SiwiActionBase
        """
        if len(intent["intents"]) > 0:
            intent_name = intent["intents"][0]
        else:
            intent_name = "fallback"

        cls_name = self.intent_map.get(
            intent_name).get("action") #-------> 1.
        action_cls = getattr(          #-------> 2.
            importlib.import_module("siwi.bot.actions"), cls_name)
        action = action_cls(intent)
        return action
```

æœ€åï¼Œæˆ‘ä»¬æ¥å®ç°å…¶ä¸­ä¸€ä¸ª`Action` ç±»ï¼Œæ¯”å¦‚ `RelationshipAction` å¯¹åº”çš„ä»£ç å¦‚ä¸‹ï¼š

1. æ ¹æ®æä¾›çš„ A å’Œ Bï¼Œæ„é€ å¹¶æ‰§è¡Œå›¾æ•°æ®åº“ä¹‹ä¸­çš„ `FIND PATH`
2. å°† `FIND PATH` çš„ç»“æœè¿›è¡Œè§£æï¼Œé€šè¿‡ `as_path()` æ–¹æ³•çš„å°è£…ï¼Œè·å¾— path ç±»å‹çš„æ•°æ®ï¼Œå¹¶å¤„ç†ä¸€ä¸ªå¥å­è¿”å›ç»™ç”¨æˆ·

> ğŸ’¡ï¼šFIND PATH å°±æ˜¯å­—é¢æ„æ€çš„æŸ¥æ‰¾è·¯å¾„ï¼Œ[è¿™é‡Œ](https://docs.nebula-graph.com.cn/2.6.1/3.ngql-guide/16.subgraph-and-path/2.find-path/)æœ‰è¯¦ç»†çš„è§£é‡Šå“¦ã€‚

```python
class RelationshipAction(SiwiActionBase):
    """
    USE basketballplayer;
    FIND NOLOOP PATH
    FROM "player100" TO "team204" OVER * BIDIRECT UPTO 4 STEPS;
    """
    def __init__(self, intent):
        print(f"[DEBUG] RelationshipAction intent: { intent }")
        super().__init__(intent)
        try:
            self.entity_left, self.entity_right = intent["entities"]
            self.left_vid = self._vid(self.entity_left)
            self.right_vid = self._vid(self.entity_right)
        except Exception:
            print(
                f"[WARN] RelationshipAction entities recognition Failure "
                f"will fallback to FallbackAction, "
                f"intent: { intent }"
                )
            self.error = True

    def execute(self, connection_pool) -> str:
        self._error_check()
        query = (
            f'USE basketballplayer;'
            f'FIND NOLOOP PATH '
            f'FROM "{self.left_vid}" TO "{self.right_vid}" '
            f'OVER * BIDIRECT UPTO 4 STEPS;'
            )
        print(
            f"[DEBUG] query for RelationshipAction :\n\t{ query }"
            )
        with connection_pool.session_context("root", "nebula") as session:
            result = session.execute(query)        #--------------------> 1.

        if not result.is_succeeded():
            return (
                f"Something is wrong on Graph Database connection when query "
                f"{ query }"
                )

        if result.is_empty():
            return (
                f"There is no relationship between "
                f"{ self.entity_left } and { self.entity_right }"
                )
        path = result.row_values(0)[0].as_path()    #-------------------> 2.
        relationships = path.relationships()
        relations_str = self._name(
            relationships[0].start_vertex_id().as_string())
        for rel_index in range(path.length()):
            rel = relationships[rel_index]
            relations_str += (
                f" { rel.edge_name() }s "
                f"{ self._name(rel.end_vertex_id().as_string()) }")
        return (
            f"There are at least { result.row_size() } relations between "
            f"{ self.entity_left } and { self.entity_right }, "
            f"one relation path is: { relations_str }."
            )

```

è‡³æ­¤ï¼Œå’±ä»¬å°±å·²ç»å®ç°äº†åç«¯çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå¯åŠ¨èµ·æ¥è¯•è¯•äº†ï¼

### æµ‹è¯•ä¸€ä¸‹

#### å¯åŠ¨å›¾æ•°æ®åº“

æˆ‘ä»¬åœ¨ Nebula Graph é‡Œå»ºç«‹ï¼ˆå¯¼å…¥æ•°æ®ï¼‰ä¸€ä¸ªç¯®çƒçš„çŸ¥è¯†å›¾è°±ã€‚

> ğŸ’¡ï¼šåœ¨å¯¼å…¥æ•°æ®ä¹‹å‰ï¼Œè¯·å…ˆéƒ¨ç½²ä¸€ä¸ª Nebula Graph é›†ç¾¤ã€‚æœ€ç®€ä¾¿çš„éƒ¨ç½²æ–¹å¼æ˜¯ä½¿ç”¨ Nebula-UP è¿™ä¸ªå°å·¥å…·ï¼Œåªéœ€è¦ä¸€è¡Œå‘½ä»¤å°±èƒ½åœ¨ Linux æœºå™¨ä¸ŠåŒæ—¶å¯åŠ¨ä¸€ä¸ª Nebula Graph æ ¸å¿ƒå’Œå¯è§†åŒ–å›¾æ¢ç´¢å·¥å…· [Nebula Graph Studio](https://docs.nebula-graph.com.cn/2.6.1/nebula-studio/about-studio/st-ug-what-is-graph-studio/)ã€‚å¦‚æœä½ æ›´æ„¿æ„ç”¨ Docker éƒ¨ç½²ï¼Œè¯·å‚è€ƒ[è¿™ä¸ªæ–‡æ¡£](https://docs.nebula-graph.com.cn/2.6.1/4.deployment-and-installation/2.compile-and-install-nebula-graph/3.deploy-nebula-graph-with-docker-compose/)ã€‚

æœ¬æ–‡å‡è®¾æˆ‘ä»¬ä½¿ç”¨ [Nebula-UP](https://siwei.io/nebula-up/) æ¥éƒ¨ç½²ä¸€ä¸ª Nebula Graphï¼š

```bash
curl -fsSL nebula-up.siwei.io/install.sh | bash
```

ä¹‹åï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¿™æ ·çš„æç¤ºï¼š

![https://github.com/wey-gu/nebula-up/raw/main/images/nebula-up-demo-shell.png](https://github.com/wey-gu/nebula-up/raw/main/images/nebula-up-demo-shell.png)

æŒ‰ç…§æç¤ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå‘½ä»¤è¿›å…¥åˆ°æœ‰ Nebula Console çš„å®¹å™¨é‡Œï¼š

> ğŸ’¡ï¼š[Nebula Console](https://github.com/vesoft-inc/nebula-console) æ˜¯å‘½ä»¤è¡Œè®¿é—® Nebula Graph å›¾æ•°æ®åº“çš„å®¢æˆ·ç«¯ï¼Œæ”¯æŒ Linuxï¼ŒWindows å’Œ macOSï¼Œä¸‹è½½åœ°å€ï¼š[è¿™é‡Œ](https://github.com/vesoft-inc/nebula-console/releases)

```bash
~/.nebula-up/console.sh
```

ç„¶åï¼Œåœ¨ `#` çš„æç¤ºç¬¦ä¸‹å°±è¡¨ç¤ºæˆ‘ä»¬è¿›æ¥äº†ï¼Œæˆ‘ä»¬åœ¨é‡Œè¾¹å¯ä»¥æ‰§è¡Œï¼š

```
nebula-console -addr graphd -port 9669 -user root -p nebula
```

è¿™æ ·å°±è¡¨ç¤ºæˆ‘ä»¬è¿æ¥ä¸Šäº† Nebula Graph å›¾æ•°æ®åº“ï¼š

```mysql
/ # nebula-console -addr graphd -port 9669 -user root -p nebula
Welcome to Nebula Graph!

(root@nebula) [(none)]>
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ nGQL å»æ“ä½œ Nebula Graphï¼Œä¸è¿‡æˆ‘ä»¬å…ˆé€€å‡ºæ¥ï¼Œæ‰§è¡Œ `exit`ï¼š

```mysql
(root@nebula) [(none)]> exit

Bye root!
Fri, 31 Dec 2021 04:11:28 UTC
```

æˆ‘ä»¬åœ¨è¿™ä¸ªå®¹å™¨å†…æŠŠåŸºäº nGQL è¯­å¥çš„æ•°æ®ä¸‹è½½ä¸‹æ¥ï¼š

```bash
/ # wget https://docs.nebula-graph.io/2.0/basketballplayer-2.X.ngql
```

ç„¶åé€šè¿‡ Nebula Console çš„ `-f <file_path>` æŠŠæ•°æ®å¯¼å…¥è¿›å»ï¼š

```bash
nebula-console -addr graphd -port 9669 -user root -p nebula -f basketballplayer-2.X.ngql
```

è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¯åŠ¨äº†ä¸€ä¸ª Nebula Graph å›¾æ•°æ®åº“ï¼Œè¿˜åœ¨é‡Œè¾¹åŠ è½½äº†ç¯®çƒçš„çŸ¥è¯†å›¾è°±ï¼

> ğŸ’¡ï¼šè¿˜è®°å¾—å‰è¾¹æˆ‘ä»¬æåˆ°çš„ [åœ¨çº¿ä½“éªŒ](https://nebula-graph.com.cn/demo/) ç¯å¢ƒä¹ˆï¼Ÿç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªåˆ©ç”¨ Nebula-UP éƒ¨ç½²äº† Nebula çš„ç¯å¢ƒé‡Œå¯åŠ¨è‡ªå·±çš„ Nebula Studio å•¦ï¼ŒæŒ‰ç…§ä¸Šè¾¹ Nebula-UP çš„æç¤ºï¼šhttp://<æœ¬æœºIP>:7001 å°±æ˜¯å®ƒçš„åœ°å€ï¼Œç„¶åå¤§å®¶å¯ä»¥å‚è€ƒ[æ–‡æ¡£](https://docs.nebula-graph.com.cn/2.6.1/nebula-studio/deploy-connect/st-ug-connect/)å’Œ[åœ¨çº¿ä½“éªŒä»‹ç»](https://www.bilibili.com/video/BV1hq4y1177e)å»äº†è§£æ›´å¤šã€‚
>
> ![studio](https://nebula-website-cn.oss-cn-hangzhou.aliyuncs.com/nebula-website/images/demo/demo1.png)

#### å¯åŠ¨ Siwi-backend

å¤§å®¶å¯ä»¥ç›´æ¥ clone æˆ‘çš„ä»£ç ï¼š`git clone https://github.com/wey-gu/nebula-siwi/`

ç„¶åå®‰è£…ã€å¯åŠ¨ Siwi Backendï¼š

```bash
cd nebula-siwi

# Install dependencies
python3 -m pip install -r src/requirements.txt

# Install siwi backend
python3 -m build

# Configure Nebula Graph Endpoint
export NG_ENDPOINTS=127.0.0.1:9669

# Run Backend API server
gunicorn --bind :5000 wsgi --workers 1 --threads 1 --timeout 60
```

å¯åŠ¨ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¦å¤–å¼€çª—å£ï¼Œé€šè¿‡ cURL å»å‘èµ·é—®é¢˜ç»™ backendï¼Œæ›´å¤šç»†èŠ‚å¤§å®¶å¯ä»¥å‚è€ƒ GitHub ä¸Šçš„ READMEï¼š

[![backend-demo](https://github.com/wey-gu/nebula-siwi/raw/main/images/backend-demo.webp)](https://github.com/wey-gu/nebula-siwi/blob/main/images/backend-demo.webp)

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å†™å¥½äº† QA ç³»ç»Ÿçš„é‡è¦çš„ä»£ç å•¦ï¼Œå¤§å®¶æ˜¯ä¸æ˜¯å¯¹ä¸€ä¸ª KBQA çš„æ„æˆæœ‰äº†æ›´æ¸…æ™°çš„æ¦‚å¿µäº†å‘¢ï¼Ÿ

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºå®ƒå¢åŠ ä¸€ä¸ªç•Œé¢ï¼

## Siwi-frontend

### èŠå¤©ç•Œé¢

æˆ‘ä»¬åˆ©ç”¨ [Vue Bot UI](https://github.com/juzser/vue-bot-ui) è¿™ä¸ªå¯çˆ±çš„æœºå™¨äººç•Œé¢çš„ Vue å®ç°å¯ä»¥å¾ˆå®¹æ˜“æ„é€ ä¸€ä¸ª

ä»£ç æ®µï¼š`src/siwi/frontend/src/App.vue`

```vue
<template>
  <div id="app">
    <VueBotUI
      :messages="msg"
      :options="botOptions"
      :bot-typing="locking"
      :input-disable="locking"
      @msg-send="msgSender"
    />
  </div>
</template>
<script>
import { VueBotUI } from 'vue-bot-ui'
```

[![demo](https://github.com/wey-gu/nebula-siwi/raw/main/src/siwi_frontend/images/demo.webp)](https://github.com/wey-gu/nebula-siwi/blob/main/src/siwi_frontend/images/demo.webp)

æ³¨æ„åˆ°é‚£ä¸ªå°é£æœºæŒ‰é’®äº†å§ï¼Œå®ƒæ˜¯å‘å‡ºé—®é¢˜è¯·æ±‚çš„æŒ‰é”®ï¼Œæˆ‘ä»¬è¦åœ¨æŒ‰ä¸‹å®ƒçš„æ—¶å€™å¯¹åç«¯åšå‡ºè¯·æ±‚ã€‚

### è®¿é—®åç«¯

è¿™éƒ¨åˆ†ç”¨åˆ°äº†[Axios](https://github.com/axios/axios)ï¼Œå®ƒæ˜¯æµè§ˆå™¨é‡Œè®¿é—®å…¶ä»–åœ°å€çš„ HTTP å®¢æˆ·ç«¯ã€‚

1. åœ¨æŒ‰ä¸‹çš„æ—¶å€™ï¼Œ`@msg-send="msgSender"` ä¼šè§¦å‘ `msgSender()` 
2. ` msgSender()`å»æ„é€ `axios.post(this.apiEndpoint, { "question": data.text })` çš„è¯·æ±‚ç»™ Siwi çš„åç«¯
3. åç«¯çš„ç»“æœè¢« `push()` åˆ°ç•Œé¢çš„èŠå¤©æ¶ˆæ¯é‡Œï¼Œæ¸²æŸ“å‡ºæ¥ `this.msg.push()`

ä»£ç æ®µï¼š`src/siwi/frontend/src/App.vue`

```vue
<template>
  <div id="app">

     <VueBotUI
      :messages="msg"
      :options="botOptions"
      :bot-typing="locking"
      :input-disable="locking"
      @msg-send="msgSender"         ---------------- 1.
    />
  </div>
</template>

<script>
import { VueBotUI } from 'vue-bot-ui'
import axios from "axios";

export default {
  name: 'App',
  components: {
    VueBotUI,
  },
  methods: {
    msgSender(data) {
      this.msg.push({
        agent: "user",
        type: "text",
        text: data.text,
      });

      this.locking = true;

      axios.post(this.apiEndpoint, { "question": data.text }).then((response) => {
        console.log(response);   ----------------- 2.

        this.msg.push({          ----------------- 3.
          agent: "bot",
          type: "text",
          text: response.data.answer,
        });

        this.synthText = response.data.answer;
        this.agentSpeak = true;

        this.locking = false;
      });
    },
  }
}
```

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªå›¾å½¢ç•Œé¢çš„æœºå™¨äººå•¦ï¼Œä¸è¿‡ï¼Œæ›´è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç°ä»£æµè§ˆå™¨çš„æ¥å£ï¼Œå®ç°è¯­éŸ³è¯†åˆ«å’Œæœºå™¨äººè¯´è¯ï¼

### è¯­éŸ³è¯†åˆ«

æˆ‘ä»¬å€ŸåŠ©äº [Vue Web Speech](https://github.com/Drackokacka/vue-web-speech), è¿™ä¸ªè¯­éŸ³ API çš„ VueJS çš„ç»‘å®šï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ¨æŒ‰ä¸‹ ğŸ™ï¸ çš„æ—¶å€™æ¥æ”¶äººçš„è¯­éŸ³ï¼Œå¹¶æŠŠè¯­éŸ³è½¬æ¢æˆæ–‡å­—å‘å‡ºå»ï¼Œåœ¨å›ç­”è¢«è¿”å›ä¹‹åï¼Œå®ƒï¼ˆè¿˜æ˜¯ä»–/å¥¹ğŸ˜ï¼Ÿï¼‰ä¹Ÿä¼šæŠŠå›ç­”çš„å¥å­è¯»å‡ºæ¥ç»™ç”¨æˆ·ã€‚

1. `record` åœ¨ `ğŸ™ï¸` è¢«æŒ‰ä¸‹ä¹‹åï¼Œå˜æˆ `ğŸ‘‚`
2. è§¦å‘ `onResults()` ç›‘å¬
3. æŠŠè¿”å›ç»“æœå‘ç»™ `this.synthText` åˆæˆå™¨ï¼Œå‡†å¤‡è¯»å‡º
4. `<vue-web-speech-synth>` æŠŠè¯­éŸ³è¯»å‡º

ä»£ç æ®µï¼š`src/siwi/frontend/src/App.vue`

```vue
<template>
  <div id="app">
    <button id="mic_btn" @click="record = !record">
        {{record?'ğŸ‘‚':'ğŸ™ï¸'}}      --------------------------> 1.
    </button>

    <vue-web-speech
      v-model="record"
      @results="onResults"       --------------------------> 1.
      @unrecognized="unrecognized"
    >
    </vue-web-speech>

...
    <vue-web-speech-synth
      v-model="agentSpeak"
      :voice="synthVoice"
      :text="synthText"
      @list-voices="listVoices"  --------------------------> 4.
    />

  </div>
</template>

<script>
import { VueBotUI } from 'vue-bot-ui'
import axios from "axios";

export default {
  name: 'App',
  components: {
    VueBotUI,
  },
  onResults (data) {             -------------------------> 2.
      this.results = data;
      this.locking = true;

      this.msg.push({
        agent: "user",
        type: "text",
        text: data[0],
      });

      this.locking = true;
      console.log(data[0]);
      axios.post(this.apiEndpoint, { "question": data[0] }).then((response) => {
        console.log(response.data);

        this.msg.push({
          agent: "bot",
          type: "text",
          text: response.data.answer,
        });

        this.synthText = response.data.answer;  ----------> 3.
        this.agentSpeak = true;
      });
      this.locking = false;
    },
  }
}
</script>
```



## æ€»ç»“

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¼šäº†æ­å»ºè‡ªå·±çš„ç¬¬ä¸€ä¸ª KBQAï¼šçŸ¥è¯†å›¾è°±é©±åŠ¨çš„é—®ç­”ç³»ç»Ÿã€‚

å›é¡¾ä¸‹å®ƒçš„ä»£ç ç»“æ„ï¼š

- `src/siwi` å¯¹åº”åç«¯
  - App æ˜¯ Flask API å¤„ç†çš„éƒ¨åˆ†
  - Bot æ˜¯å¤„ç†è¯·æ±‚ã€è®¿é—® Nebula Graph çš„éƒ¨åˆ†
- `src/siwi_frontend` æ˜¯å‰ç«¯

å¸Œæœ›å¤§å®¶åœ¨è¿™ä¸ªç®€é™‹çš„åŸºç¡€ä¹‹ä¸Šï¼Œå¤šå¤šæ¢ç´¢ï¼Œåšå‡ºæ¥æ›´åŠ æˆç†Ÿçš„èŠå¤©æœºå™¨äººï¼Œæ¬¢è¿ä½ æ¥ç»™æˆ‘é‚®ä»¶ã€ç•™è¨€å‘Šè¯‰æˆ‘å‘€ï¼Œè¿™é‡Œï¼šhttps://siwei.io/about æœ‰æˆ‘çš„è”ç³»æ–¹å¼ã€‚

```bash
.
â”œâ”€â”€ README.md
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ siwi                        # Siwi-API Backend
â”‚   â”‚   â”œâ”€â”€ app                     # Web Server, take HTTP requests and calls Bot API
â”‚   â”‚   â””â”€â”€ bot                     # Bot API
â”‚   â”‚       â”œâ”€â”€ actions             # Take Intent, Slots, Query Knowledge Graph here
â”‚   â”‚       â”œâ”€â”€ bot                 # Entrypoint of the Bot API
â”‚   â”‚       â”œâ”€â”€ classifier          # Symentic Parsing, Intent Matching, Slot Filling
â”‚   â”‚       â””â”€â”€ test                # Example Data Source as equivalent/mocked module
â”‚   â””â”€â”€ siwi_frontend               # Browser End
â”‚       â”œâ”€â”€ README.md
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ src
â”‚           â”œâ”€â”€ App.vue             # Listening to user and pass Questions to Siwi-API
â”‚           â””â”€â”€ main.js
â””â”€â”€ wsgi.py
```

å¦‚æœä½ å¾ˆå–œæ¬¢è¿™æ ·çš„å°é¡¹ç›®ï¼Œæ¬¢è¿æ¥çœ‹çœ‹æˆ‘ä¹‹å‰çš„åˆ†äº«ï¼š ã€Œ[ä»0-1ï¼šå¦‚ä½•æ„å»ºä¸€ä¸ªä¼ä¸šè‚¡æƒå›¾è°±ç³»ç»Ÿï¼Ÿ](https://siwei.io/corp-rel-graph/)ã€å“¦ã€‚



> ğŸ’¡ï¼šä½ çŸ¥é“å—ï¼Œæˆ‘å…¶å®å€ŸåŠ©äº Katacoda å·²ç»ä¸ºå¤§å®¶æ­å»ºäº†ä¸€ä¸ªäº¤äº’å¼ä½“éªŒ Siwi + Nebula çš„éƒ¨ç½²çš„ç¯å¢ƒï¼Œå¦‚æœæ‚¨çš„ç½‘ç»œæ¡ä»¶å¤Ÿå¿«ï¼ˆKatacodaæœåŠ¡å™¨åœ¨å›½å¤–ï¼‰ï¼Œå¯ä»¥åœ¨[è¿™é‡Œ](https://siwei.io/learn/nebula-101-siwi-kgqa/)ç‚¹ç‚¹é¼ æ ‡å°±äº¤äº’å¼ä½“éªŒå®ƒã€‚
>
> è§†é¢‘ä»‹ç»
>
> <iframe src="//player.bilibili.com/player.html?aid=421964672&bvid=BV1Rm4y1Q7B5&cid=448090671&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

## æ„Ÿè°¢ç”¨åˆ°çš„å¼€æºé¡¹ç›® â¤ï¸

è¿™ä¸ªå°é¡¹ç›®é‡Œæˆ‘ä»¬ç”¨åˆ°äº†å¥½å¤šå¼€æºçš„é¡¹ç›®ï¼Œéå¸¸æ„Ÿè°¢è¿™äº›è´¡çŒ®è€…ä»¬çš„æ…·æ…¨ä¸æ— ç§ï¼Œå¼€æºæ˜¯ä¸æ˜¯å¾ˆé…·å‘¢ï¼Ÿ

### Backend

- [KGQA on MedicalKG](https://github.com/liuhuanyong/QASystemOnMedicalKG) by [Huanyong Liu](https://liuhuanyong.github.io/)
- [Flask](https://github.com/pallets/flask)
- [pyahocorasick](https://github.com/WojciechMula/pyahocorasick) created by [Wojciech MuÅ‚a](http://0x80.pl/)
- [PyYaml](https://pyyaml.org/)

### Frontend

- [VueJS](https://vuejs.org/) for frontend framework
- [Vue Bot UI](https://github.com/juzser/vue-bot-ui), as a lovely bot UI in vue
- [Vue Web Speech](https://github.com/Drackokacka/vue-web-speech), for speech API vue wrapper
- [Axios](https://github.com/axios/axios) for browser http client
- [Solarized](https://en.wikipedia.org/wiki/Solarized_(color_scheme)) for color scheme
- [Vitesome](https://github.com/alvarosaburido/vitesome) for landing page design

### Graph Database

- [Nebula Graph](https://github.com/vesoft-inc/nebula/) é«˜æ€§èƒ½ã€äº‘åŸç”Ÿçš„å¼€æºåˆ†å¸ƒå¼å›¾æ•°æ®åº“

