# å›¾æ•°æ®åº“ä½“æ“ï¼šç”¨ Nebula Graph æ­æˆè¯­å›¾è°±è§£æ±‰å…œ




> æˆ‘å‘ç°ç”¨ Nebula Graph çš„å›¾æŸ¥è¯¢è§£ Antfu çš„æ±‰å…œï¼ˆæœ€å¥½çš„ä¸­æ–‡æˆè¯­ç‰ˆ wordle ğŸ‘‰ğŸ» handle.antfu.meï¼‰ç‰¹åˆ«æœ‰æ„æ€ï¼Œå¾ˆé€‚åˆæ¯å¤©å†™å›¾åº“è¯­å¥çš„ä½“æ“ç»ƒä¹ ï¼Œæœ¬æ–‡æ­ç¤ºå¦‚ä½•ç”¨çŸ¥è¯†å›¾è°±~~ä½œå¼Š~~è§£æ±‰å…œğŸ˜

<!--more-->

## ä»€ä¹ˆæ˜¯æ±‰å…œï¼Ÿ

æ±‰å…œï¼ˆhttps://handle.antfu.meï¼‰æ˜¯ç”± Vue/Vite æ ¸å¿ƒå›¢é˜Ÿçš„ Antfu çš„åˆä¸€ä¸ªéå¸¸é…·çš„ä½œå“ï¼Œä¸€ä¸ªéå¸¸ç²¾è‡´çš„æ±‰å­—ç‰ˆçš„ Wordleï¼Œä»–æ˜¯æ˜¯ä¸€ä¸ªæ¯æ—¥æŒ‘æˆ˜çš„å¡«å­—æ¸¸æˆçš„ä¸­æ–‡æˆè¯­ç‰ˆã€‚

æ¯å¤©ï¼Œæ±‰å…œä¼šå‘èµ·ä¸€ä¸ªçŒœæˆè¯­æŒ‘æˆ˜ï¼Œäººä»¬è¦åœ¨åæ¬¡å†…æ‰å¯¹å®ƒæ‰èƒ½è·èƒœï¼Œæ¯ä¸€æ­¥ä¹‹åéƒ½ä¼šæ”¶åˆ°ç›¸åº”çš„æ–‡å­—ã€å£°æ¯ã€éŸµæ¯ã€å£°è°ƒçš„åŒ¹é…æƒ…å†µçš„æç¤ºï¼Œå…¶ä¸­ï¼šç»¿è‰²è¡¨ç¤ºè¿™ä¸ªå› ç´ å­˜åœ¨å¹¶ä¸”ä½ç½®åŒ¹é…ã€æ©˜è‰²è¡¨ç¤ºè¿™ä¸ªå…ƒç´ å­˜åœ¨ä½†æ˜¯ä½ç½®ä¸å¯¹ï¼Œè¯¦ç»†çš„è§„åˆ™å¯è§å¦‚ä¸‹çš„ç½‘é¡µæˆªå›¾ï¼š

![](handle-intro.webp)

æ±‰å…œçš„ä¹è¶£å°±æˆ‘ä»¬åœ¨äºåœ¨æœ‰é™çš„å°è¯•è¿‡ç¨‹ä¸­ï¼Œåœ¨å¤§è„‘ä¸­æœå¯»å¯èƒ½çš„ç­”æ¡ˆï¼Œä¸æ–­å»é€¼è¿‘çœŸç†ï¼Œä»»ä½•è¯•å›¾ä½œå¼Šã€è®¨å·§å»æ³„æ¼ç»“æœçš„è¡Œä¸ºéƒ½æ˜¯å¾ˆæ— è¶£ã€å€’èƒƒå£çš„ï¼ˆæ¯”å¦‚ä»å¼€æºçš„æ±‰å…œä»£ç é‡Œçªƒå–ä¿¡æ¯ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒåœ¨åšå¤§è„‘çš„ä½“æ“ã€‚

è¯´åˆ°å¤§è„‘çš„æˆè¯­è¯æ±‡é‡ä½“æ“ï¼Œæˆ‘çªç„¶æƒ³åˆ°ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½åœ¨å¤§è„‘ä¹‹å¤–é€ ä¸€ä¸ªæ±‰è¯­æˆè¯­çŸ¥è¯†å›¾è°±ï¼Œç„¶ååŸºäºè¿™ä¸ªå›¾è°±å»åšå›¾æ•°æ®åº“æŸ¥è¯¢è¯­æ³•ä½“æ“å‘¢ï¼Ÿ

## æ„é€ è§£å†³æ±‰å…œçš„æˆè¯­çŸ¥è¯†å›¾è°±

### ä»€ä¹ˆæ˜¯çŸ¥è¯†å›¾è°±ï¼Ÿ

ç®€å•æ¥è¯´ï¼ŒçŸ¥è¯†å›¾è°±æ˜¯ä¸€ä¸ªè¿æ¥å®ä½“ä¹‹é—´å…³è”å…³ç³»çš„ç½‘ç»œï¼Œå®ƒæœ€åˆç”± Google æå‡ºå¹¶ç”¨æ¥æ»¡è¶³æœç´¢å¼•æ“ä¸­åŸºäºçŸ¥è¯†æ¨ç†æ‰å¯è·å¾—ï¼ˆè€Œä¸æ˜¯ç½‘é¡µå€’æ’ç´¢å¼•ï¼‰çš„æœç´¢é—®é¢˜ï¼Œæ¯”å¦‚ï¼šâ€å§šæ˜å¦»å­çš„å¹´é¾„ï¼Ÿâ€œã€â€ç«ç®­é˜Ÿå¾—è¿‡å‡ æ¬¡æ€»å† å†›ï¼Ÿâ€œ

è¿™é‡Œè¾¹ï¼Œæˆ‘ä»¬å…³æ³¨çš„æ¡ä»¶ã€‚åˆ° 2022 å¹´çš„ç°åœ¨ï¼ŒçŸ¥è¯†å›¾è°±å·²ç»è¢«å¹¿æ³›åº”ç”¨åœ¨æ¨èç³»ç»Ÿã€é—®ç­”ç³»ç»Ÿã€å®‰å…¨é£æ§ç­‰ç­‰æ›´å¤šæœç´¢ä¹‹å¤–çš„é¢†åŸŸã€‚

### ä¸ºä»€ä¹ˆéœ€è¦ç”¨çŸ¥è¯†å›¾è°±è§£å†³æ±‰å…œï¼Ÿ

~~åŸå› å°±æ˜¯ï¼šbecause I can~~

å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨å¤§è„‘ä¸­è§£å†³å­—è°œæ¸¸æˆçš„è¿‡ç¨‹åƒæäº†å›¾è°±ç½‘ç»œä¸­çš„ä¿¡æ¯æœå¯»çš„è¿‡ç¨‹ï¼Œæ±‰å…œçš„è§£è°œåé¦ˆæç¤ºæ¡ä»¶å¤©ç„¶é€‚åˆè¢«ç”¨å›¾è°±çš„è¯­ä¹‰æ¥è¿›è¡Œè¡¨è¾¾ã€‚åœ¨æœ¬æ–‡åè¾¹ï¼Œä½ ä»¬ä¼šå‘ç°è§£è°œæ¡ä»¶ç¿»è¯‘æˆå›¾è¯­ä¹‰æ˜¯éå¸¸éå¸¸è‡ªç„¶çš„ï¼Œè¿™ä¸ªé—®é¢˜å°±åƒæ˜¯ä¸€ä¸ªå¤©ç„¶çš„ä¸ºå›¾è°±è€Œå­˜åœ¨çš„ç»ƒä¹ ä¸€æ ·ï¼Œæˆ‘ç›¸ä¿¡è¿™å’ŒçŸ¥è¯†å›¾è°±çš„ç»“æ„å’Œäººè„‘ä¸­çš„çŸ¥è¯†ç»“æ„éå¸¸æ¥è¿‘æœ‰å¾ˆå¤§çš„å…³ç³»ã€‚

### å¦‚ä½•æ„å»ºé¢å‘æ±‰å…œè§£è°œçš„çŸ¥è¯†å›¾è°±ï¼Ÿ

çŸ¥è¯†å›¾è°±æ˜¯ç”±å®ä½“ï¼ˆé¡¶ç‚¹ï¼‰å’Œå…³ç³»ï¼ˆè¾¹ï¼‰ç»„æˆçš„ï¼Œç”¨å›¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆGraph Database MSï¼‰å¯ä»¥å¾ˆæ–¹ä¾¿è¿›è¡ŒçŸ¥è¯†çš„å…¥åº“ã€æ›´æ”¹ã€æŸ¥è¯¢ã€ç”šè‡³å¯è§†åŒ–æ¢ç´¢ã€‚

åœ¨æœ¬æ–‡é‡Œï¼Œæˆ‘å°†åˆ©ç”¨å¼€æºçš„åˆ†å¸ƒå¼å›¾æ•°æ®åº“ Nebula Graph å¼€å®è·µè¿™ä¸ªè¿‡ç¨‹ï¼Œå…·ä½“å›¾è°±ç³»ç»Ÿçš„æ­å»ºæˆ‘éƒ½ä¼šæ”¾åœ¨æ–‡æœ«ã€‚

åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬åªè®¨è®ºå›¾è°±çš„å»ºæ¨¡ï¼šå¦‚ä½•é¢å‘æ±‰å…œçš„è§£è°œå»è®¾è®¡â€œå®ä½“â€ä¸â€œå…³ç³»â€ã€‚

#### å›¾å»ºæ¨¡

##### æœ€åˆçš„æƒ³æ³•

é¦–å…ˆï¼Œä¸€å®šå­˜åœ¨çš„å®ä½“æ˜¯ï¼š

- æˆè¯­
- æ±‰å­—

æˆè¯­-[åŒ…å«]->æ±‰å­—ï¼Œæ¯ä¸ªæ±‰å­—-[è¯»ä½œ]->è¯»éŸ³ã€‚



å…¶æ¬¡ï¼Œå› ä¸ºè§£è°œè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°äº†å£°æ¯ã€éŸµæ¯ä»¥åŠå£°è°ƒçš„æ¡ä»¶ï¼Œè€ƒè™‘åˆ°å›¾è°±æœ¬èº«çš„é‡çº§éå¸¸å°ï¼ˆåƒçº§åˆ«ï¼‰ï¼Œè€Œä¸”å­—çš„è¯»éŸ³æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œæˆ‘æŠŠè¯»éŸ³å’Œå£°æ¯ï¼ˆåŒ…æ¶µå£°æ¯-initialå’ŒéŸµæ¯-finalï¼‰ä¹Ÿä½œä¸ºå®ä½“ï¼Œä»–ä»¬ä¹‹é—´çš„å…³ç³»åˆ™æ˜¯é¡ºç†æˆç« äº†ï¼š

![schema_v0](./schema_v0.webp)

##### æœ€ç»ˆçš„ç‰ˆæœ¬

ç„¶è€Œï¼Œæˆ‘åœ¨åè¾¹åŸºäºå›¾è°±è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™å‘ç°æœ€åˆçš„å»ºæ¨¡ä¼šä½¿å¾—(æˆè¯­)-->(å­—)-->(è¯»éŸ³)æŸ¥è¯¢è¿‡ç¨‹ä¸­ä¸¢å¤±äº†è¿™ä¸ªå­—ç‰¹å®šçš„è¯»æ³•çš„æ¡ä»¶ï¼Œæ‰€ä»¥æˆ‘æœ€ç»ˆçš„å»ºæ¨¡æ˜¯ï¼š

![schema_v1](./schema_v1.webp)

è¿™æ ·ï¼Œçº¯æ–‡å­—çš„æ¡ä»¶åªæ¶‰åŠäº†`(æˆè¯­)-->(å­—)` è¿™ä¸€è·³ï¼Œè€Œè¯»éŸ³ã€å£°æ¯ã€å£°è°ƒçš„æ¡ä»¶åˆ™æ˜¯å¦ä¸€æ¡å…³ç³»è·¯å¾„ï¼Œæ—¢æ²¡æœ‰æœ€åˆç‰ˆæœ¬æ¡ä»¶çš„å†—ä½™ï¼Œåˆå¯ä»¥åœ¨ä¸€ä¸ªè·¯å¾„æ¨¡å¼åŒ¹é…é‡Œå¸¦ä¸Šä¸¤ç§æ¡ä»¶ï¼ˆåè¾¹çš„ä¾‹å­é‡Œä¼šæ¶‰åŠè¿™æ ·çš„è¡¨è¾¾ï¼‰ã€‚

#### æ„å»ºæˆè¯­çŸ¥è¯†å›¾è°±

æœ‰äº†å»ºæ¨¡ã€è¿™ä¹ˆç®€å•çš„å›¾è°±çš„æ„å»ºå°±å‰©ä¸‹äº†æ•°æ®çš„æ”¶é›†ã€æ¸…æ´—å’Œå…¥åº“ã€‚

å¯¹äºæ‰€æœ‰æˆè¯­æ•°æ®å’Œä»–ä»¬çš„è¯»éŸ³ï¼Œæˆ‘ä¸€æ–¹é¢ç›´æ¥æŠ½å–äº†æ±‰å…œä»£ç å†…éƒ¨çš„[æ•°æ®](https://github.com/antfu/handle/)ã€å¦ä¸€æ–¹é¢åˆ©ç”¨ [PyPinyin](https://pypinyin.readthedocs.io/) è¿™ä¸ªå¼€æºçš„ Python åº“å°†æ±‰å…œæ•°æ®ä¸­æ²¡æœ‰è¯»éŸ³çš„æ•°æ®è·å¾—è¯»éŸ³ï¼ŒåŒæ—¶ï¼Œæˆ‘ä¹Ÿç”¨åˆ°äº† PyPinyin é‡Œçš„å¾ˆå¤šæ–¹ä¾¿çš„å‡½æ•°æ¯”å¦‚è·å–ä¸€ä¸ªæ‹¼éŸ³çš„å£°æ¯ã€éŸµæ¯ã€‚

æ„å»ºå·¥å…·çš„ä»£ç åœ¨è¿™é‡Œï¼šhttps://github.com/wey-gu/chinese-graph

æ›´å¤šä¿¡æ¯æˆ‘ä¹Ÿæ”¾åœ¨æ–‡æœ«çš„é™„å½•ä¹‹ä¸­ã€‚

## å¼€å§‹çŸ¥è¯†å›¾è°±æŸ¥è¯¢ä½“æ“

è‡³æ­¤ï¼Œæˆ‘å‡è®¾å’±ä»¬éƒ½å·²ç»æœ‰äº†æˆ‘å¸®å¤§å®¶æ­å»ºçš„æˆè¯­~~ä½œå¼Š~~çŸ¥è¯†å›¾è°±äº†ï¼Œå¼€å§‹æˆ‘ä»¬çš„å›¾è°±æŸ¥è¯¢ä½“æ“å§ï¼

é¦–å…ˆï¼Œæ‰“å¼€æ±‰å…œ ğŸ‘‰ğŸ» https://handle.antfu.me/

å‡è®¾æˆ‘ä»¬æƒ³ä»ä¸€ä¸ªæˆè¯­å¼€å§‹ï¼Œå¦‚æœä½ æ²¡æœ‰æƒ³æ³•çš„è¯å¯ä»¥è¯•è¯•è¿™ä¸ªï¼š

```GraphQL
# åŒ¹é…æˆè¯­ä¸­çš„ä¸€ä¸ªç»“æœ
MATCH (x:idiom) "çˆ±æ†åˆ†æ˜" RETURN x LIMIT 1

# è¿”å›ç»“æœ
("çˆ±æ†åˆ†æ˜" :idiom{pinyin: "['ai4', 'zeng1', 'fen1', 'ming2']"})
```

ç„¶åæˆ‘ä»¬æŠŠå®ƒå¡«åˆ°æ±‰å…œä¹‹ä¸­ï¼Œè·å¾—ç¬¬ä¸€æ¬¡å°è¯•çš„æç¤ºæ¡ä»¶ï¼š

![](initial_word.webp)

æˆ‘ä»¬è¿æ°”ä¸é”™ï¼Œå¾—åˆ°äº†ä¸‰ä¸ªä½ç½®ä¸Šçš„æ¡ä»¶ï¼

- æœ‰ä¸€ä¸ªéç¬¬ä¸€ä¸ªä½ç½®çš„å­—ï¼Œæ‹¼éŸ³æ˜¯ 4 å£°ï¼ŒéŸµæ¯æ˜¯ aiï¼Œä½†ä¸æ˜¯çˆ±ï¼ˆçˆ±ï¼‰
- æœ‰ä¸€ä¸ªä¸€å£°çš„å­—ï¼Œä¸åœ¨ç¬¬äºŒä¸ªä½ç½®ï¼ˆæ†ï¼‰
- æœ‰ä¸€ä¸ªå­—éŸµæ¯æ˜¯ ingï¼Œä¸åœ¨ç¬¬å››ä¸ªä½ç½®ï¼ˆæ˜ï¼‰
- ç¬¬å››ä¸ªå­—æ˜¯äºŒå£°ï¼ˆæ˜ï¼‰

ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹å›¾æ•°æ®åº“è¯­å¥ä½“æ“ï¼

```GraphQL
# æœ‰ä¸€ä¸ªéç¬¬ä¸€ä¸ªä½ç½®çš„å­—ï¼Œæ‹¼éŸ³æ˜¯ 4 å£°ï¼ŒéŸµæ¯æ˜¯ aiï¼Œä½†ä¸æ˜¯çˆ±
MATCH (char0:character)<-[with_char_0:with_character]-(x:idiom)-[with_pinyin_0:with_pinyin]->(pinyin_0:character_pinyin)-[:with_pinyin_part]->(final_part_0:pinyin_part{part_type: "final"})
WHERE id(final_part_0) == "ai" AND pinyin_0.character_pinyin.tone == 4 AND with_pinyin_0.position != 0 AND with_char_0.position != 0 AND id(char0) != "çˆ±"
# æœ‰ä¸€ä¸ªä¸€å£°çš„å­—ï¼Œä¸åœ¨ç¬¬äºŒä¸ªä½ç½®
MATCH (x:idiom) -[with_pinyin_1:with_pinyin]->(pinyin_1:character_pinyin)
WHERE pinyin_1.character_pinyin.tone == 1 AND with_pinyin_1.position != 1
# æœ‰ä¸€ä¸ªå­—éŸµæ¯æ˜¯ ingï¼Œä¸åœ¨ç¬¬å››ä¸ªä½ç½®
MATCH (x:idiom) -[with_pinyin_2:with_pinyin]->(:character_pinyin)-[:with_pinyin_part]->(final_part_2:pinyin_part{part_type: "final"})
WHERE id(final_part_2) == "ing" AND with_pinyin_2.position != 3
# ç¬¬å››ä¸ªå­—æ˜¯äºŒå£°
MATCH (x:idiom) -[with_pinyin_3:with_pinyin]->(pinyin_3:character_pinyin)
WHERE pinyin_3.character_pinyin.tone == 2 AND with_pinyin_3.position == 3

RETURN x, count(x) as c ORDER BY c DESC
```

åœ¨å›¾æ•°æ®åº“ä¹‹ä¸­è¿è¡Œï¼Œå¾—åˆ°äº† 7 ä¸ªç­”æ¡ˆï¼š

```json
("æƒŠæ„šéª‡ä¿—" :idiom{pinyin: "['jing1', 'yu2', 'hai4', 'su2']"})
("æƒŠä¸–éª‡ä¿—" :idiom{pinyin: "['jing1', 'shi4', 'hai4', 'su2']"})
("æƒŠè§éª‡é—»" :idiom{pinyin: "['jing1', 'jian4', 'hai4', 'wen2']"})
("æ²½åå–ç›´" :idiom{pinyin: "['gu1', 'ming2', 'mai4', 'zhi2']"})
("æƒŠå¿ƒéª‡ç¥" :idiom{pinyin: "['jing1', 'xin1', 'hai4', 'shen2']"})
("è†æ£˜è½½é€”" :idiom{pinyin: "['jing1', 'ji2', 'zai4', 'tu2']"})
("å‡ºå–çµé­‚" :idiom{pinyin: "['chu1', 'mai4', 'ling2', 'hun2']"})
```

çœ‹èµ·æ¥ `æƒŠä¸–éª‡ä¿—` æ¯”è¾ƒä¸»æµï¼Œè¯•è¯•ï¼

![æ±‰å…œ D59](./D59.webp)

æˆ‘ä»¬å¾ˆå¹¸è¿ï¼Œå€ŸåŠ©äºæˆè¯­~~ä½œå¼Š~~çŸ¥è¯†å›¾è°±ï¼Œå±…ç„¶ä¸€æ¬¡å°±æ‰¾åˆ°äº†ç­”æ¡ˆï¼Œå½“ç„¶è¿™å®é™…ä¸Šå¾—ç›Šäºç¬¬ä¸€æ¬¡éšæœºé€‰å–çš„è¯å¸¦æ¥çš„é™åˆ¶æ¡ä»¶çš„ä¸ªæ•°ï¼Œä¸è¿‡åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¸¤æ¬¡å°è¯•è·å¾—æœ€ç»ˆç­”æ¡ˆçš„å¯èƒ½æ€§è¿˜æ˜¯éå¸¸å¤§çš„ï¼

> æ³¨ï¼Œè¿™ä¸­é—´å¾ˆé•¿çš„253åˆ†é’Ÿæ˜¯å› ä¸ºæˆ‘åœ¨æŸ¥è¯¢ä¸­å‘ç°ä¹‹å‰ä»£ç é‡Œæ„é€ çš„å›¾è°±æœ‰ç‚¹ bugï¼Œæ˜¯â€œæŠ«æ·å¸¦é”â€è¿™ä¸ªè¯å¼•èµ·çš„è¯»éŸ³å›¾è°±çš„é”™è¯¯æ•°æ®ï¼Œè¿˜å¥½åæ¥è¢«ä¿®å¤äº†ã€‚
>
> å¤§å®¶çŸ¥é“â€œæŠ«æ·å¸¦é”â€çš„æ­£ç¡®è¯»éŸ³ä¹ˆï¼ŸğŸ˜­
>
> 

æ¥ä¸‹æ¥ï¼Œæˆ‘ç»™å¤§å®¶è¯¦ç»†è§£é‡Šä¸€ä¸‹è¿™ä¸ªè¯­å¥çš„æ„æ€ã€‚

### è¯­å¥çš„å«ä¹‰

æˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªå­—çš„æ¡ä»¶å¼€å§‹ï¼Œè¿™æ˜¯ä¸€ä¸ªæ—¢æœ‰å£°éŸ³ã€åˆæœ‰å­—å½¢ä¿¡æ¯çš„æ¡ä»¶ã€‚

- å£°éŸ³ä¿¡æ¯ï¼šå­˜åœ¨ä¸€ä¸ªéŸµæ¯ä¸º `ai4` çš„å‘éŸ³ï¼Œä½ç½®ä¸åœ¨ç¬¬ä¸€ä¸ªå­—
- æ–‡å­—ä¿¡æ¯ï¼šè¿™ä¸ªéŸµæ¯ä¸º `ai4` çš„å­—ï¼Œä¸æ˜¯`çˆ±`å­—

å¯¹äºå£°éŸ³ä¿¡æ¯æ¡ä»¶ï¼Œè½¬æ¢ä¸ºå›¾æ¨¡å¼åŒ¹é…ä¸ºï¼š(æˆè¯­)-ä¸€ä¸ªå­—å‘éŸ³-(æ‹¼éŸ³) -åŒ…å«å£°æ¯-(éŸµæ¯) WHERE æ‹¼éŸ³éŸµæ¯ä¸º `ai4` AND ä½ç½®ä¸æ˜¯ç¬¬ä¸€ä¸ªã€‚

å› ä¸ºå»ºæ¨¡çš„æ—¶å€™ï¼Œå±æ€§åç§°æˆ‘ç”¨çš„æ˜¯è‹±æ–‡ï¼ˆå…¶å®ä¸­æ–‡ä¹Ÿæ˜¯æ”¯æŒçš„ï¼‰ï¼Œå®é™…ä¸Šçš„è¯­å¥ä¸ºï¼š

```GraphQL
# æœ‰ä¸€ä¸ªéç¬¬ä¸€ä¸ªä½ç½®çš„å­—ï¼Œæ‹¼éŸ³æ˜¯ 4 å£°ï¼ŒéŸµæ¯æ˜¯ ai
MATCH (x:idiom)-[with_pinyin_0:with_pinyin]->(pinyin_0:character_pinyin)-[:with_pinyin_part]->(final_part_0:pinyin_part{part_type: "final"})
WHERE id(final_part_0) == "ai" AND pinyin_0.character_pinyin.tone == 4 AND with_pinyin_0.position != 0
# ...
RETURN x
```

ç±»ä¼¼çš„ï¼Œè¡¨ç¤ºéç¬¬ä¸€ä¸ªä½ç½®çš„å­—ï¼Œä¸æ˜¯`çˆ±` çš„è¡¨è¾¾æ˜¯ï¼š

```GraphQL
# æœ‰ä¸€ä¸ªéç¬¬ä¸€ä¸ªä½ç½®çš„å­—ï¼Œæ‹¼éŸ³æ˜¯ 4 å£°ï¼ŒéŸµæ¯æ˜¯ aiï¼Œä½†ä¸æ˜¯çˆ±
MATCH (char0:character)<-[with_char_0:with_character]-(x:idiom)
WHERE with_char_0.position != 0 AND id(char0) != "çˆ±"
# ...
RETURN x, count(x) as c ORDER BY c DESC
```

è€Œå› ä¸ºè¿™ä¸¤ä¸ªæ¡ä»¶æœ€ç»ˆæè¿°çš„æ˜¯åŒä¸€ä¸ªå­—ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯å¯ä»¥è¢«å†™åœ¨ä¸€ä¸ªè·¯å¾„ä¸‹çš„ï¼š

```GraphQL
# æœ‰ä¸€ä¸ªéç¬¬ä¸€ä¸ªä½ç½®çš„å­—ï¼Œæ‹¼éŸ³æ˜¯ 4 å£°ï¼ŒéŸµæ¯æ˜¯ aiï¼Œä½†ä¸æ˜¯çˆ±
MATCH (char0:character)<-[with_char_0:with_character]-(x:idiom)-[with_pinyin_0:with_pinyin]->(pinyin_0:character_pinyin)-[:with_pinyin_part]->(final_part_0:pinyin_part{part_type: "final"})
WHERE id(final_part_0) == "ai" AND pinyin_0.character_pinyin.tone == 4 AND with_pinyin_0.position != 0 AND with_char_0.position != 0 AND id(char0) != "çˆ±"
# ...
RETURN x
```

æ›´å¤šçš„ `MATCH` è¯­æ³•å’Œä¾‹å­ç»†èŠ‚ï¼Œè¯·å¤§å®¶å‚è€ƒæ–‡æ¡£ï¼š

- MATCH https://docs.nebula-graph.com.cn/3.0.0/3.ngql-guide/7.general-query-statements/2.match/
- å›¾æ¨¡å¼ https://docs.nebula-graph.com.cn/3.0.0/3.ngql-guide/1.nGQL-overview/3.graph-patterns/
- nGQL å‘½ä»¤ cheatsheet https://docs.nebula-graph.com.cn/3.0.0/2.quick-start/6.cheatsheet-for-ngql-command/



## å¯è§†åŒ–å±•ç¤ºçº¿ç´¢

æˆ‘ä»¬æŠŠæ¯ä¸€ä¸ªæ¡ä»¶çš„åŒ¹é…è·¯å¾„ä½œä¸ºè¾“å‡ºï¼Œåˆ©ç”¨ Nebula Graph çš„å¯è§†åŒ–èƒ½åŠ›ï¼Œå¯ä»¥å¾—åˆ°ï¼š

```GraphQL
# æœ‰ä¸€ä¸ªéç¬¬ä¸€ä¸ªä½ç½®çš„å­—ï¼Œæ‹¼éŸ³æ˜¯ 4 å£°ï¼ŒéŸµæ¯æ˜¯ aiï¼Œä½†ä¸æ˜¯çˆ±
MATCH p0=(char0:character)<-[with_char_0:with_character]-(x:idiom)-[with_pinyin_0:with_pinyin]->(pinyin_0:character_pinyin)-[:with_pinyin_part]->(final_part_0:pinyin_part{part_type: "final"})
WHERE id(final_part_0) == "ai" AND pinyin_0.character_pinyin.tone == 4 AND with_pinyin_0.position != 0 AND with_char_0.position != 0 AND id(char0) != "çˆ±"
# æœ‰ä¸€ä¸ªä¸€å£°çš„å­—ï¼Œä¸åœ¨ç¬¬äºŒä¸ªä½ç½®
MATCH p1=(x:idiom) -[with_pinyin_1:with_pinyin]->(pinyin_1:character_pinyin)
WHERE pinyin_1.character_pinyin.tone == 1 AND with_pinyin_1.position != 1
# æœ‰ä¸€ä¸ªå­—éŸµæ¯æ˜¯ ingï¼Œä¸åœ¨ç¬¬å››ä¸ªä½ç½®
MATCH p2=(x:idiom) -[with_pinyin_2:with_pinyin]->(:character_pinyin)-[:with_pinyin_part]->(final_part_2:pinyin_part{part_type: "final"})
WHERE id(final_part_2) == "ing" AND with_pinyin_2.position != 3
# ç¬¬å››ä¸ªå­—æ˜¯äºŒå£°
MATCH p3=(x:idiom) -[with_pinyin_3:with_pinyin]->(pinyin_3:character_pinyin)
WHERE pinyin_3.character_pinyin.tone == 2 AND with_pinyin_3.position == 3

RETURN p0,p1,p2,p3
```

åœ¨å¯è§†åŒ–å·¥å…·çš„ Console æ§åˆ¶å°é‡Œæ‰§è¡Œä¸Šè¾¹çš„è¯­å¥ä¹‹åï¼Œé€‰æ‹©å¯¼å…¥å›¾æ¢ç´¢ï¼Œå°±å¯ä»¥çœ‹åˆ°

![](studio.webp)

## ä¸‹ä¸€æ­¥

å¦‚æœå¤§å®¶æ˜¯ä»æœ¬æ–‡ç¬¬ä¸€æ¬¡äº†è§£åˆ° Nebula Graph å›¾æ•°æ®åº“ï¼Œé‚£ä¹ˆå¤§å®¶å¯ä»¥ä¸‹ä¸€æ­¥ä» [Nebula Graph](https://github.com/vesoft-inc/nebula) é¡¹ç›®å’Œ Nebula Graph ç¤¾åŒºçš„å®˜æ–¹ Bilibili ç«™ç‚¹ ğŸ‘‰ğŸ» https://space.bilibili.com/472621355 äº†è§£æ›´å¤šæœ‰æ„æ€çš„å…¥é—¨çŸ¥è¯†ã€‚

å¦å¤–ï¼Œ[è¿™é‡Œ](https://nebula-graph.com.cn/demo/)æ˜¯ Nebula Graph çš„å®˜æ–¹çº¿ä¸Šè¯•ç©ç¯å¢ƒï¼Œå¤§å®¶å¯ä»¥ç…§ç€[æ–‡æ¡£](https://docs.nebula-graph.com.cn/)ï¼Œåˆ©ç”¨è¯•ç©ç¯å¢ƒå°é²œã€‚

åè¾¹ï¼ŒNebula Graph ä¼šå¼€å±•æ¯å¤©çš„æ±‰å…œ nGQL ä½“æ“æ´»åŠ¨ï¼Œæ•¬è¯·å…³æ³¨å“ˆï¼

Happy Graphing!

## é™„å½•ï¼šæ­å»ºæˆè¯­çŸ¥è¯†å›¾è°±

### æ”¶é›†ã€ç”Ÿæˆå›¾è°±æ•°æ®

```bash
$ python3 graph_data_generator.py
```

### å¯¼å…¥æ•°æ®åˆ° Nebula Graph å›¾æ•°æ®åº“

#### éƒ¨ç½²å›¾æ•°æ®åº“

> å€ŸåŠ©äº Nebula-Up https://github.com/wey-gu/nebula-up/ ï¼Œä¸€è¡Œå°±å¯ä»¥äº†ã€‚

```bash
$ curl -fsSL nebula-up.siwei.io/install.sh | bash -s -- v3.0.0
```

éƒ¨ç½²æˆåŠŸçš„è¯ï¼Œä¼šçœ‹åˆ°è¿™æ ·çš„ç»“æœï¼š

```bash
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒŒ Nebula-Graph Playground is Up now!  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚ ğŸ‰ Congrats! Your Nebula is Up now!    â”‚
â”‚    $ cd ~/.nebula-up                   â”‚
â”‚                                        â”‚
â”‚ ğŸŒ You can access it from browser:     â”‚
â”‚      http://127.0.0.1:7001             â”‚
â”‚      http://<other_interface>:7001     â”‚
â”‚                                        â”‚
â”‚ ğŸ”¥ Or access via Nebula Console:       â”‚
â”‚    $ ~/.nebula-up/console.sh           â”‚
â”‚                                        â”‚
â”‚    To remove the playground:           â”‚
â”‚    $ ~/.nebula-up/uninstall.sh         â”‚
â”‚                                        â”‚
â”‚ ğŸš€ Have Fun!                           â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å›¾è°±å…¥åº“

> å€ŸåŠ©äº Nebula-Importer https://github.com/vesoft-inc/nebula-importer/ ï¼Œä¸€è¡Œå°±å¯ä»¥äº†ã€‚

```bash
$ docker run --rm -ti \
    --network=nebula-docker-compose_nebula-net \
    -v ${PWD}/importer_conf.yaml:/root/importer_conf.yaml \
    -v ${PWD}/output:/root \
    vesoft/nebula-importer:v3.0.0 \
    --config /root/importer_conf.yaml
```

å¤§æ¦‚ä¸€ä¸¤åˆ†é’Ÿæ•°æ®å°±å¯¼å…¥æˆåŠŸäº†ï¼Œå‘½ä»¤ä¹Ÿä¼šæ­£å¸¸é€€å‡ºã€‚

> è¿åˆ°å›¾æ•°æ®åº“çš„ console

è·å¾—æœ¬æœºç¬¬ä¸€ä¸ªç½‘å¡çš„åœ°å€ï¼Œè¿™é‡Œæ˜¯ `10.1.1.168`

```bash
$ ip address

2: enp4s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 2a:32:4c:06:04:c4 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.168/24 brd 10.1.1.255 scope global dynamic enp4s0
```

è¿›å…¥ Console çš„å®¹å™¨æ‰§è¡Œä¸‹è¾¹çš„å‘½ä»¤ï¼š

```bash
$ ~/.nebula-up/console.sh

# nebula-console -addr 10.1.1.168 -port 9669 -user root -p nebula
```

æ£€æŸ¥ä¸€ä¸‹å¯¼å…¥çš„æ•°æ®ï¼š

```sql
(root@nebula) [(none)]> show spaces
+--------------------+
| Name               |
+--------------------+
| "chinese_idiom"    |
+--------------------+

(root@nebula) [(none)]> use chinese_idiom
Execution succeeded (time spent 1510/2329 us)

Fri, 25 Feb 2022 08:53:11 UTC

(root@nebula) [chinese_idiom]> match p=(æˆè¯­:idiom) return p limit 2
+------------------------------------------------------------------+
| p                                                                |
+------------------------------------------------------------------+
| <("ä¸€ä¸ä¸è¯†" :idiom{pinyin: "['yi1', 'ding1', 'bu4', 'shi2']"})> |
| <("ä¸€ä¸ä¸æŒ‚" :idiom{pinyin: "['yi1', 'si1', 'bu4', 'gua4']"})>   |
+------------------------------------------------------------------+

(root@nebula) [chinese_idiom]> SUBMIT JOB STATS
+------------+
| New Job Id |
+------------+
| 11         |
+------------+
(root@nebula) [chinese_idiom]> SHOW STATS
+---------+--------------------+--------+
| Type    | Name               | Count  |
+---------+--------------------+--------+
| "Tag"   | "character"        | 4847   |
| "Tag"   | "character_pinyin" | 1336   |
| "Tag"   | "idiom"            | 29503  |
| "Tag"   | "pinyin_part"      | 57     |
| "Edge"  | "with_character"   | 116090 |
| "Edge"  | "with_pinyin"      | 5943   |
| "Edge"  | "with_pinyin_part" | 3290   |
| "Space" | "vertices"         | 35739  |
| "Space" | "edges"            | 125323 |
+---------+--------------------+--------+
```



## é™„å½•ï¼šå›¾å»ºæ¨¡çš„ Schema nGQL

```sql
CREATE SPACE IF NOT EXISTS chinese_idiom(partition_num=5, replica_factor=1, vid_type=FIXED_STRING(24));
USE chinese_idiom;
# åˆ›å»ºç‚¹çš„ç±»å‹
CREATE TAG idiom(pinyin string); #æˆè¯­
CREATE TAG character(); #æ±‰å­—
CREATE TAG character_pinyin(tone int); #å•å­—çš„æ‹¼éŸ³
CREATE TAG pinyin_part(part_type string); #æ‹¼éŸ³çš„å£°éƒ¨
# åˆ›å»ºè¾¹çš„ç±»å‹
CREATE EDGE with_character(position int); #åŒ…å«æ±‰å­—
CREATE EDGE with_pinyin(position int); #è¯»ä½œ
CREATE EDGE with_pinyin_part(part_type string); #åŒ…å«å£°éƒ¨
```


