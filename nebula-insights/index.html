<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title class="pjax-title">Nebula-Insights，我们基于 Serverless 架构的数据管道方案与代码分享。 - siwei.io</title><meta name="Description" content="本文介绍我们如何用公有云 Serverless 技术：Google Cloud Scheduler，Google Cloud Functions 和 BigQuery 搭建数据管道，收集探索开源社区洞察。并将全部代码开源在 GitHub。"><meta property="og:title" content="Nebula-Insights，我们基于 Serverless 架构的数据管道方案与代码分享。" />
<meta property="og:description" content="本文介绍我们如何用公有云 Serverless 技术：Google Cloud Scheduler，Google Cloud Functions 和 BigQuery 搭建数据管道，收集探索开源社区洞察。并将全部代码开源在 GitHub。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://siwei.io/nebula-insights/" /><meta property="og:image" content="https://siwei.io/nebula-insights/featured-image.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-03T21:11:04+08:00" />
<meta property="article:modified_time" content="2021-06-25T21:41:07+08:00" /><meta property="og:site_name" content="siwei.io" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://siwei.io/nebula-insights/featured-image.png"/>
<meta name="twitter:title" content="Nebula-Insights，我们基于 Serverless 架构的数据管道方案与代码分享。"/>
<meta name="twitter:description" content="本文介绍我们如何用公有云 Serverless 技术：Google Cloud Scheduler，Google Cloud Functions 和 BigQuery 搭建数据管道，收集探索开源社区洞察。并将全部代码开源在 GitHub。"/>
<meta name="application-name" content="siwei.io">
<meta name="apple-mobile-web-app-title" content="siwei.io">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://siwei.io/nebula-insights/" /><link rel="prev" href="https://siwei.io/nebula-up/" /><link rel="next" href="https://siwei.io/vscode-ngql/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript>
    
    
    
    <meta name="baidu-site-verification" content="code-4R67zl7SwH" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Nebula-Insights，我们基于 Serverless 架构的数据管道方案与代码分享。",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/siwei.io\/nebula-insights\/"
        },"image": ["https:\/\/siwei.io\/images\/site-feature-image.webp"],"genre": "posts","keywords": "Nebula Graph, serverless, Cloud, FaaS","wordcount":  4089 ,
        "url": "https:\/\/siwei.io\/nebula-insights\/","datePublished": "2021-05-03T21:11:04+08:00","dateModified": "2021-06-25T21:41:07+08:00","publisher": {
            "@type": "Organization",
            "name": "Wey Gu","logo": "https:\/\/siwei.io\/images\/site-feature-image.webp"},"author": {
                "@type": "Person",
                "name": "Wey Gu"
            },"description": "本文介绍我们如何用公有云 Serverless 技术：Google Cloud Scheduler，Google Cloud Functions 和 BigQuery 搭建数据管道，收集探索开源社区洞察。并将全部代码开源在 GitHub。"
    }
    </script></head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark');}
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="siwei.io"><span class="header-title-pre"><i class="fas fa-code-branch"></i></span>siwei.io</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="/projects/"> 项目 </a><a class="menu-item" href="/sketch-notes/"> 手绘 </a><a class="menu-item" href="/posts/"> 博客 </a><a class="menu-item" href="/talk/"> 演讲 </a><a class="menu-item" href="/cources/"> 课程 </a><a class="menu-item" href="https://vesoft.com/cn/careers/" rel="noopener noreferrer" target="_blank"> 招聘 </a><a class="menu-item" href="/about/#%E8%81%94%E7%B3%BB%E6%88%91"> 联系 </a><a class="menu-item" href="/path/"> 学习路径 </a><span class="menu-item delimiter"></span><a href="#" onclick="return false;" class="menu-item language" title="选择语言">🌏 Chinese<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" title="Select Language" id="language-select-desktop" onchange="location = this.value;"><option value="/en/nebula-insights/">🌏 English</option><option value="/nebula-insights/" selected>🌏 Chinese</option></select>
                    </a><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="#" onclick="return false;" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" onclick="return false;" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="#" onclick="return false;" class="menu-item theme-select" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                    <select class="color-theme-select" id="theme-select-desktop" title="切换主题">
                        <option value="light">浅色</option>
                        <option value="dark">深色</option>
                        <option value="black">黑色</option>
                        <option value="auto">跟随系统</option>
                    </select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="siwei.io"><span class="header-title-pre"><i class="fas fa-code-branch"></i></span>siwei.io</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="#" onclick="return false;" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" onclick="return false;" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" onclick="return false;" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="/projects/" title="">项目</a><a class="menu-item" href="/sketch-notes/" title="">手绘</a><a class="menu-item" href="/posts/" title="">博客</a><a class="menu-item" href="/talk/" title="">演讲</a><a class="menu-item" href="/cources/" title="">课程</a><a class="menu-item" href="https://vesoft.com/cn/careers/" title="" rel="noopener noreferrer" target="_blank">招聘</a><a class="menu-item" href="/about/#%E8%81%94%E7%B3%BB%E6%88%91" title="">联系</a><a class="menu-item" href="/path/" title="">学习路径</a><a href="#" onclick="return false;" class="menu-item theme-select" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
                <select class="color-theme-select" id="theme-select-mobile" title="切换主题">
                    <option value="light">浅色</option>
                    <option value="dark">深色</option>
                    <option value="black">黑色</option>
                    <option value="auto">跟随系统</option>
                </select>
            </a><a href="#" onclick="return false;" class="menu-item" title="选择语言">🌏 Chinese<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" title="Select Language" onchange="location = this.value;"><option value="/en/nebula-insights/">🌏 English</option><option value="/nebula-insights/" selected>🌏 Chinese</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">目录</h2>
        <div class="toc-content always-active" id="toc-content-auto"><nav id="TableOfContents">
  <ol>
    <li><a href="#需求">需求</a>
      <ol>
        <li><a href="#需求分析">需求分析</a></li>
        <li><a href="#数据的获取api">数据的获取，API</a></li>
      </ol>
    </li>
    <li><a href="#实现">实现</a>
      <ol>
        <li><a href="#计划任务调度-with-cloud-scheduler">计划任务调度 with Cloud Scheduler</a></li>
        <li><a href="#etl-worker-with-python--google-functions">ETL Worker with Python + Google Functions</a></li>
        <li><a href="#数仓表结构定义">数仓表结构定义</a></li>
        <li><a href="#数据可视化">数据可视化</a></li>
      </ol>
    </li>
    <li><a href="#总结">总结</a></li>
  </ol>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle", "normal")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Nebula-Insights，我们基于 Serverless 架构的数据管道方案与代码分享。</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><i class="author fas fa-user-circle fa-fw"></i><a href="https://siwei.io" title="Author" target="_blank" rel="noopener noreferrer author" class="author">Wey Gu</a>
                </span>&nbsp;<span class="post-category">收录于 </span>&nbsp;<span class="post-category">类别 <a href="/categories/big-data/"><i class="far fa-folder fa-fw"></i>Big Data</a>&nbsp;<a href="/categories/cloud/"><i class="far fa-folder fa-fw"></i>Cloud</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-05-03">2021-05-03</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2021-06-25">2021-06-25</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 4089 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 9 分钟&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        data-src="/nebula-insights/featured-image.webp"
        data-srcset="/nebula-insights/featured-image.webp, /nebula-insights/featured-image.webp 1.5x, /nebula-insights/featured-image.webp 2x"
        data-sizes="auto"
        alt="/nebula-insights/featured-image.webp"
        title="本文介绍我们如何用公有云 Serverless 技术：Google Cloud Scheduler，Google Cloud Functions 和 BigQuery 搭建数据管道，收集探索开源社区洞察。并将全部代码开源在 GitHub。" height="892" width="1736"></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ol>
    <li><a href="#需求">需求</a>
      <ol>
        <li><a href="#需求分析">需求分析</a></li>
        <li><a href="#数据的获取api">数据的获取，API</a></li>
      </ol>
    </li>
    <li><a href="#实现">实现</a>
      <ol>
        <li><a href="#计划任务调度-with-cloud-scheduler">计划任务调度 with Cloud Scheduler</a></li>
        <li><a href="#etl-worker-with-python--google-functions">ETL Worker with Python + Google Functions</a></li>
        <li><a href="#数仓表结构定义">数仓表结构定义</a></li>
        <li><a href="#数据可视化">数据可视化</a></li>
      </ol>
    </li>
    <li><a href="#总结">总结</a></li>
  </ol>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p>这是我首发在 Datawhale 的<a href="http://datawhale.club/t/topic/2089" target="_blank" rel="noopener noreferrer">文章</a>，介绍我们如何用公有云 Serverless 技术：Google Cloud Scheduler，Google Cloud Functions 和 BigQuery 搭建数据管道，收集探索开源社区洞察。并将全部代码开源在 GitHub。</p>
</blockquote>
<blockquote>
<p>引子
我们想要收集一些帮助 Nebula Graph 社区运营的 metrics，希望能从不同来源的数据自动化周期性收集、处理、并方便地展现出来做数据驱动分析的基础设施。</p>
</blockquote>
<blockquote>
<p>Nebula Graph 是一个现代的开源分布式图数据库(Graph Database)，欢迎同学们从:</p>
<ul>
<li>官网: <a href="https://nebula-graph.com.cn" target="_blank" rel="noopener noreferrer">https://nebula-graph.com.cn </a></li>
<li>Bilibili: <a href="https://space.bilibili.com/472621355" target="_blank" rel="noopener noreferrer">https://space.bilibili.com/472621355</a></li>
<li>GitHub:https://github.com/vesoft-inc/nebula-graph
了解我们哈。</li>
</ul>
</blockquote>
<h2 id="需求" class="headerLink">
    <a href="#%e9%9c%80%e6%b1%82" class="header-mark"></a>1 需求</h2><ol>
<li>方便增加新的数据</li>
<li>数据收集无需人为触发（自动、周期性）</li>
<li>每天数据量不超过1000条</li>
<li>数据可以生成 dashboard，也可以支持统计分期 query</li>
<li>高可用，数据安全</li>
<li>低预算，尽可能不需要运维人力</li>
</ol>
<h3 id="需求分析" class="headerLink">
    <a href="#%e9%9c%80%e6%b1%82%e5%88%86%e6%9e%90" class="header-mark"></a>1.1 需求分析</h3><p>我们需要搭建一个系统能实现</p>
<ul>
<li>一个能周期性触发获取数据的事件的服务: scheduler</li>
<li>一个触发之后，把数据 ETL 到数据库中的服务: ETL worker</li>
<li>一个数据仓库</li>
<li>一个能够把数据库作为源，允许用户 query，展示数据的界面: Data-UI</li>
</ul>
<p>这个需求的特点是虽然数据量很小、但是要求服务高可用、安全。因为这种情况下自建服务器还需要保证HA和数据安全会一定会消耗昂贵运维人力，所以我们应该尽量避免在自己维护的服务器中搭建 scheduler, 和数据库。</p>
<p>最终，我们选择了尽量使用公有云的 aaS 的方案:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">┌──────────────────────────┐
</span></span><span class="line"><span class="cl">│                          │
</span></span><span class="line"><span class="cl">│  Google Cloud Scheduler  │
</span></span><span class="line"><span class="cl">│                          │
</span></span><span class="line"><span class="cl">└────────────┬─────────────┘
</span></span><span class="line"><span class="cl">             │                             ┌─────────────────────┐
</span></span><span class="line"><span class="cl">             │                             │                     │
</span></span><span class="line"><span class="cl">┌────────────▼─────────────┐   ┌───────────►  GitHub API Server  │
</span></span><span class="line"><span class="cl">│                          │   │           │                     │
</span></span><span class="line"><span class="cl">│  Google Cloud Functions  ├───┤           └─────────────────────┘
</span></span><span class="line"><span class="cl">│                          │   │
</span></span><span class="line"><span class="cl">└────────────┬─────────────┘   │           ┌─────────────────────────┐
</span></span><span class="line"><span class="cl">             │                 │           │                         │
</span></span><span class="line"><span class="cl">             │                 ├───────────►  Docker Hub API Server  │
</span></span><span class="line"><span class="cl">   ┌─────────▼─────────┐       │           │                         │
</span></span><span class="line"><span class="cl">   │                   │       │           │                         │
</span></span><span class="line"><span class="cl">   │  Google BigQuery  │       │           └─────────────────────────┘
</span></span><span class="line"><span class="cl">   │                   │       ├───────────► ...                   
</span></span><span class="line"><span class="cl">   └─────────▲─────────┘       │           ┌──────────────────┐
</span></span><span class="line"><span class="cl">             │                 │           │                  │
</span></span><span class="line"><span class="cl">             │                 └───────────►  Aliyun OSS API  │
</span></span><span class="line"><span class="cl">  ┌──────────┴───────────┐                 │                  │
</span></span><span class="line"><span class="cl">  │                      │                 └──────────────────┘
</span></span><span class="line"><span class="cl">  │  Google Data Studio  │
</span></span><span class="line"><span class="cl">  │       ┌──┐           │
</span></span><span class="line"><span class="cl">  │  ┌──┐ │  │ ┌──┐      │
</span></span><span class="line"><span class="cl">  │  │  │ │  │ │  │      │
</span></span><span class="line"><span class="cl">  │  │  │ │  │ │  │      │
</span></span><span class="line"><span class="cl">  └──┴──┴─┴──┴─┴──┴──────┘
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为我个人比较熟悉 Google Cloud Platform(GCP)的原因，加上GCP在大数据处理上比较领先，再加上Google提供的 free tier额度非常大方，以至于在我们这个数据量下，所有workload都会是免费的。
这个方案最后选择了全栈 Google Cloud，然而，这实际上只是一个参考，同学们完全可以在其他公有云提供商那里找到对应的服务。</p>
<p>这里我简单介绍一下， Google Cloud Scheduler是自解释的，不用多介绍了。
而 Google Cloud Functions是GCP的无服务器(serverless)的 Function as a Service服务，它的好处是我们可以把无状态的 event-driven 的 workload 代码放上去，它是按需付费（pay as you go)的，类似的服务还有 Google Cloud Run，后者的区别在于我们提供的是一个docker/container（这使得能支持的运行环境可以使任何能跑在容器里的东西），而 Cloud Functions是把我们的代码文件放上去。他们的效果是类似的，因为我准备用Python来做 ETL的东西，Clouf Functions已经支持了，我就直接选择它了。</p>
<p>在scheduler里边，我定义了每一天它发一个 pub/sub（类似于kafka，这里google可以保证至少发成功一次）消息给 Cloud Functions，然后 Cloud Functions会去做 ETL的工作。</p>
<p>这里，实际上我的设计里这个触发的函数调会把数据从API那里获取下来，在内存里处理好之后，存储到在对象存储里为 <code>JSON</code> 文件，然后再调用 Google BigQuery 的 API让 BigQuery直接从对对象存储里拉取 <code>JSON</code> 文件，导入记录到相应的表之中。</p>
<p><code>Google BigQuery</code> 作为GCP 特别有竞争力的一个产品，是它数据仓库，BigQuery 可以无限扩容，支持海量数据导入，支持 SQL-like 的 query，还自带ML算法，通过SQL就能调用这些算法。它可以和很多GCP以及第三方的组件可以集成起来。</p>
<p><code>Google Data Studio</code> 是GCP的数据 Insights产品，如果大家用过 Google Analytics 应该已经用过它了。</p>
<h3 id="数据的获取api" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e7%9a%84%e8%8e%b7%e5%8f%96api" class="header-mark"></a>1.2 数据的获取，API</h3><p>我们第一阶段想要收集的数据来源是 GitHub 上，社区项目的统计数据、Docker Hub上，社区镜像的拉取计数，之后，会增加更多维度的数据。</p>
<ul>
<li>Github API, ref: <a href="https://pygithub.readthedocs.io" target="_blank" rel="noopener noreferrer">https://pygithub.readthedocs.io</a>
这里我们利用了一个Github API的一个 Python 封装，下边是在 IDLE/iPython/Jupyter 里尝试的例子</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 实例化一个client
</span></span><span class="line"><span class="cl">g = Github(login_or_token=token, timeout=60, retry=Retry(
</span></span><span class="line"><span class="cl">           total=10, status_forcelist=(500, 502, 504), backoff_factor=0.3))
</span></span><span class="line"><span class="cl"># 配置好要获取的repo的信息
</span></span><span class="line"><span class="cl">org_str = &#34;vesoft-inc&#34;
</span></span><span class="line"><span class="cl">org = g.get_organization(org_str)
</span></span><span class="line"><span class="cl">repos = org.get_repos()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 这里repos是一个迭代器，方便看到里边的东西，我们把它 list 一下可以看到所有的repo:
</span></span><span class="line"><span class="cl">list(repos)
</span></span><span class="line"><span class="cl">[Repository(full_name=&#34;vesoft-inc/nebula&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-docs&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-dev-docker&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/github-statistics&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-docker-compose&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-go&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-java&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-python&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-importer&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-third-party&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-storage&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-graph&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-common&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-stats-exporter&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-web-docker&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-bench&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-console&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-docs-cn&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-chaos&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-clients&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-spark-utils&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-node&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-rust&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-cpp&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-http-gateway&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-flink-connector&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-community&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/nebula-br&#34;),
</span></span><span class="line"><span class="cl"> Repository(full_name=&#34;vesoft-inc/.github&#34;)]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># repo0 是 vesoft-inc/nebula 这个repo，我们可以通过 get_clones_traffic，get_views_traffic 来获取过去十几天的 clone，view 统计
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [16]: repo0.get_clones_traffic()
</span></span><span class="line"><span class="cl">Out[16]:
</span></span><span class="line"><span class="cl">{&#39;count&#39;: 362,
</span></span><span class="line"><span class="cl"> &#39;uniques&#39;: 150,
</span></span><span class="line"><span class="cl"> &#39;clones&#39;: [Clones(uniques=5, timestamp=2021-04-06 00:00:00, count=16),
</span></span><span class="line"><span class="cl">  Clones(uniques=8, timestamp=2021-04-07 00:00:00, count=23),
</span></span><span class="line"><span class="cl">  Clones(uniques=13, timestamp=2021-04-08 00:00:00, count=30),
</span></span><span class="line"><span class="cl">  Clones(uniques=33, timestamp=2021-04-09 00:00:00, count=45),
</span></span><span class="line"><span class="cl">  Clones(uniques=2, timestamp=2021-04-10 00:00:00, count=13),
</span></span><span class="line"><span class="cl">  Clones(uniques=6, timestamp=2021-04-11 00:00:00, count=19),
</span></span><span class="line"><span class="cl">  Clones(uniques=15, timestamp=2021-04-12 00:00:00, count=28),
</span></span><span class="line"><span class="cl">  Clones(uniques=40, timestamp=2021-04-13 00:00:00, count=54),
</span></span><span class="line"><span class="cl">  Clones(uniques=9, timestamp=2021-04-14 00:00:00, count=21),
</span></span><span class="line"><span class="cl">  Clones(uniques=10, timestamp=2021-04-15 00:00:00, count=34),
</span></span><span class="line"><span class="cl">  Clones(uniques=10, timestamp=2021-04-16 00:00:00, count=23),
</span></span><span class="line"><span class="cl">  Clones(uniques=5, timestamp=2021-04-17 00:00:00, count=17),
</span></span><span class="line"><span class="cl">  Clones(uniques=2, timestamp=2021-04-18 00:00:00, count=13),
</span></span><span class="line"><span class="cl">  Clones(uniques=9, timestamp=2021-04-19 00:00:00, count=23),
</span></span><span class="line"><span class="cl">  Clones(uniques=3, timestamp=2021-04-20 00:00:00, count=3)]}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [17]: repo0.get_views_traffic()
</span></span><span class="line"><span class="cl">Out[17]:
</span></span><span class="line"><span class="cl">{&#39;count&#39;: 6019,
</span></span><span class="line"><span class="cl"> &#39;uniques&#39;: 1134,
</span></span><span class="line"><span class="cl"> &#39;views&#39;: [View(uniques=52, timestamp=2021-04-06 00:00:00, count=169),
</span></span><span class="line"><span class="cl">  View(uniques=143, timestamp=2021-04-07 00:00:00, count=569),
</span></span><span class="line"><span class="cl">  View(uniques=152, timestamp=2021-04-08 00:00:00, count=635),
</span></span><span class="line"><span class="cl">  View(uniques=134, timestamp=2021-04-09 00:00:00, count=648),
</span></span><span class="line"><span class="cl">  View(uniques=81, timestamp=2021-04-10 00:00:00, count=318),
</span></span><span class="line"><span class="cl">  View(uniques=42, timestamp=2021-04-11 00:00:00, count=197),
</span></span><span class="line"><span class="cl">  View(uniques=127, timestamp=2021-04-12 00:00:00, count=515),
</span></span><span class="line"><span class="cl">  View(uniques=149, timestamp=2021-04-13 00:00:00, count=580),
</span></span><span class="line"><span class="cl">  View(uniques=134, timestamp=2021-04-14 00:00:00, count=762),
</span></span><span class="line"><span class="cl">  View(uniques=141, timestamp=2021-04-15 00:00:00, count=385),
</span></span><span class="line"><span class="cl">  View(uniques=113, timestamp=2021-04-16 00:00:00, count=284),
</span></span><span class="line"><span class="cl">  View(uniques=48, timestamp=2021-04-17 00:00:00, count=168),
</span></span><span class="line"><span class="cl">  View(uniques=35, timestamp=2021-04-18 00:00:00, count=135),
</span></span><span class="line"><span class="cl">  View(uniques=124, timestamp=2021-04-19 00:00:00, count=492),
</span></span><span class="line"><span class="cl">  View(uniques=59, timestamp=2021-04-20 00:00:00, count=162)]}
</span></span></code></pre></td></tr></table>
</div>
</div><p>除了repo的 <code>clone</code>, <code>view</code>数据，我们还可以获取到 release的数据:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">In [31]: for rel in repo0.get_releases():
</span></span><span class="line"><span class="cl">    ...:     print(rel)
</span></span><span class="line"><span class="cl">GitRelease(title=&#34;Nebula Graph v1.2.1&#34;)
</span></span><span class="line"><span class="cl">GitRelease(title=&#34;Nebula Graph v1.2.0&#34;)
</span></span><span class="line"><span class="cl">GitRelease(title=&#34;Nebula Graph V1.1.0&#34;)
</span></span><span class="line"><span class="cl">GitRelease(title=&#34;Nebula Graph v1.0.1&#34;)
</span></span><span class="line"><span class="cl">GitRelease(title=&#34;V1.0.0 GA&#34;)
</span></span><span class="line"><span class="cl">GitRelease(title=&#34;Nebula Graph v1.0.0-RC4&#34;)
</span></span><span class="line"><span class="cl">GitRelease(title=&#34;Nebula Graph v1.0.0-RC3&#34;)
</span></span><span class="line"><span class="cl">GitRelease(title=&#34;Nebula Graph Release v1.0.0-RC2&#34;)
</span></span><span class="line"><span class="cl">GitRelease(title=&#34;Nebula Graph v1.0.0-rc1&#34;)
</span></span><span class="line"><span class="cl">GitRelease(title=&#34;Nebula Graph v1.0.0-beta&#34;)
</span></span><span class="line"><span class="cl">GitRelease(title=&#34;Nebula Graph v0.1.0&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 每一个 release 对应一个 git tag，其中会有一个或者多个供下载的 asset
</span></span><span class="line"><span class="cl">In [33]: release_v121 = rels[0]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [34]: release_v121.tag_name
</span></span><span class="line"><span class="cl">Out[34]: &#39;v1.2.1&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [35]: list(release_121.get_assets())
</span></span><span class="line"><span class="cl">Out[35]:
</span></span><span class="line"><span class="cl">[GitReleaseAsset(url=&#34;https://api.github.com/repos/vesoft-inc/nebula/releases/assets/35056357&#34;),
</span></span><span class="line"><span class="cl"> GitReleaseAsset(url=&#34;https://api.github.com/repos/vesoft-inc/nebula/releases/assets/35056361&#34;),
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"> GitReleaseAsset(url=&#34;https://api.github.com/repos/vesoft-inc/nebula/releases/assets/35056456&#34;)]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 每一个assset 的下载量和其他metadata也是可以获取的
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [40]: assets[0].browser_download_url
</span></span><span class="line"><span class="cl">Out[40]: &#39;https://github.com/vesoft-inc/nebula/releases/download/v1.2.1/nebula-1.2.1.el6-5.x86_64.rpm&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [41]: assets[0].download_count
</span></span><span class="line"><span class="cl">Out[41]: 45
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In [43]: assets[0].name
</span></span><span class="line"><span class="cl">Out[43]: &#39;nebula-1.2.1.el6-5.x86_64.rpm&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Docker Hub API, ref <a href="https://github.com/amalfra/docker-hub/blob/master/src/libs/docker_hub_client.py" target="_blank" rel="noopener noreferrer">https://github.com/amalfra/docker-hub/blob/master/src/libs/docker_hub_client.py</a>
这里我们服用了 docker-hub 这个开源小项目中的一个库 <code>docker_hub_client.py</code> 来作为 Docker Hub API的 python wrapper</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="c1"># 实例化 client
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">In</span><span class="w"> </span><span class="p">[</span><span class="mi">47</span><span class="p">]:</span><span class="w"> </span><span class="n">dh_client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">DockerHubClient</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1"># 获取 `vesoft`之下的repo
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">In</span><span class="w"> </span><span class="p">[</span><span class="mi">48</span><span class="p">]:</span><span class="w"> </span><span class="n">dh_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dh_client</span><span class="p">.</span><span class="nf">get_repos</span><span class="p">(</span><span class="s2">&#34;vesoft&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">In</span><span class="w"> </span><span class="p">[</span><span class="mi">54</span><span class="p">]:</span><span class="w"> </span><span class="n">dh_r</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">Out</span><span class="p">[</span><span class="mi">54</span><span class="p">]:</span><span class="w"> </span><span class="mi">200</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">In</span><span class="w"> </span><span class="p">[</span><span class="mi">55</span><span class="p">]:</span><span class="w"> </span><span class="n">dh_r</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">].</span><span class="k">keys</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">Out</span><span class="p">[</span><span class="mi">55</span><span class="p">]:</span><span class="w"> </span><span class="nf">dict_keys</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;next&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;previous&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;results&#39;</span><span class="p">])</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1"># 可以看到这一个返回的API里就有所有（如果多的话是需要翻页的）的 image的 start_count, pull_count的数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">In</span><span class="w"> </span><span class="p">[</span><span class="mi">58</span><span class="p">]:</span><span class="w"> </span><span class="n">dh_r</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">Out</span><span class="p">[</span><span class="mi">58</span><span class="p">]:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;vesoft&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;nebula-graphd&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;namespace&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;vesoft&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;repository_type&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;image&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;description&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Nebula Graph Graphd Service Image. https://github.com/vesoft-inc/nebula&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;is_private&#39;</span><span class="p">:</span><span class="w"> </span><span class="no">False</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;is_automated&#39;</span><span class="p">:</span><span class="w"> </span><span class="no">False</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;can_edit&#39;</span><span class="p">:</span><span class="w"> </span><span class="no">False</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;star_count&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;pull_count&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">223494</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;last_updated&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;2021-04-19T19:04:20.324010Z&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;is_migrated&#39;</span><span class="p">:</span><span class="w"> </span><span class="no">False</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;collaborator_count&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;affiliation&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">None</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;hub_user&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;vesoft&#39;</span><span class="err">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="实现" class="headerLink">
    <a href="#%e5%ae%9e%e7%8e%b0" class="header-mark"></a>2 实现</h2><h3 id="计划任务调度-with-cloud-scheduler" class="headerLink">
    <a href="#%e8%ae%a1%e5%88%92%e4%bb%bb%e5%8a%a1%e8%b0%83%e5%ba%a6-with-cloud-scheduler" class="header-mark"></a>2.1 计划任务调度 with Cloud Scheduler</h3><p>前边提到，<code>Scheduler --&gt; Functions</code> 中间是通过消息队列实现的可靠事件触发，我们需要在 Google Cloud Pub/Sub里创建一个订阅消息，后边我们会把这个订阅消息从 Scheduler 定期发送，并且在 Function创建的时候定义为触发条件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ gcloud pubsub topics create nebula-insights-cron-topic
</span></span><span class="line"><span class="cl">$ gcloud pubsub subscriptions create cron-sub --topic nebula-insights-cron-topic
</span></span></code></pre></td></tr></table>
</div>
</div><p>任务的创建非常直接，在 <a href="https://console.cloud.google.com/cloudscheduler" target="_blank" rel="noopener noreferrer">Scheduler Web Console</a> 上直接图形化操作就可以了，记得要选择触发 Pub/Sub 消息为 <code>cron-sub</code>，消息主题为 <code>nebula-insights-cron-topic</code></p>
<h3 id="etl-worker-with-python--google-functions" class="headerLink">
    <a href="#etl-worker-with-python--google-functions" class="header-mark"></a>2.2 ETL Worker with Python + Google Functions</h3><p>当 Scheduler 每天定时发送消息之后，接收方就是我们要定义的 Google Functions了，它的定义如图
第一步，选择它的触发类型为 Pub/Sub，同时要定义消息的主题和名字。</p>
<p><a class="lightgallery" href="./create_functions.png" title="create_functions" data-thumbnail="./create_functions.png">
        <img
            class="lazyload"
            data-src="./create_functions.png"
            data-srcset="./create_functions.png, ./create_functions.png 1.5x, ./create_functions.png 2x"
            data-sizes="auto"
            alt="./create_functions.png">
    </a></p>
<p>第二步就是把代码放进去:</p>
<p><a class="lightgallery" href="./create_functions_code.png" title="create_functions_code" data-thumbnail="./create_functions_code.png">
        <img
            class="lazyload"
            data-src="./create_functions_code.png"
            data-srcset="./create_functions_code.png, ./create_functions_code.png 1.5x, ./create_functions_code.png 2x"
            data-sizes="auto"
            alt="./create_functions_code.png">
    </a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">                                              ┌─────────────────────┐
</span></span><span class="line"><span class="cl">                                              │                     │
</span></span><span class="line"><span class="cl">   ┌──────────────────────────┐   ┌───────────►  GitHub API Server  │
</span></span><span class="line"><span class="cl">   │                          │   │           │                     │
</span></span><span class="line"><span class="cl">   │  Google Cloud Functions  ◄───►           └─────────────────────┘
</span></span><span class="line"><span class="cl">   │                          │   │
</span></span><span class="line"><span class="cl">   └────────────▲─────────────┘   │           ┌─────────────────────────┐
</span></span><span class="line"><span class="cl">                │                 │           │                         │
</span></span><span class="line"><span class="cl">                │                 ├───────────►  Docker Hub API Server  │
</span></span><span class="line"><span class="cl">   ┌────────────▼────────────┐    │           │                         │
</span></span><span class="line"><span class="cl">   │                         │    │           │                         │
</span></span><span class="line"><span class="cl">   │  Google Cloud Storage   │    │           └─────────────────────────┘
</span></span><span class="line"><span class="cl">   │                         │    ...
</span></span><span class="line"><span class="cl">   └────────────┬────────────┘    │           ┌──────────────────┐
</span></span><span class="line"><span class="cl">                │                 │           │                  │
</span></span><span class="line"><span class="cl">                │                 └───────────►  Aliyun OSS API  │
</span></span><span class="line"><span class="cl">      ┌─────────▼─────────┐                   │                  │
</span></span><span class="line"><span class="cl">      │                   │                   └──────────────────┘
</span></span><span class="line"><span class="cl">      │  Google BigQuery  │
</span></span><span class="line"><span class="cl">      │                   │
</span></span><span class="line"><span class="cl">      └───────────────────┘
</span></span></code></pre></td></tr></table>
</div>
</div><p>这部分的逻辑就是通过前边分析了的API取得信息，然后组装成需要的格式存到 Cloud Storage(对象存储），然后再导入到 BigQuery（数仓）之中，全部代码在GitHub上:
<a href="https://github.com/wey-gu/nebula-insights/blob/main/functions/data-fetching-0/main.py" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/nebula-insights/blob/main/functions/data-fetching-0/main.py</a>
另外，可以参考这个官方教程 <a href="https://cloud.google.com/scheduler/docs/tut-pub-sub" target="_blank" rel="noopener noreferrer">https://cloud.google.com/scheduler/docs/tut-pub-sub</a></p>
<h3 id="数仓表结构定义" class="headerLink">
    <a href="#%e6%95%b0%e4%bb%93%e8%a1%a8%e7%bb%93%e6%9e%84%e5%ae%9a%e4%b9%89" class="header-mark"></a>2.3 数仓表结构定义</h3><p>数仓的表结构比较直接，schema的图贴在下边了，值得注意的是，BigQuery支持嵌套的表结构（而不像一般关系型数据库那样需要把这样的逻辑结构用辅助表来表示），在我们这个场景下非常方便，比如release表中的 assets的三个嵌套字段。
<a class="lightgallery" href="./bigquery_schema.png" title="bigquery_schema|475x412" data-thumbnail="./bigquery_schema.png">
        <img
            class="lazyload"
            data-src="./bigquery_schema.png"
            data-srcset="./bigquery_schema.png, ./bigquery_schema.png 1.5x, ./bigquery_schema.png 2x"
            data-sizes="auto"
            alt="./bigquery_schema.png">
    </a></p>
<p>更详细的信息可以参考GitHub上的介绍和代码: <a href="https://github.com/wey-gu/nebula-insights#data-etl-bigquery-and-gcs" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/nebula-insights#data-etl-bigquery-and-gcs</a></p>
<h3 id="数据可视化" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e5%8f%af%e8%a7%86%e5%8c%96" class="header-mark"></a>2.4 数据可视化</h3><p>到这里，我们就可以自动在BigQuery里存有每天收集的不同来源的统计数据啦，有了它，我们可以借助 Data Studio 来生成各式各样的可视化表示。</p>
<p>参考 <a href="https://cloud.google.com/bigquery/docs/visualize-data-studio" target="_blank" rel="noopener noreferrer">https://cloud.google.com/bigquery/docs/visualize-data-studio</a></p>
<h2 id="总结" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93" class="header-mark"></a>3 总结</h2><p>这样，我们实际上不需要任何认为维护的成本和投入，就搭建了一整个数据的流水线，并且只需要按照数据用量付费，在我们的数据量下，及时考虑未来增加数十个新的量度的收集，我们依然没有达到需要付费的用量，是不是很Cool？
因为数据同时存在于对象存储与数仓里，我们可以方便随时把数据导入任意其他平台上。</p>
<p>BigQuery还有一些非常常用的，自带的机器学习的功能，只需要写一个SQL-Like的query就能触发然后获得预测结果，如果我们用到这些功能的话也会回到 datawhale 为同学们继续分享哈。</p>
<p>第一次做数据工程方面的分享，如果有错误的地方欢迎大家不吝指出哈~~</p>
<p>谢谢！</p></div>

        


<h2>相关内容</h2>
<div class="related-container">
    <div class="related-item-container">
            <div class="related-image">
                <a href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/"><img
        class="lazyload"
        data-src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/featured-image.webp"
        data-srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/featured-image.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/featured-image.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/featured-image.webp 2x"
        data-sizes="auto"
        alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/featured-image.webp"
        title="本文介绍我们如何用公有云 Serverless 技术：Google Cloud Scheduler，Google Cloud Functions 和 BigQuery 搭建数据管道，收集探索开源社区洞察。并将全部代码开源在 GitHub。" height="200" width="400"></a>
            </div><h2 class="related-title">
                <a href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/">chatGPT 加 NebulaGraph 预测 2022 世界杯冠军球队</a>
            </h2>
        </div>
    <div class="related-item-container">
            <div class="related-image">
                <a href="/data-lineage-oss-ref-solution/"><img
        class="lazyload"
        data-src="/data-lineage-oss-ref-solution/featured-image.webp"
        data-srcset="/data-lineage-oss-ref-solution/featured-image.webp, /data-lineage-oss-ref-solution/featured-image.webp 1.5x, /data-lineage-oss-ref-solution/featured-image.webp 2x"
        data-sizes="auto"
        alt="/data-lineage-oss-ref-solution/featured-image.webp"
        title="本文介绍我们如何用公有云 Serverless 技术：Google Cloud Scheduler，Google Cloud Functions 和 BigQuery 搭建数据管道，收集探索开源社区洞察。并将全部代码开源在 GitHub。" height="200" width="400"></a>
            </div><h2 class="related-title">
                <a href="/data-lineage-oss-ref-solution/">基于开源技术栈的数据血缘、治理参考解决方案</a>
            </h2>
        </div>
    <div class="related-item-container">
            <div class="related-image">
                <a href="/apisix-and-nebulagraph/"><img
        class="lazyload"
        data-src="/apisix-and-nebulagraph/featured-image.webp"
        data-srcset="/apisix-and-nebulagraph/featured-image.webp, /apisix-and-nebulagraph/featured-image.webp 1.5x, /apisix-and-nebulagraph/featured-image.webp 2x"
        data-sizes="auto"
        alt="/apisix-and-nebulagraph/featured-image.webp"
        title="本文介绍我们如何用公有云 Serverless 技术：Google Cloud Scheduler，Google Cloud Functions 和 BigQuery 搭建数据管道，收集探索开源社区洞察。并将全部代码开源在 GitHub。" height="200" width="400"></a>
            </div><h2 class="related-title">
                <a href="/apisix-and-nebulagraph/">NebulaGraph 的云原生 API 网关最佳实践</a>
            </h2>
        </div>
    <div class="related-item-container">
            <div class="related-image">
                <a href="/nebulagraph-etl-dbt/"><img
        class="lazyload"
        data-src="/nebulagraph-etl-dbt/featured-image.webp"
        data-srcset="/nebulagraph-etl-dbt/featured-image.webp, /nebulagraph-etl-dbt/featured-image.webp 1.5x, /nebulagraph-etl-dbt/featured-image.webp 2x"
        data-sizes="auto"
        alt="/nebulagraph-etl-dbt/featured-image.webp"
        title="本文介绍我们如何用公有云 Serverless 技术：Google Cloud Scheduler，Google Cloud Functions 和 BigQuery 搭建数据管道，收集探索开源社区洞察。并将全部代码开源在 GitHub。" height="200" width="400"></a>
            </div><h2 class="related-title">
                <a href="/nebulagraph-etl-dbt/">利用 dbt，基于表结构的 Nebulagraph 图建模与 ETL</a>
            </h2>
        </div>
    <div class="related-item-container">
            <div class="related-image">
                <a href="/recommendation-system-with-graphdb/"><img
        class="lazyload"
        data-src="/recommendation-system-with-graphdb/featured-image.webp"
        data-srcset="/recommendation-system-with-graphdb/featured-image.webp, /recommendation-system-with-graphdb/featured-image.webp 1.5x, /recommendation-system-with-graphdb/featured-image.webp 2x"
        data-sizes="auto"
        alt="/recommendation-system-with-graphdb/featured-image.webp"
        title="本文介绍我们如何用公有云 Serverless 技术：Google Cloud Scheduler，Google Cloud Functions 和 BigQuery 搭建数据管道，收集探索开源社区洞察。并将全部代码开源在 GitHub。" height="200" width="400"></a>
            </div><h2 class="related-title">
                <a href="/recommendation-system-with-graphdb/">基于图数据库的推荐系统</a>
            </h2>
        </div>
    

</div>

<div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2021-06-25&nbsp;<a class="git-hash" href="github.com/siwei-io/siwei-io.github.io/commit/b05ed3846bafce5979739a35c9522fd5647e6b51" target="_blank" title="commit by wey-gu(1651790&#43;wey-gu@users.noreply.github.com) b05ed3846bafce5979739a35c9522fd5647e6b51: Revert &#34;fixed featured image&#34;" rel="noopener noreferrer">
                                    <i class="fas fa-hashtag fa-fw"></i>b05ed38</a></span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/nebula-insights/index.md target="_blank" rel="noopener noreferrer">阅读原始文档</a>
                    </span></div>
            <div class="post-info-share">
                <span><a href="#" onclick="return false;" title="分享到 Twitter" data-sharer="twitter" data-url="https://siwei.io/nebula-insights/" data-title="Nebula-Insights，我们基于 Serverless 架构的数据管道方案与代码分享。" data-via="wey_gu" data-hashtags="Nebula Graph,serverless,Cloud,FaaS"><i class="fab fa-twitter fa-fw"></i></a><a href="#" onclick="return false;" title="分享到 Facebook" data-sharer="facebook" data-url="https://siwei.io/nebula-insights/" data-hashtag="Nebula Graph"><i class="fab fa-facebook-square fa-fw"></i></a><a href="#" onclick="return false;" title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://siwei.io/nebula-insights/" data-title="Nebula-Insights，我们基于 Serverless 架构的数据管道方案与代码分享。" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="#" onclick="return false;" title="分享到 Line" data-sharer="line" data-url="https://siwei.io/nebula-insights/" data-title="Nebula-Insights，我们基于 Serverless 架构的数据管道方案与代码分享。"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="#" onclick="return false;" title="分享到 微博" data-sharer="weibo" data-url="https://siwei.io/nebula-insights/" data-title="Nebula-Insights，我们基于 Serverless 架构的数据管道方案与代码分享。" data-image="featured-image.webp" data-ralateuid="siweigu"><i class="fab fa-weibo fa-fw"></i></a><a href="#" onclick="return false;" title="分享到 Myspace" data-sharer="myspace" data-url="https://siwei.io/nebula-insights/" data-title="Nebula-Insights，我们基于 Serverless 架构的数据管道方案与代码分享。" data-description="本文介绍我们如何用公有云 Serverless 技术：Google Cloud Scheduler，Google Cloud Functions 和 BigQuery 搭建数据管道，收集探索开源社区洞察。并将全部代码开源在 GitHub。"><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></i></a><a href="#" onclick="return false;" title="分享到 Blogger" data-sharer="blogger" data-url="https://siwei.io/nebula-insights/" data-title="Nebula-Insights，我们基于 Serverless 架构的数据管道方案与代码分享。" data-description="本文介绍我们如何用公有云 Serverless 技术：Google Cloud Scheduler，Google Cloud Functions 和 BigQuery 搭建数据管道，收集探索开源社区洞察。并将全部代码开源在 GitHub。"><i class="fab fa-blogger fa-fw"></i></a><a href="#" onclick="return false;" title="分享到 Evernote" data-sharer="evernote" data-url="https://siwei.io/nebula-insights/" data-title="Nebula-Insights，我们基于 Serverless 架构的数据管道方案与代码分享。"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/nebula-graph/">Nebula Graph</a>,&nbsp;<a href="/tags/serverless/">serverless</a>,&nbsp;<a href="/tags/cloud/">Cloud</a>,&nbsp;<a href="/tags/faas/">FaaS</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/nebula-up/" class="prev" rel="prev" title="Nebula-Up，一键拉起一个 Nebula 测试环境"><i class="fas fa-angle-left fa-fw"></i>Nebula-Up，一键拉起一个 Nebula 测试环境</a>
            <a href="/vscode-ngql/" class="next" rel="next" title="VSCode-ngql，Nebula Graph 的 VSCode 语法高亮插件。">VSCode-ngql，Nebula Graph 的 VSCode 语法高亮插件。<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="giscus"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://giscus.app/">giscus</a>.
            </noscript></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.107.0">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.2.13"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2018 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://siwei.io" target="_blank" rel="noopener noreferrer">Wey Gu</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div><script>
                    if('serviceWorker' in navigator) {
                        navigator.serviceWorker
                            .register('/sw.min.js', { scope: '/' })
                            .then(function(registration) {
                            });
                
                        navigator.serviceWorker
                            .ready
                            .then(function(registration) {
                            });
                    }
                </script></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="回到顶部">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/fuse/fuse.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/tablesort/tablesort.min.js"></script><script type="text/javascript" src="/lib/topbar/topbar.min.js"></script><script type="text/javascript" src="/lib/pjax/pjax.min.js"></script><script type="text/javascript" src="/js/theme.min.js" defer></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'UA-659952-4', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-659952-4" async></script></div>

<div class="pjax-assets"><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"giscus":{"darkTheme":"dark","dataCategory":"Comments","dataCategoryId":"DIC_kwDOFhiy8c4CQeuu","dataEmitMetadata":"1","dataInputPosition":"bottom","dataLang":"en","dataMapping":"title","dataReactionsEnabled":"1","dataRepo":"siwei-io/siwei-io.github.io","dataRepoId":"MDEwOlJlcG9zaXRvcnkzNzA3MTc0MjU=","dataStrict":"1","lightTheme":"light"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"distance":100,"findAllMatches":true,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"没有找到结果","snippetLength":50,"threshold":0.3,"type":"fuse","useExtendedSearch":false},"sharerjs":true,"table":{"sort":true}};</script><script type="text/javascript" src="/js/giscus.min.js" defer></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js" defer></script><script type="text/javascript" src="/lib/katex/auto-render.min.js" defer></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js" defer></script><script type="text/javascript" src="/lib/katex/mhchem.min.js" defer></script><script type="text/javascript" src="/js/katex.min.js" defer></script><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/katex/copy-tex.min.css">
        <noscript><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"></noscript></div>
</body>

</html>