<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>siwei.io</title>
        <link>https://siwei.io/</link>
        <description>Siwei(æ€ä¸º) builds things and believes in Open Source.</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>weyl.gu@gmail.com (Wey Gu)</managingEditor>
            <webMaster>weyl.gu@gmail.com (Wey Gu)</webMaster><lastBuildDate>Mon, 01 Aug 2022 01:15:05 &#43;0800</lastBuildDate>
            <atom:link href="https://siwei.io/index.xml" rel="self" type="application/rss+xml" />
        <item>
    <title>åŸºäº Nebulagraph å›¾æ•°æ®åº“çš„æ¬ºè¯ˆæ£€æµ‹æ–¹æ³•ä¸ä»£ç ç¤ºä¾‹</title>
    <link>https://siwei.io/fraud-detection-with-nebulagraph/</link>
    <pubDate>Mon, 01 Aug 2022 01:15:05 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/fraud-detection-with-nebulagraph/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>æœ¬æ–‡æ˜¯ä¸€ä¸ªåŸºäº NebulaGraph ä¸Šå›¾ç®—æ³•ã€å›¾æ•°æ®åº“ã€æœºå™¨å­¦ä¹ ã€GNN æ–¹æ³•ç»¼è¿°ï¼Œé™¤äº†åŸºæœ¬æ–¹æ³•æ€æƒ³çš„ä»‹ç»ä¹‹å¤–ï¼Œæˆ‘è¿˜ç»™å¤§å®¶å¼„äº†å¯ä»¥è·‘çš„ Playgroundã€‚</p>
</blockquote>
<blockquote>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™è¿˜æˆ‘ç¬¬ä¸€æ¬¡ç»™å¤§å®¶ä»‹ç» Nebula-DGL è¿™ä¸ªé¡¹ç›® ğŸ˜ã€‚</p>
</blockquote>
<h2 id="åŸºäºå›¾æ•°æ®åº“çš„æ¬ºè¯ˆæ£€æµ‹æ–¹æ³•" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%9b%be%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e6%ac%ba%e8%af%88%e6%a3%80%e6%b5%8b%e6%96%b9%e6%b3%95" class="header-mark"></a>1 åŸºäºå›¾æ•°æ®åº“çš„æ¬ºè¯ˆæ£€æµ‹æ–¹æ³•</h2><h3 id="å»ºç«‹å›¾è°±" class="headerLink">
    <a href="#%e5%bb%ba%e7%ab%8b%e5%9b%be%e8%b0%b1" class="header-mark"></a>1.1 å»ºç«‹å›¾è°±</h3><p>é¦–å…ˆï¼Œå¯¹ç°æœ‰çš„å†å²æ•°æ®ã€æ ‡æ³¨ä¿¡æ¯é¢å‘å…³è”å…³ç³»è¿›è¡Œå±æ€§å›¾å»ºæ¨¡ã€‚è¿™ç§åŸå§‹æ•°æ®æ˜¯å¤šä¸ªè¡¨ç»“æ„ä¸­çš„é“¶è¡Œã€ç”µå­å•†åŠ¡æˆ–è€…ä¿é™©è¡Œä¸šé‡Œçš„äº¤æ˜“äº‹ä»¶è®°å½•ã€ç”¨æˆ·æ•°æ®å’Œé£æ§æ ‡æ³¨ï¼Œè€Œå»ºæ¨¡è¿‡ç¨‹å°±æ˜¯æŠ½è±¡å‡ºæˆ‘ä»¬å…³å¿ƒçš„å®ä½“ã€å®ä½“é—´çš„å…³è”å…³ç³»ã€å’Œå…¶ä¸­æœ‰æ„ä¹‰çš„å±æ€§ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œè‡ªç„¶äººã€å…¬å¸å®ä½“ã€ç”µè¯å·ç ã€åœ°å€ã€è®¾å¤‡ï¼ˆæ¯”å¦‚ç»ˆç«¯è®¾å¤‡ã€ç½‘ç»œåœ°å€ã€ç»ˆç«¯è®¾å¤‡æ‰€è¿æ¥çš„ WiFi SSID ç­‰ï¼‰ã€è®¢å•éƒ½æ˜¯å®ä½“æœ¬èº«ï¼Œå…¶ä»–ä¿¡æ¯æ¯”å¦‚é£é™©æ ‡æ³¨ï¼ˆæ˜¯å¦é«˜é£é™©ã€é£é™©æè¿°ç­‰ï¼‰ã€è‡ªç„¶äººå’Œå…¬å¸å®ä½“çš„ä¿¡æ¯ï¼ˆèŒä¸šã€æ”¶å…¥ã€å­¦å†ç­‰ï¼‰éƒ½ä½œä¸ºå®ä½“çš„å±æ€§æ¥å»ºæ¨¡ã€‚</p>
<p>ä¸‹å›¾æ˜¯ä¸€ä¸ªå¯ä»¥å‚è€ƒçš„è´·æ¬¾åæ¬ºè¯ˆçš„ç¤ºä¾‹å»ºæ¨¡ï¼Œå®ƒæ¥è‡ªä¸€ä»½ä½œè€…å¼€æºçš„å›¾ç»“æ„æ•°æ®ç”Ÿæˆé¡¹ç›®ã€‚</p>
<blockquote>
<p>æ³¨ï¼Œä½ å¯ä»¥è®¿é—® <a href="https://github.com/wey-gu/fraud-detection-datagen" target="_blank" rel="noopener noreffer">https://github.com/wey-gu/fraud-detection-datagen</a> è·å–è¿™ä¸ªå¼€æºçš„æ•°æ®ç”Ÿæˆå™¨ä»£ç å’Œä¸€ä»½ç¤ºä¾‹çš„æ•°æ®ã€‚</p>
</blockquote>
<p></p>
<h3 id="å›¾æ•°æ®åº“æŸ¥è¯¢è¯†åˆ«é£é™©" class="headerLink">
    <a href="#%e5%9b%be%e6%95%b0%e6%8d%ae%e5%ba%93%e6%9f%a5%e8%af%a2%e8%af%86%e5%88%ab%e9%a3%8e%e9%99%a9" class="header-mark"></a>1.2 å›¾æ•°æ®åº“æŸ¥è¯¢è¯†åˆ«é£é™©</h3><p>æœ‰äº†ä¸€å¼ å›Šæ‹¬äº†äººã€å…¬å¸ã€å†å²è´·æ¬¾ç”³è¯·è®°å½•ã€ç”µè¯ã€çº¿ä¸Šç”³è¯·ç½‘ç»œè®¾å¤‡çš„å›¾è°±ï¼Œæˆ‘ä»¬å¯ä»¥æŒ–æ˜ä¸€äº›æœ‰æ„æ€çš„ä¿¡æ¯ã€‚</p>
<p>äº‹å®ä¸Šï¼Œå¾ˆå¤šå€¼å¾—è¢«å‘ç°ã€å¹¶æœ‰æ•ˆé˜»æ­¢ä»è€Œæ­¢æŸçš„éª—ä¿è¡Œä¸ºæ˜¯å…·æœ‰ç¾¤ä½“èšé›†æ€§çš„ã€‚æ¯”å¦‚æ¬ºè¯ˆå›¢ä¼™å¯èƒ½æ˜¯ä¸€å°æ‰¹äººï¼ˆæ¯”å¦‚3åˆ°5äººï¼‰æœ‰ç»„ç»‡åœ°æ”¶é›†æ›´å¤§è§„æ¨¡çš„èº«ä»½è¯ä¿¡æ¯ï¼ˆæ¯”å¦‚30å¼ ï¼‰ï¼ŒåŒæ—¶å‘èµ·å¤šä¸ªé‡‘èæœºæ„å¤§é‡è´·æ¬¾ï¼Œç„¶ååœ¨æ”¾æ¬¾åé€‰æ‹©ä¸¢å¼ƒè¿™æ‰¹ç•™ä¸‹äº†è¿çº¦è®°å½•çš„èº«ä»½è¯ï¼Œå†è¿›ä¸€æ­¥é€‰æ‹©ä¸‹ä¸€æ‰¹èº«ä»½è¯ä¿¡æ¯å¦‚æ³•ç‚®åˆ¶ã€‚</p>
<p>è¿™ç§å›¢ä¼™ä½œæ¡ˆçš„æ–¹å¼å› ä¸ºåˆ©ç”¨äº†å¤§é‡æ–°çš„èº«ä»½ä¿¡æ¯ï¼Œå®Œå…¨åˆ©ç”¨å†å²è®°å½•å»é»‘åå•è§„é¿é£é™©çš„æ–¹å¼æ˜¯æ— æ•ˆçš„ã€‚ä¸è¿‡ï¼Œå€ŸåŠ©äºå…³è”å…³ç³»çš„è§†è§’ï¼Œè¿™äº›æ¨¡å¼æ˜¯ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥è¢«åŠæ—¶è¯†åˆ«å‡ºæ¥çš„ã€‚</p>
<p>è¿™äº›è§„å¯ä»¥è¢«è¯†åˆ«å‡ºçš„è§„å¾‹æˆ‘æŠŠå®ƒåˆ†æˆä¸¤ç§ï¼š</p>
<p>ä¸€ç§æ˜¯é£æ§ä¸“å®¶å¯ä»¥ç›´æ¥ç”¨æŸç§æ¨¡å¼æ¥æè¿°çš„ï¼Œä¾‹å¦‚ï¼šå’Œå·²ç»è¢«æ ‡æ³¨ä¸ºé«˜é£é™©çš„å®ä½“æœ‰ç›´æ¥æˆ–è€…é—´æ¥çš„å…³è”å…³ç³»ï¼ˆæ–°è®¢å•ç”³è¯·äººä½¿ç”¨äº†å’Œè¿‡å¾€é«˜é£é™©è®°å½•ç›¸åŒçš„ç½‘ç»œè®¾å¤‡ï¼‰ï¼Œè¿™ç§æ¨¡å¼å¯¹åº”åˆ°å›¾è°±ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªå›¾æŸ¥è¯¢å°±å¯ä»¥å®æ—¶ç»™å‡ºç»“æœã€‚</p>
<p>å¦ä¸€ç§æ˜¯éšå«åœ¨æ•°æ®çš„å…³è”å…³ç³»èƒŒåï¼Œéœ€è¦é€šè¿‡å›¾ç®—æ³•æŒ–æ˜å¾—å‡ºçš„ä¸€äº›é£é™©æç¤ºï¼Œä¾‹å¦‚ï¼šå°½ç®¡ç»™å®šçš„å®ä½“ä¸æœ‰é™çš„æ ‡æ³¨é«˜é£é™©å®ä½“æ²¡æœ‰åŒ¹é…çš„å…³è”ï¼Œä½†æ˜¯å®ƒåœ¨å›¾ä¸­å½¢æˆäº†èšé›†æ€§å¯èƒ½æç¤ºæˆ‘ä»¬è¿™å¯èƒ½æ˜¯ä¸€ä¸ªå°šæœªå¾—æ‰‹çš„è¿›è¡Œä¸­çš„å›¢ä¼™è´·æ¬¾è¯ˆéª—çš„å…¶ä¸­ä¸€æ¬¡ç”³è¯·ï¼Œè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡å®šæœŸåœ¨å†å²æ•°æ®ä¸­æ‰¹é‡æ‰§è¡Œç¤¾åŒºå‘ç°ç®—æ³•å¾—å‡ºï¼Œå¹¶åœ¨é«˜èšé›†ç¤¾åŒºä¸­åˆ©ç”¨ä¸­å¿ƒæ€§ç®—æ³•ç»™å‡ºæ ¸å¿ƒå®ä½“ï¼Œä¸€å¹¶æç¤ºç»™é£é™©ä¸“å®¶è¿›è¡Œåç»­è¯„ä¼°å’Œé£é™©æ ‡æ³¨ã€‚</p>
<h4 id="åŸºäºå›¾è°±ä¸ä¸“å®¶å›¾æ¨¡å¼åŒ¹é…çš„æ¬ºè¯ˆæ£€æµ‹ç¤ºä¾‹" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%9b%be%e8%b0%b1%e4%b8%8e%e4%b8%93%e5%ae%b6%e5%9b%be%e6%a8%a1%e5%bc%8f%e5%8c%b9%e9%85%8d%e7%9a%84%e6%ac%ba%e8%af%88%e6%a3%80%e6%b5%8b%e7%a4%ba%e4%be%8b" class="header-mark"></a>1.2.1 åŸºäºå›¾è°±ä¸ä¸“å®¶å›¾æ¨¡å¼åŒ¹é…çš„æ¬ºè¯ˆæ£€æµ‹ç¤ºä¾‹</h4><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬åˆ©ç”¨ Nebula-UP æ¥ä¸€é”®éƒ¨ç½²ä¸€å¥— NebulaGraph å›¾æ•°æ®åº“ï¼š</p>
<blockquote>
<p>æ›´å¤šè¯·å‚è€ƒ <a href="https://github.com/wey-gu/nebula-up/" target="_blank" rel="noopener noreffer">https://github.com/wey-gu/nebula-up/</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -fsSL nebula-up.siwei.io/install.sh <span class="p">|</span> bash
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠå‰è¾¹å»ºæ¨¡çš„å›¾è°±åŠ è½½åˆ° NebulaGraph é‡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># å…‹éš†æ•°æ®é›†ä»£ç ä»“åº“</span>
</span></span><span class="line"><span class="cl">git clone https://github.com/wey-gu/fraud-detection-datagen.git
</span></span><span class="line"><span class="cl">cp -r data_sample_numerical_vertex_id data
</span></span><span class="line"><span class="cl"><span class="c1"># å»æ‰è¡¨å¤´</span>
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;1d&#39;</span> data/*.csv
</span></span><span class="line"><span class="cl">docker run --rm -ti <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --network<span class="o">=</span>nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>:/root/ <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/data/:/data <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    vesoft/nebula-importer:v3.1.0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --config /root/nebula_graph_importer.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº†è¿™æ ·ä¸€ä¸ªå›¾è°±ï¼Œé£æ§ä¸“å®¶å¯ä»¥åœ¨å¯è§†åŒ–æ¢ç´¢å·¥å…·ä¸­æŒ‰éœ€æ¢ç´¢å®ä½“ä¹‹é—´çš„å…³ç³»ï¼Œç»˜åˆ¶ç›¸åº”çš„é£é™©æ¨¡å¼ï¼š</p>
<p></p>
<p>åœ¨è¿™ä¸ªæ¢ç´¢æˆªå›¾é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ˜æ˜¾çœ‹åˆ°ä¸€ä¸ªç¾¤æ§è®¾å¤‡çš„é£é™©æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼å¯ä»¥è¢«äº¤ç»™å›¾æ•°æ®åº“å¼€å‘è€…ï¼ŒæŠ½è±¡æˆå¯ä»¥è¢«é£æ§åº”ç”¨å®šæœŸã€å®æ—¶æŸ¥è¯¢çš„è¯­å¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GRAPHQL" data-lang="GRAPHQL"><span class="line"><span class="cl"><span class="c">## é’ˆå¯¹ä¸€ç¬”äº¤æ˜“ç”³è¯·å…³è”æŸ¥è¯¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">n</span><span class="p">)</span><span class="w"> </span><span class="py">WHERE</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">n</span><span class="p">)</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&#34;200000010265&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">OPTIONAL</span><span class="w"> </span><span class="py">MATCH</span><span class="w"> </span><span class="py">p_shared_d</span><span class="p">=(</span><span class="py">n</span><span class="p">)</span><span class="err">-</span><span class="p">[:</span><span class="nc">used_device</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">d</span><span class="p">)</span><span class="err">&lt;-</span><span class="p">[:</span><span class="nc">used_device</span><span class="p">]</span><span class="err">-</span><span class="p">(:</span><span class="nc">applicant</span><span class="p">)</span><span class="err">-</span><span class="p">[:</span><span class="nc">with_phone_num</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">pn</span><span class="p">:</span><span class="nc">phone_num</span><span class="p">)</span><span class="err">&lt;-</span><span class="p">[</span><span class="py">e</span><span class="p">:</span><span class="nc">with_phone_num</span><span class="p">]</span><span class="err">-</span><span class="p">(:</span><span class="nc">applicant</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">RETURN</span><span class="w"> </span><span class="py">p_shared_d</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ¨æ­¤æ¨¡å‹ä¹‹ä¸Šï¼Œé€šè¿‡ä¿®æ”¹è¿”å›çš„å…³è”è®¾å¤‡è®¡æ•°ï¼Œä½œä¸ºæ„å‘æŒ‡æ ‡æŸ¥è¯¢çš„åˆ¤æ–­ APIï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-graphql" data-lang="graphql"><span class="line"><span class="cl"><span class="c">## ç¾¤æ§æŒ‡æ ‡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">n</span><span class="p">)</span><span class="w"> </span><span class="py">WHERE</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">n</span><span class="p">)</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&#34;200000010265&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">OPTIONAL</span><span class="w"> </span><span class="py">MATCH</span><span class="w"> </span><span class="py">p_shared_d</span><span class="p">=(</span><span class="py">n</span><span class="p">)</span><span class="err">-</span><span class="p">[:</span><span class="nc">used_device</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">d</span><span class="p">)</span><span class="err">&lt;-</span><span class="p">[:</span><span class="nc">used_device</span><span class="p">]</span><span class="err">-</span><span class="p">(:</span><span class="nc">applicant</span><span class="p">)</span><span class="err">-</span><span class="p">[:</span><span class="nc">with_phone_num</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">pn</span><span class="p">:</span><span class="nc">phone_num</span><span class="p">)</span><span class="err">&lt;-</span><span class="p">[</span><span class="py">e</span><span class="p">:</span><span class="nc">with_phone_num</span><span class="p">]</span><span class="err">-</span><span class="p">(:</span><span class="nc">applicant</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">RETURN</span><span class="w"> </span><span class="py">count</span><span class="p">(</span><span class="py">e</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªç›¸å¯¹æœ‰æ•ˆçš„é£æ§ç³»ç»Ÿï¼Œåˆ©ç”¨æœ‰é™çš„æ ‡æ³¨æ•°æ®å’Œä¸“å®¶èµ„æºï¼Œå»æ›´é«˜æ•ˆæ§åˆ¶å›¢ä¼™æ¬ºè¯ˆä½œæ¡ˆé£é™©ï¼Œç„¶è€Œï¼Œåœ¨ç°å®æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„å¤§å¤šæ•°æ ‡æ³¨æ•°æ®çš„è·å–è¿˜æ˜¯è¿‡äºæ˜‚è´µï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•æ˜¯æ›´æœ‰æ•ˆåˆ©ç”¨æœ‰é™çš„é£é™©æ ‡æ³¨å’Œå›¾ç»“æ„ï¼Œæ¥é¢„æµ‹å‡ºé£é™©å‘¢ï¼Ÿ</p>
<h3 id="åˆ©ç”¨å›¾æ‰©å……æ ‡æ³¨" class="headerLink">
    <a href="#%e5%88%a9%e7%94%a8%e5%9b%be%e6%89%a9%e5%85%85%e6%a0%87%e6%b3%a8" class="header-mark"></a>1.3 åˆ©ç”¨å›¾æ‰©å……æ ‡æ³¨</h3><p>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œ Xiaojin Z. å’Œ Zoubin G. åœ¨è®ºæ–‡ï¼š<a href="http://mlg.eng.cam.ac.uk/zoubin/papers/CMU-CALD-02-107.pdf" target="_blank" rel="noopener noreffer">Learning from Labeled and Unlabeled Data with Label Propagation</a> ï¼ˆCMU-CALD-02-107ï¼‰ä¸­ï¼Œåˆ©ç”¨æ ‡ç­¾ä¼ æ’­ï¼ˆLabel Propagationï¼‰ç®—æ³•æ¥æŠŠæœ‰é™çš„æ ‡æ³¨ä¿¡æ¯åœ¨å›¾ä¸Šé€šè¿‡å…³è”å…³ç³»ä¼ æ’­åˆ°æ›´å¤šå®ä½“ä¸­ã€‚</p>
<p>è¿™æ ·ï¼Œåœ¨æˆ‘ä»¬å»ºç«‹çš„å›¾è°±ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å€ŸåŠ©æœ‰é™çš„é«˜é£é™©æ ‡æ³¨ï¼Œå»â€œä¼ æ’­â€äº§ç”Ÿæ›´å¤šçš„æ ‡æ³¨ä¿¡æ¯ã€‚è¿™äº›æ‰©å±•å‡ºæ¥çš„æ ‡æ³¨ä¿¡æ¯ä¸€æ–¹é¢å¯ä»¥åœ¨å®æ—¶çš„å›¾æŸ¥è¯¢ä¸­ç»™å‡ºæ›´å¤šçš„ç»“æœï¼Œå¦ä¸€æ–¹é¢ï¼Œå®ƒè¿˜èƒ½ä½œä¸ºé£æ§ä¸“å®¶é‡è¦çš„è¾“å…¥ä¿¡æ¯ï¼Œå¸®åŠ©æ¨è¿›åæ¬ºè¯ˆè°ƒæŸ¥è¡ŒåŠ¨çš„å¼€å±•ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®šæœŸç¦»çº¿åœ°å…¨å›¾æ‰«ææ•°æ®ï¼Œé€šè¿‡å›¾ç®—æ³•æ‰©å……ã€æ›´æ–°æ ‡æ³¨ï¼Œå†å°†æœ‰æ•ˆçš„æ›´æ–°æ ‡æ³¨å†™å›åˆ°å›¾è°±ä¹‹ä¸­ã€‚</p>
<h4 id="å›¾ç®—æ³•æ‰©å……æ¬ºè¯ˆé£é™©æ ‡æ³¨çš„ç¤ºä¾‹" class="headerLink">
    <a href="#%e5%9b%be%e7%ae%97%e6%b3%95%e6%89%a9%e5%85%85%e6%ac%ba%e8%af%88%e9%a3%8e%e9%99%a9%e6%a0%87%e6%b3%a8%e7%9a%84%e7%a4%ba%e4%be%8b" class="header-mark"></a>1.3.1 å›¾ç®—æ³•æ‰©å……æ¬ºè¯ˆé£é™©æ ‡æ³¨çš„ç¤ºä¾‹</h4><p>ä¸‹é¢ï¼Œæˆ‘ç»™å‡ºä¸€ä¸ªå¯ä»¥è·‘é€šçš„æ¡ˆä¾‹ï¼š</p>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ç”¨åˆ°äº† Yelp è¿™ä¸ªæ¬ºè¯ˆè¯†åˆ«çš„ç»å…¸æ•°æ®ï¼Œè¿™ä»½æ•°æ®ä¸åªä¼šç”¨åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåè¾¹ GNN æ–¹æ³•ä¸­çš„æ¡ˆä¾‹æˆ‘ä¹Ÿä¼šç”¨åˆ°å®ƒï¼Œæ‰€ä»¥å¤§å®¶å¯ä»¥è€å¿ƒæŠŠæ•°æ®å¯¼å…¥ NebulaGraphã€‚</p>
<p>å¯¼å…¥æ•°æ®åˆ°å›¾åº“</p>
<blockquote>
<p>ç”Ÿæˆå¯¼å…¥çš„æ–¹æ³•åœ¨è¿™é‡Œï¼Œhttps://github.com/wey-gu/nebulagraph-yelp-frauddetection</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ~
</span></span><span class="line"><span class="cl">git clone https://github.com/wey-gu/nebulagraph-yelp-frauddetection
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> nebulagraph-yelp-frauddetection
</span></span><span class="line"><span class="cl">python3 -m pip install -r requirements.txt
</span></span><span class="line"><span class="cl">python3 data_download.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯¼å…¥å›¾åº“</span>
</span></span><span class="line"><span class="cl">docker run --rm -ti <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --network<span class="o">=</span>nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/yelp_nebulagraph_importer.yaml:/root/importer.yaml <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/data:/root <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    vesoft/nebula-importer:v3.1.0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --config /root/importer.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æŸä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹å›¾ä¸Šçš„ç»Ÿè®¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">~/.nebula-up/console.sh -e <span class="s2">&#34;USE yelp; SHOW STATS&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>root@nebula<span class="o">)</span> <span class="o">[(</span>none<span class="o">)]</span>&gt; USE yelp<span class="p">;</span> SHOW STATS
</span></span><span class="line"><span class="cl">+---------+---------------------------------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Type    <span class="p">|</span> Name                                  <span class="p">|</span> Count   <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------+---------------------------------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Tag&#34;</span>   <span class="p">|</span> <span class="s2">&#34;review&#34;</span>                              <span class="p">|</span> <span class="m">45954</span>   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Edge&#34;</span>  <span class="p">|</span> <span class="s2">&#34;shares_restaurant_in_one_month_with&#34;</span> <span class="p">|</span> <span class="m">1147232</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Edge&#34;</span>  <span class="p">|</span> <span class="s2">&#34;shares_restaurant_rating_with&#34;</span>       <span class="p">|</span> <span class="m">6805486</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Edge&#34;</span>  <span class="p">|</span> <span class="s2">&#34;shares_user_with&#34;</span>                    <span class="p">|</span> <span class="m">98630</span>   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Space&#34;</span> <span class="p">|</span> <span class="s2">&#34;vertices&#34;</span>                            <span class="p">|</span> <span class="m">45954</span>   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Space&#34;</span> <span class="p">|</span> <span class="s2">&#34;edges&#34;</span>                               <span class="p">|</span> <span class="m">8051348</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------+---------------------------------------+---------+
</span></span><span class="line"><span class="cl">Got <span class="m">6</span> rows <span class="o">(</span><span class="nb">time</span> spent 1911/4488 us<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›®å‰ï¼Œå¸‚é¢ä¸Šçš„ LPA æ ‡ç­¾ä¼ æ’­ç®—æ³•éƒ½æ˜¯ç”¨æ¥åšç¤¾åŒºæ£€æµ‹çš„ï¼Œå¾ˆå°‘æœ‰å®ç°æ˜¯ç”¨æ¥åšæ ‡ç­¾æ‹“å±•çš„ï¼ˆåªæœ‰ SK-Learn ä¸­æœ‰è¿™ä¸ªå®ç°ï¼‰ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬å‚è€ƒ <a href="https://datascience.stackexchange.com/users/77683/thibaud-m" target="_blank" rel="noopener noreffer">Thibaud M</a> ç»™å‡ºæ¥çš„å®ç°ã€‚</p>
<blockquote>
<p>åŸå§‹çš„è®¨è®ºå‚è€ƒï¼šhttps://datascience.stackexchange.com/a/55720/138720</p>
</blockquote>
<p>ä¸ºäº†è®©è¿™ä¸ªç®—æ³•è·‘çš„å¿«ä¸€ç‚¹ï¼Œä¼šä» NebulaGraph é‡Œå–ä¸€ä¸ªç‚¹çš„å­å›¾ï¼Œåœ¨è¿™ä¸ªå°çš„å­å›¾ä¸Šåšæ ‡æ³¨çš„æ‰©å……ï¼š</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª Jupyter çš„ Playgroundï¼Œ</p>
<blockquote>
<p>å‚è€ƒ <a href="https://github.com/wey-gu/nebula-dgl" target="_blank" rel="noopener noreffer">https://github.com/wey-gu/nebula-dgl</a> ä¸­çš„ Playground è¿‡ç¨‹ï¼š</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/wey-gu/nebula-dgl.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> nebula-dgl
</span></span><span class="line"><span class="cl"><span class="c1"># è¿è¡Œ Jupyter Notebook</span>
</span></span><span class="line"><span class="cl">docker run -it --name dgl -p 8888:8888 --network nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="s2">&#34;</span><span class="nv">$PWD</span><span class="s2">&#34;</span>:/home/jovyan/work jupyter/datascience-notebook <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    start-notebook.sh --NotebookApp.token<span class="o">=</span><span class="s1">&#39;nebulagraph&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®¿é—®ï¼šhttp://localhost:8888/lab/tree/work?token=nebulagraph</p>
<p>å®‰è£…ä¾èµ–ï¼ˆè¿™äº›ä¾èµ–åœ¨åè¾¹çš„ GNN ä¾‹å­ä¸­ä¹Ÿä¼šè¢«ç”¨åˆ°ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">!</span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">vesoft</span><span class="o">-</span><span class="n">inc</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">python</span><span class="o">.</span><span class="n">git</span><span class="o">@</span><span class="mi">8</span><span class="n">c328c534413b04ccecfd42e64ce6491e09c6ca8</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬ä»å›¾ä¸­è¯»å–ä¸€ä¸ªå­å›¾ï¼Œä» <code>2048</code> è¿™ä¸ªç‚¹å¼€å§‹æ¢ç´¢ä¸¤æ­¥å†…çš„æ‰€æœ‰è¾¹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">tensor</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dgl</span> <span class="kn">import</span> <span class="n">DGLHeteroGraph</span><span class="p">,</span> <span class="n">heterograph</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula3.gclient.net</span> <span class="kn">import</span> <span class="n">ConnectionPool</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula3.Config</span> <span class="kn">import</span> <span class="n">Config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">config</span><span class="o">.</span><span class="n">max_connection_pool_size</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">ConnectionPool</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">connection_pool</span><span class="o">.</span><span class="n">init</span><span class="p">([(</span><span class="s1">&#39;graphd&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">)],</span> <span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">vertex_id</span> <span class="o">=</span> <span class="mi">2048</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;nebula&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">execute_json</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;USE yelp;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="sa">f</span><span class="s2">&#34;GET SUBGRAPH WITH PROP 2 STEPS FROM </span><span class="si">{</span><span class="n">vertex_id</span><span class="si">}</span><span class="s2"> YIELD VERTICES AS nodes, EDGES AS relationships;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># create node and nodedata</span>
</span></span><span class="line"><span class="cl"><span class="n">node_id_map</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key: vertex id in NebulaGraph, value: node id in dgl_graph</span>
</span></span><span class="line"><span class="cl"><span class="n">node_idx</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">features</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[[]]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="n">nodeid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">nodeid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_id_map</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">node_id_map</span><span class="p">[</span><span class="n">nodeid</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_idx</span>
</span></span><span class="line"><span class="cl">            <span class="n">node_idx</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">features</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;row&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="sa">f</span><span class="s2">&#34;review.f</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">features</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;row&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;review.is_fraud&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rur_start</span><span class="p">,</span> <span class="n">rur_end</span><span class="p">,</span> <span class="n">rsr_start</span><span class="p">,</span> <span class="n">rsr_end</span><span class="p">,</span> <span class="n">rtr_start</span><span class="p">,</span> <span class="n">rtr_end</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="n">edge</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shares_user_with&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rur_start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">            <span class="n">rur_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rsr_start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">            <span class="n">rsr_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rtr_start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">            <span class="n">rtr_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">rur_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_dict</span><span class="p">[(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="s1">&#39;shares_user_with&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rur_start</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rur_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">rsr_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_dict</span><span class="p">[(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rsr_start</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rsr_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">rtr_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_dict</span><span class="p">[(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rtr_start</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rtr_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># construct a dgl_graph, ref: https://docs.dgl.ai/en/0.9.x/generated/dgl.heterograph.html</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="p">:</span> <span class="n">DGLHeteroGraph</span> <span class="o">=</span> <span class="n">heterograph</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># load node features to dgl_graph</span>
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="mi">32</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># heterogeneous graph to heterogeneous graph, keep ndata and edata</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">dgl</span>
</span></span><span class="line"><span class="cl"><span class="n">hg</span> <span class="o">=</span> <span class="n">dgl</span><span class="o">.</span><span class="n">to_homogeneous</span><span class="p">(</span><span class="n">dgl_graph</span><span class="p">,</span> <span class="n">ndata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬ç”¨ä¸Šè¾¹æåˆ°çš„ Torch Label Spreading å®ç°ï¼Œåº”ç”¨åˆ°æˆ‘ä»¬çš„å›¾ä¸Šã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseLabelPropagation</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Base class for label propagation models.
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    adj_matrix: torch.FloatTensor
</span></span></span><span class="line"><span class="cl"><span class="s2">        Adjacency matrix of the graph.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adj_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">norm_adj_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="n">adj_matrix</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span> <span class="o">=</span> <span class="kc">None</span> 
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">labeled_mask</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@staticmethod</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@abstractmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_normalize</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&#34;_normalize must be implemented&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@abstractmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_propagate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&#34;_propagate must be implemented&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_one_hot_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Get the number of classes</span>
</span></span><span class="line"><span class="cl">        <span class="n">classes</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">classes</span> <span class="o">=</span> <span class="n">classes</span><span class="p">[</span><span class="n">classes</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span> <span class="o">=</span> <span class="n">classes</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># One-hot encode labeled data instances and zero rows corresponding to unlabeled instances</span>
</span></span><span class="line"><span class="cl">        <span class="n">unlabeled_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>  <span class="c1"># defensive copying</span>
</span></span><span class="line"><span class="cl">        <span class="n">labels</span><span class="p">[</span><span class="n">unlabeled_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">labels</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span><span class="p">[</span><span class="n">unlabeled_mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">labeled_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">unlabeled_mask</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span> <span class="n">tol</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Fits a semi-supervised learning label propagation model.
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">        labels: torch.LongTensor
</span></span></span><span class="line"><span class="cl"><span class="s2">            Tensor of size n_nodes indicating the class number of each node.
</span></span></span><span class="line"><span class="cl"><span class="s2">            Unlabeled nodes are denoted with -1.
</span></span></span><span class="line"><span class="cl"><span class="s2">        max_iter: int
</span></span></span><span class="line"><span class="cl"><span class="s2">            Maximum number of iterations allowed.
</span></span></span><span class="line"><span class="cl"><span class="s2">        tol: float
</span></span></span><span class="line"><span class="cl"><span class="s2">            Convergence tolerance: threshold to consider the system at steady state.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_one_hot_encode</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">prev_predictions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Stop iterations if the system is considered at a steady state</span>
</span></span><span class="line"><span class="cl">            <span class="n">variation</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span> <span class="o">-</span> <span class="n">prev_predictions</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">variation</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;The method stopped after </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> iterations, variation=</span><span class="si">{</span><span class="n">variation</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">prev_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_propagate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">predict_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">indices</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LabelPropagation</span><span class="p">(</span><span class="n">BaseLabelPropagation</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adj_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@staticmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_normalize</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Computes D^-1 * W&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">degs</span> <span class="o">=</span> <span class="n">adj_matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">degs</span><span class="p">[</span><span class="n">degs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># avoid division by 0 error</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">adj_matrix</span> <span class="o">/</span> <span class="n">degs</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_propagate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm_adj_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Put back already known labels</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_mask</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_mask</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LabelSpreading</span><span class="p">(</span><span class="n">BaseLabelPropagation</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adj_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@staticmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_normalize</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Computes D^-1/2 * W * D^-1/2&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">degs</span> <span class="o">=</span> <span class="n">adj_matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">norm</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">degs</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">norm</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">norm</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">adj_matrix</span> <span class="o">*</span> <span class="n">norm</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">norm</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_propagate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm_adj_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">        ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">        alpha: float
</span></span></span><span class="line"><span class="cl"><span class="s2">            Clamping factor.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">nx_hg</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">to_networkx</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">adj_matrix</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">adjacency_matrix</span><span class="p">(</span><span class="n">nx_hg</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">labels</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Create input tensors</span>
</span></span><span class="line"><span class="cl"><span class="n">adj_matrix_t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">labels_t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Learn with Label Propagation</span>
</span></span><span class="line"><span class="cl"><span class="n">label_propagation</span> <span class="o">=</span> <span class="n">LabelPropagation</span><span class="p">(</span><span class="n">adj_matrix_t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Label Propagation: &#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">label_propagation</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">labels_t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">label_propagation_output_labels</span> <span class="o">=</span> <span class="n">label_propagation</span><span class="o">.</span><span class="n">predict_classes</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Learn with Label Spreading</span>
</span></span><span class="line"><span class="cl"><span class="n">label_spreading</span> <span class="o">=</span> <span class="n">LabelSpreading</span><span class="p">(</span><span class="n">adj_matrix_t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Label Spreading: &#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">label_spreading</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">labels_t</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">label_spreading_output_labels</span> <span class="o">=</span> <span class="n">label_spreading</span><span class="o">.</span><span class="n">predict_classes</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨å’±ä»¬çœ‹çœ‹æŸ“è‰²çš„ä¼ æ’­æ•ˆæœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">color_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&#34;blue&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&#34;green&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">input_labels_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_map</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">lprop_labels_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_map</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">label_propagation_output_labels</span><span class="o">.</span><span class="n">numpy</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl"><span class="n">lspread_labels_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_map</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">label_spreading_output_labels</span><span class="o">.</span><span class="n">numpy</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&#34;Raw data (2 classes)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&#34;Label Propagation&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&#34;Label Spreading&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">nx_hg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">nx_hg</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">input_labels_colors</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">nx_hg</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">lprop_labels_colors</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">nx_hg</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">lspread_labels_colors</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Legend</span>
</span></span><span class="line"><span class="cl"><span class="n">ax4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&#34;off&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">legend_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;orange&#34;</span><span class="p">,</span> <span class="s2">&#34;blue&#34;</span><span class="p">,</span> <span class="s2">&#34;green&#34;</span><span class="p">,</span> <span class="s2">&#34;red&#34;</span><span class="p">,</span> <span class="s2">&#34;cyan&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">legend_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;unlabeled&#34;</span><span class="p">,</span> <span class="s2">&#34;class 0&#34;</span><span class="p">,</span> <span class="s2">&#34;class 1&#34;</span><span class="p">,</span> <span class="s2">&#34;class 2&#34;</span><span class="p">,</span> <span class="s2">&#34;class 3&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">dummy_legend</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">legend_colors</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">dummy_legend</span><span class="p">,</span> <span class="n">legend_labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°æœ€åç”»å‡ºæ¥çš„ç»“æœï¼š</p>
<p></p>
<p>å¯ä»¥çœ‹åˆ°æœ‰ä¸€äº›è“è‰²æ ‡ç­¾è¢« Spread å¼€äº†ï¼Œå®é™…ä¸Šæˆ‘çš„è¿™ä¸ªä¾‹å­çš„æ•ˆæœå¹¶ä¸ç†æƒ³ï¼ˆå› ä¸ºè¿™ä¸ªä¾‹å­æï¼Œç»¿è‰²çš„æ‰æ˜¯é‡è¦çš„æ ‡ç­¾ï¼‰ï¼Œä¸è¿‡æˆ‘ç»™çš„å­å›¾å®åœ¨æ˜¯å¤ªå°äº†ï¼Œä¹Ÿæœ¬ä¸åº”è¯¥å¥¢æ±‚æœ‰å¥½çš„ç»“æœï¼Œåªæ˜¯ä¸ºäº†ä¸ªå¤§å®¶æ¼”ç¤ºä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚</p>
<h3 id="å¸¦æœ‰å›¾ç‰¹å¾çš„æœºå™¨å­¦ä¹ " class="headerLink">
    <a href="#%e5%b8%a6%e6%9c%89%e5%9b%be%e7%89%b9%e5%be%81%e7%9a%84%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0" class="header-mark"></a>1.4 å¸¦æœ‰å›¾ç‰¹å¾çš„æœºå™¨å­¦ä¹ </h3><p>åœ¨é£æ§é¢†åŸŸå¼€å§‹åˆ©ç”¨å›¾çš„æ€æƒ³å’Œèƒ½åŠ›ä¹‹å‰ï¼Œå·²ç»æœ‰å¾ˆå¤šåˆ©ç”¨æœºå™¨å­¦ä¹ çš„åˆ†ç±»ç®—æ³•åŸºäºå†å²æ•°æ®é¢„æµ‹é«˜é£é™©è¡Œä¸ºçš„æ–¹æ³•äº†ï¼Œè¿™äº›æ–¹æ³•æŠŠè®°å½•ä¸­é¢†åŸŸä¸“å®¶è®¤ä¸ºæœ‰å…³çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼šå¹´é¾„ã€å­¦å†ã€æ”¶å…¥ï¼‰ä½œä¸ºç‰¹å¾ï¼Œå†å²æ ‡æ³¨ä¿¡æ¯ä½œä¸ºæ ‡ç­¾å»è®­ç»ƒé£é™©é¢„æµ‹æ¨¡å‹ã€‚</p>
<p>é‚£ä¹ˆè¯»åˆ°çš„è¿™é‡Œï¼Œæˆ‘ä»¬æ˜¯å¦ä¼šæƒ³åˆ°åœ¨è¿™äº›æ–¹æ³•çš„åŸºç¡€ä¹‹ä¸Šï¼Œå¦‚æœæŠŠåŸºäºå›¾ç»“æ„çš„å±æ€§ä¹Ÿè€ƒè™‘è¿›æ¥ï¼Œä½œä¸ºç‰¹å¾å»è®­ç»ƒçš„æ¨¡å‹å¯èƒ½æ›´æœ‰æ•ˆå‘¢ï¼Ÿç­”æ¡ˆä¹Ÿæ˜¯è‚¯å®šçš„ï¼Œå·²ç»æœ‰å¾ˆå¤šè®ºæ–‡å’Œå·¥ç¨‹å®è·µæ­ç¤ºè¿™æ ·çš„æ¨¡å‹æ¯”æœªè€ƒè™‘å›¾ç‰¹å¾çš„ç®—æ³•æ›´åŠ æœ‰æ•ˆï¼šè¿™äº›è¢«å°è¯•æœ‰æ•ˆçš„å›¾ç»“æ„ç‰¹å¾å¯èƒ½æ˜¯å®ä½“çš„ PageRank å€¼ã€Degree å€¼æˆ–è€…æ˜¯æŸä¸€ä¸ªç¤¾åŒºå‘ç°ç®—æ³•å¾—å‡ºçš„ç¤¾åŒº idã€‚</p>
<p>åœ¨ç”Ÿäº§ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å®šæœŸä»å›¾è°±ä¸­è·å¾—å®æ—¶çš„å…¨å›¾ä¿¡æ¯ï¼Œåœ¨å›¾è®¡ç®—å¹³å°ä¸­åˆ†æè¿ç®—è·å¾—æ‰€éœ€ç‰¹å¾ï¼Œç»è¿‡é¢„å®šçš„æ•°æ®ç®¡é“ï¼Œå¯¼å…¥æœºå™¨å­¦ä¹ æ¨¡å‹ä¸­å‘¨æœŸè·å¾—æ–°çš„é£é™©æç¤ºï¼Œå¹¶å°†éƒ¨åˆ†ç»“æœå†™å›å›¾è°±æ–¹ä¾¿å…¶ä»–ç³»ç»Ÿå’Œä¸“å®¶æŠ½å–ã€å‚è€ƒã€‚</p>
<h4 id="å¸¦æœ‰å›¾ç‰¹å¾çš„æœºå™¨å­¦ä¹ æ¬ºè¯ˆæ£€æµ‹ç¤ºä¾‹" class="headerLink">
    <a href="#%e5%b8%a6%e6%9c%89%e5%9b%be%e7%89%b9%e5%be%81%e7%9a%84%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e6%ac%ba%e8%af%88%e6%a3%80%e6%b5%8b%e7%a4%ba%e4%be%8b" class="header-mark"></a>1.4.1 å¸¦æœ‰å›¾ç‰¹å¾çš„æœºå™¨å­¦ä¹ æ¬ºè¯ˆæ£€æµ‹ç¤ºä¾‹</h4><p>è¿™é‡Œï¼Œæœºå™¨å­¦ä¹ çš„æ–¹æ³•æˆ‘å°±ä¸æ¼”ç¤ºäº†ï¼Œå°±æ˜¯å¸¸è§çš„åˆ†ç±»æ–¹æ³•ï¼Œåœ¨æ­¤ä¹‹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®ä¸­é€šè¿‡å›¾ç®—æ³•è·å¾—ä¸€äº›æ–°çš„å±æ€§ï¼Œè¿™äº›å±æ€§å†å¤„ç†ä¸€ä¸‹ä½œä¸ºæ–°çš„ç‰¹å¾ã€‚æˆ‘åªæ¼”ç¤ºä¸€ä¸ªç¤¾åŒºå‘ç°çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¨å›¾è·‘ä¸€ä¸ª Louvainï¼Œå¾—å‡ºä¸åŒèŠ‚ç‚¹çš„ç¤¾åŒºå½’å±ï¼Œç„¶åæŠŠç¤¾åŒºçš„å€¼å½“åšä¸€ä¸ªåˆ†ç±»å¤„ç†æˆä¸ºæ•°å€¼çš„ç‰¹å¾ã€‚</p>
<p>è¿™ä¸ªä¾‹å­é‡Œæˆ‘ä»¬è¿˜ç”¨ <a href="https://github.com/wey-gu/fraud-detection-datagen" target="_blank" rel="noopener noreffer">https://github.com/wey-gu/fraud-detection-datagen</a> è¿™ä¸ªæ•°æ®ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¿™ä¸ªä¾‹å­æˆ‘ç”¨åˆ°äº† <a href="https://github.com/vesoft-inc/nebula-algorithm/" target="_blank" rel="noopener noreffer">Nebula-Algorithm</a> è¿™ä¸ªé¡¹ç›®ï¼Œå®ƒæ˜¯ä¸€ä¸ª Spark åº”ç”¨ï¼Œå¯ä»¥åœ¨ NebulaGraph å›¾åº“ä¸Šè¿è¡Œå¾ˆå¤šå¸¸ç”¨çš„å›¾ç®—æ³•ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éƒ¨ç½² Spark å’Œ Nebula Algorithmï¼Œè¿˜æ˜¯åˆ©ç”¨ Nebula-UPï¼Œä¸€é”®éƒ¨ç½²ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -fsSL nebula-up.siwei.io/all-in-one.sh <span class="p">|</span> bash -s -- v3 spark
</span></span></code></pre></td></tr></table>
</div>
</div><p>é›†ç¾¤èµ·æ¥ä¹‹åï¼Œå› ä¸ºéœ€è¦çš„é…ç½®æ–‡ä»¶æˆ‘å·²ç»æ”¾åœ¨äº† Nebula-UP å†…éƒ¨ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€è¡Œå°±å¯ä»¥è¿è¡Œç®—æ³•å•¦ï¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ~/.nebula-up/nebula-up/spark <span class="o">&amp;&amp;</span> ls -l
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -it sparkmaster /spark/bin/spark-submit <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --master <span class="s2">&#34;local&#34;</span> --conf spark.rpc.askTimeout<span class="o">=</span>6000s <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --class com.vesoft.nebula.algorithm.Main <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --driver-memory 4g /root/download/nebula-algo.jar <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -p /root/louvain.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>è€Œæœ€ç»ˆçš„ç»“æœå°±åœ¨ sparkmaster å®¹å™¨å†…çš„ <code>/output</code> é‡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># docker exec -it sparkmaster bash</span>
</span></span><span class="line"><span class="cl">ls -l /output
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¿™ä¸ª Lovain çš„å›¾ç‰¹å¾åšä¸€äº›å¤„ç†ï¼Œå¹¶å¼€å§‹ä¼ ç»Ÿçš„æ¨¡å‹è®­ç»ƒäº†ã€‚</p>
<h3 id="å›¾ç¥ç»ç½‘ç»œçš„æ–¹æ³•" class="headerLink">
    <a href="#%e5%9b%be%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c%e7%9a%84%e6%96%b9%e6%b3%95" class="header-mark"></a>1.5 å›¾ç¥ç»ç½‘ç»œçš„æ–¹æ³•</h3><p>ç„¶è€Œï¼Œè¿™äº›å›¾ç‰¹å¾çš„æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼š</p>
<ol>
<li>å›¾ç‰¹å¾å¹¶ä¸èƒ½æŠŠå…³è”å…³ç³»ï¼Œæ•°æ®çš„å±€éƒ¨æ€§å……åˆ†åæ˜ åˆ°æˆ‘ä»¬çš„æ¨¡å‹ã€æ–¹æ³•é‡Œï¼›</li>
<li>å›¾çš„ç‰¹å¾å·¥ç¨‹æ˜¯å¾ˆæ˜‚è´µã€ç¹ççš„ã€‚</li>
</ol>
<p>åœ¨æœ€è¿‘å‡ å¹´çš„æˆæœä¸­ï¼ŒåŸºäº GNN çš„æ–¹æ³•é€šè¿‡å°†å›¾ç»“æ„ä¸å±æ€§ä¿¡æ¯è¿›è¡ŒåµŒå…¥è¡¨ç¤ºï¼Œä½¿å¾—æˆ‘ä»¬èƒ½åœ¨ä¸è¿›è¡Œå›¾ç‰¹å¾æŠ½å–ã€ç‰¹å¾å·¥ç¨‹ã€ä¸“å®¶ä¸å·¥ç¨‹æ–¹æ³•çš„æ•°æ®æ ‡æ³¨çš„æƒ…å†µä¸‹ï¼Œå¾—åˆ°ç›¸æ¯”äºåŸºäºä¼ ç»Ÿå›¾ç‰¹å¾çš„æœºå™¨å­¦ä¹ æ›´å¥½çš„æ•ˆæœã€‚æœ‰æ„æ€çš„æ˜¯ï¼Œç°åœ¨æ­£æ˜¯è¿™äº›æ–¹æ³•å¿«é€Ÿè¢«å‘ç°ã€æ¼”è¿›çš„æ—¶æœŸï¼ŒåŸºäºå›¾çš„æ·±åº¦å­¦ä¹ æ˜¯ä¹‹å‰å‡ å¹´æœ€çƒ­é—¨çš„æœºå™¨å­¦ä¹ ç ”ç©¶æ–¹å‘ä¹‹ä¸€ã€‚</p>
<p>åŒæ—¶ï¼Œå›¾æ·±åº¦å­¦ä¹ çš„ä¸€äº›æ–¹æ³•å¯ä»¥åšåˆ° Inductive Learningâ€”â€”æ¨¡å‹å¯ä»¥åœ¨æ–°çš„ç‚¹ã€è¾¹ä¸Šè¿›è¡Œæ¨ç†ï¼Œè¿™æ ·ï¼Œé…åˆå›¾æ•°æ®åº“ä¸Šçº¿ä¸Šçš„å­å›¾æŸ¥è¯¢èƒ½åŠ›ï¼Œåœ¨çº¿å®æ—¶çš„é£é™©é¢„æµ‹ä¹Ÿå˜å¾—å¾ˆç®€å•å¯è¡Œäº†ã€‚</p>
<h4 id="åŸºäºå›¾è¡¨ç¤ºçš„å›¾ç¥ç»ç½‘ç»œæ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿç¤ºä¾‹" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%9b%be%e8%a1%a8%e7%a4%ba%e7%9a%84%e5%9b%be%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c%e6%ac%ba%e8%af%88%e6%a3%80%e6%b5%8b%e7%b3%bb%e7%bb%9f%e7%a4%ba%e4%be%8b" class="header-mark"></a>1.5.1 åŸºäºå›¾è¡¨ç¤ºçš„å›¾ç¥ç»ç½‘ç»œæ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿç¤ºä¾‹</h4><p>åˆ©ç”¨ GNN çš„æ–¹æ³•ä¸­ï¼Œå›¾æ•°æ®åº“å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œæ•°æ®çš„å­˜å‚¨å¯ä»¥åœ¨å…¶ä»–å‡ ç§å¸¸è§çš„ä»‹è´¨ä¹‹ä¸­ï¼Œä½†æ˜¯å›¾åº“èƒ½å¤Ÿæœ€å¤§åŒ–åŠ©ç›Šæ¨¡å‹è®­ç»ƒã€æ¨¡å‹æ›´æ–°ã€çº¿ä¸Šç»“æœçš„æ›´æ–°ã€‚å½“æˆ‘ä»¬æŠŠå›¾æ•°æ®åº“ä½œä¸ºæ•°æ®çš„å•ä¸€æ•°æ®æ¥æºï¼ˆsingle source of truthï¼‰çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„åŸºäºçº¿ä¸Šã€ç¦»çº¿ã€å›¾è°±çš„æ–¹æ³•å¯ä»¥å¾ˆå®¹æ˜“è¢«é›†æˆèµ·æ¥ï¼Œä»è€Œç»„åˆæ‰€æœ‰æ–¹æ³•çš„ä¼˜åŠ¿ä¸ç»“æœï¼Œåšå‡ºæ›´æœ‰æ•ˆçš„æ¬ºè¯ˆæ£€æµ‹å¤åˆç³»ç»Ÿã€‚</p>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­æˆ‘ä»¬ä¸€æ ·åˆ†ä¸ºï¼š<strong>æ•°æ®å¤„ç†</strong>ã€<strong>æ¨¡å‹è®­ç»ƒ</strong>ã€<strong>æ„å»ºæ£€æµ‹ç³»ç»Ÿ</strong>è¿™å‡ éƒ¨åˆ†ã€‚</p>
<blockquote>
<p>æ³¨ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨çš„çš„å·¥å…·ä¸º Deep Graph libraryï¼ˆDGLï¼‰ï¼ŒNebulaGraph å›¾æ•°æ®åº“å’Œä»–ä»¬ä¹‹é—´çš„æ¡¥æ¢ï¼ŒNebula-DGLã€‚</p>
<ul>
<li>DGL: <a href="https://www.dgl.ai/" target="_blank" rel="noopener noreffer">https://www.dgl.ai/</a></li>
<li>Nebula-DGL: <a href="https://github.com/wey-gu/nebula-dgl" target="_blank" rel="noopener noreffer">https://github.com/wey-gu/nebula-dgl</a> æˆ‘ä¹Ÿæ˜¯è¿™ä¸ªåº“çš„ä½œè€… ğŸ˜</li>
</ul>
</blockquote>
<h5 id="æ•°æ®é›†" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e9%9b%86" class="header-mark"></a>1.5.1.1 æ•°æ®é›†</h5><p>æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ•°æ®é›†æ˜¯ Yelp-Fraudï¼Œä»–ç›´æ¥æ¥è‡ªäºè®ºæ–‡ <a href="https://paperswithcode.com/paper/enhancing-graph-neural-network-based-fraud" target="_blank" rel="noopener noreffer">Enhancing Graph Neural Network-based Fraud Detectors against Camouflaged Fraudsters</a>ã€‚</p>
<p>è¿™ä¸ªå›¾ä¸­æœ‰ä¸€ç§ç‚¹ï¼Œä¸‰ç§å…³ç³»ï¼š</p>
<ul>
<li>é¡¶ç‚¹ï¼šæ¥è‡ª Yelp ä¸­çš„é¤å…ã€é…’åº—çš„è¯„ä»·ï¼Œæœ‰ä¸¤ç±»å±æ€§ï¼š
<ul>
<li>æ¯ä¸€ä¸ªè¯„ä»·ä¸­æœ‰è¢«æ ‡æ³¨äº†çš„æ˜¯å¦æ˜¯è™šå‡ã€æ¬ºè¯ˆè¯„ä»·çš„æ ‡ç­¾</li>
<li>32 ä¸ªå·²ç»è¢«å¤„ç†è¿‡çš„æ•°å­—å‹å±æ€§</li>
</ul>
</li>
<li>è¾¹ï¼šä¸‰ç±»è¯„ä»·ä¹‹é—´çš„å…³è”å…³ç³»
<ul>
<li>R-U-Rï¼šä¸¤ä¸ªè¯„ä»·ç”±åŒä¸€ä¸ªç”¨æˆ·å‘å‡º shares_user_with</li>
<li>R-S-Rï¼šä¸¤ä¸ªè¯„ä»·æ˜¯åŒé¤å…åŒè¯„åˆ†ï¼ˆè¯„åˆ†å¯ä»¥æ˜¯1åˆ°5ï¼‰ shares_restaurant_rating_with</li>
<li>R-T-Rï¼šä¸¤ä¸ªè¯„ä»·æ˜¯åŒé¤å…åŒæäº¤æœˆä»½ shares_restaurant_in_one_month_with</li>
</ul>
</li>
</ul>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å‡è®¾è¿™ä¸ªå›¾å·²ç»åœ¨æˆ‘ä»¬çš„ NebulaGraph é‡Œè¾¹äº†ã€‚</p>
<blockquote>
<p>æ³¨ï¼Œæˆ‘å·²ç»å¸®å¤§å®¶æå‰åšå¥½äº†å°†è¿™å¼ å›¾å¯¼å…¥ NebulaGraph çš„å·¥ä½œï¼Œé•¿è¯çŸ­è¯´å°±æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># éƒ¨ç½² NebulaGraph</span>
</span></span><span class="line"><span class="cl">curl -fsSL nebula-up.siwei.io/install.sh <span class="p">|</span> bash
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ‹‰å–è¿™ä¸ªæ•°æ®çš„ Repo</span>
</span></span><span class="line"><span class="cl">git clone https://github.com/wey-gu/nebulagraph-yelp-frauddetection <span class="o">&amp;&amp;</span> <span class="nb">cd</span> nebulagraph-yelp-frauddetection
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å®‰è£…ä¾èµ–ï¼Œæ‰§è¡Œæ•°æ®ä¸‹è½½ç”Ÿæˆ</span>
</span></span><span class="line"><span class="cl">python3 -m pip install -r requirements.txt
</span></span><span class="line"><span class="cl">python3 data_download.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯¼å…¥åˆ° NebulaGraph</span>
</span></span><span class="line"><span class="cl">docker run --rm -ti <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> --network<span class="o">=</span>nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/yelp_nebulagraph_importer.yaml:/root/importer.yaml <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/data:/root <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> vesoft/nebula-importer:v3.1.0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> --config /root/importer.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯¦æƒ…å‚è€ƒï¼šhttps://github.com/wey-gu/nebulagraph-yelp-frauddetection</p>
</blockquote>
<h5 id="æ•°æ®å¤„ç†" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e5%a4%84%e7%90%86" class="header-mark"></a>1.5.1.2 æ•°æ®å¤„ç†</h5><p>è¿™éƒ¨åˆ†çš„ä»»åŠ¡æ˜¯å°†å›¾è°±ä¸­å’Œé£é™©ç›¸å…³å­å›¾çš„æ‹“æ‰‘ç»“æ„è¡¨ç¤ºå’Œå…¶ä¸­æœ‰å…³çš„ç‰¹å¾ï¼ˆå±æ€§ï¼‰è¿›è¡Œå·¥ç¨‹å¤„ç†ï¼Œåºåˆ—åŒ–æˆä¸º DGL çš„å›¾å¯¹è±¡ã€‚</p>
<p>DGL æœ¬èº«æ”¯æŒä»ç‚¹ã€è¾¹åˆ—è¡¨ï¼ˆedgelistï¼‰å½¢å¼ CSV æ–‡ä»¶ï¼Œæˆ–è€…ä» NetworkX å’Œ SciPy çš„åºåˆ—åŒ–ç¨€ç–çš„é‚»æ¥çŸ©é˜µï¼ˆadjacency matrixï¼‰çš„æ•°æ®æ¥æ„é€ å®ƒçš„å›¾å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåŸå§‹çš„å›¾æ•°æ®æˆ–è€…å›¾åº“ä¸­çš„æ•°æ®å…¨é‡å¯¼å‡ºä¸ºè¿™äº›å½¢å¼ï¼Œä¸è¿‡åœ¨çœŸå®çš„ä¾‹å­ä¸­å›¾åº“ä¸­çš„æ•°æ®æ˜¯å®æ—¶å˜åŒ–çš„ï¼Œèƒ½å¤Ÿç›´æ¥åœ¨ NebulaGraph ä¸­çš„å­å›¾ä¸Šåš GNN è®­ç»ƒä¸€èˆ¬æ¥è¯´æ˜¯æ›´ç†æƒ³ã€‚å¾—ç›Šäº Nebula-DGL è¿™ä¸ªåº“ï¼Œåšè¿™ä»¶äº‹å„¿æ˜¯å¾ˆè‡ªç„¶çš„ã€‚</p>
<blockquote>
<p>æ³¨ï¼ŒDGL å¤–éƒ¨æ•°æ®å‘˜å¯¼å…¥æ–‡æ¡£ï¼šhttps://docs.dgl.ai/guide/graph-external.html</p>
</blockquote>
<p>ç°åœ¨æˆ‘ä»¬å¼€å§‹è¿™ä¸ªæ•°æ®çš„å¯¼å…¥ï¼Œåœ¨è¿™ä¹‹å‰ï¼Œæˆ‘å…ˆä»‹ç»ä¸€ä¸‹ Nebula-DGLã€‚</p>
<p>Nebula-DGL å¯ä»¥æ ¹æ®ç»™å®šçš„æ˜ å°„å’Œè½¬æ¢è§„åˆ™ï¼ˆYAML æ ¼å¼ï¼‰ï¼Œå°† NebulaGraph ä¸­çš„é¡¶ç‚¹ã€è¾¹ï¼Œå’Œå®ƒä»¬çš„å±æ€§æŒ‰ç…§è§„åˆ™å¤„ç†æˆä¸ºç‚¹ã€è¾¹ã€å’Œå…¶ä¸­çš„æ ‡æ³¨ï¼ˆLabelï¼‰ä¸ç‰¹å¾ï¼ˆFeatureï¼‰ï¼Œä»è€Œæ„é€ ä¸º DGL çš„å›¾å¯¹è±¡ã€‚è¿™å…¶ä¸­ï¼Œå€¼å¾—ä¸€æçš„æ˜¯å±æ€§åˆ°ç‰¹å¾çš„è½¬æ¢ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œç‰¹å¾å¯èƒ½æ˜¯æŸä¸€ä¸ªå±æ€§çš„å€¼ã€ä¸€ä¸ªæˆ–è€…å¤šä¸ªå±æ€§çš„å€¼åšä¸€å®šçš„æ•°å­¦å˜æ¢ã€äº¦æˆ–æ˜¯å­—ç¬¦å‹çš„å±æ€§æŒ‰ç…§æšä¸¾è§„åˆ™è¾“å‡ºä¸ºæ•°å­—ã€‚ç›¸åº”çš„ï¼ŒNebula-DGL åœ¨è§„åˆ™ä¸­ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é’ˆå¯¹è¿™å‡ ç§æƒ…å†µåˆ©ç”¨ <code>filter</code> è¿›è¡Œè¡¨è¾¾ï¼š</p>
<ul>
<li>ç‰¹å¾ç›´æ¥é€‰å–å±æ€§çš„å€¼ï¼š</li>
</ul>
<p>è¿™ä¸ªä¾‹å­é‡Œï¼ŒNebulaGraph å›¾ä¸­ <code>follow</code> è¿™ä¸ªè¾¹å°†è¢«æŠ½å–ï¼Œè¾¹ä¸Šçš„å±æ€§ <code>degree</code> çš„å€¼å°†ç›´æ¥è¢«ä½œä¸ºåä¸º <code>degree</code> çš„ç‰¹å¾ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">edge_types</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">follow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">player</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">player</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">features</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">degree</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">degree</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">value</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç‰¹å¾ä»å±æ€§ä¸­ç»è¿‡æ•°å­¦å˜æ¢</li>
</ul>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŠŠ <code>serve</code> è¾¹ä¹‹ä¸­çš„ä¸¤ä¸ªå±æ€§è¿›è¡Œ <code>(end_year - start_year) / 30</code> çš„å¤„ç†ï¼Œå˜ä¸º <code>service_time</code> è¿™æ ·çš„ä¸€ä¸ªç‰¹å¾ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">edge_types</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">serve</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">player</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">team</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">features</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">service_time</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">start_year</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">end_year</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># The variable was mapped by order of properties</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">function</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">function</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;lambda start_year, end_year: (end_year - start_year) / 30&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æšä¸¾å±æ€§å€¼ä¸ºæ•°å­—ç‰¹å¾</li>
</ul>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŠŠ <code>team</code> é¡¶ç‚¹ä¸­çš„ <code>name</code> å±æ€§è¿›è¡Œæšä¸¾ï¼Œæ ¹æ®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">vertex_tags</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">team</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">features</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">coast</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">str</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># 0 stand for the east coast, 1 stand for the west coast</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">enumeration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">enumeration</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">Celtics</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">Nets</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">Nuggets</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">Timberwolves</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">Thunder</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ... not showing all teams here</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªè½¬æ¢è§„åˆ™éå¸¸ç®€å•ç›´æ¥ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥å‚è€ƒ Nebula-DGL çš„å®Œæ•´ä¾‹å­äº†è§£å…¨éƒ¨ç»†èŠ‚ <a href="https://github.com/wey-gu/nebula-dgl/tree/main/example" target="_blank" rel="noopener noreffer">https://github.com/wey-gu/nebula-dgl/tree/main/example</a>ã€‚è€Œæœ‰ä¸Šè¾¹æ•°æ®å¤„ç†è§„åˆ™çš„äº†è§£ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹å¤„ç†è¿™ä¸ª Yelp å›¾æ•°æ®äº†ã€‚</p>
<p>é¦–å…ˆï¼Œå®šä¹‰å¦‚ä¸‹è§„åˆ™ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬æŠŠé¡¶ç‚¹ review å’Œä¸‰ç§è¾¹éƒ½å¯¹åº”è¿‡æ¥äº†ï¼ŒåŒæ—¶ï¼Œreview ä¸Šçš„å±æ€§ä¹ŸæŒ‰ç…§åŸæœ¬çš„å€¼å¯¹åº”äº†è¿‡æ¥ï¼š</p>
<p><code>nebulagraph_yelp_dgl_mapper.yaml</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># If vertex id is string-typed, remap_vertex_id must be true.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">remap_vertex_id</span><span class="p">:</span><span class="w"> </span><span class="kc">True</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">space</span><span class="p">:</span><span class="w"> </span><span class="l">yelp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># str or int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">vertex_id_type</span><span class="p">:</span><span class="w"> </span><span class="l">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">vertex_tags</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">label</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">is_fraud</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">is_fraud</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">features</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">float</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">float</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f31</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f31</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">float</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">edge_types</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">shares_user_with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">shares_restaurant_rating_with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">shares_restaurant_in_one_month_with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">review</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬åœ¨å®‰è£…å¥½ Nebula-DGL ä¹‹ååªéœ€è¦è¿™å‡ è¡Œä»£ç å°±å¯ä»¥å°† NebulaGraph ä¸­çš„è¿™å¼ å›¾æ„é€ ä¸º DGL çš„ <code>DGLHeteroGraph</code> å›¾å¯¹è±¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula_dgl</span> <span class="kn">import</span> <span class="n">NebulaLoader</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">nebula_config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;graph_hosts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd1&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd2&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;user&#34;</span><span class="p">:</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;nebula&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># load feature_mapper from yaml file</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;nebulagraph_yelp_dgl_mapper.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">feature_mapper</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">nebula_loader</span> <span class="o">=</span> <span class="n">NebulaLoader</span><span class="p">(</span><span class="n">nebula_config</span><span class="p">,</span> <span class="n">feature_mapper</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span> <span class="o">=</span> <span class="n">nebula_loader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="æ¨¡å‹è®­ç»ƒ" class="headerLink">
    <a href="#%e6%a8%a1%e5%9e%8b%e8%ae%ad%e7%bb%83" class="header-mark"></a>1.5.1.3 æ¨¡å‹è®­ç»ƒ</h5><p>è¿™é‡Œï¼Œæˆ‘ç”¨ <a href="https://cs.stanford.edu/people/jure/pubs/graphsage-nips17.pdf" target="_blank" rel="noopener noreffer">GraphSAGE</a> ç®—æ³•çš„ç‚¹åˆ†ç±»ï¼ˆNode Classificationï¼‰æ–¹æ³•æ¥ä¸¾ä¾‹ï¼ŒGraphSAGE çš„åŸå§‹ç‰ˆæœ¬æ˜¯ä¸€ä¸ªå½’çº³å­¦ä¹ ï¼ˆInductive Learningï¼‰çš„ç®—æ³•ï¼Œè¿™é‡Œï¼Œå½’çº³å­¦ä¹ åŒºåˆ«äºå®ƒçš„åé¢ï¼š Transductive Learning ï¼Œå¯ä»¥æŠŠæ–°çš„æ•°æ®ç”¨åœ¨å®Œå…¨æ—§çš„å›¾ä¹‹ä¸Šä¹ å¾—çš„æ¨¡å‹ï¼Œè¿™æ ·è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹å¯ä»¥è¿›è¡Œçº¿ä¸Šå¢é‡æ•°æ®çš„æ¬ºè¯ˆæ£€æµ‹ï¼ˆè€Œä¸æ˜¯éœ€è¦é‡æ–°åŠ è½½ä¸ºå…¨å›¾è®­ç»ƒæ‰å¯ä»¥ï¼‰ã€‚</p>
<p>æ¨¡å‹è®­ç»ƒç³»ç»Ÿï¼š</p>
<ul>
<li>è¾“å…¥ï¼šå¸¦æœ‰æ¬ºè¯ˆæ ‡æ³¨çš„å†å²äº¤æ˜“å›¾è°±</li>
<li>è¾“å‡ºï¼šä¸€ä¸ª GraphSAGE çš„ DGL æ¨¡å‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     
</span></span><span class="line"><span class="cl">                     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                     
</span></span><span class="line"><span class="cl">                     â”‚   â”‚   Graph of Historical Transactions   â”‚   â”‚                     
</span></span><span class="line"><span class="cl">                     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                     
</span></span><span class="line"><span class="cl">                     â”‚                      .â”€.              .      â”‚                     
</span></span><span class="line"><span class="cl">                     â”‚                     (   )â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€( )     â”‚                     
</span></span><span class="line"><span class="cl">                     â”‚                      `â”€&#39;              &#39;      â”‚                     
</span></span><span class="line"><span class="cl">                     â”‚     .       .â”€.       â•²             â—        â”‚                     
</span></span><span class="line"><span class="cl">                     â”‚    ( )â—€â”€â”€â”€â”€(   )       â•²        .  â•±         â”‚                     
</span></span><span class="line"><span class="cl">                     â”‚     &#39;       `â”€&#39;         â•²      ( )â•±          â”‚                     
</span></span><span class="line"><span class="cl">                     â”‚     â•²       â—€            â•²      &#39;            â”‚                     
</span></span><span class="line"><span class="cl">                     â”‚      â•²  .  â•±              â—                  â”‚                     
</span></span><span class="line"><span class="cl">                     â”‚       â—€( )â•±               .â”€.         .â”€.    â”‚                     
</span></span><span class="line"><span class="cl">                     â”‚         &#39;                (   )â—€â”€â”€â”€â”€â”€â”€(   )   â”‚                     
</span></span><span class="line"><span class="cl">                     â”‚                           `â”€&#39;         `â”€&#39;    â”‚                     
</span></span><span class="line"><span class="cl">                     â”‚                                              â”‚                     
</span></span><span class="line"><span class="cl">                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     
</span></span><span class="line"><span class="cl">                                             â”ƒ                                            
</span></span><span class="line"><span class="cl">                                             â”ƒ                                            
</span></span><span class="line"><span class="cl">                                             â–¼                                            
</span></span><span class="line"><span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">â”‚ â”Œâ”€â”€â”€â”€â”           â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€               â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€                     â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚GNN â”‚                            â”‚                               â”‚                    â”‚
</span></span><span class="line"><span class="cl">â”‚ â””â”€â”€â”€â”€â”˜           â”‚                               â”‚                                     â”‚
</span></span><span class="line"><span class="cl">â”‚                                   â”‚                               â”‚                    â”‚
</span></span><span class="line"><span class="cl">â”‚                  â”‚           â—€                   â”‚           â—€                         â”‚
</span></span><span class="line"><span class="cl">â”‚                      .   .  â•±.â”€.  â”‚                  .   .  â•±.â”€.  â”‚                    â”‚
</span></span><span class="line"><span class="cl">â”‚                  â”‚  ( )â—€â”€â”€â”€â•±(   )                â”‚  ( )â—€â”€â”€â”€â•±(   )                      â”‚
</span></span><span class="line"><span class="cl">â”‚ .       .â”€.          &#39;â•±  &#39;   `â”€&#39;  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      &#39;â•±  &#39;   `â”€&#39;  â”‚        .       .â”€. â”‚
</span></span><span class="line"><span class="cl">â”‚( )â—€â”€â”€â”€â”€(   )     â”‚   .       .â”€.     â”‚ ReLU  â•±â”‚  â”‚   .       .â”€.          ( )â—€â”€â”€â”€â”€(   )â”‚
</span></span><span class="line"><span class="cl">â”‚ &#39;       `â”€&#39;         ( )â—€â”€â”€â”€â”€(   ) â”‚  â”‚      â•± â”‚     ( )â—€â”€â”€â”€â”€(   ) â”‚        &#39;       `â”€&#39; â”‚
</span></span><span class="line"><span class="cl">â”‚ â•²       â—€   â•â•â–¶  â”‚   &#39;       `â”€&#39;     â”‚     â•±  â”‚  â”‚   &#39;       `â”€&#39;   ... â•â•â–¶ â•²       â—€   â”‚
</span></span><span class="line"><span class="cl">â”‚  â•²  .  â•±             â•²       â—€    â”‚  â”‚â”€â”€â”€â”€â”€   â”‚      â•²       â—€    â”‚         â•²  .  â•±    â”‚
</span></span><span class="line"><span class="cl">â”‚   â—€( )â•±          â”‚    â•²  .  â•±        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â•²  .  â•±                â—€( )â•±     â”‚
</span></span><span class="line"><span class="cl">â”‚     &#39;                  â—€( )â•±      â”‚                    â—€( )â•±      â”‚            &#39;       â”‚
</span></span><span class="line"><span class="cl">â”‚                  â”‚       &#39;                       â”‚       &#39;                             â”‚
</span></span><span class="line"><span class="cl">â”‚                      .       .â”€.  â”‚                  .       .â”€.  â”‚                    â”‚
</span></span><span class="line"><span class="cl">â”‚                  â”‚  ( )â—€â”€â”€â”€â”€(   )                â”‚  ( )â—€â”€â”€â”€â”€(   )                      â”‚
</span></span><span class="line"><span class="cl">â”‚                      &#39;       `â”€&#39;  â”‚                  &#39;       `â”€&#39;  â”‚                    â”‚
</span></span><span class="line"><span class="cl">â”‚                  â”‚   â•²       â—€                   â”‚   â•²       â—€                         â”‚
</span></span><span class="line"><span class="cl">â”‚                       â•²  .  â•±     â”‚                   â•²  .  â•±     â”‚                    â”‚
</span></span><span class="line"><span class="cl">â”‚                  â”‚     â—€( )â•±                     â”‚     â—€( )â•±                           â”‚
</span></span><span class="line"><span class="cl">â”‚                          &#39;        â”‚                      &#39;        â”‚                    â”‚
</span></span><span class="line"><span class="cl">â”‚                  â”” â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€               â”” â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€                     â”‚
</span></span><span class="line"><span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="cl">                                            â”ƒ                                             
</span></span><span class="line"><span class="cl">                                            â”ƒ                                             
</span></span><span class="line"><span class="cl">                                            â–¼                                             
</span></span><span class="line"><span class="cl">                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            
</span></span><span class="line"><span class="cl">                          â”‚                 Î›                â”‚                            
</span></span><span class="line"><span class="cl">                      â”Œâ”€â”€â”€â”´â”€â”  GNN Model   â•± â•²            â”Œâ”€â”€â”´â”€â”€â”                         
</span></span><span class="line"><span class="cl">                      â”œâ”€â”€â”€â”€â”€â”¤             â•±   â•²           â”œâ”€â”€â”€â”€â”€â”¤                         
</span></span><span class="line"><span class="cl">                      â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”œâ”€â”€â”€â”€â”€â”¤                         
</span></span><span class="line"><span class="cl">                      â”œâ”€â”€â”€â”€â”€â”¤             â•²   â•±           â”œâ”€â”€â”€â”€â”€â”¤                         
</span></span><span class="line"><span class="cl">                      â””â”€â”€â”€â”¬â”€â”˜              â•² â•±            â””â”€â”€â”¬â”€â”€â”˜                         
</span></span><span class="line"><span class="cl">                          â”‚                 V                â”‚                            
</span></span><span class="line"><span class="cl">                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            
</span></span></code></pre></td></tr></table>
</div>
</div><p>çº¿ä¸Šæ¨ç†ç³»ç»Ÿï¼š</p>
<ul>
<li>
<p>æ¨¡å‹ï¼šåŸºäºå¸¦æœ‰æ¬ºè¯ˆæ ‡æ³¨çš„å†å²äº¤æ˜“å›¾è°±åŸºäº GraphSAGE è®­ç»ƒ</p>
</li>
<li>
<p>è¾“å…¥ï¼šä¸€ç¬”æ–°çš„äº¤æ˜“</p>
</li>
<li>
<p>è¾“å‡ºï¼šè¿™ç¬”äº¤æ˜“æ˜¯å¦æ¶‰å«Œæ¬ºè¯ˆ</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      
</span></span><span class="line"><span class="cl">      â”‚                     â”‚                          â”‚                 â”‚
</span></span><span class="line"><span class="cl">â”€â”€â”€â”€â”€â–¶â”‚ Transaction Record  â”œâ”€â”€â”€â”€â”€â”€2. Fraud Risk â”€â”€â”€â”€â”€â–¶â”‚  Inference API  â”‚â—€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">      â”‚                     â”‚â—€â”€â”€â”€â”€Prediction with â”€â”€â”€â”€â”€â”¤                 â”‚     â”‚
</span></span><span class="line"><span class="cl">      â”‚                     â”‚        Sub Graph         â”‚                 â”‚     â”‚
</span></span><span class="line"><span class="cl">      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
</span></span><span class="line"><span class="cl">           â”‚           â–²                                        â”‚              â”‚
</span></span><span class="line"><span class="cl">           â”‚           â”‚                                        â”‚              â”‚
</span></span><span class="line"><span class="cl">       0. Insert   1. Get New                              3.req: Node         â”‚
</span></span><span class="line"><span class="cl">         Record    Record Sub                            Classification        â”‚
</span></span><span class="line"><span class="cl">           â”‚         Graph                                      â”‚              â”‚
</span></span><span class="line"><span class="cl">           â–¼           â”‚                                        â”‚              â”‚
</span></span><span class="line"><span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      3.resp: â”‚
</span></span><span class="line"><span class="cl">â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚                          Predictedâ”‚
</span></span><span class="line"><span class="cl">â”‚â”‚   Graph of Historical Transactions   â”‚â”‚ â”‚                             Risk  â”‚
</span></span><span class="line"><span class="cl">â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚                                   â”‚
</span></span><span class="line"><span class="cl">â”‚                   .â”€.              .   â”‚ â”‚                                   â”‚
</span></span><span class="line"><span class="cl">â”‚                  (   )â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€( )  â”‚ â”‚                                   â”‚
</span></span><span class="line"><span class="cl">â”‚                   `â”€&#39;              &#39;   â”‚ â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
</span></span><span class="line"><span class="cl">â”‚  .       .â”€.       â•²             â—     â”‚ â”‚      â”‚ GNN Model Î›          â”‚     â”‚
</span></span><span class="line"><span class="cl">â”‚ ( )â—€â”€â”€â”€â”€(   )       â•²           â•±      â”‚ â”‚  â”Œâ”€â”€â”€â”´â”€â”        â•± â•²      â”Œâ”€â”€â”´â”€â”€â”  â”‚
</span></span><span class="line"><span class="cl">â”‚  &#39;       `â”€&#39;         â•²       . â•±       â”‚ â”‚  â”œâ”€â”€â”€â”€â”€â”¤       â•±   â•²     â”œâ”€â”€â”€â”€â”€â”¤  â”‚
</span></span><span class="line"><span class="cl">â”‚  â•²       â—€            â•²     ( )        â”‚ â””â”€â–¶â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â–¶â–•     â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”¤â”€â”€â”˜
</span></span><span class="line"><span class="cl">â”‚   â•²  .  â•±              â—     &#39;         â”‚    â”œâ”€â”€â”€â”€â”€â”¤       â•²   â•±     â”œâ”€â”€â”€â”€â”€â”¤   
</span></span><span class="line"><span class="cl">â”‚    â—€( )â•±               .â”€.         .â”€. â”‚    â””â”€â”€â”€â”¬â”€â”˜        â•² â•±      â””â”€â”€â”¬â”€â”€â”˜   
</span></span><span class="line"><span class="cl">â”‚      &#39;                (   )â—€â”€â”€â”€â”€â”€â”€(   )â”‚        â”‚           V          â”‚      
</span></span><span class="line"><span class="cl">â”‚                        `â”€&#39;         `â”€&#39; â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      
</span></span><span class="line"><span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>åˆ†å‰²æ•°æ®é›†</strong></p>
<p>æœºå™¨å­¦ä¹ è®­ç»ƒçš„è¿‡ç¨‹éœ€è¦åœ¨å·²ç»æœ‰çš„æ•°æ®ã€ä¿¡æ¯ä¸­åˆ†å‰²å‡ºç”¨æ¥è®­ç»ƒã€éªŒè¯å’Œæµ‹è¯•çš„å­é›†ï¼Œä»–ä»¬å¯ä»¥æ˜¯ä¸ç›¸äº¤çš„æ•´ä½“æ•°æ®çš„çœŸå­é›†ä¹Ÿå¯ä»¥å½¼æ­¤æœ‰é‡å ï¼Œåœ¨å®é™…çš„æƒ…å†µä¸­ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¯¹æ•°æ®çš„æ ‡æ³¨å¸¸å¸¸æ˜¯ä¸å……åˆ†çš„ï¼Œæ‰€ä»¥æŒ‰ç…§æ ‡æ³¨çš„æ¯”ä¾‹å»åˆ†å‰²æ•°æ®å¯èƒ½æ›´æœ‰æ„ä¹‰ä¸€äº›ï¼Œä¸‹è¾¹çš„ä¾‹å­æ˜¯æˆ‘æŒ‰ç…§ç‚¹ä¸Šæ˜¯å¦æ ‡æ³¨æ¬ºè¯ˆä¸ºæ ‡å‡†å»åˆ†å‰²æ•°æ®é›†ã€‚</p>
<p>è¿™é‡Œè¾¹æœ‰ä¸¤ä¸ªåœ°æ–¹å€¼å¾—æ³¨æ„ï¼š</p>
<ol>
<li><code>train_test_split</code> ä¸­çš„ <code>stratify=g.ndata['is_fraud']</code> ä»£è¡¨ä¿æŒ <code>is_fraud</code> çš„å€¼çš„åˆ†å¸ƒå»åˆ†å‰²ï¼Œç¬¦åˆæˆ‘ä»¬å‰è¾¹æåˆ°çš„æ€æƒ³ã€‚</li>
<li>æˆ‘ä»¬åˆ†å‰²çš„æ˜¯ <code>idx</code> ç´¢å¼•ï¼Œè¿™æ ·ï¼Œå¯ä»¥æœ€ç»ˆè·å¾—ä¸‰ä¸ªé›†åˆçš„ç´¢å¼•ï¼Œä¾›è®­ç»ƒã€éªŒè¯å’Œæµ‹è¯•æ—¶å€™ä½¿ç”¨ã€‚åŒæ—¶æˆ‘ä»¬è¿˜æŠŠå¯¹åº”é›†åˆ mask æ”¾åˆ°å›¾å¯¹è±¡ <code>g</code> é‡Œè¾¹å»äº†ã€‚</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Split the graph into train, validation, and test sets</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># features are g.ndata[&#39;f0&#39;], g.ndata[&#39;f1&#39;], g.ndata[&#39;f2&#39;], ... g.ndata[&#39;f31&#39;]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># label is in g.ndata[&#39;is_fraud&#39;]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># concatenate all features</span>
</span></span><span class="line"><span class="cl"><span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;f&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;is_fraud&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># numpy array as an index of range n</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># split based on value distribution of label: the property &#34;is_fraud&#34;, which is a binary variable.</span>
</span></span><span class="line"><span class="cl"><span class="n">X_train_and_val_idx</span><span class="p">,</span> <span class="n">X_test_idx</span><span class="p">,</span> <span class="n">y_train_and_val</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">idx</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;is_fraud&#39;</span><span class="p">],</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;is_fraud&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># split train and val</span>
</span></span><span class="line"><span class="cl"><span class="n">X_train_idx</span><span class="p">,</span> <span class="n">X_val_idx</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">X_train_and_val_idx</span><span class="p">,</span> <span class="n">y_train_and_val</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_train_and_val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># list of index to mask</span>
</span></span><span class="line"><span class="cl"><span class="n">train_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">train_mask</span><span class="p">[</span><span class="n">X_train_idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">val_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">val_mask</span><span class="p">[</span><span class="n">X_val_idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">test_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">test_mask</span><span class="p">[</span><span class="n">X_test_idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;train_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_mask</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;val_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_mask</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;test_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_mask</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å¼‚æ„å›¾è½¬æ¢ä¸ºåŒæ„å›¾</strong></p>
<p>GraphSAGE æ˜¯é’ˆå¯¹åŒæ„å›¾ï¼Œä¸”è¾¹æ—  feature çš„ç®—æ³•ï¼Œè€Œæˆ‘ä»¬å½“ä¸‹çš„ Yelp å›¾è°±æ˜¯å¼‚æ„çš„ï¼šä¸€ç±»ç‚¹ã€ä¸‰ç±»è¾¹ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•æ‰èƒ½ç”¨ GraphSAGE å»å»ºæ¨¡ Yelp å›¾è°±å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬é™¤äº†é€‰æ‹©ç”¨é’ˆå¯¹å¼‚æ„å›¾çš„ Inductive Learning æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜å¯æƒ³åŠæ³•æŠŠåŒæ„å›¾è½¬æ¢æˆå¼‚æ„å›¾ã€‚ä¸ºäº†åœ¨è½¬æ¢ä¸­ä¸ä¸¢å¤±é‡è¦çš„è¾¹ç±»å‹ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¾¹ç±»å‹å˜æˆæ•°å€¼ã€‚</p>
<p>è¿™é‡Œæˆ‘ç»™äº†ä¸€ç»´çš„ edge featureï¼Œå½“ç„¶ä¸‰ç»´ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># shares_restaurant_in_one_month_with: 1, b&#34;001&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># shares_restaurant_rating_with: 2, b&#34;010&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># shares_user_with: 4, b&#34;100&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨ï¼šå…¶å®å¦‚æœæƒ³ç”¨ 0, 1, 2 è¿™æ ·çš„åˆ†å¸ƒï¼Œè½¬æ¢åˆ°åŒæ„å›¾ä¹‹åçš„ <code>hg.edata['_TYPE']</code> ä¹Ÿæ˜¯å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨çš„ï¼Œè¯¦è§ <a href="https://docs.dgl.ai/en/0.9.x/generated/dgl.to_homogeneous.html" target="_blank" rel="noopener noreffer">https://docs.dgl.ai/en/0.9.x/generated/dgl.to_homogeneous.html</a> ä¸­çš„ä¾‹å­ã€‚</p>
</blockquote>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># three types of edges</span>
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">g</span><span class="o">.</span><span class="n">etypes</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;shares_user_with&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">),),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_user_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_user_with&#39;</span><span class="p">),),</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">g</span><span class="o">.</span><span class="n">edata</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="p">{(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;review&#39;</span><span class="p">):</span> <span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;review&#39;</span><span class="p">):</span> <span class="n">tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="s1">&#39;shares_user_with&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">):</span> <span class="n">tensor</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">])}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å‚è€ƒï¼šhttps://discuss.dgl.ai/t/how-to-convert-from-a-heterogeneous-graph-to-a-homogeneous-graph-with-data/2764</p>
</blockquote>
<p>ç„¶åå°†å®ƒè½¬æ¢ä¸ºåŒæ„å›¾ï¼ŒæŠŠ <code>he</code> ä½œä¸ºè¦ä¿ç•™çš„ edataï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">hg</span> <span class="o">=</span> <span class="n">dgl</span><span class="o">.</span><span class="n">to_homogeneous</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">edata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">],</span> <span class="n">ndata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;train_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;val_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;test_mask&#39;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å‚è€ƒï¼šhttps://docs.dgl.ai/en/latest/guide/graph-heterogeneous.html?highlight=to_homogeneous#converting-heterogeneous-graphs-to-homogeneous-graphs</p>
</blockquote>
<p>é»˜è®¤çš„ GraphSAGE å®ç°æ˜¯æ²¡è€ƒè™‘ edge feature çš„ï¼Œæˆ‘ä»¬è¦ä¿®æ”¹æ¶ˆæ¯ä¼ é€’çš„æ­¥éª¤ï¼Œåœ¨åè¾¹ä¼šæ¶‰åŠåˆ°è¿™éƒ¨åˆ†çš„å®æ“ã€‚</p>
<blockquote>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://discuss.dgl.ai/t/frequently-asked-questions-faq/1681" target="_blank" rel="noopener noreffer">https://discuss.dgl.ai/t/frequently-asked-questions-faq/1681</a> ï¼ˆé—®é¢˜13ï¼‰</li>
<li><a href="https://discuss.dgl.ai/t/using-node-and-edge-features-in-message-passing/762" target="_blank" rel="noopener noreffer">https://discuss.dgl.ai/t/using-node-and-edge-features-in-message-passing/762</a></li>
</ul>
</blockquote>
<p><strong>æ¨¡å‹è®­ç»ƒä»£ç </strong></p>
<p>DGL å®˜æ–¹ç»™å‡ºäº†ä¾‹å­åœ¨ï¼šhttps://github.com/dmlc/dgl/tree/master/examples/pytorch/graphsageï¼Œæˆ‘åœ¨æµ‹è¯•çš„æ—¶å€™è¿˜ä¿®å¤äº†ä¸€ä¸ªå° bugã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬å¤„ç†è¿‡çš„åŒæ„å›¾é‡Œæ˜¯å¸¦æœ‰ edge feature çš„ï¼Œä¸èƒ½ç…§æ¬å®˜æ–¹çš„ GraphSAGE ä¾‹å­ä»£ç ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•æ¥å¤„ç†å®ƒï¼š</p>
<p>a. å¯ä»¥ç¨å¾®æ”¹åŠ¨ä¸€ä¸‹ <code>SAGEConv</code>æ¶ˆæ¯ä¼ é€’çš„éƒ¨åˆ†ï¼Œä»¥ mean èšåˆçš„æ–¹å¼ä¸ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">  graph.update_all(msg_fn, fn.mean(&#39;m&#39;, &#39;neigh&#39;))
</span></span><span class="line"><span class="cl"><span class="gi">+ graph.update_all(fn.copy_e(&#39;he&#39;, &#39;m&#39;), fn.mean(&#39;m&#39;, &#39;neigh&#39;))
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gd">- h_neigh = graph.dstdata[&#39;neigh&#39;]
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+ h_neigh = torch.cat((graph.dstdata[&#39;neigh&#39;], graph.dstdata[&#39;neigh_e&#39;].reshape(-1, 1)), 1)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªå¤„ç†ä¸­ï¼Œé™¤äº†ä¸Šè¾¹æ¶ˆæ¯ä¼ é€’éƒ¨åˆ†å¢åŠ  edge feature ä¹‹å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„ feature ç»´åº¦çš„å¤„ç†ã€‚</p>
<p>b. æŠŠè¾¹å‚æ•°ä½œä¸ºè¾¹æƒé‡ ï¼Œä»¥ mean èšåˆä¸ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gd">- graph.update_all(msg_fn, fn.mean(&#39;m&#39;, &#39;neigh&#39;))
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+ # consdier datatype with different weight, g.edata[&#39;he&#39;] as weight here
</span></span></span><span class="line"><span class="cl"><span class="gi">+ g.update_all(fn.u_mul_e(&#39;h&#39;, &#39;he&#39;, &#39;m&#39;), fn.mean(&#39;m&#39;, &#39;h&#39;))
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‹è¾¹ï¼Œæˆ‘ä»¬ä»¥æŠŠè¾¹çš„ç±»å‹ä½œä¸ºæƒé‡çš„æ–¹å¼ï¼Œ<code>mean</code>ä½œä¸ºèšåˆçš„æƒ…å†µä¸ºä¾‹æ¥å®æ“ï¼š</p>
<p>æˆ‘ä»¬æ¥ç»§æ‰¿ï¼Œå¹¶è¦†ç›–<code>SAGEConv</code>ï¼š</p>
<blockquote>
<p>æˆ‘ä»¬å…¶å®åªæ˜¯ä¿®æ”¹äº† Message Passing çš„éƒ¨åˆ†ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dgl</span> <span class="kn">import</span> <span class="n">function</span> <span class="k">as</span> <span class="n">fn</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dgl.utils</span> <span class="kn">import</span> <span class="n">check_eq_shape</span><span class="p">,</span> <span class="n">expand_as_pair</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SAGEConv</span><span class="p">(</span><span class="n">dglnn</span><span class="o">.</span><span class="n">SAGEConv</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">feat</span><span class="p">,</span> <span class="n">edge_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="sa">r</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Description
</span></span></span><span class="line"><span class="cl"><span class="s2">        -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">        Compute GraphSAGE layer.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">        ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">        graph : DGLGraph
</span></span></span><span class="line"><span class="cl"><span class="s2">            The graph.
</span></span></span><span class="line"><span class="cl"><span class="s2">        feat : torch.Tensor or pair of torch.Tensor
</span></span></span><span class="line"><span class="cl"><span class="s2">            If a torch.Tensor is given, it represents the input feature of shape
</span></span></span><span class="line"><span class="cl"><span class="s2">            :math:`(N, D_</span><span class="si">{in}</span><span class="s2">)`
</span></span></span><span class="line"><span class="cl"><span class="s2">            where :math:`D_</span><span class="si">{in}</span><span class="s2">` is size of input feature, :math:`N` is the number of nodes.
</span></span></span><span class="line"><span class="cl"><span class="s2">            If a pair of torch.Tensor is given, the pair must contain two tensors of shape
</span></span></span><span class="line"><span class="cl"><span class="s2">            :math:`(N_</span><span class="si">{in}</span><span class="s2">, D_{in_</span><span class="si">{src}</span><span class="s2">})` and :math:`(N_</span><span class="si">{out}</span><span class="s2">, D_{in_</span><span class="si">{dst}</span><span class="s2">})`.
</span></span></span><span class="line"><span class="cl"><span class="s2">        edge_weight : torch.Tensor, optional
</span></span></span><span class="line"><span class="cl"><span class="s2">            Optional tensor on the edge. If given, the convolution will weight
</span></span></span><span class="line"><span class="cl"><span class="s2">            with regard to the message.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Returns
</span></span></span><span class="line"><span class="cl"><span class="s2">        -------
</span></span></span><span class="line"><span class="cl"><span class="s2">        torch.Tensor
</span></span></span><span class="line"><span class="cl"><span class="s2">            The output feature of shape :math:`(N_</span><span class="si">{dst}</span><span class="s2">, D_</span><span class="si">{out}</span><span class="s2">)`
</span></span></span><span class="line"><span class="cl"><span class="s2">            where :math:`N_</span><span class="si">{dst}</span><span class="s2">` is the number of destination nodes in the input graph,
</span></span></span><span class="line"><span class="cl"><span class="s2">            :math:`D_</span><span class="si">{out}</span><span class="s2">` is the size of the output feature.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_compatibility_check</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">graph</span><span class="o">.</span><span class="n">local_scope</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">feat_src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feat_drop</span><span class="p">(</span><span class="n">feat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                <span class="n">feat_dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feat_drop</span><span class="p">(</span><span class="n">feat</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">feat_src</span> <span class="o">=</span> <span class="n">feat_dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feat_drop</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">graph</span><span class="o">.</span><span class="n">is_block</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">feat_dst</span> <span class="o">=</span> <span class="n">feat_src</span><span class="p">[:</span><span class="n">graph</span><span class="o">.</span><span class="n">number_of_dst_nodes</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">            <span class="n">msg_fn</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">copy_src</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">edge_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">assert</span> <span class="n">edge_weight</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">graph</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">edata</span><span class="p">[</span><span class="s1">&#39;_edge_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_weight</span>
</span></span><span class="line"><span class="cl">                <span class="n">msg_fn</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">u_mul_e</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;_edge_weight&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">h_self</span> <span class="o">=</span> <span class="n">feat_dst</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Handle the case of graphs without edges</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">graph</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;neigh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">feat_dst</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_src_feats</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">feat_dst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Determine whether to apply linear transformation before message passing A(XW)</span>
</span></span><span class="line"><span class="cl">            <span class="n">lin_before_mp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_src_feats</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_feats</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Message Passing</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggre_type</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_neigh</span><span class="p">(</span><span class="n">feat_src</span><span class="p">)</span> <span class="k">if</span> <span class="n">lin_before_mp</span> <span class="k">else</span> <span class="n">feat_src</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># graph.update_all(msg_fn, fn.mean(&#39;m&#39;, &#39;neigh&#39;))</span>
</span></span><span class="line"><span class="cl">                <span class="c1">#########################################################################</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># consdier datatype with different weight, g.edata[&#39;he&#39;] as weight here</span>
</span></span><span class="line"><span class="cl">                <span class="n">g</span><span class="o">.</span><span class="n">update_all</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">u_mul_e</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;he&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">),</span> <span class="n">fn</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="c1">#########################################################################</span>
</span></span><span class="line"><span class="cl">                <span class="n">h_neigh</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;neigh&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="ow">not</span> <span class="n">lin_before_mp</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">h_neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_neigh</span><span class="p">(</span><span class="n">h_neigh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggre_type</span> <span class="o">==</span> <span class="s1">&#39;gcn&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">check_eq_shape</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_neigh</span><span class="p">(</span><span class="n">feat_src</span><span class="p">)</span> <span class="k">if</span> <span class="n">lin_before_mp</span> <span class="k">else</span> <span class="n">feat_src</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>  <span class="c1"># heterogeneous</span>
</span></span><span class="line"><span class="cl">                    <span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_neigh</span><span class="p">(</span><span class="n">feat_dst</span><span class="p">)</span> <span class="k">if</span> <span class="n">lin_before_mp</span> <span class="k">else</span> <span class="n">feat_dst</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">graph</span><span class="o">.</span><span class="n">is_block</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">][:</span><span class="n">graph</span><span class="o">.</span><span class="n">num_dst_nodes</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">                    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">update_all</span><span class="p">(</span><span class="n">msg_fn</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;neigh&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">update_all</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">copy_e</span><span class="p">(</span><span class="s1">&#39;he&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">),</span> <span class="n">fn</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;neigh&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># divide in_degrees</span>
</span></span><span class="line"><span class="cl">                <span class="n">degs</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">in_degrees</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">feat_dst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">h_neigh</span> <span class="o">=</span> <span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;neigh&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">degs</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="ow">not</span> <span class="n">lin_before_mp</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">h_neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_neigh</span><span class="p">(</span><span class="n">h_neigh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggre_type</span> <span class="o">==</span> <span class="s1">&#39;pool&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc_pool</span><span class="p">(</span><span class="n">feat_src</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">update_all</span><span class="p">(</span><span class="n">msg_fn</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;neigh&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">update_all</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">copy_e</span><span class="p">(</span><span class="s1">&#39;he&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">),</span> <span class="n">fn</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;neigh&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">h_neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_neigh</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;neigh&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggre_type</span> <span class="o">==</span> <span class="s1">&#39;lstm&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feat_src</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">update_all</span><span class="p">(</span><span class="n">msg_fn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lstm_reducer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">h_neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_neigh</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;neigh&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Aggregator type </span><span class="si">{}</span><span class="s1"> not recognized.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aggre_type</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># GraphSAGE GCN does not require fc_self.</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggre_type</span> <span class="o">==</span> <span class="s1">&#39;gcn&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rst</span> <span class="o">=</span> <span class="n">h_neigh</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_self</span><span class="p">(</span><span class="n">h_self</span><span class="p">)</span> <span class="o">+</span> <span class="n">h_neigh</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># bias term</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rst</span> <span class="o">=</span> <span class="n">rst</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># activation</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># normalization</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">rst</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®šä¹‰æ¨¡å‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SAGE</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_size</span><span class="p">,</span> <span class="n">hid_size</span><span class="p">,</span> <span class="n">out_size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># three-layer GraphSAGE-mean</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dglnn</span><span class="o">.</span><span class="n">SAGEConv</span><span class="p">(</span><span class="n">in_size</span><span class="p">,</span> <span class="n">hid_size</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dglnn</span><span class="o">.</span><span class="n">SAGEConv</span><span class="p">(</span><span class="n">hid_size</span><span class="p">,</span> <span class="n">hid_size</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dglnn</span><span class="o">.</span><span class="n">SAGEConv</span><span class="p">(</span><span class="n">hid_size</span><span class="p">,</span> <span class="n">out_size</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">hid_size</span> <span class="o">=</span> <span class="n">hid_size</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">out_size</span> <span class="o">=</span> <span class="n">out_size</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">h</span> <span class="o">=</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="n">blocks</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="n">h</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">l</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">h</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">h</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">inference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Conduct layer-wise inference to get all the node embeddings.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">feat</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">sampler</span> <span class="o">=</span> <span class="n">MultiLayerFullNeighborSampler</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">prefetch_node_feats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">g</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">sampler</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">buffer_device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">pin_memory</span> <span class="o">=</span> <span class="p">(</span><span class="n">buffer_device</span> <span class="o">!=</span> <span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">g</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">hid_size</span> <span class="k">if</span> <span class="n">l</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_size</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">device</span><span class="o">=</span><span class="n">buffer_device</span><span class="p">,</span> <span class="n">pin_memory</span><span class="o">=</span><span class="n">pin_memory</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">feat</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">input_nodes</span><span class="p">,</span> <span class="n">output_nodes</span><span class="p">,</span> <span class="n">blocks</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">dataloader</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">x</span> <span class="o">=</span> <span class="n">feat</span><span class="p">[</span><span class="n">input_nodes</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="n">h</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span> <span class="c1"># len(blocks) = 1</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">l</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">h</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># by design, our output nodes are contiguous</span>
</span></span><span class="line"><span class="cl">                <span class="n">y</span><span class="p">[</span><span class="n">output_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">output_nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">buffer_device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">feat</span> <span class="o">=</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">y</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®šä¹‰è®­ç»ƒã€æ¨ç†çš„å‡½æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">dataloader</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_hats</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">it</span><span class="p">,</span> <span class="p">(</span><span class="n">input_nodes</span><span class="p">,</span> <span class="n">output_nodes</span><span class="p">,</span> <span class="n">blocks</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataloader</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">x</span> <span class="o">=</span> <span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">y_hats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">MF</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">y_hats</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">ys</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">layerwise_infer</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span> <span class="c1"># pred in buffer_device</span>
</span></span><span class="line"><span class="cl">        <span class="n">pred</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">label</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">nid</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">MF</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">val_idx</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># create sampler &amp; dataloader</span>
</span></span><span class="line"><span class="cl">    <span class="n">sampler</span> <span class="o">=</span> <span class="n">NeighborSampler</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>  <span class="c1"># fanout for [layer-0, layer-1, layer-2]</span>
</span></span><span class="line"><span class="cl">                              <span class="n">prefetch_node_feats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                              <span class="n">prefetch_labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">use_uva</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;mixed&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">train_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">sampler</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                  <span class="n">batch_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                  <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                  <span class="n">use_uva</span><span class="o">=</span><span class="n">use_uva</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">val_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">val_idx</span><span class="p">,</span> <span class="n">sampler</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">batch_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">use_uva</span><span class="o">=</span><span class="n">use_uva</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">opt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">5e-4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">total_loss</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">it</span><span class="p">,</span> <span class="p">(</span><span class="n">input_nodes</span><span class="p">,</span> <span class="n">output_nodes</span><span class="p">,</span> <span class="n">blocks</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">x</span> <span class="o">=</span> <span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">y</span> <span class="o">=</span> <span class="n">blocks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">y_hat</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">opt</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">opt</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">total_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">acc</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">val_dataloader</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Epoch </span><span class="si">{:05d}</span><span class="s2"> | Loss </span><span class="si">{:.4f}</span><span class="s2"> | Accuracy </span><span class="si">{:.4f}</span><span class="s2"> &#34;</span>
</span></span><span class="line"><span class="cl">              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">total_loss</span> <span class="o">/</span> <span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">acc</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä» NebulaGraph ä¸­åŠ è½½å›¾åˆ° DGLï¼Œå¾—åˆ°çš„æ˜¯ä¸€ä¸ªå¼‚æ„å›¾ï¼ˆä¸€ç±»ç‚¹ã€ä¸‰ç±»è¾¹ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula_dgl</span> <span class="kn">import</span> <span class="n">NebulaLoader</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">nebula_config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;graph_hosts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd1&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd2&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;user&#34;</span><span class="p">:</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;nebula&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;nebulagraph_yelp_dgl_mapper.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">     <span class="n">feature_mapper</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">nebula_loader</span> <span class="o">=</span> <span class="n">NebulaLoader</span><span class="p">(</span><span class="n">nebula_config</span><span class="p">,</span> <span class="n">feature_mapper</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">nebula_loader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span> <span class="c1"># This will take you some time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä½œä¸ºç©·äººï¼Œæˆ‘ä»¬ç”¨ CPU</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ†å‡ºè®­ç»ƒã€éªŒè¯ã€æµ‹è¯•é›†ï¼Œç„¶åè½¬æ¢æˆåŒæ„å›¾ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Split the graph into train, validation and test sets</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># features are g.ndata[&#39;f0&#39;], g.ndata[&#39;f1&#39;], g.ndata[&#39;f2&#39;], ... g.ndata[&#39;f31&#39;]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># label is in g.ndata[&#39;is_fraud&#39;]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># concatenate all features</span>
</span></span><span class="line"><span class="cl"><span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;is_fraud&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># numpy array as index of range n</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># features.append(idx)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># concatenate one dim with index of node</span>
</span></span><span class="line"><span class="cl"><span class="c1"># feature_and_idx = torch.stack(features, dim=1)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># split based on value distribution of label: the property &#34;is_fraud&#34;, which is a binary variable.</span>
</span></span><span class="line"><span class="cl"><span class="n">X_train_and_val_idx</span><span class="p">,</span> <span class="n">X_test_idx</span><span class="p">,</span> <span class="n">y_train_and_val</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">idx</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;is_fraud&#39;</span><span class="p">],</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;is_fraud&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># split train and val</span>
</span></span><span class="line"><span class="cl"><span class="n">X_train_idx</span><span class="p">,</span> <span class="n">X_val_idx</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">X_train_and_val_idx</span><span class="p">,</span> <span class="n">y_train_and_val</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_train_and_val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># list of index to mask</span>
</span></span><span class="line"><span class="cl"><span class="n">train_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">train_mask</span><span class="p">[</span><span class="n">X_train_idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">val_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">val_mask</span><span class="p">[</span><span class="n">X_val_idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">test_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">test_mask</span><span class="p">[</span><span class="n">X_test_idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;train_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_mask</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;val_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_mask</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;test_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_mask</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># shares_restaurant_in_one_month_with: 1, b&#34;001&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># shares_restaurant_rating_with: 2, b&#34;010&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># shares_user_with: 4, b&#34;100&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># set edata of shares_restaurant_in_one_month_with to n of 1 tensor array</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">),),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_user_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_user_with&#39;</span><span class="p">),),</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># heterogeneous graph to heterogeneous graph, keep ndata and edata</span>
</span></span><span class="line"><span class="cl"><span class="n">hg</span> <span class="o">=</span> <span class="n">dgl</span><span class="o">.</span><span class="n">to_homogeneous</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">edata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">],</span> <span class="n">ndata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;train_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;val_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;test_mask&#39;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®­ç»ƒã€æµ‹è¯•æ¨¡å‹ï¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># create GraphSAGE model</span>
</span></span><span class="line"><span class="cl"><span class="n">in_size</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">out_size</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">SAGE</span><span class="p">(</span><span class="n">in_size</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">out_size</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># model training</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">train</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X_train_idx</span><span class="p">,</span> <span class="n">X_val_idx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># test the model</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testing...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">acc</span> <span class="o">=</span> <span class="n">layerwise_infer</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">X_test_idx</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Test Accuracy </span><span class="si">{:.4f}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿è¡Œç»“æœ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Test Accuracy 0.9996</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº†æ¨¡å‹ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒåºåˆ—åŒ–æˆæ–‡ä»¶ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠæ¨¡å‹çš„å½¢å¼å’Œè¿™ä¸ªåºåˆ—åŒ–æ–‡ä»¶å†åŠ è½½æˆä¸€ä¸ª pyTorch å°±å¯ä»¥ç”¨å®ƒè¿›è¡Œæ¨ç†äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># save model</span>
</span></span><span class="line"><span class="cl"><span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="s2">&#34;fraud_d.model&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># load model</span>
</span></span><span class="line"><span class="cl"><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">SAGE</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&#34;fraud_d.model&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œæˆ‘ä»¬å¦‚ä½•æŠŠæ¨¡å‹æ”¾åˆ°æˆ‘ä»¬çš„çº¿ä¸Šæ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿé‡Œå‘¢ï¼Ÿ</p>
<h5 id="æ¨ç†æ¥å£" class="headerLink">
    <a href="#%e6%8e%a8%e7%90%86%e6%8e%a5%e5%8f%a3" class="header-mark"></a>1.5.1.4 æ¨ç†æ¥å£</h5><p>å‰è¾¹æåˆ°è¿‡ï¼Œ GraphSAGE æ˜¯æœ€ç®€å•çš„æ”¯æŒ Inductive Learning çš„æ¨¡å‹ï¼Œè€Œä¸Šè¾¹æˆ‘ä»¬çš„è®­ç»ƒæ¨ç†è¿‡ç¨‹å®é™…ä¸Šè¿˜ä¸æ˜¯è¿™æ ·çš„æˆ‘ä»¬çš„æµ‹è¯•å’Œè®­ç»ƒçš„å›¾æ˜¯åŒä¸€å¼ ï¼Œè™½ç„¶æ ‡æ³¨äº†è®­ç»ƒçš„ç‚¹çš„ç´¢å¼•ï¼Œä½†å®é™…ä¸Šæ˜¯æ•´å¼ å›¾ä½œä¸ºè¾“å…¥çš„ã€‚ä¸ºäº†åšåˆ°Inductive Learning æˆ‘ä»¬åªéœ€è¦æŠŠè®­ç»ƒå’Œæµ‹è¯•åˆ†æˆä¸¤ä¸ªæ— äº¤é›†çš„å­å›¾æ¥åšè®­ç»ƒå’Œæœ€ç»ˆæµ‹è¯•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Inductive Learning, our test dataset are new nodes and new edges</span>
</span></span><span class="line"><span class="cl"><span class="n">hg_train</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">X_train_idx</span><span class="p">,</span> <span class="n">X_val_idx</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># model training</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">train</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">hg_train</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">X_train_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">X_train_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hg_train</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># test the model</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testing...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">hg_test</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">X_test_idx</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sg_X_test_idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">hg_test</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">acc</span> <span class="o">=</span> <span class="n">layerwise_infer</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">hg_test</span><span class="p">,</span> <span class="n">sg_X_test_idx</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Test Accuracy </span><span class="si">{:.4f}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿è¡Œç»“æœ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Test Accuracy 0.9990</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸Šè¾¹çš„ä»£ç é‡Œï¼Œæµ‹è¯•æ‰€ç”¨åˆ°çš„å›¾å’Œè®­ç»ƒçš„å›¾æ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ç»„æ•°æ®ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬çš„çº¿ä¸Šç³»ç»Ÿå¯ä»¥æ˜¯ä¹‹å‰å®Œå…¨æ²¡æœ‰é‡åˆ°çš„æ•°æ®ï¼Œæˆ‘ä»¬åªè¦æŠŠå¯¹æ–°æ¥çš„ä¸€ä¸ªäº¤æ˜“è¯·æ±‚æ•°æ®å†™è¿› NebulaGraphï¼Œç„¶åå†ä»è¿™ä¸ªç‚¹è·å–ä¸€ä¸ªçº¿ä¸Šç³»ç»Ÿå¯ä»¥è¿”å›çš„å°å­å›¾ï¼Œå°±å¯ä»¥æŠŠå®ƒä½œä¸ºæ¨¡å‹æ¨ç†çš„è¾“å…¥ï¼Œè·å¾—å­å›¾çš„æ ‡ç­¾äº†ï¼</p>
<p><strong>æ–°çš„äº¤æ˜“è¯·æ±‚</strong>ï¼š</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬å‰è¾¹ç”»çš„çº¿ä¸Šæ¨ç†ç³»ç»Ÿçš„æµç¨‹å›¾ä¹ˆï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      
</span></span><span class="line"><span class="cl">      â”‚                     â”‚                          â”‚                 â”‚
</span></span><span class="line"><span class="cl">â”€â”€â”€â”€â”€â–¶â”‚ Transaction Record  â”œâ”€â”€â”€â”€â”€â”€2. Fraud Risk â”€â”€â”€â”€â”€â–¶â”‚  Inference API  â”‚â—€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">      â”‚                     â”‚â—€â”€â”€â”€â”€Prediction with â”€â”€â”€â”€â”€â”¤                 â”‚     â”‚
</span></span><span class="line"><span class="cl">      â”‚                     â”‚        Sub Graph         â”‚                 â”‚     â”‚
</span></span><span class="line"><span class="cl">      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
</span></span><span class="line"><span class="cl">           â”‚           â–²                                        â”‚              â”‚
</span></span><span class="line"><span class="cl">           â”‚           â”‚                                        â”‚              â”‚
</span></span><span class="line"><span class="cl">       0. Insert   1. Get New                              3.req: Node         â”‚
</span></span><span class="line"><span class="cl">         Record    Record Sub                            Classification        â”‚
</span></span><span class="line"><span class="cl">           â”‚         Graph                                      â”‚              â”‚
</span></span><span class="line"><span class="cl">           â–¼           â”‚                                        â”‚              â”‚
</span></span><span class="line"><span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      3.resp: â”‚
</span></span><span class="line"><span class="cl">â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚                          Predictedâ”‚
</span></span><span class="line"><span class="cl">â”‚â”‚   Graph of Historical Transactions   â”‚â”‚ â”‚                             Risk  â”‚
</span></span><span class="line"><span class="cl">â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚                                   â”‚
</span></span><span class="line"><span class="cl">â”‚                   .â”€.              .   â”‚ â”‚                                   â”‚
</span></span><span class="line"><span class="cl">â”‚                  (   )â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€( )  â”‚ â”‚                                   â”‚
</span></span><span class="line"><span class="cl">â”‚                   `â”€&#39;              &#39;   â”‚ â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
</span></span><span class="line"><span class="cl">â”‚  .       .â”€.       â•²             â—     â”‚ â”‚      â”‚ GNN Model Î›          â”‚     â”‚
</span></span><span class="line"><span class="cl">â”‚ ( )â—€â”€â”€â”€â”€(   )       â•²           â•±      â”‚ â”‚  â”Œâ”€â”€â”€â”´â”€â”        â•± â•²      â”Œâ”€â”€â”´â”€â”€â”  â”‚
</span></span><span class="line"><span class="cl">â”‚  &#39;       `â”€&#39;         â•²       . â•±       â”‚ â”‚  â”œâ”€â”€â”€â”€â”€â”¤       â•±   â•²     â”œâ”€â”€â”€â”€â”€â”¤  â”‚
</span></span><span class="line"><span class="cl">â”‚  â•²       â—€            â•²     ( )        â”‚ â””â”€â–¶â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â–¶â–•     â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”¤â”€â”€â”˜
</span></span><span class="line"><span class="cl">â”‚   â•²  .  â•±              â—     &#39;         â”‚    â”œâ”€â”€â”€â”€â”€â”¤       â•²   â•±     â”œâ”€â”€â”€â”€â”€â”¤   
</span></span><span class="line"><span class="cl">â”‚    â—€( )â•±               .â”€.         .â”€. â”‚    â””â”€â”€â”€â”¬â”€â”˜        â•² â•±      â””â”€â”€â”¬â”€â”€â”˜   
</span></span><span class="line"><span class="cl">â”‚      &#39;                (   )â—€â”€â”€â”€â”€â”€â”€(   )â”‚        â”‚           V          â”‚      
</span></span><span class="line"><span class="cl">â”‚                        `â”€&#39;         `â”€&#39; â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      
</span></span><span class="line"><span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å‡è®¾è¿™ä¸ªæ–°çš„äº¤æ˜“è¯·æ±‚å·²ç»å‘èµ·äº†ï¼Œè¿™æ¡äº¤æ˜“è®°å½•å·²ç»è¢«æ›´æ–°åœ¨å›¾è°±é‡Œäº†ï¼Œå’±ä»¬éšä¾¿å–ä¸€ä¸ªç‚¹ä½œä¸ºè¿™æ ·çš„è¯·æ±‚å§</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-graphql" data-lang="graphql"><span class="line"><span class="cl"><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">n</span><span class="p">:</span><span class="nc">review</span><span class="p">)</span><span class="w"> </span><span class="py">RETURN</span><span class="w"> </span><span class="py">n</span><span class="w"> </span><span class="py">LIMIT</span><span class="w"> </span><span class="py">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GRAPHQL" data-lang="GRAPHQL"><span class="line"><span class="cl"><span class="err">+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">|</span><span class="w"> </span><span class="py">n</span><span class="w">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </span><span class="p">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">|</span><span class="w"> </span><span class="p">(</span><span class="py">2048</span><span class="w"> </span><span class="p">:</span><span class="nc">review</span><span class="p">{</span><span class="py">f0</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.0</span><span class="p">,</span><span class="w"> </span><span class="py">f1</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.08034700155258179</span><span class="p">,</span><span class="w"> </span><span class="py">f10</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.3952670097351074</span><span class="p">,</span><span class="w"> </span><span class="py">f11</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.18671999871730804</span><span class="p">,</span><span class="w"> </span><span class="py">f12</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.2836120128631592</span><span class="p">,</span><span class="w"> </span><span class="py">f13</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.2843089997768402</span><span class="p">,</span><span class="w"> </span><span class="py">f14</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.38148200511932373</span><span class="p">,</span><span class="w"> </span><span class="py">f15</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.3816460072994232</span><span class="p">,</span><span class="w"> </span><span class="py">f16</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.9999740123748779</span><span class="p">,</span><span class="w"> </span><span class="py">f17</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.6430919766426086</span><span class="p">,</span><span class="w"> </span><span class="py">f18</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.9999740123748779</span><span class="p">,</span><span class="w"> </span><span class="py">f19</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.5051100254058838</span><span class="p">,</span><span class="w"> </span><span class="py">f2</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.12382200360298157</span><span class="p">,</span><span class="w"> </span><span class="py">f20</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.4940490126609802</span><span class="p">,</span><span class="w"> </span><span class="py">f21</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.7766339778900146</span><span class="p">,</span><span class="w"> </span><span class="py">f22</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.7705119848251343</span><span class="p">,</span><span class="w"> </span><span class="py">f23</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.9480599761009216</span><span class="p">,</span><span class="w"> </span><span class="py">f24</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.4032529890537262</span><span class="p">,</span><span class="w"> </span><span class="py">f25</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.12437800318002701</span><span class="p">,</span><span class="w"> </span><span class="py">f26</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.3184080123901367</span><span class="p">,</span><span class="w"> </span><span class="py">f27</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.5223879814147949</span><span class="p">,</span><span class="w"> </span><span class="py">f28</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.4278610050678253</span><span class="p">,</span><span class="w"> </span><span class="py">f29</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.343284010887146</span><span class="p">,</span><span class="w"> </span><span class="py">f3</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.42868199944496155</span><span class="p">,</span><span class="w"> </span><span class="py">f30</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.37313398718833923</span><span class="p">,</span><span class="w"> </span><span class="py">f31</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.328357994556427</span><span class="p">,</span><span class="w"> </span><span class="py">f4</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.9999849796295166</span><span class="p">,</span><span class="w"> </span><span class="py">f5</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.9999849796295166</span><span class="p">,</span><span class="w"> </span><span class="py">f6</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.9999849796295166</span><span class="p">,</span><span class="w"> </span><span class="py">f7</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.4850809872150421</span><span class="p">,</span><span class="w"> </span><span class="py">f8</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.454602986574173</span><span class="p">,</span><span class="w"> </span><span class="py">f9</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.8863419890403748</span><span class="p">,</span><span class="w"> </span><span class="py">is_fraud</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="p">})</span><span class="w"> </span><span class="p">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¥½ï¼Œå®ƒæ˜¯ 2048 è¿™ä¸ªç‚¹ã€‚å®ƒçš„ä¸‹ä¸€æ­¥æ˜¯ <code>1. Get New Record Subgraph</code> æˆ‘ä»¬æ¥è·å–å®ƒçš„å­å›¾ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">GET</span><span class="w"> </span><span class="n">SUBGRAPH</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">PROP</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="mi">2048</span><span class="w"> </span><span class="n">YIELD</span><span class="w"> </span><span class="n">VERTICES</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes</span><span class="p">,</span><span class="w"> </span><span class="n">EDGES</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">relationships</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°è¿”å›çš„ç»“æœå…¶å®è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œä¸è¿‡å¯¹äº NebulaGraph æ¥è¯´ï¼Œè¿™ä¸ªå­å›¾ç»“æœè¿”å›æ˜¯åœ¨ 10 ms å·¦å³è·å–çš„ï¼Œè¿™é‡Œæˆ‘å°±ä¸è´´å‡ºæ¥äº†ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ NebulaGraph Studio æˆ–è€… Explorer ä¸­å¯ä»¥æŠŠç»“æœæ¸²æŸ“å‡ºæ¥ï¼ˆå¯è§†åŒ–å±•ç¤ºçš„ Query å¯ä»¥å»æ‰ <code>WITH PROP</code> ï¼Œå¯ä»¥ç»™æµè§ˆå™¨çœç‚¹å†…å­˜ï¼‰ï¼Œç»“æœå°±æ›´å®¹æ˜“è®©äººè„‘ç†è§£äº†ï¼š</p>
<p></p>
<p></p>
<p>ç°åœ¨æˆ‘ä»¬å°±æ¥å®ç°è¿™ä¸€æ­¥çš„ä»£ç å§ï¼Œå®ƒçš„è¾“å…¥æ˜¯ç‚¹çš„ idï¼š<code>vertex_id</code>ã€‚è¾“å‡ºæ˜¯ä¸€ä¸ª <code>dgl_graph</code>ï¼Œç”¨æ¥ä¼ ç»™æ¨ç†æ¥å£ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># get SUBGRAPH of one node</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">tensor</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dgl</span> <span class="kn">import</span> <span class="n">DGLHeteroGraph</span><span class="p">,</span> <span class="n">heterograph</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula3.gclient.net</span> <span class="kn">import</span> <span class="n">ConnectionPool</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula3.Config</span> <span class="kn">import</span> <span class="n">Config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">config</span><span class="o">.</span><span class="n">max_connection_pool_size</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">ConnectionPool</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">connection_pool</span><span class="o">.</span><span class="n">init</span><span class="p">([(</span><span class="s1">&#39;graphd&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">)],</span> <span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">vertex_id</span> <span class="o">=</span> <span class="mi">2048</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;nebula&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">execute_json</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;USE yelp;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="sa">f</span><span class="s2">&#34;GET SUBGRAPH WITH PROP 2 STEPS FROM </span><span class="si">{</span><span class="n">vertex_id</span><span class="si">}</span><span class="s2"> YIELD VERTICES AS nodes, EDGES AS relationships;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œæˆ‘ç”¨åˆ°äº† Nebula-Python è¿™ä¸ª NebulaGraph çš„ Python SDK/Clientï¼Œé€šè¿‡ <code>execute_json</code> æ‰§è¡Œè·å¾—äº†è¿™ä¸ªäº¤æ˜“çš„å­å›¾ã€‚ä¸‹ä¸€æ­¥ï¼Œå’±ä»¬éœ€è¦æŠŠå®ƒæ„é€ æˆä¸€ä¸ª <code>dgl_graph</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># create node and nodedata</span>
</span></span><span class="line"><span class="cl"><span class="n">node_id_map</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key: vertex id in NebulaGraph, value: node id in dgl_graph</span>
</span></span><span class="line"><span class="cl"><span class="n">node_idx</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">features</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[[]]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="n">nodeid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">nodeid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_id_map</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">node_id_map</span><span class="p">[</span><span class="n">nodeid</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_idx</span>
</span></span><span class="line"><span class="cl">            <span class="n">node_idx</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">features</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;row&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="sa">f</span><span class="s2">&#34;review.f</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">features</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;row&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;review.is_fraud&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">- R-U-Rï¼šä¸¤ä¸ªè¯„ä»·ç”±åŒä¸€ä¸ªç”¨æˆ·å‘å‡º shares_user_with
</span></span></span><span class="line"><span class="cl"><span class="s2">- R-S-Rï¼šä¸¤ä¸ªè¯„ä»·æ˜¯åŒé¤å…åŒè¯„åˆ†ï¼ˆè¯„åˆ†å¯ä»¥æ˜¯1åˆ°5ï¼‰ shares_restaurant_rating_with
</span></span></span><span class="line"><span class="cl"><span class="s2">- R-T-Rï¼šä¸¤ä¸ªè¯„ä»·æ˜¯åŒé¤å…åŒæäº¤æœˆä»½ shares_restaurant_in_one_month_with
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">rur_start</span><span class="p">,</span> <span class="n">rur_end</span><span class="p">,</span> <span class="n">rsr_start</span><span class="p">,</span> <span class="n">rsr_end</span><span class="p">,</span> <span class="n">rtr_start</span><span class="p">,</span> <span class="n">rtr_end</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="n">edge</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shares_user_with&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rur_start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">            <span class="n">rur_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rsr_start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">            <span class="n">rsr_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rtr_start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">            <span class="n">rtr_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">rur_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_dict</span><span class="p">[(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="s1">&#39;shares_user_with&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rur_start</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rur_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">rsr_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_dict</span><span class="p">[(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rsr_start</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rsr_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">rtr_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_dict</span><span class="p">[(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rtr_start</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rtr_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># construct a dgl_graph</span>
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="p">:</span> <span class="n">DGLHeteroGraph</span> <span class="o">=</span> <span class="n">heterograph</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®é™…ä¸Šæˆ‘å°±æ˜¯æŒ‰ç…§ DGL æ–‡æ¡£ï¼šhttps://docs.dgl.ai/en/0.9.x/generated/dgl.heterograph.htmlï¼Œä¸­çš„æ–¹å¼å»æ„é€  <code>data_dict</code>ï¼Œç„¶åç”¨ <code>heterograph()</code> å°±æŠŠç»“æœè½¬æ¢ä¸ºæƒ³è¦çš„ dgl_graph äº†ï¼Œå…¶ä¸­ <code>node_id_map</code> æ˜¯ NebulaGraph ä¹‹ä¸­ Vertex_ID åˆ°è¿™ä¸ªå¯¹è±¡ä¸­ node_id çš„å­—å…¸ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å†æŠŠ node feature ä¹ŸåŠ è½½è¿›å»ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># load node features to dgl_graph</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">dgl_graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="sa">f</span><span class="s2">&#34;f</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="mi">32</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å¼€å§‹æ¨ç†ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŠŠå®ƒè½¬æ¢æˆåŒæ„å›¾ï¼Œå’Œå‰è¾¹å®Œå…¨ä¸€æ ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># to homogeneous graph</span>
</span></span><span class="line"><span class="cl"><span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dgl_graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="sa">f</span><span class="s2">&#34;f</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">dgl_graph</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">dgl_graph</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">),),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_user_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">dgl_graph</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_user_with&#39;</span><span class="p">),),</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># heterogeneous graph to heterogeneous graph, keep ndata and edata</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">dgl</span>
</span></span><span class="line"><span class="cl"><span class="n">hg</span> <span class="o">=</span> <span class="n">dgl</span><span class="o">.</span><span class="n">to_homogeneous</span><span class="p">(</span><span class="n">dgl_graph</span><span class="p">,</span> <span class="n">edata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">],</span> <span class="n">ndata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œæˆ‘ä»¬çš„æ¨ç†æ¥å£å°±æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">do_inference</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span> <span class="c1"># pred in buffer_device</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">pred</span><span class="p">[</span><span class="n">node_idx</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¯ä»¥è°ƒç”¨ä¸€ä¸ªä¸€ä¸‹è¯•è¯•æ¨ç†æˆ‘ä»¬è¿™ä¸ªæ–°çš„ç‚¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">node_idx</span> <span class="o">=</span> <span class="n">node_id_map</span><span class="p">[</span><span class="n">vertex_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">4096</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">do_inference</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½åœ¨è¿™ä¸ªå°å­å›¾ä¸Šè®¡ç®—ä»–çš„æ­£ç¡®ç‡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test_inference</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span> <span class="c1"># pred in buffer_device</span>
</span></span><span class="line"><span class="cl">        <span class="n">pred</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">label</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">nid</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">MF</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">node_idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">node_id_map</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl"><span class="n">acc</span> <span class="o">=</span> <span class="n">test_inference</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Test Accuracy </span><span class="si">{:.4f}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¾“å‡ºç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">307</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">test_inference</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>     <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>     <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>         <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span> <span class="c1"># pred in buffer</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span> <span class="n">_device</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>         <span class="n">pred</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>         <span class="n">label</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">nid</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">MF</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span> <span class="n">node_idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">node_id_map</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span> <span class="n">acc</span> <span class="o">=</span> <span class="n">test_inference</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Test Accuracy </span><span class="si">{:.4f}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="mi">100</span><span class="o">%|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">&lt;</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mf">130.31</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="mi">100</span><span class="o">%|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">&lt;</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mf">152.29</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="mi">100</span><span class="o">%|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">&lt;</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mf">173.55</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Test</span> <span class="n">Accuracy</span> <span class="mf">0.9688</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä¼šæŠŠç«¯åˆ°åˆ°çš„é¡¹ç›®ä»£ç å¼€æºåˆ° GitHub ä¸Šï¼Œå®Œæˆåä¼šå›æ¥æ›´æ–°æœ¬æ–‡ï¼Œå¢åŠ ä»£ç ä»“åº“çš„åœ°å€ï¼Œæ•¬è¯·æœŸå¾…ï¼</p>
<h3 id="æ€»ç»“" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93" class="header-mark"></a>1.6 æ€»ç»“</h3><p>æ€»ç»“èµ·æ¥ï¼Œæ¬ºè¯ˆæ£€æµ‹çš„æ–¹æ³•æœ‰ï¼š</p>
<ul>
<li>åœ¨ä¸€ä¸ªäº¤æ˜“å†å²ã€é£æ§çš„å›¾è°±ä¸Šï¼Œé€šè¿‡å›¾æ¨¡å¼æŸ¥è¯¢ç›´æ¥è·å¾—é£é™©æç¤º</li>
<li>å®šæœŸåˆ©ç”¨å›¾ç®—æ³•æ‰©å……é£é™©æ ‡æ³¨ï¼Œå†™å›å›¾åº“</li>
<li>å®šæœŸè®¡ç®—å›¾è°±ä¸­çš„å›¾ç‰¹å¾ï¼Œå’Œå…¶ä»–ç‰¹å¾ä¸€èµ·ç”¨ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ–¹æ³•ç¦»çº¿é¢„æµ‹é£é™©</li>
<li>å°†å›¾è°±ä¸­çš„å±æ€§å¤„ç†æˆä¸ºç‚¹ã€è¾¹ç‰¹å¾ï¼Œç”¨å›¾ç¥ç»ç½‘ç»œæ–¹æ³•ç¦»çº¿é¢„æµ‹é£é™©ï¼Œéƒ¨åˆ†å¯ä»¥ Inductive Learning çš„æ–¹æ³•ç»“åˆå›¾åº“å¯ä»¥å®ç°åœ¨çº¿é£é™©é¢„æµ‹</li>
</ul>
<blockquote>
<p>Feature Image credit goes to <a href="https://unsplash.com/photos/BW0vK-FA3eg" target="_blank" rel="noopener noreffer">https://unsplash.com/photos/BW0vK-FA3eg</a></p>
</blockquote>]]></description>
</item><item>
    <title>ä¸€æ–‡äº†è§£ Nebula Graph ä¸Šçš„ Spark é¡¹ç›®</title>
    <link>https://siwei.io/spark-on-nebula-graph/</link>
    <pubDate>Mon, 06 Jun 2022 10:19:11 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/spark-on-nebula-graph/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>Nebula Graph ç”Ÿæ€ä¸­æœ‰å“ªäº› Spark é¡¹ç›®ï¼Ÿ æœ¬æ–‡ä¸ºå¤§å®¶ä»‹ç» Spark-connectorï¼ˆåŒ…æ‹¬ PySparkï¼‰ï¼Œ Nebula Algorithm å’Œ Nebula Exchangeã€‚</p>
</blockquote>
<p>æœ€è¿‘æˆ‘è¯•ç€æ­å»ºäº†æ–¹ä¾¿å¤§å®¶ä¸€é”®è¯•ç©çš„ Nebula Graph ä¸­çš„ <a href="https://spark.apache.org/" target="_blank" rel="noopener noreffer">Spark</a> ç›¸å…³çš„é¡¹ç›®ï¼Œä»Šå¤©å°±æŠŠå®ƒä»¬æ•´ç†æˆæ–‡åˆ†äº«ç»™å¤§å®¶ã€‚è€Œä¸”ï¼Œæˆ‘è¶Ÿå‡ºæ¥äº† PySpark ä¸‹çš„ Nebula Spark Connector çš„ä½¿ç”¨æ–¹å¼ï¼Œåè¾¹ä¹Ÿä¼šä¸€å¹¶è´¡çŒ®åˆ°æ–‡æ¡£é‡Œã€‚</p>
<h2 id="nebula-graph-çš„ä¸‰ä¸ª-spark-å­é¡¹ç›®" class="headerLink">
    <a href="#nebula-graph-%e7%9a%84%e4%b8%89%e4%b8%aa-spark-%e5%ad%90%e9%a1%b9%e7%9b%ae" class="header-mark"></a>1 Nebula Graph çš„ä¸‰ä¸ª Spark å­é¡¹ç›®</h2><p>æˆ‘æ›¾ç»å›´ç»• Nebula Graph çš„æ‰€æœ‰æ•°æ®å¯¼å…¥æ–¹æ³•ç”»è¿‡ä¸€ä¸ª<a href="https://www.siwei.io/sketches/nebula-data-import-options/" target="_blank" rel="noopener noreffer">è‰å›¾</a>ï¼Œå…¶ä¸­å·²ç»åŒ…å«äº† Spark Connectorï¼ŒNebula Exchange çš„ç®€å•ä»‹ç»ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘å°†å®ƒä»¬å’Œå¦å¤–çš„ Nebula Algorithm è¿›è¡Œç¨å¾®æ·±å…¥çš„æ¢è®¨ã€‚</p>
<p>TL;DR</p>
<ul>
<li>Nebula Spark Connector æ˜¯ä¸€ä¸ª Spark Libï¼Œå®ƒèƒ½è®© Spark åº”ç”¨ç¨‹åºèƒ½å¤Ÿä»¥ <code>dataframe</code> çš„å½¢å¼ä» Nebula Graph ä¸­è¯»å–å’Œå†™å…¥å›¾æ•°æ®ã€‚</li>
<li>Nebula Exchange å»ºç«‹åœ¨ Nebula Spark Connector ä¹‹ä¸Šï¼Œä½œä¸ºä¸€ä¸ª Spark Lib åŒæ—¶å¯ä»¥ç›´æ¥è¢« Spark æäº¤ JAR åŒ…æ‰§è¡Œçš„åº”ç”¨ç¨‹åºï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯å’Œ Nebula Graph äº¤æ¢ä¸åŒçš„æ•°æ®æºï¼ˆå¯¹äºå¼€æºç‰ˆæœ¬ï¼Œå®ƒæ˜¯å•å‘çš„ï¼šå†™å…¥ï¼Œè€Œå¯¹äºä¼ä¸šç‰ˆæœ¬ï¼Œå®ƒæ˜¯åŒå‘çš„ï¼‰ã€‚Nebula Exchange æ”¯æŒçš„å¾ˆå¤šä¸åŒç±»å‹çš„æ•°æ®æºå¦‚ï¼š<a href="https://www.mysql.com/cn/" target="_blank" rel="noopener noreffer">MySQL</a>ã€<a href="https://neo4j.com/" target="_blank" rel="noopener noreffer">Neo4j</a>ã€<a href="https://www.postgresql.org/" target="_blank" rel="noopener noreffer">PostgreSQL</a>ã€<a href="https://clickhouse.com/" target="_blank" rel="noopener noreffer">ClickHouse</a>ã€<a href="https://hive.apache.org/" target="_blank" rel="noopener noreffer">Hive</a> ç­‰ã€‚é™¤äº†ç›´æ¥å†™å…¥ Nebula Graphï¼Œå®ƒè¿˜å¯ä»¥é€‰æ‹©ç”Ÿæˆ SST æ–‡ä»¶ï¼Œå¹¶å°†å…¶æ³¨å…¥ Nebula Graphï¼Œä»¥ä¾¿ä½¿ç”¨ Nebula Graph é›†ç¾¤ä¹‹å¤–ç®—åŠ›å¸®åŠ©æ’åºåº•å±‚ã€‚</li>
<li>Nebula Algorithmï¼Œå»ºç«‹åœ¨ Nebula Spark Connector å’Œ GraphX ä¹‹ä¸Šï¼Œä¹Ÿæ˜¯ä¸€ä¸ªSpark Lib å’Œ Spark ä¸Šçš„åº”ç”¨ç¨‹åºï¼Œå®ƒç”¨æ¥åœ¨ Nebula Graph çš„å›¾ä¸Šè¿è¡Œå¸¸ç”¨çš„å›¾ç®—æ³•ï¼ˆpagerankï¼ŒLPAç­‰ï¼‰ã€‚</li>
</ul>
<h2 id="nebula-spark-connector" class="headerLink">
    <a href="#nebula-spark-connector" class="header-mark"></a>2 Nebula Spark Connector</h2><ul>
<li>ä»£ç ï¼šhttps://github.com/vesoft-inc/nebula-spark-connector</li>
<li>æ–‡æ¡£ï¼šhttps://docs.nebula-graph.io/3.1.0/nebula-spark-connector/</li>
<li>JAR åŒ…ï¼šhttps://repo1.maven.org/maven2/com/vesoft/nebula-spark-connector/</li>
<li>ä»£ç ä¾‹å­ï¼š<a href="https://github.com/vesoft-inc/nebula-spark-connector/tree/master/example" target="_blank" rel="noopener noreffer">example</a></li>
</ul>
<h3 id="nebula-graph-spark-reader" class="headerLink">
    <a href="#nebula-graph-spark-reader" class="header-mark"></a>2.1 Nebula Graph Spark Reader</h3><p>ä¸ºäº†ä» Nebula Graph ä¸­è¯»å–æ•°æ®ï¼Œæ¯”å¦‚è¯» vertexï¼ŒNebula Spark Connector å°†æ‰«ææ‰€æœ‰å¸¦æœ‰ç»™å®š TAG çš„ Nebula StorageDï¼Œæ¯”å¦‚è¿™æ ·è¡¨ç¤ºæ‰«æ <code>player</code> è¿™ä¸ª TAG ï¼š<code>withLabel(&quot;player&quot;)</code>ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®š vertex çš„å±æ€§ï¼š<code>withReturnCols(List(&quot;name&quot;, &quot;age&quot;))</code>ã€‚</p>
<p>æŒ‡å®šå¥½æ‰€æœ‰çš„è¯» TAG ç›¸å…³çš„é…ç½®ä¹‹åï¼Œè°ƒç”¨ <code>spark.read.nebula.loadVerticesToDF</code> è¿”å›å¾—åˆ°çš„å°±æ˜¯æ‰«æ Nebula Graph ä¹‹åè½¬æ¢ä¸º Dataframe çš„å›¾æ•°æ®ï¼Œåƒè¿™æ ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">readVertex</span><span class="o">(</span><span class="n">spark</span><span class="k">:</span> <span class="kt">SparkSession</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nc">LOG</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&#34;start to read nebula vertices&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">config</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">      <span class="nc">NebulaConnectionConfig</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">withMetaAddress</span><span class="o">(</span><span class="s">&#34;metad0:9559,metad1:9559,metad2:9559&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">withConenctionRetry</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">build</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">nebulaReadVertexConfig</span><span class="k">:</span> <span class="kt">ReadNebulaConfig</span> <span class="o">=</span> <span class="nc">ReadNebulaConfig</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withSpace</span><span class="o">(</span><span class="s">&#34;basketballplayer&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withLabel</span><span class="o">(</span><span class="s">&#34;player&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withNoColumn</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withReturnCols</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="s">&#34;age&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withLimit</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withPartitionNum</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">build</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">vertex</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">nebula</span><span class="o">(</span><span class="n">config</span><span class="o">,</span> <span class="n">nebulaReadVertexConfig</span><span class="o">).</span><span class="n">loadVerticesToDF</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">vertex</span><span class="o">.</span><span class="n">printSchema</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">vertex</span><span class="o">.</span><span class="n">show</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">println</span><span class="o">(</span><span class="s">&#34;vertex count: &#34;</span> <span class="o">+</span> <span class="n">vertex</span><span class="o">.</span><span class="n">count</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†™å…¥çš„ä¾‹å­æˆ‘è¿™é‡Œä¸åˆ—å‡ºï¼Œä¸è¿‡ï¼Œå‰è¾¹ç»™å‡ºçš„ä»£ç ç¤ºä¾‹çš„é“¾æ¥é‡Œæ˜¯æœ‰æ›´è¯¦ç»†çš„ä¾‹å­ï¼Œè¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<strong>Spark Connector è¯»æ•°æ®ä¸ºäº†æ»¡è¶³å›¾åˆ†æã€å›¾è®¡ç®—çš„å¤§é‡æ•°æ®åœºæ™¯</strong>ï¼Œå’Œå¤§éƒ¨åˆ†å…¶ä»–å®¢æˆ·ç«¯éå¸¸ä¸åŒï¼Œå®ƒç›´æ¥ç»•è¿‡äº† GraphDï¼Œé€šè¿‡æ‰«æ MetaD å’Œ StorageD è·å¾—æ•°æ®ï¼Œä½†æ˜¯å†™å…¥çš„æƒ…å†µåˆ™æ˜¯é€šè¿‡ GraphD å‘èµ· nGQL DML è¯­å¥å†™å…¥çš„ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥åšä¸€ä¸ªä¸Šæ‰‹ç»ƒä¹ å§ã€‚</p>
<h3 id="ä¸Šæ‰‹-nebula-spark-connector" class="headerLink">
    <a href="#%e4%b8%8a%e6%89%8b-nebula-spark-connector" class="header-mark"></a>2.2 ä¸Šæ‰‹ Nebula Spark Connector</h3><p>å…ˆå†³æ¡ä»¶ï¼šå‡è®¾ä¸‹é¢çš„ç¨‹åºæ˜¯åœ¨ä¸€å°æœ‰äº’è”ç½‘è¿æ¥çš„ Linux æœºå™¨ä¸Šè¿è¡Œçš„ï¼Œæœ€å¥½æ˜¯é¢„è£…äº† Docker å’Œ Docker-Composeã€‚</p>
<h4 id="æ‹‰èµ·ç¯å¢ƒ" class="headerLink">
    <a href="#%e6%8b%89%e8%b5%b7%e7%8e%af%e5%a2%83" class="header-mark"></a>2.2.1 æ‹‰èµ·ç¯å¢ƒ</h4><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç”¨ <a href="https://github.com/wey-gu/nebula-up/" target="_blank" rel="noopener noreffer">Nebula-Up</a> éƒ¨ç½²åŸºäºå®¹å™¨çš„ Nebula Graph Core v3ã€Nebula Studioã€Nebula Console å’Œ Sparkã€Hadoop ç¯å¢ƒï¼Œå¦‚æœè¿˜æ²¡å®‰è£…å¥½å®ƒä¹Ÿä¼šå°è¯•ä¸ºæˆ‘ä»¬å®‰è£… Docker å’Œ Docker-Composeã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Install Core with Spark Connector, Nebula Algorithm, Nebula Exchange</span>
</span></span><span class="line"><span class="cl">curl -fsSL nebula-up.siwei.io/all-in-one.sh <span class="p">|</span> bash -s -- v3 spark
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ä½ çŸ¥é“å— <a href="https://github.com/wey-gu/nebula-up/" target="_blank" rel="noopener noreffer">Nebula-UP</a> å¯ä»¥ä¸€é”®è£…æ›´å¤šä¸œè¥¿ï¼Œå¦‚æœä½ çš„ç¯å¢ƒé…ç½®å¤§ä¸€ç‚¹ï¼ˆæ¯”å¦‚ 8 GB RAMï¼‰<code>curl -fsSL nebula-up.siwei.io/all-in-one.sh | bash</code> å¯ä»¥è£…æ›´å¤šä¸œè¥¿ï¼Œä½†æ˜¯è¯·æ³¨æ„ <a href="https://github.com/wey-gu/nebula-up/" target="_blank" rel="noopener noreffer">Nebula-UP</a> ä¸æ˜¯ä¸ºç”Ÿäº§ç¯å¢ƒå‡†å¤‡çš„ã€‚</p>
</blockquote>
<p>ä¸Šè¿°è¾¹è„šæœ¬æ‰§è¡Œåï¼Œè®©æˆ‘ä»¬ç”¨ <a href="https://docs.nebula-graph.com.cn/3.1.0/nebula-console/" target="_blank" rel="noopener noreffer">Nebula-Console</a>ï¼ˆNebula Graph çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼‰æ¥è¿æ¥å®ƒã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Connect to nebula with console</span>
</span></span><span class="line"><span class="cl">~/.nebula-up/console.sh
</span></span><span class="line"><span class="cl"><span class="c1"># Execute any queryies like</span>
</span></span><span class="line"><span class="cl">~/.nebula-up/console.sh -e <span class="s2">&#34;SHOW HOSTS&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŠ è½½ä¸€ä»½æ•°æ®è¿›å»ï¼Œå¹¶æ‰§è¡Œä¸€ä¸ªå›¾æŸ¥è¯¢ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Load the sample dataset</span>
</span></span><span class="line"><span class="cl">~/.nebula-up/load-basketballplayer-dataset.sh
</span></span><span class="line"><span class="cl"><span class="c1"># ç­‰ä¸€åˆ†é’Ÿå·¦å³</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Make a Graph Query the sample dataset</span>
</span></span><span class="line"><span class="cl">~/.nebula-up/console.sh -e <span class="s1">&#39;USE basketballplayer; FIND ALL PATH FROM &#34;player100&#34; TO &#34;team204&#34; OVER * WHERE follow.degree is EMPTY or follow.degree &gt;=0 YIELD path AS p;&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="è¿›å…¥-spark-ç¯å¢ƒ" class="headerLink">
    <a href="#%e8%bf%9b%e5%85%a5-spark-%e7%8e%af%e5%a2%83" class="header-mark"></a>2.2.2 è¿›å…¥ Spark ç¯å¢ƒ</h4><p>æ‰§è¡Œä¸‹é¢è¿™ä¸€è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›å…¥åˆ° Spark ç¯å¢ƒï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it sparkmaster bash
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæˆ‘ä»¬æƒ³æ‰§è¡Œç¼–è¯‘ï¼Œå¯ä»¥åœ¨é‡Œè¾¹å®‰è£… <code>mvn</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it sparkmaster bash
</span></span><span class="line"><span class="cl"><span class="c1"># in the container shell</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">MAVEN_VERSION</span><span class="o">=</span>3.5.4
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">MAVEN_HOME</span><span class="o">=</span>/usr/lib/mvn
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$MAVEN_HOME</span>/bin:<span class="nv">$PATH</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">wget http://archive.apache.org/dist/maven/maven-3/<span class="nv">$MAVEN_VERSION</span>/binaries/apache-maven-<span class="nv">$MAVEN_VERSION</span>-bin.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  tar -zxvf apache-maven-<span class="nv">$MAVEN_VERSION</span>-bin.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  rm apache-maven-<span class="nv">$MAVEN_VERSION</span>-bin.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  mv apache-maven-<span class="nv">$MAVEN_VERSION</span> /usr/lib/mvn
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="è·‘-spark-connector-çš„ä¾‹å­" class="headerLink">
    <a href="#%e8%b7%91-spark-connector-%e7%9a%84%e4%be%8b%e5%ad%90" class="header-mark"></a>2.2.3 è·‘ Spark Connector çš„ä¾‹å­</h4><h5 id="é€‰é¡¹-1æ¨èé€šè¿‡-pyspark" class="headerLink">
    <a href="#%e9%80%89%e9%a1%b9-1%e6%8e%a8%e8%8d%90%e9%80%9a%e8%bf%87-pyspark" class="header-mark"></a>2.2.3.1 é€‰é¡¹ 1ï¼ˆæ¨èï¼‰ï¼šé€šè¿‡ PySpark</h5><ul>
<li>è¿›å…¥ PySpark Shell</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">~/.nebula-up/nebula-pyspark.sh
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è°ƒç”¨ Nebula Spark Reader</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># call Nebula Spark Connector Reader</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;com.vesoft.nebula.connector.NebulaDataSource&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;type&#34;</span><span class="p">,</span> <span class="s2">&#34;vertex&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;spaceName&#34;</span><span class="p">,</span> <span class="s2">&#34;basketballplayer&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;label&#34;</span><span class="p">,</span> <span class="s2">&#34;player&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;returnCols&#34;</span><span class="p">,</span> <span class="s2">&#34;name,age&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;metaAddress&#34;</span><span class="p">,</span> <span class="s2">&#34;metad0:9559&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;partitionNumber&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># show the dataframe with limit of 2</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¿”å›ç»“æœä¾‹å­</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">      <span class="n">____</span>              <span class="n">__</span>
</span></span><span class="line"><span class="cl">     <span class="o">/</span> <span class="n">__</span><span class="o">/</span><span class="n">__</span>  <span class="n">___</span> <span class="n">_____</span><span class="o">/</span> <span class="o">/</span><span class="n">__</span>
</span></span><span class="line"><span class="cl">    <span class="n">_</span>\ \<span class="o">/</span> <span class="n">_</span> \<span class="o">/</span> <span class="n">_</span> <span class="err">`</span><span class="o">/</span> <span class="n">__</span><span class="o">/</span>  <span class="s1">&#39;_/</span>
</span></span><span class="line"><span class="cl">   <span class="o">/</span><span class="n">__</span> <span class="o">/</span> <span class="o">.</span><span class="n">__</span><span class="o">/</span>\<span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="o">/</span><span class="n">_</span><span class="o">/</span> <span class="o">/</span><span class="n">_</span><span class="o">/</span>\<span class="n">_</span>\   <span class="n">version</span> <span class="mf">2.4.5</span>
</span></span><span class="line"><span class="cl">      <span class="o">/</span><span class="n">_</span><span class="o">/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Using</span> <span class="n">Python</span> <span class="n">version</span> <span class="mf">2.7.16</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Jan</span> <span class="mi">14</span> <span class="mi">2020</span> <span class="mi">07</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">06</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">SparkSession</span> <span class="n">available</span> <span class="k">as</span> <span class="s1">&#39;spark&#39;</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>   <span class="s2">&#34;com.vesoft.nebula.connector.NebulaDataSource&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>     <span class="s2">&#34;type&#34;</span><span class="p">,</span> <span class="s2">&#34;vertex&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>     <span class="s2">&#34;spaceName&#34;</span><span class="p">,</span> <span class="s2">&#34;basketballplayer&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>     <span class="s2">&#34;label&#34;</span><span class="p">,</span> <span class="s2">&#34;player&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>     <span class="s2">&#34;returnCols&#34;</span><span class="p">,</span> <span class="s2">&#34;name,age&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>     <span class="s2">&#34;metaAddress&#34;</span><span class="p">,</span> <span class="s2">&#34;metad0:9559&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>     <span class="s2">&#34;partitionNumber&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">+---------+--------------+---+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span><span class="n">_vertexId</span><span class="o">|</span>          <span class="n">name</span><span class="o">|</span><span class="n">age</span><span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+---------+--------------+---+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span><span class="n">player105</span><span class="o">|</span>   <span class="n">Danny</span> <span class="n">Green</span><span class="o">|</span> <span class="mi">31</span><span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span><span class="n">player109</span><span class="o">|</span><span class="n">Tiago</span> <span class="n">Splitter</span><span class="o">|</span> <span class="mi">34</span><span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+---------+--------------+---+</span>
</span></span><span class="line"><span class="cl"><span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">2</span> <span class="n">rows</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="é€‰é¡¹-2ç¼–è¯‘æäº¤ç¤ºä¾‹-jar-åŒ…" class="headerLink">
    <a href="#%e9%80%89%e9%a1%b9-2%e7%bc%96%e8%af%91%e6%8f%90%e4%ba%a4%e7%a4%ba%e4%be%8b-jar-%e5%8c%85" class="header-mark"></a>2.2.3.2 é€‰é¡¹ 2ï¼šç¼–è¯‘ã€æäº¤ç¤ºä¾‹ JAR åŒ…</h5><ul>
<li>å…ˆå…‹éš† Spark Connector å’Œå®ƒç¤ºä¾‹ä»£ç çš„ä»£ç ä»“åº“ï¼Œç„¶åç¼–è¯‘ï¼š</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† master åˆ†æ”¯ï¼Œå› ä¸ºå½“ä¸‹ master åˆ†æ”¯æ˜¯å…¼å®¹ 3.x çš„ï¼Œä¸€å®šè¦ä¿è¯ spark connector å’Œæ•°æ®åº“å†…æ ¸ç‰ˆæœ¬æ˜¯åŒ¹é…çš„ï¼Œç‰ˆæœ¬å¯¹åº”å…³ç³»å‚è€ƒä»£ç ä»“åº“çš„ <code>README.md</code> ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ~/.nebula-up/nebula-up/spark
</span></span><span class="line"><span class="cl">git clone https://github.com/vesoft-inc/nebula-spark-connector.git
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -it sparkmaster bash
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /root/nebula-spark-connector
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ›¿æ¢ç¤ºä¾‹é¡¹ç›®çš„ä»£ç </li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> &gt; example/src/main/scala/com/vesoft/nebula/examples/connector/NebulaSparkReaderExample.scala
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vi example/src/main/scala/com/vesoft/nebula/examples/connector/NebulaSparkReaderExample.scala
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æŠŠå¦‚ä¸‹çš„ä»£ç ç²˜è´´è¿›å»ï¼Œè¿™é‡Œè¾¹æˆ‘ä»¬å¯¹å‰è¾¹åŠ è½½çš„å›¾ï¼š <code>basketballplayer</code> ä¸Šåšäº†é¡¶ç‚¹å’Œè¾¹çš„è¯»æ“ä½œï¼šåˆ†åˆ«è°ƒç”¨ <code>readVertex</code> å’Œ <code>readEdges</code>ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">package</span> <span class="nn">com.vesoft.nebula.examples.connector</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">com.facebook.thrift.protocol.TCompactProtocol</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">com.vesoft.nebula.connector.connector.NebulaDataFrameReader</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">com.vesoft.nebula.connector.</span><span class="o">{</span><span class="nc">NebulaConnectionConfig</span><span class="o">,</span> <span class="nc">ReadNebulaConfig</span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">org.apache.spark.SparkConf</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">org.slf4j.LoggerFactory</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">NebulaSparkReaderExample</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">val</span> <span class="nc">LOG</span> <span class="k">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="n">getLogger</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="n">getClass</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">sparkConf</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SparkConf</span>
</span></span><span class="line"><span class="cl">    <span class="n">sparkConf</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">set</span><span class="o">(</span><span class="s">&#34;spark.serializer&#34;</span><span class="o">,</span> <span class="s">&#34;org.apache.spark.serializer.KryoSerializer&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">registerKryoClasses</span><span class="o">(</span><span class="nc">Array</span><span class="o">[</span><span class="kt">Class</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="n">classOf</span><span class="o">[</span><span class="kt">TCompactProtocol</span><span class="o">]))</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">spark</span> <span class="k">=</span> <span class="nc">SparkSession</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">master</span><span class="o">(</span><span class="s">&#34;local&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">config</span><span class="o">(</span><span class="n">sparkConf</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">getOrCreate</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">readVertex</span><span class="o">(</span><span class="n">spark</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">readEdges</span><span class="o">(</span><span class="n">spark</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">spark</span><span class="o">.</span><span class="n">close</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">readVertex</span><span class="o">(</span><span class="n">spark</span><span class="k">:</span> <span class="kt">SparkSession</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nc">LOG</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&#34;start to read nebula vertices&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">config</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">      <span class="nc">NebulaConnectionConfig</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">withMetaAddress</span><span class="o">(</span><span class="s">&#34;metad0:9559,metad1:9559,metad2:9559&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">withConenctionRetry</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">build</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">nebulaReadVertexConfig</span><span class="k">:</span> <span class="kt">ReadNebulaConfig</span> <span class="o">=</span> <span class="nc">ReadNebulaConfig</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withSpace</span><span class="o">(</span><span class="s">&#34;basketballplayer&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withLabel</span><span class="o">(</span><span class="s">&#34;player&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withNoColumn</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withReturnCols</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="s">&#34;age&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withLimit</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withPartitionNum</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">build</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">vertex</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">nebula</span><span class="o">(</span><span class="n">config</span><span class="o">,</span> <span class="n">nebulaReadVertexConfig</span><span class="o">).</span><span class="n">loadVerticesToDF</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">vertex</span><span class="o">.</span><span class="n">printSchema</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">vertex</span><span class="o">.</span><span class="n">show</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">println</span><span class="o">(</span><span class="s">&#34;vertex count: &#34;</span> <span class="o">+</span> <span class="n">vertex</span><span class="o">.</span><span class="n">count</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">readEdges</span><span class="o">(</span><span class="n">spark</span><span class="k">:</span> <span class="kt">SparkSession</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nc">LOG</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&#34;start to read nebula edges&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">config</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">      <span class="nc">NebulaConnectionConfig</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">withMetaAddress</span><span class="o">(</span><span class="s">&#34;metad0:9559,metad1:9559,metad2:9559&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">withTimeout</span><span class="o">(</span><span class="mi">6000</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">withConenctionRetry</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">build</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">nebulaReadEdgeConfig</span><span class="k">:</span> <span class="kt">ReadNebulaConfig</span> <span class="o">=</span> <span class="nc">ReadNebulaConfig</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withSpace</span><span class="o">(</span><span class="s">&#34;basketballplayer&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withLabel</span><span class="o">(</span><span class="s">&#34;follow&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withNoColumn</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withReturnCols</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">&#34;degree&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withLimit</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withPartitionNum</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">build</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">edge</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">nebula</span><span class="o">(</span><span class="n">config</span><span class="o">,</span> <span class="n">nebulaReadEdgeConfig</span><span class="o">).</span><span class="n">loadEdgesToDF</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">edge</span><span class="o">.</span><span class="n">printSchema</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">edge</span><span class="o">.</span><span class="n">show</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">println</span><span class="o">(</span><span class="s">&#34;edge count: &#34;</span> <span class="o">+</span> <span class="n">edge</span><span class="o">.</span><span class="n">count</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç„¶åæ‰“åŒ…æˆ JAR åŒ…</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/usr/lib/mvn/bin/mvn install -Dgpg.skip -Dmaven.javadoc.skip<span class="o">=</span><span class="nb">true</span> -Dmaven.test.skip<span class="o">=</span><span class="nb">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æœ€åï¼ŒæŠŠå®ƒæäº¤åˆ° Spark é‡Œæ‰§è¡Œï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> example
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/spark/bin/spark-submit --master <span class="s2">&#34;local&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --class com.vesoft.nebula.examples.connector.NebulaSparkReaderExample <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --driver-memory 4g target/example-3.0-SNAPSHOT.jar
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é€€å‡º spark å®¹å™¨</span>
</span></span><span class="line"><span class="cl"><span class="nb">exit</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°è¿”å›ç»“æœï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">22/04/19 07:29:34 INFO DAGScheduler: Job 1 finished: show at NebulaSparkReaderExample.scala:57, took 0.199310 s
</span></span><span class="line"><span class="cl">+---------+------------------+---+
</span></span><span class="line"><span class="cl">|_vertexId|              name|age|
</span></span><span class="line"><span class="cl">+---------+------------------+---+
</span></span><span class="line"><span class="cl">|player105|       Danny Green| 31|
</span></span><span class="line"><span class="cl">|player109|    Tiago Splitter| 34|
</span></span><span class="line"><span class="cl">|player111|        David West| 38|
</span></span><span class="line"><span class="cl">|player118| Russell Westbrook| 30|
</span></span><span class="line"><span class="cl">|player143|Kristaps Porzingis| 23|
</span></span><span class="line"><span class="cl">|player114|     Tracy McGrady| 39|
</span></span><span class="line"><span class="cl">|player150|       Luka Doncic| 20|
</span></span><span class="line"><span class="cl">|player103|          Rudy Gay| 32|
</span></span><span class="line"><span class="cl">|player113|   Dejounte Murray| 29|
</span></span><span class="line"><span class="cl">|player121|        Chris Paul| 33|
</span></span><span class="line"><span class="cl">|player128|   Carmelo Anthony| 34|
</span></span><span class="line"><span class="cl">|player130|       Joel Embiid| 25|
</span></span><span class="line"><span class="cl">|player136|        Steve Nash| 45|
</span></span><span class="line"><span class="cl">|player108|        Boris Diaw| 36|
</span></span><span class="line"><span class="cl">|player122|    DeAndre Jordan| 30|
</span></span><span class="line"><span class="cl">|player123|       Ricky Rubio| 28|
</span></span><span class="line"><span class="cl">|player139|        Marc Gasol| 34|
</span></span><span class="line"><span class="cl">|player142|     Klay Thompson| 29|
</span></span><span class="line"><span class="cl">|player145|      JaVale McGee| 31|
</span></span><span class="line"><span class="cl">|player102| LaMarcus Aldridge| 33|
</span></span><span class="line"><span class="cl">+---------+------------------+---+
</span></span><span class="line"><span class="cl">only showing top 20 rows
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">22/04/19 07:29:36 INFO DAGScheduler: Job 4 finished: show at NebulaSparkReaderExample.scala:82, took 0.135543 s
</span></span><span class="line"><span class="cl">+---------+---------+-----+------+
</span></span><span class="line"><span class="cl">|   _srcId|   _dstId|_rank|degree|
</span></span><span class="line"><span class="cl">+---------+---------+-----+------+
</span></span><span class="line"><span class="cl">|player105|player100|    0|    70|
</span></span><span class="line"><span class="cl">|player105|player104|    0|    83|
</span></span><span class="line"><span class="cl">|player105|player116|    0|    80|
</span></span><span class="line"><span class="cl">|player109|player100|    0|    80|
</span></span><span class="line"><span class="cl">|player109|player125|    0|    90|
</span></span><span class="line"><span class="cl">|player118|player120|    0|    90|
</span></span><span class="line"><span class="cl">|player118|player131|    0|    90|
</span></span><span class="line"><span class="cl">|player143|player150|    0|    90|
</span></span><span class="line"><span class="cl">|player114|player103|    0|    90|
</span></span><span class="line"><span class="cl">|player114|player115|    0|    90|
</span></span><span class="line"><span class="cl">|player114|player140|    0|    90|
</span></span><span class="line"><span class="cl">|player150|player120|    0|    80|
</span></span><span class="line"><span class="cl">|player150|player137|    0|    90|
</span></span><span class="line"><span class="cl">|player150|player143|    0|    90|
</span></span><span class="line"><span class="cl">|player103|player102|    0|    70|
</span></span><span class="line"><span class="cl">|player113|player100|    0|    99|
</span></span><span class="line"><span class="cl">|player113|player101|    0|    99|
</span></span><span class="line"><span class="cl">|player113|player104|    0|    99|
</span></span><span class="line"><span class="cl">|player113|player105|    0|    99|
</span></span><span class="line"><span class="cl">|player113|player106|    0|    99|
</span></span><span class="line"><span class="cl">+---------+---------+-----+------+
</span></span><span class="line"><span class="cl">only showing top 20 rows
</span></span></code></pre></td></tr></table>
</div>
</div><p>äº‹å®ä¸Šï¼Œåœ¨è¿™ä¸ªä»£ç ä»“åº“ä¸‹è¿˜æœ‰æ›´å¤šçš„ä¾‹å­ï¼Œç‰¹åˆ«æ˜¯ <a href="https://spark.apache.org/docs/latest/graphx-programming-guide.html" target="_blank" rel="noopener noreffer">GraphX</a> çš„ä¾‹å­ï¼Œä½ å¯ä»¥å°è¯•è‡ªå·±å»æ¢ç´¢è¿™éƒ¨åˆ†ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œåœ¨ GraphX å‡å®šé¡¶ç‚¹ ID æ˜¯æ•°å­—ç±»å‹çš„ï¼Œå› æ­¤å¯¹äºå­—ç¬¦ä¸²ç±»å‹çš„é¡¶ç‚¹ ID æƒ…å†µï¼Œéœ€è¦è¿›è¡Œå®æ—¶è½¬æ¢ï¼Œè¯·å‚è€ƒ <a href="https://github.com/vesoft-inc/nebula-algorithm/blob/a82d7092d928a2f3abc45a727c24afb888ff8e4f/example/src/main/scala/com/vesoft/nebula/algorithm/PageRankExample.scala#L31" target="_blank" rel="noopener noreffer">Nebula Algorithom ä¸­çš„ä¾‹å­</a>ï¼Œäº†è§£å¦‚ä½•ç»•è¿‡è¿™ä¸€é—®é¢˜ã€‚</p>
</blockquote>
<h2 id="nebula-exchange" class="headerLink">
    <a href="#nebula-exchange" class="header-mark"></a>3 Nebula Exchange</h2><ul>
<li>ä»£ç ï¼šhttps://github.com/vesoft-inc/nebula-exchange/</li>
<li>æ–‡æ¡£ï¼šhttps://docs.nebula-graph.com.cn/3.1.0/nebula-exchange/about-exchange/ex-ug-what-is-exchange/</li>
<li>JAR åŒ…ï¼šhttps://github.com/vesoft-inc/nebula-exchange/releases</li>
<li>é…ç½®ä¾‹å­ï¼š <a href="https://github.com/vesoft-inc/nebula-exchange/blob/master/exchange-common/src/test/resources/application.conf" target="_blank" rel="noopener noreffer">exchange-common/src/test/resources/application.conf</a></li>
</ul>
<p>Nebula Exchange æ˜¯ä¸€ä¸ª Spark Libï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯ä»¥ç›´æ¥æäº¤æ‰§è¡Œçš„ Spark åº”ç”¨ï¼Œå®ƒè¢«ç”¨æ¥ä»å¤šä¸ªæ•°æ®æºè¯»å–æ•°æ®å†™å…¥ Nebula Graph æˆ–è€…è¾“å‡º <a href="https://docs.nebula-graph.com.cn/3.1.0/nebula-exchange/use-exchange/ex-ug-import-from-sst/#step_5_import_the_sst_file" target="_blank" rel="noopener noreffer">Nebula Graph SST æ–‡ä»¶</a>ã€‚</p>
<p></p>
<p>é€šè¿‡ spark-submit çš„æ–¹å¼ä½¿ç”¨ Nebula Exchange çš„æ–¹æ³•å¾ˆç›´æ¥ï¼š</p>
<ul>
<li>é¦–å…ˆåˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œè®© Exchange çŸ¥é“åº”è¯¥å¦‚ä½•è·å–å’Œå†™å…¥æ•°æ®</li>
<li>ç„¶åç”¨æŒ‡å®šçš„é…ç½®æ–‡ä»¶è°ƒç”¨ Exchange åŒ…</li>
</ul>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨ä¸Šä¸€ç« ä¸­åˆ›å»ºçš„ç›¸åŒç¯å¢ƒåšä¸€ä¸ªå®é™…æµ‹è¯•ã€‚</p>
<h3 id="ä¸€é”®è¯•ç©-exchange" class="headerLink">
    <a href="#%e4%b8%80%e9%94%ae%e8%af%95%e7%8e%a9-exchange" class="header-mark"></a>3.1 ä¸€é”®è¯•ç© Exchange</h3><h4 id="å…ˆè·‘èµ·æ¥çœ‹çœ‹å§" class="headerLink">
    <a href="#%e5%85%88%e8%b7%91%e8%b5%b7%e6%9d%a5%e7%9c%8b%e7%9c%8b%e5%90%a7" class="header-mark"></a>3.1.1 å…ˆè·‘èµ·æ¥çœ‹çœ‹å§</h4><blockquote>
<p>è¯·å‚è€ƒå‰è¾¹<a href="#%e6%8b%89%e8%b5%b7%e7%8e%af%e5%a2%83" rel="">æ‹‰èµ·ç¯å¢ƒ</a>è¿™ä¸€ç« èŠ‚ï¼Œå…ˆä¸€é”®è£…å¥½ç¯å¢ƒã€‚</p>
</blockquote>
<p>ä¸€é”®æ‰§è¡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">~/.nebula-up/nebula-exchange-example.sh
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­å–œä½ ï¼Œå·²ç»ç¬¬ä¸€æ¬¡æ‰§è¡ŒæˆåŠŸä¸€ä¸ª Exchange çš„æ•°æ®å¯¼å…¥ä»»åŠ¡å•¦ï¼</p>
<h4 id="å†çœ‹çœ‹ä¸€äº›ç»†èŠ‚" class="headerLink">
    <a href="#%e5%86%8d%e7%9c%8b%e7%9c%8b%e4%b8%80%e4%ba%9b%e7%bb%86%e8%8a%82" class="header-mark"></a>3.1.2 å†çœ‹çœ‹ä¸€äº›ç»†èŠ‚</h4><p>è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯ç”¨ Exchange ä» CSV æ–‡ä»¶è¿™ä¸€å…¶ä¸­æ”¯æŒçš„æ•°æ®æºä¸­è¯»å–æ•°æ®å†™å…¥ Nebula Graph é›†ç¾¤çš„ã€‚è¿™ä¸ª CSV æ–‡ä»¶ä¸­ç¬¬ä¸€åˆ—æ˜¯é¡¶ç‚¹ IDï¼Œç¬¬äºŒå’Œç¬¬ä¸‰åˆ—æ˜¯ &ldquo;å§“å &ldquo;å’Œ &ldquo;å¹´é¾„ &ldquo;çš„å±æ€§ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">player800,<span class="s2">&#34;Foo Bar&#34;</span>,23
</span></span><span class="line"><span class="cl">player801,<span class="s2">&#34;Another Name&#34;</span>,21
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å’±ä»¬å¯ä»¥è¿›åˆ° Spark ç¯å¢ƒé‡Œçœ‹çœ‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it sparkmaster bash
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /root
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æäº¤ Exchange ä»»åŠ¡æ—¶å€™æŒ‡å®šçš„é…ç½®æ–‡ä»¶ <code>exchange.conf</code> å®ƒæ˜¯ä¸€ä¸ª <code>HOCON</code> æ ¼å¼çš„æ–‡ä»¶ï¼š
<ul>
<li>åœ¨ <code>.nebula</code> ä¸­æè¿°äº† Nebula Graph é›†ç¾¤çš„ç›¸å…³ä¿¡æ¯</li>
<li>åœ¨ <code>.tags</code> ä¸­æè¿°äº†å¦‚ä½•å°†å¿…å¡«å­—æ®µå¯¹åº”åˆ°æˆ‘ä»¬çš„æ•°æ®æºï¼ˆè¿™é‡Œæ˜¯ CSV æ–‡ä»¶ï¼‰ç­‰æœ‰å…³ Vertecies çš„ä¿¡æ¯ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zed" data-lang="zed"><span class="line"><span class="cl"><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Spark</span><span class="w"> </span><span class="kn">relation</span><span class="w"> </span><span class="n">config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">spark</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">app</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">Nebula</span><span class="w"> </span><span class="n">Exchange</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">master</span><span class="o">:</span><span class="n">local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">driver</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">cores</span><span class="o">:</span><span class="w"> </span><span class="err">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">maxResultSize</span><span class="o">:</span><span class="w"> </span><span class="err">1</span><span class="n">G</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">executor</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">memory</span><span class="o">:</span><span class="w"> </span><span class="err">1</span><span class="n">G</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">cores</span><span class="o">:</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">max</span><span class="o">:</span><span class="w"> </span><span class="err">16</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Nebula</span><span class="w"> </span><span class="n">Graph</span><span class="w"> </span><span class="kn">relation</span><span class="w"> </span><span class="n">config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">nebula</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">address</span><span class="o">:</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">graph</span><span class="o">:</span><span class="p">[</span><span class="err">&#34;</span><span class="n">graphd</span><span class="o">:</span><span class="err">9669&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">meta</span><span class="o">:</span><span class="p">[</span><span class="err">&#34;</span><span class="n">metad0</span><span class="o">:</span><span class="err">9559&#34;</span><span class="p">,</span><span class="w"> </span><span class="err">&#34;</span><span class="n">metad1</span><span class="o">:</span><span class="err">9559&#34;</span><span class="p">,</span><span class="w"> </span><span class="err">&#34;</span><span class="n">metad2</span><span class="o">:</span><span class="err">9559&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">user</span><span class="o">:</span><span class="w"> </span><span class="n">root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">pswd</span><span class="o">:</span><span class="w"> </span><span class="n">nebula</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">space</span><span class="o">:</span><span class="w"> </span><span class="n">basketballplayer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">SST</span><span class="w"> </span><span class="n">import</span><span class="p">,</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">required</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">path</span><span class="o">:</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">local</span><span class="o">:</span><span class="err">&#34;</span><span class="o">/</span><span class="n">tmp</span><span class="err">&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">remote</span><span class="o">:</span><span class="err">&#34;</span><span class="o">/</span><span class="n">sst</span><span class="err">&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">hdfs</span><span class="p">.</span><span class="n">namenode</span><span class="o">:</span><span class="w"> </span><span class="err">&#34;</span><span class="n">hdfs</span><span class="o">:</span><span class="c1">//localhost:9000&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">nebula</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="n">parameters</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">connection</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">#</span><span class="w"> </span><span class="n">socket</span><span class="w"> </span><span class="n">connect</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">execute</span><span class="w"> </span><span class="n">timeout</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="o">:</span><span class="w"> </span><span class="n">millisecond</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">timeout</span><span class="o">:</span><span class="w"> </span><span class="err">30000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">error</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">#</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">failures</span><span class="p">,</span><span class="w"> </span><span class="n">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">failures</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">bigger</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">max</span><span class="p">,</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">application</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">max</span><span class="o">:</span><span class="w"> </span><span class="err">32</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">#</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">job</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">recorded</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">path</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="nn">tmp/</span><span class="n">errors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">google</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">RateLimiter</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">NebulaGraph</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">rate</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">stable</span><span class="w"> </span><span class="n">throughput</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">RateLimiter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">limit</span><span class="o">:</span><span class="w"> </span><span class="err">1024</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">#</span><span class="w"> </span><span class="n">Acquires</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">permit</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">RateLimiter</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="o">:</span><span class="w"> </span><span class="n">MILLISECONDS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">#</span><span class="w"> </span><span class="n">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">can</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">obtained</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">timeout</span><span class="p">,</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">give</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">timeout</span><span class="o">:</span><span class="w"> </span><span class="err">1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Processing</span><span class="w"> </span><span class="n">tags</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">There</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="n">examples</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">dataSources</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">tags</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">HDFS</span><span class="w"> </span><span class="n">csv</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Import</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">sink</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">sst</span><span class="w"> </span><span class="n">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">mode</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">player</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">source</span><span class="o">:</span><span class="w"> </span><span class="n">csv</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">sink</span><span class="o">:</span><span class="w"> </span><span class="n">client</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">path</span><span class="o">:</span><span class="w"> </span><span class="err">&#34;</span><span class="n">file</span><span class="o">:</span><span class="c1">///root/player.csv&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="err">#</span><span class="w"> </span><span class="n">if</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">csv</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">header</span><span class="p">,</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">_c0</span><span class="p">,</span><span class="n">_c1</span><span class="p">,</span><span class="n">_c2</span><span class="p">,..</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">indicate</span><span class="w"> </span><span class="n">fields</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">fields</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">_c1</span><span class="p">,</span><span class="w"> </span><span class="n">_c2</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">nebula</span><span class="p">.</span><span class="n">fields</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">vertex</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">field</span><span class="o">:</span><span class="n">_c0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">separator</span><span class="o">:</span><span class="w"> </span><span class="err">&#34;</span><span class="p">,</span><span class="err">&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">header</span><span class="o">:</span><span class="w"> </span><span class="n">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">batch</span><span class="o">:</span><span class="w"> </span><span class="err">256</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">partition</span><span class="o">:</span><span class="w"> </span><span class="err">32</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æˆ‘ä»¬åº”è¯¥èƒ½çœ‹åˆ°é‚£ä¸ª CSV æ•°æ®æºå’Œè¿™ä¸ªé…ç½®æ–‡ä»¶éƒ½åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹äº†ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">bash-5.0# ls -l
</span></span><span class="line"><span class="cl">total <span class="m">24</span>
</span></span><span class="line"><span class="cl">drwxrwxr-x    <span class="m">2</span> <span class="m">1000</span>     <span class="m">1000</span>          <span class="m">4096</span> Jun  <span class="m">1</span> 04:26 download
</span></span><span class="line"><span class="cl">-rw-rw-r--    <span class="m">1</span> <span class="m">1000</span>     <span class="m">1000</span>          <span class="m">1908</span> Jun  <span class="m">1</span> 04:23 exchange.conf
</span></span><span class="line"><span class="cl">-rw-rw-r--    <span class="m">1</span> <span class="m">1000</span>     <span class="m">1000</span>          <span class="m">2593</span> Jun  <span class="m">1</span> 04:23 hadoop.env
</span></span><span class="line"><span class="cl">drwxrwxr-x    <span class="m">7</span> <span class="m">1000</span>     <span class="m">1000</span>          <span class="m">4096</span> Jun  <span class="m">6</span> 03:27 nebula-spark-connector
</span></span><span class="line"><span class="cl">-rw-rw-r--    <span class="m">1</span> <span class="m">1000</span>     <span class="m">1000</span>            <span class="m">51</span> Jun  <span class="m">1</span> 04:23 player.csv
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç„¶åï¼Œå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å†æ¬¡æäº¤ä¸€ä¸‹è¿™ä¸ª Exchange ä»»åŠ¡</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/spark/bin/spark-submit --master <span class="nb">local</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --class com.vesoft.nebula.exchange.Exchange download/nebula-exchange.jar <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -c exchange.conf
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>éƒ¨åˆ†è¿”å›ç»“æœ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">22/06/06 03:56:26 INFO Exchange$: Processing Tag player
</span></span><span class="line"><span class="cl">22/06/06 03:56:26 INFO Exchange$: field keys: _c1, _c2
</span></span><span class="line"><span class="cl">22/06/06 03:56:26 INFO Exchange$: nebula keys: name, age
</span></span><span class="line"><span class="cl">22/06/06 03:56:26 INFO Exchange$: Loading CSV files from file:///root/player.csv
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">22/06/06 03:56:41 INFO Exchange$: import for tag player cost time: 3.35 s
</span></span><span class="line"><span class="cl">22/06/06 03:56:41 INFO Exchange$: Client-Import: batchSuccess.player: 2
</span></span><span class="line"><span class="cl">22/06/06 03:56:41 INFO Exchange$: Client-Import: batchFailure.player: 0
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ›´å¤šçš„æ•°æ®æºï¼Œè¯·å‚è€ƒæ–‡æ¡£å’Œé…ç½®çš„ä¾‹å­ã€‚</p>
<blockquote>
<p>å…³äº Exchange è¾“å‡º SST æ–‡ä»¶çš„å®è·µï¼Œä½ å¯ä»¥å‚è€ƒæ–‡æ¡£å’Œæˆ‘çš„æ—§æ–‡ <a href="https://www.siwei.io/nebula-exchange-sst-2.x/" target="_blank" rel="noopener noreffer">Nebula Exchange SST 2.xå®è·µæŒ‡å—</a>ã€‚</p>
</blockquote>
<h2 id="nebula-algorithm" class="headerLink">
    <a href="#nebula-algorithm" class="header-mark"></a>4 Nebula Algorithm</h2><ul>
<li>ä»£ç ä»“åº“ï¼š <a href="https://github.com/vesoft-inc/nebula-algorithm" target="_blank" rel="noopener noreffer">https://github.com/vesoft-inc/nebula-algorithm</a></li>
<li>æ–‡æ¡£ï¼šhttps://docs.nebula-graph.com.cn/3.1.0/nebula-algorithm/</li>
<li>JAR åŒ…ï¼šhttps://repo1.maven.org/maven2/com/vesoft/nebula-algorithm/</li>
<li>ç¤ºä¾‹ä»£ç ï¼š<a href="example/src/main/scala/com/vesoft/nebula/algorithm" rel="">example/src/main/scala/com/vesoft/nebula/algorithm</a></li>
</ul>
<h3 id="é€šè¿‡-spark-submit-æäº¤ä»»åŠ¡" class="headerLink">
    <a href="#%e9%80%9a%e8%bf%87-spark-submit-%e6%8f%90%e4%ba%a4%e4%bb%bb%e5%8a%a1" class="header-mark"></a>4.1 é€šè¿‡ spark-submit æäº¤ä»»åŠ¡</h3><blockquote>
<p>æˆ‘åœ¨<a href="https://github.com/wey-gu/nebula-livejournal" target="_blank" rel="noopener noreffer">è¿™ä¸ªä»£ç ä»“åº“</a>é‡Œç»™å‡ºäº†ä¾‹å­ï¼Œä»Šå¤©æˆ‘ä»¬å€ŸåŠ© Nebula-UP å¯ä»¥æ›´æ–¹ä¾¿ä½“éªŒå®ƒã€‚</p>
<p>å‚è€ƒå‰è¾¹<a href="#%e6%8b%89%e8%b5%b7%e7%8e%af%e5%a2%83" rel="">æ‹‰èµ·ç¯å¢ƒ</a>è¿™ä¸€ç« èŠ‚ï¼Œå…ˆä¸€é”®è£…å¥½ç¯å¢ƒã€‚</p>
</blockquote>
<p>åœ¨å¦‚ä¸Šé€šè¿‡ Nebula-UP çš„ Spark æ¨¡å¼éƒ¨ç½²äº†éœ€è¦çš„ä¾èµ–ä¹‹å</p>
<ul>
<li>åŠ è½½ <a href="https://snap.stanford.edu/data/soc-LiveJournal1.html" target="_blank" rel="noopener noreffer">LiveJournal</a> æ•°æ®é›†</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">~/.nebula-up/load-LiveJournal-dataset.sh
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åœ¨ LiveJournal æ•°æ®é›†ä¸Šæ‰§è¡Œä¸€ä¸ª PageRank ç®—æ³•ï¼Œç»“æœè¾“å‡ºåˆ° CSV æ–‡ä»¶ä¸­</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">~/.nebula-up/nebula-algo-pagerank-example.sh
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ£€æŸ¥è¾“å‡ºç»“æœï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it sparkmaster bash
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">head /output/part*000.csv
</span></span><span class="line"><span class="cl">_id,pagerank
</span></span><span class="line"><span class="cl">637100,0.9268620883822242
</span></span><span class="line"><span class="cl">108150,1.1855749056722755
</span></span><span class="line"><span class="cl">957460,0.923720299211093
</span></span><span class="line"><span class="cl">257320,0.9967932799358413
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="é…ç½®æ–‡ä»¶è§£è¯»" class="headerLink">
    <a href="#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e8%a7%a3%e8%af%bb" class="header-mark"></a>4.1.1 é…ç½®æ–‡ä»¶è§£è¯»</h4><p>å®Œæ•´æ–‡ä»¶åœ¨<a href="https://github.com/wey-gu/nebula-livejournal/blob/main/nebula-algorithm/algo-pagerank.conf" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a>ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹ä¸»è¦çš„å­—æ®µï¼š</p>
<ul>
<li><code>.data</code> æŒ‡å®šäº†æºæ˜¯ Nebulaï¼Œè¡¨ç¤ºä»é›†ç¾¤è·å–å›¾æ•°æ®ï¼Œè¾“å‡º<code>sink</code>æ˜¯ <code>csv</code>ï¼Œè¡¨ç¤ºå†™åˆ°æœ¬åœ°æ–‡ä»¶é‡Œã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  data: {
</span></span><span class="line"><span class="cl">    # data source. optional of nebula,csv,json
</span></span><span class="line"><span class="cl">    source: nebula
</span></span><span class="line"><span class="cl">    # data sink, means the algorithm result will be write into this sink. optional of nebula,csv,text
</span></span><span class="line"><span class="cl">    sink: csv
</span></span><span class="line"><span class="cl">    # if your algorithm needs weight
</span></span><span class="line"><span class="cl">    hasWeight: false
</span></span><span class="line"><span class="cl">  }
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>.nebula.read</code> è§„å®šäº†è¯» Nebula Graph é›†ç¾¤çš„å¯¹åº”å…³ç³»ï¼Œè¿™é‡Œæ˜¯è¯»å–æ‰€æœ‰ edge type: <code>follow</code> çš„è¾¹æ•°æ®ä¸ºä¸€æ•´å¼ å›¾</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  nebula: {
</span></span><span class="line"><span class="cl">    # algo&#39;s data source from Nebula. If data.source is nebula, then this nebula.read config can be valid.
</span></span><span class="line"><span class="cl">    read: {
</span></span><span class="line"><span class="cl">        # Nebula metad server address, multiple addresses are split by English comma
</span></span><span class="line"><span class="cl">        metaAddress: &#34;metad0:9559&#34;
</span></span><span class="line"><span class="cl">        # Nebula space
</span></span><span class="line"><span class="cl">        space: livejournal
</span></span><span class="line"><span class="cl">        # Nebula edge types, multiple labels means that data from multiple edges will union together
</span></span><span class="line"><span class="cl">        labels: [&#34;follow&#34;]
</span></span><span class="line"><span class="cl">        # Nebula edge property name for each edge type, this property will be as weight col for algorithm.
</span></span><span class="line"><span class="cl">        # Make sure the weightCols are corresponding to labels.
</span></span><span class="line"><span class="cl">        weightCols: []
</span></span><span class="line"><span class="cl">    }
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>.algorithm</code> é‡Œé…ç½®äº†æˆ‘ä»¬è¦è°ƒç”¨çš„ç®—æ³•ï¼Œå’Œç®—æ³•çš„é…ç½®</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  algorithm: {
</span></span><span class="line"><span class="cl">    executeAlgo: pagerank
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # PageRank parameter
</span></span><span class="line"><span class="cl">    pagerank: {
</span></span><span class="line"><span class="cl">        maxIter: 10
</span></span><span class="line"><span class="cl">        resetProb: 0.15  # default 0.15
</span></span><span class="line"><span class="cl">    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä½œä¸ºä¸€ä¸ªåº“åœ¨-spark-ä¸­è°ƒç”¨-nebula-algoritm" class="headerLink">
    <a href="#%e4%bd%9c%e4%b8%ba%e4%b8%80%e4%b8%aa%e5%ba%93%e5%9c%a8-spark-%e4%b8%ad%e8%b0%83%e7%94%a8-nebula-algoritm" class="header-mark"></a>4.2 ä½œä¸ºä¸€ä¸ªåº“åœ¨ Spark ä¸­è°ƒç”¨ Nebula Algoritm</h3><p>è¯·æ³¨æ„å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥å°† Nebula Algoritm ä½œä¸ºä¸€ä¸ªåº“è°ƒç”¨ï¼Œå®ƒçš„å¥½å¤„åœ¨äºï¼š</p>
<ul>
<li>
<p>å¯¹ç®—æ³•çš„è¾“å‡ºæ ¼å¼æœ‰æ›´å¤šçš„æ§åˆ¶/å®šåˆ¶åŠŸèƒ½</p>
</li>
<li>
<p>å¯ä»¥å¯¹éæ•°å­— ID çš„æƒ…å†µè¿›è¡Œè½¬æ¢ï¼Œè§<a href="https://github.com/vesoft-inc/nebula-algorithm/blob/a82d7092d928a2f3abc45a727c24afb888ff8e4f/example/src/main/scala/com/vesoft/nebula/algorithm/PageRankExample.scala#L48" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a></p>
</li>
</ul>
<p>è¿™é‡Œæˆ‘å…ˆä¸ç»™å‡ºä¾‹å­äº†ï¼Œå¦‚æœå¤§å®¶æ„Ÿå…´è¶£å¯ä»¥ç»™ Nebula-UP æéœ€æ±‚ï¼Œæˆ‘ä¹Ÿä¼šå¢åŠ ç›¸åº”çš„ä¾‹å­ã€‚</p>
<blockquote>
<p>é¢˜å›¾æ¥æºï¼š <a href="https://unsplash.com/photos/KABfjuSOx74" target="_blank" rel="noopener noreffer">Sander</a></p>
</blockquote>]]></description>
</item><item>
    <title>Nebula Graph on Pi</title>
    <link>https://siwei.io/nebula-graph-on-pi/</link>
    <pubDate>Wed, 23 Mar 2022 22:11:03 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/nebula-graph-on-pi/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>å¾—ç›Šäº Nebula çš„åŸç”Ÿ ARM64v8 çš„æ”¯æŒï¼Œåœ¨æ ‘è“æ´¾ç­‰ ARM å•æ¿ä¸Šè·‘ Nebula Graph éå¸¸å®¹æ˜“ã€‚</p>
</blockquote>
<h2 id="èƒŒæ™¯" class="headerLink">
    <a href="#%e8%83%8c%e6%99%af" class="header-mark"></a>1 èƒŒæ™¯</h2><p>æœ€è¿‘ï¼Œåœ¨ Nebula Graph ç¤¾åŒº Yee è€å¸ˆçš„ï¼ˆå†ï¼‰ä¸€æ¬¡ä¿®å¤äº† Nebula Graph çš„æ„å»ºä¾èµ–çš„ ARM æ”¯æŒé—®é¢˜ï¼ˆ<a href="https://github.com/vesoft-inc/nebula-third-party/pull/37" target="_blank" rel="noopener noreffer">nebula-third-party#37</a>ï¼‰ä¹‹åï¼Œæˆ‘ä»¬åˆå¯ä»¥æ„‰å¿«åœ°åœ¨ M1 Mac ä¸Šç©è¿™ä¸ªåˆ†å¸ƒå¼å¼€æºå›¾æ•°æ®åº“äº†ã€‚</p>
<p>è‹¦äºæ ‘è“æ´¾çš„ä»·æ ¼ï¼Œä¸€ç›´æ²¡æ‰¾æœºä¼šæŠŠ Nebula è·‘åœ¨å°æ¿å­ä¸Šç©ç©ã€‚è‡³äºä¸ºä»€ä¹ˆè¦è·‘åœ¨æ ‘è“æ´¾ä¸Šæˆ‘çš„å›ç­”å½“ç„¶æ˜¯ <del>Because I can</del> åœ¨éå¸¸éå¸¸è¾¹ç¼˜è®¡ç®—çš„åœºæ™¯ä¸‹ï¼ˆè¿™é‡ŒæŒ–ä¸ªå‘ï¼Œæˆ‘ä¸€å®šè¦æ‰¾ä¸€ä¸ªè¿™æ ·çš„åœºæ™¯åˆ†äº«å‡ºæ¥ï¼‰ã€‚</p>
<p>ç»ˆäºï¼Œä¸€å‘¨å¤šä¹‹å‰åœ¨ <a href="https://twitter.com/laixintao" target="_blank" rel="noopener noreffer">@laixintao</a> å’Œ <a href="https://twitter.com/andelf/status/1504295476958404608" target="_blank" rel="noopener noreffer">@andelf</a> çš„ä¸€ä¸ªè®¨è®ºä¸‹æˆ‘å†³å®šæ‰¾ä¸€ä¸ªæ ‘è“æ´¾çš„ alternativeï¼Œæœ€åä¸‹å•äº† <a href="https://wiki.radxa.com/Rock3/" target="_blank" rel="noopener noreffer">Rock Pi 3A</a>ï¼Œåœ¨å› ä¸ºæ·±åœ³ç–«æƒ…å½±å“ä¸‹æ‹–åˆ°äº†è¿™ä¸ªç¤¼æ‹œæ‰ç»ˆäºå‘è´§äº†ï¼</p>
<p></p>
<p>å®ƒçœ‹èµ·æ¥çœŸçš„å¾ˆæ£’ï¼</p>
<p></p>
<h2 id="åœ¨-arm64-æ¿å­ä¸Šè£…-nebula-graph-å›¾æ•°æ®åº“" class="headerLink">
    <a href="#%e5%9c%a8-arm64-%e6%9d%bf%e5%ad%90%e4%b8%8a%e8%a3%85-nebula-graph-%e5%9b%be%e6%95%b0%e6%8d%ae%e5%ba%93" class="header-mark"></a>2 åœ¨ ARM64 æ¿å­ä¸Šè£… Nebula Graph å›¾æ•°æ®åº“</h2><blockquote>
<p>å®é™…ä¸Š Nebula Graph åœ¨ 3.0 ä¹‹åæä¾›äº†ä¸€ä¸ª<a href="https://docs.nebula-graph.com.cn/3.0.1/4.deployment-and-installation/standalone-deployment/" target="_blank" rel="noopener noreffer">å•æœºç‰ˆ</a>ï¼Œè¿™ä½¿å¾— Nebula åœ¨è¾¹ç¼˜è®¡ç®—æƒ…å†µä¸‹æœ‰äº†æ›´å°çš„ footprintï¼Œä¸è¿‡è¿™æ¬¡æˆ‘è¿˜æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬ï¼Œä¸‹æ¬¡è¯•è¯•å†ç»™å¤§å®¶åˆ†äº«ã€‚</p>
</blockquote>
<p>æˆ‘åœ¨é™„å½•åˆ—å‡ºäº†å®‰è£… Ubuntu Server çš„æ­¥éª¤ï¼Œè¿™é‡Œå‡è®¾å¤§å®¶å·²ç»åœ¨æ ‘è“æ´¾æˆ–è€…å…¶ä»–å•æ¿ ARM ç”µè„‘é‡Œæ‹‰èµ·æ¥äº† 64 ä½çš„ Linux Serverã€‚</p>
<h3 id="ç¬¬-0-æ­¥å®‰è£…-docker-å’Œ-docker-compose" class="headerLink">
    <a href="#%e7%ac%ac-0-%e6%ad%a5%e5%ae%89%e8%a3%85-docker-%e5%92%8c-docker-compose" class="header-mark"></a>2.1 ç¬¬ 0 æ­¥ï¼Œå®‰è£… Docker å’Œ Docker-Compose</h3><p>è¿™é‡Œï¼Œæˆ‘å‡è®¾æ˜¯ Debian/Ubuntuï¼Œå…¶ä»–åˆ†å‘ç‰ˆç›´æ¥å‚è€ƒ<a href="https://docs.docker.com/engine/install/" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a>å°±å¥½ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    curl <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    gnupg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    lsb-release
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="s2">&#34;deb [arch=</span><span class="k">$(</span>dpkg --print-architecture<span class="k">)</span><span class="s2"> signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
</span></span></span><span class="line"><span class="cl"><span class="s2">  </span><span class="k">$(</span>lsb_release -cs<span class="k">)</span><span class="s2"> stable&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install docker-ce docker-ce-cli containerd.io
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># follow https://docs.docker.com/engine/install/linux-postinstall/</span>
</span></span><span class="line"><span class="cl">sudo groupadd docker
</span></span><span class="line"><span class="cl">sudo usermod -aG docker <span class="nv">$USER</span>
</span></span><span class="line"><span class="cl"><span class="nb">exit</span>
</span></span><span class="line"><span class="cl"><span class="c1"># login again</span>
</span></span><span class="line"><span class="cl">newgrp docker
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®‰è£…å¥½äº† Docker ä¹‹åï¼Œå®‰è£… Composeï¼Œå®ƒ Docker å®˜æ–¹çš„æ­¥éª¤æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºå®ƒå…¶å®æ˜¯ä¸€ä¸ª Python çš„åŒ…ï¼Œæˆ‘ä»¬é€šè¿‡ PIP å»è£…å°±å¥½äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt-get install -y python3 python3-pip
</span></span><span class="line"><span class="cl">sudo pip3 install docker-compose
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç¬¬-1-æ­¥æ‹‰èµ·-nebula-graph" class="headerLink">
    <a href="#%e7%ac%ac-1-%e6%ad%a5%e6%8b%89%e8%b5%b7-nebula-graph" class="header-mark"></a>2.2 ç¬¬ 1 æ­¥ï¼Œæ‹‰èµ· Nebula Graph</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…‹éš† Nebula Docker Compose è¿™ä¸ª Repoï¼Œåœ¨ Master Branchï¼Œç”¨ Compose æŠŠæœåŠ¡æ‹‰èµ·æ¥ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/vesoft-inc/nebula-docker-compose.git <span class="o">&amp;&amp;</span> <span class="nb">cd</span> nebula-docker-compose
</span></span><span class="line"><span class="cl">docker-compose up -d
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬ä¸‹è½½ Consoleï¼Œè¿ä¸Š GraphD æœåŠ¡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://github.com/vesoft-inc/nebula-console/releases/download/v3.0.0/nebula-console-linux-arm64-v3.0.0
</span></span><span class="line"><span class="cl">chmod +x nebula-console-linux-arm64-v3.0.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">./nebula-console-linux-arm64-v3.0.0 -addr localhost -port <span class="m">9669</span> -u root -p nebula
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¹¶æ¿€æ´» Storage æœåŠ¡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ADD HOSTS <span class="s2">&#34;storaged0&#34;</span>:9779,<span class="s2">&#34;storaged1&#34;</span>:9779,<span class="s2">&#34;storaged2&#34;</span>:9779<span class="p">;</span>
</span></span><span class="line"><span class="cl">SHOW HOSTS<span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç¬¬-2-æ­¥ç©è½¬-nebula-graph-on-pi" class="headerLink">
    <a href="#%e7%ac%ac-2-%e6%ad%a5%e7%8e%a9%e8%bd%ac-nebula-graph-on-pi" class="header-mark"></a>2.3 ç¬¬ 2 æ­¥ï¼Œç©è½¬ Nebula Graph on Pi</h3><p>è¿™æ—¶å€™ï¼Œé€è¿‡ <code>SHOW HOSTS</code> çœ‹åˆ°ä¸‰ä¸ª StorageD æœåŠ¡éƒ½æ˜¯ ONLINE ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç»™ Nebula é‡ŒåŠ è½½è¿›å»æµ‹è¯•æ•°æ®é›†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$:play basketballplayer<span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å·®ä¸å¤šä¸€åˆ†é’Ÿä¹‹åï¼Œæ•°æ®åº“åŠ è½½æˆåŠŸï¼Œæˆ‘ä»¬è¿›å…¥è¿™ä¸ªå›¾ç©ºé—´ï¼Œç©ä¸€ä¸‹å§ï¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">USE basketballplayer<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">GO FROM <span class="s2">&#34;player100&#34;</span> OVER follow YIELD dst<span class="o">(</span>edge<span class="o">)</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Check this out and&hellip;</p>
<p>Happy Graphing!</p>
<p></p>
<h2 id="é™„å½•å®‰è£…-ubuntu-server-åœ¨-rock-pi-3a-ä¸Š" class="headerLink">
    <a href="#%e9%99%84%e5%bd%95%e5%ae%89%e8%a3%85-ubuntu-server-%e5%9c%a8-rock-pi-3a-%e4%b8%8a" class="header-mark"></a>3 é™„å½•ï¼šå®‰è£… Ubuntu Server åœ¨ Rock Pi 3A ä¸Š</h2><ul>
<li>
<p>å‡†å¤‡ä¸€ä¸ª micro SD cardï¼Œåœ¨  <a href="https://wiki.radxa.com/Rock3/downloads" target="_blank" rel="noopener noreffer">https://wiki.radxa.com/Rock3/downloads</a> ä¸‹è½½é•œåƒï¼Œè§£å‹ä¸º <code>.img</code> æ–‡ä»¶</p>
</li>
<li>
<p>æŠŠé•œåƒå†™è¿› SD cardï¼Œæ¯”å¦‚ç”¨ <a href="https://www.balena.io/etcher/" target="_blank" rel="noopener noreffer">etcher</a></p>
</li>
<li>
<p>æ’å…¥ç”µæºï¼ˆ5Vï¼Œ3Aï¼‰å¯åŠ¨ï¼</p>
</li>
</ul>
<blockquote>
<p>feature image credit: <a href="https://unsplash.com/@_louisreed" target="_blank" rel="noopener noreffer">@_louisreed</a></p>
</blockquote>]]></description>
</item><item>
    <title>å›¾æ•°æ®åº“ä½“æ“ï¼šç”¨ Nebula Graph æ­æˆè¯­å›¾è°±è§£æ±‰å…œ</title>
    <link>https://siwei.io/resolve-wordle/</link>
    <pubDate>Mon, 28 Feb 2022 19:18:59 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/resolve-wordle/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>æˆ‘å‘ç°ç”¨ Nebula Graph çš„å›¾æŸ¥è¯¢è§£ Antfu çš„æ±‰å…œï¼ˆæœ€å¥½çš„ä¸­æ–‡æˆè¯­ç‰ˆ wordle ğŸ‘‰ğŸ» handle.antfu.meï¼‰ç‰¹åˆ«æœ‰æ„æ€ï¼Œå¾ˆé€‚åˆæ¯å¤©å†™å›¾åº“è¯­å¥çš„ä½“æ“ç»ƒä¹ ï¼Œæœ¬æ–‡æ­ç¤ºå¦‚ä½•ç”¨çŸ¥è¯†å›¾è°±<del>ä½œå¼Š</del>è§£æ±‰å…œğŸ˜</p>
</blockquote>
<h2 id="ä»€ä¹ˆæ˜¯æ±‰å…œ" class="headerLink">
    <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e6%b1%89%e5%85%9c" class="header-mark"></a>1 ä»€ä¹ˆæ˜¯æ±‰å…œï¼Ÿ</h2><p>æ±‰å…œï¼ˆhttps://handle.antfu.meï¼‰æ˜¯ç”± Vue/Vite æ ¸å¿ƒå›¢é˜Ÿçš„ Antfu çš„åˆä¸€ä¸ªéå¸¸é…·çš„ä½œå“ï¼Œä¸€ä¸ªéå¸¸ç²¾è‡´çš„æ±‰å­—ç‰ˆçš„ Wordleï¼Œä»–æ˜¯æ˜¯ä¸€ä¸ªæ¯æ—¥æŒ‘æˆ˜çš„å¡«å­—æ¸¸æˆçš„ä¸­æ–‡æˆè¯­ç‰ˆã€‚</p>
<p>æ¯å¤©ï¼Œæ±‰å…œä¼šå‘èµ·ä¸€ä¸ªçŒœæˆè¯­æŒ‘æˆ˜ï¼Œäººä»¬è¦åœ¨åæ¬¡å†…æ‰å¯¹å®ƒæ‰èƒ½è·èƒœï¼Œæ¯ä¸€æ­¥ä¹‹åéƒ½ä¼šæ”¶åˆ°ç›¸åº”çš„æ–‡å­—ã€å£°æ¯ã€éŸµæ¯ã€å£°è°ƒçš„åŒ¹é…æƒ…å†µçš„æç¤ºï¼Œå…¶ä¸­ï¼šç»¿è‰²è¡¨ç¤ºè¿™ä¸ªå› ç´ å­˜åœ¨å¹¶ä¸”ä½ç½®åŒ¹é…ã€æ©˜è‰²è¡¨ç¤ºè¿™ä¸ªå…ƒç´ å­˜åœ¨ä½†æ˜¯ä½ç½®ä¸å¯¹ï¼Œè¯¦ç»†çš„è§„åˆ™å¯è§å¦‚ä¸‹çš„ç½‘é¡µæˆªå›¾ï¼š</p>
<p></p>
<p>æ±‰å…œçš„ä¹è¶£å°±æˆ‘ä»¬åœ¨äºåœ¨æœ‰é™çš„å°è¯•è¿‡ç¨‹ä¸­ï¼Œåœ¨å¤§è„‘ä¸­æœå¯»å¯èƒ½çš„ç­”æ¡ˆï¼Œä¸æ–­å»é€¼è¿‘çœŸç†ï¼Œä»»ä½•è¯•å›¾ä½œå¼Šã€è®¨å·§å»æ³„æ¼ç»“æœçš„è¡Œä¸ºéƒ½æ˜¯å¾ˆæ— è¶£ã€å€’èƒƒå£çš„ï¼ˆæ¯”å¦‚ä»å¼€æºçš„æ±‰å…œä»£ç é‡Œçªƒå–ä¿¡æ¯ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒåœ¨åšå¤§è„‘çš„ä½“æ“ã€‚</p>
<p>è¯´åˆ°å¤§è„‘çš„æˆè¯­è¯æ±‡é‡ä½“æ“ï¼Œæˆ‘çªç„¶æƒ³åˆ°ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½åœ¨å¤§è„‘ä¹‹å¤–é€ ä¸€ä¸ªæ±‰è¯­æˆè¯­çŸ¥è¯†å›¾è°±ï¼Œç„¶ååŸºäºè¿™ä¸ªå›¾è°±å»åšå›¾æ•°æ®åº“æŸ¥è¯¢è¯­æ³•ä½“æ“å‘¢ï¼Ÿ</p>
<h2 id="æ„é€ è§£å†³æ±‰å…œçš„æˆè¯­çŸ¥è¯†å›¾è°±" class="headerLink">
    <a href="#%e6%9e%84%e9%80%a0%e8%a7%a3%e5%86%b3%e6%b1%89%e5%85%9c%e7%9a%84%e6%88%90%e8%af%ad%e7%9f%a5%e8%af%86%e5%9b%be%e8%b0%b1" class="header-mark"></a>2 æ„é€ è§£å†³æ±‰å…œçš„æˆè¯­çŸ¥è¯†å›¾è°±</h2><h3 id="ä»€ä¹ˆæ˜¯çŸ¥è¯†å›¾è°±" class="headerLink">
    <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e7%9f%a5%e8%af%86%e5%9b%be%e8%b0%b1" class="header-mark"></a>2.1 ä»€ä¹ˆæ˜¯çŸ¥è¯†å›¾è°±ï¼Ÿ</h3><p>ç®€å•æ¥è¯´ï¼ŒçŸ¥è¯†å›¾è°±æ˜¯ä¸€ä¸ªè¿æ¥å®ä½“ä¹‹é—´å…³è”å…³ç³»çš„ç½‘ç»œï¼Œå®ƒæœ€åˆç”± Google æå‡ºå¹¶ç”¨æ¥æ»¡è¶³æœç´¢å¼•æ“ä¸­åŸºäºçŸ¥è¯†æ¨ç†æ‰å¯è·å¾—ï¼ˆè€Œä¸æ˜¯ç½‘é¡µå€’æ’ç´¢å¼•ï¼‰çš„æœç´¢é—®é¢˜ï¼Œæ¯”å¦‚ï¼šâ€å§šæ˜å¦»å­çš„å¹´é¾„ï¼Ÿâ€œã€â€ç«ç®­é˜Ÿå¾—è¿‡å‡ æ¬¡æ€»å† å†›ï¼Ÿâ€œ</p>
<p>è¿™é‡Œè¾¹ï¼Œæˆ‘ä»¬å…³æ³¨çš„æ¡ä»¶ã€‚åˆ° 2022 å¹´çš„ç°åœ¨ï¼ŒçŸ¥è¯†å›¾è°±å·²ç»è¢«å¹¿æ³›åº”ç”¨åœ¨æ¨èç³»ç»Ÿã€é—®ç­”ç³»ç»Ÿã€å®‰å…¨é£æ§ç­‰ç­‰æ›´å¤šæœç´¢ä¹‹å¤–çš„é¢†åŸŸã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦ç”¨çŸ¥è¯†å›¾è°±è§£å†³æ±‰å…œ" class="headerLink">
    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e7%94%a8%e7%9f%a5%e8%af%86%e5%9b%be%e8%b0%b1%e8%a7%a3%e5%86%b3%e6%b1%89%e5%85%9c" class="header-mark"></a>2.2 ä¸ºä»€ä¹ˆéœ€è¦ç”¨çŸ¥è¯†å›¾è°±è§£å†³æ±‰å…œï¼Ÿ</h3><p><del>åŸå› å°±æ˜¯ï¼šbecause I can</del></p>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨å¤§è„‘ä¸­è§£å†³å­—è°œæ¸¸æˆçš„è¿‡ç¨‹åƒæäº†å›¾è°±ç½‘ç»œä¸­çš„ä¿¡æ¯æœå¯»çš„è¿‡ç¨‹ï¼Œæ±‰å…œçš„è§£è°œåé¦ˆæç¤ºæ¡ä»¶å¤©ç„¶é€‚åˆè¢«ç”¨å›¾è°±çš„è¯­ä¹‰æ¥è¿›è¡Œè¡¨è¾¾ã€‚åœ¨æœ¬æ–‡åè¾¹ï¼Œä½ ä»¬ä¼šå‘ç°è§£è°œæ¡ä»¶ç¿»è¯‘æˆå›¾è¯­ä¹‰æ˜¯éå¸¸éå¸¸è‡ªç„¶çš„ï¼Œè¿™ä¸ªé—®é¢˜å°±åƒæ˜¯ä¸€ä¸ªå¤©ç„¶çš„ä¸ºå›¾è°±è€Œå­˜åœ¨çš„ç»ƒä¹ ä¸€æ ·ï¼Œæˆ‘ç›¸ä¿¡è¿™å’ŒçŸ¥è¯†å›¾è°±çš„ç»“æ„å’Œäººè„‘ä¸­çš„çŸ¥è¯†ç»“æ„éå¸¸æ¥è¿‘æœ‰å¾ˆå¤§çš„å…³ç³»ã€‚</p>
<h3 id="å¦‚ä½•æ„å»ºé¢å‘æ±‰å…œè§£è°œçš„çŸ¥è¯†å›¾è°±" class="headerLink">
    <a href="#%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e9%9d%a2%e5%90%91%e6%b1%89%e5%85%9c%e8%a7%a3%e8%b0%9c%e7%9a%84%e7%9f%a5%e8%af%86%e5%9b%be%e8%b0%b1" class="header-mark"></a>2.3 å¦‚ä½•æ„å»ºé¢å‘æ±‰å…œè§£è°œçš„çŸ¥è¯†å›¾è°±ï¼Ÿ</h3><p>çŸ¥è¯†å›¾è°±æ˜¯ç”±å®ä½“ï¼ˆé¡¶ç‚¹ï¼‰å’Œå…³ç³»ï¼ˆè¾¹ï¼‰ç»„æˆçš„ï¼Œç”¨å›¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆGraph Database MSï¼‰å¯ä»¥å¾ˆæ–¹ä¾¿è¿›è¡ŒçŸ¥è¯†çš„å…¥åº“ã€æ›´æ”¹ã€æŸ¥è¯¢ã€ç”šè‡³å¯è§†åŒ–æ¢ç´¢ã€‚</p>
<p>åœ¨æœ¬æ–‡é‡Œï¼Œæˆ‘å°†åˆ©ç”¨å¼€æºçš„åˆ†å¸ƒå¼å›¾æ•°æ®åº“ Nebula Graph å¼€å®è·µè¿™ä¸ªè¿‡ç¨‹ï¼Œå…·ä½“å›¾è°±ç³»ç»Ÿçš„æ­å»ºæˆ‘éƒ½ä¼šæ”¾åœ¨æ–‡æœ«ã€‚</p>
<p>åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬åªè®¨è®ºå›¾è°±çš„å»ºæ¨¡ï¼šå¦‚ä½•é¢å‘æ±‰å…œçš„è§£è°œå»è®¾è®¡â€œå®ä½“â€ä¸â€œå…³ç³»â€ã€‚</p>
<h4 id="å›¾å»ºæ¨¡" class="headerLink">
    <a href="#%e5%9b%be%e5%bb%ba%e6%a8%a1" class="header-mark"></a>2.3.1 å›¾å»ºæ¨¡</h4><h5 id="æœ€åˆçš„æƒ³æ³•" class="headerLink">
    <a href="#%e6%9c%80%e5%88%9d%e7%9a%84%e6%83%b3%e6%b3%95" class="header-mark"></a>2.3.1.1 æœ€åˆçš„æƒ³æ³•</h5><p>é¦–å…ˆï¼Œä¸€å®šå­˜åœ¨çš„å®ä½“æ˜¯ï¼š</p>
<ul>
<li>æˆè¯­</li>
<li>æ±‰å­—</li>
</ul>
<p>æˆè¯­-[åŒ…å«]-&gt;æ±‰å­—ï¼Œæ¯ä¸ªæ±‰å­—-[è¯»ä½œ]-&gt;è¯»éŸ³ã€‚</p>
<p>å…¶æ¬¡ï¼Œå› ä¸ºè§£è°œè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°äº†å£°æ¯ã€éŸµæ¯ä»¥åŠå£°è°ƒçš„æ¡ä»¶ï¼Œè€ƒè™‘åˆ°å›¾è°±æœ¬èº«çš„é‡çº§éå¸¸å°ï¼ˆåƒçº§åˆ«ï¼‰ï¼Œè€Œä¸”å­—çš„è¯»éŸ³æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œæˆ‘æŠŠè¯»éŸ³å’Œå£°æ¯ï¼ˆåŒ…æ¶µå£°æ¯-initialå’ŒéŸµæ¯-finalï¼‰ä¹Ÿä½œä¸ºå®ä½“ï¼Œä»–ä»¬ä¹‹é—´çš„å…³ç³»åˆ™æ˜¯é¡ºç†æˆç« äº†ï¼š</p>
<p></p>
<h5 id="æœ€ç»ˆçš„ç‰ˆæœ¬" class="headerLink">
    <a href="#%e6%9c%80%e7%bb%88%e7%9a%84%e7%89%88%e6%9c%ac" class="header-mark"></a>2.3.1.2 æœ€ç»ˆçš„ç‰ˆæœ¬</h5><p>ç„¶è€Œï¼Œæˆ‘åœ¨åè¾¹åŸºäºå›¾è°±è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™å‘ç°æœ€åˆçš„å»ºæ¨¡ä¼šä½¿å¾—(æˆè¯­)&ndash;&gt;(å­—)&ndash;&gt;(è¯»éŸ³)æŸ¥è¯¢è¿‡ç¨‹ä¸­ä¸¢å¤±äº†è¿™ä¸ªå­—ç‰¹å®šçš„è¯»æ³•çš„æ¡ä»¶ï¼Œæ‰€ä»¥æˆ‘æœ€ç»ˆçš„å»ºæ¨¡æ˜¯ï¼š</p>
<p></p>
<p>è¿™æ ·ï¼Œçº¯æ–‡å­—çš„æ¡ä»¶åªæ¶‰åŠäº†<code>(æˆè¯­)--&gt;(å­—)</code> è¿™ä¸€è·³ï¼Œè€Œè¯»éŸ³ã€å£°æ¯ã€å£°è°ƒçš„æ¡ä»¶åˆ™æ˜¯å¦ä¸€æ¡å…³ç³»è·¯å¾„ï¼Œæ—¢æ²¡æœ‰æœ€åˆç‰ˆæœ¬æ¡ä»¶çš„å†—ä½™ï¼Œåˆå¯ä»¥åœ¨ä¸€ä¸ªè·¯å¾„æ¨¡å¼åŒ¹é…é‡Œå¸¦ä¸Šä¸¤ç§æ¡ä»¶ï¼ˆåè¾¹çš„ä¾‹å­é‡Œä¼šæ¶‰åŠè¿™æ ·çš„è¡¨è¾¾ï¼‰ã€‚</p>
<h4 id="æ„å»ºæˆè¯­çŸ¥è¯†å›¾è°±" class="headerLink">
    <a href="#%e6%9e%84%e5%bb%ba%e6%88%90%e8%af%ad%e7%9f%a5%e8%af%86%e5%9b%be%e8%b0%b1" class="header-mark"></a>2.3.2 æ„å»ºæˆè¯­çŸ¥è¯†å›¾è°±</h4><p>æœ‰äº†å»ºæ¨¡ã€è¿™ä¹ˆç®€å•çš„å›¾è°±çš„æ„å»ºå°±å‰©ä¸‹äº†æ•°æ®çš„æ”¶é›†ã€æ¸…æ´—å’Œå…¥åº“ã€‚</p>
<p>å¯¹äºæ‰€æœ‰æˆè¯­æ•°æ®å’Œä»–ä»¬çš„è¯»éŸ³ï¼Œæˆ‘ä¸€æ–¹é¢ç›´æ¥æŠ½å–äº†æ±‰å…œä»£ç å†…éƒ¨çš„<a href="https://github.com/antfu/handle/" target="_blank" rel="noopener noreffer">æ•°æ®</a>ã€å¦ä¸€æ–¹é¢åˆ©ç”¨ <a href="https://pypinyin.readthedocs.io/" target="_blank" rel="noopener noreffer">PyPinyin</a> è¿™ä¸ªå¼€æºçš„ Python åº“å°†æ±‰å…œæ•°æ®ä¸­æ²¡æœ‰è¯»éŸ³çš„æ•°æ®è·å¾—è¯»éŸ³ï¼ŒåŒæ—¶ï¼Œæˆ‘ä¹Ÿç”¨åˆ°äº† PyPinyin é‡Œçš„å¾ˆå¤šæ–¹ä¾¿çš„å‡½æ•°æ¯”å¦‚è·å–ä¸€ä¸ªæ‹¼éŸ³çš„å£°æ¯ã€éŸµæ¯ã€‚</p>
<p>æ„å»ºå·¥å…·çš„ä»£ç åœ¨è¿™é‡Œï¼šhttps://github.com/wey-gu/chinese-graph</p>
<p>æ›´å¤šä¿¡æ¯æˆ‘ä¹Ÿæ”¾åœ¨æ–‡æœ«çš„é™„å½•ä¹‹ä¸­ã€‚</p>
<h2 id="å¼€å§‹çŸ¥è¯†å›¾è°±æŸ¥è¯¢ä½“æ“" class="headerLink">
    <a href="#%e5%bc%80%e5%a7%8b%e7%9f%a5%e8%af%86%e5%9b%be%e8%b0%b1%e6%9f%a5%e8%af%a2%e4%bd%93%e6%93%8d" class="header-mark"></a>3 å¼€å§‹çŸ¥è¯†å›¾è°±æŸ¥è¯¢ä½“æ“</h2><p>è‡³æ­¤ï¼Œæˆ‘å‡è®¾å’±ä»¬éƒ½å·²ç»æœ‰äº†æˆ‘å¸®å¤§å®¶æ­å»ºçš„æˆè¯­<del>ä½œå¼Š</del>çŸ¥è¯†å›¾è°±äº†ï¼Œå¼€å§‹æˆ‘ä»¬çš„å›¾è°±æŸ¥è¯¢ä½“æ“å§ï¼</p>
<p>é¦–å…ˆï¼Œæ‰“å¼€æ±‰å…œ ğŸ‘‰ğŸ» <a href="https://handle.antfu.me/" target="_blank" rel="noopener noreffer">https://handle.antfu.me/</a></p>
<p>å‡è®¾æˆ‘ä»¬æƒ³ä»ä¸€ä¸ªæˆè¯­å¼€å§‹ï¼Œå¦‚æœä½ æ²¡æœ‰æƒ³æ³•çš„è¯å¯ä»¥è¯•è¯•è¿™ä¸ªï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GraphQL" data-lang="GraphQL"><span class="line"><span class="cl"><span class="c"># åŒ¹é…æˆè¯­ä¸­çš„ä¸€ä¸ªç»“æœ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">x</span><span class="p">:</span><span class="nc">idiom</span><span class="p">)</span><span class="w"> </span><span class="py">RETURN</span><span class="w"> </span><span class="py">x</span><span class="w"> </span><span class="py">LIMIT</span><span class="w"> </span><span class="py">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># è¿”å›ç»“æœ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s">&#34;çˆ±æ†åˆ†æ˜&#34;</span><span class="w"> </span><span class="p">:</span><span class="nc">idiom</span><span class="p">{</span><span class="py">pinyin</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;[&#39;ai4&#39;, &#39;zeng1&#39;, &#39;fen1&#39;, &#39;ming2&#39;]&#34;</span><span class="p">})</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæˆ‘ä»¬æŠŠå®ƒå¡«åˆ°æ±‰å…œä¹‹ä¸­ï¼Œè·å¾—ç¬¬ä¸€æ¬¡å°è¯•çš„æç¤ºæ¡ä»¶ï¼š</p>
<p></p>
<p>æˆ‘ä»¬è¿æ°”ä¸é”™ï¼Œå¾—åˆ°äº†ä¸‰ä¸ªä½ç½®ä¸Šçš„æ¡ä»¶ï¼</p>
<ul>
<li>æœ‰ä¸€ä¸ªéç¬¬ä¸€ä¸ªä½ç½®çš„å­—ï¼Œæ‹¼éŸ³æ˜¯ 4 å£°ï¼ŒéŸµæ¯æ˜¯ aiï¼Œä½†ä¸æ˜¯çˆ±ï¼ˆçˆ±ï¼‰</li>
<li>æœ‰ä¸€ä¸ªä¸€å£°çš„å­—ï¼Œä¸åœ¨ç¬¬äºŒä¸ªä½ç½®ï¼ˆæ†ï¼‰</li>
<li>æœ‰ä¸€ä¸ªå­—éŸµæ¯æ˜¯ ingï¼Œä¸åœ¨ç¬¬å››ä¸ªä½ç½®ï¼ˆæ˜ï¼‰</li>
<li>ç¬¬å››ä¸ªå­—æ˜¯äºŒå£°ï¼ˆæ˜ï¼‰</li>
</ul>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹å›¾æ•°æ®åº“è¯­å¥ä½“æ“ï¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GraphQL" data-lang="GraphQL"><span class="line"><span class="cl"><span class="c"># æœ‰ä¸€ä¸ªéç¬¬ä¸€ä¸ªä½ç½®çš„å­—ï¼Œæ‹¼éŸ³æ˜¯ 4 å£°ï¼ŒéŸµæ¯æ˜¯ aiï¼Œä½†ä¸æ˜¯çˆ±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">char0</span><span class="p">:</span><span class="nc">character</span><span class="p">)</span><span class="err">&lt;-</span><span class="p">[</span><span class="py">with_char_0</span><span class="p">:</span><span class="nc">with_character</span><span class="p">]</span><span class="err">-</span><span class="p">(</span><span class="py">x</span><span class="p">:</span><span class="nc">idiom</span><span class="p">)</span><span class="err">-</span><span class="p">[</span><span class="py">with_pinyin_0</span><span class="p">:</span><span class="nc">with_pinyin</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">pinyin_0</span><span class="p">:</span><span class="nc">character_pinyin</span><span class="p">)</span><span class="err">-</span><span class="p">[:</span><span class="nc">with_pinyin_part</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">final_part_0</span><span class="p">:</span><span class="nc">pinyin_part</span><span class="p">{</span><span class="py">part_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;final&#34;</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nc">WHERE</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">final_part_0</span><span class="p">)</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&#34;ai&#34;</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">pinyin_0</span><span class="err">.</span><span class="py">character_pinyin</span><span class="err">.</span><span class="py">tone</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="py">4</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">with_pinyin_0</span><span class="err">.</span><span class="py">position</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="py">0</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">with_char_0</span><span class="err">.</span><span class="py">position</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="py">0</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">char0</span><span class="p">)</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="sc">&#34;çˆ±&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># æœ‰ä¸€ä¸ªä¸€å£°çš„å­—ï¼Œä¸åœ¨ç¬¬äºŒä¸ªä½ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">x</span><span class="p">:</span><span class="nc">idiom</span><span class="p">)</span><span class="w"> </span><span class="err">-</span><span class="p">[</span><span class="py">with_pinyin_1</span><span class="p">:</span><span class="nc">with_pinyin</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">pinyin_1</span><span class="p">:</span><span class="nc">character_pinyin</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">WHERE</span><span class="w"> </span><span class="py">pinyin_1</span><span class="err">.</span><span class="py">character_pinyin</span><span class="err">.</span><span class="py">tone</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="py">1</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">with_pinyin_1</span><span class="err">.</span><span class="py">position</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="py">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># æœ‰ä¸€ä¸ªå­—éŸµæ¯æ˜¯ ingï¼Œä¸åœ¨ç¬¬å››ä¸ªä½ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">x</span><span class="p">:</span><span class="nc">idiom</span><span class="p">)</span><span class="w"> </span><span class="err">-</span><span class="p">[</span><span class="py">with_pinyin_2</span><span class="p">:</span><span class="nc">with_pinyin</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(:</span><span class="nc">character_pinyin</span><span class="p">)</span><span class="err">-</span><span class="p">[:</span><span class="nc">with_pinyin_part</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">final_part_2</span><span class="p">:</span><span class="nc">pinyin_part</span><span class="p">{</span><span class="py">part_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;final&#34;</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nc">WHERE</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">final_part_2</span><span class="p">)</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&#34;ing&#34;</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">with_pinyin_2</span><span class="err">.</span><span class="py">position</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="py">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ç¬¬å››ä¸ªå­—æ˜¯äºŒå£°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">x</span><span class="p">:</span><span class="nc">idiom</span><span class="p">)</span><span class="w"> </span><span class="err">-</span><span class="p">[</span><span class="py">with_pinyin_3</span><span class="p">:</span><span class="nc">with_pinyin</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">pinyin_3</span><span class="p">:</span><span class="nc">character_pinyin</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">WHERE</span><span class="w"> </span><span class="py">pinyin_3</span><span class="err">.</span><span class="py">character_pinyin</span><span class="err">.</span><span class="py">tone</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="py">2</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">with_pinyin_3</span><span class="err">.</span><span class="py">position</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="py">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">RETURN</span><span class="w"> </span><span class="py">x</span><span class="p">,</span><span class="w"> </span><span class="py">count</span><span class="p">(</span><span class="py">x</span><span class="p">)</span><span class="w"> </span><span class="py">as</span><span class="w"> </span><span class="py">c</span><span class="w"> </span><span class="py">ORDER</span><span class="w"> </span><span class="py">BY</span><span class="w"> </span><span class="py">c</span><span class="w"> </span><span class="py">DESC</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å›¾æ•°æ®åº“ä¹‹ä¸­è¿è¡Œï¼Œå¾—åˆ°äº† 7 ä¸ªç­”æ¡ˆï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">(</span><span class="s2">&#34;æƒŠæ„šéª‡ä¿—&#34;</span> <span class="err">:idiom</span><span class="p">{</span><span class="err">pinyin:</span> <span class="nt">&#34;[&#39;jing1&#39;, &#39;yu2&#39;, &#39;hai4&#39;, &#39;su2&#39;]&#34;</span><span class="p">}</span><span class="err">)</span>
</span></span><span class="line"><span class="cl"><span class="err">(</span><span class="s2">&#34;æƒŠä¸–éª‡ä¿—&#34;</span> <span class="err">:idiom</span><span class="p">{</span><span class="err">pinyin:</span> <span class="nt">&#34;[&#39;jing1&#39;, &#39;shi4&#39;, &#39;hai4&#39;, &#39;su2&#39;]&#34;</span><span class="p">}</span><span class="err">)</span>
</span></span><span class="line"><span class="cl"><span class="err">(</span><span class="s2">&#34;æƒŠè§éª‡é—»&#34;</span> <span class="err">:idiom</span><span class="p">{</span><span class="err">pinyin:</span> <span class="nt">&#34;[&#39;jing1&#39;, &#39;jian4&#39;, &#39;hai4&#39;, &#39;wen2&#39;]&#34;</span><span class="p">}</span><span class="err">)</span>
</span></span><span class="line"><span class="cl"><span class="err">(</span><span class="s2">&#34;æ²½åå–ç›´&#34;</span> <span class="err">:idiom</span><span class="p">{</span><span class="err">pinyin:</span> <span class="nt">&#34;[&#39;gu1&#39;, &#39;ming2&#39;, &#39;mai4&#39;, &#39;zhi2&#39;]&#34;</span><span class="p">}</span><span class="err">)</span>
</span></span><span class="line"><span class="cl"><span class="err">(</span><span class="s2">&#34;æƒŠå¿ƒéª‡ç¥&#34;</span> <span class="err">:idiom</span><span class="p">{</span><span class="err">pinyin:</span> <span class="nt">&#34;[&#39;jing1&#39;, &#39;xin1&#39;, &#39;hai4&#39;, &#39;shen2&#39;]&#34;</span><span class="p">}</span><span class="err">)</span>
</span></span><span class="line"><span class="cl"><span class="err">(</span><span class="s2">&#34;è†æ£˜è½½é€”&#34;</span> <span class="err">:idiom</span><span class="p">{</span><span class="err">pinyin:</span> <span class="nt">&#34;[&#39;jing1&#39;, &#39;ji2&#39;, &#39;zai4&#39;, &#39;tu2&#39;]&#34;</span><span class="p">}</span><span class="err">)</span>
</span></span><span class="line"><span class="cl"><span class="err">(</span><span class="s2">&#34;å‡ºå–çµé­‚&#34;</span> <span class="err">:idiom</span><span class="p">{</span><span class="err">pinyin:</span> <span class="nt">&#34;[&#39;chu1&#39;, &#39;mai4&#39;, &#39;ling2&#39;, &#39;hun2&#39;]&#34;</span><span class="p">}</span><span class="err">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>çœ‹èµ·æ¥ <code>æƒŠä¸–éª‡ä¿—</code> æ¯”è¾ƒä¸»æµï¼Œè¯•è¯•ï¼</p>
<p></p>
<p>æˆ‘ä»¬å¾ˆå¹¸è¿ï¼Œå€ŸåŠ©äºæˆè¯­<del>ä½œå¼Š</del>çŸ¥è¯†å›¾è°±ï¼Œå±…ç„¶ä¸€æ¬¡å°±æ‰¾åˆ°äº†ç­”æ¡ˆï¼Œå½“ç„¶è¿™å®é™…ä¸Šå¾—ç›Šäºç¬¬ä¸€æ¬¡éšæœºé€‰å–çš„è¯å¸¦æ¥çš„é™åˆ¶æ¡ä»¶çš„ä¸ªæ•°ï¼Œä¸è¿‡åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¸¤æ¬¡å°è¯•è·å¾—æœ€ç»ˆç­”æ¡ˆçš„å¯èƒ½æ€§è¿˜æ˜¯éå¸¸å¤§çš„ï¼</p>
<blockquote>
<p>æ³¨ï¼Œè¿™ä¸­é—´å¾ˆé•¿çš„253åˆ†é’Ÿæ˜¯å› ä¸ºæˆ‘åœ¨æŸ¥è¯¢ä¸­å‘ç°ä¹‹å‰ä»£ç é‡Œæ„é€ çš„å›¾è°±æœ‰ç‚¹ bugï¼Œæ˜¯â€œæŠ«æ·å¸¦é”â€è¿™ä¸ªè¯å¼•èµ·çš„è¯»éŸ³å›¾è°±çš„é”™è¯¯æ•°æ®ï¼Œè¿˜å¥½åæ¥è¢«ä¿®å¤äº†ã€‚</p>
<p>å¤§å®¶çŸ¥é“â€œæŠ«æ·å¸¦é”â€çš„æ­£ç¡®è¯»éŸ³ä¹ˆï¼ŸğŸ˜­</p>
</blockquote>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ç»™å¤§å®¶è¯¦ç»†è§£é‡Šä¸€ä¸‹è¿™ä¸ªè¯­å¥çš„æ„æ€ã€‚</p>
<h3 id="è¯­å¥çš„å«ä¹‰" class="headerLink">
    <a href="#%e8%af%ad%e5%8f%a5%e7%9a%84%e5%90%ab%e4%b9%89" class="header-mark"></a>3.1 è¯­å¥çš„å«ä¹‰</h3><p>æˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªå­—çš„æ¡ä»¶å¼€å§‹ï¼Œè¿™æ˜¯ä¸€ä¸ªæ—¢æœ‰å£°éŸ³ã€åˆæœ‰å­—å½¢ä¿¡æ¯çš„æ¡ä»¶ã€‚</p>
<ul>
<li>å£°éŸ³ä¿¡æ¯ï¼šå­˜åœ¨ä¸€ä¸ªéŸµæ¯ä¸º <code>ai4</code> çš„å‘éŸ³ï¼Œä½ç½®ä¸åœ¨ç¬¬ä¸€ä¸ªå­—</li>
<li>æ–‡å­—ä¿¡æ¯ï¼šè¿™ä¸ªéŸµæ¯ä¸º <code>ai4</code> çš„å­—ï¼Œä¸æ˜¯<code>çˆ±</code>å­—</li>
</ul>
<p>å¯¹äºå£°éŸ³ä¿¡æ¯æ¡ä»¶ï¼Œè½¬æ¢ä¸ºå›¾æ¨¡å¼åŒ¹é…ä¸ºï¼š(æˆè¯­)-ä¸€ä¸ªå­—å‘éŸ³-(æ‹¼éŸ³) -åŒ…å«å£°æ¯-(éŸµæ¯) WHERE æ‹¼éŸ³éŸµæ¯ä¸º <code>ai4</code> AND ä½ç½®ä¸æ˜¯ç¬¬ä¸€ä¸ªã€‚</p>
<p>å› ä¸ºå»ºæ¨¡çš„æ—¶å€™ï¼Œå±æ€§åç§°æˆ‘ç”¨çš„æ˜¯è‹±æ–‡ï¼ˆå…¶å®ä¸­æ–‡ä¹Ÿæ˜¯æ”¯æŒçš„ï¼‰ï¼Œå®é™…ä¸Šçš„è¯­å¥ä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GraphQL" data-lang="GraphQL"><span class="line"><span class="cl"><span class="c"># æœ‰ä¸€ä¸ªéç¬¬ä¸€ä¸ªä½ç½®çš„å­—ï¼Œæ‹¼éŸ³æ˜¯ 4 å£°ï¼ŒéŸµæ¯æ˜¯ ai</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">x</span><span class="p">:</span><span class="nc">idiom</span><span class="p">)</span><span class="err">-</span><span class="p">[</span><span class="py">with_pinyin_0</span><span class="p">:</span><span class="nc">with_pinyin</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">pinyin_0</span><span class="p">:</span><span class="nc">character_pinyin</span><span class="p">)</span><span class="err">-</span><span class="p">[:</span><span class="nc">with_pinyin_part</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">final_part_0</span><span class="p">:</span><span class="nc">pinyin_part</span><span class="p">{</span><span class="py">part_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;final&#34;</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nc">WHERE</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">final_part_0</span><span class="p">)</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&#34;ai&#34;</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">pinyin_0</span><span class="err">.</span><span class="py">character_pinyin</span><span class="err">.</span><span class="py">tone</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="py">4</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">with_pinyin_0</span><span class="err">.</span><span class="py">position</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="py">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">RETURN</span><span class="w"> </span><span class="py">x</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç±»ä¼¼çš„ï¼Œè¡¨ç¤ºéç¬¬ä¸€ä¸ªä½ç½®çš„å­—ï¼Œä¸æ˜¯<code>çˆ±</code> çš„è¡¨è¾¾æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GraphQL" data-lang="GraphQL"><span class="line"><span class="cl"><span class="c"># æœ‰ä¸€ä¸ªéç¬¬ä¸€ä¸ªä½ç½®çš„å­—ï¼Œæ‹¼éŸ³æ˜¯ 4 å£°ï¼ŒéŸµæ¯æ˜¯ aiï¼Œä½†ä¸æ˜¯çˆ±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">char0</span><span class="p">:</span><span class="nc">character</span><span class="p">)</span><span class="err">&lt;-</span><span class="p">[</span><span class="py">with_char_0</span><span class="p">:</span><span class="nc">with_character</span><span class="p">]</span><span class="err">-</span><span class="p">(</span><span class="py">x</span><span class="p">:</span><span class="nc">idiom</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">WHERE</span><span class="w"> </span><span class="py">with_char_0</span><span class="err">.</span><span class="py">position</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="py">0</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">char0</span><span class="p">)</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="sc">&#34;çˆ±&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">RETURN</span><span class="w"> </span><span class="py">x</span><span class="p">,</span><span class="w"> </span><span class="py">count</span><span class="p">(</span><span class="py">x</span><span class="p">)</span><span class="w"> </span><span class="py">as</span><span class="w"> </span><span class="py">c</span><span class="w"> </span><span class="py">ORDER</span><span class="w"> </span><span class="py">BY</span><span class="w"> </span><span class="py">c</span><span class="w"> </span><span class="py">DESC</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è€Œå› ä¸ºè¿™ä¸¤ä¸ªæ¡ä»¶æœ€ç»ˆæè¿°çš„æ˜¯åŒä¸€ä¸ªå­—ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯å¯ä»¥è¢«å†™åœ¨ä¸€ä¸ªè·¯å¾„ä¸‹çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GraphQL" data-lang="GraphQL"><span class="line"><span class="cl"><span class="c"># æœ‰ä¸€ä¸ªéç¬¬ä¸€ä¸ªä½ç½®çš„å­—ï¼Œæ‹¼éŸ³æ˜¯ 4 å£°ï¼ŒéŸµæ¯æ˜¯ aiï¼Œä½†ä¸æ˜¯çˆ±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">char0</span><span class="p">:</span><span class="nc">character</span><span class="p">)</span><span class="err">&lt;-</span><span class="p">[</span><span class="py">with_char_0</span><span class="p">:</span><span class="nc">with_character</span><span class="p">]</span><span class="err">-</span><span class="p">(</span><span class="py">x</span><span class="p">:</span><span class="nc">idiom</span><span class="p">)</span><span class="err">-</span><span class="p">[</span><span class="py">with_pinyin_0</span><span class="p">:</span><span class="nc">with_pinyin</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">pinyin_0</span><span class="p">:</span><span class="nc">character_pinyin</span><span class="p">)</span><span class="err">-</span><span class="p">[:</span><span class="nc">with_pinyin_part</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">final_part_0</span><span class="p">:</span><span class="nc">pinyin_part</span><span class="p">{</span><span class="py">part_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;final&#34;</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nc">WHERE</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">final_part_0</span><span class="p">)</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&#34;ai&#34;</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">pinyin_0</span><span class="err">.</span><span class="py">character_pinyin</span><span class="err">.</span><span class="py">tone</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="py">4</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">with_pinyin_0</span><span class="err">.</span><span class="py">position</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="py">0</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">with_char_0</span><span class="err">.</span><span class="py">position</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="py">0</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">char0</span><span class="p">)</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="sc">&#34;çˆ±&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">RETURN</span><span class="w"> </span><span class="py">x</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ›´å¤šçš„ <code>MATCH</code> è¯­æ³•å’Œä¾‹å­ç»†èŠ‚ï¼Œè¯·å¤§å®¶å‚è€ƒæ–‡æ¡£ï¼š</p>
<ul>
<li>MATCH <a href="https://docs.nebula-graph.com.cn/3.0.0/3.ngql-guide/7.general-query-statements/2.match/" target="_blank" rel="noopener noreffer">https://docs.nebula-graph.com.cn/3.0.0/3.ngql-guide/7.general-query-statements/2.match/</a></li>
<li>å›¾æ¨¡å¼ <a href="https://docs.nebula-graph.com.cn/3.0.0/3.ngql-guide/1.nGQL-overview/3.graph-patterns/" target="_blank" rel="noopener noreffer">https://docs.nebula-graph.com.cn/3.0.0/3.ngql-guide/1.nGQL-overview/3.graph-patterns/</a></li>
<li>nGQL å‘½ä»¤ cheatsheet <a href="https://docs.nebula-graph.com.cn/3.0.0/2.quick-start/6.cheatsheet-for-ngql-command/" target="_blank" rel="noopener noreffer">https://docs.nebula-graph.com.cn/3.0.0/2.quick-start/6.cheatsheet-for-ngql-command/</a></li>
</ul>
<h2 id="å¯è§†åŒ–å±•ç¤ºçº¿ç´¢" class="headerLink">
    <a href="#%e5%8f%af%e8%a7%86%e5%8c%96%e5%b1%95%e7%a4%ba%e7%ba%bf%e7%b4%a2" class="header-mark"></a>4 å¯è§†åŒ–å±•ç¤ºçº¿ç´¢</h2><p>æˆ‘ä»¬æŠŠæ¯ä¸€ä¸ªæ¡ä»¶çš„åŒ¹é…è·¯å¾„ä½œä¸ºè¾“å‡ºï¼Œåˆ©ç”¨ Nebula Graph çš„å¯è§†åŒ–èƒ½åŠ›ï¼Œå¯ä»¥å¾—åˆ°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GraphQL" data-lang="GraphQL"><span class="line"><span class="cl"><span class="c"># æœ‰ä¸€ä¸ªéç¬¬ä¸€ä¸ªä½ç½®çš„å­—ï¼Œæ‹¼éŸ³æ˜¯ 4 å£°ï¼ŒéŸµæ¯æ˜¯ aiï¼Œä½†ä¸æ˜¯çˆ±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="py">p0</span><span class="p">=(</span><span class="py">char0</span><span class="p">:</span><span class="nc">character</span><span class="p">)</span><span class="err">&lt;-</span><span class="p">[</span><span class="py">with_char_0</span><span class="p">:</span><span class="nc">with_character</span><span class="p">]</span><span class="err">-</span><span class="p">(</span><span class="py">x</span><span class="p">:</span><span class="nc">idiom</span><span class="p">)</span><span class="err">-</span><span class="p">[</span><span class="py">with_pinyin_0</span><span class="p">:</span><span class="nc">with_pinyin</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">pinyin_0</span><span class="p">:</span><span class="nc">character_pinyin</span><span class="p">)</span><span class="err">-</span><span class="p">[:</span><span class="nc">with_pinyin_part</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">final_part_0</span><span class="p">:</span><span class="nc">pinyin_part</span><span class="p">{</span><span class="py">part_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;final&#34;</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nc">WHERE</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">final_part_0</span><span class="p">)</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&#34;ai&#34;</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">pinyin_0</span><span class="err">.</span><span class="py">character_pinyin</span><span class="err">.</span><span class="py">tone</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="py">4</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">with_pinyin_0</span><span class="err">.</span><span class="py">position</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="py">0</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">with_char_0</span><span class="err">.</span><span class="py">position</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="py">0</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">char0</span><span class="p">)</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="sc">&#34;çˆ±&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># æœ‰ä¸€ä¸ªä¸€å£°çš„å­—ï¼Œä¸åœ¨ç¬¬äºŒä¸ªä½ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="py">p1</span><span class="p">=(</span><span class="py">x</span><span class="p">:</span><span class="nc">idiom</span><span class="p">)</span><span class="w"> </span><span class="err">-</span><span class="p">[</span><span class="py">with_pinyin_1</span><span class="p">:</span><span class="nc">with_pinyin</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">pinyin_1</span><span class="p">:</span><span class="nc">character_pinyin</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">WHERE</span><span class="w"> </span><span class="py">pinyin_1</span><span class="err">.</span><span class="py">character_pinyin</span><span class="err">.</span><span class="py">tone</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="py">1</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">with_pinyin_1</span><span class="err">.</span><span class="py">position</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="py">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># æœ‰ä¸€ä¸ªå­—éŸµæ¯æ˜¯ ingï¼Œä¸åœ¨ç¬¬å››ä¸ªä½ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="py">p2</span><span class="p">=(</span><span class="py">x</span><span class="p">:</span><span class="nc">idiom</span><span class="p">)</span><span class="w"> </span><span class="err">-</span><span class="p">[</span><span class="py">with_pinyin_2</span><span class="p">:</span><span class="nc">with_pinyin</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(:</span><span class="nc">character_pinyin</span><span class="p">)</span><span class="err">-</span><span class="p">[:</span><span class="nc">with_pinyin_part</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">final_part_2</span><span class="p">:</span><span class="nc">pinyin_part</span><span class="p">{</span><span class="py">part_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;final&#34;</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nc">WHERE</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">final_part_2</span><span class="p">)</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&#34;ing&#34;</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">with_pinyin_2</span><span class="err">.</span><span class="py">position</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="py">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ç¬¬å››ä¸ªå­—æ˜¯äºŒå£°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="py">p3</span><span class="p">=(</span><span class="py">x</span><span class="p">:</span><span class="nc">idiom</span><span class="p">)</span><span class="w"> </span><span class="err">-</span><span class="p">[</span><span class="py">with_pinyin_3</span><span class="p">:</span><span class="nc">with_pinyin</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">pinyin_3</span><span class="p">:</span><span class="nc">character_pinyin</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">WHERE</span><span class="w"> </span><span class="py">pinyin_3</span><span class="err">.</span><span class="py">character_pinyin</span><span class="err">.</span><span class="py">tone</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="py">2</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">with_pinyin_3</span><span class="err">.</span><span class="py">position</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="py">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">RETURN</span><span class="w"> </span><span class="py">p0</span><span class="p">,</span><span class="py">p1</span><span class="p">,</span><span class="py">p2</span><span class="p">,</span><span class="py">p3</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å¯è§†åŒ–å·¥å…·çš„ Console æ§åˆ¶å°é‡Œæ‰§è¡Œä¸Šè¾¹çš„è¯­å¥ä¹‹åï¼Œé€‰æ‹©å¯¼å…¥å›¾æ¢ç´¢ï¼Œå°±å¯ä»¥çœ‹åˆ°</p>
<p></p>
<h2 id="ä¸‹ä¸€æ­¥" class="headerLink">
    <a href="#%e4%b8%8b%e4%b8%80%e6%ad%a5" class="header-mark"></a>5 ä¸‹ä¸€æ­¥</h2><p>å¦‚æœå¤§å®¶æ˜¯ä»æœ¬æ–‡ç¬¬ä¸€æ¬¡äº†è§£åˆ° Nebula Graph å›¾æ•°æ®åº“ï¼Œé‚£ä¹ˆå¤§å®¶å¯ä»¥ä¸‹ä¸€æ­¥ä» <a href="https://github.com/vesoft-inc/nebula" target="_blank" rel="noopener noreffer">Nebula Graph</a> é¡¹ç›®å’Œ Nebula Graph ç¤¾åŒºçš„å®˜æ–¹ Bilibili ç«™ç‚¹ ğŸ‘‰ğŸ» <a href="https://space.bilibili.com/472621355" target="_blank" rel="noopener noreffer">https://space.bilibili.com/472621355</a> äº†è§£æ›´å¤šæœ‰æ„æ€çš„å…¥é—¨çŸ¥è¯†ã€‚</p>
<p>å¦å¤–ï¼Œ<a href="https://nebula-graph.com.cn/demo/" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a>æ˜¯ Nebula Graph çš„å®˜æ–¹çº¿ä¸Šè¯•ç©ç¯å¢ƒï¼Œå¤§å®¶å¯ä»¥ç…§ç€<a href="https://docs.nebula-graph.com.cn/" target="_blank" rel="noopener noreffer">æ–‡æ¡£</a>ï¼Œåˆ©ç”¨è¯•ç©ç¯å¢ƒå°é²œã€‚</p>
<p>åè¾¹ï¼ŒNebula Graph ä¼šå¼€å±•æ¯å¤©çš„æ±‰å…œ nGQL ä½“æ“æ´»åŠ¨ï¼Œæ•¬è¯·å…³æ³¨å“ˆï¼</p>
<p>Happy Graphing!</p>
<h2 id="é™„å½•æ­å»ºæˆè¯­çŸ¥è¯†å›¾è°±" class="headerLink">
    <a href="#%e9%99%84%e5%bd%95%e6%90%ad%e5%bb%ba%e6%88%90%e8%af%ad%e7%9f%a5%e8%af%86%e5%9b%be%e8%b0%b1" class="header-mark"></a>6 é™„å½•ï¼šæ­å»ºæˆè¯­çŸ¥è¯†å›¾è°±</h2><h3 id="æ”¶é›†ç”Ÿæˆå›¾è°±æ•°æ®" class="headerLink">
    <a href="#%e6%94%b6%e9%9b%86%e7%94%9f%e6%88%90%e5%9b%be%e8%b0%b1%e6%95%b0%e6%8d%ae" class="header-mark"></a>6.1 æ”¶é›†ã€ç”Ÿæˆå›¾è°±æ•°æ®</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python3 graph_data_generator.py
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¯¼å…¥æ•°æ®åˆ°-nebula-graph-å›¾æ•°æ®åº“" class="headerLink">
    <a href="#%e5%af%bc%e5%85%a5%e6%95%b0%e6%8d%ae%e5%88%b0-nebula-graph-%e5%9b%be%e6%95%b0%e6%8d%ae%e5%ba%93" class="header-mark"></a>6.2 å¯¼å…¥æ•°æ®åˆ° Nebula Graph å›¾æ•°æ®åº“</h3><h4 id="éƒ¨ç½²å›¾æ•°æ®åº“" class="headerLink">
    <a href="#%e9%83%a8%e7%bd%b2%e5%9b%be%e6%95%b0%e6%8d%ae%e5%ba%93" class="header-mark"></a>6.2.1 éƒ¨ç½²å›¾æ•°æ®åº“</h4><blockquote>
<p>å€ŸåŠ©äº Nebula-Up <a href="https://github.com/wey-gu/nebula-up/" target="_blank" rel="noopener noreffer">https://github.com/wey-gu/nebula-up/</a> ï¼Œä¸€è¡Œå°±å¯ä»¥äº†ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ curl -fsSL nebula-up.siwei.io/install.sh <span class="p">|</span> bash -s -- v3.0.0
</span></span></code></pre></td></tr></table>
</div>
</div><p>éƒ¨ç½²æˆåŠŸçš„è¯ï¼Œä¼šçœ‹åˆ°è¿™æ ·çš„ç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">â”‚ ğŸŒŒ Nebula-Graph Playground is Up now!  â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
</span></span><span class="line"><span class="cl">â”‚                                        â”‚
</span></span><span class="line"><span class="cl">â”‚ ğŸ‰ Congrats! Your Nebula is Up now!    â”‚
</span></span><span class="line"><span class="cl">â”‚    $ <span class="nb">cd</span> ~/.nebula-up                   â”‚
</span></span><span class="line"><span class="cl">â”‚                                        â”‚
</span></span><span class="line"><span class="cl">â”‚ ğŸŒ You can access it from browser:     â”‚
</span></span><span class="line"><span class="cl">â”‚      http://127.0.0.1:7001             â”‚
</span></span><span class="line"><span class="cl">â”‚      http://&lt;other_interface&gt;:7001     â”‚
</span></span><span class="line"><span class="cl">â”‚                                        â”‚
</span></span><span class="line"><span class="cl">â”‚ ğŸ”¥ Or access via Nebula Console:       â”‚
</span></span><span class="line"><span class="cl">â”‚    $ ~/.nebula-up/console.sh           â”‚
</span></span><span class="line"><span class="cl">â”‚                                        â”‚
</span></span><span class="line"><span class="cl">â”‚    To remove the playground:           â”‚
</span></span><span class="line"><span class="cl">â”‚    $ ~/.nebula-up/uninstall.sh         â”‚
</span></span><span class="line"><span class="cl">â”‚                                        â”‚
</span></span><span class="line"><span class="cl">â”‚ ğŸš€ Have Fun!                           â”‚
</span></span><span class="line"><span class="cl">â”‚                                        â”‚
</span></span><span class="line"><span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å›¾è°±å…¥åº“" class="headerLink">
    <a href="#%e5%9b%be%e8%b0%b1%e5%85%a5%e5%ba%93" class="header-mark"></a>6.2.2 å›¾è°±å…¥åº“</h4><blockquote>
<p>å€ŸåŠ©äº Nebula-Importer <a href="https://github.com/vesoft-inc/nebula-importer/" target="_blank" rel="noopener noreffer">https://github.com/vesoft-inc/nebula-importer/</a> ï¼Œä¸€è¡Œå°±å¯ä»¥äº†ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run --rm -ti <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --network<span class="o">=</span>nebula-docker-compose_nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/importer_conf.yaml:/root/importer_conf.yaml <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/output:/root <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    vesoft/nebula-importer:v3.0.0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --config /root/importer_conf.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¤§æ¦‚ä¸€ä¸¤åˆ†é’Ÿæ•°æ®å°±å¯¼å…¥æˆåŠŸäº†ï¼Œå‘½ä»¤ä¹Ÿä¼šæ­£å¸¸é€€å‡ºã€‚</p>
<blockquote>
<p>è¿åˆ°å›¾æ•°æ®åº“çš„ console</p>
</blockquote>
<p>è¿›å…¥ Console çš„å®¹å™¨æ‰§è¡Œä¸‹è¾¹çš„å‘½ä»¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ~/.nebula-up/console.sh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># nebula-console -addr graphd -port 9669 -user root -p nebula</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ£€æŸ¥ä¸€ä¸‹å¯¼å…¥çš„æ•°æ®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">spaces</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">--------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">Name</span><span class="w">               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">--------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;chinese_idiom&#34;</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">--------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">chinese_idiom</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Execution</span><span class="w"> </span><span class="n">succeeded</span><span class="w"> </span><span class="p">(</span><span class="n">time</span><span class="w"> </span><span class="n">spent</span><span class="w"> </span><span class="mi">1510</span><span class="o">/</span><span class="mi">2329</span><span class="w"> </span><span class="n">us</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Fri</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">2022</span><span class="w"> </span><span class="mi">08</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">11</span><span class="w"> </span><span class="n">UTC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="n">chinese_idiom</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="err">æˆè¯­</span><span class="p">:</span><span class="n">idiom</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------------------------------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">p</span><span class="w">                                                                </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------------------------------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;ä¸€ä¸ä¸è¯†&#34;</span><span class="w"> </span><span class="p">:</span><span class="n">idiom</span><span class="err">{</span><span class="n">pinyin</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;[&#39;yi1&#39;, &#39;ding1&#39;, &#39;bu4&#39;, &#39;shi2&#39;]&#34;</span><span class="err">}</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;ä¸€ä¸ä¸æŒ‚&#34;</span><span class="w"> </span><span class="p">:</span><span class="n">idiom</span><span class="err">{</span><span class="n">pinyin</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;[&#39;yi1&#39;, &#39;si1&#39;, &#39;bu4&#39;, &#39;gua4&#39;]&#34;</span><span class="err">}</span><span class="p">)</span><span class="o">&gt;</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------------------------------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="n">chinese_idiom</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">SUBMIT</span><span class="w"> </span><span class="n">JOB</span><span class="w"> </span><span class="n">STATS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="k">New</span><span class="w"> </span><span class="n">Job</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">11</span><span class="w">         </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="n">chinese_idiom</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="n">STATS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+--------------------+--------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="k">Type</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Name</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="k">Count</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+--------------------+--------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Tag&#34;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;character&#34;</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">4847</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Tag&#34;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;character_pinyin&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1336</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Tag&#34;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;idiom&#34;</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">29503</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Tag&#34;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;pinyin_part&#34;</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">57</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Edge&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;with_character&#34;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">116090</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Edge&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;with_pinyin&#34;</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">5943</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Edge&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;with_pinyin_part&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3290</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Space&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;vertices&#34;</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">35739</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Space&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;edges&#34;</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">125323</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+--------------------+--------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é™„å½•å›¾å»ºæ¨¡çš„-schema-ngql" class="headerLink">
    <a href="#%e9%99%84%e5%bd%95%e5%9b%be%e5%bb%ba%e6%a8%a1%e7%9a%84-schema-ngql" class="header-mark"></a>7 é™„å½•ï¼šå›¾å»ºæ¨¡çš„ Schema nGQL</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">SPACE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">chinese_idiom</span><span class="p">(</span><span class="n">partition_num</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">replica_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">vid_type</span><span class="o">=</span><span class="n">FIXED_STRING</span><span class="p">(</span><span class="mi">24</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">USE</span><span class="w"> </span><span class="n">chinese_idiom</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="err">åˆ›å»ºç‚¹çš„ç±»å‹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="n">idiom</span><span class="p">(</span><span class="n">pinyin</span><span class="w"> </span><span class="n">string</span><span class="p">);</span><span class="w"> </span><span class="o">#</span><span class="err">æˆè¯­</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="nb">character</span><span class="p">();</span><span class="w"> </span><span class="o">#</span><span class="err">æ±‰å­—</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="n">character_pinyin</span><span class="p">(</span><span class="n">tone</span><span class="w"> </span><span class="nb">int</span><span class="p">);</span><span class="w"> </span><span class="o">#</span><span class="err">å•å­—çš„æ‹¼éŸ³</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="n">pinyin_part</span><span class="p">(</span><span class="n">part_type</span><span class="w"> </span><span class="n">string</span><span class="p">);</span><span class="w"> </span><span class="o">#</span><span class="err">æ‹¼éŸ³çš„å£°éƒ¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="err">åˆ›å»ºè¾¹çš„ç±»å‹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">with_character</span><span class="p">(</span><span class="k">position</span><span class="w"> </span><span class="nb">int</span><span class="p">);</span><span class="w"> </span><span class="o">#</span><span class="err">åŒ…å«æ±‰å­—</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">with_pinyin</span><span class="p">(</span><span class="k">position</span><span class="w"> </span><span class="nb">int</span><span class="p">);</span><span class="w"> </span><span class="o">#</span><span class="err">è¯»ä½œ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">with_pinyin_part</span><span class="p">(</span><span class="n">part_type</span><span class="w"> </span><span class="n">string</span><span class="p">);</span><span class="w"> </span><span class="o">#</span><span class="err">åŒ…å«å£°éƒ¨</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div>]]></description>
</item><item>
    <title>Nebula Graph ç´¢å¼•è¯¦è§£</title>
    <link>https://siwei.io/nebula-index-explained/</link>
    <pubDate>Sun, 20 Feb 2022 16:35:53 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/nebula-index-explained/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p><code>index not found</code>ï¼Ÿæ‰¾ä¸åˆ°ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆæˆ‘è¦åˆ›å»º Nebula Graph ç´¢å¼•ï¼Ÿä»€ä¹ˆæ—¶å€™è¦ç”¨åˆ° Nebula Graph åŸç”Ÿç´¢å¼•ï¼Œä¸€æ–‡æŠŠè¿™äº›ææ¸…æ¥šã€‚</p>
</blockquote>
<p>Nebula Graph çš„ç´¢å¼•å…¶å®å’Œä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ä¸­çš„ç´¢å¼•å¾ˆåƒï¼Œä½†æ˜¯åˆæœ‰ä¸€äº›å®¹æ˜“è®©äººç–‘æƒ‘çš„åŒºåˆ«ã€‚åˆšå¼€å§‹äº†è§£ Nebula çš„åŒå­¦ä¼šç–‘æƒ‘äºï¼š</p>
<ul>
<li>ä¸æ¸…æ¥š Nebula Graph å›¾æ•°æ®åº“ä¸­çš„ç´¢å¼•åˆ°çš„æ˜¯ä»€ä¹ˆæ¦‚å¿µ</li>
<li>æˆ‘åº”è¯¥ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ Nebula Graph ç´¢å¼•</li>
<li>Nebula Graph ç´¢å¼•æ€ä¹ˆå½±å“åˆ°å†™å…¥æ€§èƒ½</li>
</ul>
<p>è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä»¬å°±æŠŠè¿™äº›é—®é¢˜å›ç­”å¥½ã€‚</p>
<h2 id="åˆ°åº•-nebula-graph-ç´¢å¼•æ˜¯ä»€ä¹ˆ" class="headerLink">
    <a href="#%e5%88%b0%e5%ba%95-nebula-graph-%e7%b4%a2%e5%bc%95%e6%98%af%e4%bb%80%e4%b9%88" class="header-mark"></a>1 åˆ°åº• Nebula Graph ç´¢å¼•æ˜¯ä»€ä¹ˆ</h2><p>ç®€è€Œè¨€ä¹‹ï¼ŒNebula Graph ç´¢å¼•æ˜¯ç”¨æ¥ï¼Œä¸”åªç”¨æ¥é’ˆå¯¹çº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢åœºæ™¯çš„</p>
<ul>
<li>å›¾æ¸¸èµ°ï¼ˆwalkï¼‰æŸ¥è¯¢ä¸­çš„å±æ€§æ¡ä»¶è¿‡æ»¤ä¸éœ€è¦å®ƒ</li>
<li>çº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢ï¼ˆæ³¨ï¼šéé‡‡æ ·æƒ…å†µï¼‰å¿…é¡»åˆ›å»ºç´¢å¼•</li>
</ul>
<h3 id="çº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢" class="headerLink">
    <a href="#%e7%ba%af%e5%b1%9e%e6%80%a7%e6%9d%a1%e4%bb%b6%e5%87%ba%e5%8f%91%e6%9f%a5%e8%af%a2" class="header-mark"></a>1.1 çº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢</h3><p>æˆ‘ä»¬çŸ¥é“åœ¨ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œç´¢å¼•æ˜¯å¯¹è¡¨æ•°æ®çš„ä¸€ä¸ªæˆ–å¤šä¸ªé’ˆå¯¹ç‰¹å®š<strong>åˆ—</strong>é‡æ’åºçš„å‰¯æœ¬ï¼Œå®ƒç”¨æ¥<strong>åŠ é€Ÿç‰¹å®šåˆ—è¿‡æ»¤æ¡ä»¶çš„è¯»æŸ¥è¯¢</strong>å¹¶å¸¦æ¥äº†é¢å¤–çš„æ•°æ®å†™å…¥ï¼ˆåŠ é€Ÿè€Œéè¿™æ ·æŸ¥è¯¢çš„å¿…é¡»å‰æï¼‰ã€‚</p>
<p>åœ¨ Nebula Graph å›¾æ•°æ®åº“é‡Œï¼Œç´¢å¼•åˆ™æ˜¯å¯¹<strong>ç‚¹ã€è¾¹ç‰¹å®šå±æ€§æ•°æ®</strong>é‡æ’åºçš„å‰¯æœ¬ï¼Œç”¨æ¥æä¾›<strong>çº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢</strong>ï¼ˆå¦‚ä¸‹è¾¹çš„æŸ¥è¯¢ï¼šä»åªç»™å®šäº†ç‚¹è¾¹å±æ€§æ¡ä»¶ï¼Œè€Œéç‚¹çš„ ID å‡ºå‘å»è·å–å›¾æ•°æ®ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">####</span><span class="w"> </span><span class="err">å¿…é¡»</span><span class="w"> </span><span class="n">Nebula</span><span class="w"> </span><span class="n">Graph</span><span class="w"> </span><span class="err">ç´¢å¼•å­˜åœ¨çš„æŸ¥è¯¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">çº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">LOOKUP</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">tag1</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">col1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">col2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;foo&#34;</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">YIELD</span><span class="w"> </span><span class="n">tag1</span><span class="p">.</span><span class="n">col1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">col1</span><span class="p">,</span><span class="w"> </span><span class="n">tag1</span><span class="p">.</span><span class="n">col3</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">col3</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">çº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">:</span><span class="n">player</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Tim Duncan&#39;</span><span class="w"> </span><span class="err">}</span><span class="p">)</span><span class="c1">--&gt;(v2:player) \
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="k">RETURN</span><span class="w"> </span><span class="n">v2</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¾¹è¿™ä¸¤ä¸ªçº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢å°±æ˜¯å­—é¢æ„æ€çš„â€æ ¹æ®ç»™å®šçš„å±æ€§æ¡ä»¶è·å–ç‚¹æˆ–è€…è¾¹æœ¬èº«â€œ ï¼Œåé¢çš„ä¾‹å­åˆ™æ˜¯ç»™å®šäº†ç‚¹çš„ IDï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">####</span><span class="w"> </span><span class="err">ä¸åŸºäºç´¢å¼•çš„æŸ¥è¯¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">ä»ç»™å®šçš„ç‚¹åšçš„æ¸¸èµ°æŸ¥è¯¢</span><span class="w"> </span><span class="n">vertex</span><span class="w"> </span><span class="n">VID</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;player100&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s2">&#34;player100&#34;</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="n">follow</span><span class="w"> </span><span class="n">REVERSELY</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">YIELD</span><span class="w"> </span><span class="n">src</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GO</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="err">$</span><span class="o">-</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">properties</span><span class="p">(</span><span class="err">$</span><span class="o">^</span><span class="p">).</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">YIELD</span><span class="w"> </span><span class="n">properties</span><span class="p">(</span><span class="err">$</span><span class="o">^</span><span class="p">).</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FriendOf</span><span class="p">,</span><span class="w"> </span><span class="n">properties</span><span class="p">(</span><span class="err">$$</span><span class="p">).</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Team</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="err">ä»ç»™å®šçš„ç‚¹åšçš„æ¸¸èµ°æŸ¥è¯¢</span><span class="w"> </span><span class="n">vertex</span><span class="w"> </span><span class="n">VID</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;player101&#34;</span><span class="w"> </span><span class="err">æˆ–è€…</span><span class="w"> </span><span class="s2">&#34;player102&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">:</span><span class="n">player</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Tim Duncan&#39;</span><span class="w"> </span><span class="err">}</span><span class="p">)</span><span class="c1">--(v2) \
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;player101&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;player102&#34;</span><span class="p">]</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">RETURN</span><span class="w"> </span><span class="n">v2</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ä»”ç»†çœ‹å‰è¾¹çš„ <code>query 1</code> å’Œ <code>query 3</code>ï¼Œå°½ç®¡è¯­å¥ä¸­æ¡ä»¶éƒ½æœ‰é’ˆå¯¹ tag ä¸º player çš„è¿‡æ»¤ï¼š <code>{ name: 'Tim Duncan' }</code> ï¼š</p>
<ul>
<li>
<p><code>query 3</code>ä¹‹ä¸­ä¸éœ€è¦ç´¢å¼•ï¼Œå› ä¸ºå®ƒå¯ä»¥ï¼š</p>
<ul>
<li>æ›´ç›´æ¥çš„ä»å·²çŸ¥çš„ <code>v2</code> é¡¶ç‚¹ï¼š <code>[&quot;player101&quot;, &quot;player102&quot;]</code></li>
<li>å‘å¤–æ‰©å±•ã€æ¸¸èµ°ï¼ˆGetNeighbors() è·å¾—è¾¹çš„å¦ä¸€ç«¯çš„ç‚¹ï¼Œç„¶åGetVertices() å¾—åˆ°ä¸‹ä¸€è·³çš„ <code>v</code>ï¼‰ï¼Œæ ¹æ® v.player.name è¿‡æ»¤æ‰ä¸è¦çš„æ•°æ®</li>
</ul>
</li>
<li>
<p><code>query 1</code> åˆ™ä¸åŒï¼Œå®ƒå› ä¸ºæ²¡æœ‰ä»»ä½•ç»™å®šçš„é¡¶ç‚¹ IDï¼š</p>
<ul>
<li>åªèƒ½ä»å±æ€§æ¡ä»¶å…¥æ‰‹ï¼Œ<code>{ name: 'Tim Duncan' }</code>ï¼Œåœ¨æŒ‰ç…§ name æ’åºäº†çš„ç´¢å¼•æ•°æ®ä¸­å…ˆæ‰¾åˆ°ç¬¦åˆçš„ç‚¹ï¼šIndexScan() å¾—åˆ° <code>v</code></li>
<li>ç„¶åå†ä» <code>v</code> åš GetNeighbors() è·å¾—è¾¹çš„å¦ä¸€ç«¯ çš„ <code>v2</code> ï¼Œåœ¨é€šè¿‡ GetVertices() å»è·å¾—ä¸‹ä¸€è·³ <code>v2</code> ä¸­çš„æ•°æ®</li>
</ul>
</li>
</ul>
<p>å…¶å®ï¼Œè¿™é‡Œçš„å…³é”®å°±æ˜¯åœ¨äºæ˜¯æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ç»™å®šçš„é¡¶ç‚¹ IDï¼ˆVertex IDï¼‰ï¼Œä¸‹è¾¹ä¸¤ä¸ªæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’é‡Œæ›´æ¸…æ™°åœ°æ¯”è¾ƒäº†ä»–ä»¬çš„åŒºåˆ«ï¼š</p>
<table>
<thead>
<tr>
<th><code>query 1</code>, éœ€è¦åŸºäºç´¢å¼•ï¼Œçº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢</th>
<th><code>query 3</code>, ä»å·²çŸ¥ VIDï¼Œä¸éœ€è¦ç´¢å¼•</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="ä¸ºä»€ä¹ˆçº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢é‡Œå¿…é¡»è¦ç´¢å¼•å‘¢" class="headerLink">
    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e7%ba%af%e5%b1%9e%e6%80%a7%e6%9d%a1%e4%bb%b6%e5%87%ba%e5%8f%91%e6%9f%a5%e8%af%a2%e9%87%8c%e5%bf%85%e9%a1%bb%e8%a6%81%e7%b4%a2%e5%bc%95%e5%91%a2" class="header-mark"></a>1.2 ä¸ºä»€ä¹ˆçº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢é‡Œå¿…é¡»è¦ç´¢å¼•å‘¢ï¼Ÿ</h3><p>å› ä¸º Nebula Graph åœ¨å­˜å‚¨æ•°æ®çš„æ—¶å€™ï¼Œå®ƒçš„ç»“æ„æ˜¯é¢å‘åˆ†å¸ƒå¼ä¸å…³è”å…³ç³»è®¾è®¡çš„ï¼Œç±»ä¼¼è¡¨ç»“æ„æ•°æ®åº“ä¸­æ— ç´¢å¼•çš„å…¨æ‰«ææ¡ä»¶æœç´¢å®é™…ä¸Šæ›´åŠ æ˜‚è´µï¼Œæ‰€ä»¥è®¾è®¡ä¸Šè¢«æœ‰æ„ç¦æ­¢äº†ã€‚</p>
<blockquote>
<p>æ³¨: å¦‚æœä¸è¿½æ±‚å…¨éƒ¨æ•°æ®ï¼Œåªè¦é‡‡æ ·ä¸€éƒ¨åˆ†ï¼Œ3.0 é‡Œä¹‹åæ˜¯æ”¯æŒä¸å¼ºåˆ¶ç´¢å¼• LIMIT <n> çš„æƒ…å†µçš„ï¼Œå¦‚ä¸‹æŸ¥è¯¢ï¼ˆæœ‰ LIMITï¼‰ä¸éœ€è¦ç´¢å¼•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># sample vertex
</span></span><span class="line"><span class="cl">MATCH (v:team) RETURN v LIMIT 3
</span></span><span class="line"><span class="cl"># or sample edge
</span></span><span class="line"><span class="cl">MATCH ()-[e:follow]-&gt;() RETURN e LIMIT 3
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<h3 id="ä¸ºä»€ä¹ˆåªæœ‰çº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢" class="headerLink">
    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e5%8f%aa%e6%9c%89%e7%ba%af%e5%b1%9e%e6%80%a7%e6%9d%a1%e4%bb%b6%e5%87%ba%e5%8f%91%e6%9f%a5%e8%af%a2" class="header-mark"></a>1.3 ä¸ºä»€ä¹ˆåªæœ‰çº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢</h3><p>æˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹æ­£å¸¸çš„å›¾æŸ¥è¯¢ <strong>graph-queries</strong> å’Œçº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢ <strong>pure-prop-condition queries</strong>ï¼š</p>
<ul>
<li>graph-queriesï¼š å¦‚ <code>query 2</code> ã€ <code>query 3</code>æ˜¯æ²¿ç€è¾¹ä¸€è·¯æ‰¾åˆ°ç‰¹å®šè·¯å¾„æ¡ä»¶çš„æ‰©å±•æ¸¸èµ°</li>
<li>pure-prop-condition queriesï¼šå¦‚ <code>query 0</code> and <code>query 1</code>  æ˜¯åªé€šè¿‡ä¸€å®šå±æ€§æ¡ä»¶ï¼ˆæˆ–è€…æ˜¯æ— é™åˆ¶æ¡ä»¶ï¼‰æ‰¾åˆ°æ»¡è¶³çš„ç‚¹ã€è¾¹</li>
</ul>
<p>è€Œåœ¨ Nebula Graph é‡Œï¼Œgraph-queries åœ¨æ‰©å±•çš„æ—¶å€™ï¼Œå›¾çš„åŸå§‹æ•°æ®å·²ç»æŒ‰ç…§ VIDï¼ˆç‚¹å’Œè¾¹éƒ½æ˜¯ï¼‰æ’åºè¿‡äº†ï¼ˆæˆ–è€…è¯´åœ¨æ•°æ®é‡Œå·²ç»ç´¢å¼•è¿‡äº†ï¼‰ï¼Œè¿™ä¸ªæ’åºå¸¦æ¥è¿ç»­å­˜å‚¨ï¼ˆç‰©ç†ä¸Šä¸´æ¥ï¼‰ä½¿å¾—æ‰©å±•æ¸¸èµ°æœ¬èº«å°±æ˜¯ä¼˜åŒ–ã€å¾ˆå¿«çš„ã€‚</p>
<h3 id="æ€»ç»“ç´¢å¼•æ˜¯ä»€ä¹ˆç´¢å¼•ä¸æ˜¯ä»€ä¹ˆ" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93%e7%b4%a2%e5%bc%95%e6%98%af%e4%bb%80%e4%b9%88%e7%b4%a2%e5%bc%95%e4%b8%8d%e6%98%af%e4%bb%80%e4%b9%88" class="header-mark"></a>1.4 æ€»ç»“ï¼šç´¢å¼•æ˜¯ä»€ä¹ˆï¼Œç´¢å¼•ä¸æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>Nebula Graph ç´¢å¼•æ˜¯ä¸ºäº†ä»ç»™å®šå±æ€§æ¡ä»¶æŸ¥ç‚¹ã€è¾¹çš„ä¸€ä»½å±æ€§æ•°æ®çš„æ’åºï¼Œå®ƒç”¨å†™å…¥çš„ä»£ä»·æ˜¯çš„è¿™ç§è¯»æŸ¥è¯¢æ¨¡å¼æˆä¸ºå¯èƒ½ã€‚</li>
</ul>
<p>ç´¢å¼•ä¸æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>Nebula Graph ç´¢å¼•ä¸æ˜¯ç”¨æ¥åŠ é€Ÿä¸€èˆ¬å›¾æŸ¥è¯¢çš„ï¼šä»ä¸€ä¸ªç‚¹å¼€å§‹å‘å¤–æ‹“å±•çš„æŸ¥è¯¢ï¼ˆå³ä½¿æ˜¯è¿‡æ»¤å±æ€§æ¡ä»¶çš„ï¼‰ä¸ä¼šä¾èµ–åŸç”Ÿç´¢å¼•ï¼Œå› ä¸º Nebula æ•°æ®è‡ªèº«çš„å­˜å‚¨å°±æ˜¯é¢å‘è¿™ç§æŸ¥è¯¢ä¼˜åŒ–ã€æ’åºçš„ã€‚</li>
</ul>
<h2 id="ä¸€äº›-nebula-graph-ç´¢å¼•çš„è®¾è®¡ç»†èŠ‚" class="headerLink">
    <a href="#%e4%b8%80%e4%ba%9b-nebula-graph-%e7%b4%a2%e5%bc%95%e7%9a%84%e8%ae%be%e8%ae%a1%e7%bb%86%e8%8a%82" class="header-mark"></a>2 ä¸€äº› Nebula Graph ç´¢å¼•çš„è®¾è®¡ç»†èŠ‚</h2><p>ä¸ºäº†æ›´å¥½ç†è§£ç´¢å¼•çš„é™åˆ¶ã€ä»£ä»·ã€èƒ½åŠ›ï¼Œå’±ä»¬æ¥è§£é‡Šæ›´å¤šä»–çš„ç»†èŠ‚</p>
<ul>
<li>
<p>Nebula Graph ç´¢å¼•æ˜¯åœ¨æœ¬åœ°ï¼ˆä¸æ˜¯åˆ†å¼€ã€ä¸­å¿ƒåŒ–ï¼‰å’Œç‚¹æ•°æ®è¢«ä¸€èµ·å­˜å‚¨ã€åˆ†ç‰‡çš„ã€‚</p>
</li>
<li>
<p>å®ƒåªæ”¯æŒå·¦åŒ¹é…</p>
<ul>
<li>å› ä¸ºåº•å±‚æ˜¯ RocksDB Prefix Scan</li>
</ul>
</li>
<li>
<p>æ€§èƒ½ä»£ä»·:</p>
<ul>
<li>å†™å…¥æ—¶å€™çš„è·¯å¾„ï¼šä¸åªæ˜¯å¤šä¸€åˆ†æ•°æ®ï¼Œä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œè¿˜æœ‰æ˜‚è´µçš„è¯»æ“ä½œ</li>
<li>è¯»è·¯å¾„ï¼šåŸºäºè§„åˆ™çš„ä¼˜åŒ–é€‰æ‹©ç´¢å¼•ï¼ŒFan Out åˆ°æ‰€æœ‰ StorageD</li>
</ul>
</li>
</ul>
<p>è¿™äº›ä¿¡æ¯ä¹Ÿåœ¨æˆ‘çš„<a href="https://www.siwei.io/sketch-notes/" target="_blank" rel="noopener noreffer">æ‰‹ç»˜å›¾å’Œè§†é¢‘</a>é‡Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<p></p>
<blockquote>
<p>å› ä¸ºå·¦åŒ¹é…çš„è®¾è®¡ï¼Œåœ¨æœ‰æ›´å¤æ‚çš„é’ˆå¯¹çº¯å±æ€§æ¡ä»¶å‡ºå‘æŸ¥è¯¢é‡Œæ¶‰åŠåˆ°é€šé…ã€REGEXPè¿™æ ·çš„å…¨æ–‡æœç´¢æƒ…å†µï¼ŒNebula Graph æä¾›äº†å…¨æ–‡ç´¢å¼•çš„åŠŸèƒ½ï¼Œå®ƒæ˜¯åˆ©ç”¨ Raft Listener å»å¼‚æ­¥å°†æ•°æ®å†™åˆ°å¤–éƒ¨ Elasticsearch é›†ç¾¤ä¹‹ä¸­ï¼Œå¹¶åœ¨æŸ¥è¯¢çš„æ—¶å€™å»æŸ¥ ES å»åšåˆ°çš„ï¼Œè§<a href="https://docs.nebula-graph.com.cn/3.0.0/4.deployment-and-installation/6.deploy-text-based-index/2.deploy-es/" target="_blank" rel="noopener noreffer">æ–‡æ¡£</a>ã€‚</p>
</blockquote>
<p>åœ¨è¿™ä¸ªæ‰‹ç»˜å›¾ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹å‡º</p>
<ul>
<li>Write path
<ul>
<li>å†™å…¥ç´¢å¼•æ•°æ®æ˜¯åŒæ­¥æ“ä½œçš„</li>
</ul>
</li>
<li>Read path
<ul>
<li>è¿™éƒ¨åˆ†ç”»äº†ä¸€ä¸ª RBO çš„ä¾‹å­ï¼ŒæŸ¥è¯¢é‡Œçš„è§„åˆ™å‡è®¾ col2 ç›¸ç­‰åŒ¹é…æ’åœ¨å·¦è¾¹çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½ä¼˜äº col1 çš„å¤§å°æ¯”è¾ƒåŒ¹é…ï¼Œæ‰€ä»¥é€‰æ‹©äº†ç¬¬äºŒä¸ªç´¢å¼•</li>
<li>é€‰å¥½äº†ç´¢å¼•ä¹‹åï¼Œæ‰«æç´¢å¼•çš„è¯·æ±‚è¢« fan out åˆ°å­˜å‚¨èŠ‚ç‚¹ä¸Šï¼Œè¿™å…¶ä¸­æœ‰äº›è¿‡æ»¤æ¡ä»¶æ¯”å¦‚ top n æ˜¯å¯ä»¥ä¸‹æ¨çš„</li>
</ul>
</li>
</ul>
<p>ç»“è®ºï¼š</p>
<ul>
<li>å› ä¸ºå†™å…¥çš„ä»£ä»·ï¼Œåªæœ‰å¿…é¡»ç”¨ç´¢å¼•çš„æ—¶å€™é‡‡ç”¨ï¼Œå¦‚æœé‡‡æ ·æŸ¥è¯¢èƒ½æ»¡è¶³è¯»çš„è¦æ±‚ï¼Œå¯ä»¥ä¸åˆ›å»ºç´¢å¼•è€Œç”¨ LIMIT <n>ã€‚</li>
<li>ç´¢å¼•æœ‰å·¦åŒ¹é…çš„é™åˆ¶
<ul>
<li>ç¬¦åˆæŸ¥è¯¢çš„é¡ºåºè¦ä»”ç»†è®¾è®¡</li>
<li>æœ‰æ—¶å€™éœ€è¦ä½¿ç”¨å…¨æ–‡ç´¢å¼• <a href="https://docs.nebula-graph.com.cn/3.0.0/4.deployment-and-installation/6.deploy-text-based-index/2.deploy-es/" target="_blank" rel="noopener noreffer">full-text index</a>ã€‚</li>
</ul>
</li>
</ul>
<h2 id="ç´¢å¼•çš„ä½¿ç”¨" class="headerLink">
    <a href="#%e7%b4%a2%e5%bc%95%e7%9a%84%e4%bd%bf%e7%94%a8" class="header-mark"></a>3 ç´¢å¼•çš„ä½¿ç”¨</h2><p>å…·ä½“è¦å‚è€ƒ<a href="https://docs.nebula-graph.io/3.0.0/3.ngql-guide/14.native-index-statements/" target="_blank" rel="noopener noreffer">ç´¢å¼•æ–‡æ¡£</a>ä¸€äº›è¦ç‚¹æ˜¯ï¼š</p>
<ul>
<li>
<p>åœ¨ tag æˆ–è€… edge type ä¸Šé’ˆå¯¹æƒ³è¦è¢«æ¡ä»¶åæŸ¥ç‚¹è¾¹çš„å±æ€§åˆ›å»ºç´¢å¼•</p>
<ul>
<li><code>CREATE INDEX</code></li>
</ul>
</li>
<li>
<p>åˆ›å»ºç´¢å¼•ä¹‹åçš„ç´¢å¼•éƒ¨åˆ†æ•°æ®ä¼šåŒæ­¥å†™å…¥ï¼Œä½†æ˜¯å¦‚æœåˆ›å»ºç´¢å¼•ä¹‹å‰å·²ç»æœ‰çš„ç‚¹è¾¹æ•°æ®å¯¹åº”çš„ç´¢å¼•æ˜¯éœ€è¦æ˜ç¡®æŒ‡å®šå»åˆ›å»ºçš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ jobï¼š</p>
<ul>
<li><code>REBUILD INDEX</code></li>
</ul>
</li>
<li>
<p>è§¦å‘äº†å¼‚æ­¥çš„ <code>REBUILD INDEX</code> ä¹‹åï¼Œå¯ä»¥æŸ¥è¯¢çŠ¶æ€ï¼š</p>
<ul>
<li><code>SHOW INDEX STATUS</code></li>
</ul>
</li>
<li>
<p>åˆ©ç”¨åˆ°ç´¢å¼•çš„æŸ¥è¯¢å¯ä»¥æ˜¯ LOOKUPï¼Œå¹¶ä¸”å¸¸å¸¸å¯ä»¥å€ŸåŠ©ç®¡é“ç¬¦åœ¨æ­¤ä¹‹ä¸Šåšæ‹“å±•æŸ¥è¯¢ï¼ˆGraph Queryï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">LOOKUP</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">player</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;Kobe Bryant&#34;</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">YIELD</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">VertexID</span><span class="p">,</span><span class="w"> </span><span class="n">properties</span><span class="p">(</span><span class="n">vertex</span><span class="p">).</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">|</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">GO</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="err">$</span><span class="o">-</span><span class="p">.</span><span class="n">VertexID</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">YIELD</span><span class="w"> </span><span class="err">$</span><span class="o">-</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">properties</span><span class="p">(</span><span class="n">edge</span><span class="p">).</span><span class="n">start_year</span><span class="p">,</span><span class="w"> </span><span class="n">properties</span><span class="p">(</span><span class="n">edge</span><span class="p">).</span><span class="n">end_year</span><span class="p">,</span><span class="w"> </span><span class="n">properties</span><span class="p">(</span><span class="err">$$</span><span class="p">).</span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ä¹Ÿå¯ä»¥æ˜¯ MATCH ï¼Œè¿™é‡Œè¾¹ <code>v</code> æ˜¯é€šè¿‡ç´¢å¼•å¾—åˆ°çš„ï¼Œè€Œ <code>v2</code> åˆ™æ˜¯åœ¨æ•°æ®ï¼ˆéç´¢å¼•ï¼‰éƒ¨åˆ†æ‹“å±•æŸ¥è¯¢è·å¾—çš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MATCH (v:player{name:&#34;Tim Duncan&#34;})--(v2:player) \
</span></span><span class="line"><span class="cl">  RETURN v2.player.name AS Name;
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å¤åˆç´¢å¼•çš„èƒ½åŠ›ä¸é™åˆ¶</p>
<p>ç†è§£åŸç”Ÿç´¢å¼•çš„åŒ¹é…æ˜¯å·¦åŒ¹é…èƒ½è®©æˆ‘ä»¬çŸ¥é“å¯¹äºè¶…è¿‡ä¸€ä¸ªå±æ€§çš„ç´¢å¼•ï¼šå¤åˆç´¢å¼•ï¼Œå¹¶ä¸”èƒ½å¸®åŠ©æˆ‘ä»¬ç†è§£å®ƒçš„èƒ½åŠ›æœ‰é™åˆ¶ï¼Œè¿™é‡Œè¯´å‡ ä¸ªç»“è®ºï¼š</p>
<ul>
<li>æˆ‘ä»¬åˆ›å»ºé’ˆå¯¹å¤šä¸ªå±æ€§çš„å¤åˆç´¢å¼•æ˜¯é¡ºåºæœ‰å…³çš„
<ul>
<li>æ¯”å¦‚ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒå±æ€§å¤åˆç´¢å¼• index_a: <code>(isRisky: bool, age: int)</code>ï¼Œå’Œ index_b: <code>(age: int, isRisky: bool)</code> åœ¨æ ¹æ® <code>WHERE n.user.isRisky == true AND n.user.age &gt; 18</code> è¿™ä¸ªæ¡ä»¶æŸ¥è¯¢æ—¶å€™ï¼Œindex_a å› ä¸ºå·¦åŒ¹é…ä¸€ä¸ªç›¸ç­‰çš„çŸ­å­—æ®µï¼Œæ˜¾ç„¶æ•ˆç‡æ›´é«˜ã€‚</li>
</ul>
</li>
<li>åªæœ‰å¤åˆå·¦åŒ¹é…çš„è¢«å¤åˆç´¢å¼•çš„å±æ€§çœŸå­é›†çš„è¿‡æ»¤æ¡ä»¶æ‰èƒ½è¢«åªæ”¯æŒ
<ul>
<li>æ¯”å¦‚ï¼Œindex_a: <code>(isRisky: bool, age: int)</code>ï¼Œå’Œ index_b: <code>(age: int, isRisky: bool)</code> åœ¨æŸ¥è¯¢ <code>WHERE n.user.age &gt; 18</code> è¿™ä¸ªè¯­å¥çš„æ—¶å€™, åªæœ‰ index_b å¤åˆæœ€å·¦åŒ¹é…ï¼Œèƒ½æ»¡è¶³è¿™ä¸ªæŸ¥è¯¢ã€‚</li>
</ul>
</li>
<li>é’ˆå¯¹ä¸€äº›ä»å±æ€§ä½œä¸ºæŸ¥è¯¢çš„èµ·ç‚¹ï¼Œæ‰¾ç‚¹ã€è¾¹çš„æƒ…å†µï¼ŒåŸç”Ÿç´¢å¼•æ˜¯ä¸èƒ½æ»¡è¶³å…¨æ–‡æœç´¢çš„åŒ¹é…åœºæ™¯çš„ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘ä½¿ç”¨ Nebula å…¨æ–‡ç´¢å¼•ï¼Œå®ƒæ˜¯ Nebula ç¤¾åŒºæ”¯æŒçš„å¼€ç®±å³ç”¨çš„å¤–ç½® Elastic Searchï¼Œé€šè¿‡é…ç½®ï¼Œåˆ›å»ºäº†å…¨æ–‡ç´¢å¼•çš„æ•°æ®ä¼šé€šè¿‡ Raft listener å¼‚æ­¥æ›´æ–°åˆ° Elastic é›†ç¾¤ä¸­ï¼Œä»–çš„æŸ¥è¯¢å…¥å£ä¹Ÿæ˜¯ <code>LOOKUP</code>ï¼Œè¯¦ç»†çš„ä¿¡æ¯è¯·<a href="https://docs.nebula-graph.com.cn/3.0.1/4.deployment-and-installation/6.deploy-text-based-index/2.deploy-es/" target="_blank" rel="noopener noreffer">å‚è€ƒæ–‡æ¡£</a>ã€‚</li>
</ul>
</li>
</ul>
<h2 id="å›é¡¾" class="headerLink">
    <a href="#%e5%9b%9e%e9%a1%be" class="header-mark"></a>4 å›é¡¾</h2><ul>
<li>Nebula Graph ç´¢å¼•åœ¨åªæä¾›å±æ€§æ¡ä»¶æƒ…å†µä¸‹é€šè¿‡å¯¹å±æ€§çš„æ’åºå‰¯æœ¬æ‰«ææŸ¥ç‚¹ã€è¾¹</li>
<li>Nebula Graph ç´¢å¼•<strong>ä¸æ˜¯</strong>ç”¨æ¥å›¾æ‹“å±•æŸ¥è¯¢çš„</li>
<li>Nebula Graph ç´¢å¼•æ˜¯å·¦åŒ¹é…ï¼Œä¸æ˜¯ç”¨æ¥åšæ¨¡ç³Šå…¨æ–‡æœç´¢çš„</li>
<li>Nebula Graph ç´¢å¼•åœ¨å†™å…¥æ—¶å€™æœ‰æ€§èƒ½ä»£ä»·</li>
<li>è®°å¾—å¦‚æœåˆ›å»º Nebula Graph ç´¢å¼•ä¹‹å‰å·²ç»æœ‰ç›¸åº”ç‚¹è¾¹ä¸Šçš„æ•°æ®ï¼Œè¦é‡å»ºç´¢å¼•</li>
</ul>
<p>Happy Graphing!</p>
<p>Feture image credit to <a href="https://unsplash.com/photos/ZiQkhI7417A" target="_blank" rel="noopener noreffer">Alina</a></p>
]]></description>
</item><item>
    <title>ä¸ºä»€ä¹ˆæˆ‘çš„ Nebula-Spark-Connectorã€Nebula-Algorithm è¿ä¸ä¸Š K8s éƒ¨ç½²çš„ Nebula Graph é›†ç¾¤ï¼Ÿ</title>
    <link>https://siwei.io/nebula-algo-spark-k8s/</link>
    <pubDate>Mon, 14 Feb 2022 18:47:53 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/nebula-algo-spark-k8s/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>ä¸€æ–‡äº†è§£ K8s éƒ¨ç½²çš„ Nebula Graph é›†ç¾¤çš„ Nebula-Algorithm ä½¿ç”¨æ–¹æ³•ã€‚</p>
</blockquote>
<h2 id="æ­¥éª¤" class="headerLink">
    <a href="#%e6%ad%a5%e9%aa%a4" class="header-mark"></a>1 æ­¥éª¤</h2><p>æœ€æ–¹ä¾¿çš„æ–¹æ³•æ˜¯å°† Nebula Algorithm/ Spark è¿è¡Œåœ¨ä¸ Nebula-Operator ç›¸åŒçš„ç½‘ç»œå‘½åç©ºé—´é‡Œï¼Œå°† <code>show hosts meta</code> çš„ MetaD <code>åŸŸå:ç«¯å£</code> æ ¼å¼çš„åœ°å€å¡«è¿›é…ç½®é‡Œå°±å¯ä»¥äº†ã€‚</p>
<blockquote>
<p>æ³¨ï¼šéœ€è¦ 2.6.2 æˆ–è€…æ›´æ–°çš„ç‰ˆæœ¬ï¼ŒSpark-Connector/Algorithm æ‰æ”¯æŒåŸŸåå½¢å¼çš„ MetaD åœ°å€ã€‚</p>
</blockquote>
<ul>
<li>è·å– MetaD åœ°å€</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>root@nebula<span class="o">)</span> <span class="o">[(</span>none<span class="o">)]</span>&gt; show hosts meta
</span></span><span class="line"><span class="cl">+------------------------------------------------------------------+------+----------+--------+--------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Host                                                             <span class="p">|</span> Port <span class="p">|</span> Status   <span class="p">|</span> Role   <span class="p">|</span> Git Info Sha <span class="p">|</span> Version <span class="p">|</span>
</span></span><span class="line"><span class="cl">+------------------------------------------------------------------+------+----------+--------+--------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;nebula-metad-0.nebula-metad-headless.default.svc.cluster.local&#34;</span> <span class="p">|</span> <span class="m">9559</span> <span class="p">|</span> <span class="s2">&#34;ONLINE&#34;</span> <span class="p">|</span> <span class="s2">&#34;META&#34;</span> <span class="p">|</span> <span class="s2">&#34;d113f4a&#34;</span>    <span class="p">|</span> <span class="s2">&#34;2.6.2&#34;</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+------------------------------------------------------------------+------+----------+--------+--------------+---------+
</span></span><span class="line"><span class="cl">Got <span class="m">1</span> rows <span class="o">(</span><span class="nb">time</span> spent 1378/2598 us<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Mon, <span class="m">14</span> Feb <span class="m">2022</span> 08:22:33 UTC
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¡«å†™ Algorithm çš„é…ç½®æ–‡ä»¶</li>
</ul>
<blockquote>
<p>Ref: <a href="https://github.com/vesoft-inc/nebula-algorithm/blob/master/nebula-algorithm/src/main/resources/application.conf" target="_blank" rel="noopener noreffer">https://github.com/vesoft-inc/nebula-algorithm/blob/master/nebula-algorithm/src/main/resources/application.conf</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="c"># ...</span>
</span></span><span class="line"><span class="cl">  <span class="nx">nebula</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c"># algo&#39;s data source from Nebula. If data.source is nebula, then this nebula.read config can be valid.</span>
</span></span><span class="line"><span class="cl">    <span class="nx">read</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c"># Nebula metad server address, multiple addresses are split by English comma</span>
</span></span><span class="line"><span class="cl">        <span class="nx">metaAddress</span><span class="err">:</span> <span class="s2">&#34;nebula-metad-0.nebula-metad-headless.default.svc.cluster.local:9559&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c">#...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æˆ–è€…æ˜¯è°ƒç”¨ spark-connector çš„ä»£ç </li>
</ul>
<blockquote>
<p>Ref: <a href="https://github.com/vesoft-inc/nebula-spark-connector" target="_blank" rel="noopener noreffer">https://github.com/vesoft-inc/nebula-spark-connector</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">config</span> <span class="k">=</span> <span class="nc">NebulaConnectionConfig</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">withMetaAddress</span><span class="o">(</span><span class="s">&#34;nebula-metad-0.nebula-metad-headless.default.svc.cluster.local:9559&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">withConenctionRetry</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">build</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">nebulaReadVertexConfig</span><span class="k">:</span> <span class="kt">ReadNebulaConfig</span> <span class="o">=</span> <span class="nc">ReadNebulaConfig</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">withSpace</span><span class="o">(</span><span class="s">&#34;foo_bar_space&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">withLabel</span><span class="o">(</span><span class="s">&#34;person&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">withNoColumn</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">withReturnCols</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">&#34;birthday&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">withLimit</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">withPartitionNum</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">build</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">vertex</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">nebula</span><span class="o">(</span><span class="n">config</span><span class="o">,</span> <span class="n">nebulaReadVertexConfig</span><span class="o">).</span><span class="n">loadVerticesToDF</span><span class="o">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>çœ‹èµ·æ¥éå¸¸ç®€å•ï¼Œé‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆç®€å•çš„è¿‡ç¨‹å´å€¼å¾—ä¸€ç¯‡æ–‡ç« å‘¢ï¼Ÿ</p>
<h3 id="å®¹æ˜“å¿½ç•¥çš„é—®é¢˜" class="headerLink">
    <a href="#%e5%ae%b9%e6%98%93%e5%bf%bd%e7%95%a5%e7%9a%84%e9%97%ae%e9%a2%98" class="header-mark"></a>1.1 å®¹æ˜“å¿½ç•¥çš„é—®é¢˜</h3><p>è¿™é‡Œçš„é—®é¢˜åœ¨äºï¼š</p>
<p>a. å®ƒéšå«åœ°éœ€è¦ä¿è¯ StorageD çš„åœ°å€èƒ½è¢« spark ç¯å¢ƒè®¿é—®ï¼›</p>
<p>b. ä½†æ˜¯è¿™äº› StorageD åœ°å€æ˜¯ä» MetaD è·å–çš„ï¼›</p>
<p>c. Nebula K8s Operator é‡Œï¼ŒMetaD ä¸­å­˜å‚¨çš„ StorageD åœ°å€ï¼ˆæœåŠ¡å‘ç°ï¼‰çš„æ¥æºæ˜¯ StorageD çš„é…ç½®æ–‡ä»¶ï¼Œè€Œå®ƒæ˜¯ k8s çš„å†…éƒ¨åœ°å€ã€‚</p>
<h3 id="èƒŒæ™¯çŸ¥è¯†" class="headerLink">
    <a href="#%e8%83%8c%e6%99%af%e7%9f%a5%e8%af%86" class="header-mark"></a>1.2 èƒŒæ™¯çŸ¥è¯†</h3><p><strong>a.</strong> çš„ç†ç”±æ¯”è¾ƒç›´æ¥ï¼Œå’Œ nebula çš„æ¶æ„æœ‰å…³ï¼šå›¾çš„æ•°æ®éƒ½å­˜åœ¨ Storage Service ä¹‹ä¸­ï¼Œé€šå¸¸ç”¨è¯­å¥çš„æŸ¥è¯¢æ˜¯é€è¿‡ Graph Service æ¥é€ä¼ ï¼Œåªéœ€è¦ GraphD çš„è¿æ¥å°±è¶³å¤Ÿï¼Œè€Œ Spark-Connector ä½¿ç”¨ Nebula Graph çš„åœºæ™¯æ˜¯æ‰«æå…¨å›¾æˆ–è€…å­å›¾ï¼Œè¿™æ—¶å€™è®¡ç®—å­˜å‚¨åˆ†ç¦»çš„è®¾è®¡ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç»•è¿‡æŸ¥è¯¢ã€è®¡ç®—å±‚ç›´æ¥é«˜æ•ˆè¯»å–å›¾æ•°æ®ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆéœ€è¦ã€ä¸”åªéœ€è¦ MetaD çš„åœ°å€å‘¢ï¼Ÿ</p>
<p>è¿™ä¹Ÿæ˜¯å’Œæ¶æ„æœ‰å…³ï¼ŒMeta Service é‡ŒåŒ…å«äº†å…¨å›¾çš„åˆ†å¸ƒæ•°æ®ä¸åˆ†å¸ƒå¼çš„ Storage Service çš„å„ä¸ªåˆ†ç‰‡å’Œå®ä¾‹çš„åˆ†å¸ƒï¼Œæ‰€ä»¥ä¸€æ–¹é¢å› ä¸ºåªæœ‰ Meta æ‰æœ‰å…¨å›¾çš„ä¿¡æ¯ï¼ˆéœ€è¦ï¼‰ï¼Œå¦ä¸€æ–¹é¢å› ä¸ºä» Meta å¯ä»¥è·å¾—è¿™éƒ¨åˆ†ä¿¡æ¯ï¼ˆåªéœ€è¦ï¼‰ã€‚åˆ°è¿™é‡Œ <strong>b.</strong> çš„ç­”æ¡ˆä¹Ÿæœ‰äº†ã€‚</p>
<ul>
<li>è¯¦ç»†çš„ Nebula Graph æ¶æ„ä¿¡æ¯å¯ä»¥å‚è€ƒåšå®¢ç³»åˆ—æ–‡ç« ï¼š<a href="https://nebula-graph.com.cn/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/" target="_blank" rel="noopener noreffer">nebula-graph.com.cn/tags/æ¶æ„è®¾è®¡</a></li>
<li>å¦å¤–è¯·ç¡®ä¿æ‚¨å·²ç»è¯»äº†æ¶æ„ä»‹ç»çš„æ–‡æ¡£å“¦ï¼š<a href="https://docs.nebula-graph.com.cn/3.0.0/1.introduction/3.nebula-graph-architecture/1.architecture-overview/" target="_blank" rel="noopener noreffer">Nebula æ¶æ„æ€»è§ˆ</a></li>
</ul>
<p></p>
<p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ <strong>c.</strong></p>
<blockquote>
<p>c. Nebula K8s Operator é‡Œï¼ŒMetaD ä¸­å­˜å‚¨çš„ StorageD åœ°å€ï¼ˆæœåŠ¡å‘ç°ï¼‰çš„æ¥æºæ˜¯ StorageD çš„é…ç½®æ–‡ä»¶ï¼Œè€Œå®ƒæ˜¯ k8s çš„å†…éƒ¨åœ°å€ã€‚</p>
</blockquote>
<p>è¿™å’Œ Nebula Graph é‡Œçš„æœåŠ¡å‘ç°æœºåˆ¶æœ‰å…³ï¼šåœ¨ Nebula Graph é›†ç¾¤ä¸­ï¼ŒGraph Service å’Œ Storage Service éƒ½æ˜¯é€šè¿‡å¿ƒè·³å°†è‡ªå·±çš„ä¿¡æ¯ä¸ŠæŠ¥ç»™ Meta Service çš„ï¼Œè€Œè¿™å…¶ä¸­æœåŠ¡è‡ªèº«çš„åœ°å€çš„æ¥æºåˆ™æ¥è‡ªäºä»–ä»¬ç›¸åº”çš„é…ç½®æ–‡ä»¶ä¸­çš„ç½‘ç»œé…ç½®ã€‚</p>
<ul>
<li>
<p>å…³äºæœåŠ¡è‡ªèº«çš„åœ°å€é…ç½®è¯·å‚è€ƒæ–‡æ¡£ï¼š<a href="https://docs.nebula-graph.com.cn/3.0.0/5.configurations-and-logs/1.configurations/4.storage-config/#networking" target="_blank" rel="noopener noreffer">Storage networking é…ç½®</a></p>
</li>
<li>
<p>å…³äºæœåŠ¡å‘ç°è¯¦ç»†çš„ä¿¡æ¯è¯·å‚è€ƒå››ç‹çš„æ–‡ç« ï¼š<a href="https://nebula-graph.com.cn/posts/cluster-communication-heartbeat/" target="_blank" rel="noopener noreffer">å›¾æ•°æ®åº“ Nebula Graph é›†ç¾¤é€šä¿¡ï¼šä»å¿ƒè·³è¯´èµ·</a>ã€‚</p>
</li>
</ul>
<p></p>
<p>æœ€åï¼Œæˆ‘ä»¬çŸ¥é“ Nebula Operator æ˜¯ä¸€ä¸ªåœ¨ K8s é›†ç¾¤ä¸­æŒ‰ç…§é…ç½®ï¼Œè‡ªåŠ¨åˆ›å»ºã€ç»´æŠ¤ã€æ‰©ç¼©å®¹ Nebula é›†ç¾¤çš„ K8s æ§åˆ¶é¢çš„åº”ç”¨ï¼Œå®ƒéœ€è¦æŠ½è±¡ä¸€éƒ¨åˆ†å†…éƒ¨èµ„æºç›¸å…³çš„é…ç½®ï¼Œè¿™å°±åŒ…æ‹¬äº† GraphD å’Œ StorageD å®ä¾‹çš„å®é™…åœ°å€ï¼Œä»–ä»¬æ˜¯è¢«é…ç½®çš„åœ°å€å®é™…ä¸Šæ˜¯ <a href="https://kubernetes.io/zh/docs/concepts/services-networking/service/#headless-services" target="_blank" rel="noopener noreffer">headless service åœ°å€</a>ã€‚</p>
<p>è€Œè¿™äº›åœ°å€ï¼ˆå¦‚ä¸‹ï¼‰é»˜è®¤æ˜¯æ²¡æ³•è¢« k8s å¤–éƒ¨ç½‘ç»œè®¿é—®çš„ï¼Œæ‰€ä»¥é’ˆå¯¹ GraphDã€MetaD æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åˆ›å»ºæœåŠ¡å°†å…¶æš´éœ²å‡ºæ¥ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">hosts</span><span class="w"> </span><span class="n">meta</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------------------------------------------------------------+------+----------+--------+--------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="k">Host</span><span class="w">                                                             </span><span class="o">|</span><span class="w"> </span><span class="n">Port</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Status</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Role</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Git</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="n">Sha</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Version</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------------------------------------------------------------+------+----------+--------+--------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;nebula-metad-0.nebula-metad-headless.default.svc.cluster.local&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">9559</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;ONLINE&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;META&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;d113f4a&#34;</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;2.6.2&#34;</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------------------------------------------------------------+------+----------+--------+--------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Got</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="p">(</span><span class="n">time</span><span class="w"> </span><span class="n">spent</span><span class="w"> </span><span class="mi">1378</span><span class="o">/</span><span class="mi">2598</span><span class="w"> </span><span class="n">us</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Mon</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">2022</span><span class="w"> </span><span class="mi">09</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">33</span><span class="w"> </span><span class="n">UTC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">hosts</span><span class="w"> </span><span class="n">graph</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------------------------------------------------------------+------+----------+---------+--------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="k">Host</span><span class="w">                                                          </span><span class="o">|</span><span class="w"> </span><span class="n">Port</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Status</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Role</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Git</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="n">Sha</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Version</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------------------------------------------------------------+------+----------+---------+--------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;nebula-graphd-0.nebula-graphd-svc.default.svc.cluster.local&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">9669</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;ONLINE&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;GRAPH&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;d113f4a&#34;</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;2.6.2&#34;</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------------------------------------------------------------+------+----------+---------+--------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Got</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="p">(</span><span class="n">time</span><span class="w"> </span><span class="n">spent</span><span class="w"> </span><span class="mi">2072</span><span class="o">/</span><span class="mi">3403</span><span class="w"> </span><span class="n">us</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Mon</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">2022</span><span class="w"> </span><span class="mi">10</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">58</span><span class="w"> </span><span class="n">UTC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">hosts</span><span class="w"> </span><span class="k">storage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------------------------------------------------------------------+------+----------+-----------+--------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="k">Host</span><span class="w">                                                                   </span><span class="o">|</span><span class="w"> </span><span class="n">Port</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Status</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Role</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">Git</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="n">Sha</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Version</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------------------------------------------------------------------+------+----------+-----------+--------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;nebula-storaged-0.nebula-storaged-headless.default.svc.cluster.local&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">9779</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;ONLINE&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;STORAGE&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;d113f4a&#34;</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;2.6.2&#34;</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;nebula-storaged-1.nebula-storaged-headless.default.svc.cluster.local&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">9779</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;ONLINE&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;STORAGE&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;d113f4a&#34;</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;2.6.2&#34;</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;nebula-storaged-2.nebula-storaged-headless.default.svc.cluster.local&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">9779</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;ONLINE&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;STORAGE&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;d113f4a&#34;</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;2.6.2&#34;</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------------------------------------------------------------------+------+----------+-----------+--------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Got</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="p">(</span><span class="n">time</span><span class="w"> </span><span class="n">spent</span><span class="w"> </span><span class="mi">1603</span><span class="o">/</span><span class="mi">2979</span><span class="w"> </span><span class="n">us</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Mon</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">2022</span><span class="w"> </span><span class="mi">10</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">24</span><span class="w"> </span><span class="n">UTC</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶è€Œï¼Œå› ä¸ºå‰è¾¹æåˆ°çš„ Spark-Connector é€šè¿‡ Meta Service å»è·å– StorageD çš„åœ°å€ï¼Œä¸”è¿™ä¸ªåœ°å€æ˜¯æœåŠ¡å‘ç°è€Œå¾—ï¼Œæ‰€ä»¥ Spark-Connector å®é™…ä¸Šè·å–çš„ StorageD åœ°å€å°±æ˜¯ä¸Šè¾¹çš„è¿™ç§ headless çš„æœåŠ¡åœ°å€ï¼Œæ²¡æ³•ç›´æ¥ä»å¤–éƒ¨è®¿é—®ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨æœ‰æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œåªéœ€è¦è®© Spark è¿è¡Œåœ¨å’Œ Nebula Cluster ç›¸åŒçš„ K8s ç½‘ç»œé‡Œï¼Œä¸€åˆ‡å°±è¿åˆƒè€Œè§£äº†ï¼Œå¦åˆ™ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p>
<ol>
<li>
<p>å°† MetaD å’Œ StorageD çš„åœ°å€åˆ©ç”¨ Ingress ç­‰æ–¹å¼å°†å…¶ L4ï¼ˆTCPï¼‰æš´éœ²å‡ºæ¥ã€‚</p>
<p>å¯ä»¥å‚è€ƒ Nebula Operator çš„æ–‡æ¡£ï¼š<a href="doc/user/client_service.md" rel="">doc/user/client_service.md</a></p>
</li>
<li>
<p>é€šè¿‡åå‘ä»£ç†å’ŒDNSè®©è¿™äº› headless æœåŠ¡èƒ½è¢«è§£æåˆ°ç›¸åº”çš„ StorageDã€‚</p>
<p>å‚è€ƒï¼šTBD</p>
</li>
</ol>
<p>é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰æ›´æ–¹ä¾¿çš„æ–¹å¼ï¼Ÿ</p>
<p>éå¸¸æŠ±æ­‰çš„æ˜¯ï¼Œç›®å‰æœ€æ–¹ä¾¿çš„æ–¹å¼ä¾ç„¶æ˜¯å¦‚æ–‡ç« æœ€å¼€å¤´æ‰€ä»‹ç»ï¼šè®© Spark è¿è¡Œåœ¨ Nebula Cluster å†…éƒ¨ã€‚å®é™…ä¸Šï¼Œæˆ‘åœ¨åŠªåŠ›æ¨è¿› Nebula Spark ç¤¾åŒºå»æ”¯æŒå¯ä»¥é…ç½®çš„ StorageAddresses é€‰é¡¹ï¼Œæœ‰äº†å®ƒä¹‹åï¼Œå‰è¾¹æåˆ°çš„ <strong>2.</strong> å°±æ˜¯ä¸å¿…è¦çš„äº†ã€‚</p>
<h2 id="bonusä¸€é”®ä½“éªŒ-nebula-algorithm--nebula-operator" class="headerLink">
    <a href="#bonus%e4%b8%80%e9%94%ae%e4%bd%93%e9%aa%8c-nebula-algorithm--nebula-operator" class="header-mark"></a>2 Bonusï¼šä¸€é”®ä½“éªŒ nebula-algorithm + nebula-operator</h2><p>ä¸ºäº†æ–¹ä¾¿åœ¨ k8s ä¸Šå°é²œ nebula-graph nebula-algorithm çš„åŒå­¦ï¼Œè¿™é‡Œæˆ‘è¦å†æ¬¡å®‰åˆ©ä¸€ä¸‹æˆ‘å†™çš„ä¸€ä¸ªå°å·¥å…· <a href="https://github.com/wey-gu/nebula-operator-kind" target="_blank" rel="noopener noreffer">Neubla-Operator-KinD</a>ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸€é”®åœ¨ Docker ç¯å¢ƒå†…éƒ¨å•ç‹¬éƒ¨ç½²ä¸€ä¸ª k8s é›†ç¾¤å¹¶åœ¨å…¶ä¸­éƒ¨ç½² Nebula Operator ä»¥åŠæ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬ storage providerï¼‰å¹¶éƒ¨ç½²ä¸€ä¸ªå° Nebula Cluster çš„å·¥å…·ã€‚æœ‰ç‚¹ç»•ï¼Œä¸è¿‡å¯ä»¥çœ‹ä¸‹è¾¹çš„æ­¥éª¤å“ˆï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼Œéƒ¨ç½² K8s+Nebula-Operator+Nebula Clusterï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -sL nebula-kind.siwei.io/install.sh <span class="p">|</span> bash
</span></span></code></pre></td></tr></table>
</div>
</div><p></p>
<p>ç¬¬äºŒæ­¥ï¼Œç…§ç€å·¥å…·æ–‡æ¡£é‡Œçš„ <a href="https://github.com/wey-gu/nebula-operator-kind#whats-next" target="_blank" rel="noopener noreffer">what&rsquo;s next</a></p>
<p>a. ç”¨ console è¿æ¥é›†ç¾¤ï¼Œå¹¶åŠ è½½ç¤ºä¾‹æ•°æ®é›†</p>
<p>b. <a href="https://github.com/wey-gu/nebula-operator-kind/blob/main/README.md#try-nebula-algorithm" target="_blank" rel="noopener noreffer">åœ¨è¿™ä¸ª k8s é‡Œè·‘ä¸€ä¸ªå›¾ç®—æ³•</a></p>
<ul>
<li>åˆ›å»ºä¸€ä¸ª Spark ç¯å¢ƒ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl create -f http://nebula-kind.siwei.io/deployment/spark.yaml
</span></span><span class="line"><span class="cl">kubectl wait pod --timeout=-1s --for=condition=Ready -l &#39;!job-name&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç­‰ä¸Šè¾¹çš„ wait éƒ½ ready ä¹‹åï¼Œè¿›å…¥ spark çš„ podã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl exec -it deploy/spark-deployment -- bash
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä¸‹è½½ nebula-algorithm æ¯”å¦‚ <code>2.6.2</code> è¿™ä¸ªç‰ˆæœ¬ï¼Œæ›´å¤šç‰ˆæœ¬è¯·å‚è€ƒ <a href="https://github.com/vesoft-inc/nebula-algorithm/" target="_blank" rel="noopener noreffer">https://github.com/vesoft-inc/nebula-algorithm/</a>ã€‚</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>å®˜æ–¹å‘å¸ƒçš„ç‰ˆæœ¬åœ¨è¿™é‡Œå¯ä»¥è·å–ï¼šhttps://repo1.maven.org/maven2/com/vesoft/nebula-algorithm/</li>
<li>å› ä¸ºè¿™ä¸ªé—®é¢˜ <a href="https://github.com/vesoft-inc/nebula-algorithm/issues/42" target="_blank" rel="noopener noreffer">https://github.com/vesoft-inc/nebula-algorithm/issues/42</a> åªæœ‰ <code>2.6.2</code> æˆ–è€…æ›´æ–°çš„ç‰ˆæœ¬æ‰æ”¯æŒåŸŸåè®¿é—® MetaDã€‚</li>
</ul>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># ä¸‹è½½ nebula-algorithm-2.6.2.jar
</span></span><span class="line"><span class="cl">wget https://repo1.maven.org/maven2/com/vesoft/nebula-algorithm/2.6.2/nebula-algorithm-2.6.2.jar
</span></span><span class="line"><span class="cl"># ä¸‹è½½ nebula-algorthm é…ç½®æ–‡ä»¶
</span></span><span class="line"><span class="cl">wget https://github.com/vesoft-inc/nebula-algorithm/raw/v2.6/nebula-algorithm/src/main/resources/application.conf
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä¿®æ”¹Then we could change the config file of nebula-algorithm on meta and graph addresses:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sed -i &#39;/^        metaAddress/c\        metaAddress: \&#34;nebula-metad-0.nebula-metad-headless.default.svc.cluster.local:9559\&#34;&#39; application.conf
</span></span><span class="line"><span class="cl">sed -i &#39;/^        graphAddress/c\        graphAddress: \&#34;nebula-graphd-0.nebula-graphd-svc.default.svc.cluster.local:9669\&#34;&#39; application.conf
</span></span><span class="line"><span class="cl">##### change space
</span></span><span class="line"><span class="cl">sed -i &#39;/^        space/c\        space: basketballplayer&#39; application.conf
</span></span><span class="line"><span class="cl">##### read data from nebula graph
</span></span><span class="line"><span class="cl">sed -i &#39;/^    source/c\    source: nebula&#39; application.conf
</span></span><span class="line"><span class="cl">##### execute algorithm: labelpropagation
</span></span><span class="line"><span class="cl">sed -i &#39;/^    executeAlgo/c\    executeAlgo: labelpropagation&#39; application.conf
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ‰§è¡Œ LPA ç®—æ³•åœ¨  basketballplayer å›¾ç©ºé—´</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/spark/bin/spark-submit --master &#34;local&#34; --conf spark.rpc.askTimeout=6000s \
</span></span><span class="line"><span class="cl">    --class com.vesoft.nebula.algorithm.Main \
</span></span><span class="line"><span class="cl">    nebula-algorithm-2.6.2.jar \
</span></span><span class="line"><span class="cl">    -p application.conf
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç»“æœå¦‚ä¸‹ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">bash-5.0# ls /tmp/count/
</span></span><span class="line"><span class="cl">_SUCCESS                                                  part-00000-5475f9f4-66b9-426b-b0c2-704f946e54d3-c000.csv
</span></span><span class="line"><span class="cl">bash-5.0# head /tmp/count/part-00000-5475f9f4-66b9-426b-b0c2-704f946e54d3-c000.csv
</span></span><span class="line"><span class="cl">_id,lpa
</span></span><span class="line"><span class="cl">1100,1104
</span></span><span class="line"><span class="cl">2200,2200
</span></span><span class="line"><span class="cl">2201,2201
</span></span><span class="line"><span class="cl">1101,1104
</span></span><span class="line"><span class="cl">2202,2202
</span></span></code></pre></td></tr></table>
</div>
</div><p>Happy Graphing!</p>
<blockquote>
<p>Picture Credit: <a href="https://unsplash.com/photos/yx20mpDyr2I" target="_blank" rel="noopener noreffer">Timelab Pro</a></p>
</blockquote>]]></description>
</item><item>
    <title>ä»é›¶åˆ°ä¸€ï¼šå¦‚ä½•æ„å»ºä¸€ä¸ªåŸºäºçŸ¥è¯†å›¾è°±çš„æ™ºèƒ½é—®ç­”åŠ©æ‰‹ï¼Ÿ</title>
    <link>https://siwei.io/siwi/</link>
    <pubDate>Thu, 30 Dec 2021 14:04:31 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/siwi/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>å¦‚ä½•åˆ©ç”¨å›¾æ•°æ®åº“ä»0-1æ„å»ºä¸€ä¸ªç‰¹å®šé¢†åŸŸé—®ç­”åŠ©æ‰‹ï¼Ÿæœ¬æ–‡æ‰‹æŠŠæ‰‹å¸¦ä½ æ„å»ºä¸€ä¸ªç®€æ˜“ç‰ˆçš„ç¯®çƒé¢†åŸŸæ™ºèƒ½é—®ç­”æœºå™¨äººã€‚</p>
</blockquote>
<h2 id="å‰è¨€" class="headerLink">
    <a href="#%e5%89%8d%e8%a8%80" class="header-mark"></a>1 å‰è¨€</h2><p>ã€Œé—®ç­”æœºå™¨äººã€åœ¨æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­å¹¶ä¸å°‘è§åˆ° ï¼šæ¯”å¦‚åœ¨ä¸€äº›ç”µå•†å®¢æœã€æ™ºèƒ½é—®è¯Šã€æŠ€æœ¯æ”¯æŒç­‰äººå·¥è¾“å…¥ä¸æ²Ÿé€šç•Œé¢çš„åœºæ™¯ä¸‹ï¼Œæœºå™¨äººâ€œæ™ºèƒ½â€é—®ç­”ç³»ç»Ÿä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥åœ¨æ— éœ€äººåŠ›ã€ä¸éœ€è¦è€—è´¹ç»ˆç«¯ç”¨æˆ·å¿ƒæ™ºå»åšçŸ¥è¯†åº“ã€å•†å“æœç´¢ã€ç§‘å®¤é€‰æ‹©ç­‰ç­‰çš„æƒ…å†µä¸‹å®æ—¶ç»™å‡ºé—®é¢˜ç­”æ¡ˆã€‚</p>
<p>é—®ç­”æœºå™¨äººç³»ç»ŸèƒŒåçš„æŠ€æœ¯æœ‰å¤šé‡å¯èƒ½ï¼š</p>
<ul>
<li>åŸºäºæ£€ç´¢ï¼Œå…¨æ–‡æœç´¢æ¥è¿‘çš„é—®é¢˜</li>
<li>åŸºäº<a href="https://arxiv.org/abs/1710.10723" target="_blank" rel="noopener noreffer">æœºå™¨å­¦ä¹ é˜…è¯»ç†è§£</a></li>
<li>åŸºäºçŸ¥è¯†å›¾è°±ï¼ˆKnowledge-Based Question Answering system: KBQAï¼‰</li>
<li>å…¶ä»–</li>
</ul>
<p>åŸºäºçŸ¥è¯†å›¾è°±æ„å»ºé—®ç­”ç³»ç»Ÿåœ¨ä»¥ä¸‹ä¸‰ä¸ªæƒ…å†µä¸‹å¾ˆæœ‰ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å¯¹äºé¢†åŸŸç±»å‹æ˜¯ç»“æ„åŒ–æ•°æ®åœºæ™¯ï¼šç”µå•†ã€åŒ»è¯ã€ç³»ç»Ÿè¿ç»´ï¼ˆå¾®æœåŠ¡ã€æœåŠ¡å™¨ã€äº‹ä»¶ï¼‰ã€äº§å“æ”¯æŒç³»ç»Ÿç­‰ï¼Œå…¶ä¸­ä½œä¸ºé—®ç­”ç³»ç»Ÿçš„å‚è€ƒå¯¹è±¡å·²ç»æ˜¯ç»“æ„åŒ–æ•°æ®ï¼›</li>
<li>é—®é¢˜çš„è§£ç­”è¿‡ç¨‹æ¶‰åŠå¤šè·³æŸ¥è¯¢ï¼Œæ¯”å¦‚â€œå§šæ˜çš„å¦»å­ä»Šå¹´æ˜¯æœ¬å‘½å¹´å—ï¼Ÿâ€ï¼Œâ€œä½ ä»¬å®¶çš„äº§å“ A å’Œ A+ çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿâ€ï¼›</li>
<li>ä¸ºäº†è§£å†³å…¶ä»–éœ€æ±‚ï¼ˆé£æ§ã€æ¨èã€ç®¡ç†ï¼‰ï¼Œå·²ç»æ„å»ºäº†å›¾ç»“æ„æ•°æ®ã€çŸ¥è¯†å›¾è°±çš„æƒ…å†µã€‚</li>
</ul>
<p>ä¸ºäº†æ–¹ä¾¿è¯»è€…æœ€å¿«é€Ÿäº†è§£å¦‚ä½•æ„å»º KBQA ç³»ç»Ÿï¼Œæˆ‘å†™äº†éå¸¸ç®€é™‹çš„å° KBQA é¡¹ç›®ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä¼šå¸¦é¢†å¤§å®¶ä»å¤´åˆ°å°¾æŠŠå®ƒæ­èµ·æ¥ã€‚</p>
<blockquote>
<p>ğŸ’¡ï¼šè¿™ä¸ªå°é¡¹ç›®å«åš Siwiï¼Œå®ƒçš„ä»£ç å°±åœ¨ GitHub ä¸Šï¼š<a href="https://github.com/wey-gu/nebula-siwi/" target="_blank" rel="noopener noreffer">github.com/wey-gu/nebula-siwi</a></p>
<p>Siwi çš„å‘éŸ³æ˜¯ï¼š<code>/ËˆsÉªwi/</code> æˆ–è€…å«ï¼š<code>æ€äºŒä¸º</code> ï¼Œå®ƒæ˜¯ä¸€ä¸ªèƒ½è§£ç­” NBA ç›¸å…³é—®é¢˜çš„æœºå™¨äººã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å¼€å§‹å§ã€‚</p>
<h2 id="é¸Ÿç°-tldr" class="headerLink">
    <a href="#%e9%b8%9f%e7%9e%b0-tldr" class="header-mark"></a>2 é¸Ÿç° TL;DR</h2><p>KBQA ç”¨ä¸€å¥è¯è¯´å°±æ˜¯æŠŠé—®é¢˜è§£æã€è½¬æ¢æˆåœ¨çŸ¥è¯†å›¾è°±ä¸­çš„æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å¾—åˆ°ç»“æœä¹‹åè¿›è¡Œç­›é€‰ã€ç¿»è¯‘æˆç»“æœï¼ˆå¥å­ã€å¡ç‰‡æˆ–è€…ä»»ä½•æ–¹ä¾¿äººç†è§£çš„ç­”æ¡ˆæ ¼å¼ï¼‰ã€‚</p>
<blockquote>
<p>ğŸ’¡ï¼šçŸ¥è¯†å›¾è°±çš„æ„å»ºå®é™…ä¸Šæ˜¯éå¸¸é‡è¦çš„è¿‡ç¨‹ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¸“æ³¨åœ¨ä¸²èµ·æ¥ KBQA ç³»ç»Ÿçš„éª¨æ¶ï¼Œæˆ‘ä»¬å‡è®¾éœ€æ±‚æ˜¯åŸºäºä¸€ä¸ªå·²ç»æœ‰çš„å›¾è°±ä¹‹ä¸Šï¼Œä¸ºå…¶å¢åŠ ä¸€ä¸ª QA ç³»ç»Ÿã€‚</p>
</blockquote>
<p>ã€Œé—®é¢˜åˆ°å›¾è°±æŸ¥è¯¢çš„è½¬æ¢ã€æœ‰ä¸åŒçš„æ–¹æ³•å¯ä»¥å®ç°ã€‚</p>
<ul>
<li>å¯ä»¥æ˜¯å¯¹è¯­ä¹‰è¿›è¡Œåˆ†æï¼šç†è§£é—®é¢˜çš„æ„å›¾ï¼Œé’ˆå¯¹ä¸åŒæ„å›¾åŒ¹é…æœ€å¯èƒ½çš„é—®é¢˜ç±»å‹ï¼Œä»è€Œæ„å»ºè¿™ä¸ªç±»å‹é—®é¢˜çš„å›¾è°±æŸ¥è¯¢ï¼ŒæŸ¥å¾—ç»“æœï¼›</li>
<li>ä¹Ÿå¯ä»¥æ˜¯åŸºäºä¿¡æ¯çš„æŠ½å–ï¼šä»é—®é¢˜ä¸­æŠ½å–ä¸»è¦çš„å®ä½“ï¼Œåœ¨å›¾è°±ä¸­è·å–å®ä½“çš„æ‰€æœ‰çŸ¥è¯†ã€å…³ç³»æ¡ç›®ï¼ˆå­å›¾ï¼‰ï¼Œå†å¯¹ç»“æœæ ¹æ®é—®é¢˜ä¸­çš„çº¦æŸæ¡ä»¶åŒ¹é…ã€æ’åºé€‰æ‹©ç»“æœã€‚</li>
</ul>
<blockquote>
<p>ğŸ’¡ï¼šç¾å›¢æŠ€æœ¯å›¢é˜Ÿåœ¨<a href="https://tech.meituan.com/2021/11/03/knowledge-based-question-answering-in-meituan.html" target="_blank" rel="noopener noreffer">è¿™ç¯‡æ–‡ç« </a>é‡Œåˆ†äº«äº†ä»–ä»¬çš„çœŸå®ä¸–ç•Œå®è·µï¼Œä¸‹å›¾æ˜¯ç¾å›¢ç»“åˆäº†æœºå™¨å­¦ä¹ å’Œ NLP çš„æ–¹æ¡ˆã€‚</p>
</blockquote>
<p></p>
<p>è€Œåœ¨ Siwi é‡Œï¼Œæˆ‘ä»¬ä¸€åˆ‡ä»ç®€ï¼Œå•ç‹¬é€‰æ‹©äº†è¯­ä¹‰åˆ†æè¿™æ¡è·¯ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯éœ€è¦äººä¸ºå»æ ‡æ³¨æˆ–è€…ç¼–ç ä¸€äº›é—®é¢˜ç±»å‹çš„æŸ¥è¯¢æ–¹å¼ï¼Œä½†å®é™…ä¸Šåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œå°¤å…¶å•ä¸€é¢†åŸŸå›¾è°±çš„åœºæ™¯ä¸‹åè€Œæ˜¯è½»é‡å´æ•ˆæœä¸å·®çš„æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¾¿äºæ–°æ‰‹ç†è§£ KBQA çš„åˆé€‚çš„å…¥é—¨æ–¹å¼ã€‚</p>
<p>é™¤äº†æ ¸å¿ƒçš„é—®ç­”éƒ¨åˆ†ï¼Œæˆ‘è¿˜ä¸º Siwi å¢åŠ äº†è¯­éŸ³è¯†åˆ«å’Œè¯­éŸ³å›ç­”ï¼ˆæ„Ÿè°¢æµè§ˆå™¨æ¥å£æ ‡å‡†çš„å‘å±•ï¼‰çš„åŠŸèƒ½ï¼Œäºæ˜¯ï¼Œè¿™ä¸ªé¡¹ç›®çš„ç»“æ„å’Œé—®ç­”è°ƒç”¨æµç¨‹å°±æ˜¯è¿™æ ·çš„äº†ï¼šä¸€ä¸ªè¯­éŸ³é—®é¢˜è‡ªä¸Šè€Œä¸‹åˆ†åˆ«ç»è¿‡ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>åŸºäºç½‘é¡µçš„ Siwi Frontend è¯­éŸ³ã€æ–‡å­—é—®ç­”ç•Œé¢</li>
<li>Python Flask å®ç°çš„ Siwi Backend/API ç³»ç»Ÿ</li>
<li><a href="https://nebula-graph.com.cn" target="_blank" rel="noopener noreffer">Nebula Graph</a> å¼€æºåˆ†å¸ƒå¼é«˜æ€§èƒ½å›¾æ•°æ®åº“ä¹‹ä¸Šçš„çŸ¥è¯†å›¾è°±</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">â”‚                â”‚                                      â”‚
</span></span><span class="line"><span class="cl">â”‚                â”‚  Speech                              â”‚
</span></span><span class="line"><span class="cl">â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
</span></span><span class="line"><span class="cl">â”‚     â”‚            Frontend â”‚   Siwi, /ËˆsÉªwi/           â”‚
</span></span><span class="line"><span class="cl">â”‚     â”‚ Web_Speech_API      â”‚   A PoC of                â”‚
</span></span><span class="line"><span class="cl">â”‚     â”‚                     â”‚   Dialog System           â”‚
</span></span><span class="line"><span class="cl">â”‚     â”‚ Vue.JS              â”‚   With Graph Database     â”‚
</span></span><span class="line"><span class="cl">â”‚     â”‚                     â”‚   Backed Knowledge Graph  â”‚
</span></span><span class="line"><span class="cl">â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
</span></span><span class="line"><span class="cl">â”‚                â”‚  Sentence                            â”‚
</span></span><span class="line"><span class="cl">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚            â”‚              Backend         â”‚       â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚       â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚ â”‚ Web API, Flask      â”‚   ./app/          â”‚       â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚       â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚            â”‚  Sentence    ./bot/          â”‚       â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚       â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚ â”‚ Intent matching,    â”‚   ./bot/classifierâ”‚       â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚ â”‚ Symentic Processing â”‚                   â”‚       â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚       â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚            â”‚  Intent, Entities            â”‚       â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚       â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚ â”‚ Intent Actor        â”‚   ./bot/actions   â”‚       â”‚
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
</span></span><span class="line"><span class="cl">â”‚                â”‚  Graph Query                         â”‚
</span></span><span class="line"><span class="cl">â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
</span></span><span class="line"><span class="cl">â”‚     â”‚ Graph Database      â”‚    Nebula Graph           â”‚
</span></span><span class="line"><span class="cl">â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
</span></span><span class="line"><span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ğŸ’¡ï¼šå›¾æ•°æ®åº“ç›¸æ¯”äºå…¶ä»–çŸ¥è¯†å›¾è°±å­˜å‚¨ç³»ç»Ÿæ¥è¯´ï¼Œå› ä¸ºå…¶è®¾è®¡ä¸“æ³¨äºæ•°æ®å†…çš„æ•°æ®å…³ç³»ï¼Œéå¸¸æ“…é•¿å®æ—¶è·å–æµ·é‡æ•°æ®ä¸‹å®ä½“ä¹‹é—´çš„å¤æ‚å…³è”å…³ç³»ã€‚</p>
<p>Nebula Graph çš„åŸç”Ÿåˆ†å¸ƒå¼è®¾è®¡å’Œ share-nothing æ¶æ„ä½¿å¾—å®ƒæ“…é•¿äºå·¨å¤§æ•°æ®é‡å’Œé«˜å¹¶å‘è¯»å†™çš„åœºæ™¯ï¼ŒåŠ ä¸Šå®ƒçš„å¼€æºç¤¾åŒºç‰¹åˆ«æ´»è·ƒï¼Œå·²ç»è¢«å›½å†…å¾ˆå¤šå›¢é˜Ÿç”¨äºæ”¯æ’‘ç”Ÿäº§ä¸Šçš„å„ç§ä¸šåŠ¡ï¼Œ<a href="https://nebula-graph.com.cn/cases/" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a>æœ‰ä¸€äº›ä»–ä»¬åˆ†äº«çš„é€‰å‹ã€è½åœ°å®è·µã€‚</p>
</blockquote>
<h2 id="çŸ¥è¯†å›¾è°±" class="headerLink">
    <a href="#%e7%9f%a5%e8%af%86%e5%9b%be%e8%b0%b1" class="header-mark"></a>3 çŸ¥è¯†å›¾è°±</h2><p>Siwi æ„å»ºäºä¸€ä¸ªç¯®çƒç›¸å…³çš„çŸ¥è¯†å›¾è°±ä¹‹ä¸Šï¼Œå®ƒå…¶å®æ˜¯ Siwi é‡‡ç”¨çš„å¼€æºåˆ†å¸ƒå¼å›¾æ•°æ®åº“ <a href="http://nebula-graph.com.cn/" target="_blank" rel="noopener noreffer">Nebula Graph</a> ç¤¾åŒºçš„å®˜æ–¹æ–‡æ¡£é‡Œçš„ç¤ºä¾‹<a href="https://docs.nebula-graph.com.cn/master/3.ngql-guide/1.nGQL-overview/1.overview/#basketballplayer" target="_blank" rel="noopener noreffer">æ•°æ®é›†</a>ã€‚</p>
<p>åœ¨è¿™ä¸ªéå¸¸ç®€å•çš„å›¾è°±ä¹‹ä¸­ï¼Œåªæœ‰ä¸¤ç§ç‚¹ï¼š</p>
<ul>
<li>playerï¼Œçƒå‘˜</li>
<li>teamï¼Œçƒé˜Ÿ</li>
</ul>
<p>ä¸¤ç§å…³ç³»ï¼š</p>
<ul>
<li>serve æœå½¹äºï¼ˆæ¯”å¦‚ï¼šå§šæ˜ <code>-æœå½¹äº-&gt;</code> ä¼‘æ–¯é¡¿ç«ç®­ï¼‰</li>
<li>follow å…³æ³¨ ï¼ˆæ¯”å¦‚ï¼šå§šæ˜ <code>-å…³æ³¨-&gt;</code> å¥¥å°¼å°”ï¼‰</li>
</ul>
<blockquote>
<p>ğŸ’¡ï¼šè¿™ä¸ªæ•°æ®é›†åœ¨ Nebula ç¤¾åŒºä¸Šæœ‰ä¸€ä¸ª <a href="https://nebula-graph.com.cn/demo/" target="_blank" rel="noopener noreffer">åœ¨çº¿ä½“éªŒ</a> ç¯å¢ƒï¼Œä»»ä½•äººéƒ½æ— éœ€ç™»å½•ï¼Œé€šè¿‡<a href="https://docs.nebula-graph.com.cn/2.6.1/nebula-studio/about-studio/st-ug-what-is-graph-studio/" target="_blank" rel="noopener noreffer">Nebula Graph Studio</a> å¯è§†åŒ–æ¢ç´¢ç¯®çƒå›¾è°±ã€‚</p>
</blockquote>
<p>ä¸‹å›¾å°±æ˜¯è¿™ä¸ªå›¾è°±çš„å¯è§†åŒ–æ¢ç´¢æˆªå›¾ï¼Œå¯ä»¥çœ‹åˆ°å·¦è¾¹çš„ä¸­å¿ƒèŠ‚ç‚¹å‹‡å£«é˜Ÿï¼ˆWarriorsï¼‰æœ‰æœå…°ç‰¹ï¼ˆDurantï¼‰è¿˜æœ‰å…¶ä»–å‡ ä¸ªé˜Ÿå‘˜åœ¨å…¶ä¸­æœå½¹ï¼ˆserveï¼‰ï¼›é™¤äº†æœå½¹ä¹‹å¤–ï¼Œè¿˜å¯ä»¥çœ‹åˆ°é˜Ÿå‘˜å’Œé˜Ÿå‘˜ä¹‹ä¸­ä¹Ÿæœ‰å…³æ³¨ï¼ˆfollowï¼‰çš„å…³ç³»å­˜åœ¨ã€‚</p>
<p></p>
<p>æœ‰äº†è¿™ä¸ªçŸ¥è¯†å›¾è°±ï¼Œå’±ä»¬æ¥ä¸‹æ¥å°±åœ¨å®ƒä¹‹ä¸Šæ­ä¸€ä¸ªç®€å•çš„åŸºäºè¯­æ³•è§£æçš„ QA ç³»ç»Ÿå§ğŸ˜ã€‚</p>
<h2 id="siwi-backend" class="headerLink">
    <a href="#siwi-backend" class="header-mark"></a>4 Siwi-backend</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">â”‚            â”‚              Backend         â”‚
</span></span><span class="line"><span class="cl">â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ Web API, Flask      â”‚   ./app/          â”‚
</span></span><span class="line"><span class="cl">â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
</span></span><span class="line"><span class="cl">â”‚            â”‚  Sentence    ./bot/          â”‚
</span></span><span class="line"><span class="cl">â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ Intent matching,    â”‚   ./bot/classifierâ”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ Symentic Processing â”‚                   â”‚
</span></span><span class="line"><span class="cl">â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
</span></span><span class="line"><span class="cl">â”‚            â”‚  Intent, Entities            â”‚
</span></span><span class="line"><span class="cl">â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ Intent Actor        â”‚   ./bot/actions   â”‚
</span></span><span class="line"><span class="cl">â””â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="cl">             â”‚  Graph Query
</span></span><span class="line"><span class="cl">  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">  â”‚ Graph Database      â”‚    Nebula Graph
</span></span><span class="line"><span class="cl">  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚ä¸Šå›¾çš„è®¾è®¡æµç¨‹ï¼ŒSiwi çš„åç«¯éƒ¨åˆ†éœ€è¦æ¥æ”¶é—®å¥ï¼Œå¤„ç†ä¹‹åè®¿é—®çŸ¥è¯†å›¾è°±ï¼ˆå›¾æ•°æ®åº“ï¼‰ï¼Œç„¶åå°†å¤„ç†ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚</p>
<h3 id="æ¥æ”¶-http-è¯·æ±‚app" class="headerLink">
    <a href="#%e6%8e%a5%e6%94%b6-http-%e8%af%b7%e6%b1%82app" class="header-mark"></a>4.1 æ¥æ”¶ HTTP è¯·æ±‚(app)</h3><p>å¯¹äºè¯·æ±‚ï¼Œå°±ç®€å•åœ°ç”¨ Flask ä½œä¸º web server æ¥æ¥æ”¶ HTTP çš„ POST è¯·æ±‚ï¼š</p>
<blockquote>
<p>ğŸ’¡ï¼šè¿˜ä¸ç†Ÿæ‚‰ Flask çš„åŒå­¦ï¼Œå¯ä»¥åœ¨ <a href="https://www.freecodecamp.org/news/tag/flask/" target="_blank" rel="noopener noreffer">freeCodeCamp ä¸Šæœç´¢ä¸€ä¸‹</a>ï¼Œæœ‰ä¸€äº›ä¸é”™çš„è¯¾ç¨‹å“ˆã€‚</p>
</blockquote>
<p>ä¸‹è¾¹çš„ä»£ç å°±æ˜¯å‘Šè¯‰ Flask ï¼š</p>
<ol>
<li>å¦‚æœç”¨æˆ·å‘è¿‡æ¥ <code>http://&lt;server&gt;/query</code> çš„ POST è¯·æ±‚ï¼Œæçš„é—®é¢˜å°±åœ¨è¯·æ±‚çš„ body é‡Œçš„ <code>question</code> çš„ Key ä¹‹ä¸‹ã€‚</li>
<li>å–å¾—é—®é¢˜ä¹‹åï¼Œè°ƒç”¨æŠŠè¯·æ±‚ä¼ ç»™  <code>siwi_bot</code> çš„ <code>query()</code>ï¼Œå¾—åˆ° <code>answer</code> ã€‚</li>
</ol>
<p>ä»£ç æ®µï¼š<code>src/siwi/app/__init__.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#...</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">siwi.bot</span> <span class="kn">import</span> <span class="n">bot</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#...</span>
</span></span><span class="line"><span class="cl"><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&#34;/query&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;POST&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">query</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">request_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">question</span> <span class="o">=</span> <span class="n">request_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;question&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="c1"># &lt;----- 1.</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">question</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">answer</span> <span class="o">=</span> <span class="n">siwi_bot</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">request_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;question&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">))</span>   <span class="c1"># &lt;----- 2.</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">answer</span> <span class="o">=</span> <span class="s2">&#34;Sorry, what did you say?&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;answer&#34;</span><span class="p">:</span> <span class="n">answer</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç° <code>siwi_bot</code>ï¼ŒçœŸæ­£å¤„ç†æé—®çš„é€»è¾‘ã€‚</p>
<h3 id="å¤„ç†è¯·æ±‚bot" class="headerLink">
    <a href="#%e5%a4%84%e7%90%86%e8%af%b7%e6%b1%82bot" class="header-mark"></a>4.2 å¤„ç†è¯·æ±‚(bot)</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">â”‚            â”‚  Sentence    ./bot/          â”‚
</span></span><span class="line"><span class="cl">â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ Intent matching,    â”‚   ./bot/classifierâ”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ Symentic Processing â”‚                   â”‚
</span></span><span class="line"><span class="cl">â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
</span></span><span class="line"><span class="cl">â”‚            â”‚  Intent, Entities            â”‚
</span></span><span class="line"><span class="cl">â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ Intent Actor        â”‚   ./bot/actions   â”‚
</span></span><span class="line"><span class="cl">â””â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‰è¾¹æåˆ°è¿‡ï¼ŒKBQA åŸºæœ¬ä¸Šæ˜¯</p>
<p>a. æŠŠé—®é¢˜è§£æã€è½¬æ¢æˆåœ¨çŸ¥è¯†å›¾è°±ä¸­çš„æŸ¥è¯¢</p>
<p>b. æŸ¥è¯¢å¾—åˆ°ç»“æœä¹‹åè¿›è¡Œç­›é€‰ã€ç¿»è¯‘æˆç»“æœ</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠ a. çš„é€»è¾‘æ”¾åœ¨ <code>classifier</code> é‡Œï¼Œb. çš„é€»è¾‘æ”¾åœ¨ <code>actions</code>(actor) é‡Œã€‚</p>
<p>a. HTTP è¯·æ±‚çš„é—®é¢˜å¥å­ <code>sentence</code> ä¼ è¿‡æ¥ï¼Œç”¨ <code>classifier</code> è§£æå®ƒçš„æ„å›¾å’Œå¥å­å®ä½“</p>
<p>b. ç”¨æ„å›¾å’Œå¥å­å®ä½“æ„é€  <code>action</code>ï¼Œå¹¶é“¾æ¥å›¾æ•°æ®åº“æ‰§è¡Œï¼Œè·å–ç»“æœã€‚</p>
<p>ä»£ç æ®µï¼š<code>src/siwi/bot/bot/__init__.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">siwi.bot.actions</span> <span class="kn">import</span> <span class="n">SiwiActions</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">siwi.bot.classifier</span> <span class="kn">import</span> <span class="n">SiwiClassifier</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SiwiBot</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_pool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span> <span class="o">=</span> <span class="n">SiwiClassifier</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">SiwiActions</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">connection_pool</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">intent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="c1"># &lt;--- a.</span>
</span></span><span class="line"><span class="cl">        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">intent</span><span class="p">)</span>      <span class="c1"># &lt;--- b.</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">action</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_pool</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆå’±ä»¬æ¥è¿›ä¸€æ­¥å®ç°ä¸€ä¸‹ <code>SiwiClassifier</code> å§ã€‚</p>
<h4 id="è¯­ä¹‰è§£æclassifier" class="headerLink">
    <a href="#%e8%af%ad%e4%b9%89%e8%a7%a3%e6%9e%90classifier" class="header-mark"></a>4.2.1 è¯­ä¹‰è§£æ(classifier)</h4><p><code>classifier </code> éœ€è¦åœ¨ <code>get(sentence)</code> æ–¹æ³•é‡Œå°†å¥å­ä¸­çš„å®ä½“å’Œå¥å­çš„æ„å›¾è§£æã€åˆ†ç±»å‡ºæ¥ã€‚é€šå¸¸æ¥è¯´ï¼Œè¿™é‡Œæ˜¯éœ€è¦å€ŸåŠ©æœºå™¨å­¦ä¹ ã€NLPå»åˆ†è¯ã€åˆ†ç±»å®ç°çš„ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†å±•ç¤ºè¿™ä¸ªè¿‡ç¨‹å®é™…ä¸Šåªæ˜¯å„ç§ <code>if/ else</code>ã€‚</p>
<p>æˆ‘ä»¬è¿™é‡Œå®ç°äº†ä¸‰ç±»æ„å›¾çš„é—®é¢˜ï¼š</p>
<ul>
<li>å…³ç³»ï¼ˆAï¼ŒBï¼‰ï¼šè·å¾— A å’Œ B åœ¨å›¾è°±ä¸­çš„å…³ç³»è·¯å¾„ï¼Œæ¯”å¦‚å§šæ˜å’Œæ¹–äººé˜Ÿçš„å…³ç³»æ˜¯ï¼Ÿ</li>
<li>æœå½¹æƒ…å†µï¼šæ¯”å¦‚ä¹”çº³æ£®åœ¨å“ªé‡Œæœå½¹ï¼Ÿ</li>
<li>å…³æ³¨æƒ…å†µï¼šæ¯”å¦‚é‚“è‚¯å…³æ³¨äº†è°ï¼Ÿ</li>
</ul>
<blockquote>
<p>â“ å¼€æ”¾é—®é¢˜ï¼š</p>
<p>å¦‚æœçœ‹æ•™ç¨‹çš„ä½ è§‰å¾—è¿™å‡ ä¸ªé—®é¢˜å¤ªæ²¡æ„æ€äº†ï¼Œè¿™é‡Œç•™ä¸€ä¸ªå¼€æ”¾é—®é¢˜ï¼Œä½ å¯ä»¥åœ¨ Siwi é‡Œå¸®æˆ‘ä»¬å®ç°ï¼šã€Œå…±åŒå¥½å‹ï¼ˆAï¼ŒBï¼‰è·å¾— A å’Œ B çš„ä¸€åº¦å…±åŒå¥½å‹ã€è¿™ä¸ªæ„å›¾ï¼ˆæˆ–è€…æ›´é…·çš„å…¶ä»–å¥å­ï¼‰ä¹ˆï¼Ÿæ¬¢è¿æ¥ Githubï¼šgithub.com/wey-gu/nebula-siwi/ æ PR å“¦ï¼Œçœ‹çœ‹è°å…ˆå®ç°ã€‚</p>
</blockquote>
<p>ä»£ç ç‰‡æ®µï¼š<code>src/siwi/bot/classfier/__init__.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SiwiClassifier</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Classify Sentences and Fill Slots.
</span></span></span><span class="line"><span class="cl"><span class="s2">        This should be done by NLP, here we fake one to demostrate
</span></span></span><span class="line"><span class="cl"><span class="s2">        the intent Actor --&gt; Graph DB work flow.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        sentense:
</span></span></span><span class="line"><span class="cl"><span class="s2">          relation:
</span></span></span><span class="line"><span class="cl"><span class="s2">            - What is the relationship between Yao Ming and Lakers?
</span></span></span><span class="line"><span class="cl"><span class="s2">            - How does Tracy McGrady and Lakers connected?
</span></span></span><span class="line"><span class="cl"><span class="s2">          serving:
</span></span></span><span class="line"><span class="cl"><span class="s2">            - Which team had Jonathon Simmons served?
</span></span></span><span class="line"><span class="cl"><span class="s2">          friendship:
</span></span></span><span class="line"><span class="cl"><span class="s2">            - Whom does Tim Duncan follow?
</span></span></span><span class="line"><span class="cl"><span class="s2">            - Who are Tracy McGrady&#39;s friends?
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">        {
</span></span></span><span class="line"><span class="cl"><span class="s2">            &#34;entities&#34;: entities,
</span></span></span><span class="line"><span class="cl"><span class="s2">            &#34;intents&#34;: intents
</span></span></span><span class="line"><span class="cl"><span class="s2">        }
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_matched_entities</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">intents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_matched_intents</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;entities&#34;</span><span class="p">:</span> <span class="n">entities</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;intents&#34;</span><span class="p">:</span> <span class="n">intents</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œï¼Œæˆ‘æŠŠåŒ¹é…çš„è§„åˆ™ï¼ˆç­‰ä»·äº if else&hellip;ï¼‰å†™åœ¨äº† <code>src/siwi/bot/test/data</code> ä¹‹ä¸‹çš„ YAML æ–‡ä»¶é‡Œï¼Œè¿™æ ·å¢åŠ  <code>classifier</code> ä¹‹ä¸­æ–°çš„è§„åˆ™åªéœ€è¦æ›´æ–°è¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥äº†ï¼š</p>
<h5 id="æ„å›¾è¯†åˆ«intent" class="headerLink">
    <a href="#%e6%84%8f%e5%9b%be%e8%af%86%e5%88%abintent" class="header-mark"></a>4.2.1.1 æ„å›¾è¯†åˆ«(intent)</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">load_entity_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># load data from yaml files</span>
</span></span><span class="line"><span class="cl">    <span class="n">module_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span> <span class="n">siwi</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="si">}</span><span class="s2">/bot/test/data&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#...</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span> <span class="n">module_path</span> <span class="si">}</span><span class="s2">/intents.yaml&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">intents</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="s2">&#34;intents&#34;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºæ¯ä¸€ä¸ªæ„å›¾æ¥è¯´ï¼š</p>
<ul>
<li><code>intents.&lt;åå­—&gt;</code> ä»£è¡¨åå­—</li>
<li>åå­—ä¹‹åçš„ <code>action</code> ä»£è¡¨åè¾¹åœ¨è¦å®ç°çš„ç›¸åº”çš„ <code>xxxAction</code> çš„ç±»
<ul>
<li>æ¯”å¦‚ <code>RelationshipAction</code> å°†æ˜¯ç”¨æ¥å¤„ç†æŸ¥è¯¢å…³ç³»ï¼ˆAï¼ŒBï¼‰è¿™æ ·çš„é—®é¢˜çš„ Action ç±»</li>
</ul>
</li>
<li><code>keywords</code> ä»£è¡¨åœ¨å¥å­ä¹‹ä¸­åŒ¹é…çš„å…³é”®è¯
<ul>
<li>æ¯”å¦‚é—®å¥é‡Œå‡ºç° serveï¼Œservedï¼Œserving çš„å­—çœ¼çš„æ—¶å€™ï¼Œå°†ä¼šåŒ¹é…æœå½¹çš„é—®é¢˜</li>
</ul>
</li>
</ul>
<blockquote>
<p>ğŸ’¡ï¼šå†™ if else æ¡ä»¶æ¥å¯¹åº”æ„å›¾æ˜¯ä¸å®¹æ˜“çš„ï¼Œå› ä¸ºä¸åŒæ„å›¾ä¸å¯èƒ½æ²¡æœ‰å…³é”®è¯ç›¸äº¤çš„æƒ…å†µï¼Œæˆ‘ä»¬çš„å®ç°åªæ˜¯ä¸€ä¸ªéå¸¸ç®€é™‹ã€ä¸ä¸¥è°¨çš„æ–¹å¼ã€‚åœ¨å®é™…åœºæ™¯ä¸‹ï¼Œè®­ç»ƒæ¨¡å‹å»åšåŒ¹é…æ•ˆæœä¼šæ›´å¥½ï¼Œæœ‰æ„æ€çš„æ˜¯ï¼Œé‚£äº›åšçš„æ¯”è¾ƒå¥½çš„æ¨¡å‹çš„è¾“å…¥å’Œæˆ‘ä»¬çš„ YAML çš„æ ¼å¼æ˜¯å¾ˆç±»ä¼¼çš„ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">intents</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">fallback</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">FallbackAction</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">keywords</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">relationship</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">RelationshipAction</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">keywords</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">between</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">relation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">relationship</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">related</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">connect</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">correlate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">serve</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">ServeAction</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">keywords</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">serve</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">served</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">serving</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">friend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">FollowAction</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">keywords</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">follows</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">followed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">follow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">friend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">friends</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="å®ä½“è¯†åˆ«entity" class="headerLink">
    <a href="#%e5%ae%9e%e4%bd%93%e8%af%86%e5%88%abentity" class="header-mark"></a>4.2.1.2 å®ä½“è¯†åˆ«(entity)</h5><p>ç±»ä¼¼çš„ï¼Œå®ä½“è¯†åˆ«çš„éƒ¨åˆ†æœ¬è´¨ä¸Šä¹Ÿæ˜¯ if elseï¼Œåªä¸è¿‡è¿™é‡Œåˆ©ç”¨åˆ°äº†**<a href="https://zh.wikipedia.org/wiki/AC%E8%87%AA%E5%8A%A8%E6%9C%BA%E7%AE%97%E6%B3%95" target="_blank" rel="noopener noreffer">Ahoâ€“Corasickç®—æ³•</a>**æ¥å¸®åŠ©æœç´¢å®ä½“ï¼Œåœ¨ç”Ÿäº§ï¼ˆéç©å…·ï¼‰çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥ç”¨ NLP é‡Œçš„åˆ†è¯çš„æ–¹æ³•æ¥åšã€‚</p>
<blockquote>
<p>ğŸ’¡ï¼šå¤§å®¶å¯ä»¥å»äº†è§£ä¸€ä¸‹è¿™ä¸ª <a href="https://zh.wikipedia.org/wiki/AC%E8%87%AA%E5%8A%A8%E6%9C%BA%E7%AE%97%E6%B3%95" target="_blank" rel="noopener noreffer">ACè‡ªåŠ¨æœºç®—æ³•</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">setup_entity_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">entity_type_map</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="n">key</span><span class="p">:</span> <span class="s2">&#34;player&#34;</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">entity_type_map</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="n">key</span><span class="p">:</span> <span class="s2">&#34;team&#34;</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">entity_tree</span> <span class="o">=</span> <span class="n">ahocorasick</span><span class="o">.</span><span class="n">Automaton</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity_type_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">entity_tree</span><span class="o">.</span><span class="n">add_word</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">entity</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">entity_tree</span><span class="o">.</span><span class="n">make_automaton</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_matched_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Consume a sentence to be matched with ahocorasick
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns a dict: {entity: entity_type}
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">_matched</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_tree</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="n">sentence</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">entities_matched</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">entity</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_type_map</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">_matched</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ <code>SiwiClassifier.get(sentence)</code> å·²ç»èƒ½è¿”å›è§£æã€åˆ†ç±»å‡ºæ¥çš„æ„å›¾å’Œå®ä½“äº†ï¼Œè¿™æ—¶å€™ï¼Œå®ƒä»¬ä¼šè¢«ä¼ ç»™ Actions æ¥è®© siwi bot çŸ¥é“å¦‚ä½•å»æ‰§è¡ŒçŸ¥è¯†å›¾è°±çš„æŸ¥è¯¢å•¦ï¼</p>
<h4 id="æ„é€ å›¾è°±æŸ¥è¯¢action" class="headerLink">
    <a href="#%e6%9e%84%e9%80%a0%e5%9b%be%e8%b0%b1%e6%9f%a5%e8%af%a2action" class="header-mark"></a>4.2.2 æ„é€ å›¾è°±æŸ¥è¯¢(action)</h4><p>è¿˜è®°å¾—å‰è¾¹çš„ bot ä»£ç é‡Œï¼Œæœ€åä¸€æ­¥ï¼Œå›¾è°±æŸ¥è¯¢çš„åŠ¨ä½œæ˜¯è¿™ä¹ˆè¢«æ„é€ çš„ï¼š</p>
<p><code>action = self.actions.get(intent)</code></p>
<p>ç°åœ¨å’±ä»¬å°±æŠŠå®ƒå®ç°ä¸€ä¸‹ï¼š</p>
<ol>
<li>
<p>åœ¨å‰è¾¹æåˆ°è¿‡çš„ <code>intents.yaml</code> é‡Œè·å–è¿™ä¸ªæ„å›¾é‡Œé…ç½®çš„æ„å›¾çš„ç±»åç§°</p>
</li>
<li>
<p>å¯¼å…¥ç›¸åº”çš„ Action ç±»</p>
</li>
</ol>
<p>ä»£ç æ®µï¼š<code>src/bot/actions/__init__.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SiwiActions</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">intent_map</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># load data from yaml files</span>
</span></span><span class="line"><span class="cl">        <span class="n">module_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span> <span class="n">siwi</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="si">}</span><span class="s2">/bot/test/data&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span> <span class="n">module_path</span> <span class="si">}</span><span class="s2">/intents.yaml&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">intent_map</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="s2">&#34;intents&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intent</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        returns SiwiActionBase
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intent</span><span class="p">[</span><span class="s2">&#34;intents&#34;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">intent_name</span> <span class="o">=</span> <span class="n">intent</span><span class="p">[</span><span class="s2">&#34;intents&#34;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">intent_name</span> <span class="o">=</span> <span class="s2">&#34;fallback&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intent_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">intent_name</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;action&#34;</span><span class="p">)</span> <span class="c1">#-------&gt; 1.</span>
</span></span><span class="line"><span class="cl">        <span class="n">action_cls</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>          <span class="c1">#-------&gt; 2.</span>
</span></span><span class="line"><span class="cl">            <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&#34;siwi.bot.actions&#34;</span><span class="p">),</span> <span class="n">cls_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">action</span> <span class="o">=</span> <span class="n">action_cls</span><span class="p">(</span><span class="n">intent</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">action</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œæˆ‘ä»¬æ¥å®ç°å…¶ä¸­ä¸€ä¸ª<code>Action</code> ç±»ï¼Œæ¯”å¦‚ <code>RelationshipAction</code> å¯¹åº”çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ ¹æ®æä¾›çš„ A å’Œ Bï¼Œæ„é€ å¹¶æ‰§è¡Œå›¾æ•°æ®åº“ä¹‹ä¸­çš„ <code>FIND PATH</code></li>
<li>å°† <code>FIND PATH</code> çš„ç»“æœè¿›è¡Œè§£æï¼Œé€šè¿‡ <code>as_path()</code> æ–¹æ³•çš„å°è£…ï¼Œè·å¾— path ç±»å‹çš„æ•°æ®ï¼Œå¹¶å¤„ç†ä¸€ä¸ªå¥å­è¿”å›ç»™ç”¨æˆ·</li>
</ol>
<blockquote>
<p>ğŸ’¡ï¼šFIND PATH å°±æ˜¯å­—é¢æ„æ€çš„æŸ¥æ‰¾è·¯å¾„ï¼Œ<a href="https://docs.nebula-graph.com.cn/2.6.1/3.ngql-guide/16.subgraph-and-path/2.find-path/" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a>æœ‰è¯¦ç»†çš„è§£é‡Šå“¦ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RelationshipAction</span><span class="p">(</span><span class="n">SiwiActionBase</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    USE basketballplayer;
</span></span></span><span class="line"><span class="cl"><span class="s2">    FIND NOLOOP PATH
</span></span></span><span class="line"><span class="cl"><span class="s2">    FROM &#34;player100&#34; TO &#34;team204&#34; OVER * BIDIRECT UPTO 4 STEPS;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intent</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[DEBUG] RelationshipAction intent: </span><span class="si">{</span> <span class="n">intent</span> <span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">intent</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">entity_left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_right</span> <span class="o">=</span> <span class="n">intent</span><span class="p">[</span><span class="s2">&#34;entities&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">left_vid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity_left</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">right_vid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity_right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s2">&#34;[WARN] RelationshipAction entities recognition Failure &#34;</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s2">&#34;will fallback to FallbackAction, &#34;</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s2">&#34;intent: </span><span class="si">{</span> <span class="n">intent</span> <span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_pool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_error_check</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="sa">f</span><span class="s1">&#39;USE basketballplayer;&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="sa">f</span><span class="s1">&#39;FIND NOLOOP PATH &#39;</span>
</span></span><span class="line"><span class="cl">            <span class="sa">f</span><span class="s1">&#39;FROM &#34;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">left_vid</span><span class="si">}</span><span class="s1">&#34; TO &#34;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">right_vid</span><span class="si">}</span><span class="s1">&#34; &#39;</span>
</span></span><span class="line"><span class="cl">            <span class="sa">f</span><span class="s1">&#39;OVER * BIDIRECT UPTO 4 STEPS;&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="sa">f</span><span class="s2">&#34;[DEBUG] query for RelationshipAction :</span><span class="se">\n\t</span><span class="si">{</span> <span class="n">query</span> <span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">session_context</span><span class="p">(</span><span class="s2">&#34;root&#34;</span><span class="p">,</span> <span class="s2">&#34;nebula&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>        <span class="c1">#--------------------&gt; 1.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">is_succeeded</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s2">&#34;Something is wrong on Graph Database connection when query &#34;</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span> <span class="n">query</span> <span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s2">&#34;There is no relationship between &#34;</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_left</span> <span class="si">}</span><span class="s2"> and </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_right</span> <span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">path</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">row_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_path</span><span class="p">()</span>    <span class="c1">#-------------------&gt; 2.</span>
</span></span><span class="line"><span class="cl">        <span class="n">relationships</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">relationships</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">relations_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">relationships</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_vertex_id</span><span class="p">()</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">rel_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">length</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">            <span class="n">rel</span> <span class="o">=</span> <span class="n">relationships</span><span class="p">[</span><span class="n">rel_index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">relations_str</span> <span class="o">+=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s2">&#34; </span><span class="si">{</span> <span class="n">rel</span><span class="o">.</span><span class="n">edge_name</span><span class="p">()</span> <span class="si">}</span><span class="s2">s &#34;</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">end_vertex_id</span><span class="p">()</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span> <span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="sa">f</span><span class="s2">&#34;There are at least </span><span class="si">{</span> <span class="n">result</span><span class="o">.</span><span class="n">row_size</span><span class="p">()</span> <span class="si">}</span><span class="s2"> relations between &#34;</span>
</span></span><span class="line"><span class="cl">            <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_left</span> <span class="si">}</span><span class="s2"> and </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_right</span> <span class="si">}</span><span class="s2">, &#34;</span>
</span></span><span class="line"><span class="cl">            <span class="sa">f</span><span class="s2">&#34;one relation path is: </span><span class="si">{</span> <span class="n">relations_str</span> <span class="si">}</span><span class="s2">.&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è‡³æ­¤ï¼Œå’±ä»¬å°±å·²ç»å®ç°äº†åç«¯çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå¯åŠ¨èµ·æ¥è¯•è¯•äº†ï¼</p>
<h3 id="æµ‹è¯•ä¸€ä¸‹" class="headerLink">
    <a href="#%e6%b5%8b%e8%af%95%e4%b8%80%e4%b8%8b" class="header-mark"></a>4.3 æµ‹è¯•ä¸€ä¸‹</h3><h4 id="å¯åŠ¨å›¾æ•°æ®åº“" class="headerLink">
    <a href="#%e5%90%af%e5%8a%a8%e5%9b%be%e6%95%b0%e6%8d%ae%e5%ba%93" class="header-mark"></a>4.3.1 å¯åŠ¨å›¾æ•°æ®åº“</h4><p>æˆ‘ä»¬åœ¨ Nebula Graph é‡Œå»ºç«‹ï¼ˆå¯¼å…¥æ•°æ®ï¼‰ä¸€ä¸ªç¯®çƒçš„çŸ¥è¯†å›¾è°±ã€‚</p>
<blockquote>
<p>ğŸ’¡ï¼šåœ¨å¯¼å…¥æ•°æ®ä¹‹å‰ï¼Œè¯·å…ˆéƒ¨ç½²ä¸€ä¸ª Nebula Graph é›†ç¾¤ã€‚æœ€ç®€ä¾¿çš„éƒ¨ç½²æ–¹å¼æ˜¯ä½¿ç”¨ Nebula-UP è¿™ä¸ªå°å·¥å…·ï¼Œåªéœ€è¦ä¸€è¡Œå‘½ä»¤å°±èƒ½åœ¨ Linux æœºå™¨ä¸ŠåŒæ—¶å¯åŠ¨ä¸€ä¸ª Nebula Graph æ ¸å¿ƒå’Œå¯è§†åŒ–å›¾æ¢ç´¢å·¥å…· <a href="https://docs.nebula-graph.com.cn/2.6.1/nebula-studio/about-studio/st-ug-what-is-graph-studio/" target="_blank" rel="noopener noreffer">Nebula Graph Studio</a>ã€‚å¦‚æœä½ æ›´æ„¿æ„ç”¨ Docker éƒ¨ç½²ï¼Œè¯·å‚è€ƒ<a href="https://docs.nebula-graph.com.cn/2.6.1/4.deployment-and-installation/2.compile-and-install-nebula-graph/3.deploy-nebula-graph-with-docker-compose/" target="_blank" rel="noopener noreffer">è¿™ä¸ªæ–‡æ¡£</a>ã€‚</p>
</blockquote>
<p>æœ¬æ–‡å‡è®¾æˆ‘ä»¬ä½¿ç”¨ <a href="https://siwei.io/nebula-up/" target="_blank" rel="noopener noreffer">Nebula-UP</a> æ¥éƒ¨ç½²ä¸€ä¸ª Nebula Graphï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -fsSL nebula-up.siwei.io/install.sh <span class="p">|</span> bash
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹‹åï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¿™æ ·çš„æç¤ºï¼š</p>
<p></p>
<p>æŒ‰ç…§æç¤ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå‘½ä»¤è¿›å…¥åˆ°æœ‰ Nebula Console çš„å®¹å™¨é‡Œï¼š</p>
<blockquote>
<p>ğŸ’¡ï¼š<a href="https://github.com/vesoft-inc/nebula-console" target="_blank" rel="noopener noreffer">Nebula Console</a> æ˜¯å‘½ä»¤è¡Œè®¿é—® Nebula Graph å›¾æ•°æ®åº“çš„å®¢æˆ·ç«¯ï¼Œæ”¯æŒ Linuxï¼ŒWindows å’Œ macOSï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://github.com/vesoft-inc/nebula-console/releases" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">~/.nebula-up/console.sh
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œåœ¨ <code>#</code> çš„æç¤ºç¬¦ä¸‹å°±è¡¨ç¤ºæˆ‘ä»¬è¿›æ¥äº†ï¼Œæˆ‘ä»¬åœ¨é‡Œè¾¹å¯ä»¥æ‰§è¡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">nebula-console -addr graphd -port 9669 -user root -p nebula
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å°±è¡¨ç¤ºæˆ‘ä»¬è¿æ¥ä¸Šäº† Nebula Graph å›¾æ•°æ®åº“ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">/</span><span class="w"> </span><span class="c1"># nebula-console -addr graphd -port 9669 -user root -p nebula
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Welcome</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">Nebula</span><span class="w"> </span><span class="n">Graph</span><span class="o">!</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[(</span><span class="n">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ nGQL å»æ“ä½œ Nebula Graphï¼Œä¸è¿‡æˆ‘ä»¬å…ˆé€€å‡ºæ¥ï¼Œæ‰§è¡Œ <code>exit</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[(</span><span class="n">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">exit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Bye</span><span class="w"> </span><span class="n">root</span><span class="o">!</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Fri</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="kt">Dec</span><span class="w"> </span><span class="mi">2021</span><span class="w"> </span><span class="mi">04</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">28</span><span class="w"> </span><span class="n">UTC</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬åœ¨è¿™ä¸ªå®¹å™¨å†…æŠŠåŸºäº nGQL è¯­å¥çš„æ•°æ®ä¸‹è½½ä¸‹æ¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/ <span class="c1"># wget https://docs.nebula-graph.io/2.0/basketballplayer-2.X.ngql</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åé€šè¿‡ Nebula Console çš„ <code>-f &lt;file_path&gt;</code> æŠŠæ•°æ®å¯¼å…¥è¿›å»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nebula-console -addr graphd -port <span class="m">9669</span> -user root -p nebula -f basketballplayer-2.X.ngql
</span></span></code></pre></td></tr></table>
</div>
</div><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¯åŠ¨äº†ä¸€ä¸ª Nebula Graph å›¾æ•°æ®åº“ï¼Œè¿˜åœ¨é‡Œè¾¹åŠ è½½äº†ç¯®çƒçš„çŸ¥è¯†å›¾è°±ï¼</p>
<blockquote>
<p>ğŸ’¡ï¼šè¿˜è®°å¾—å‰è¾¹æˆ‘ä»¬æåˆ°çš„ <a href="https://nebula-graph.com.cn/demo/" target="_blank" rel="noopener noreffer">åœ¨çº¿ä½“éªŒ</a> ç¯å¢ƒä¹ˆï¼Ÿç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªåˆ©ç”¨ Nebula-UP éƒ¨ç½²äº† Nebula çš„ç¯å¢ƒé‡Œå¯åŠ¨è‡ªå·±çš„ Nebula Studio å•¦ï¼ŒæŒ‰ç…§ä¸Šè¾¹ Nebula-UP çš„æç¤ºï¼šhttp://&lt;æœ¬æœºIP&gt;:7001 å°±æ˜¯å®ƒçš„åœ°å€ï¼Œç„¶åå¤§å®¶å¯ä»¥å‚è€ƒ<a href="https://docs.nebula-graph.com.cn/2.6.1/nebula-studio/deploy-connect/st-ug-connect/" target="_blank" rel="noopener noreffer">æ–‡æ¡£</a>å’Œ<a href="https://www.bilibili.com/video/BV1hq4y1177e" target="_blank" rel="noopener noreffer">åœ¨çº¿ä½“éªŒä»‹ç»</a>å»äº†è§£æ›´å¤šã€‚</p>
<p></p>
</blockquote>
<h4 id="å¯åŠ¨-siwi-backend" class="headerLink">
    <a href="#%e5%90%af%e5%8a%a8-siwi-backend" class="header-mark"></a>4.3.2 å¯åŠ¨ Siwi-backend</h4><p>å¤§å®¶å¯ä»¥ç›´æ¥ clone æˆ‘çš„ä»£ç ï¼š<code>git clone https://github.com/wey-gu/nebula-siwi/</code></p>
<p>ç„¶åå®‰è£…ã€å¯åŠ¨ Siwi Backendï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> nebula-siwi
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Install dependencies</span>
</span></span><span class="line"><span class="cl">python3 -m pip install -r src/requirements.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Install siwi backend</span>
</span></span><span class="line"><span class="cl">python3 -m build
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Configure Nebula Graph Endpoint</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">NG_ENDPOINTS</span><span class="o">=</span>127.0.0.1:9669
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Run Backend API server</span>
</span></span><span class="line"><span class="cl">gunicorn --bind :5000 wsgi --workers <span class="m">1</span> --threads <span class="m">1</span> --timeout <span class="m">60</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯åŠ¨ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¦å¤–å¼€çª—å£ï¼Œé€šè¿‡ cURL å»å‘èµ·é—®é¢˜ç»™ backendï¼Œæ›´å¤šç»†èŠ‚å¤§å®¶å¯ä»¥å‚è€ƒ GitHub ä¸Šçš„ READMEï¼š</p>
<p><a href="https://github.com/wey-gu/nebula-siwi/blob/main/images/backend-demo.webp" target="_blank" rel="noopener noreffer"></a></p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å†™å¥½äº† QA ç³»ç»Ÿçš„é‡è¦çš„ä»£ç å•¦ï¼Œå¤§å®¶æ˜¯ä¸æ˜¯å¯¹ä¸€ä¸ª KBQA çš„æ„æˆæœ‰äº†æ›´æ¸…æ™°çš„æ¦‚å¿µäº†å‘¢ï¼Ÿ</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºå®ƒå¢åŠ ä¸€ä¸ªç•Œé¢ï¼</p>
<h2 id="siwi-frontend" class="headerLink">
    <a href="#siwi-frontend" class="header-mark"></a>5 Siwi-frontend</h2><h3 id="èŠå¤©ç•Œé¢" class="headerLink">
    <a href="#%e8%81%8a%e5%a4%a9%e7%95%8c%e9%9d%a2" class="header-mark"></a>5.1 èŠå¤©ç•Œé¢</h3><p>æˆ‘ä»¬åˆ©ç”¨ <a href="https://github.com/juzser/vue-bot-ui" target="_blank" rel="noopener noreffer">Vue Bot UI</a> è¿™ä¸ªå¯çˆ±çš„æœºå™¨äººç•Œé¢çš„ Vue å®ç°å¯ä»¥å¾ˆå®¹æ˜“æ„é€ ä¸€ä¸ª</p>
<p>ä»£ç æ®µï¼š<code>src/siwi/frontend/src/App.vue</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">VueBotUI</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:messages</span><span class="s">=&#34;msg&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:options</span><span class="s">=&#34;botOptions&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:bot-typing</span><span class="s">=&#34;locking&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:input-disable</span><span class="s">=&#34;locking&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">@msg-send</span><span class="s">=&#34;msgSender&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">VueBotUI</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-bot-ui&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://github.com/wey-gu/nebula-siwi/blob/main/src/siwi_frontend/images/demo.webp" target="_blank" rel="noopener noreffer"></a></p>
<p>æ³¨æ„åˆ°é‚£ä¸ªå°é£æœºæŒ‰é’®äº†å§ï¼Œå®ƒæ˜¯å‘å‡ºé—®é¢˜è¯·æ±‚çš„æŒ‰é”®ï¼Œæˆ‘ä»¬è¦åœ¨æŒ‰ä¸‹å®ƒçš„æ—¶å€™å¯¹åç«¯åšå‡ºè¯·æ±‚ã€‚</p>
<h3 id="è®¿é—®åç«¯" class="headerLink">
    <a href="#%e8%ae%bf%e9%97%ae%e5%90%8e%e7%ab%af" class="header-mark"></a>5.2 è®¿é—®åç«¯</h3><p>è¿™éƒ¨åˆ†ç”¨åˆ°äº†<a href="https://github.com/axios/axios" target="_blank" rel="noopener noreffer">Axios</a>ï¼Œå®ƒæ˜¯æµè§ˆå™¨é‡Œè®¿é—®å…¶ä»–åœ°å€çš„ HTTP å®¢æˆ·ç«¯ã€‚</p>
<ol>
<li>åœ¨æŒ‰ä¸‹çš„æ—¶å€™ï¼Œ<code>@msg-send=&quot;msgSender&quot;</code> ä¼šè§¦å‘ <code>msgSender()</code></li>
<li><code> msgSender()</code>å»æ„é€ <code>axios.post(this.apiEndpoint, { &quot;question&quot;: data.text })</code> çš„è¯·æ±‚ç»™ Siwi çš„åç«¯</li>
<li>åç«¯çš„ç»“æœè¢« <code>push()</code> åˆ°ç•Œé¢çš„èŠå¤©æ¶ˆæ¯é‡Œï¼Œæ¸²æŸ“å‡ºæ¥ <code>this.msg.push()</code></li>
</ol>
<p>ä»£ç æ®µï¼š<code>src/siwi/frontend/src/App.vue</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="p">&lt;</span><span class="nt">VueBotUI</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:messages</span><span class="s">=&#34;msg&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:options</span><span class="s">=&#34;botOptions&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:bot-typing</span><span class="s">=&#34;locking&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:input-disable</span><span class="s">=&#34;locking&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">@msg-send</span><span class="s">=&#34;msgSender&#34;</span>         <span class="err">----------------</span> <span class="na">1.</span>
</span></span><span class="line"><span class="cl">    <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">VueBotUI</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-bot-ui&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s2">&#34;axios&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;App&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">VueBotUI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">msgSender</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">agent</span><span class="o">:</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;text&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">text</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">locking</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">apiEndpoint</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&#34;question&#34;</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">text</span> <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>   <span class="o">-----------------</span> <span class="mf">2.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">msg</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>          <span class="o">-----------------</span> <span class="mf">3.</span>
</span></span><span class="line"><span class="cl">          <span class="nx">agent</span><span class="o">:</span> <span class="s2">&#34;bot&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;text&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">text</span><span class="o">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">answer</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">synthText</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">answer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">agentSpeak</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">locking</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªå›¾å½¢ç•Œé¢çš„æœºå™¨äººå•¦ï¼Œä¸è¿‡ï¼Œæ›´è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç°ä»£æµè§ˆå™¨çš„æ¥å£ï¼Œå®ç°è¯­éŸ³è¯†åˆ«å’Œæœºå™¨äººè¯´è¯ï¼</p>
<h3 id="è¯­éŸ³è¯†åˆ«" class="headerLink">
    <a href="#%e8%af%ad%e9%9f%b3%e8%af%86%e5%88%ab" class="header-mark"></a>5.3 è¯­éŸ³è¯†åˆ«</h3><p>æˆ‘ä»¬å€ŸåŠ©äº <a href="https://github.com/Drackokacka/vue-web-speech" target="_blank" rel="noopener noreffer">Vue Web Speech</a>, è¿™ä¸ªè¯­éŸ³ API çš„ VueJS çš„ç»‘å®šï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ¨æŒ‰ä¸‹ ğŸ™ï¸ çš„æ—¶å€™æ¥æ”¶äººçš„è¯­éŸ³ï¼Œå¹¶æŠŠè¯­éŸ³è½¬æ¢æˆæ–‡å­—å‘å‡ºå»ï¼Œåœ¨å›ç­”è¢«è¿”å›ä¹‹åï¼Œå®ƒï¼ˆè¿˜æ˜¯ä»–/å¥¹ğŸ˜ï¼Ÿï¼‰ä¹Ÿä¼šæŠŠå›ç­”çš„å¥å­è¯»å‡ºæ¥ç»™ç”¨æˆ·ã€‚</p>
<ol>
<li><code>record</code> åœ¨ <code>ğŸ™ï¸</code> è¢«æŒ‰ä¸‹ä¹‹åï¼Œå˜æˆ <code>ğŸ‘‚</code></li>
<li>è§¦å‘ <code>onResults()</code> ç›‘å¬</li>
<li>æŠŠè¿”å›ç»“æœå‘ç»™ <code>this.synthText</code> åˆæˆå™¨ï¼Œå‡†å¤‡è¯»å‡º</li>
<li><code>&lt;vue-web-speech-synth&gt;</code> æŠŠè¯­éŸ³è¯»å‡º</li>
</ol>
<p>ä»£ç æ®µï¼š<code>src/siwi/frontend/src/App.vue</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;mic_btn&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;record = !record&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{{</span><span class="nx">record</span><span class="o">?</span><span class="s1">&#39;ğŸ‘‚&#39;</span><span class="o">:</span><span class="s1">&#39;ğŸ™ï¸&#39;</span><span class="p">}}</span>      <span class="o">--------------------------&gt;</span> <span class="mf">1.</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">vue-web-speech</span>
</span></span><span class="line"><span class="cl">      <span class="na">v</span><span class="nt">-model</span><span class="err">=&#34;</span><span class="na">record</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">@results</span><span class="s">=&#34;onResults&#34;</span>       <span class="err">--------------------------</span><span class="p">&gt;</span> <span class="mf">1.</span>
</span></span><span class="line"><span class="cl">      <span class="err">@</span><span class="nx">unrecognized</span><span class="o">=</span><span class="s2">&#34;unrecognized&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/vue-web-speech&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">vue-web-speech-synth</span>
</span></span><span class="line"><span class="cl">      <span class="na">v</span><span class="nt">-model</span><span class="err">=&#34;</span><span class="na">agentSpeak</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:voice</span><span class="s">=&#34;synthVoice&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:text</span><span class="s">=&#34;synthText&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">@list-voices</span><span class="s">=&#34;listVoices&#34;</span>  <span class="err">--------------------------</span><span class="p">&gt;</span> <span class="mf">4.</span>
</span></span><span class="line"><span class="cl">    <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">VueBotUI</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-bot-ui&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s2">&#34;axios&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;App&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">VueBotUI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">onResults</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>             <span class="o">-------------------------&gt;</span> <span class="mf">2.</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">results</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">locking</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">agent</span><span class="o">:</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;text&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">text</span><span class="o">:</span> <span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">locking</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">apiEndpoint</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&#34;question&#34;</span><span class="o">:</span> <span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">msg</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">          <span class="nx">agent</span><span class="o">:</span> <span class="s2">&#34;bot&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;text&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">text</span><span class="o">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">answer</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">synthText</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">answer</span><span class="p">;</span>  <span class="o">----------&gt;</span> <span class="mf">3.</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">agentSpeak</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">locking</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ€»ç»“" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93" class="header-mark"></a>6 æ€»ç»“</h2><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¼šäº†æ­å»ºè‡ªå·±çš„ç¬¬ä¸€ä¸ª KBQAï¼šçŸ¥è¯†å›¾è°±é©±åŠ¨çš„é—®ç­”ç³»ç»Ÿã€‚</p>
<p>å›é¡¾ä¸‹å®ƒçš„ä»£ç ç»“æ„ï¼š</p>
<ul>
<li><code>src/siwi</code> å¯¹åº”åç«¯
<ul>
<li>App æ˜¯ Flask API å¤„ç†çš„éƒ¨åˆ†</li>
<li>Bot æ˜¯å¤„ç†è¯·æ±‚ã€è®¿é—® Nebula Graph çš„éƒ¨åˆ†</li>
</ul>
</li>
<li><code>src/siwi_frontend</code> æ˜¯å‰ç«¯</li>
</ul>
<p>å¸Œæœ›å¤§å®¶åœ¨è¿™ä¸ªç®€é™‹çš„åŸºç¡€ä¹‹ä¸Šï¼Œå¤šå¤šæ¢ç´¢ï¼Œåšå‡ºæ¥æ›´åŠ æˆç†Ÿçš„èŠå¤©æœºå™¨äººï¼Œæ¬¢è¿ä½ æ¥ç»™æˆ‘é‚®ä»¶ã€ç•™è¨€å‘Šè¯‰æˆ‘å‘€ï¼Œè¿™é‡Œï¼šhttps://siwei.io/about æœ‰æˆ‘çš„è”ç³»æ–¹å¼ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">â”œâ”€â”€ README.md
</span></span><span class="line"><span class="cl">â”œâ”€â”€ src
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ siwi                        <span class="c1"># Siwi-API Backend</span>
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ app                     <span class="c1"># Web Server, take HTTP requests and calls Bot API</span>
</span></span><span class="line"><span class="cl">â”‚   â”‚   â””â”€â”€ bot                     <span class="c1"># Bot API</span>
</span></span><span class="line"><span class="cl">â”‚   â”‚       â”œâ”€â”€ actions             <span class="c1"># Take Intent, Slots, Query Knowledge Graph here</span>
</span></span><span class="line"><span class="cl">â”‚   â”‚       â”œâ”€â”€ bot                 <span class="c1"># Entrypoint of the Bot API</span>
</span></span><span class="line"><span class="cl">â”‚   â”‚       â”œâ”€â”€ classifier          <span class="c1"># Symentic Parsing, Intent Matching, Slot Filling</span>
</span></span><span class="line"><span class="cl">â”‚   â”‚       â””â”€â”€ <span class="nb">test</span>                <span class="c1"># Example Data Source as equivalent/mocked module</span>
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ siwi_frontend               <span class="c1"># Browser End</span>
</span></span><span class="line"><span class="cl">â”‚       â”œâ”€â”€ README.md
</span></span><span class="line"><span class="cl">â”‚       â”œâ”€â”€ package.json
</span></span><span class="line"><span class="cl">â”‚       â””â”€â”€ src
</span></span><span class="line"><span class="cl">â”‚           â”œâ”€â”€ App.vue             <span class="c1"># Listening to user and pass Questions to Siwi-API</span>
</span></span><span class="line"><span class="cl">â”‚           â””â”€â”€ main.js
</span></span><span class="line"><span class="cl">â””â”€â”€ wsgi.py
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœä½ å¾ˆå–œæ¬¢è¿™æ ·çš„å°é¡¹ç›®ï¼Œæ¬¢è¿æ¥çœ‹çœ‹æˆ‘ä¹‹å‰çš„åˆ†äº«ï¼š ã€Œ<a href="https://siwei.io/corp-rel-graph/" target="_blank" rel="noopener noreffer">ä»0-1ï¼šå¦‚ä½•æ„å»ºä¸€ä¸ªä¼ä¸šè‚¡æƒå›¾è°±ç³»ç»Ÿï¼Ÿ</a>ã€å“¦ã€‚</p>
<blockquote>
<p>ğŸ’¡ï¼šä½ çŸ¥é“å—ï¼Œæˆ‘å…¶å®å€ŸåŠ©äº Katacoda å·²ç»ä¸ºå¤§å®¶æ­å»ºäº†ä¸€ä¸ªäº¤äº’å¼ä½“éªŒ Siwi + Nebula çš„éƒ¨ç½²çš„ç¯å¢ƒï¼Œå¦‚æœæ‚¨çš„ç½‘ç»œæ¡ä»¶å¤Ÿå¿«ï¼ˆKatacodaæœåŠ¡å™¨åœ¨å›½å¤–ï¼‰ï¼Œå¯ä»¥åœ¨<a href="https://siwei.io/learn/nebula-101-siwi-kgqa/" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a>ç‚¹ç‚¹é¼ æ ‡å°±äº¤äº’å¼ä½“éªŒå®ƒã€‚</p>
<p>è§†é¢‘ä»‹ç»</p>
<iframe src="//player.bilibili.com/player.html?aid=421964672&bvid=BV1Rm4y1Q7B5&cid=448090671&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>
</blockquote>
<h2 id="æ„Ÿè°¢ç”¨åˆ°çš„å¼€æºé¡¹ç›®-" class="headerLink">
    <a href="#%e6%84%9f%e8%b0%a2%e7%94%a8%e5%88%b0%e7%9a%84%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae-" class="header-mark"></a>7 æ„Ÿè°¢ç”¨åˆ°çš„å¼€æºé¡¹ç›® â¤ï¸</h2><p>è¿™ä¸ªå°é¡¹ç›®é‡Œæˆ‘ä»¬ç”¨åˆ°äº†å¥½å¤šå¼€æºçš„é¡¹ç›®ï¼Œéå¸¸æ„Ÿè°¢è¿™äº›è´¡çŒ®è€…ä»¬çš„æ…·æ…¨ä¸æ— ç§ï¼Œå¼€æºæ˜¯ä¸æ˜¯å¾ˆé…·å‘¢ï¼Ÿ</p>
<h3 id="backend" class="headerLink">
    <a href="#backend" class="header-mark"></a>7.1 Backend</h3><ul>
<li><a href="https://github.com/liuhuanyong/QASystemOnMedicalKG" target="_blank" rel="noopener noreffer">KGQA on MedicalKG</a> by <a href="https://liuhuanyong.github.io/" target="_blank" rel="noopener noreffer">Huanyong Liu</a></li>
<li><a href="https://github.com/pallets/flask" target="_blank" rel="noopener noreffer">Flask</a></li>
<li><a href="https://github.com/WojciechMula/pyahocorasick" target="_blank" rel="noopener noreffer">pyahocorasick</a> created by <a href="http://0x80.pl/" target="_blank" rel="noopener noreffer">Wojciech MuÅ‚a</a></li>
<li><a href="https://pyyaml.org/" target="_blank" rel="noopener noreffer">PyYaml</a></li>
</ul>
<h3 id="frontend" class="headerLink">
    <a href="#frontend" class="header-mark"></a>7.2 Frontend</h3><ul>
<li><a href="https://vuejs.org/" target="_blank" rel="noopener noreffer">VueJS</a> for frontend framework</li>
<li><a href="https://github.com/juzser/vue-bot-ui" target="_blank" rel="noopener noreffer">Vue Bot UI</a>, as a lovely bot UI in vue</li>
<li><a href="https://github.com/Drackokacka/vue-web-speech" target="_blank" rel="noopener noreffer">Vue Web Speech</a>, for speech API vue wrapper</li>
<li><a href="https://github.com/axios/axios" target="_blank" rel="noopener noreffer">Axios</a> for browser http client</li>
<li><a href="https://en.wikipedia.org/wiki/Solarized_%28color_scheme%29" target="_blank" rel="noopener noreffer">Solarized</a> for color scheme</li>
<li><a href="https://github.com/alvarosaburido/vitesome" target="_blank" rel="noopener noreffer">Vitesome</a> for landing page design</li>
</ul>
<h3 id="graph-database" class="headerLink">
    <a href="#graph-database" class="header-mark"></a>7.3 Graph Database</h3><ul>
<li><a href="https://github.com/vesoft-inc/nebula/" target="_blank" rel="noopener noreffer">Nebula Graph</a> é«˜æ€§èƒ½ã€äº‘åŸç”Ÿçš„å¼€æºåˆ†å¸ƒå¼å›¾æ•°æ®åº“</li>
</ul>]]></description>
</item><item>
    <title>å¿«é€Ÿæ­å»ºè°ƒè¯• Nebula Graph Python Storage å®¢æˆ·ç«¯çš„ç¯å¢ƒ</title>
    <link>https://siwei.io/nebula-python-storage-docker-guide/</link>
    <pubDate>Fri, 10 Dec 2021 16:03:07 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/nebula-python-storage-docker-guide/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>Python Storage Client è¿ä¸ä¸Šç¬¬ä¸€æ¬¡å®‰è£…çš„ Nebula Graphï¼Ÿ Docker éƒ¨ç½²æƒ…å†µä¸‹ä½¿ç”¨ Python Storage Client æŒ‡å—</p>
</blockquote>
<h2 id="å‰ç½®æ¡ä»¶" class="headerLink">
    <a href="#%e5%89%8d%e7%bd%ae%e6%9d%a1%e4%bb%b6" class="header-mark"></a>1 å‰ç½®æ¡ä»¶</h2><blockquote>
<p>æ³¨æ„ï¼šä¸€ä¸ªé‡è¦çš„å‰ç½®æ¡ä»¶æ˜¯æˆ‘ä»¬çœŸçš„éœ€è¦ Storage Clientï¼Œå¦‚æœæˆ‘ä»¬åªéœ€è¦åœ¨ Python Client é‡Œé€šè¿‡ nGQL æ¥è¯·æ±‚æ•°æ®ï¼Œé‚£ä¹ˆ GraphClient æ‰æ˜¯ä½ éœ€è¦çš„ï¼Œå¯ä»¥è·³è¿‡æœ¬æ–‡ã€‚</p>
</blockquote>
<p>å¯¹äºåˆšæ¥è§¦ Nebula çš„åŒå­¦ï¼Œéƒ¨ç½²é›†ç¾¤æœ€å¿«é€Ÿçš„æ–¹å¼æ˜¯ç”¨ Docker Composeï¼Œå®‰è£…éƒ¨ç½²å¯ä»¥å‚è€ƒæ–‡æ¡£ï¼š<a href="https://docs.nebula-graph.com.cn/2.6.1/4.deployment-and-installation/2.compile-and-install-nebula-graph/3.deploy-nebula-graph-with-docker-compose/" target="_blank" rel="noopener noreffer">deploy-nebula-graph-with-docker-compose</a>ã€‚</p>
<p>åœ¨ <code>docker compose up -d</code> ä¹‹åï¼Œæˆ‘ä»¬çš„ nebula é›†ç¾¤å°±èµ·æ¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>docker ps</code> çœ‹çœ‹è¿è¡Œç€çš„å®¹å™¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">â¯ docker ps --format <span class="s2">&#34;table {{.Names}}\t{{.Ports}}&#34;</span>
</span></span><span class="line"><span class="cl">NAMES                               PORTS
</span></span><span class="line"><span class="cl">nebula-docker-compose-graphd1-1     0.0.0.0:61852-&gt;9669/tcp, 0.0.0.0:61850-&gt;19669/tcp, 0.0.0.0:61851-&gt;19670/tcp
</span></span><span class="line"><span class="cl">nebula-docker-compose-graphd-1      0.0.0.0:9669-&gt;9669/tcp, 0.0.0.0:61858-&gt;19669/tcp, 0.0.0.0:61859-&gt;19670/tcp
</span></span><span class="line"><span class="cl">nebula-docker-compose-graphd2-1     0.0.0.0:61855-&gt;9669/tcp, 0.0.0.0:61853-&gt;19669/tcp, 0.0.0.0:61854-&gt;19670/tcp
</span></span><span class="line"><span class="cl">nebula-docker-compose-storaged2-1   9777-9778/tcp, 9780/tcp, 0.0.0.0:61868-&gt;9779/tcp, 0.0.0.0:61869-&gt;19779/tcp, 0.0.0.0:61870-&gt;19780/tcp
</span></span><span class="line"><span class="cl">nebula-docker-compose-storaged1-1   9777-9778/tcp, 9780/tcp, 0.0.0.0:61865-&gt;9779/tcp, 0.0.0.0:61866-&gt;19779/tcp, 0.0.0.0:61864-&gt;19780/tcp
</span></span><span class="line"><span class="cl">nebula-docker-compose-storaged0-1   9777-9778/tcp, 9780/tcp, 0.0.0.0:61845-&gt;9779/tcp, 0.0.0.0:61843-&gt;19779/tcp, 0.0.0.0:61844-&gt;19780/tcp
</span></span><span class="line"><span class="cl">nebula-docker-compose-metad1-1      9560/tcp, 0.0.0.0:61705-&gt;9559/tcp, 0.0.0.0:61706-&gt;19559/tcp, 0.0.0.0:61707-&gt;19560/tcp
</span></span><span class="line"><span class="cl">nebula-docker-compose-metad2-1      9560/tcp, 0.0.0.0:61699-&gt;9559/tcp, 0.0.0.0:61700-&gt;19559/tcp, 0.0.0.0:61701-&gt;19560/tcp
</span></span><span class="line"><span class="cl">nebula-docker-compose-metad0-1      9560/tcp, 0.0.0.0:61704-&gt;9559/tcp, 0.0.0.0:61702-&gt;19559/tcp, 0.0.0.0:61703-&gt;19560/tcp
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œè¾¹æœ‰ä¸‰ç§å®¹å™¨ ï¼š</p>
<ul>
<li><code>GrpahD</code>ï¼ŒæŸ¥è¯¢å¼•æ“ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ç”¨æˆ·è¿›è¡Œç™»å½•ã€è¿æ¥ã€å‘ Query è¯·æ±‚ç›´æ¥è®¿é—®çš„å”¯ä¸€ä¸€ç§æœåŠ¡ã€æ¥å£ã€‚</li>
<li><code>MetaD</code>ï¼Œå…ƒæ•°æ®æœåŠ¡ï¼Œå®ƒä¸€èˆ¬ä¸ä¼šæš´éœ²ç»™å¤–éƒ¨ï¼Œåªæœ‰ GraphD ã€StorageD ä¼šç›´æ¥è®¿é—®å®ƒã€‚</li>
<li><code>StorageD</code>ï¼Œå­˜å‚¨å¼•æ“ï¼Œå®ƒä¸€èˆ¬ä¸ä¼šæš´éœ²ç»™å¤–éƒ¨ï¼Œåªæœ‰ GraphDã€StorageD ä¼šç›´æ¥è®¿é—®å®ƒã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥ä» Stuido Consoleï¼Œæˆ–è€… Nebula Console ï¼ˆè¿æ¥åˆ° GraphD ä¹‹åï¼‰é‡Œé€šè¿‡ <code>SHOW HOSTS &lt;Type&gt;</code>ï¼Œæ¥è·å–æ¯ç§æœåŠ¡çš„ä¿¡æ¯ï¼Œå…¶ä¸­ç¬¬ä¸€åˆ—çš„ä¿¡æ¯å°±æ˜¯ä»–ä»¬çš„ IP æˆ–è€… Hostï¼Œä¸‹è¾¹çš„ä¾‹å­æ˜¯ Docker Compose é»˜è®¤é…ç½®ä¸‹çš„æƒ…å†µã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">(</span>root@nebula<span class="o">)</span> <span class="o">[(</span>none<span class="o">)]</span>&gt; SHOW HOSTS GRAPH
</span></span><span class="line"><span class="cl">+-----------+------+----------+---------+--------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Host      <span class="p">|</span> Port <span class="p">|</span> Status   <span class="p">|</span> Role    <span class="p">|</span> Git Info Sha <span class="p">|</span> Version <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-----------+------+----------+---------+--------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;graphd&#34;</span>  <span class="p">|</span> <span class="m">9669</span> <span class="p">|</span> <span class="s2">&#34;ONLINE&#34;</span> <span class="p">|</span> <span class="s2">&#34;GRAPH&#34;</span> <span class="p">|</span> <span class="s2">&#34;3ba41bd&#34;</span>    <span class="p">|</span> <span class="s2">&#34;2.6.0&#34;</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-----------+------+----------+---------+--------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;graphd1&#34;</span> <span class="p">|</span> <span class="m">9669</span> <span class="p">|</span> <span class="s2">&#34;ONLINE&#34;</span> <span class="p">|</span> <span class="s2">&#34;GRAPH&#34;</span> <span class="p">|</span> <span class="s2">&#34;3ba41bd&#34;</span>    <span class="p">|</span> <span class="s2">&#34;2.6.0&#34;</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-----------+------+----------+---------+--------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;graphd2&#34;</span> <span class="p">|</span> <span class="m">9669</span> <span class="p">|</span> <span class="s2">&#34;ONLINE&#34;</span> <span class="p">|</span> <span class="s2">&#34;GRAPH&#34;</span> <span class="p">|</span> <span class="s2">&#34;3ba41bd&#34;</span>    <span class="p">|</span> <span class="s2">&#34;2.6.0&#34;</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-----------+------+----------+---------+--------------+---------+
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">(</span>root@nebula<span class="o">)</span> <span class="o">[(</span>none<span class="o">)]</span>&gt; SHOW HOSTS META
</span></span><span class="line"><span class="cl">+----------+------+----------+--------+--------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Host     <span class="p">|</span> Port <span class="p">|</span> Status   <span class="p">|</span> Role   <span class="p">|</span> Git Info Sha <span class="p">|</span> Version <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----------+------+----------+--------+--------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;metad1&#34;</span> <span class="p">|</span> <span class="m">9559</span> <span class="p">|</span> <span class="s2">&#34;ONLINE&#34;</span> <span class="p">|</span> <span class="s2">&#34;META&#34;</span> <span class="p">|</span> <span class="s2">&#34;3ba41bd&#34;</span>    <span class="p">|</span> <span class="s2">&#34;2.6.0&#34;</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----------+------+----------+--------+--------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;metad0&#34;</span> <span class="p">|</span> <span class="m">9559</span> <span class="p">|</span> <span class="s2">&#34;ONLINE&#34;</span> <span class="p">|</span> <span class="s2">&#34;META&#34;</span> <span class="p">|</span> <span class="s2">&#34;3ba41bd&#34;</span>    <span class="p">|</span> <span class="s2">&#34;2.6.0&#34;</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----------+------+----------+--------+--------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;metad2&#34;</span> <span class="p">|</span> <span class="m">9559</span> <span class="p">|</span> <span class="s2">&#34;ONLINE&#34;</span> <span class="p">|</span> <span class="s2">&#34;META&#34;</span> <span class="p">|</span> <span class="s2">&#34;3ba41bd&#34;</span>    <span class="p">|</span> <span class="s2">&#34;2.6.0&#34;</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----------+------+----------+--------+--------------+---------+
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">(</span>root@nebula<span class="o">)</span> <span class="o">[(</span>none<span class="o">)]</span>&gt; SHOW HOSTS STORAGE
</span></span><span class="line"><span class="cl">+-------------+------+----------+-----------+--------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Host        <span class="p">|</span> Port <span class="p">|</span> Status   <span class="p">|</span> Role      <span class="p">|</span> Git Info Sha <span class="p">|</span> Version <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+------+----------+-----------+--------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;storaged0&#34;</span> <span class="p">|</span> <span class="m">9779</span> <span class="p">|</span> <span class="s2">&#34;ONLINE&#34;</span> <span class="p">|</span> <span class="s2">&#34;STORAGE&#34;</span> <span class="p">|</span> <span class="s2">&#34;3ba41bd&#34;</span>    <span class="p">|</span> <span class="s2">&#34;2.6.0&#34;</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+------+----------+-----------+--------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;storaged1&#34;</span> <span class="p">|</span> <span class="m">9779</span> <span class="p">|</span> <span class="s2">&#34;ONLINE&#34;</span> <span class="p">|</span> <span class="s2">&#34;STORAGE&#34;</span> <span class="p">|</span> <span class="s2">&#34;3ba41bd&#34;</span>    <span class="p">|</span> <span class="s2">&#34;2.6.0&#34;</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+------+----------+-----------+--------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;storaged2&#34;</span> <span class="p">|</span> <span class="m">9779</span> <span class="p">|</span> <span class="s2">&#34;ONLINE&#34;</span> <span class="p">|</span> <span class="s2">&#34;STORAGE&#34;</span> <span class="p">|</span> <span class="s2">&#34;3ba41bd&#34;</span>    <span class="p">|</span> <span class="s2">&#34;2.6.0&#34;</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+------+----------+-----------+--------------+---------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨é»˜è®¤çš„ <a href="https://github.com/vesoft-inc/nebula-docker-compose" target="_blank" rel="noopener noreffer">nebula-docker-compose</a> çš„é…ç½®ä¸‹å„ä¸ªæœåŠ¡ä¸º<code>graphd</code>, <code>metad1</code>, <code>storaged0</code> è¿™ç§åŸŸåçš„ Host æ ¼å¼ï¼Œè¿™å…¶å®æ˜¯å‡è®¾äº†æˆ‘ä»¬ä½¿ç”¨ Docker å¯åŠ¨çš„æœåŠ¡ä¸€èˆ¬æ˜¯ä½œä¸ºå•æœºæµ‹è¯•ä¹‹ç”¨ï¼Œé™¤äº†å…¶ä¸­çš„ <code>graphd</code>ä¹‹å¤–ï¼Œå…¶ä»–çš„æœåŠ¡éƒ½æ²¡æœ‰æŒ‡å®šå›ºå®šçš„å¤–éƒ¨æ˜ å°„ç«¯å£ï¼ˆè§å‰è¾¹çš„ <code>docker ps</code>  çš„ç»“æœé‡Œï¼Œå®ƒæš´éœ²åœ¨<code>0.0.0.0:9669</code>)ã€‚</p>
<p>è¿™æ„å‘³ç€ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸æ˜¯è¿è¡Œåœ¨æœ¬æœºï¼Œè®¿é—®å…¶ä»–æœåŠ¡çš„ç«¯å£éƒ½æ˜¯åŠ¨æ€çš„ï¼Œè¿™ä¼šè®©å¾ˆå¤šç¬¬ä¸€æ¬¡æƒ³ç”¨ Python Storage Client è¿æ¥æœåŠ¡çš„åŒå­¦å¡ä½ã€‚</p>
<p>æ‰€ä»¥æˆ‘è¿™é‡Œç»™å¤§å®¶åˆ†äº«ä¸€ä¸ªå¿«é€Ÿç”¨ Python å»è°ƒè¯• Storage Client çš„æ–¹æ³•ï¼š</p>
<blockquote>
<p>æœ¬è´¨ä¸Šæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ Compose çš„é…ç½®æ–‡ä»¶ã€é€šè¿‡å…¶ä»–éƒ¨ç½²æˆ–è€…é…ç½®çš„æ–¹å¼å®‰è£… Nebula æ¥ä¿è¯ Python Client èƒ½å¤Ÿè®¿é—® Storage/Meta æœåŠ¡ï¼Œè¿™é‡Œåªæ˜¯ç»™å‡ºä¸€ä¸ªæ— éœ€ä¿®æ”¹é…ç½®çš„æ–¹æ³•ï¼šè®© Python è¿è¡Œç¯å¢ƒå¤„åœ¨ Docker Compose çš„ Nebula Cluster åŒä¸€ä¸ªå®¹å™¨ç½‘ç»œã€‚</p>
</blockquote>
<h3 id="ç¬¬ä¸€æ­¥æŠŠ-python-å®¹å™¨" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%80%e6%ad%a5%e6%8a%8a-python-%e5%ae%b9%e5%99%a8" class="header-mark"></a>1.1 ç¬¬ä¸€æ­¥ï¼ŒæŠŠ Python å®¹å™¨</h3><p>åœ¨ <code>nebula-docker-compose_nebula-net</code> è¿™ä¸ªå®¹å™¨ç½‘ç»œå¯åŠ¨ä¸€ä¸ª Jupyter çš„å®¹å™¨ã€‚</p>
<blockquote>
<p>è¿™é‡Œé‡‡ç”¨äº† <a href="https://github.com/jupyter/docker-stacks" target="_blank" rel="noopener noreffer">https://github.com/jupyter/docker-stacks</a> ç»´æŠ¤çš„ Docker Imageã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker run <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -p 8888:8888 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --network nebula-docker-compose_nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    jupyter/scipy-notebook:33add21fab64
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å¯ä»¥çœ‹åˆ°å®¹å™¨äº†ï¼Œå¹¶ä¸”åœ¨ç›‘å¬ç«¯å£ï¼š8888ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>I 07:06:31.060 NotebookApp<span class="o">]</span> Jupyter Notebook 6.3.0 is running at:
</span></span><span class="line"><span class="cl"><span class="o">[</span>I 07:06:31.060 NotebookApp<span class="o">]</span> http://e170a5eb4858:8888/?token<span class="o">=</span>5beafb26fc6995b081c611d5d2cc96d557897b74bfdaac53
</span></span><span class="line"><span class="cl"><span class="o">[</span>I 07:06:31.060 NotebookApp<span class="o">]</span> or http://127.0.0.1:8888/?token<span class="o">=</span>5beafb26fc6995b081c611d5d2cc96d557897b74bfdaac53
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ—¶å€™æˆ‘ä»¬å¯åœ¨æµè§ˆå™¨æ‰“å¼€ http://127.0.0.1:8888/?token=5beafb26fc6995b081c611d5d2cc96d557897b74bfdaac53.</p>
<p>åœ¨é‡Œè¾¹æ–°å»ºä¸€ä¸ª Notebookã€‚</p>
<h3 id="ç¬¬äºŒæ­¥å®‰è£…-nebula-python-sdk" class="headerLink">
    <a href="#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e5%ae%89%e8%a3%85-nebula-python-sdk" class="header-mark"></a>1.2 ç¬¬äºŒæ­¥ï¼Œå®‰è£… Nebula Python SDK</h3><p>æˆ‘ä»¬åªéœ€è¦åœ¨ Jupyter é‡Œæ‰§è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">nebula2</span><span class="o">-</span><span class="n">python</span><span class="o">==</span><span class="mf">2.6.0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°±å¯ä»¥äº†ï¼Œå…·ä½“çš„ç‰ˆæœ¬è¦æ ¹æ® Nebula Python çš„ README é‡Œçš„<a href="https://github.com/vesoft-inc/nebula-python#how-to-choose-nebula-python" target="_blank" rel="noopener noreffer">ç‰ˆæœ¬å¯¹åº”</a>å…³ç³»æ¥ç»™å®šã€‚</p>
<h3 id="ç¬¬ä¸‰æ­¥å®ä¾‹åŒ–-metacache-å’Œ-graphstorageclient" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%89%e6%ad%a5%e5%ae%9e%e4%be%8b%e5%8c%96-metacache-%e5%92%8c-graphstorageclient" class="header-mark"></a>1.3 ç¬¬ä¸‰æ­¥ï¼Œå®ä¾‹åŒ– MetaCache å’Œ GraphStorageClient</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula2.mclient</span> <span class="kn">import</span> <span class="n">MetaCache</span><span class="p">,</span> <span class="n">HostAddr</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula2.sclient.GraphStorageClient</span> <span class="kn">import</span> <span class="n">GraphStorageClient</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Docker Compose ä¸‹é»˜è®¤ meta çš„åœ°å€æ˜¯ metad1 metad0 metad2</span>
</span></span><span class="line"><span class="cl"><span class="n">meta_cache</span> <span class="o">=</span> <span class="n">MetaCache</span><span class="p">([(</span><span class="s1">&#39;metad1&#39;</span><span class="p">,</span><span class="mi">9559</span><span class="p">),(</span><span class="s1">&#39;metad0&#39;</span><span class="p">,</span><span class="mi">9559</span><span class="p">),(</span><span class="s1">&#39;metad2&#39;</span><span class="p">,</span><span class="mi">9559</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">graph_storage_client</span> <span class="o">=</span> <span class="n">GraphStorageClient</span><span class="p">(</span><span class="n">meta_cache</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç¬¬å››æ­¥æ‰«æ•°æ®" class="headerLink">
    <a href="#%e7%ac%ac%e5%9b%9b%e6%ad%a5%e6%89%ab%e6%95%b0%e6%8d%ae" class="header-mark"></a>1.4 ç¬¬å››æ­¥ï¼Œæ‰«æ•°æ®</h3><ul>
<li>æŒ‰ç©ºé—´ã€ç‚¹ç±»å‹æ‰«ç‚¹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">graph_storage_client</span><span class="o">.</span><span class="n">scan_vertex</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">space_name</span><span class="o">=</span><span class="s1">&#39;basketballplayer&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">tag_name</span><span class="o">=</span><span class="s1">&#39;player&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">resp</span><span class="o">.</span><span class="n">has_next</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">vertex_data</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">vertex_data</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æŒ‰ç©ºé—´ã€è¾¹ç±»å‹æ‰«è¾¹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">graph_storage_client</span><span class="o">.</span><span class="n">scan_edge</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">space_name</span><span class="o">=</span><span class="s1">&#39;basketballplayer&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">edge_name</span><span class="o">=</span><span class="s1">&#39;follow&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">resp</span><span class="o">.</span><span class="n">has_next</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">edge_data</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">edge_data</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Jupyter çš„è¿‡ç¨‹æˆ‘ä¹Ÿè®°å½•åœ¨<a href="https://siwei.io/nebula-python-storage-docker-guide/Storage_Client_Example.ipynb" target="_blank" rel="noopener noreffer">è¿™ä¸ª notebook</a> é‡Œæ–¹ä¾¿å¤§å®¶å‚è€ƒã€‚</p>
<p>Happy Graphing!</p>
<blockquote>
<p>Picture Creditï¼š<a href="https://unsplash.com/photos/AMXFr97d00c" target="_blank" rel="noopener noreffer">Borderpolar Photographer</a></p>
</blockquote>]]></description>
</item><item>
    <title>Nebula Graph çš„ Java æ•°æ®è§£æå®è·µä¸æŒ‡å¯¼</title>
    <link>https://siwei.io/nebula-java-happy-parsing-guide/</link>
    <pubDate>Thu, 25 Nov 2021 19:47:53 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/nebula-java-happy-parsing-guide/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>å¦‚ä½•å¿«é€Ÿã€å³æ—¶ã€ç¬¦åˆç›´è§‰åœ°å»å¤„ç† Nebula Java Client ä¸­çš„æ•°æ®è§£æï¼Ÿè¯»è¿™ä¸€ç¯‡å°±å¤Ÿäº†ã€‚</p>
</blockquote>
<h2 id="å…³é”®æ­¥éª¤å‡ è¡Œå‡†å¤‡ä¸€ä¸ªå¹²å‡€çš„äº¤äº’å¼-nebula-java-repl-ç¯å¢ƒ" class="headerLink">
    <a href="#%e5%85%b3%e9%94%ae%e6%ad%a5%e9%aa%a4%e5%87%a0%e8%a1%8c%e5%87%86%e5%a4%87%e4%b8%80%e4%b8%aa%e5%b9%b2%e5%87%80%e7%9a%84%e4%ba%a4%e4%ba%92%e5%bc%8f-nebula-java-repl-%e7%8e%af%e5%a2%83" class="header-mark"></a>1 å…³é”®æ­¥éª¤ï¼šå‡ è¡Œå‡†å¤‡ä¸€ä¸ªå¹²å‡€çš„äº¤äº’å¼ Nebula Java REPL ç¯å¢ƒ</h2><p>å¤šäºäº† <a href="https://github.com/albertlatacz/java-repl/" target="_blank" rel="noopener noreffer">Java-REPL</a> æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ï¼ˆåƒ iPython é‚£æ ·ï¼‰å»å®æ—¶äº¤äº’åœ°è°ƒè¯•ã€åˆ†æ Nebula Java å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ç”¨å®ƒçš„ Docker é•œåƒå¯ä»¥å¾ˆå¹²å‡€çš„å»æå®šï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker pull albertlatacz/java-repl
</span></span><span class="line"><span class="cl">docker run --rm -it <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --network<span class="o">=</span>nebula-docker-compose_nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v ~:/root <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    albertlatacz/java-repl <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    bash
</span></span><span class="line"><span class="cl">apt update -y <span class="o">&amp;&amp;</span> apt install ca-certificates -y
</span></span><span class="line"><span class="cl">wget https://dlcdn.apache.org/maven/maven-3/3.8.4/binaries/apache-maven-3.8.4-bin.tar.gz --no-check-certificate
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tar xzvf apache-maven-3.8.4-bin.tar.gz
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">wget https://github.com/vesoft-inc/nebula-java/archive/refs/tags/v2.6.1.tar.gz
</span></span><span class="line"><span class="cl">tar xzvf v2.6.1.tar.gz
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> nebula-java-2.6.1/
</span></span><span class="line"><span class="cl">../apache-maven-3.8.4/bin/mvn dependency:copy-dependencies
</span></span><span class="line"><span class="cl">../apache-maven-3.8.4/bin/mvn -B package -Dmaven.test.skip<span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">java -jar ../javarepl/javarepl.jar
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ—¶å€™ï¼Œåœ¨æ‰§è¡Œå®Œ <code>java -jar ../javarepl/javarepl.jar</code> ä¹‹åï¼Œæˆ‘ä»¬å°±è¿›å…¥äº†äº¤äº’å¼çš„ Java Shellï¼ˆREPLï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ— éœ€åšç¼–è¯‘ï¼Œæ‰§è¡Œï¼Œprint è¿™æ ·çš„æ…¢åé¦ˆæ¥è°ƒè¯•å’Œç ”ç©¶æˆ‘ä»¬çš„ä»£ç äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@a2e26ba62bb6</span><span class="o">:/</span><span class="n">javarepl</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">2</span><span class="o">.</span><span class="na">6</span><span class="o">.</span><span class="na">1</span><span class="err">#</span> <span class="n">java</span> <span class="o">-</span><span class="n">jar</span> <span class="o">../</span><span class="n">javarepl</span><span class="o">/</span><span class="n">javarepl</span><span class="o">.</span><span class="na">jar</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Welcome</span> <span class="n">to</span> <span class="n">JavaREPL</span> <span class="n">version</span> <span class="nf">428</span> <span class="o">(</span><span class="n">Java</span> <span class="nf">HotSpot</span><span class="o">(</span><span class="n">TM</span><span class="o">)</span> <span class="n">64</span><span class="o">-</span><span class="n">Bit</span> <span class="n">Server</span> <span class="n">VM</span><span class="o">,</span> <span class="n">Java</span> <span class="n">1</span><span class="o">.</span><span class="na">8</span><span class="o">.</span><span class="na">0_111</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Type</span> <span class="n">expression</span> <span class="n">to</span> <span class="n">evaluate</span><span class="o">,</span> <span class="o">:</span><span class="n">help</span> <span class="k">for</span> <span class="n">more</span> <span class="n">options</span> <span class="n">or</span> <span class="n">press</span> <span class="n">tab</span> <span class="n">to</span> <span class="n">auto</span><span class="o">-</span><span class="n">complete</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Connected</span> <span class="n">to</span> <span class="n">local</span> <span class="n">instance</span> <span class="n">at</span> <span class="n">http</span><span class="o">:</span><span class="c1">//localhost:43707
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Hello, World!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Hello</span><span class="o">,</span> <span class="n">World</span><span class="o">!</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆæˆ‘ä»¬åœ¨ <code>java&gt;</code> æç¤ºç¬¦ä¸‹ï¼Œè¿™äº›æ¥æŠŠå¿…é¡»çš„ç±»è·¯å¾„å’Œå¯¼å…¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">:</span><span class="n">cp</span> <span class="o">/</span><span class="n">javarepl</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">2</span><span class="o">.</span><span class="na">6</span><span class="o">.</span><span class="na">1</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">client</span><span class="o">-</span><span class="n">2</span><span class="o">.</span><span class="na">6</span><span class="o">.</span><span class="na">1</span><span class="o">.</span><span class="na">jar</span>
</span></span><span class="line"><span class="cl"><span class="o">:</span><span class="n">cp</span> <span class="o">/</span><span class="n">javarepl</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">2</span><span class="o">.</span><span class="na">6</span><span class="o">.</span><span class="na">1</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">dependency</span><span class="o">/</span><span class="n">fastjson</span><span class="o">-</span><span class="n">1</span><span class="o">.</span><span class="na">2</span><span class="o">.</span><span class="na">78</span><span class="o">.</span><span class="na">jar</span>
</span></span><span class="line"><span class="cl"><span class="o">:</span><span class="n">cp</span> <span class="o">/</span><span class="n">javarepl</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">2</span><span class="o">.</span><span class="na">6</span><span class="o">.</span><span class="na">1</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">dependency</span><span class="o">/</span><span class="n">slf4j</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">1</span><span class="o">.</span><span class="na">7</span><span class="o">.</span><span class="na">25</span><span class="o">.</span><span class="na">jar</span>
</span></span><span class="line"><span class="cl"><span class="o">:</span><span class="n">cp</span> <span class="o">/</span><span class="n">javarepl</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">2</span><span class="o">.</span><span class="na">6</span><span class="o">.</span><span class="na">1</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">dependency</span><span class="o">/</span><span class="n">slf4j</span><span class="o">-</span><span class="n">log4j12</span><span class="o">-</span><span class="n">1</span><span class="o">.</span><span class="na">7</span><span class="o">.</span><span class="na">25</span><span class="o">.</span><span class="na">jar</span>
</span></span><span class="line"><span class="cl"><span class="o">:</span><span class="n">cp</span> <span class="o">/</span><span class="n">javarepl</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">2</span><span class="o">.</span><span class="na">6</span><span class="o">.</span><span class="na">1</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">dependency</span><span class="o">/</span><span class="n">commons</span><span class="o">-</span><span class="n">pool2</span><span class="o">-</span><span class="n">2</span><span class="o">.</span><span class="na">2</span><span class="o">.</span><span class="na">jar</span>
</span></span><span class="line"><span class="cl"><span class="o">:</span><span class="n">cp</span> <span class="o">/</span><span class="n">javarepl</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">2</span><span class="o">.</span><span class="na">6</span><span class="o">.</span><span class="na">1</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">dependency</span><span class="o">/</span><span class="n">log4j</span><span class="o">-</span><span class="n">1</span><span class="o">.</span><span class="na">2</span><span class="o">.</span><span class="na">17</span><span class="o">.</span><span class="na">jar</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.alibaba.fastjson.JSON</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.alibaba.fastjson.JSONObject</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.ErrorCode</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.NebulaPoolConfig</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.data.CASignedSSLParam</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.data.HostAddress</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.data.ResultSet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.data.SelfSignedSSLParam</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.data.ValueWrapper</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.net.NebulaPool</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.net.Session</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.UnsupportedEncodingException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.lang.reflect.*</span><span class="o">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¯ä»¥ä»è¿™ Java ç¯å¢ƒè¿æ¥åˆ° Nebula Graph é‡Œï¼Œä¸‹è¾¹çš„ä¾‹å­é‡Œæˆ‘ç”¨äº†è‡ªå·±çš„ GraphD çš„ IP å’Œç«¯å£ä½œä¸ºä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">NebulaPoolConfig</span> <span class="n">nebulaPoolConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NebulaPoolConfig</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">nebulaPoolConfig</span><span class="o">.</span><span class="na">setMaxConnSize</span><span class="o">(</span><span class="n">10</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">HostAddress</span><span class="o">&gt;</span> <span class="n">addresses</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="n">HostAddress</span><span class="o">(</span><span class="s">&#34;192.168.8.127&#34;</span><span class="o">,</span> <span class="n">9669</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="n">NebulaPool</span> <span class="n">pool</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NebulaPool</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">pool</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">addresses</span><span class="o">,</span> <span class="n">nebulaPoolConfig</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="na">getSession</span><span class="o">(</span><span class="s">&#34;root&#34;</span><span class="o">,</span> <span class="s">&#34;nebula&#34;</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é€šè¿‡è°ƒç”¨-execute-æ–¹æ³•è·å¾—ä¸å¤ªå®¹æ˜“æ‡‚çš„-resultset-å¯¹è±¡" class="headerLink">
    <a href="#%e9%80%9a%e8%bf%87%e8%b0%83%e7%94%a8-execute-%e6%96%b9%e6%b3%95%e8%8e%b7%e5%be%97%e4%b8%8d%e5%a4%aa%e5%ae%b9%e6%98%93%e6%87%82%e7%9a%84-resultset-%e5%af%b9%e8%b1%a1" class="header-mark"></a>2 é€šè¿‡è°ƒç”¨ <code>execute</code> æ–¹æ³•è·å¾—ä¸å¤ªå®¹æ˜“æ‡‚çš„ ResultSet å¯¹è±¡</h2><p>åˆšæ¥è§¦è¿™é‡Œçš„å¤§å®¶ä¸€å®šå¯¹è¿™ä¸ª ResultSet å¯¹è±¡æœ‰äº›æ„ï¼Œå€ŸåŠ©æˆ‘ä»¬çš„ç¯å¢ƒï¼Œå’±ä»¬æ¥ååˆ†é’ŸæŠŠå®ƒæé€šå§ï¼Œè¿™é‡Œæˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªç®€å•çš„è¿”å› Vertex é¡¶ç‚¹çš„ç»“æœçœ‹çœ‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ResultSet</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&#34;USE basketballplayer;MATCH (n:player) WHERE n.name==\&#34;Tim Duncan\&#34; RETURN n&#34;</span><span class="o">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‚è€ƒ ResultSet çš„ä»£ç ï¼š</p>
<blockquote>
<p>Reference: <a href="https://github.dev/vesoft-inc/nebula-java/blob/master/client/src/main/java/com/vesoft/nebula/client/graph/data/ResultSet.java" target="_blank" rel="noopener noreffer">client/graph/data/ResultSet.java</a></p>
</blockquote>
<p>å¥½å§ï¼Œå…¶å®å¯ä»¥å…ˆä¸çœ‹ï¼Œè·Ÿç€æˆ‘çš„æ•™ç¨‹å¾€ä¸‹èµ°å§ï¼Œæˆ‘ä»¬çŸ¥é“ç»“æœéƒ½æ˜¯äºŒç»´çš„è¡¨ï¼ŒResultSet æä¾›äº†å¸¸è§çš„é’ˆå¯¹è¡Œã€åˆ—çš„ä¸€äº›æ–¹æ³•ï¼Œé€šå¸¸ï¼Œæˆ‘ä»¬æ˜¯è·å–æ¯ä¸€è¡Œï¼Œç„¶åè§£æå®ƒï¼Œè€Œå…³é”®çš„é—®é¢˜æ˜¯æ¯ä¸€ä¸ªå€¼è¦æ€ä¹ˆå¤„ç†ï¼Œå¯¹å§ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">resp</span><span class="o">.</span><span class="na">isSucceeded</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Boolean</span> <span class="n">res9</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">resp</span><span class="o">.</span><span class="na">rowsSize</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span> <span class="n">res16</span> <span class="o">=</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="na">getRows</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ArrayList</span> <span class="n">rows</span> <span class="o">=</span> <span class="o">[</span><span class="n">Row</span> <span class="o">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">values</span> <span class="o">:</span> <span class="o">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">Value</span> <span class="n">vVal</span><span class="o">:</span><span class="n">Vertex</span> <span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">vid</span> <span class="o">:</span> <span class="o">&lt;</span><span class="n">Value</span> <span class="n">sVal</span><span class="o">:</span><span class="n">70</span> <span class="n">6c</span> <span class="n">61</span> <span class="n">79</span> <span class="n">65</span> <span class="n">72</span> <span class="n">31</span> <span class="n">30</span> <span class="n">30</span><span class="o">&gt;,</span>
</span></span><span class="line"><span class="cl">        <span class="n">tags</span> <span class="o">:</span> <span class="o">[</span>
</span></span><span class="line"><span class="cl">          <span class="n">Tag</span> <span class="o">(</span>
</span></span><span class="line"><span class="cl">              <span class="n">name</span> <span class="o">:</span> <span class="n">70</span> <span class="n">6C</span> <span class="n">61</span> <span class="n">79</span> <span class="n">65</span> <span class="n">72</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">              <span class="n">props</span> <span class="o">:</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="o">[</span><span class="n">B</span><span class="nd">@5264a468</span> <span class="o">:</span> <span class="o">&lt;</span><span class="n">Value</span> <span class="n">iVal</span><span class="o">:</span><span class="n">42</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="o">[</span><span class="n">B</span><span class="nd">@496b8e10</span> <span class="o">:</span> <span class="o">&lt;</span><span class="n">Value</span> <span class="n">sVal</span><span class="o">:</span><span class="n">54</span> <span class="n">69</span> <span class="n">6d</span> <span class="n">20</span> <span class="n">44</span> <span class="n">75</span> <span class="n">6e</span> <span class="n">63</span> <span class="n">61</span> <span class="n">6e</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">]</span>
</span></span><span class="line"><span class="cl">      <span class="o">)&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">)]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">row0</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="na">rowValues</span><span class="o">(</span><span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Iterable</span><span class="o">&lt;</span><span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ValueWrapper</span><span class="o">&gt;</span> <span class="n">res10</span> <span class="o">=</span> <span class="n">ColumnName</span><span class="o">:</span> <span class="o">[</span><span class="n">n</span><span class="o">],</span> <span class="n">Values</span><span class="o">:</span> <span class="o">[(</span><span class="s">&#34;player100&#34;</span> <span class="o">:</span><span class="n">player</span> <span class="o">{</span><span class="n">name</span><span class="o">:</span> <span class="s">&#34;Tim Duncan&#34;</span><span class="o">,</span> <span class="n">age</span><span class="o">:</span> <span class="n">42</span><span class="o">})]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å…¶å®å›åˆ°è¿™æ¬¡çš„ query ï¼Œå…¶å®æ˜¯è¿”å›ä¸€ä¸ª vertexï¼šé¡¶ç‚¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(root@nebula) [basketballplayer]&gt; match (n:player) WHERE n.name == &#34;Tim Duncan&#34; return n
</span></span><span class="line"><span class="cl">+----------------------------------------------------+
</span></span><span class="line"><span class="cl">| n                                                  |
</span></span><span class="line"><span class="cl">+----------------------------------------------------+
</span></span><span class="line"><span class="cl">| (&#34;player100&#34; :player{age: 42, name: &#34;Tim Duncan&#34;}) |
</span></span><span class="line"><span class="cl">+----------------------------------------------------+
</span></span><span class="line"><span class="cl">Got 1 rows (time spent 2116/44373 us)
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡ä¸Šè¾¹çš„å‡ ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å…¶å®èƒ½å¤Ÿè·å¾—è¿™ä¸ªé¡¶ç‚¹çš„å€¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">v</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;com.vesoft.nebula.Value&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span><span class="o">.</span><span class="na">getDeclaredMethods</span><span class="o">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ª <code>com.vesoft.nebula.Value</code> çš„å€¼çš„ç±»æä¾›çš„æ–¹æ³•ç‰¹åˆ«ç‰¹åˆ«åŸå§‹ï¼Œè¿™ä¹Ÿæ˜¯è®©å¤§å®¶çŠ¯æ„çš„åŸå› ï¼Œåœ¨è¿™ä¸ªæ•™ç¨‹é‡Œæœ€é‡è¦çš„ä¸€ä¸ªå¸¦èµ°çš„ç»éªŒï¼ˆé™¤äº†åˆ©ç”¨ REPLä¹‹å¤–ï¼‰å°±æ˜¯ï¼šé™¤éå¿…è¦ï¼Œä¸è¦å»å–è¿™ä¸ªåŸå§‹çš„ç±»ï¼Œæˆ‘ä»¬åº”è¯¥å»å–å¾— <code>ValueWrapper</code> å°è£…ä¹‹åçš„å€¼ï¼ï¼ï¼</p>
<blockquote>
<p>æ³¨æ„ï¼šå…¶å®æˆ‘ä»¬æœ‰æ›´è½»æ¾åœ°æ–¹æ³•ï¼Œå°±æ˜¯ç”¨ executeJson ç›´æ¥è·å¾— JSON stringï¼Œåˆ«æ‹…å¿ƒï¼Œä¼šåœ¨åè¾¹æåˆ°ï¼Œä¸è¿‡è¿™ä¸ªæ–¹æ³•è¦ 2.6 ä¹‹åæ‰æ”¯æŒã€‚</p>
</blockquote>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•ä½¿ç”¨ <code>ValueWrapper</code> å°è£…å‘¢ï¼Ÿå…¶å®ç­”æ¡ˆå·²ç»åœ¨ä¸Šè¾¹äº†ï¼Œå¤§å®¶å¯ä»¥å›å»çœ‹çœ‹ï¼Œresp.rowValues(0) çš„ç±»å‹æ­£æ˜¯ ValueWrapper çš„å¯è¿­ä»£å¯¹è±¡ï¼</p>
<p>æ‰€ä»¥ï¼Œæ­£ç¡®æ‰“å¼€æ–¹å¼æ˜¯è¿­å®ƒï¼è¿­å®ƒï¼è¿­å®ƒï¼å…¶å®è¿™ä¸ªå°±æ˜¯ä»£ç åº“é‡Œçš„ GraphClientExample çš„ä¸€éƒ¨åˆ†ä¾‹å­äº†ï¼Œæˆ‘ä»¬æŠŠå®ƒè¿­ä»£å–å‡ºæ¥ï¼Œæ”¾åˆ° <code>wrappedValueList</code> é‡Œæ…¢æ…¢æŠŠç©ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">ValueWrapper</span><span class="o">&gt;</span> <span class="n">wrappedValueList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">resp</span><span class="o">.</span><span class="na">rowsSize</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ResultSet</span><span class="o">.</span><span class="na">Record</span> <span class="n">record</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="na">rowValues</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">ValueWrapper</span> <span class="n">value</span> <span class="o">:</span> <span class="n">record</span><span class="o">.</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">wrappedValueList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isLong</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asLong</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isBoolean</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asBoolean</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isDouble</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asDouble</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isString</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isTime</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asTime</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isDate</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asDate</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isDateTime</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asDateTime</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isVertex</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asNode</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isEdge</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asRelationship</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isPath</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asPath</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isList</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asList</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isSet</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asSet</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isMap</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asMap</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¾¹è¿™äº›å¾ˆä¸‘çš„ if å°±æ˜¯å…³é”®äº†ï¼Œæˆ‘ä»¬çŸ¥é“ query çš„è¿”å›å€¼å¯èƒ½æ˜¯å¤šç§ç±»å‹çš„ï¼Œä»–ä»¬åˆ†ä¸ºï¼š</p>
<ul>
<li>å›¾è¯­ä¹‰çš„ï¼šç‚¹ã€è¾¹ã€è·¯å¾„</li>
<li>æ•°æ®ç±»å‹ï¼šStringï¼Œæ—¥æœŸï¼Œåˆ—è¡¨ï¼Œé›†åˆ ç­‰ç­‰ç­‰</li>
</ul>
<p>è¿™é‡Œçš„å…³é”®æ˜¯ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ <code>ValueWrapper</code> ä¸ºæˆ‘ä»¬å‡†å¤‡å¥½çš„ <code>asXxx</code> æ–¹æ³•ï¼Œå¦‚æœè¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªé¡¶ç‚¹ï¼Œä¹ˆè¿™ä¸ª Xxx å°±æ˜¯ Nodeï¼ŒåŒç†å¦‚æœæ˜¯è¾¹çš„è¯ï¼Œè¿™ä¸ª Xxx å°±æ˜¯ Relationshipã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ç»™å¤§å®¶çœ‹çœ‹å’±ä»¬è¿™ä¸ªè¿”å›ç‚¹ç»“æœçš„æƒ…å†µä¸‹çš„ <code>asNode()</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">v</span> <span class="o">=</span> <span class="n">wrappedValueList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ValueWrapper</span> <span class="n">v</span> <span class="o">=</span> <span class="o">(</span><span class="s">&#34;player100&#34;</span> <span class="o">:</span><span class="n">player</span> <span class="o">{</span><span class="n">name</span><span class="o">:</span> <span class="s">&#34;Tim Duncan&#34;</span><span class="o">,</span> <span class="n">age</span><span class="o">:</span> <span class="n">42</span><span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">v</span><span class="o">.</span><span class="na">asNode</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span> <span class="n">res16</span> <span class="o">=</span> <span class="o">(</span><span class="s">&#34;player100&#34;</span> <span class="o">:</span><span class="n">player</span> <span class="o">{</span><span class="n">name</span><span class="o">:</span> <span class="s">&#34;Tim Duncan&#34;</span><span class="o">,</span> <span class="n">age</span><span class="o">:</span> <span class="n">42</span><span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">node</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="na">asNode</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span> <span class="n">node</span> <span class="o">=</span> <span class="o">(</span><span class="s">&#34;player100&#34;</span> <span class="o">:</span><span class="n">player</span> <span class="o">{</span><span class="n">name</span><span class="o">:</span> <span class="s">&#34;Tim Duncan&#34;</span><span class="o">,</span> <span class="n">age</span><span class="o">:</span> <span class="n">42</span><span class="o">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå€ŸåŠ©äº Java çš„ reflection ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªäº¤äº’ç¨‹åºé‡Œåšç±»ä¼¼äº Python é‡Œ <code>dir()</code> çš„äº‹æƒ…ï¼Œå®æ—¶åœ°å»è·å–ä¸€ä¸ªç±»æ”¯æŒçš„æ–¹æ³•ï¼Œåƒè¿™æ ·ï¼Œçœå»äº†æŸ¥ä»£ç ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">rClass</span><span class="o">=</span><span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;com.vesoft.nebula.client.graph.data.ResultSet&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span> <span class="n">r</span> <span class="o">=</span> <span class="kd">class</span> <span class="nc">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">rClass</span><span class="o">.</span><span class="na">getDeclaredMethods</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Method</span><span class="o">[]</span> <span class="n">res20</span> <span class="o">=</span> <span class="o">[</span><span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getColumnNames</span><span class="o">(),</span> <span class="kd">public</span> <span class="kt">int</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">rowsSize</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet$Record</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">rowValues</span><span class="o">(</span><span class="kt">int</span><span class="o">),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">colValues</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getErrorMessage</span><span class="o">(),</span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">isSucceeded</span><span class="o">(),</span> <span class="kd">public</span> <span class="kt">int</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getSpaceName</span><span class="o">(),</span> <span class="kd">public</span> <span class="kt">int</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getLatency</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">PlanDescription</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getPlanDesc</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getRows</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getComment</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">keys</span><span class="o">()]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">nodeClass</span><span class="o">=</span><span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;com.vesoft.nebula.client.graph.data.Node&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span> <span class="n">nodeClass</span> <span class="o">=</span> <span class="kd">class</span> <span class="nc">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">nodeClass</span><span class="o">.</span><span class="na">getDeclaredMethods</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Method</span><span class="o">[]</span> <span class="n">res20</span> <span class="o">=</span> <span class="o">[</span><span class="kd">public</span> <span class="kt">boolean</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">hasTagName</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">),</span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">hasLabel</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">tagNames</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">HashMap</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">properties</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">UnsupportedEncodingException</span><span class="o">,</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">labels</span><span class="o">(),</span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">values</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">),</span> <span class="kd">public</span> <span class="kt">int</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ValueWrapper</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">keys</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">UnsupportedEncodingException</span><span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>çœ‹åˆ°è¿™é‡Œï¼Œå¤§å®¶åº”è¯¥çœ‹åˆ°äº†è¿™ä¸ªå°è£…äº†çš„ ValueWrapper çš„å¥½å¤„äº†å§ï¼Ÿå®ƒæä¾›äº†æ–¹ä¾¿çš„ç¬¦åˆç›´è§‰çš„æ–¹æ³•ï¼Œå¯¹äº Node ç±»å‹æ¥è¯´ï¼Œå®ƒæä¾›äº† <code>tagNames()</code>, <code>properties()</code>, <code>labels()</code> ç­‰ç­‰éå¸¸å¥½ç”¨çš„æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">properties</span><span class="o">(</span><span class="s">&#34;player&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">HashMap</span> <span class="n">res11</span> <span class="o">=</span> <span class="o">{</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;Tim Duncan&#34;</span><span class="o">,</span> <span class="n">age</span><span class="o">=</span><span class="n">42</span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">tagNames</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ArrayList</span> <span class="n">res12</span> <span class="o">=</span> <span class="o">[</span><span class="n">player</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">labels</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ArrayList</span> <span class="n">res13</span> <span class="o">=</span> <span class="o">[</span><span class="n">player</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">values</span><span class="o">(</span><span class="s">&#34;player&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ArrayList</span> <span class="n">res14</span> <span class="o">=</span> <span class="o">[</span><span class="n">42</span><span class="o">,</span> <span class="s">&#34;Tim Duncan&#34;</span><span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬è¿™é‡Œåªå±•ç¤ºäº†é¡¶ç‚¹æ•°æ®ç±»å‹çš„å¤„ç†ã€è§£ææ–¹å¼ï¼ˆ<code>RETURN n</code>ï¼‰ï¼Œåƒå…¶ä»–çš„æ•°æ®ç±»å‹æ¯”å¦‚è¾¹ï¼ˆedgeï¼‰è·¯å¾„ï¼ˆpathï¼‰æˆ–è€…åœ°ç†æ•°æ®ã€æ—¶é—´æ•°æ®ï¼Œç”¨è¿™ç§æ–¹å¼ï¼ˆçœ‹æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Œå†äº¤äº’åœ°å»è¯•è¯•æ–¹æ³•æ€ä¹ˆç”¨ï¼‰ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå¯¹å§ï¼Ÿ</p>
<h2 id="ç›´æ¥è¿”å›-json-çš„-executejson-æ–¹æ³•" class="headerLink">
    <a href="#%e7%9b%b4%e6%8e%a5%e8%bf%94%e5%9b%9e-json-%e7%9a%84-executejson-%e6%96%b9%e6%b3%95" class="header-mark"></a>3 ç›´æ¥è¿”å› JSON çš„ <code>executeJson</code> æ–¹æ³•</h2><p>æœ€åï¼Œå¥½æ¶ˆæ¯æ˜¯ï¼Œä» 2.6 å¼€å§‹ï¼Œnebula å¯ä»¥ç›´æ¥è¿”å› JSON çš„ String äº†ï¼Œæˆ‘ä»¬ä¸Šè¾¹çš„çº ç»“ä¹Ÿéƒ½ä¸æ˜¯å¿…è¦çš„äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">String</span> <span class="n">resp_json</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">executeJson</span><span class="o">(</span><span class="s">&#34;USE basketballplayer;MATCH (n:player) WHERE n.name==\&#34;Tim Duncan\&#34; RETURN n&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">resp_json</span> <span class="o">=</span> <span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">{
</span></span></span><span class="line"><span class="cl"><span class="s">   &#34;</span><span class="n">errors</span><span class="s">&#34;:[
</span></span></span><span class="line"><span class="cl"><span class="s">      {
</span></span></span><span class="line"><span class="cl"><span class="s">         &#34;</span><span class="n">code</span><span class="s">&#34;:0
</span></span></span><span class="line"><span class="cl"><span class="s">      }
</span></span></span><span class="line"><span class="cl"><span class="s">   ],
</span></span></span><span class="line"><span class="cl"><span class="s">   &#34;</span><span class="n">results</span><span class="s">&#34;:[
</span></span></span><span class="line"><span class="cl"><span class="s">      {
</span></span></span><span class="line"><span class="cl"><span class="s">         &#34;</span><span class="n">spaceName</span><span class="s">&#34;:&#34;</span><span class="n">basketballplayer</span><span class="s">&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">         &#34;</span><span class="n">data</span><span class="s">&#34;:[
</span></span></span><span class="line"><span class="cl"><span class="s">            {
</span></span></span><span class="line"><span class="cl"><span class="s">               &#34;</span><span class="n">meta</span><span class="s">&#34;:[
</span></span></span><span class="line"><span class="cl"><span class="s">                  {
</span></span></span><span class="line"><span class="cl"><span class="s">                     &#34;</span><span class="n">type</span><span class="s">&#34;:&#34;</span><span class="n">vertex</span><span class="s">&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">                     &#34;</span><span class="n">id</span><span class="s">&#34;:&#34;</span><span class="n">player100</span><span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">                  }
</span></span></span><span class="line"><span class="cl"><span class="s">               ],
</span></span></span><span class="line"><span class="cl"><span class="s">               &#34;</span><span class="n">row</span><span class="s">&#34;:[
</span></span></span><span class="line"><span class="cl"><span class="s">                  {
</span></span></span><span class="line"><span class="cl"><span class="s">                     &#34;</span><span class="n">player</span><span class="o">.</span><span class="na">age</span><span class="s">&#34;:42,
</span></span></span><span class="line"><span class="cl"><span class="s">                     &#34;</span><span class="n">player</span><span class="o">.</span><span class="na">name</span><span class="s">&#34;:&#34;</span><span class="n">Tim</span> <span class="n">Duncan</span><span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">                  }
</span></span></span><span class="line"><span class="cl"><span class="s">               ]
</span></span></span><span class="line"><span class="cl"><span class="s">            }
</span></span></span><span class="line"><span class="cl"><span class="s">         ],
</span></span></span><span class="line"><span class="cl"><span class="s">         &#34;</span><span class="n">columns</span><span class="s">&#34;:[
</span></span></span><span class="line"><span class="cl"><span class="s">            &#34;</span><span class="n">n</span><span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">         ],
</span></span></span><span class="line"><span class="cl"><span class="s">         &#34;</span><span class="n">errors</span><span class="s">&#34;:{
</span></span></span><span class="line"><span class="cl"><span class="s">            &#34;</span><span class="n">code</span><span class="s">&#34;:0
</span></span></span><span class="line"><span class="cl"><span class="s">         },
</span></span></span><span class="line"><span class="cl"><span class="s">         &#34;</span><span class="n">latencyInUs</span><span class="s">&#34;:4761
</span></span></span><span class="line"><span class="cl"><span class="s">      }
</span></span></span><span class="line"><span class="cl"><span class="s">   ]
</span></span></span><span class="line"><span class="cl"><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ç›¸ä¿¡å¤§å®¶è‚¯å®šæ¯”æˆ‘æ›´æ“…é•¿å¤„ç† JSON çš„ç»“æœäº†å“ˆ~~</p>
<h2 id="ç»“è®º" class="headerLink">
    <a href="#%e7%bb%93%e8%ae%ba" class="header-mark"></a>4 ç»“è®º</h2><ul>
<li>å¦‚æœæˆ‘ä»¬æœ‰æ¡ä»¶ï¼ˆ2.6ä»¥åï¼‰ç”¨ JSONï¼Œæƒ…å†µä¼šå¾ˆå®¹æ˜“ï¼Œå¯èƒ½å¤§å®¶ä¸å¤ªéœ€è¦æœ¬æ–‡çš„æ–¹æ³•ï¼ˆä¸è¿‡æœ‰äº¤äº’ç¯å¢ƒè¿˜æ˜¯å¾ˆæ–¹ä¾¿å§ï¼Ÿï¼‰</li>
<li>å¦‚æœæˆ‘ä»¬ä¸å¾—ä¸å’Œ resultSet æ‰“äº¤é“ï¼Œè®°å¾—ç”¨ ValueWrapper ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ç”¨ asNode()ï¼ŒasRelationship() å’Œ asPath() ï¼Œå°è£…ä¹‹åçš„å€¼æ¯”åŸå§‹çš„å€¼å¯çˆ±å¤ªå¤šäº†ï¼
<ul>
<li>é€šè¿‡ REPL å·¥å…·ï¼Œç»“åˆ Java çš„ reflection åŠ ä¸Š æºä»£ç æœ¬èº«ï¼Œåˆ†ææ•°æ®çš„å¤„ç†å°†å˜å¾—å¼‚å¸¸é¡ºæ»‘</li>
</ul>
</li>
</ul>
<p>Happy Graphing!</p>
<blockquote>
<p>Picture Creditï¼š<a href="https://unsplash.com/photos/0wIHsm2_1fc" target="_blank" rel="noopener noreffer">leunesmedia</a></p>
</blockquote>]]></description>
</item><item>
    <title>ä»é›¶åˆ°ä¸€ï¼šå¦‚ä½•æ„å»ºä¸€ä¸ªä¼ä¸šè‚¡æƒå›¾è°±ç³»ç»Ÿï¼Ÿ</title>
    <link>https://siwei.io/corp-rel-graph/</link>
    <pubDate>Wed, 24 Nov 2021 13:59:58 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/corp-rel-graph/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>å¦‚ä½•æ„å»ºä¸€ä¸ªå…·æœ‰è‚¡æƒåˆ†æçš„å›¾è°±ä¸çº¿ä¸Šç³»ç»Ÿå‘¢ï¼Ÿæœ¬æ–‡é‡Œï¼Œæˆ‘å°†åˆ©ç”¨å›¾æ•°æ®åº“ä»é›¶åˆ°ä¸€å¸¦ä½ æ„å»ºä¸€ä¸ªç®€æ˜“ç‰ˆçš„è‚¡æƒç©¿é€å›¾è°±ç³»ç»Ÿã€‚</p>
</blockquote>
<p>æˆ‘ä»¬çŸ¥é“æ— è®ºæ˜¯ç›‘ç®¡éƒ¨é—¨ã€ä¼ä¸šè¿˜æ˜¯ä¸ªäººï¼Œéƒ½æœ‰éœ€æ±‚å»é’ˆå¯¹ä¸€ä¸ªä¼ä¸šã€æ³•äººåšä¸€äº›èƒŒæ™¯è°ƒæŸ¥ï¼Œè¿™äº›è°ƒæŸ¥å¯ä»¥æ˜¯æ³•å¾‹è¯‰è®¼ã€å…¬å¼€æŒè‚¡ã€ä¼ä¸šä»»èŒç­‰ç­‰å¤šç§å¤šæ ·çš„ä¿¡æ¯ã€‚è¿™äº›èƒŒæ™¯ä¿¡æ¯å¯ä»¥è¾…åŠ©æˆ‘ä»¬åšå•†ä¸šä¸Šçš„é‡è¦å†³ç­–ï¼Œè§„é¿é£é™©ï¼šæ¯”å¦‚æ ¹æ®å…¬å¸çš„è‚¡æƒå…³ç³»ï¼Œäº†è§£æ˜¯å¦å­˜åœ¨åˆ©ç›Šå†²çªæ¯”å¦‚æ˜¯å¦é€‰æ‹©ä¸ä¸€å®¶å…¬å¸è¿›è¡Œå•†ä¸šå¾€æ¥ã€‚</p>
<p>åœ¨æ»¡è¶³è¿™æ ·çš„å…³ç³»åˆ†æéœ€æ±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€é¢ä¸´ä¸€äº›æŒ‘æˆ˜ï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li>å¦‚ä½•å°†è¿™äº›æ•°æ®çš„å…³è”å…³ç³»ä½“ç°åœ¨ç³»ç»Ÿä¹‹ä¸­ï¼Ÿä½¿å¾—å®ƒä»¬å¯ä»¥è¢«æŒ–æ˜ã€åˆ©ç”¨</li>
<li>å¤šç§å¼‚æ„æ•°æ®ã€æ•°æ®æºä¹‹é—´çš„å…³ç³»å¯èƒ½éšç€ä¸šåŠ¡çš„å‘å±•å¼•ç”³å‡ºæ›´å¤šçš„å˜åŒ–ï¼Œåœ¨ç»“æ„æ•°æ®åº“ä¸­ï¼Œè¿™æ„å‘³ç€ Schema å˜æ›´</li>
<li>åˆ†æç³»ç»Ÿéœ€è¦å°½å¯èƒ½å®æ—¶è·å–éœ€è¦çš„æŸ¥è¯¢ç»“æœï¼Œè¿™é€šå¸¸æ¶‰åŠåˆ°å¤šè·³å…³ç³»æŸ¥è¯¢</li>
<li>é¢†åŸŸä¸“å®¶èƒ½å¦å¿«é€Ÿçµæ´»ã€å¯è§†åŒ–è·å–åˆ†äº«ä¿¡æ¯</li>
</ol>
<p>é‚£ä¹ˆå¦‚ä½•æ„å»ºè¿™æ ·ä¸€ä¸ªç³»ç»Ÿè§£å†³ä»¥ä¸ŠæŒ‘æˆ˜å‘¢ï¼Ÿ</p>
<h2 id="æ•°æ®å­˜åœ¨å“ªé‡Œ" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e5%ad%98%e5%9c%a8%e5%93%aa%e9%87%8c" class="header-mark"></a>1 æ•°æ®å­˜åœ¨å“ªé‡Œï¼Ÿ</h2><blockquote>
<p>å‰æï¼šæ•°æ®é›†å‡†å¤‡ï¼Œä¸ºäº†æ›´å¥½çš„ç»™å¤§å®¶æ¼”ç¤ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å†™äº†ä¸€ä¸ªè½®å­èƒ½éšæœºç”Ÿæˆè‚¡æƒç»“æ„ç›¸å…³çš„æ•°æ®ï¼Œç”Ÿæˆçš„æ•°æ®çš„ä¾‹å­åœ¨<a href="https://github.com/wey-gu/nebula-shareholding-example/tree/main/data_sample" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a>ã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰<a href="https://github.com/wey-gu/nebula-shareholding-example/blob/main/data_sample/person.csv" target="_blank" rel="noopener noreffer">æ³•äºº</a>ã€<a href="https://github.com/wey-gu/nebula-shareholding-example/blob/main/data_sample/corp.csv" target="_blank" rel="noopener noreffer">å…¬å¸</a>çš„æ•°æ®ï¼Œæ›´æœ‰<a href="https://github.com/wey-gu/nebula-shareholding-example/blob/main/data_sample/corp_rel.csv" target="_blank" rel="noopener noreffer">å…¬å¸ä¸å­å…¬å¸ä¹‹é—´çš„å…³ç³»</a>ï¼Œ<a href="https://github.com/wey-gu/nebula-shareholding-example/blob/main/data_sample/corp_share.csv" target="_blank" rel="noopener noreffer">å…¬å¸æŒæœ‰å…¬å¸è‚¡ä»½</a>ï¼Œ<a href="https://github.com/wey-gu/nebula-shareholding-example/blob/main/data_sample/person_corp_role.csv" target="_blank" rel="noopener noreffer">æ³•äººä»»èŒå…¬å¸</a>ï¼Œ<a href="https://github.com/wey-gu/nebula-shareholding-example/blob/main/data_sample/person_corp_share.csv" target="_blank" rel="noopener noreffer">æ³•äººæŒæœ‰å…¬å¸è‚¡ä»½</a>å’Œ<a href="https://github.com/wey-gu/nebula-shareholding-example/blob/main/data_sample/person_rel.csv" target="_blank" rel="noopener noreffer">æ³•äººä¹‹é—´äº²å¯†åº¦</a>çš„å…³ç³»æ•°æ®ã€‚</p>
</blockquote>
<p>æ•°æ®å­˜åœ¨å“ªé‡Œï¼Ÿè¿™æ˜¯ä¸€ä¸ªå…³é”®çš„é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬å‰§é€ä¸€ä¸‹ï¼Œç­”æ¡ˆæ˜¯ï¼šå›¾æ•°æ®åº“ã€‚ç„¶åæˆ‘ä»¬å†ç®€å•è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆè¿™æ ·ä¸€ä¸ªè‚¡æƒå›¾è°±ç³»ç»Ÿè·‘åœ¨å›¾æ•°æ®åº“ä¸Šæ˜¯æ›´å¥½çš„ã€‚</p>
<p>åœ¨è¿™æ ·ä¸€ä¸ªç®€å•çš„æ•°æ®æ¨¡å‹ä¹‹ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç›´æ¥çš„åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­è¿™ä¹ˆå»ºæ¨¡ï¼š</p>
<p></p>
<p>è€Œè¿™ä¹ˆå»ºæ¨¡çš„é—®é¢˜åœ¨äºï¼šè¿™ç§é€»è¾‘å…³è”çš„æ–¹å¼ä½¿å¾—æ— è®ºæ•°æ®çš„å…³è”å…³ç³»æŸ¥è¯¢è¡¨è¾¾ã€å­˜å‚¨ã€è¿˜æ˜¯å¼•å…¥æ–°çš„å…³è”å…³ç³»éƒ½ä¸æ˜¯å¾ˆé«˜æ•ˆã€‚</p>
<ul>
<li><strong>æŸ¥è¯¢è¡¨è¾¾ä¸é«˜æ•ˆ</strong>æ˜¯å› ä¸ºå…³ç³»å‹æ•°æ®åº“æ˜¯é¢å‘è¡¨ç»“æ„è®¾è®¡çš„ï¼Œè¿™å†³å®šäº†å…³ç³»æŸ¥è¯¢è¦å†™åµŒå¥—çš„ JOINã€‚
<ul>
<li>è¿™å°±æ˜¯å‰è¾¹æåˆ°çš„<strong>æŒ‘æˆ˜ 1</strong>ï¼šèƒ½å¤Ÿè¡¨è¾¾ï¼Œä½†æ˜¯æ¯”è¾ƒå‹‰å¼ºï¼Œé‡åˆ°ç¨å¾®å¤æ‚çš„æƒ…å†µå°±å˜å¾—å¾ˆéš¾ã€‚</li>
</ul>
</li>
<li><strong>å­˜å‚¨ä¸é«˜æ•ˆ</strong>æ˜¯å› ä¸ºè¡¨ç»“æ„è¢«è®¾è®¡çš„æ¨¡å¼æ˜¯é¢å‘æ•°æ®è®°å½•ï¼Œè€Œéæ•°æ®ä¹‹é—´çš„å…³ç³»ï¼šæˆ‘ä»¬è™½ç„¶ä¹ æƒ¯äº†å°†æ•°æ®ä¸­å®ä½“ï¼ˆæ¯”å¦‚æ³•äººï¼‰å’Œå®ä½“å…³è”ï¼ˆæ¯”å¦‚æŒæœ‰è‚¡æƒ <code>hold_sharing_relationship</code>ï¼‰ä»¥å¦å¤–ä¸€ä¸ªè¡¨ä¸­çš„è®°å½•æ¥è¡¨è¾¾ã€å­˜å‚¨èµ·æ¥ï¼Œè¿™é€»è¾‘ä¸Šå®Œå…¨è¡Œå¾—é€šï¼Œä½†æ˜¯åˆ°äº†å¤šè·³ã€å¤§é‡éœ€è¦è¯·æ±‚æ•°æ®å…³ç³»è·³è½¬çš„æƒ…å†µä¸‹ï¼Œè¿™æ ·è·¨è¡¨ JOIN çš„ä»£ä»·å°±æˆä¸ºäº†ç“¶é¢ˆã€‚
<ul>
<li>è¿™å°±æ˜¯å‰è¾¹æåˆ°çš„<strong>æŒ‘æˆ˜ 3</strong>ï¼šæ— æ³•åº”å¯¹å¤šæ¡æŸ¥è¯¢çš„æ€§èƒ½éœ€è¦ã€‚</li>
</ul>
</li>
<li><strong>å¼•å…¥æ–°çš„å…³è”å…³ç³»</strong>ä»£ä»·å¤§ï¼Œè¿˜æ˜¯å‰è¾¹æåˆ°çš„ï¼Œè¡¨ç»“æ„ä¸‹ï¼Œç”¨æ–°çš„è¡¨æ¥è¡¨è¾¾æŒæœ‰è‚¡æƒ <code>hold_sharing_relationship</code>è¿™ä¸ªå…³è”å…³ç³»æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯è¿™éå¸¸ä¸çµæ´»ã€è€Œä¸”æ˜‚è´µï¼Œå®ƒæ„å‘³ç€æˆ‘ä»¬åœ¨å¼•å…¥è¿™ä¸ªå…³ç³»çš„æ—¶å€™é™å®šäº†èµ·ç‚¹ç»ˆç‚¹çš„ç±»å‹ï¼Œæ¯”å¦‚è‚¡æƒæŒæœ‰çš„å…³ç³»å¯èƒ½æ˜¯æ³•äºº-&gt;å…¬å¸ï¼Œä¹Ÿå¯èƒ½æ˜¯å…¬å¸-&gt;å…¬å¸ï¼Œéšç€ä¸šåŠ¡çš„æ¼”è¿›ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦å¼•å…¥æ”¿åºœ-&gt;å…¬å¸çš„æ–°å…³ç³»ï¼Œè€Œè¿™äº›å˜åŒ–éƒ½éœ€è¦åšæœ‰ä¸å°ä»£ä»·çš„å·¥ä½œï¼šæ”¹åŠ¨ Schemaã€‚
<ul>
<li>è¿™å°±æ˜¯å‰è¾¹æåˆ°çš„<strong>æŒ‘æˆ˜ 2</strong>ï¼šæ— æ³•åº”å¯¹ä¸šåŠ¡ä¸Šå¯¹æ•°æ®å…³ç³»ä¸Šçµæ´»å¤šå˜çš„è¦æ±‚ã€‚</li>
</ul>
</li>
</ul>
<p>å½“ä¸€ä¸ªé€šç”¨ç³»ç»Ÿæ— æ³•æ»¡è¶³ä¸å¯å¿½è§†çš„å…·ä½“éœ€æ±‚çš„æ—¶å€™ï¼Œä¸€ä¸ªæ–°çš„ç³»ç»Ÿå°±ä¼šè¯ç”Ÿï¼Œè¿™å°±æ˜¯å›¾æ•°æ®åº“ï¼Œé’ˆå¯¹è¿™æ ·çš„åœºæ™¯ï¼Œå›¾æ•°æ®åº“å¾ˆè‡ªç„¶åœ°ç‰¹åˆ«é’ˆå¯¹å…³è”å…³ç³»åœºæ™¯å»è®¾è®¡æ•´ä¸ªæ•°æ®åº“ï¼š</p>
<ul>
<li>é¢å‘å…³è”å…³ç³»è¡¨è¾¾çš„è¯­ä¹‰ã€‚ï¼ˆæŒ‘æˆ˜ 1ï¼‰
<ul>
<li>å¦‚ä¸‹è¡¨ï¼Œæˆ‘åˆ—ä¸¾äº†ä¸€ä¸ªç­‰ä»·çš„ä¸€è·³æŸ¥è¯¢åœ¨è¡¨ç»“æ„æ•°æ®åº“ä¸å›¾æ•°æ®åº“ä¸­ï¼ŒæŸ¥è¯¢è¯­å¥çš„åŒºåˆ«ã€‚å¤§å®¶åº”è¯¥å¯ä»¥çœ‹å‡ºâ€œæ‰¾åˆ°æ‰€æœ‰æŒæœ‰å’Œ p_100 å…±åŒæŒæœ‰å…¬å¸è‚¡ä»½çš„äººâ€è¿™æ ·çš„æŸ¥è¯¢è¡¨è¾¾å¯ä»¥åœ¨å›¾æ•°æ®åº“å¦‚ä½•è‡ªç„¶è¡¨è¾¾ï¼Œè¿™ä»…ä»…æ˜¯ä¸€æ¡æŸ¥è¯¢çš„åŒºåˆ«ï¼Œå¦‚æœæ˜¯å¤šè·³çš„è¯ï¼Œä»–ä»¬çš„å¤æ‚åº¦åŒºåˆ†è¿˜ä¼šæ›´æ˜æ˜¾ä¸€äº›ã€‚</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>è¡¨ç»“æ„æ•°æ®åº“</th>
<th>å›¾æ•°æ®åº“ï¼ˆå±æ€§å›¾ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>å°†å…³è”å…³ç³»å­˜å‚¨ä¸ºç‰©ç†è¿æ¥ï¼Œä»è€Œä½¿å¾—è·³è½¬æŸ¥è¯¢ä»£ä»·æœ€å°ã€‚ï¼ˆæŒ‘æˆ˜ 3ã€2ï¼‰
<ul>
<li>å›¾æ•°æ®ä¹‹ä¸­ï¼Œä»ç‚¹æ‹“å±•ï¼ˆæ‰¾åˆ°ä¸€ä¸ªæˆ–è€…å¤šä¸ªå…³ç³»çš„å¦ä¸€å¤´ï¼‰å‡ºå»çš„ä»£ä»·æ˜¯éå¸¸å°çš„ï¼Œè¿™å› ä¸ºå›¾æ•°æ®åº“æ˜¯ä¸€ä¸ªä¸“æœ‰çš„ç³»ç»Ÿï¼Œå¾—ç›Šäºå®ƒä¸»è¦å…³å¿ƒâ€œå›¾â€ç»“æ„çš„è®¾è®¡ï¼ŒæŸ¥æ‰¾ç¡®å®šçš„å®ä½“ï¼ˆæ¯”å¦‚å’Œä¸€ä¸ªæ³•äºº A ï¼‰æ‰€æœ‰å…³è”ï¼ˆå¯èƒ½æ˜¯ä»»èŒã€äº²æˆšã€æŒæœ‰ã€ç­‰ç­‰å…³ç³»ï¼‰å…¶ä»–æ‰€æœ‰å®ä½“ï¼ˆå…¬å¸ã€æ³•äººï¼‰è¿™ä¸ªæŸ¥æ‰¾çš„ä»£ä»·æ˜¯ O(1) çš„ï¼Œå› ä¸ºå®ƒä»¬åœ¨å›¾æ•°æ®åº“çš„æ•°æ®æœºæ„é‡Œæ˜¯çœŸçš„é“¾æ¥åœ¨ä¸€èµ·çš„ã€‚</li>
<li>å¤§å®¶å¯ä»¥ä»ä¸‹è¡¨çš„å®šé‡å‚è€ƒæ•°æ®ä¸€çª¥å›¾æ•°æ®åº“åœ¨è¿™ç§æŸ¥è¯¢ä¸‹çš„ä¼˜åŠ¿ï¼Œè¿™ç§ä¼˜åŠ¿åœ¨å¤šè·³é«˜å¹¶å‘æƒ…å†µä¸‹çš„åŒºåˆ«æ˜¯â€œèƒ½â€ä¸â€ä¸èƒ½â€œä½œä¸ºçº¿ä¸Šç³»ç»Ÿçš„åŒºåˆ«ï¼Œæ˜¯â€œå®æ—¶â€ä¸â€œç¦»çº¿â€çš„åŒºåˆ«ã€‚</li>
<li>åœ¨é¢å‘å…³è”å…³ç³»çš„æ•°æ®å»ºæ¨¡å’Œæ•°æ®ç»“æ„ä¹‹ä¸‹ï¼Œå¼•å…¥æ–°çš„å®ä½“ã€å…³è”å…³ç³»çš„ä»£ä»·è¦å°å¾ˆå¤šï¼Œè¿˜æ˜¯å‰è¾¹æåˆ°çš„ä¾‹å­ï¼š
åœ¨ Nebula Graph å›¾æ•°æ®ä¸­å¼•å…¥ä¸€ä¸ªæ–°çš„â€œæ”¿åºœæœºæ„â€ç±»å‹çš„å®ä½“ï¼Œå¹¶å¢åŠ æ”¿åºœæœºæ„-&gt;å…¬å¸çš„â€œæŒæœ‰è‚¡ä»½â€çš„å…³è”å…³ç³»ç›¸æ¯”äºåœ¨éå›¾æ¨¡å‹çš„æ•°æ®åº“ä¸­çš„ä»£ä»·å°å¾ˆå¤šã€‚</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>è¡¨ç»“æ„æ•°æ®åº“</th>
<th>å›¾æ•°æ®åº“ï¼ˆå±æ€§å›¾ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>4 è·³æŸ¥è¯¢æ—¶å»¶ 1544 ç§’</td>
<td>4 è·³æŸ¥è¯¢æ—¶å»¶ 1.36 ç§’</td>
</tr>
</tbody>
</table>
<ul>
<li>å»ºæ¨¡ç¬¦åˆç›´è§‰ï¼›å›¾æ•°æ®åº“æœ‰é¢å‘æ•°æ®è¿æ¥çš„æ•°æ®å¯è§†åŒ–èƒ½åŠ›ï¼ˆæŒ‘æˆ˜ 4ï¼‰
<ul>
<li>å¤§å®¶åœ¨ä¸‹è¡¨ç¬¬äºŒåˆ—ä¸­å¯ä»¥å¯¹æ¯”æˆ‘ä»¬æœ¬æ–‡ä¸­è¿›è¡Œçš„è‚¡æƒåˆ†ææ•°æ®åœ¨ä¸¤ç§æ•°æ®åº“ä¹‹ä¸­çš„å»ºæ¨¡çš„åŒºåˆ«ï¼Œå°¤å…¶æ˜¯åœ¨å…³å¿ƒå…³è”å…³ç³»çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ„Ÿå—åˆ°å±æ€§å›¾çš„æ¨¡å‹å»ºç«‹æ˜¯å¾ˆç¬¦åˆäººç±»å¤§è„‘ç›´è§‰çš„ï¼Œè€Œè¿™å’Œå¤§è„‘ä¹‹ä¸­<a href="https://zh.wikipedia.org/zh/%E7%A5%9E%E7%B6%93%E5%85%83" target="_blank" rel="noopener noreffer">ç¥ç»å…ƒ</a>çš„ç»“æ„å¯èƒ½ä¹Ÿæœ‰ä¸€äº›å…³ç³»ã€‚</li>
<li>å›¾æ•°æ®åº“ä¸­å†…ç½®çš„å¯è§†åŒ–å·¥å…·æä¾›äº†ä¸€èˆ¬ç”¨æˆ·ä¾¿æ·ç†è§£æ•°æ®å…³ç³»çš„èƒ½åŠ›ï¼Œä¹Ÿç»™é¢†åŸŸä¸“å®¶ç”¨æˆ·æä¾›äº†è¡¨è¾¾è¯·æ±‚å¤æ‚æ•°æ®å…³ç³»çš„ç›´è§‚æ¥å£ã€‚</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>è¡¨ç»“æ„æ•°æ®åº“</th>
<th>å›¾æ•°æ®åº“ï¼ˆå±æ€§å›¾ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<blockquote>
<p>è¡¨ç»“æ„æ•°æ®åº“ä¸å›¾æ•°æ®åº“çš„æ€»ä½“æ¯”è¾ƒï¼š</p>
</blockquote>
<!---
```ngql
GO FROM "p_100" OVER hold_share YIELD dst(edge) AS corp_with_share |\
GO FROM $-.corp_with_share OVER hold_share REVERSELY YIELD properties(vertex).name;
```

```sql
SELECT a.id, a.name, c.name
FROM person a
JOIN hold_share b ON a.id=b.person_id
JOIN corp c ON c.id=b.corp_id
WHERE c.name IN (SELECT c.name
FROM person a
JOIN hold_share b ON a.id=b.person_id
JOIN corp c ON c.id=b.corp_id
WHERE a.id = 'p_100')
```
-->
<table>
<thead>
<tr>
<th></th>
<th>è¡¨ç»“æ„æ•°æ®åº“</th>
<th>å›¾æ•°æ®åº“ï¼ˆå±æ€§å›¾ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>æŸ¥è¯¢</td>
<td></td>
<td></td>
</tr>
<tr>
<td>å»ºæ¨¡</td>
<td></td>
<td></td>
</tr>
<tr>
<td>æ€§èƒ½</td>
<td>4 è·³æŸ¥è¯¢æ—¶å»¶ 1544 ç§’</td>
<td>4 è·³æŸ¥è¯¢æ—¶å»¶ 1.36 ç§’</td>
</tr>
</tbody>
</table>
<p>ç»¼ä¸Šï¼Œåœ¨æœ¬æ•™ç¨‹é‡Œï¼Œæˆ‘ä»¬å°†åˆ©ç”¨å›¾æ•°æ®åº“æ¥è¿›è¡Œæ•°æ®å­˜å‚¨ã€‚</p>
<h2 id="å›¾æ•°æ®å»ºæ¨¡" class="headerLink">
    <a href="#%e5%9b%be%e6%95%b0%e6%8d%ae%e5%bb%ba%e6%a8%a1" class="header-mark"></a>2 å›¾æ•°æ®å»ºæ¨¡</h2><p>å‰é¢åœ¨è®¨è®ºæ•°æ®å­˜åœ¨å“ªé‡Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»æ­ç¤ºäº†åœ¨å›¾æ•°æ®åº“ä¸­å»ºæ¨¡çš„æ–¹å¼ï¼šæœ¬è´¨ä¸Šï¼Œåœ¨è¿™å¼ å›¾ä¸­ï¼Œå°†ä¼šæœ‰ä¸¤ç§å®ä½“ï¼š</p>
<ul>
<li>äºº</li>
<li>å…¬å¸</li>
</ul>
<p>å››ç§å…³ç³»ï¼š</p>
<ul>
<li><code>äºº</code> â€“<code>ä½œä¸ºäº²äºº</code>â€“&gt;<code>äºº</code></li>
<li><code>äºº</code> â€“<code>ä½œä¸ºè§’è‰²</code>â€“&gt; <code>å…¬å¸</code></li>
<li><code>äºº</code> æˆ–è€… <code>å…¬å¸</code> â€“<code>æŒæœ‰è‚¡ä»½</code>â€“&gt; <code>å…¬å¸</code></li>
<li><code>å…¬å¸</code> â€“<code>ä½œä¸ºå­æœºæ„</code>â€“&gt; <code>å…¬å¸</code></li>
</ul>
<p>è¿™é‡Œé¢ï¼Œå®ä½“ä¸å…³ç³»æœ¬èº«éƒ½å¯ä»¥åŒ…å«æ›´å¤šçš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åœ¨å›¾æ•°æ®åº“é‡Œå°±æ˜¯å®ä½“ã€å…³ç³»è‡ªèº«çš„å±æ€§ã€‚å¦‚ä¸‹å›¾è¡¨ç¤ºï¼š</p>
<ul>
<li><code>äºº</code>çš„å±æ€§åŒ…æ‹¬ <code>name</code>ï¼Œ<code>age</code></li>
<li><code>å…¬å¸</code>çš„å±æ€§åŒ…æ‹¬ <code>name</code>ï¼Œ<code>location</code></li>
<li><code>æŒæœ‰è‚¡ä»½</code> è¿™ä¸ªå…³ç³»æœ‰å±æ€§ <code>share</code>(ä»½é¢)</li>
<li><code>ä»»èŒ</code>è¿™ä¸ªå…³ç³»æœ‰å±æ€§ <code>role</code>ï¼Œ<code>level</code></li>
</ul>
<p></p>
<h2 id="æ•°æ®å…¥åº“" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e5%85%a5%e5%ba%93" class="header-mark"></a>3 æ•°æ®å…¥åº“</h2><p>æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å›¾æ•°æ®åº“å«åš Nebula Graphï¼ˆæ˜Ÿäº‘å›¾æ•°æ®åº“ï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»¥ Apache 2.0 è®¸å¯è¯å¼€æºçš„åˆ†å¸ƒå¼å›¾æ•°æ®åº“ã€‚</p>
<blockquote>
<p>Nebula Graph in Github: <a href="https://github.com/vesoft-inc/nebula" target="_blank" rel="noopener noreffer">https://github.com/vesoft-inc/nebula</a></p>
</blockquote>
<p>åœ¨å‘ Nebula Graph å¯¼å…¥æ•°æ®çš„æ—¶å€™ï¼Œå…³äºå¦‚ä½•é€‰æ‹©å·¥å…·ï¼Œè¯·å‚è€ƒ<a href="https://docs.nebula-graph.com.cn/2.6.1/20.appendix/write-tools/" target="_blank" rel="noopener noreffer">è¿™ç¯‡æ–‡æ¡£</a>å’Œ<a href="https://www.siwei.io/sketches/nebula-data-import-options/" target="_blank" rel="noopener noreffer">è¿™ä¸ªè§†é¢‘</a>ã€‚</p>
<p>è¿™é‡Œï¼Œç”±äºæ•°æ®æ ¼å¼æ˜¯ csv æ–‡ä»¶å¹¶ä¸”åˆ©ç”¨å•æœºçš„å®¢æˆ·ç«¯èµ„æºå°±è¶³å¤Ÿäº†ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨ nebula-importer æ¥å®Œæˆè¿™ä¸ªå·¥ä½œã€‚</p>
<blockquote>
<p>æç¤ºï¼šåœ¨å¯¼å…¥æ•°æ®ä¹‹å‰ï¼Œè¯·å…ˆéƒ¨ç½²ä¸€ä¸ª Nebula Graph é›†ç¾¤ï¼Œæœ€ç®€ä¾¿çš„éƒ¨ç½²æ–¹å¼æ˜¯ä½¿ç”¨ nebula-up è¿™ä¸ªå°å·¥å…·ï¼Œåªéœ€è¦ä¸€è¡Œå‘½ä»¤å°±èƒ½åœ¨ Linux æœºå™¨ä¸ŠåŒæ—¶å¯åŠ¨ä¸€ä¸ª Nebula Graph æ ¸å¿ƒå’Œå¯è§†åŒ–å›¾æ¢ç´¢å·¥å…·  <a href="https://docs.nebula-graph.com.cn/2.6.1/nebula-studio/about-studio/st-ug-what-is-graph-studio/" target="_blank" rel="noopener noreffer">Nebula Graph Studio</a>ã€‚å¦‚æœä½ æ›´æ„¿æ„ç”¨ Docker éƒ¨ç½²ï¼Œè¯·å‚è€ƒ<a href="https://docs.nebula-graph.com.cn/2.6.1/4.deployment-and-installation/2.compile-and-install-nebula-graph/3.deploy-nebula-graph-with-docker-compose/" target="_blank" rel="noopener noreffer">è¿™ä¸ªæ–‡æ¡£</a>ã€‚</p>
<p>æœ¬æ–‡å‡è®¾æˆ‘ä»¬ä½¿ç”¨ <a href="https://siwei.io/nebula-up/" target="_blank" rel="noopener noreffer">Nebula-UP</a> æ¥éƒ¨ç½²ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -fsSL nebula-up.siwei.io/install.sh <span class="p">|</span> bash
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<p>è¿™é‡Œçš„æ•°æ®æ˜¯<a href="https://github.com/wey-gu/nebula-shareholding-example" target="_blank" rel="noopener noreffer">ç”Ÿæˆå™¨</a>ç”Ÿæˆçš„ï¼Œä½ å¯ä»¥æŒ‰éœ€ç”Ÿæˆä»»æ„è§„æ¨¡éšæœºæ•°æ®é›†ï¼Œæˆ–è€…é€‰æ‹©ä¸€ä»½ç”Ÿæˆå¥½äº†çš„æ•°æ®åœ¨<a href="https://github.com/wey-gu/nebula-shareholding-example/tree/main/data_sample" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a></p>
<p>æœ‰äº†è¿™äº›<a href="https://github.com/wey-gu/nebula-shareholding-example/tree/main/data_sample" target="_blank" rel="noopener noreffer">æ•°æ®</a>ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹å¯¼å…¥äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ pip install <span class="nv">Faker</span><span class="o">==</span>2.0.5 <span class="nv">pydbgen</span><span class="o">==</span>1.0.5
</span></span><span class="line"><span class="cl">$ python3 data_generator.py
</span></span><span class="line"><span class="cl">$ ls -l data
</span></span><span class="line"><span class="cl">total <span class="m">1688</span>
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> weyl  staff   <span class="m">23941</span> Jul <span class="m">14</span> 13:28 corp.csv
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> weyl  staff    <span class="m">1277</span> Jul <span class="m">14</span> 13:26 corp_rel.csv
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> weyl  staff    <span class="m">3048</span> Jul <span class="m">14</span> 13:26 corp_share.csv
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> weyl  staff  <span class="m">211661</span> Jul <span class="m">14</span> 13:26 person.csv
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> weyl  staff  <span class="m">179770</span> Jul <span class="m">14</span> 13:26 person_corp_role.csv
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> weyl  staff  <span class="m">322965</span> Jul <span class="m">14</span> 13:26 person_corp_share.csv
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> weyl  staff   <span class="m">17689</span> Jul <span class="m">14</span> 13:26 person_rel.csv
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¼å…¥å·¥å…· <a href="https://github.com/vesoft-inc/nebula-importer" target="_blank" rel="noopener noreffer">nebula-importer</a> æ˜¯ä¸€ä¸ª golang çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½¿ç”¨æ–¹å¼å°±æ˜¯å°†å¯¼å…¥çš„ Nebula Graph è¿æ¥ä¿¡æ¯ã€æ•°æ®æºä¸­å­—æ®µçš„å«ä¹‰çš„ä¿¡æ¯å†™è¿› YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶é‡Œï¼Œç„¶åé€šè¿‡å‘½ä»¤è¡Œè°ƒç”¨å®ƒã€‚å¯ä»¥å‚è€ƒ<a href="https://docs.nebula-graph.com.cn/2.6.1/nebula-importer/use-importer/" target="_blank" rel="noopener noreffer">æ–‡æ¡£</a>æˆ–è€…å®ƒçš„ GitHub ä»“åº“é‡Œçš„ä¾‹å­ã€‚</p>
<p>è¿™é‡Œæˆ‘å·²ç»å†™å¥½äº†å‡†å¤‡å¥½äº†ä¸€ä»½ nebula-importer çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨æ•°æ®ç”Ÿæˆå™¨åŒä¸€ä¸ª repo ä¹‹ä¸‹çš„<a href="https://github.com/wey-gu/nebula-shareholding-example/blob/main/nebula-importer.yaml" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a>ã€‚</p>
<p>æœ€åï¼Œåªéœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å°±å¯ä»¥å¼€å§‹æ•°æ®å¯¼å…¥äº†ï¼š</p>
<blockquote>
<p>æ³¨æ„ï¼Œåœ¨å†™æœ¬æ–‡çš„æ—¶å€™ï¼Œnebula çš„æ–°ç‰ˆæœ¬æ˜¯ 2.6.1ï¼Œè¿™é‡Œå¯¹åº”çš„ nebula-importer æ˜¯ v2.6.0ï¼Œå¦‚æœæ‚¨å‡ºç°å¯¼å…¥é”™è¯¯å¯èƒ½æ˜¯ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œå¯ä»¥ç›¸åº”è°ƒæ•´ä¸‹è¾¹å‘½ä»¤ä¸­çš„ç‰ˆæœ¬å·ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/wey-gu/nebula-shareholding-example
</span></span><span class="line"><span class="cl">cp -r data_sample /tmp/data
</span></span><span class="line"><span class="cl">cp nebula-importer.yaml /tmp/data/
</span></span><span class="line"><span class="cl">docker run --rm -ti <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --network<span class="o">=</span>nebula-docker-compose_nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v /tmp/data:/root <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    vesoft/nebula-importer:v2.6.0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --config /root/nebula-importer.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ä½ çŸ¥é“å—ï¼ŸTL;DR</p>
<p>å®é™…ä¸Šï¼Œè¿™ä»½ importer çš„<a href="https://github.com/wey-gu/nebula-shareholding-example/blob/main/nebula-importer.yaml" target="_blank" rel="noopener noreffer">é…ç½®</a>é‡Œå¸®æˆ‘ä»¬åšäº† Nebula Graph ä¹‹ä¸­çš„å›¾å»ºæ¨¡çš„æ“ä½œï¼Œå®ƒä»¬çš„æŒ‡ä»¤åœ¨ä¸‹è¾¹ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨å»æ‰§è¡Œäº†ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">SPACE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">shareholding</span><span class="p">(</span><span class="n">partition_num</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">replica_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">vid_type</span><span class="o">=</span><span class="n">FIXED_STRING</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">USE</span><span class="w"> </span><span class="n">shareholding</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="n">person</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="n">string</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="n">corp</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="n">string</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">person_name</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">person</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">corp_name</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">corp</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">role_as</span><span class="p">(</span><span class="k">role</span><span class="w"> </span><span class="n">string</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">is_branch_of</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">hold_share</span><span class="p">(</span><span class="k">share</span><span class="w"> </span><span class="nb">float</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">reletive_with</span><span class="p">(</span><span class="n">degree</span><span class="w"> </span><span class="nb">int</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å›¾åº“ä¸­æŸ¥è¯¢æ•°æ®" class="headerLink">
    <a href="#%e5%9b%be%e5%ba%93%e4%b8%ad%e6%9f%a5%e8%af%a2%e6%95%b0%e6%8d%ae" class="header-mark"></a>4 å›¾åº“ä¸­æŸ¥è¯¢æ•°æ®</h2><blockquote>
<p>Tips: ä½ çŸ¥é“å—ï¼Œä½ ä¹Ÿå¯ä»¥æ— éœ€éƒ¨ç½²å®‰è£…ï¼Œé€šè¿‡ <a href="https://nebula-graph.com.cn/demo/" target="_blank" rel="noopener noreffer">Nebula-Playground</a> ä¹‹ä¸­ï¼Œæ‰¾åˆ°è‚¡æƒç©¿é€æ¥åœ¨çº¿è®¿é—®åŒä¸€ä»½æ•°æ®é›†ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥å€ŸåŠ©  <a href="https://docs.nebula-graph.com.cn/2.6.1/nebula-studio/about-studio/st-ug-what-is-graph-studio/" target="_blank" rel="noopener noreffer">Nebula Graph Studio</a> æ¥è®¿é—®æ•°æ®ï¼Œè®¿é—®æˆ‘ä»¬éƒ¨ç½² Nebula-UP çš„æœåŠ¡å™¨åœ°å€çš„ 7001 ç«¯å£å°±å¯ä»¥äº†ï¼š</p>
<p>å‡è®¾æœåŠ¡å™¨åœ°å€ä¸º <code>192.168.8.127</code>ï¼Œåˆ™æœ‰ï¼š</p>
<ul>
<li>Nebula Studio åœ°å€ï¼š<code>192.168.8.127:7001</code></li>
<li>Nebula Graph åœ°å€ï¼š<code>192.168.8.127:9669</code></li>
<li>é»˜è®¤ç”¨æˆ·åï¼š<code>root</code></li>
<li>é»˜è®¤å¯†ç ï¼š<code>nebula</code></li>
</ul>
<p>è®¿é—® Nebula Studioï¼š</p>
<p></p>
<p>é€‰æ‹©å›¾ç©ºé—´: Shareholding</p>
<p></p>
<p>ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨é‡Œè¾¹æ¢ç´¢æ¯”å¦‚ä¸€ä¸ªå…¬å¸çš„ä¸‰è·³ä»¥å†…çš„è‚¡æƒç©¿é€ï¼Œå…·ä½“çš„æ“ä½œå¯ä»¥å‚è€ƒï¼š<a href="https://nebula-graph.com.cn/demo/shared-holding/" target="_blank" rel="noopener noreffer">è‚¡æƒç©¿é€åœ¨çº¿ Playground çš„ä»‹ç»</a>ï¼š</p>
<p></p>
<h2 id="æ„å»ºä¸€ä¸ªå›¾è°±ç³»ç»Ÿ" class="headerLink">
    <a href="#%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e5%9b%be%e8%b0%b1%e7%b3%bb%e7%bb%9f" class="header-mark"></a>5 æ„å»ºä¸€ä¸ªå›¾è°±ç³»ç»Ÿ</h2><blockquote>
<p>è¿™éƒ¨åˆ†çš„ä»£ç å¼€æºåœ¨ GitHub ä¸Šï¼š</p>
<p><a href="https://github.com/wey-gu/nebula-corp-rel-search" target="_blank" rel="noopener noreffer">https://github.com/wey-gu/nebula-corp-rel-search</a></p>
<p>æœ¬é¡¹ç›®çš„ Demo ä¹Ÿåœ¨ PyCon China 2021 ä¸Šçš„æ¼”è®²ä¸­æœ‰è¿‡å±•ç¤ºï¼š<a href="https://www.bilibili.com/video/BV12u411o7Y6" target="_blank" rel="noopener noreffer">è§†é¢‘åœ°å€</a></p>
</blockquote>
<p>åœ¨æ­¤åŸºç¡€ä¹‹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªæä¾›ç»™ç»ˆç«¯ç”¨æˆ·æ¥ä½¿ç”¨çš„è‚¡æƒæŸ¥è¯¢ç³»ç»Ÿäº†ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†å›¾æ•°æ®åº“ä½œä¸ºè¿™ä¸ªå›¾è°±çš„å­˜å‚¨å¼•æ“ï¼Œç†è®ºä¸Šï¼Œå¦‚æœä¸šåŠ¡å…è®¸ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨æˆ–è€…å°è£… Nebula Graph Studio æ¥æä¾›æœåŠ¡ï¼Œè¿™å®Œå…¨æ˜¯å¯è¡Œä¹Ÿæ˜¯åˆè§„çš„ï¼Œä¸è¿‡ï¼Œæœ‰ä¸€äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å»å®ç°ç•Œé¢ã€æˆ–è€…æˆ‘ä»¬éœ€è¦å°è£…å‡ºä¸€ä¸ª API ç»™ä¸Šæ¸¸ï¼ˆå¤šç«¯ï¼‰æä¾›å›¾è°±æŸ¥è¯¢çš„åŠŸèƒ½ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä¸ºå¤§å®¶å†™äº†ä¸€ä¸ªç®€å•çš„å®ä¾‹é¡¹ç›®ï¼Œæä¾›è¿™æ ·çš„æœåŠ¡ï¼Œä»–çš„æ¶æ„ä¹Ÿå¾ˆç›´æ¥ï¼š</p>
<ul>
<li>å‰ç«¯æ¥å—ç”¨æˆ·è¦æŸ¥è¯¢çš„ç©¿é€æ³•äººã€å…¬å¸ï¼ŒæŒ‰éœ€å‘è¯·æ±‚ç»™åç«¯ï¼Œå¹¶ç”¨ D3.js å°†è¿”å›ç»“æœæ¸²æŸ“ä¸ºå…³ç³»å›¾</li>
<li>åç«¯æ¥å—å‰ç«¯çš„ API è¯·æ±‚ï¼Œå°†è¯·æ±‚è½¬æ¢ä¸º Graph DB çš„æŸ¥è¯¢ï¼Œå¹¶è¿”å›å‰ç«¯æœŸå¾…çš„ç»“æœ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">  â”‚               â”‚  Frontend     â”‚
</span></span><span class="line"><span class="cl">  â”‚               â”‚               â”‚
</span></span><span class="line"><span class="cl">  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
</span></span><span class="line"><span class="cl">  â”‚    â”‚ Vue.JS              â”‚    â”‚
</span></span><span class="line"><span class="cl">  â”‚    â”‚ D3.JS               â”‚    â”‚
</span></span><span class="line"><span class="cl">  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
</span></span><span class="line"><span class="cl">  â”‚               â”‚  Backend      â”‚
</span></span><span class="line"><span class="cl">  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
</span></span><span class="line"><span class="cl">  â”‚    â”‚ Flask               â”‚    â”‚
</span></span><span class="line"><span class="cl">  â”‚    â”‚ Nebula-Python       â”‚    â”‚
</span></span><span class="line"><span class="cl">  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
</span></span><span class="line"><span class="cl">  â”‚               â”‚  Graph Query  â”‚
</span></span><span class="line"><span class="cl">  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
</span></span><span class="line"><span class="cl">  â”‚    â”‚ Graph Database      â”‚    â”‚
</span></span><span class="line"><span class="cl">  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
</span></span><span class="line"><span class="cl">  â”‚                               â”‚
</span></span><span class="line"><span class="cl">  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åç«¯æœåŠ¡--å›¾æ•°æ®åº“" class="headerLink">
    <a href="#%e5%90%8e%e7%ab%af%e6%9c%8d%e5%8a%a1--%e5%9b%be%e6%95%b0%e6%8d%ae%e5%ba%93" class="header-mark"></a>5.1 åç«¯æœåŠ¡&ndash;&gt;å›¾æ•°æ®åº“</h3><blockquote>
<p>è¯¦ç»†çš„æ•°æ®æ ¼å¼åˆ†æå¤§å®¶å¯ä»¥å‚è€ƒ<a href="https://github.com/wey-gu/nebula-corp-rel-search#data-from-backend-side" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a></p>
</blockquote>
<h4 id="æŸ¥è¯¢è¯­å¥" class="headerLink">
    <a href="#%e6%9f%a5%e8%af%a2%e8%af%ad%e5%8f%a5" class="header-mark"></a>5.1.1 æŸ¥è¯¢è¯­å¥</h4><p>æˆ‘ä»¬å‡è®¾ç”¨æˆ·è¯·æ±‚çš„å®ä½“æ˜¯ <code>c_132</code> ï¼Œé‚£ä¹ˆè¯·æ±‚ 1 åˆ° 3 æ­¥çš„å…³ç³»ç©¿é€çš„è¯­æ³•æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MATCH p=(v)-[e:hold_share|:is_branch_of|:reletive_with|:role_as*1..3]-(v2) \
</span></span><span class="line"><span class="cl">WHERE id(v) IN [&#34;c_132&#34;] RETURN p LIMIT 100
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œè¾¹ <code>()</code>åŒ…è£¹çš„æ˜¯å›¾ä¹‹ä¸­çš„ç‚¹ï¼Œè€Œ<code>[]</code> åŒ…è£¹çš„åˆ™æ˜¯ç‚¹ä¹‹é—´çš„å…³ç³»ï¼šè¾¹ï¼Œæ‰€ä»¥ï¼š</p>
<p><code>(v)-[e:hold_share|:is_branch_of|:reletive_with|:role_as*1..3]-(v2)</code> ä¹‹ä¸­çš„ï¼š</p>
<p><code>(v)-[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]-(v2)</code>åº”è¯¥æ¯”è¾ƒå¥½ç†è§£ï¼Œæ„æ€æ˜¯ä» <code>v</code> åˆ°<code>v2</code> åšæ‹“å±•ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬ä»‹ç»ä¸­é—´<code>[]</code>åŒ…è£¹çš„éƒ¨åˆ†ï¼Œè¿™é‡Œï¼Œå®ƒçš„è¯­ä¹‰æ˜¯ï¼šç»ç”±å››ç§ç±»å‹çš„è¾¹ï¼ˆ<code>:</code>ä¹‹åçš„æ˜¯è¾¹çš„ç±»å‹ï¼Œ<code>|</code>ä»£è¡¨æˆ–è€…ï¼‰é€šè¿‡å¯å˜çš„è·³æ•°ï¼š<code>*1..3</code> ï¼ˆä¸€è·³åˆ°ä¸‰è·³ï¼‰ã€‚</p>
<p>æ‰€ä»¥ï¼Œç®€å•æ¥è¯´æ•´ç†çœ‹å¼€ï¼Œæˆ‘ä»¬çš„æ‹“å±•çš„è·¯å¾„æ˜¯ï¼šä»ç‚¹ <code>v</code> å¼€å§‹ï¼Œç»ç”±å››ç§å…³ç³»ä¸€åˆ°ä¸‰è·³æ‹“å±•åˆ°ç‚¹<code>v2</code>ï¼Œè¿”å›æ•´ä¸ªæ‹“å±•è·¯å¾„ <code>p</code>ï¼Œé™åˆ¶ 100 ä¸ªè·¯å¾„ç»“æœï¼Œå…¶ä¸­ <code>v</code> æ˜¯ <code>c_132</code>ã€‚</p>
<h4 id="nebula-python-client-sdk" class="headerLink">
    <a href="#nebula-python-client-sdk" class="header-mark"></a>5.1.2 Nebula Python Client/ SDK</h4><p>æˆ‘ä»¬å·²ç»çŸ¥é“äº†æŸ¥è¯¢è¯­å¥çš„è¯­æ³•ï¼Œé‚£ä¹ˆå°±åªéœ€è¦åœ¨åç«¯ç¨‹åºé‡Œæ ¹æ®è¯·æ±‚ã€é€šè¿‡å›¾æ•°æ®åº“çš„å®¢æˆ·ç«¯æ¥å‘å‡ºæŸ¥è¯¢è¯·æ±‚ï¼Œå¹¶å¤„ç†è¿”å›ç»“æ„å°±å¥½äº†ã€‚åœ¨ä»Šå¤©çš„ä¾‹å­ä¸­ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨ Python æ¥å®ç°åç«¯çš„é€»è¾‘ï¼Œæ‰€ä»¥æˆ‘ç”¨äº† Nebula-python è¿™ä¸ªåº“ï¼Œå®ƒæ˜¯ Nebula çš„ Python Clientã€‚</p>
<blockquote>
<p>ä½ çŸ¥é“ä¹ˆï¼Ÿæˆªè‡³åˆ°ç°åœ¨ï¼ŒNebula åœ¨ GitHub ä¸Šæœ‰ Javaï¼ŒGOï¼ŒPythonï¼ŒC++ï¼ŒSparkï¼ŒFlinkï¼ŒRustï¼ˆæœªGAï¼‰ï¼ŒNodeJSï¼ˆæœªGAï¼‰ çš„å®¢æˆ·ç«¯æ”¯æŒï¼Œæ›´å¤šçš„è¯­è¨€çš„å®¢æˆ·ç«¯ä¹Ÿä¼šæ…¢æ…¢è¢«å‘å¸ƒå“¦ã€‚</p>
</blockquote>
<p>ä¸‹è¾¹æ˜¯ä¸€ä¸ª Python Client æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢å¹¶è¿”å›ç»“æœçš„ä¾‹å­ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æˆ‘å®ç°è¿™ä¸ªä»£ç çš„æ—¶å€™ï¼ŒNebula Python å°šæœªæ”¯æŒè¿”å› JSON ï¼ˆé€šè¿‡<code>session.execute_json()</code>ï¼‰ç»“æœï¼Œå¦‚æœä½ è¦å®ç°è‡ªå·±çš„ä»£ç ï¼Œæˆ‘éå¸¸æ¨èè¯•è¯• JSON å“ˆï¼Œå°±å¯ä»¥ä¸ç”¨ä»å¯¹è±¡ä¸­ä¸€ç‚¹ç‚¹å–æ•°æ®äº†ï¼Œä¸è¿‡å€ŸåŠ© iPython/IDLE è¿™ç§ <code>REPL</code>ï¼Œå¿«é€Ÿäº†è§£è¿”å›å¯¹è±¡çš„ç»“æ„ä¹Ÿæ²¡æœ‰é‚£ä¹ˆéº»çƒ¦ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">nebula2</span><span class="o">-</span><span class="n">python</span><span class="o">==</span><span class="mf">2.5.0</span> <span class="c1"># æ³¨æ„è¿™é‡Œæˆ‘å¼•ç”¨æ—§çš„è®°å½•ï¼Œå®ƒæ˜¯ 2.5.0ï¼Œ</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">ipython</span>
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">nebula2.gclient.net</span> <span class="kn">import</span> <span class="n">ConnectionPool</span>
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">nebula2.Config</span> <span class="kn">import</span> <span class="n">Config</span>
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="o">...</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">max_connection_pool_size</span> <span class="o">=</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl">   <span class="o">...</span><span class="p">:</span> <span class="c1"># init connection pool</span>
</span></span><span class="line"><span class="cl">   <span class="o">...</span><span class="p">:</span> <span class="n">connection_pool</span> <span class="o">=</span> <span class="n">ConnectionPool</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="o">...</span><span class="p">:</span> <span class="c1"># if the given servers are ok, return true, else return false</span>
</span></span><span class="line"><span class="cl">   <span class="o">...</span><span class="p">:</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">init</span><span class="p">([(</span><span class="s1">&#39;192.168.8.137&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">)],</span> <span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">...</span><span class="p">:</span> <span class="n">session</span> <span class="o">=</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;nebula&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">13</span> <span class="mi">13</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span><span class="mi">242</span><span class="p">]:</span><span class="n">Get</span> <span class="n">connection</span> <span class="n">to</span> <span class="p">(</span><span class="s1">&#39;192.168.8.137&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;use shareholding&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">   ...: MATCH p=(v)-[e:hold_share|:is_branch_of|:reletive_with|:role_as*1..3]-(v2) </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">   ...: WHERE id(v) IN [&#34;c_132&#34;] RETURN p LIMIT 100
</span></span></span><span class="line"><span class="cl"><span class="s1">   ...: &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="c1"># Note: after nebula graph 2.6.0, we could use execute_json as well</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">resp</span><span class="o">.</span><span class="n">col_size</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">resp</span><span class="o">.</span><span class="n">row_size</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="mi">100</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¾€ä¸‹åˆ†æçœ‹çœ‹ï¼Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ªè¯·æ±‚æœ¬è´¨ä¸Šç»“æœæ˜¯è·¯å¾„ï¼Œå®ƒæœ‰ä¸€ä¸ª <code>.nodes()</code> æ–¹æ³•å’Œ <code>.relationships()</code>æ–¹æ³•æ¥è·å¾—è·¯å¾„ä¸Šçš„ç‚¹å’Œè¾¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">p</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">row_values</span><span class="p">(</span><span class="mi">22</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_path</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="p">[(</span><span class="s2">&#34;c_132&#34;</span> <span class="p">:</span><span class="n">corp</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Chambers LLC&#34;</span><span class="p">}),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="s2">&#34;p_4000&#34;</span> <span class="p">:</span><span class="n">person</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Colton Bailey&#34;</span><span class="p">})]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">relationships</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="p">[(</span><span class="s2">&#34;p_4000&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">role_as</span><span class="o">@</span><span class="mi">0</span><span class="p">{</span><span class="n">role</span><span class="p">:</span> <span class="s2">&#34;Editorial assistant&#34;</span><span class="p">}]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;c_132&#34;</span><span class="p">)]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºè¾¹æ¥è¯´æœ‰è¿™äº›æ–¹æ³• <code>.edge_name()</code>, <code>.properties()</code>, <code>.start_vertex_id()</code>, <code>.end_vertex_id()</code>ï¼Œè¿™é‡Œ edge_name æ˜¯è·å¾—è¾¹çš„ç±»å‹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">rel</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">relationships</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">rel</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="p">(</span><span class="s2">&#34;p_4000&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">role_as</span><span class="o">@</span><span class="mi">0</span><span class="p">{</span><span class="n">role</span><span class="p">:</span> <span class="s2">&#34;Editorial assistant&#34;</span><span class="p">}]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;c_132&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">rel</span><span class="o">.</span><span class="n">edge_name</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s1">&#39;role_as&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">rel</span><span class="o">.</span><span class="n">properties</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="s2">&#34;Editorial assistant&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">rel</span><span class="o">.</span><span class="n">start_vertex_id</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="s2">&#34;p_4000&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">rel</span><span class="o">.</span><span class="n">end_vertex_id</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="s2">&#34;c_132&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºç‚¹æ¥è¯´ï¼Œå¯ä»¥ç”¨åˆ°è¿™äº›æ–¹æ³• <code>.tags()</code>, <code>properties</code>, <code>get_id()</code>ï¼Œè¿™é‡Œè¾¹ tags æ˜¯è·å¾—ç‚¹çš„ç±»å‹ï¼Œå®ƒåœ¨ Nebula é‡Œå«æ ‡ç­¾<code>tag</code>ã€‚</p>
<p>è¿™äº›æ¦‚å¿µå¯ä»¥åœ¨<a href="https://docs.nebula-graph.com.cn/2.6.1/1.introduction/2.data-model/" target="_blank" rel="noopener noreffer">æ–‡æ¡£é‡Œ</a>è·å¾—æ›´è¯¦ç»†çš„è§£é‡Šã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">node</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">nodes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">node</span><span class="o">.</span><span class="n">tags</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;corp&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">node</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="s1">&#39;corp&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&#34;Chambers LLC&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">node</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="s2">&#34;c_132&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å‰ç«¯æ¸²æŸ“ç‚¹è¾¹ä¸ºå›¾" class="headerLink">
    <a href="#%e5%89%8d%e7%ab%af%e6%b8%b2%e6%9f%93%e7%82%b9%e8%be%b9%e4%b8%ba%e5%9b%be" class="header-mark"></a>5.2 å‰ç«¯æ¸²æŸ“ç‚¹è¾¹ä¸ºå›¾</h3><blockquote>
<p>è¯¦ç»†çš„åˆ†æå¤§å®¶ä¹Ÿå¯ä»¥å‚è€ƒ<a href="https://github.com/wey-gu/nebula-corp-rel-search#data-visualization" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a></p>
</blockquote>
<p>ä¸ºäº†æ–¹ä¾¿å®ç°ï¼Œæˆ‘ä»¬é‡‡ç”¨äº† Vue.js å’Œ <a href="https://github.com/ChenCyl/vue-network-d3" target="_blank" rel="noopener noreffer">vue-network-d3</a>ï¼ˆD3 çš„ Vue Bindingï¼‰ã€‚</p>
<p>é€šè¿‡ vue-network-d3 çš„æŠ½è±¡ï¼Œèƒ½çœ‹å‡ºæ¥å–‚ç»™ä»–è¿™æ ·çš„æ•°æ®ï¼Œå°±å¯ä»¥æŠŠç‚¹è¾¹ä¿¡æ¯æ¸²æŸ“æˆå¾ˆå¥½çœ‹çš„å›¾</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">nodes</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;c_132&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Chambers LLC&#34;</span><span class="p">,</span> <span class="s2">&#34;tag&#34;</span><span class="p">:</span> <span class="s2">&#34;corp&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;p_4000&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Colton Bailey&#34;</span><span class="p">,</span> <span class="s2">&#34;tag&#34;</span><span class="p">:</span> <span class="s2">&#34;person&#34;</span><span class="p">}],</span>
</span></span><span class="line"><span class="cl"><span class="n">relationships</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s2">&#34;source&#34;</span><span class="p">:</span> <span class="s2">&#34;p_4000&#34;</span><span class="p">,</span> <span class="s2">&#34;target&#34;</span><span class="p">:</span> <span class="s2">&#34;c_132&#34;</span><span class="p">,</span> <span class="s2">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;Editorial assistant&#34;</span> <span class="p">},</span> <span class="s2">&#34;edge&#34;</span><span class="p">:</span> <span class="s2">&#34;role_as&#34;</span><span class="p">}]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p></p>
<h3 id="å‰ç«¯--åç«¯" class="headerLink">
    <a href="#%e5%89%8d%e7%ab%af--%e5%90%8e%e7%ab%af" class="header-mark"></a>5.3 å‰ç«¯&lt;&ndash;åç«¯</h3><blockquote>
<p>è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒ<a href="https://github.com/wey-gu/nebula-corp-rel-search#the-data-construction-in-back-end" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a></p>
</blockquote>
<p>æˆ‘ä»¬ä» D3 çš„åˆæ­¥ç ”ç©¶ä¸Šå¯ä»¥çŸ¥é“ï¼Œåç«¯åªéœ€è¦è¿”å›å¦‚ä¸‹çš„ JSON æ ¼å¼æ•°æ®å°±å¥½äº†</p>
<p>Nodes:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[{</span><span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;c_132&#34;</span><span class="p">,</span> <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Chambers LLC&#34;</span><span class="p">,</span> <span class="nt">&#34;tag&#34;</span><span class="p">:</span> <span class="s2">&#34;corp&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;p_4000&#34;</span><span class="p">,</span> <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Colton Bailey&#34;</span><span class="p">,</span> <span class="nt">&#34;tag&#34;</span><span class="p">:</span> <span class="s2">&#34;person&#34;</span><span class="p">}]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Relationships:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[{</span><span class="nt">&#34;source&#34;</span><span class="p">:</span> <span class="s2">&#34;p_4000&#34;</span><span class="p">,</span> <span class="nt">&#34;target&#34;</span><span class="p">:</span> <span class="s2">&#34;c_132&#34;</span><span class="p">,</span> <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;Editorial assistant&#34;</span> <span class="p">},</span> <span class="nt">&#34;edge&#34;</span><span class="p">:</span> <span class="s2">&#34;role_as&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="nt">&#34;source&#34;</span><span class="p">:</span> <span class="s2">&#34;p_1039&#34;</span><span class="p">,</span> <span class="nt">&#34;target&#34;</span><span class="p">:</span> <span class="s2">&#34;c_132&#34;</span><span class="p">,</span> <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&#34;share&#34;</span><span class="p">:</span> <span class="s2">&#34;3.0&#34;</span> <span class="p">},</span> <span class="nt">&#34;edge&#34;</span><span class="p">:</span> <span class="s2">&#34;hold_share&#34;</span><span class="p">}]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>äºæ˜¯ï¼Œï¼Œç»“åˆå‰è¾¹æˆ‘ä»¬ç”¨ iPython åˆ†æ Python è¿”å›ç»“æœçœ‹ï¼Œè¿™ä¸ªé€»è¾‘å¤§æ¦‚æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">make_graph_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">nodes</span><span class="p">,</span> <span class="n">relationships</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">row_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">row_size</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">        <span class="n">path</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">row_values</span><span class="p">(</span><span class="n">row_index</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_path</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">_nodes</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">get_id</span><span class="p">(),</span> <span class="s2">&#34;tag&#34;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">tags</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">tags</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">nodes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_nodes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">_relationships</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;source&#34;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">start_vertex_id</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;target&#34;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">end_vertex_id</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;properties&#34;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">properties</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;edge&#34;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">edge_name</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">relationships</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">relationships</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_relationships</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;nodes&#34;</span><span class="p">:</span> <span class="n">nodes</span><span class="p">,</span> <span class="s2">&#34;relationships&#34;</span><span class="p">:</span> <span class="n">relationships</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‰ç«¯åˆ°åç«¯çš„é€šä¿¡æ˜¯ HTTP ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å€ŸåŠ© Flaskï¼ŒæŠŠè¿™ä¸ªå‡½æ•°å°è£…æˆä¸€ä¸ª RESTful APIï¼š</p>
<p>å‰ç«¯ç¨‹åºé€šè¿‡ HTTP POST åˆ° <code>/api</code></p>
<blockquote>
<p>å‚è€ƒ<a href="https://github.com/wey-gu/nebula-corp-rel-search#the-flask-app" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">root</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;Hey There?&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&#34;/api&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;POST&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">api</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">request_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">entity</span> <span class="o">=</span> <span class="n">request_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;entity&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">entity</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">resp</span> <span class="o">=</span> <span class="n">query_shareholding</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="n">make_graph_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span> <span class="c1"># tbd</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">parse_nebula_graphd_endpoint</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">ng_endpoints_str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;NG_ENDPOINTS&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1:9669,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;,&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ng_endpoints</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">ng_endpoints_str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">endpoint</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">parts</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">)</span>  <span class="c1"># we dont consider IPv6 now</span>
</span></span><span class="line"><span class="cl">            <span class="n">ng_endpoints</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ng_endpoints</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">query_shareholding</span><span class="p">(</span><span class="n">entity</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">query_string</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s2">&#34;USE shareholding; &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s2">&#34;MATCH p=(v)-[e:hold_share|:is_branch_of|:reletive_with|:role_as*1..3]-(v2) &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s2">&#34;WHERE id(v) IN [&#39;</span><span class="si">{</span> <span class="n">entity</span> <span class="si">}</span><span class="s2">&#39;] RETURN p LIMIT 100&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span> <span class="o">=</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;nebula&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query_string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">resp</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªè¯·æ±‚çš„ç»“æœåˆ™æ˜¯å‰è¾¹å‰ç«¯æœŸå¾…çš„ JSONï¼Œåƒè¿™æ ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl --header <span class="s2">&#34;Content-Type: application/json&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     --request POST <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     --data <span class="s1">&#39;{&#34;entity&#34;: &#34;c_132&#34;}&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     http://192.168.10.14:5000/api <span class="p">|</span> jq
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;nodes&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;id&#34;</span>: <span class="s2">&#34;c_132&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;\&#34;Chambers LLC\&#34;&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;tag&#34;</span>: <span class="s2">&#34;corp&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>,
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;id&#34;</span>: <span class="s2">&#34;c_245&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;\&#34;Thompson-King\&#34;&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;tag&#34;</span>: <span class="s2">&#34;corp&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>,
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;id&#34;</span>: <span class="s2">&#34;c_132&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;\&#34;Chambers LLC\&#34;&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;tag&#34;</span>: <span class="s2">&#34;corp&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>,
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">]</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;relationships&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;edge&#34;</span>: <span class="s2">&#34;hold_share&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;properties&#34;</span>: <span class="s2">&#34;{&#39;share&#39;: 0.0}&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;source&#34;</span>: <span class="s2">&#34;c_245&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;target&#34;</span>: <span class="s2">&#34;c_132&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;edge&#34;</span>: <span class="s2">&#34;hold_share&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;properties&#34;</span>: <span class="s2">&#34;{&#39;share&#39;: 9.0}&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;source&#34;</span>: <span class="s2">&#34;p_1767&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;target&#34;</span>: <span class="s2">&#34;c_132&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>,
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;edge&#34;</span>: <span class="s2">&#34;hold_share&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;properties&#34;</span>: <span class="s2">&#34;{&#39;share&#39;: 11.0}&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;source&#34;</span>: <span class="s2">&#34;p_1997&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;target&#34;</span>: <span class="s2">&#34;c_132&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>,
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">    <span class="o">}</span>,
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;edge&#34;</span>: <span class="s2">&#34;reletive_with&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;properties&#34;</span>: <span class="s2">&#34;{&#39;degree&#39;: 51}&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;source&#34;</span>: <span class="s2">&#34;p_7283&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;target&#34;</span>: <span class="s2">&#34;p_4723&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ”¾åˆ°ä¸€èµ·" class="headerLink">
    <a href="#%e6%94%be%e5%88%b0%e4%b8%80%e8%b5%b7" class="header-mark"></a>5.4 æ”¾åˆ°ä¸€èµ·</h3><p>é¡¹ç›®çš„ä»£ç éƒ½åœ¨ GitHub ä¸Šï¼Œæœ€åå…¶å®åªæœ‰ä¸€ä¸¤ç™¾è¡Œçš„ä»£ç ï¼ŒæŠŠæ‰€æœ‰ä¸œè¥¿æ‹¼èµ·æ¥ä¹‹åçš„ä»£ç æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">â”œâ”€â”€ README.md         <span class="c1"># You could find Design Logs here</span>
</span></span><span class="line"><span class="cl">â”œâ”€â”€ corp-rel-backend
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ app.py        <span class="c1"># Flask App to handle Requst and calls GDB</span>
</span></span><span class="line"><span class="cl">â”œâ”€â”€ corp-rel-frontend
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ src
</span></span><span class="line"><span class="cl">â”‚       â”œâ”€â”€ App.vue
</span></span><span class="line"><span class="cl">â”‚       â””â”€â”€ main.js   <span class="c1"># Vue App to call Flask App and Renders Graph</span>
</span></span><span class="line"><span class="cl">â””â”€â”€ requirements.txt
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æœ€ç»ˆæ•ˆæœ" class="headerLink">
    <a href="#%e6%9c%80%e7%bb%88%e6%95%88%e6%9e%9c" class="header-mark"></a>5.5 æœ€ç»ˆæ•ˆæœ</h3><p>æˆ‘ä»¬åšå‡ºæ¥äº†ä¸€ä¸ªç®€é™‹ä½†æ˜¯è¶³å¤Ÿå…·æœ‰å‚è€ƒæ€§çš„å°ç³»ç»Ÿï¼Œå®ƒæ¥å—ä¸€ä¸ªç”¨æˆ·è¾“å…¥çš„å®ä½“çš„ IDï¼Œå†å›è½¦ä¹‹åï¼š</p>
<ul>
<li>å‰ç«¯ç¨‹åºæŠŠè¯·æ±‚å‘ç»™åç«¯</li>
<li>åç«¯æ‹¼æ¥ Nebula Graph çš„æŸ¥è¯¢è¯­å¥ï¼Œé€šè¿‡ Nebula Python å®¢æˆ·ç«¯è¯·æ±‚ Nebula Graph</li>
<li>Nebula Graph æ¥å—è¯·æ±‚åšå‡ºç©¿é€æŸ¥è¯¢ï¼Œè¿”å›ç»“æ„ç»™åç«¯</li>
<li>åç«¯å°†ç»“æœæ„å»ºæˆå‰ç«¯ D3 æ¥å—çš„æ ¼å¼ï¼Œä¼ ç»™å‰ç«¯</li>
<li>å‰ç«¯æ¥æ”¶åˆ°å›¾ç»“æ„çš„æ•°æ®ï¼Œæ¸²æŸ“è‚¡æƒç©¿é€çš„æ•°æ®å¦‚ä¸‹ï¼š</li>
</ul>
<video width="800" controls>
  <source src="./demo.mov" type="video/mp4"> 
</video>
<h2 id="æ€»ç»“" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93" class="header-mark"></a>6 æ€»ç»“</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬çŸ¥é“å¾—ç›Šäºå›¾æ•°æ®åº“çš„è®¾è®¡ï¼Œåœ¨å®ƒä¸Šè¾¹æ„å»ºä¸€ä¸ªæ–¹ä¾¿çš„è‚¡æƒåˆ†æç³»ç»Ÿéå¸¸è‡ªç„¶ã€é«˜æ•ˆï¼Œæˆ‘ä»¬æˆ–è€…åˆ©ç”¨å›¾æ•°æ®åº“çš„å›¾æ¢ç´¢å¯è§†åŒ–èƒ½åŠ›ã€æˆ–è€…è‡ªå·±æ­å»ºï¼Œå¯ä»¥ä¸ºç”¨æˆ·æä¾›éå¸¸é«˜æ•ˆã€ç›´è§‚çš„å¤šè·³è‚¡æƒç©¿é€åˆ†æã€‚</p>
<p>å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºåˆ†å¸ƒå¼å›¾æ•°æ®åº“çš„çŸ¥è¯†ï¼Œæ¬¢è¿å…³æ³¨ Nebula Graph è¿™ä¸ªå¼€æºé¡¹ç›®ï¼Œå®ƒå·²ç»è¢«å›½å†…å¾ˆå¤šå›¢é˜Ÿã€å…¬å¸è®¤å¯é€‰ä¸ºå›¾æ—¶ä»£æ•°æ®æŠ€æœ¯å­˜å‚¨å±‚çš„åˆ©å™¨ï¼Œå¤§å®¶å¯ä»¥è®¿é—®<a href="https://nebula-graph.com.cn/cases" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a>ï¼Œæˆ–è€…<a href="https://nebula-graph.com.cn/posts/" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a>ï¼Œäº†è§£æ›´å¤šç›¸å…³çš„åˆ†äº«å’Œæ–‡ç« ã€‚</p>
<p>æœªæ¥ï¼Œæˆ‘ä¼šç»™å¤§å®¶åˆ†äº«æ›´å¤šå›¾æ•°æ®åº“ç›¸å…³çš„æ–‡ç« ã€è§†é¢‘å’Œå¼€æºç¤ºä¾‹é¡¹ç›®æ€è·¯åˆ†äº«å’Œæ•™ç¨‹ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨æˆ‘çš„ç½‘ç«™: siwei.ioã€‚</p>
<blockquote>
<p>é¢˜å›¾ç‰ˆæƒï¼š<a href="https://unsplash.com/photos/oyXis2kALVg" target="_blank" rel="noopener noreffer">fabioha</a></p>
</blockquote>]]></description>
</item></channel>
</rss>
