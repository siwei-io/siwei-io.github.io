<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>siwei.io</title>
        <link>https://siwei.io/</link>
        <description>Siwei(æ€ä¸º) builds things and believes in Open Source.</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>weyl.gu@gmail.com (Wey Gu)</managingEditor>
            <webMaster>weyl.gu@gmail.com (Wey Gu)</webMaster><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Tue, 06 Jun 2023 13:34:52 &#43;0800</lastBuildDate>
            <atom:link href="https://siwei.io/index.xml" rel="self" type="application/rss+xml" />
        <item>
    <title>NebulaGraph in Jupyter Notebook</title>
    <link>https://siwei.io/nebulagraph-in-jupyter-notebook/</link>
    <pubDate>Tue, 06 Jun 2023 13:34:52 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/nebulagraph-in-jupyter-notebook/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/nebulagraph-in-jupyter-notebook/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Jupyter Notebook ä¸­æ›´æ–¹ä¾¿åœ°ç© NebulaGraph å›¾æ•°æ®åº“äº†ï¼Œåªéœ€è¦<code>%ngql MATCH p=(n:player)-&gt;() RETURN p</code> å°±å¯ä»¥ç›´æ¥æŸ¥è¯¢ ï¼Œ<code>%ng_draw</code> å°±å¯ä»¥ç”»å‡ºè¿”å›ç»“æœã€‚</p>
</blockquote>
<p><a href="https://www.siwei.io/en/nebulagraph-in-jupyter-notebook/" target="_blank" rel="noopener noreferrer">English version</a></p>
<p>æœ€è¿‘ï¼Œæˆ‘æŠŠä¸¤å¹´å‰ä¸€ç›´æ²¡å®Œæˆçš„ NebulaGraph çš„ Jupyter Notebook æ‰©å±•ï¼š <code>ipython-ngql</code> é‡æ„ï¼Œæ­£å¼å‘å¸ƒäº†ï¼Œç°åœ¨å®ƒé™¤äº†å®Œå…¨é€‚é… NebulaGrpah 3.x æ‰€æœ‰æŸ¥è¯¢ä¹‹å¤–ï¼Œè¿˜æ”¯æŒäº† Notebook å†…çš„è¿”å›ç»“æœå¯è§†åŒ–ï¼Œæœ¬æ–‡ç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨  <code>ipython-ngql</code> ï¼</p>
<h2 id="å®‰è£…" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85" class="header-mark"></a>1 å®‰è£…</h2><p>å®‰è£…éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨ Jupyter Notebook é‡Œè¾¹æ‰§è¡Œ <code>%pip install ipython-ngql</code> ç„¶åå†åŠ è½½å®ƒå°±å¥½ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">ipython</span><span class="o">-</span><span class="n">ngql</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">load_ext</span> <span class="n">ngql</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ <code>%ngql</code> è¿™ä¸ª Jupyter Magic word è¿æ¥ NebulaGraph äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">ngql</span> <span class="o">--</span><span class="n">address</span> <span class="mf">127.0.0.1</span> <span class="o">--</span><span class="n">port</span> <span class="mi">9669</span> <span class="o">--</span><span class="n">user</span> <span class="n">root</span> <span class="o">--</span><span class="n">password</span> <span class="n">nebula</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“è¿æ¥æˆåŠŸä¹‹åï¼Œ<code>SHOW SPACES</code> çš„ç»“æœä¼šè¿”å›åœ¨è¿™ä¸ª notebook cell ä¸‹ã€‚</p>
<blockquote>
<p>ğŸ’¡ æ³¨ï¼šä½ å¯ä»¥ä» Docker æ¡Œé¢ç‰ˆçš„æ‰©å±•å¸‚åœºé‡Œæœç´¢ NebulaGraph ä¸€é”®å®‰è£…æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œè¿›å…¥ NebulaGraph Docker æ‰©å±•å†…éƒ¨ï¼Œç‚¹å‡» NebulaGraph AI ï¼Œç‚¹å‡» <strong>Install NX Mode</strong> å®‰è£…æœ¬åœ°çš„ NebulaGraph + Jupyter Notebook å¼€å‘ç¯å¢ƒã€‚</p>
<p><figure><a class="lightgallery" href="/nebulagraph-in-jupyter-notebook/dd-extension-ai-playground.webp" title="/nebulagraph-in-jupyter-notebook/dd-extension-ai-playground.webp" data-thumbnail="/nebulagraph-in-jupyter-notebook/dd-extension-ai-playground.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-in-jupyter-notebook/dd-extension-ai-playground.webp"
            srcset="/nebulagraph-in-jupyter-notebook/dd-extension-ai-playground.webp, /nebulagraph-in-jupyter-notebook/dd-extension-ai-playground.webp 1.5x, /nebulagraph-in-jupyter-notebook/dd-extension-ai-playground.webp 2x"
            sizes="auto"
            alt="/nebulagraph-in-jupyter-notebook/dd-extension-ai-playground.webp">
    </a></figure></p>
</blockquote>
<h2 id="æŸ¥è¯¢" class="headerLink">
    <a href="#%e6%9f%a5%e8%af%a2" class="header-mark"></a>2 æŸ¥è¯¢</h2><p>ç°åœ¨æ”¯æŒä¸¤ç§è¯­æ³• <code>%ngql</code> æ¥å•è¡ŒæŸ¥è¯¢å’Œ <code>%%ngql</code> æ¥å¤šè¡ŒæŸ¥è¯¢ã€‚</p>
<h3 id="å•è¡ŒæŸ¥è¯¢" class="headerLink">
    <a href="#%e5%8d%95%e8%a1%8c%e6%9f%a5%e8%af%a2" class="header-mark"></a>2.1 å•è¡ŒæŸ¥è¯¢</h3><p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">%ngql USE basketballplayer;
</span></span><span class="line"><span class="cl">%ngql MATCH (v:player{name:&#34;Tim Duncan&#34;})--&gt;(v2:player) RETURN v2.player.name AS Name;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¤šè¡ŒæŸ¥è¯¢" class="headerLink">
    <a href="#%e5%a4%9a%e8%a1%8c%e6%9f%a5%e8%af%a2" class="header-mark"></a>2.2 å¤šè¡ŒæŸ¥è¯¢</h3><p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%%</span><span class="n">ngql</span>
</span></span><span class="line"><span class="cl"><span class="n">ADD</span> <span class="n">HOSTS</span> <span class="s2">&#34;storaged3&#34;</span><span class="p">:</span><span class="mi">9779</span><span class="p">,</span><span class="s2">&#34;storaged4&#34;</span><span class="p">:</span><span class="mi">9779</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">SHOW</span> <span class="n">HOSTS</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ¸²æŸ“ç»“æœ" class="headerLink">
    <a href="#%e6%b8%b2%e6%9f%93%e7%bb%93%e6%9e%9c" class="header-mark"></a>3 æ¸²æŸ“ç»“æœ</h2><p>è€Œåœ¨ä»»æ„ä¸€ä¸ªæŸ¥è¯¢ä¹‹åï¼Œç´§è·Ÿç€ä¸€ä¸ª <code>%ng_draw</code> å°±å¯ä»¥æŠŠç»“æœå¯è§†åŒ–æ¸²æŸ“å‡ºæ¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># one query</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">ngql</span> <span class="n">GET</span> <span class="n">SUBGRAPH</span> <span class="mi">2</span> <span class="n">STEPS</span> <span class="n">FROM</span> <span class="s2">&#34;player101&#34;</span> <span class="n">YIELD</span> <span class="n">VERTICES</span> <span class="n">AS</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">EDGES</span> <span class="n">AS</span> <span class="n">relationships</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">ng_draw</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># another query</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">ngql</span> <span class="n">match</span> <span class="n">p</span><span class="o">=</span><span class="p">(:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[]</span><span class="o">-&gt;</span><span class="p">()</span> <span class="k">return</span> <span class="n">p</span> <span class="n">LIMIT</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">ng_draw</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ•ˆæœï¼š</p>
<p><figure><a class="lightgallery" href="/nebulagraph-in-jupyter-notebook/render_result.webp" title="render_result" data-thumbnail="/nebulagraph-in-jupyter-notebook/render_result.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-in-jupyter-notebook/render_result.webp"
            srcset="/nebulagraph-in-jupyter-notebook/render_result.webp, /nebulagraph-in-jupyter-notebook/render_result.webp 1.5x, /nebulagraph-in-jupyter-notebook/render_result.webp 2x"
            sizes="auto"
            alt="/nebulagraph-in-jupyter-notebook/render_result.webp">
    </a></figure></p>
<p>å¹¶ä¸”ï¼Œæ¸²æŸ“çš„ç»“æœè¿˜ä¼šè¢«ä¿å­˜ä¸º<a href="https://github.com/wey-gu/ipython-ngql/blob/main/examples/nebulagraph_draw_match.html" target="_blank" rel="noopener noreferrer">å•æ–‡ä»¶ html</a> ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å†…åµŒåˆ°ä»»æ„ç½‘é¡µä¸­ï¼Œåƒæ˜¯ï¼š</p>
<iframe src="nebulagraph_draw_match.html" style="height:500px;width:800px" title="Graph"></iframe>
<h2 id="é«˜çº§åº”ç”¨" class="headerLink">
    <a href="#%e9%ab%98%e7%ba%a7%e5%ba%94%e7%94%a8" class="header-mark"></a>4 é«˜çº§åº”ç”¨</h2><p>ä¸‹é¢è¿˜æœ‰ä¸€äº›æ–¹ä¾¿çš„é«˜çº§åº”ç”¨ã€‚æ¯”å¦‚ <code>%ngql help</code>  å¯ä»¥è·å¾—æ›´å¤šå¸®åŠ©ä¿¡æ¯ã€‚</p>
<h3 id="æ“ä½œæŸ¥è¯¢ç»“æœä¸º-pandas-df" class="headerLink">
    <a href="#%e6%93%8d%e4%bd%9c%e6%9f%a5%e8%af%a2%e7%bb%93%e6%9e%9c%e4%b8%ba-pandas-df" class="header-mark"></a>4.1 æ“ä½œæŸ¥è¯¢ç»“æœä¸º pandas df</h3><p>æ¯ä¸€æ¬¡ query ä¹‹åï¼Œè¿”å›çš„ç»“æœä¼šè¢«å­˜åˆ° <code>_</code> å˜é‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å®ƒè¿›è¡Œè¯»å–ï¼š</p>
<p><figure><a class="lightgallery" href="/nebulagraph-in-jupyter-notebook/load_result.webp" title="load_result" data-thumbnail="/nebulagraph-in-jupyter-notebook/load_result.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-in-jupyter-notebook/load_result.webp"
            srcset="/nebulagraph-in-jupyter-notebook/load_result.webp, /nebulagraph-in-jupyter-notebook/load_result.webp 1.5x, /nebulagraph-in-jupyter-notebook/load_result.webp 2x"
            sizes="auto"
            alt="/nebulagraph-in-jupyter-notebook/load_result.webp">
    </a></figure></p>
<h3 id="è¿”å›åŸå§‹-resultset" class="headerLink">
    <a href="#%e8%bf%94%e5%9b%9e%e5%8e%9f%e5%a7%8b-resultset" class="header-mark"></a>4.2 è¿”å›åŸå§‹ ResultSet</h3><p>é»˜è®¤ï¼Œè¿”å›çš„ç»“æœçš„æ ¼å¼æ˜¯ pandas dfï¼Œè€Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨ Jupyter Notebook ä¸­äº¤äº’è°ƒè¯• Python çš„ NebulaGraph åº”ç”¨ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è¿”å›ç»“æœè®¾ç½®ä¸ºåŸå§‹çš„ ResultSet æ ¼å¼ï¼Œæ–¹ä¾¿ç›´è§‚è¿›è¡Œ Query ä¸ç»“æœè§£æï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="o">%</span><span class="n">config</span> <span class="n">IPythonNGQL</span><span class="o">.</span><span class="n">ngql_result_style</span><span class="o">=</span><span class="s2">&#34;raw&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">:</span> <span class="o">%%</span><span class="n">ngql</span> <span class="n">USE</span> <span class="n">pokemon_club</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="p">:</span> <span class="n">GO</span> <span class="n">FROM</span> <span class="s2">&#34;Tom&#34;</span> <span class="n">OVER</span> <span class="n">owns_pokemon</span> <span class="n">YIELD</span> <span class="n">owns_pokemon</span><span class="o">.</span><span class="n">_dst</span> <span class="k">as</span> <span class="n">pokemon_id</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="p">:</span> <span class="o">|</span> <span class="n">GO</span> <span class="n">FROM</span> <span class="err">$</span><span class="o">-.</span><span class="n">pokemon_id</span> <span class="n">OVER</span> <span class="n">owns_pokemon</span> <span class="n">REVERSELY</span> <span class="n">YIELD</span> <span class="n">owns_pokemon</span><span class="o">.</span><span class="n">_dst</span> <span class="n">AS</span> <span class="n">Trainer_Name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="n">ResultSet</span><span class="p">(</span><span class="n">ExecutionResponse</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">latency_in_us</span><span class="o">=</span><span class="mi">3270</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">=</span><span class="n">DataSet</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;Trainer_Name&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="n">rows</span><span class="o">=</span><span class="p">[</span><span class="n">Row</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">Value</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">sVal</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;Tom&#39;</span><span class="p">)]),</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="n">Row</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">Value</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">sVal</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;Wey&#39;</span><span class="p">)])]),</span>
</span></span><span class="line"><span class="cl">    <span class="n">space_name</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;pokemon_club&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">r</span> <span class="o">=</span> <span class="n">_</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">column_values</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Trainer_Name&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;Tom&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æŸ¥è¯¢æ¨¡æ¿" class="headerLink">
    <a href="#%e6%9f%a5%e8%af%a2%e6%a8%a1%e6%9d%bf" class="header-mark"></a>4.3 æŸ¥è¯¢æ¨¡æ¿</h3><p>æ­¤å¤–ï¼Œæˆ‘è¿˜ç»™å¤§å®¶æ”¯æŒäº†æ¨¡æ¿åŠŸèƒ½ï¼Œè¯­æ³•æ²¿ç”¨äº† <a href="https://jinja.palletsprojects.com/" target="_blank" rel="noopener noreferrer">Jinja2</a> çš„ <code>{{ variable }}</code> ï¼Œè¯¦è§è¿™ä¸ªä¾‹å­ï¼š</p>
<p><figure><a class="lightgallery" href="/nebulagraph-in-jupyter-notebook/query_template.webp" title="query_template" data-thumbnail="/nebulagraph-in-jupyter-notebook/query_template.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-in-jupyter-notebook/query_template.webp"
            srcset="/nebulagraph-in-jupyter-notebook/query_template.webp, /nebulagraph-in-jupyter-notebook/query_template.webp 1.5x, /nebulagraph-in-jupyter-notebook/query_template.webp 2x"
            sizes="auto"
            alt="/nebulagraph-in-jupyter-notebook/query_template.webp">
    </a></figure></p>
<h2 id="æœªæ¥" class="headerLink">
    <a href="#%e6%9c%aa%e6%9d%a5" class="header-mark"></a>5 æœªæ¥</h2><p>ä¹‹åï¼Œæˆ‘æ‰“ç®—å¢å¼ºå¯è§†åŒ–çš„è‡ªå®šä¹‰é€‰é¡¹ï¼Œä¹Ÿæ¬¢è¿ç¤¾åŒºé‡Œçš„å¤§ä¼™æ¥è´¡çŒ®æ–°çš„ featureã€ideaã€‚</p>
<p>é¡¹ç›®çš„ repo åœ¨ ğŸ‘‰ğŸ» <a href="https://github.com/wey-gu/ipython-ngql" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/ipython-ngql</a></p>]]></description>
</item><item>
    <title>Nebulagraph Artificial Intelligence Suite</title>
    <link>https://siwei.io/nebulagraph-ai-suite/</link>
    <pubDate>Tue, 02 May 2023 16:37:28 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/nebulagraph-ai-suite/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/nebulagraph-ai-suite/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>ä»‹ç»æ–°é¡¹ç›®ï¼ ng_aiï¼šNebulaGraph çš„å›¾ç®—æ³•å¥—ä»¶ï¼Œå¥½ç”¨çš„ NebulaGraph çš„ high-level Python Algorithm APIï¼Œå®ƒçš„ç›®æ ‡æ˜¯è®© NebulaGraph çš„æ•°æ®ç§‘å­¦å®¶ç”¨æˆ·èƒ½å¤Ÿç”¨å¾ˆå°‘çš„ä»£ç é‡æ‰§è¡Œå›¾ä¸Šçš„ç®—æ³•ç›¸å…³çš„ä»»åŠ¡ã€‚</p>
</blockquote>
<h2 id="nebulagraph-ai-å¥—ä»¶" class="headerLink">
    <a href="#nebulagraph-ai-%e5%a5%97%e4%bb%b6" class="header-mark"></a>1 Nebulagraph AI å¥—ä»¶</h2><p>è¿™å‘¨ï¼ŒNebulaGraph 3.5.0 <a href="https://docs.nebula-graph.com.cn/3.5.0/20.appendix/release-notes/nebula-comm-release-note/" target="_blank" rel="noopener noreferrer">å‘å¸ƒå•¦</a>ï¼Œ@<strong><a href="https://github.com/whitewum" target="_blank" rel="noopener noreferrer">whitewum</a></strong> å´è€å¸ˆå»ºè®®æˆ‘ä»¬æŠŠè€Œä¹‹å‰ä¸€æ®µæ—¶é—´ NebulaGraph ç¤¾åŒºé‡Œå¼€å¯çš„æ–°é¡¹ç›® <a href="https://github.com/wey-gu/nebulagraph-ai" target="_blank" rel="noopener noreferrer">ng_ai</a> å…¬å¼€ç»™å¤§å®¶ï¼Œæœ¬æ–‡å°±æ˜¯ç¬¬ä¸€ç¯‡ä»‹ç» ng_ai çš„æ–‡ç« ï¼</p>
<h3 id="ng_ai-æ˜¯ä»€ä¹ˆ" class="headerLink">
    <a href="#ng_ai-%e6%98%af%e4%bb%80%e4%b9%88" class="header-mark"></a>1.1 ng_ai æ˜¯ä»€ä¹ˆ</h3><p>ng_ai çš„å…¨åæ˜¯ï¼šNebulagraph AI Suiteï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯åœ¨ NebulaGraph ä¹‹ä¸Šè·‘ç®—æ³•çš„ Python å¥—ä»¶ï¼Œå¸Œæœ›èƒ½ç»™ NebulaGraph çš„æ•°æ®ç§‘å­¦å®¶ç”¨æˆ·ä¸€ä¸ªè‡ªç„¶ã€ç®€æ´çš„é«˜çº§ APIï¼Œç”¨å¾ˆå°‘çš„ä»£ç é‡æ‰§è¡Œå›¾ä¸Šçš„ç®—æ³•ç›¸å…³çš„ä»»åŠ¡ã€‚</p>
<p>åœ¨ ng_ai è¿™ä¸ªå¼€æºé¡¹ç›®é‡Œï¼Œæˆ‘ä»¬å¸Œæœ›å¿«é€Ÿè¿­ä»£ã€å…¬å¼€è®¨è®ºã€æ¼”è¿›å®ƒï¼Œè€Œè¿™èƒŒåçš„ç›®æ ‡æ˜¯ï¼š</p>
<blockquote>
<p>Simplifying things in surprising ways.</p>
</blockquote>
<h3 id="ng_ai-çš„ç‰¹ç‚¹" class="headerLink">
    <a href="#ng_ai-%e7%9a%84%e7%89%b9%e7%82%b9" class="header-mark"></a>1.2 ng_ai çš„ç‰¹ç‚¹</h3><p>ä¸ºäº†è®© NebulaGraph ç¤¾åŒºçš„åŒå­¦æ‹¥æœ‰é¡ºæ»‘çš„ç®—æ³•ä½“éªŒï¼Œng_ai æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ä¸ NebulaGraph ç´§å¯†ç»“åˆï¼Œæ–¹ä¾¿ä»å…¶ä¸­è¯»ã€å†™å›¾æ•°æ®</li>
<li>æ”¯æŒå¤šå¼•æ“ã€åç«¯ï¼Œç›®å‰æ”¯æŒ Sparkï¼ˆNebulaGraph Algorithmï¼‰ã€NetworkXï¼Œä¹‹åä¼šæ”¯æŒ <a href="https://www.dgl.ai/" target="_blank" rel="noopener noreferrer">DGL</a>ã€<a href="https://pytorch-geometric.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">PyG</a></li>
<li>å‹å¥½ã€ç¬¦åˆç›´è§‰çš„ API è®¾è®¡</li>
<li>ä¸ NebulaGraph çš„ UDF æ— ç¼ç»“åˆï¼Œæ”¯æŒä» Query ä¸­è°ƒç”¨ ng_ai ä»»åŠ¡</li>
<li>å‹å¥½çš„è‡ªå®šä¹‰ç®—æ³•æ¥å£ï¼Œæ–¹ä¾¿ç”¨æˆ·è‡ªå·±å®ç°ç®—æ³•ï¼ˆå°šæœªå®Œæˆï¼‰</li>
<li>ä¸€é”®è¯•ç©ç¯å¢ƒï¼ˆåŸºäº Docker Extentionï¼‰</li>
</ul>
<h2 id="æˆ‘å¯ä»¥ç”¨-ng_ai-å¹²ä»€ä¹ˆ" class="headerLink">
    <a href="#%e6%88%91%e5%8f%af%e4%bb%a5%e7%94%a8-ng_ai-%e5%b9%b2%e4%bb%80%e4%b9%88" class="header-mark"></a>2 æˆ‘å¯ä»¥ç”¨ ng_ai å¹²ä»€ä¹ˆ</h2><h3 id="è·‘åˆ†å¸ƒå¼-pagerank-ç®—æ³•" class="headerLink">
    <a href="#%e8%b7%91%e5%88%86%e5%b8%83%e5%bc%8f-pagerank-%e7%ae%97%e6%b3%95" class="header-mark"></a>2.1 è·‘åˆ†å¸ƒå¼ pagerank ç®—æ³•</h3><p>å¦‚æœåœ¨ä¸€ä¸ªå¤§å›¾ä¸Šï¼ŒåŸºäº Nebula-Algorithms åˆ†å¸ƒå¼åœ°è·‘ pagerank ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ng_ai</span> <span class="kn">import</span> <span class="n">NebulaReader</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># read data with spark engine, scan mode</span>
</span></span><span class="line"><span class="cl"><span class="n">reader</span> <span class="o">=</span> <span class="n">NebulaReader</span><span class="p">(</span><span class="n">engine</span><span class="o">=</span><span class="s2">&#34;spark&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">reader</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">edge</span><span class="o">=</span><span class="s2">&#34;follow&#34;</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="s2">&#34;degree&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># run pagerank algorithm</span>
</span></span><span class="line"><span class="cl"><span class="n">pr_result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">pagerank</span><span class="p">(</span><span class="n">reset_prob</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å†™å›ç®—æ³•ç»“æœåˆ°-nebulagraph" class="headerLink">
    <a href="#%e5%86%99%e5%9b%9e%e7%ae%97%e6%b3%95%e7%bb%93%e6%9e%9c%e5%88%b0-nebulagraph" class="header-mark"></a>2.2 å†™å›ç®—æ³•ç»“æœåˆ° NebulaGraph</h3><p>å‡è®¾æˆ‘ä»¬è¦è·‘ä¸€ä¸ª label propagation ç®—æ³•ï¼Œç„¶åæŠŠç»“æœå†™å› NebulaGraphï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼š</p>
<p>å…ˆç¡®ä¿è¦å†™å› TAG çš„ schema å·²ç»åˆ›å»ºå¥½äº†ï¼Œå†™åˆ° label_propagation.cluster_id å­—æ®µé‡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">label_propagation</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">cluster_id</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å…ˆæ‰§è¡Œç®—æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">label_propagation</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†çœ‹ä¸€ä¸‹ç»“æœçš„ schemaï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_result</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">root</span>
</span></span><span class="line"><span class="cl"> <span class="o">|--</span> <span class="n">_id</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="o">|--</span> <span class="n">lpa</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">false</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œä»£ç é‡Œè¿™ä¹ˆå†™ï¼Œæˆ‘ä»¬æŠŠ lpa çš„ç»“æœå†™å› NebulaGraph ä¸­çš„ cluster_id å­—æ®µé‡Œï¼ˆ<code>{&quot;lpa&quot;: &quot;cluster_id&quot;}</code>ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ng_ai</span> <span class="kn">import</span> <span class="n">NebulaWriter</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ng_ai.config</span> <span class="kn">import</span> <span class="n">NebulaGraphConfig</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">config</span> <span class="o">=</span> <span class="n">NebulaGraphConfig</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">writer</span> <span class="o">=</span> <span class="n">NebulaWriter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">=</span><span class="n">df_result</span><span class="p">,</span> <span class="n">sink</span><span class="o">=</span><span class="s2">&#34;nebulagraph_vertex&#34;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&#34;spark&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># map column louvain into property cluster_id</span>
</span></span><span class="line"><span class="cl"><span class="n">properties</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;lpa&#34;</span><span class="p">:</span> <span class="s2">&#34;cluster_id&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">writer</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">tag</span><span class="o">=</span><span class="s2">&#34;label_propagation&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">vid_field</span><span class="o">=</span><span class="s2">&#34;_id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">batch_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">write_mode</span><span class="o">=</span><span class="s2">&#34;insert&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># write back to NebulaGraph</span>
</span></span><span class="line"><span class="cl"><span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯ä¸€ä¸‹ç»“æœå•¦ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">USE basketballplayer;
</span></span><span class="line"><span class="cl">MATCH (v:label_propagation)
</span></span><span class="line"><span class="cl">RETURN id(v), v.label_propagation.cluster_id LIMIT 3;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="o">+</span><span class="c1">-------------+--------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">label_propagation</span><span class="p">.</span><span class="n">cluster_id</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-------------+--------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;player103&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;player101&#34;</span><span class="w">                    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;player113&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;player129&#34;</span><span class="w">                    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;player121&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;player129&#34;</span><span class="w">                    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-------------+--------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ›´è¯¦ç»†çš„ä¾‹å­å‚è€ƒï¼š<a href="https://github.com/wey-gu/nebulagraph-ai/blob/main/examples/spark_engine.ipynb" target="_blank" rel="noopener noreferrer">ng_ai/examples</a></p>
<h4 id="é€šè¿‡-ngql-è°ƒç”¨ç®—æ³•" class="headerLink">
    <a href="#%e9%80%9a%e8%bf%87-ngql-%e8%b0%83%e7%94%a8%e7%ae%97%e6%b3%95" class="header-mark"></a>2.2.1 é€šè¿‡ nGQL è°ƒç”¨ç®—æ³•</h4><p>ä» NebulaGraph 3.5.0 ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å†™è‡ªå·±çš„ UDF æ¥ä» nGQL é‡Œè°ƒç”¨è‡ªå·±å®ç°çš„å‡½æ•°ï¼Œng_ai ä¹Ÿç”¨è¿™ä¸ªèƒ½åŠ›æ¥å®ç°äº†ä¸€ä¸ª ng_ai å‡½æ•°ï¼Œå®ƒå¯ä»¥ä» nGQL é‡Œè°ƒç”¨ ng_ai çš„ç®—æ³•ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Prepare the write schema
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">USE</span><span class="w"> </span><span class="n">basketballplayer</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">pagerank</span><span class="p">(</span><span class="n">pagerank</span><span class="w"> </span><span class="n">string</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">:</span><span class="n">sleep</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Call with ng_ai()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">ng_ai</span><span class="p">(</span><span class="s2">&#34;pagerank&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;follow&#34;</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;degree&#34;</span><span class="p">],</span><span class="w"> </span><span class="s2">&#34;spark&#34;</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="k">space</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;basketballplayer&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">max_iter</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="n">write_mode</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;insert&#34;</span><span class="err">}</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ›´è¯¦ç»†çš„ä¾‹å­å‚è€ƒï¼š<a href="https://github.com/wey-gu/nebulagraph-ai/blob/main/examples/ng_ai_from_ngql_udf.ipynb" target="_blank" rel="noopener noreferrer">ng_ai/examples</a></p>
<h4 id="å•æœºè¿è¡Œç®—æ³•" class="headerLink">
    <a href="#%e5%8d%95%e6%9c%ba%e8%bf%90%e8%a1%8c%e7%ae%97%e6%b3%95" class="header-mark"></a>2.2.2 å•æœºè¿è¡Œç®—æ³•</h4><p>åœ¨å•æœºã€æœ¬åœ°çš„ç¯å¢ƒé‡Œï¼Œng_ai æ”¯æŒåŸºäº NetworkX è¿è¡Œç®—æ³•ï¼Œä¾‹å¦‚ï¼š</p>
<p>è¯»å–å›¾ä¸º ng_ai graph å¯¹è±¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ng_ai</span> <span class="kn">import</span> <span class="n">NebulaReader</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ng_ai.config</span> <span class="kn">import</span> <span class="n">NebulaGraphConfig</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># read data with nebula/networkx engine, query mode</span>
</span></span><span class="line"><span class="cl"><span class="n">config_dict</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;graphd_hosts&#34;</span><span class="p">:</span> <span class="s2">&#34;graphd:9669&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;user&#34;</span><span class="p">:</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;nebula&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;space&#34;</span><span class="p">:</span> <span class="s2">&#34;basketballplayer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">config</span> <span class="o">=</span> <span class="n">NebulaGraphConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">reader</span> <span class="o">=</span> <span class="n">NebulaReader</span><span class="p">(</span><span class="n">engine</span><span class="o">=</span><span class="s2">&#34;nebula&#34;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">reader</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">edges</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;follow&#34;</span><span class="p">,</span> <span class="s2">&#34;serve&#34;</span><span class="p">],</span> <span class="n">props</span><span class="o">=</span><span class="p">[[</span><span class="s2">&#34;degree&#34;</span><span class="p">],</span> <span class="p">[]])</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹ã€ç”»å›¾ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œç®—æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pr_result</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">pagerank</span><span class="p">(</span><span class="n">reset_prob</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†™å› NebulaGraphï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ng_ai</span> <span class="kn">import</span> <span class="n">NebulaWriter</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">writer</span> <span class="o">=</span> <span class="n">NebulaWriter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">=</span><span class="n">pr_result</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">sink</span><span class="o">=</span><span class="s2">&#34;nebulagraph_vertex&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">engine</span><span class="o">=</span><span class="s2">&#34;nebula&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># properties to write</span>
</span></span><span class="line"><span class="cl"><span class="n">properties</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;pagerank&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">writer</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">tag</span><span class="o">=</span><span class="s2">&#34;pagerank&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">batch_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">write_mode</span><span class="o">=</span><span class="s2">&#34;insert&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># write back to NebulaGraph</span>
</span></span><span class="line"><span class="cl"><span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä»–ç®—æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># get all algorithms</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">get_all_algo</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># get help of each algo</span>
</span></span><span class="line"><span class="cl"><span class="n">help</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">node2vec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># call the algo</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">node2vec</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ›´è¯¦ç»†çš„ä¾‹å­å‚è€ƒï¼š<a href="https://github.com/wey-gu/nebulagraph-ai/blob/main/examples/networkx_engine.ipynb" target="_blank" rel="noopener noreferrer">ng_ai/examples</a></p>
<h4 id="å¯è§†åŒ–å›¾ç®—æ³•ç»“æœ" class="headerLink">
    <a href="#%e5%8f%af%e8%a7%86%e5%8c%96%e5%9b%be%e7%ae%97%e6%b3%95%e7%bb%93%e6%9e%9c" class="header-mark"></a>2.2.3 å¯è§†åŒ–å›¾ç®—æ³•ç»“æœ</h4><p>å†æ¼”ç¤ºä¸€ä¸ª NetworkX å¼•æ“æƒ…å†µä¸‹ï¼Œè®¡ç®— Louvainã€PageRank å¹¶å¯è§†åŒ–çš„ä¾‹å­ï¼š</p>
<p>å…ˆæ‰§è¡Œä¸¤ä¸ªç®—æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pr_result</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">pagerank</span><span class="p">(</span><span class="n">reset_prob</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">louvain_result</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">louvain</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ¬¡æˆ‘ä»¬æ‰‹å†™ä¸€ä¸ªå¥½çœ‹ä¸€ç‚¹çš„ç”»å›¾å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">draw_graph_louvain_pr</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pr_result</span><span class="p">,</span> <span class="n">louvain_result</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;#1984c5&#34;</span><span class="p">,</span> <span class="s2">&#34;#22a7f0&#34;</span><span class="p">,</span> <span class="s2">&#34;#63bff0&#34;</span><span class="p">,</span> <span class="s2">&#34;#a7d5ed&#34;</span><span class="p">,</span> <span class="s2">&#34;#e2e2e2&#34;</span><span class="p">,</span> <span class="s2">&#34;#e1a692&#34;</span><span class="p">,</span> <span class="s2">&#34;#de6e56&#34;</span><span class="p">,</span> <span class="s2">&#34;#e14b31&#34;</span><span class="p">,</span> <span class="s2">&#34;#c23728&#34;</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Define positions for the nodes</span>
</span></span><span class="line"><span class="cl">    <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Create a figure and set the axis limits</span>
</span></span><span class="line"><span class="cl">    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Create a colormap from the colors list</span>
</span></span><span class="line"><span class="cl">    <span class="n">cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Draw the nodes and edges of the graph</span>
</span></span><span class="line"><span class="cl">    <span class="n">node_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">louvain_result</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">    <span class="n">node_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">70000</span> <span class="o">*</span> <span class="n">pr_result</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">node_colors</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">node_sizes</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">louvain_result</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s1">&#39;arc3, rad=0.2&#39;</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-|&gt;&#39;</span><span class="p">,</span> <span class="n">arrows</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Extract edge labels as a dictionary</span>
</span></span><span class="line"><span class="cl">    <span class="n">edge_labels</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Add edge labels to the graph</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">edge_labels</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">pos</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pos</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pos</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Add node labels to the graph</span>
</span></span><span class="line"><span class="cl">    <span class="n">node_labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;label&#39;</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">else</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Add colorbar for community colors</span>
</span></span><span class="line"><span class="cl">    <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">louvain_result</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
</span></span><span class="line"><span class="cl">    <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
</span></span><span class="line"><span class="cl">    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">louvain_result</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Community </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">louvain_result</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Show the figure</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">draw_graph_louvain_pr</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pr_result</span><span class="o">=</span><span class="n">pr_result</span><span class="p">,</span> <span class="n">louvain_result</span><span class="o">=</span><span class="n">louvain_result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ•ˆæœå¦‚å›¾ï¼š</p>
<p><figure><a class="lightgallery" href="https://github.com/siwei-io/talks/assets/1651790/4d13eb2b-3e40-4085-8e0c-71459ca0843b" title="draw_graph_louvain_pr" data-thumbnail="https://github.com/siwei-io/talks/assets/1651790/4d13eb2b-3e40-4085-8e0c-71459ca0843b">
        <img
            
            loading="lazy"
            src="https://github.com/siwei-io/talks/assets/1651790/4d13eb2b-3e40-4085-8e0c-71459ca0843b"
            srcset="https://github.com/siwei-io/talks/assets/1651790/4d13eb2b-3e40-4085-8e0c-71459ca0843b, https://github.com/siwei-io/talks/assets/1651790/4d13eb2b-3e40-4085-8e0c-71459ca0843b 1.5x, https://github.com/siwei-io/talks/assets/1651790/4d13eb2b-3e40-4085-8e0c-71459ca0843b 2x"
            sizes="auto"
            alt="https://github.com/siwei-io/talks/assets/1651790/4d13eb2b-3e40-4085-8e0c-71459ca0843b">
    </a></figure></p>
<p>æ›´è¯¦ç»†çš„ä¾‹å­å‚è€ƒï¼š<a href="https://github.com/wey-gu/nebulagraph-ai/blob/main/examples/ng_ai_networkx_plot.ipynb" target="_blank" rel="noopener noreferrer">ng_ai/examples</a></p>
<h4 id="æ›´æ–¹ä¾¿çš„-notebook-æ“ä½œ-nebulagraph" class="headerLink">
    <a href="#%e6%9b%b4%e6%96%b9%e4%be%bf%e7%9a%84-notebook-%e6%93%8d%e4%bd%9c-nebulagraph" class="header-mark"></a>2.2.4 æ›´æ–¹ä¾¿çš„ Notebook æ“ä½œ NebulaGraph</h4><p>ç»“åˆ NebulaGraph çš„ Jupyter Notebook æ’ä»¶: <a href="https://github.com/wey-gu/ipython-ngql" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/ipython-ngql</a> ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ›´æ–¹ä¾¿çš„æ“ä½œ NebulaGraphï¼š</p>
<p>åœ¨ Jupyter Notbook é‡Œå®‰è£…è¿™ä¸ªæ’ä»¶å¯ä»¥é€šè¿‡ ng_ai çš„ extras å®‰è£…ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">ng_ai</span><span class="p">[</span><span class="n">jupyter</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">load_ext</span> <span class="n">ngql</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹Ÿå¯ä»¥å•ç‹¬å®‰è£…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">ipython</span><span class="o">-</span><span class="n">ngql</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">load_ext</span> <span class="n">ngql</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ Notebook é‡Œç›´æ¥ä½¿ç”¨ <code>%ngql</code> å‘½ä»¤æ¥æ‰§è¡Œ NGQL è¯­å¥äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">ngql</span> <span class="o">--</span><span class="n">address</span> <span class="mf">127.0.0.1</span> <span class="o">--</span><span class="n">port</span> <span class="mi">9669</span> <span class="o">--</span><span class="n">user</span> <span class="n">root</span> <span class="o">--</span><span class="n">password</span> <span class="n">nebula</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">ngql</span> <span class="n">USE</span> <span class="n">basketballplayer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">ngql</span> <span class="n">MATCH</span> <span class="p">(</span><span class="n">v</span><span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s2">&#34;Tim Duncan&#34;</span><span class="p">})</span><span class="o">--&gt;</span><span class="p">(</span><span class="n">v2</span><span class="p">:</span><span class="n">player</span><span class="p">)</span> <span class="n">RETURN</span> <span class="n">v2</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">name</span> <span class="n">AS</span> <span class="n">Name</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨ï¼Œå¤šè¡Œçš„ Query ç”¨ä¸¤ä¸ªç™¾åˆ†å·å°±å¥½äº† <code>%%ngql</code></p>
</blockquote>
<p>æœ€åï¼Œæˆ‘ä»¬è¿˜èƒ½åœ¨ Jupyter Notebook é‡Œç›´æ¥å¯è§†åŒ–æ¸²æŸ“ç»“æœï¼åªéœ€è¦ <code>%ng_draw</code> å°±å¯ä»¥å•¦ï¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">ngql</span> <span class="n">match</span> <span class="n">p</span><span class="o">=</span><span class="p">(:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[]</span><span class="o">-&gt;</span><span class="p">()</span> <span class="k">return</span> <span class="n">p</span> <span class="n">LIMIT</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">ng_draw</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/236797874-c142cfd8-b0de-4689-95ef-1da386e137d3.png" title="ipython-ngql" data-thumbnail="https://user-images.githubusercontent.com/1651790/236797874-c142cfd8-b0de-4689-95ef-1da386e137d3.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/236797874-c142cfd8-b0de-4689-95ef-1da386e137d3.png"
            srcset="https://user-images.githubusercontent.com/1651790/236797874-c142cfd8-b0de-4689-95ef-1da386e137d3.png, https://user-images.githubusercontent.com/1651790/236797874-c142cfd8-b0de-4689-95ef-1da386e137d3.png 1.5x, https://user-images.githubusercontent.com/1651790/236797874-c142cfd8-b0de-4689-95ef-1da386e137d3.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/236797874-c142cfd8-b0de-4689-95ef-1da386e137d3.png">
    </a></figure></p>
<h2 id="æœªæ¥å·¥ä½œ" class="headerLink">
    <a href="#%e6%9c%aa%e6%9d%a5%e5%b7%a5%e4%bd%9c" class="header-mark"></a>3 æœªæ¥å·¥ä½œ</h2><p>ç°åœ¨ ng_ai è¿˜åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šå·¥ä½œè¦åšï¼š</p>
<ul>
<li><i class="far fa-square fa-fw"></i> å®Œå–„ reader æ¨¡å¼ï¼Œç°åœ¨ NebulaGraph/NetworkX çš„è¯»å–æ•°æ®åªæ”¯æŒ Query-Modeï¼Œè¿˜éœ€è¦æ”¯æŒ Scan-Mode</li>
<li><i class="far fa-square fa-fw"></i> å®ç°åŸºäº dgl(GNN) çš„é“¾è·¯é¢„æµ‹ã€èŠ‚ç‚¹åˆ†ç±»ç­‰ç®—æ³•ï¼Œä¾‹å¦‚ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">gnn_link_prediction</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># query src, dst to be predicted</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">src_vertex</span><span class="p">,</span> <span class="n">dst_vertices</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><i class="far fa-square fa-fw"></i> UDAï¼Œè‡ªå®šä¹‰ç®—æ³•</li>
<li><i class="far fa-square fa-fw"></i> å¿«é€Ÿéƒ¨ç½²å·¥å…·</li>
</ul>
<p>ng_ai æ˜¯å®Œå…¨ build in public çš„ï¼Œæ¬¢è¿ç¤¾åŒºçš„å¤§å®¶ä»¬æ¥å‚ä¸ï¼Œä¸€èµ·æ¥å®Œå–„ ng_aiï¼Œè®© NebulaGraph ä¸Šçš„ AI ç®—æ³•æ›´åŠ ç®€å•æ˜“ç”¨ï¼</p>
<h2 id="è¯•ç©-ng_ai" class="headerLink">
    <a href="#%e8%af%95%e7%8e%a9-ng_ai" class="header-mark"></a>4 è¯•ç© ng_ai</h2><p>æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†ä¸€é”®éƒ¨ç½²çš„ NebulaGraph + Studio + ng_ai in Jupyter çš„ç¯å¢ƒï¼Œåªéœ€è¦å¤§å®¶ä» Docker Desktop çš„ Extensionï¼ˆæ‰©å±•ï¼‰ä¸­æœç´¢ NebulaGraphï¼Œå°±å¯ä»¥è¯•å®Œäº†ã€‚</p>
<ul>
<li>å®‰è£… <a href="https://www.docker.com/blog/distributed-cloud-native-graph-database-nebulagraph-docker-extension/" target="_blank" rel="noopener noreferrer">NebulaGraph Docker æ’ä»¶</a></li>
</ul>
<p>åœ¨ Docker Desktop çš„æ’ä»¶å¸‚åœºæœç´¢ NebulaGraphï¼Œç‚¹å‡»å®‰è£…</p>
<p><figure><a class="lightgallery" href="https://github.com/siwei-io/talks/assets/1651790/e07e39d1-2b3a-486f-bb68-29a67bc3a714" title="https://github.com/siwei-io/talks/assets/1651790/e07e39d1-2b3a-486f-bb68-29a67bc3a714" data-thumbnail="https://github.com/siwei-io/talks/assets/1651790/e07e39d1-2b3a-486f-bb68-29a67bc3a714">
        <img
            
            loading="lazy"
            src="https://github.com/siwei-io/talks/assets/1651790/e07e39d1-2b3a-486f-bb68-29a67bc3a714"
            srcset="https://github.com/siwei-io/talks/assets/1651790/e07e39d1-2b3a-486f-bb68-29a67bc3a714, https://github.com/siwei-io/talks/assets/1651790/e07e39d1-2b3a-486f-bb68-29a67bc3a714 1.5x, https://github.com/siwei-io/talks/assets/1651790/e07e39d1-2b3a-486f-bb68-29a67bc3a714 2x"
            sizes="auto"
            alt="https://github.com/siwei-io/talks/assets/1651790/e07e39d1-2b3a-486f-bb68-29a67bc3a714">
    </a></figure></p>
<ul>
<li>å®‰è£… ng_ai playground</li>
</ul>
<p>è¿›å…¥ NebulaGraph æ’ä»¶ï¼Œç‚¹å‡»<strong>Install NX Mode</strong>ï¼Œå®‰è£… ng_ai çš„ NetworkX playgroundï¼Œé€šå¸¸è¦ç­‰å‡ åˆ†é’Ÿç­‰å¾…å®‰è£…å®Œæˆã€‚</p>
<p><figure><a class="lightgallery" href="https://github.com/siwei-io/talks/assets/1651790/3fca7e39-6e37-4ccb-8177-4771babb7b66" title="https://github.com/siwei-io/talks/assets/1651790/3fca7e39-6e37-4ccb-8177-4771babb7b66" data-thumbnail="https://github.com/siwei-io/talks/assets/1651790/3fca7e39-6e37-4ccb-8177-4771babb7b66">
        <img
            
            loading="lazy"
            src="https://github.com/siwei-io/talks/assets/1651790/3fca7e39-6e37-4ccb-8177-4771babb7b66"
            srcset="https://github.com/siwei-io/talks/assets/1651790/3fca7e39-6e37-4ccb-8177-4771babb7b66, https://github.com/siwei-io/talks/assets/1651790/3fca7e39-6e37-4ccb-8177-4771babb7b66 1.5x, https://github.com/siwei-io/talks/assets/1651790/3fca7e39-6e37-4ccb-8177-4771babb7b66 2x"
            sizes="auto"
            alt="https://github.com/siwei-io/talks/assets/1651790/3fca7e39-6e37-4ccb-8177-4771babb7b66">
    </a></figure></p>
<ul>
<li>è¿›å…¥ NetworkX playground</li>
</ul>
<p>ç‚¹å‡»<strong>Jupyter NB NetworkX</strong>ï¼Œè¿›å…¥ NetworkX playgroundã€‚</p>
<p><figure><a class="lightgallery" href="https://github.com/siwei-io/talks/assets/1651790/48c2e5a2-490e-4626-809e-5894d6f833e9" title="https://github.com/siwei-io/talks/assets/1651790/48c2e5a2-490e-4626-809e-5894d6f833e9" data-thumbnail="https://github.com/siwei-io/talks/assets/1651790/48c2e5a2-490e-4626-809e-5894d6f833e9">
        <img
            
            loading="lazy"
            src="https://github.com/siwei-io/talks/assets/1651790/48c2e5a2-490e-4626-809e-5894d6f833e9"
            srcset="https://github.com/siwei-io/talks/assets/1651790/48c2e5a2-490e-4626-809e-5894d6f833e9, https://github.com/siwei-io/talks/assets/1651790/48c2e5a2-490e-4626-809e-5894d6f833e9 1.5x, https://github.com/siwei-io/talks/assets/1651790/48c2e5a2-490e-4626-809e-5894d6f833e9 2x"
            sizes="auto"
            alt="https://github.com/siwei-io/talks/assets/1651790/48c2e5a2-490e-4626-809e-5894d6f833e9">
    </a></figure></p>
<h2 id="ng_ai-çš„æ¶æ„" class="headerLink">
    <a href="#ng_ai-%e7%9a%84%e6%9e%b6%e6%9e%84" class="header-mark"></a>5 ng_ai çš„æ¶æ„</h2><p>ng_ai çš„æ¶æ„å¦‚ä¸‹ï¼Œå®ƒçš„æ ¸å¿ƒæ¨¡å—æœ‰ï¼š</p>
<ul>
<li>Readerï¼šè´Ÿè´£ä» NebulaGraph è¯»å–æ•°æ®</li>
<li>Writerï¼šè´Ÿè´£å°†æ•°æ®å†™å…¥ NebulaGraph</li>
<li>*Engineï¼šè´Ÿè´£é€‚é…ä¸åŒè¿è¡Œæ—¶ï¼Œä¾‹å¦‚ Sparkã€DGLã€NetowrkX ç­‰</li>
<li>Algoï¼šç®—æ³•æ¨¡å—ï¼Œä¾‹å¦‚ PageRankã€Louvainã€GNN_Link_Predict ç­‰</li>
</ul>
<p>æ­¤å¤–ï¼Œä¸ºäº†æ”¯æŒ nGQL ä¸­çš„è°ƒç”¨ï¼Œè¿˜æœ‰ä¸¤ä¸ªæ¨¡å—ï¼š</p>
<ul>
<li>ng_ai-udfï¼šè´Ÿè´£å°† UDF æ³¨å†Œåˆ° NebulaGraphï¼Œæ¥å— ng_ai çš„ query è°ƒç”¨ï¼Œè®¿é—® ng_ai API</li>
<li>ng_ai-apiï¼šng_ai çš„ API æœåŠ¡ï¼Œæ¥å— UDF çš„è°ƒç”¨ï¼Œè®¿é—® ng_ai æ ¸å¿ƒæ¨¡å—</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">          â”‚   Spark Cluster                                   â”‚
</span></span><span class="line"><span class="cl">          â”‚    .â”€â”€â”€â”€â”€.    .â”€â”€â”€â”€â”€.    .â”€â”€â”€â”€â”€.    .â”€â”€â”€â”€â”€.       â”‚
</span></span><span class="line"><span class="cl">          â”‚   ;       :  ;       :  ;       :  ;       :      â”‚
</span></span><span class="line"><span class="cl">       â”Œâ”€â–¶â”‚   :       ;  :       ;  :       ;  :       ;      â”‚
</span></span><span class="line"><span class="cl">       â”‚  â”‚    â•²     â•±    â•²     â•±    â•²     â•±    â•²     â•±       â”‚
</span></span><span class="line"><span class="cl">       â”‚  â”‚     `â”€â”€â”€&#39;      `â”€â”€â”€&#39;      `â”€â”€â”€&#39;      `â”€â”€â”€&#39;        â”‚
</span></span><span class="line"><span class="cl">  Algo Spark                                                  â”‚
</span></span><span class="line"><span class="cl">    Engineâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="cl">       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">       â””â”€â”€â”¤                                                    â”‚          â”‚
</span></span><span class="line"><span class="cl">          â”‚   NebulaGraph AI Suite(ngai)                       â”‚ ngai-api â”‚â—€â”€â”
</span></span><span class="line"><span class="cl">          â”‚                                                    â”‚          â”‚  â”‚
</span></span><span class="line"><span class="cl">          â”‚                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
</span></span><span class="line"><span class="cl">          â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”            â”‚  â”‚
</span></span><span class="line"><span class="cl">          â”‚     â”‚ Reader â”‚    â”‚ Algo â”‚    â”‚ Writer â”‚   â”‚ GNN â”‚            â”‚  â”‚
</span></span><span class="line"><span class="cl"> â”Œâ”€â”€â”€â”€â”€â”€â”€â–¶â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜            â”‚  â”‚
</span></span><span class="line"><span class="cl"> â”‚        â”‚          â”‚            â”‚            â”‚          â”‚               â”‚  â”‚
</span></span><span class="line"><span class="cl"> â”‚        â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”    â””â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
</span></span><span class="line"><span class="cl"> â”‚        â”‚          â–¼                â–¼              â–¼           â–¼        â”‚  â”‚
</span></span><span class="line"><span class="cl"> â”‚        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
</span></span><span class="line"><span class="cl"> â”‚     â”Œâ”€â”€â”¤   â”‚ SparkEngine â”‚ â”‚ NebulaEngine â”‚ â”‚ NetworkX â”‚ â”‚ DGLEngineâ”‚  â”‚  â”‚
</span></span><span class="line"><span class="cl"> â”‚     â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
</span></span><span class="line"><span class="cl"> â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
</span></span><span class="line"><span class="cl"> â”‚     â”‚             â”‚        Spark                                          â”‚
</span></span><span class="line"><span class="cl"> â”‚     â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€Reader â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
</span></span><span class="line"><span class="cl"> â”‚  Spark                   Query Mode           â”‚                           â”‚
</span></span><span class="line"><span class="cl"> â”‚  Reader                                       â”‚                           â”‚
</span></span><span class="line"><span class="cl"> â”‚Scan Mode                                      â–¼                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl"> â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ ngai-udfâ”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl"> â”‚     â”‚  â”‚                                                   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
</span></span><span class="line"><span class="cl"> â”‚     â”‚  â”‚  NebulaGraph Graph Engine         Nebula-GraphD   â”‚   ngai-GraphD     â”‚              â”‚
</span></span><span class="line"><span class="cl"> â”‚     â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
</span></span><span class="line"><span class="cl"> â”‚     â”‚  â”‚                              â”‚                    â”‚                                  â”‚
</span></span><span class="line"><span class="cl"> â”‚     â”‚  â”‚  NebulaGraph Storage Engine  â”‚                    â”‚                                  â”‚
</span></span><span class="line"><span class="cl"> â”‚     â”‚  â”‚                              â”‚                    â”‚                                  â”‚
</span></span><span class="line"><span class="cl"> â”‚     â””â”€â–¶â”‚  Nebula-StorageD             â”‚    Nebula-Metad    â”‚                                  â”‚
</span></span><span class="line"><span class="cl"> â”‚        â”‚                              â”‚                    â”‚                                  â”‚
</span></span><span class="line"><span class="cl"> â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
</span></span><span class="line"><span class="cl"> â”‚                                                                                               â”‚
</span></span><span class="line"><span class="cl"> â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
</span></span><span class="line"><span class="cl"> â”‚    â”‚ RETURN ng_ai(&#34;pagerank&#34;, [&#34;follow&#34;], [&#34;degree&#34;], &#34;spark&#34;, {space:&#34;basketballplayer&#34;}) â”‚â”€â”€â”˜
</span></span><span class="line"><span class="cl"> â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="cl"> â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl"> â”‚  â”‚ from ng_ai import NebulaReader                              â”‚
</span></span><span class="line"><span class="cl"> â”‚  â”‚                                                             â”‚
</span></span><span class="line"><span class="cl"> â”‚  â”‚ # read data with spark engine, scan mode                    â”‚
</span></span><span class="line"><span class="cl"> â”‚  â”‚ reader = NebulaReader(engine=&#34;spark&#34;)                       â”‚
</span></span><span class="line"><span class="cl"> â”‚  â”‚ reader.scan(edge=&#34;follow&#34;, props=&#34;degree&#34;)                  â”‚
</span></span><span class="line"><span class="cl"> â””â”€â”€â”‚ df = reader.read()                                          â”‚
</span></span><span class="line"><span class="cl">    â”‚                                                             â”‚
</span></span><span class="line"><span class="cl">    â”‚ # run pagerank algorithm                                    â”‚
</span></span><span class="line"><span class="cl">    â”‚ pr_result = df.algo.pagerank(reset_prob=0.15, max_iter=10)  â”‚
</span></span><span class="line"><span class="cl">    â”‚                                                             â”‚
</span></span><span class="line"><span class="cl">    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description>
</item><item>
    <title>å›¾æ•°æ®åº“é©±åŠ¨çš„åŸºç¡€è®¾æ–½è¿ç»´ç¤ºä¾‹</title>
    <link>https://siwei.io/graph-enabled-infra-ops/</link>
    <pubDate>Fri, 13 Jan 2023 22:22:44 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/graph-enabled-infra-ops/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/graph-enabled-infra-ops/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>å›¾æŠ€æœ¯åœ¨å¤§å‹ã€å¤æ‚åŸºç¡€è®¾æ–½ä¹‹ä¸­ SRE/DevOps çš„å®è·µå‚è€ƒï¼Œæœ¬æ–‡ä»¥ OpenStack ç³»ç»Ÿä¹‹ä¸Šçš„å›¾æ•°æ®åº“å¢å¼ºçš„è¿ç»´æ¡ˆä¾‹ä¸ºä¾‹ï¼Œæ­ç¤ºå›¾æ•°æ®åº“ã€å›¾ç®—æ³•çš„æ™ºèƒ½è¿ç»´æ–¹æ³•ï¼Œå…¨æµç¨‹ç¤ºä¾‹ä»£ç å¼€æºã€‚</p>
</blockquote>
<p>å› ä¸ºæœ‰ä¸€äº›è¿˜æœªé‡‡ç”¨å›¾æŠ€æœ¯çš„ DevOps/Infra é¢†åŸŸåŒå­¦åœ¨ NebulaGraph ç¤¾åŒºè¯¢é—®å‚è€ƒçš„æ¡ˆä¾‹ï¼Œæˆ‘æœ€è¿‘è¯•ç€å®è·µäº†ä¸€ä¸‹å¦‚ä½•åˆ©ç”¨å›¾çš„èƒ½åŠ›ä¸ä¼˜åŠ¿å»å¸®åŠ©åœ¨å¤æ‚åŸºç¡€è®¾æ–½ä¸Šæ„å»ºè¾…åŠ©è¿ç»´ç³»ç»Ÿï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°æ„Ÿå…´è¶£ Infra Ops é¢†åŸŸã€åŒæ—¶æ„Ÿå…´è¶£å›¾æ•°æ®åº“ã€å›¾ç®—æ³•çš„å¤§å®¶ï¼Œå…¨è¿‡ç¨‹éƒ½æ˜¯å¯ä»¥å¤ç°ã€å¹¶ä¸”å¼€æºçš„ã€‚</p>
<p>å¤æ‚çš„åŸºç¡€è®¾æ–½è¿ç»´ç¯å¢ƒé€šå¸¸åŒ…å«éå¸¸å¤šã€ä¸åŒå±‚é¢çš„èµ„æºï¼ˆmanifest)ï¼Œä¸ºäº†èƒ½å¤Ÿå°½é‡è¿˜åŸçœŸå®ä¸–ç•Œçš„å¤æ‚ç¯å¢ƒã€åˆä¿æŒè¿™ä¸ªå®ä¾‹é¡¹ç›®çš„å¤æ‚åº¦ä¸ä¼šå¤±æ§ï¼Œæˆ‘é€‰æ‹©äº†ç”¨ä¸€ä¸ªåŸºç¡€è®¾æ–½å¹³å°ï¼šOpenStack ä½œä¸ºä¾‹å­ã€‚</p>
<p>æœ¬æ–‡å®ç°äº† OpenStack ç³»ç»Ÿä¸Šåˆ†åˆ«åˆ©ç”¨ Push å’Œ Pull ä¸¤ç§æ¨¡å¼å°†èµ„æºä¹‹ä¸­è¢«å›¾è°±å»ºæ¨¡çš„å›¾ä¸­ç‚¹ã€è¾¹ä¿¡æ¯åŠ è½½åˆ° NebulaGraph é‡Œçš„ Graph ETL ç®¡é“çš„è·¯å¾„ã€‚</p>
<p>åœ¨å›¾è°±ä¹‹ä¸Šï¼Œæœ¬æ–‡æ¢ç´¢å¦‚ä¸‹ç”¨ä¾‹ï¼š</p>
<ul>
<li>å‘Šè­¦ã€çŠ¶æ€çš„æ¨ç†ä¸ä¼ å¯¼ï¼›</li>
<li>ç½‘ç»œç›´è¿ä¸äº’è”å…³ç³»ï¼›</li>
<li>é•œåƒã€äº‘ç›˜ã€å¿«ç…§è¡€ç¼˜ç®¡ç†ï¼›</li>
<li>é«˜ç›¸å…³æ€§è™šæœºé¢„è­¦ï¼›</li>
<li>ç§˜é’¥æ³„æ¼çš„å›¾ä¸Šé£æ§åˆ†æï¼›</li>
<li>é•œåƒã€äº‘ç›˜æ¼æ´èŒƒå›´åˆ†æï¼›</li>
<li>å®¿ä¸»æœºé€ƒç¦»å½±å“èŒƒå›´åˆ†æï¼›</li>
<li>è„†å¼±ä¾èµ–èµ„æºæ£€æµ‹ï¼›</li>
</ul>
<h2 id="è¯•éªŒç¯å¢ƒæ­å»º" class="headerLink">
    <a href="#%e8%af%95%e9%aa%8c%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba" class="header-mark"></a>1 è¯•éªŒç¯å¢ƒæ­å»º</h2><h3 id="èƒŒæ™¯çŸ¥è¯†" class="headerLink">
    <a href="#%e8%83%8c%e6%99%af%e7%9f%a5%e8%af%86" class="header-mark"></a>1.1 èƒŒæ™¯çŸ¥è¯†</h3><p>OpenStack æ˜¯ä¸€ä¸ªå¼€æºçš„äº‘è®¡ç®—å¹³å°ï¼Œæä¾›äº†ç±»ä¼¼äº AWS çš„äº‘æœåŠ¡ã€‚å®ƒæä¾›äº†ä¸€ç»„å¯æ’æ‹”çš„æ¨¡å—ï¼ŒåŒ…æ‹¬äº†è®¡ç®—ï¼Œå­˜å‚¨å’Œç½‘ç»œç­‰åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·æ„å»ºå’Œç®¡ç†äº‘ç¯å¢ƒã€‚OpenStacké‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„ï¼Œæ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶å¹³å°ï¼Œå¯ä»¥åœ¨ä¼ä¸šçº§å’ŒæœåŠ¡æä¾›å•†çº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/OpenStack-overview-diagram-new.webp" title="OpenStack-overview-diagram-new" data-thumbnail="/graph-enabled-infra-ops/OpenStack-overview-diagram-new.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/OpenStack-overview-diagram-new.webp"
            srcset="/graph-enabled-infra-ops/OpenStack-overview-diagram-new.webp, /graph-enabled-infra-ops/OpenStack-overview-diagram-new.webp 1.5x, /graph-enabled-infra-ops/OpenStack-overview-diagram-new.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/OpenStack-overview-diagram-new.webp">
    </a></figure></p>
<p>æœ€åˆç”± <em>NASA</em> å’Œ <em>Rackspace</em> Inc. å‘èµ·çš„ nova ï¼ˆè™šæ‹ŸåŒ–è®¡ç®—é¡¹ç›®ï¼‰å’Œ swift ï¼ˆå…¼å®¹ S3 çš„å¯¹è±¡å­˜å‚¨ï¼‰é¡¹ç›®ç»„æˆï¼ŒOpenStack ç°åœ¨ç”±éå¸¸å¤šä¸åŒçš„å­é¡¹ç›®ç»„æˆï¼š</p>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/openstack-map-v20221001.webp" title="openstack-map-v20221001" data-thumbnail="/graph-enabled-infra-ops/openstack-map-v20221001.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/openstack-map-v20221001.webp"
            srcset="/graph-enabled-infra-ops/openstack-map-v20221001.webp, /graph-enabled-infra-ops/openstack-map-v20221001.webp 1.5x, /graph-enabled-infra-ops/openstack-map-v20221001.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/openstack-map-v20221001.webp">
    </a></figure></p>
<p>æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬è®¾è®¡çš„ OpenStack ä¸»è¦é¡¹ç›®æœ‰ï¼š</p>
<ul>
<li>Nova æ˜¯ OpenStack çš„è®¡ç®—æœåŠ¡ï¼Œç”¨äºç®¡ç†è™šæ‹Ÿæœºã€‚</li>
<li>Cinder æ˜¯ OpenStack çš„å—å­˜å‚¨æœåŠ¡ï¼Œç”¨äºç®¡ç†äº‘å­˜å‚¨ã€‚</li>
<li>Neutron æ˜¯ OpenStack çš„ç½‘ç»œæœåŠ¡ï¼Œç”¨äºç®¡ç†äº‘ç½‘ç»œã€‚</li>
<li>Glance æ˜¯ OpenStack çš„é•œåƒæœåŠ¡ï¼Œç”¨äºç®¡ç†äº‘é•œåƒã€‚</li>
<li>Horizon æ˜¯ OpenStack çš„å¯è§†åŒ–æ§åˆ¶å°æœåŠ¡ã€‚</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è¿˜å¼•å…¥äº† Vitrage é¡¹ç›®è¾…åŠ©æˆ‘ä»¬æ”¶é›†éƒ¨åˆ†èµ„æºæ•°æ®ï¼š</p>
<ul>
<li>Vitrage æ˜¯ OpenStack ä¸­çš„ä¸€ä¸ªé«˜çº§åˆ†æå’Œå¯è§†åŒ–å·¥å…·ï¼Œç”¨äºåˆ†æå’Œå¯è§†åŒ– OpenStack ç¯å¢ƒä¸­çš„èµ„æºå’Œäº‹ä»¶ã€‚å®ƒå¯ä»¥æ±‡é›†æ¥è‡ª OpenStack å„ä¸ªæœåŠ¡çš„æ•°æ®ï¼Œå¹¶ä½¿ç”¨å›¾å½¢åŒ–æ–¹å¼å±•ç¤ºå‡ºæ¥ã€‚Vitrage å‘ç°å’Œè¯Šæ–­é—®é¢˜ï¼Œæé«˜ OpenStack ç¯å¢ƒçš„å¯ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
</ul>
<p>å¾—ç›Šäº OpenStack Decouple çš„è®¾è®¡ç†å¿µï¼ŒVitrage å¯ä»¥å¾ˆå®¹æ˜“ã€æ— ä¾µå…¥å¼ï¼ˆåªéœ€è¦ä¿®æ”¹éœ€è¦æ”¶é›†çš„æœåŠ¡ä¸¤è¡Œé…ç½®ï¼‰å°±å¯ä»¥åœ¨ OpenStack çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­è®¢é˜…èµ„æºä¿¡æ¯çš„ push æ¶ˆæ¯ã€‚</p>
<p>ä¸è¿‡æ¯”è¾ƒé—æ†¾çš„æ˜¯ Vitrage è¿™ä¸ªé¡¹ç›®å·²ç»æœ‰å¥½å¤šä¸ª release cycle æ²¡æœ‰ä»€ä¹ˆå¤§çš„æ›´æ–°äº†ï¼Œåº”è¯¥æ˜¯æ¯”è¾ƒä¸æ´»è·ƒçš„çŠ¶æ€äº†ï¼Œæ¯”å¦‚åœ¨ zed é‡Œï¼Œå®ƒçš„ Vitrage Dashboard ä½œä¸º Horizon æ’ä»¶å·²ç»æ— æ³•æ­£å¸¸å·¥ä½œäº†ï¼Œæœ¬å®éªŒåªåˆ©ç”¨å®ƒçš„èµ„æºæ”¶é›†èƒ½åŠ›ã€‚</p>
<h3 id="ç¯å¢ƒå‡†å¤‡æ­å»º" class="headerLink">
    <a href="#%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87%e6%90%ad%e5%bb%ba" class="header-mark"></a>1.2 ç¯å¢ƒå‡†å¤‡æ­å»º</h3><h4 id="nebulagraph-é›†ç¾¤" class="headerLink">
    <a href="#nebulagraph-%e9%9b%86%e7%be%a4" class="header-mark"></a>1.2.1 NebulaGraph é›†ç¾¤</h4><p>é¦–æ¬¡å¿«é€Ÿè¯•ç©å®‰è£… NebulaGraph çš„è¯ï¼Œæœ‰è¿™ä¹ˆå‡ ä¸ªé€‰é¡¹ï¼š</p>
<ul>
<li>é˜¿é‡Œäº‘ä¸Šçš„ NebulaGraph ä¼ä¸šç‰ˆï¼ˆå¸¦æœ‰ä¼ä¸šç‰ˆç‹¬æœ‰çš„æ»¡è¡€ç‰ˆå¯è§†åŒ–å·¥å…·ï¼šExplorerï¼Œå¯ä»¥å›¾æ¢ç´¢ã€ç”»å¸ƒå†…è·‘å›¾ç®—æ³•ï¼‰ï¼Œå¯ä»¥è·å¾—ä¸€ä¸ªæœˆæ‰€æœ‰èµ„æºå…è´¹ä½¿ç”¨èµ„æ ¼ï¼š
<ul>
<li>è®¿é—® <a href="https://www.siwei.io/try-aliyun" target="_blank" rel="noopener noreferrer">https://www.siwei.io/try-aliyun</a> è·å¾—</li>
</ul>
</li>
<li>Nebula-Up ä¸€é”®å®‰è£… NebulaGraph å¼€æºç¤¾åŒºç‰ˆæœ¬ï¼Œéœ€è¦ä¸€ä¸ªå¸¦æœ‰ Dockerã€Docker Desktop ç¯å¢ƒçš„æœºå™¨
<ul>
<li>è®¿é—® <a href="https://github.com/wey-gu/nebula-up" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/nebula-up</a></li>
</ul>
</li>
<li>æœ‰ç»éªŒçš„åŒå­¦å¯ä»¥å‚è€ƒæ–‡æ¡£è¿›è¡Œéƒ¨ç½²ï¼š
<ul>
<li>è®¿é—® <a href="https://docs.nebula-graph.com.cn/" target="_blank" rel="noopener noreferrer">https://docs.nebula-graph.com.cn/</a></li>
</ul>
</li>
</ul>
<h4 id="openstack-é›†ç¾¤" class="headerLink">
    <a href="#openstack-%e9%9b%86%e7%be%a4" class="header-mark"></a>1.2.2 OpenStack é›†ç¾¤</h4><blockquote>
<p>æ³¨æ„ï¼šå¦‚æœå¤§å®¶å·²ç»æœ‰ç°æˆçš„ OpenStack é›†ç¾¤ï¼Œè¿™ä¸€æ­¥å¯ä»¥å¿½ç•¥ï¼Œæ‚¨åªéœ€è¦å†å»å®‰è£… OpenStack Vitrage å°±å¥½äº†ã€‚</p>
</blockquote>
<p>æœ¬æ–‡éœ€è¦çš„ OpenStack é›†ç¾¤æ˜¯ä¸€ä¸ªå¤šæœºçš„ç¯å¢ƒï¼Œä¸ºæ­¤ï¼Œæˆ‘å‡†å¤‡äº†åœ¨ Linux Server ä¸Šåˆ©ç”¨ Libvirt å’Œ Linux Bridge æ­å»ºå¤šä¸ªè™šæ‹Ÿæœºç”¨æ¥æ¨¡æ‹Ÿ OpenStack çš„ç‰©ç†æœºï¼Œå¾—ç›Šäº CPU çš„åµŒå¥—è™šæ‹ŸåŒ–å’Œ qemuï¼Œåè¾¹æˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨è™šæ‹Ÿæœºæ­å»ºçš„å®éªŒç¯å¢ƒä¸­æ¨¡æ‹Ÿå¯æ­£å¸¸å·¥ä½œçš„ OpenStack nova instance è™šæœºã€‚</p>
<p>æ•´ä¸ªæµç¨‹æˆ‘éƒ½æ”¾åœ¨ <a href="https://github.com/wey-gu/openstack-graph/#environment-setup" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/openstack-graph/#environment-setup</a> è¿™é‡Œäº†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è®¿é—®ã€è·å–ã€‚</p>
<p>è™šæ‹Ÿæœºæ­å»ºä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ¨¡æ‹ŸçœŸå®çš„ Infra ç¯å¢ƒï¼Œåˆ›å»ºå¾ˆå¤šèµ„æºï¼šæ•´ä¸ªè¿‡ç¨‹ä¹Ÿåœ¨ <a href="https://github.com/wey-gu/openstack-graph/#create-resources-on-openstack" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/openstack-graph/#create-resources-on-openstack</a> æœ‰è¯¦ç»†åˆ—å‡ºï¼Œæƒ³è¦åŠ¨æ‰‹æ“ä½œçš„åŒå­¦å¯ä»¥å‚è€ƒæ¥äº²è‡ªä¸Šæ‰‹ä¸€ä¸‹ã€‚</p>
<p>å‚è€ƒå¦‚ä¸Šæ­¥éª¤æ“ä½œä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥å¯ä»¥é€šè¿‡ Horizon Dashboard æŸ¥çœ‹é›†ç¾¤å’Œèµ„æºï¼š</p>
<p>æˆ‘ä»¬åˆ›å»ºäº†å‡ ä¸ªè™šæ‹Ÿæœºï¼š<figure><a class="lightgallery" href="/graph-enabled-infra-ops/nova_instance.webp" title="nova_instance" data-thumbnail="/graph-enabled-infra-ops/nova_instance.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/nova_instance.webp"
            srcset="/graph-enabled-infra-ops/nova_instance.webp, /graph-enabled-infra-ops/nova_instance.webp 1.5x, /graph-enabled-infra-ops/nova_instance.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/nova_instance.webp">
    </a></figure></p>
<p>å‡ ä¸ªç½‘ç›˜ï¼Œå…¶ä¸­å››ä¸ªæŒ‚è½½åœ¨ä¸åŒçš„è™šæ‹Ÿæœºä¸Š</p>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/cinder_volume.webp" title="cinder_volume" data-thumbnail="/graph-enabled-infra-ops/cinder_volume.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/cinder_volume.webp"
            srcset="/graph-enabled-infra-ops/cinder_volume.webp, /graph-enabled-infra-ops/cinder_volume.webp 1.5x, /graph-enabled-infra-ops/cinder_volume.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/cinder_volume.webp">
    </a></figure></p>
<p>é›†ç¾¤ç§Ÿæˆ·çš„ç½‘ç»œæ‹“æ‰‘ï¼š<figure><a class="lightgallery" href="/graph-enabled-infra-ops/neutron_topology.webp" title="neutron_topology" data-thumbnail="/graph-enabled-infra-ops/neutron_topology.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/neutron_topology.webp"
            srcset="/graph-enabled-infra-ops/neutron_topology.webp, /graph-enabled-infra-ops/neutron_topology.webp 1.5x, /graph-enabled-infra-ops/neutron_topology.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/neutron_topology.webp">
    </a></figure></p>
<p>æˆ‘ä»¬è¿˜èƒ½é€šè¿‡ OpenStack Vitrage çš„ API/CLI è·å¾—éƒ¨åˆ†ä¸»è¦èµ„æºçš„æ‹“æ‰‘ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">source</span> openrc admin admin
</span></span><span class="line"><span class="cl">vitrage topology show --all-tenants
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒçš„ç»“æœæ˜¯ä¸€ä¸ª JSONï¼Œé‡Œè¾¹å·²ç»æŒ‰ç…§è¾¹ï¼ˆlinksï¼‰å’Œç‚¹ï¼ˆnodesï¼‰åºåˆ—åŒ–å›¾ç»“æ„çš„æ•°æ®äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;directed&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;graph&#34;</span><span class="p">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;links&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_is_deleted&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;relationship_type&#34;</span><span class="p">:</span> <span class="s2">&#34;contains&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;source&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;target&#34;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;contains&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_is_deleted&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;relationship_type&#34;</span><span class="p">:</span> <span class="s2">&#34;contains&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;source&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;target&#34;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;contains&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="err">...</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_is_deleted&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;relationship_type&#34;</span><span class="p">:</span> <span class="s2">&#34;attached&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;source&#34;</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;target&#34;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;attached&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;multigraph&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;nodes&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;node0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_type&#34;</span><span class="p">:</span> <span class="s2">&#34;nova.host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_category&#34;</span><span class="p">:</span> <span class="s2">&#34;RESOURCE&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_is_deleted&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;update_timestamp&#34;</span><span class="p">:</span> <span class="s2">&#34;2023-01-13T08:06:48Z&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_sample_timestamp&#34;</span><span class="p">:</span> <span class="s2">&#34;2023-01-13T08:06:49Z&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_is_placeholder&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_id&#34;</span><span class="p">:</span> <span class="s2">&#34;630b4c2c-5347-4073-91a3-255ec18dadfc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;node0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_cached_id&#34;</span><span class="p">:</span> <span class="s2">&#34;d043d278a6a712909e30e50ca8ec2364&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;is_real_vitrage_id&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_aggregated_state&#34;</span><span class="p">:</span> <span class="s2">&#34;AVAILABLE&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_operational_state&#34;</span><span class="p">:</span> <span class="s2">&#34;OK&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_datasource_name&#34;</span><span class="p">:</span> <span class="s2">&#34;nova.host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;state&#34;</span><span class="p">:</span> <span class="s2">&#34;available&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;graph_index&#34;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;nova&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_type&#34;</span><span class="p">:</span> <span class="s2">&#34;nova.zone&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_category&#34;</span><span class="p">:</span> <span class="s2">&#34;RESOURCE&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_is_deleted&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_sample_timestamp&#34;</span><span class="p">:</span> <span class="s2">&#34;2023-01-12T03:06:48Z&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_is_placeholder&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_id&#34;</span><span class="p">:</span> <span class="s2">&#34;a1e9c808-dac8-4b59-8f80-f21a90e9869d&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_cached_id&#34;</span><span class="p">:</span> <span class="s2">&#34;125f1d8c4451a6385cc2cfa2b0ba45be&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;is_real_vitrage_id&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_aggregated_state&#34;</span><span class="p">:</span> <span class="s2">&#34;AVAILABLE&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_operational_state&#34;</span><span class="p">:</span> <span class="s2">&#34;OK&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;state&#34;</span><span class="p">:</span> <span class="s2">&#34;available&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;update_timestamp&#34;</span><span class="p">:</span> <span class="s2">&#34;2023-01-12T03:06:48Z&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;nova&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vitrage_datasource_name&#34;</span><span class="p">:</span> <span class="s2">&#34;nova.zone&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;graph_index&#34;</span><span class="p">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="err">...</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;raw&#34;</span><span class="err">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å›¾è°±å»ºæ¨¡" class="headerLink">
    <a href="#%e5%9b%be%e8%b0%b1%e5%bb%ba%e6%a8%a1" class="header-mark"></a>2 å›¾è°±å»ºæ¨¡</h2><p>æœ¬å®éªŒç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬è€ƒè™‘çº³å…¥å¦‚ä¸‹èµ„æºè¿›å…¥å›¾è°±ï¼š</p>
<ul>
<li>nova instance: æ˜¯NovaæœåŠ¡ä¸­çš„è™šæ‹Ÿæœºå®ä¾‹ï¼Œæ¯ä¸ªnova instanceéƒ½æœ‰è‡ªå·±çš„é…ç½®ä¿¡æ¯ï¼ˆå¦‚CPUã€å†…å­˜ã€ç£ç›˜ç­‰ï¼‰ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å°±å«å®ƒ server æˆ–è€… VMã€è™šæœºã€‚</li>
<li>nova hostæ˜¯NovaæœåŠ¡ä¸­çš„ç‰©ç†ä¸»æœºï¼Œæ˜¯nova instanceè¿è¡Œçš„ç‰©ç†ç¯å¢ƒã€‚nova hostä¸Šé¢ä¼šè¿è¡Œnova-computeæœåŠ¡ï¼Œè¿™ä¸ªæœåŠ¡è´Ÿè´£ç®¡ç†å’Œè°ƒåº¦nova instanceã€‚nova hostä¸Šé¢è¿˜å¯èƒ½è¿è¡Œå…¶ä»–æœåŠ¡ï¼Œå¦‚ç½‘ç»œæœåŠ¡ç­‰ã€‚</li>
<li>nova keypair: æ˜¯NovaæœåŠ¡ä¸­çš„å¯†é’¥å¯¹ï¼Œç”¨äºè®¿é—®nova instance</li>
<li>cinder volume: æ˜¯CinderæœåŠ¡ä¸­çš„äº‘å­˜å‚¨å·ï¼Œå¯ä»¥ attach åˆ°nova instanceä¸Šåšä¸ºç¡¬ç›˜</li>
<li>cinder snapshot: æ˜¯CinderæœåŠ¡ä¸­çš„äº‘å­˜å‚¨å¿«ç…§ï¼Œå¯ä»¥åœ¨cinder volumeä¸Šåšå¿«ç…§</li>
<li>glance image: æ˜¯GlanceæœåŠ¡ä¸­çš„é•œåƒï¼Œå¯ä»¥ä½œä¸ºåˆ›å»ºnova instanceæ—¶å€™çš„å¯åŠ¨ç¡¬ç›˜</li>
<li>neutron network: æ˜¯NeutronæœåŠ¡ä¸­çš„ç½‘ç»œï¼Œå¯ä»¥ç”¨äºé…ç½®nova instanceçš„ç½‘ç»œè¿æ¥</li>
<li>neutron port: æ˜¯NeutronæœåŠ¡ä¸­çš„ç«¯å£ï¼Œç”¨æ¥è¿æ¥nova instanceå’Œneutron networkä¹‹é—´ï¼Œåœ¨ nova instance è™šæ‹Ÿæœºä¸Šï¼Œä¸€ä¸ª port å¸¸å¸¸å¯¹åº”ä¸€ä¸ªç½‘å¡ï¼ˆå¦‚æœä¸æ˜¯ trunk port çš„è¯ï¼‰ã€‚</li>
</ul>
<p>ä»–ä»¬ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š</p>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/schema_draft.webp" title="schema_draft" data-thumbnail="/graph-enabled-infra-ops/schema_draft.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/schema_draft.webp"
            srcset="/graph-enabled-infra-ops/schema_draft.webp, /graph-enabled-infra-ops/schema_draft.webp 1.5x, /graph-enabled-infra-ops/schema_draft.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/schema_draft.webp">
    </a></figure></p>
<h2 id="åŸºç¡€è®¾æ–½å›¾-etl" class="headerLink">
    <a href="#%e5%9f%ba%e7%a1%80%e8%ae%be%e6%96%bd%e5%9b%be-etl" class="header-mark"></a>3 åŸºç¡€è®¾æ–½å›¾ ETL</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬è§£å†³ä»åŸºç¡€è®¾æ–½ä¸­æŠ½å–èµ„æºå…ƒæ•°æ®çš„é—®é¢˜ï¼Œ</p>
<h3 id="push-æ¨¡å¼" class="headerLink">
    <a href="#push-%e6%a8%a1%e5%bc%8f" class="header-mark"></a>3.1 push æ¨¡å¼</h3><p>è¿™é‡Œçš„ push æŒ‡çš„æ˜¯åŸºç¡€è®¾æ–½ä¸ºä¸»è¯­ï¼Œä»èµ„æºæ–¹å‘æˆ‘ä»¬çš„å›¾è°±ç³»ç»Ÿä¸»åŠ¨ã€äº‹ä»¶é©±åŠ¨åœ°å‘å‡ºèµ„æºå˜åŠ¨çš„ä¿¡æ¯ã€‚å®ƒçš„å¥½å¤„æ˜¯èµ„æºä¸­çš„å®æ—¶æ€§å¥½ï¼Œä½†æ˜¯åå¤„æ˜¯ä¾èµ–åŸºç¡€è®¾æ–½è‡ªèº«ï¼Œå¾ˆå¤šéå¸¸ç˜¦çš„ã€è½¯ä»¶å®šä¹‰/å¯ç¼–ç¨‹ç¨‹åº¦ä¸é«˜çš„ç»„ä»¶ã€æ¯”å¦‚æŸäº›ç¡¬ä»¶è®¾å¤‡æ²¡æœ‰ push æœºåˆ¶ï¼Œæˆ–è€…åƒæ˜¯å¤è€çš„è½¯ä»¶ç³»ç»Ÿä¸ä¸€å®šèƒ½å­˜åœ¨ push çš„æ¥å£ï¼Œæ”¹é€ èµ·æ¥æœ‰ä¾µå…¥æ€§ã€‚</p>
<p>å‰è¾¹æåŠè¿‡ï¼ŒOpenStack è‡ªèº«æ˜¯å­˜åœ¨ Push hook çš„æœºåˆ¶çš„ï¼Œå®ƒçš„å­é¡¹ç›® vitrage å°±åˆ©ç”¨è¿™ä¸ªæœºåˆ¶å¾ˆä¼˜é›…åœ°æ”¶é›†ç³»ç»Ÿèµ„æºã€å‘Šè­¦ç­‰ä¿¡æ¯è¿›å…¥å›¾ä¸­ï¼Œç±»ä¼¼çš„æœºåˆ¶åœ¨å…¶ä»–å¹³å°ä¸­ä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ã€‚</p>
<p>æœ¬å®éªŒä¸­æˆ‘ä»¬å°±åˆ©ç”¨ vitrage çš„æœºåˆ¶å»æ”¶é›†ä¸€éƒ¨åˆ†å›¾è°±ä¸­çš„èµ„æºä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ° vitrage ä¼šåœ¨ OpenStack message bus ä¸­è®¢é˜… nova/cinder/neutron ç­‰æœåŠ¡ä¸­çš„èµ„æºæ—¶é—´ï¼ŒæŠŠäº‹ä»¶ä¼ å…¥ Entity Queueï¼Œç»è¿‡å¤„ç†ï¼Œå­˜å‚¨åˆ° Entity Graph ä¸­ã€‚</p>
<p>åœ¨æ­¤ä¹‹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ vitrage API è·å–å›¾è°±çš„æ‹“æ‰‘ï¼Œæ¥æ¶ˆè´¹å®ƒã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå®é™…ä¸Š Vitrage æœåŠ¡è¿˜æä¾›äº†æ¨ç†å‘Šè­¦ã€æ¨ç†çŠ¶æ€ã€å®šä¹‰å†³ç­–äº‹ä»¶çš„èƒ½åŠ›ï¼Œè¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰é‡‡ç”¨ï¼Œåè¾¹æˆ‘ä»¬åœ¨å›¾ä¸Šåšçš„ä¸€äº›äº‹æƒ…ç”šè‡³è¿˜å’Œå®ƒçš„èƒ½åŠ›æœ‰ä¸€äº›é‡å ã€‚</p>
</blockquote>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/vitrage_arch.webp" title="vitrage_arch" data-thumbnail="/graph-enabled-infra-ops/vitrage_arch.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/vitrage_arch.webp"
            srcset="/graph-enabled-infra-ops/vitrage_arch.webp, /graph-enabled-infra-ops/vitrage_arch.webp 1.5x, /graph-enabled-infra-ops/vitrage_arch.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/vitrage_arch.webp">
    </a></figure></p>
<p>è¿™é‡Œæˆ‘åªæ˜¯ç”¨å®ƒæ¥å±•ç¤º push æ¨¡å¼çš„å·¥ä½œæœºåˆ¶ï¼Œå¦‚æœæ²¡æœ‰ Virtrage è¿™ä¸ªé¡¹ç›®å­˜åœ¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ¯”è¾ƒå®¹æ˜“é€šè¿‡ OpenStack çš„ oslo.messaging è¿™ä¸ªåº“å¾ˆå®¹æ˜“å†™å‡ºåœ¨ Message Busï¼ˆå¯èƒ½æ˜¯ Kafka, RabbitMQ ç­‰ä¸åŒåº•å±‚å®ç°ï¼‰ä¸Šè®¢é˜…èµ„æºæ—¶é—´çš„åº”ç”¨ï¼Œç„¶åæŠŠäº‹ä»¶é€šè¿‡ Flink/ Kafka/ Pulsar ç­‰æ–¹å¼æ¥é©³ NebulaGraphã€‚</p>
<p>å› ä¸º Vitrage çš„å­˜åœ¨ï¼Œæˆ‘å°±å·æ‡’ä¸ç”¨å»å®ç°è¿™éƒ¨åˆ†é€»è¾‘ï¼Œåªæ¶ˆå†™ä¸€å°éƒ¨åˆ†ä»£ç è°ƒç”¨ Vitrage API å–è¿™ä¸ªæ•°æ®å°±å¯ä»¥äº†ï¼Œè®½åˆºçš„æ˜¯ï¼Œä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œè¿™å…¶å®æ˜¯ä¸€ç§ pull çš„æ¨¡å¼äº†ï¼Œä¸ç”¨æ‹˜æ³¥å®ƒæœ¬è´¨ä¸Šç®—æ˜¯å“ªä¸€ç§æ–¹å¼ï¼Œè‡³å°‘åœ¨èµ„æºå‘èµ·æµ‹ï¼Œæˆ‘ä»¬æŠŠå®ƒå½“åš push æ¨¡å¼çš„ä¾‹å­çœ‹å¾…å§ã€‚</p>
<p>è¿™éƒ¨åˆ†ä» Vitrage æŠ“å–çš„ä»£ç æˆ‘æ”¾åœ¨ <a href="https://github.com/wey-gu/openstack-graph/blob/main/utils/vitrage_to_graph.py" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/openstack-graph/blob/main/utils/vitrage_to_graph.py</a> äº†ï¼Œè°ƒç”¨æ–¹å¼å¾ˆç®€å•ï¼Œåœ¨æœ‰ OpenStack å®¢æˆ·ç«¯çš„ç¯å¢ƒä¸­ï¼Œæ‰§è¡Œå®ƒå°±å¯ä»¥äº†ï¼Œæ¯”å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># è¿åˆ° node0 ä¸Š</span>
</span></span><span class="line"><span class="cl">ssh stack@node0_ip
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿›å…¥ devstack ç›®å½•</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> devstack
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¸‹è½½ vitrage ä¸­å›¾æ•°æ®ï¼Œè§£æä¸º NeublaGraph DML/DQL çš„å·¥å…·</span>
</span></span><span class="line"><span class="cl">wget https://raw.githubusercontent.com/wey-gu/openstack-graph/main/utils/vitrage_to_graph.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ‰§è¡Œå®ƒ</span>
</span></span><span class="line"><span class="cl">python3 vitrage_to_graph.py
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œä¹‹åï¼Œä¼šç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶ï¼š</p>
<ul>
<li><code>schema.ngql</code> å›¾æ•°æ®çš„ Schema å®šä¹‰</li>
<li><code>vertices/</code> ç‚¹æ•°æ®çš„æ–‡ä»¶å¤¹</li>
<li><code>edges/</code> è¾¹æ•°æ®çš„æ–‡ä»¶å¤¹</li>
</ul>
<h3 id="pull-æ¨¡å¼" class="headerLink">
    <a href="#pull-%e6%a8%a1%e5%bc%8f" class="header-mark"></a>3.2 pull æ¨¡å¼</h3><p>åè¿‡æ¥ï¼Œpull æ¨¡å¼æ˜¯ä»èµ„æºå¤–éƒ¨å®šæœŸæˆ–è€…äº‹ä»¶é©±åŠ¨åœ°æ‹‰å–èµ„æºï¼Œå­˜å…¥å›¾è°±çš„æ–¹å¼ã€‚åˆšå¥½æœ¬å®éªŒä¸­ vitrage æŠ“å–çš„èµ„æºæ˜¯æœ‰é™çš„ï¼Œæœ‰ä¸€äº›é¢å¤–çš„èµ„æºæˆ‘å•ç‹¬å†™äº† python çš„ä»£ç æ¥ä¸»åŠ¨å…¨é‡æŠ“å–ï¼Œpull æ¨¡å¼çš„å¥½å¤„æ˜¯å¯¹èµ„æºæ–¹æ²¡æœ‰ä»»ä½•ä¾µå…¥æ€§ï¼Œåªéœ€è¦è°ƒç”¨å®ƒçš„æ¥å£è·å–ä¿¡æ¯å°±å¯ä»¥äº†ï¼Œåå¤„åˆ™æ˜¯æœ‰çš„ç³»ç»Ÿä¸å¤ªå®¹æ˜“è·å¾—å¢é‡å˜åŒ–ï¼Œå¯èƒ½åªèƒ½å…¨é‡å»å–ã€‚</p>
<p>è¿™éƒ¨åˆ†æˆ‘æŠ“å–çš„å…³ç³»å¦‚ä¸‹ï¼š</p>
<ul>
<li>glance_used_by: <code>image -[:used_by]-&gt; instance (get from instance)</code></li>
<li>glance_created_from: <code>image -[:created_from]-&gt; volume (get from image)</code></li>
<li>nova_keypair_used_by: <code>keypair -[:used_by]-&gt; instance (get from instance)</code></li>
<li>cinder_snapshot_created_from: <code>volume snapshot -[:created_from]-&gt; volume (get from snapshot)</code></li>
<li>cinder_volume_created_from: <code>volume -[:created_from]-&gt; volume snapshot (get from volume)</code></li>
<li>cinder_volume_created_from: <code>volume -[:created_from]-&gt; image (get from volume)</code></li>
</ul>
<p>ç±»ä¼¼çš„ï¼Œå®ƒçš„ä»£ç æ”¾åœ¨ <a href="https://github.com/wey-gu/openstack-graph/blob/main/utils/pull_resources_to_graph.py" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/openstack-graph/blob/main/utils/pull_resources_to_graph.py</a> ä¹‹ä¸­ï¼Œåœ¨çœŸå®åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç”¨ Apache Airflowã€dagster ç”šè‡³æ˜¯ cron job ç­‰æ–¹å¼å®šæœŸæ‰§è¡Œå®ƒã€‚</p>
<p>æˆ‘ä»¬æ‰‹åŠ¨æ‰§è¡Œçš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># è¿åˆ° node0 ä¸Š</span>
</span></span><span class="line"><span class="cl">ssh stack@node0_ip
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿›å…¥ devstack ç›®å½•</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> devstack
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¸‹è½½æŠ“å– OpenStack èµ„æºï¼Œç”Ÿæˆ NeublaGraph DML/DQL çš„å·¥å…·</span>
</span></span><span class="line"><span class="cl">wget https://raw.githubusercontent.com/wey-gu/openstack-graph/main/utils/pull_resources_to_graph.py.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ‰§è¡Œå®ƒ</span>
</span></span><span class="line"><span class="cl">python3 pull_resources_to_graph.py
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œä¹‹åï¼Œä¼šç”Ÿæˆç‚¹ã€è¾¹çš„ ngql è¯­å¥åœ¨ä¸¤ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼š</p>
<ul>
<li><code>vertices/</code> ç‚¹æ•°æ®çš„æ–‡ä»¶å¤¹</li>
<li><code>edges/</code> è¾¹æ•°æ®çš„æ–‡ä»¶å¤¹</li>
</ul>
<h3 id="åŠ è½½æ•°æ®åˆ°-nebulagraph" class="headerLink">
    <a href="#%e5%8a%a0%e8%bd%bd%e6%95%b0%e6%8d%ae%e5%88%b0-nebulagraph" class="header-mark"></a>3.3 åŠ è½½æ•°æ®åˆ° NebulaGraph</h3><p>æˆ‘ä»¬åªéœ€è¦åœ¨ NebulaGraph Studio Console, Explorer Console æˆ–è€… NebulaGraph å‘½ä»¤è¡Œ Console ä¸­æ‰§è¡Œä¸Šè¾¹ç”Ÿæˆçš„ <code>.ngql</code> æ–‡ä»¶å°±å¥½äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># DDL from vitrage</span>
</span></span><span class="line"><span class="cl">cat schema.ngql
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># DDL and DML for both push and pull mode data</span>
</span></span><span class="line"><span class="cl">cat edges/*.ngql
</span></span><span class="line"><span class="cl">cat vertices/*.ngql
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹‹åï¼Œåœ¨ NebulaGraph ä¸­æˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªå«åš <code>openstack</code> çš„å›¾ç©ºé—´ï¼Œç”¨è¿™ä¸ªæŸ¥è¯¢å¯ä»¥æŸ¥åˆ°æ‰€æœ‰æ•°æ®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MATCH (n) WITH n LIMIT 1000
</span></span><span class="line"><span class="cl">OPTIONAL MATCH p=(n)--()
</span></span><span class="line"><span class="cl">RETURN p, n
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæ¸²æŸ“åœ¨ explorer ä¸­ï¼Œæ‰‹åŠ¨è®¾ç½®ä¸€ä¸‹æ•°æ®çš„å›¾æ ‡ï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ OpenStack é›†ç¾¤é‡Œçš„æ‰€æœ‰ç§Ÿæˆ·çš„èµ„æºå›¾äº†ï¼š</p>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/all_graph_view.webp" title="all_graph_view" data-thumbnail="/graph-enabled-infra-ops/all_graph_view.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/all_graph_view.webp"
            srcset="/graph-enabled-infra-ops/all_graph_view.webp, /graph-enabled-infra-ops/all_graph_view.webp 1.5x, /graph-enabled-infra-ops/all_graph_view.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/all_graph_view.webp">
    </a></figure></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»ˆäºå¯ä»¥åœ¨å›¾ä¸Šçœ‹çœ‹æœ‰æ„æ€çš„æ´å¯Ÿäº†ã€‚</p>
<h2 id="åŸºäºå›¾è°±çš„åŸºç¡€è®¾æ–½è¿ç»´ç¤ºä¾‹" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%9b%be%e8%b0%b1%e7%9a%84%e5%9f%ba%e7%a1%80%e8%ae%be%e6%96%bd%e8%bf%90%e7%bb%b4%e7%a4%ba%e4%be%8b" class="header-mark"></a>4 åŸºäºå›¾è°±çš„åŸºç¡€è®¾æ–½è¿ç»´ç¤ºä¾‹</h2><p>ä½œä¸ºé SREã€DevOps äººå‘˜ï¼Œæˆ‘å°è¯•è—‰ç”±è‡ªå·±åœ¨ OpenStack å’Œå›¾æŠ€æœ¯çš„ç†è§£æƒ³è±¡å‡ºä¸‹è¾¹çš„ä¸€äº›å®ä¾‹ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°éœ€è¦çš„è¯»è€…ä»¬ã€‚</p>
<h3 id="å‘Šè­¦çŠ¶æ€çš„æ¨ç†ä¸ä¼ å¯¼" class="headerLink">
    <a href="#%e5%91%8a%e8%ad%a6%e7%8a%b6%e6%80%81%e7%9a%84%e6%8e%a8%e7%90%86%e4%b8%8e%e4%bc%a0%e5%af%bc" class="header-mark"></a>4.1 å‘Šè­¦ã€çŠ¶æ€çš„æ¨ç†ä¸ä¼ å¯¼</h3><p>è¿™éƒ¨åˆ†æˆ‘æ”¶åˆ°äº† vitrage é¡¹ç›®çš„å¯å‘ï¼Œå‚è€ƒå®ƒä»¬ç»™å‡ºçš„å®ä¾‹æ–‡æ¡£ï¼š<a href="https://github.com/openstack/vitrage/blob/master/doc/source/contributor/vitrage-templates.rst" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>ã€‚</p>
<p>å€ŸåŠ©èµ„æºå›¾è°±å®æ—¶å›¾æŸ¥è¯¢ã€å›¾è®¡ç®—ç”šè‡³å›¾å¯è§†åŒ–èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å›¾ä¸Šæ¨ç†ã€ä¼ å¯¼ä¸€äº›ä¿¡æ¯ï¼ŒæŠŠé‡è¦çš„æ—¶é—´è—‰ç”±å›¾ä¸Šç»„ç»‡å¥½çš„çŸ¥è¯†åˆ†å‘åˆ°éœ€è¦æ”¶åˆ°é€šçŸ¥çš„äººã€ç»„ç»‡ã€ç³»ç»Ÿã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ nova hostï¼ˆè™šæ‹Ÿæœºçš„å®¿ä¸»æœºã€hypervisor æœºå™¨ï¼Œä»¥ä¸‹ç®€ç§°å®¿ä¸»æœºï¼‰ï¼Œä¸­è·å¾—äº†ä¸€ä¸ªå‘Šè­¦ã€äº‹ä»¶çš„æ—¶å€™ï¼Œå¯èƒ½æ˜¯ç½‘å¡å¤±è´¥ã€ç‰©ç†ç¡¬ç›˜é¢„è­¦ã€CPUå ç”¨è¿‡é«˜ä¹‹ç±»çš„å‘Šè­¦ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ©å›¾è°±æŸ¥è¯¢è·å¾—æ‰€æœ‰ç›¸å…³è”çš„è™šæœºï¼Œç„¶åæŠŠï¼ˆWARNï¼‰çº§åˆ«çš„å‘Šè­¦å‘å‡ºå»æˆ–è€…è®¾ç½®å®ƒä»¬ä¸ºï¼ˆäºšå¥åº·ï¼‰çš„çŠ¶æ€ã€‚</p>
<p>è¿™æ ·ï¼Œè·å¾—é€šçŸ¥çš„å¯¹è±¡ï¼Œå¾€å¾€æ˜¯ä¸€äº›ç”¨æˆ·çš„ç³»ç»Ÿï¼Œå°±å¯ä»¥æ ¹æ®ä»–ä»¬é¢„å…ˆå®šä¹‰å¥½çš„ç­–ç•¥åšä¸€äº›è‡ªåŠ¨åŒ–è¿ç»´ï¼Œæˆ–è€…é€šçŸ¥çš„ hookï¼š</p>
<ul>
<li>æ”¶åˆ°â€œå®¿ä¸»æœº CPU è¿‡é«˜â€çš„å‘Šè­¦çš„æƒ…å½¢ä¸‹ï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·è‡ªå·±è®¾å®šçš„ä¸åŒç­–ç•¥æŠŠè™šæœºè¿ç§»èµ°ï¼Œæˆ–è€…æ›´é«˜çº§å¤æ‚çš„æ’¤ç¦»æ–¹å¼ï¼ˆå¼€å§‹ä¸æ¥å—æ–°çš„ trafficï¼Œåˆ›å»ºæ–°çš„æ›¿ä»£ workloadï¼Œç„¶å gracefully å…³é—­è¿™ä¸ª workloadï¼‰</li>
<li>â€œæ§åˆ¶é¢ç½‘ç»œæ•…éšœâ€å‘Šè­¦æƒ…å†µä¸‹ï¼Œè¿™æ—¶å€™å¾€å¾€æ— æ³•æˆåŠŸè¿›è¡Œä¸»æœºçš„è½¦é‡Œã€è¿ç§»ï¼Œæ•…å¯ä»¥è€ƒè™‘è§¦å‘å¤‡ä»½ä¸»æœºã€å¯åŠ¨æ–° workloadã€å…³æœº</li>
<li>å…¶ä»–â€œï¼ˆäºšå¥åº·ï¼‰çŠ¶æ€â€ï¼Œå¯ä»¥ä½œä¸ºè´Ÿè½½å±‚é¢å‡ºé—®é¢˜çš„æ ¹å› åˆ†æï¼ˆRCAï¼‰ä¾æ®</li>
</ul>
<p>ä¸‹è¾¹ï¼Œæˆ‘ä»¬ç»™å‡ºä¸€ä¸ªåœ¨å›¾è°±ä¸Šè¿›è¡Œå‘Šè­¦ã€çŠ¶æ€ä¼ å¯¼çš„æŸ¥è¯¢ä¾‹å­ï¼Œæˆ‘ä»¬å‡è®¾ vid ä¸º <code>node0</code> çš„å®¿ä¸»æœºå‡ºç°äº†é«˜ CPU çš„å‘Šè­¦ï¼Œåˆ™è¿™ä¸ªæŸ¥è¯¢å¯ä»¥å¾—åˆ°æ‰€æœ‰å…¶ä¸Šçš„è™šæœºï¼Œè·å¾—æ—¶é—´ã€å‘Šè­¦é€šçŸ¥åˆ—è¡¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">vm</span><span class="p">:</span><span class="n">nova_instance</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="o">`</span><span class="n">contains</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">host_CPU_high</span><span class="p">:</span><span class="n">nova_host</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">host_CPU_high</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;node0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">vm</span><span class="p">.</span><span class="n">nova_instance</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">VM_to_raise_CPU_alarms</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™å…¶ä¸­æŸ¥è¯¢çš„å›¾æ¨¡å¼æ˜¯ä» <code>host_CPU_high</code> è¿™ä¸ª <code>nova_host</code> å‘å¤–ç»ç”± <code>contains</code> è¿™ä¸ªå…³ç³»æŒ‡å‘ <code>vm</code> è¿™ä¸ª <code>nova_instance</code> çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="p">(</span><span class="n">vm</span><span class="p">:</span><span class="n">nova_instance</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="o">`</span><span class="n">contains</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">host_CPU_high</span><span class="p">:</span><span class="n">nova_host</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒçš„ç»“æœæ˜¯ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">VM_to_raise_CPU_alarms</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">server-4</td>
</tr>
<tr>
<td style="text-align:left">server-3</td>
</tr>
<tr>
<td style="text-align:left">server-1</td>
</tr>
<tr>
<td style="text-align:left">server-0</td>
</tr>
</tbody>
</table>
<p>å¦‚æœæˆ‘ä»¬æŠŠæŸ¥è¯¢æ”¹åŠ¨ä¸€ä¸‹ï¼Œé€‰æ‹©è¾“å‡ºå…¨è·¯å¾„ï¼Œåˆ™å¯ä»¥çœ‹åˆ°è¿™ä¸ªä¿¡æ¯ä¼ å¯¼çš„æ–¹å‘ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">vm</span><span class="p">:</span><span class="n">nova_instance</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="o">`</span><span class="n">contains</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">host_CPU_high</span><span class="p">:</span><span class="n">nova_host</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">host_CPU_high</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;node0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ Explorer ä¸­æ¸²æŸ“ï¼Œç‚¹å‡» N è·³æ£€æµ‹ï¼š</p>
<video width="800" controls>
  <source src="https://user-images.githubusercontent.com/1651790/212291702-1754c9ce-f23f-4a68-930c-07a587c113be.mov" type="video/mp4"> 
</video>
<p>ç¬¬ä¸€ä¸ªä¾‹å­æ¯”è¾ƒç®€å•ï¼Œç”šè‡³ä¸æ˜¯å¾ˆæœ‰å¿…è¦ç”¨å›¾çš„èƒ½åŠ›ï¼ˆè¿™ç§å› ä¸ºä¸€è·³æŸ¥è¯¢è¡¨ç»“æ„ä¸­ä¹Ÿæ˜¯å¾ˆè½»æ¾åœ°ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸¤ä¸ª nova API call å°±å¯ä»¥æå®šç­‰ä»·çš„ä¿¡æ¯è·å–äº†ï¼‰ï¼Œè¿™é‡Œåªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå®é™…ä¸Šæˆ‘ä»¬åœ¨å›¾ä¸Šå¯ä»¥åšå¾ˆå¤šæ›´ Graphyï¼ˆå…·æœ‰å›¾å±æ€§çš„ï¼‰ã€å¤æ‚ã€ç‹¬ç‰¹çš„å·¥ä½œï¼Œæˆ‘ä»¬æ…¢æ…¢æ¥çœ‹ã€‚</p>
<h3 id="ç½‘ç»œå¯è¾¾æ£€æµ‹" class="headerLink">
    <a href="#%e7%bd%91%e7%bb%9c%e5%8f%af%e8%be%be%e6%a3%80%e6%b5%8b" class="header-mark"></a>4.2 ç½‘ç»œå¯è¾¾æ£€æµ‹</h3><p>æˆ‘ä»¬æ¥è€ƒè™‘è¿™æ ·çš„åœºæ™¯ï¼Œåœ¨ OpenStack ä¸­ï¼Œä¸åŒçš„ä¸»æœºå¯ä»¥è¿æ¥åˆ°ç›¸åŒçš„å­ç½‘ï¼ˆVPCï¼‰ï¼Œä¸»æœºä¹Ÿå¯ä»¥è¿æ¥åˆ°å¤šä¸ªå­ç½‘ä¹‹ä¸­ï¼Œè¿™æ ·ï¼Œä¸»æœºä¹‹é—´çš„ç½‘ç»œè¿é€šæ€§ä¿¡æ¯ã€ä¸ç½‘ç»œè”é€šç›¸å…³çš„æ¨ç†ã€ä¼ å¯¼éƒ½å¯ä»¥åœ¨å›¾ä¸Šè¿›è¡Œã€‚</p>
<blockquote>
<p>æ³¨ï¼šåœ¨çœŸå®ä¸–ç•Œä¸­ï¼Œè¿™é‡Œå¯èƒ½è¿˜è¦è€ƒè™‘ Security Groupã€Routerã€Switch ç­‰å› ç´ ï¼Œæœ¬åˆ©ä¸­æˆ‘ä»¬ç”¨åˆ°çš„ OpenStack æ˜¯ L2 only çš„ Setupï¼Œæ¯”è¾ƒç®€åŒ–ã€‚</p>
</blockquote>
<p>è·å¾—ä¸è™šæœº <code>server_a</code> åŒä¸€ VPC çš„æ‰€æœ‰å…¶ä»–è™šæœºçœ‹èµ·æ¥å¾ˆå®¹æ˜“è¡¨è¾¾äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">server_a</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_network</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">--</span><span class="p">(</span><span class="n">server_b</span><span class="p">:</span><span class="o">`</span><span class="n">nova_instance</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">server_a</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;server-0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">server_b</span><span class="p">.</span><span class="n">nova_instance</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">L2_connected_server</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">L2_connected_server</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">server-1</td>
</tr>
</tbody>
</table>
<p>çœ‹èµ·æ¥å¾ˆåˆçº§å‘€ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æŸ¥è¯¢ä¸è™šæœº <code>server_a</code> åŒä¸€ VPCã€æˆ–è€…æœ‰å¯èƒ½é€šè¿‡è·¨ç½‘ç»œè™šæœºè€Œäº’è”çš„ä¸»æœºçš„æ‰€æœ‰å…¶ä»–è™šæœºï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬é™¤äº†å…±äº« neutron network(VPC) çš„æƒ…å†µï¼Œè¿˜è¦æŸ¥è¯¢æ‰€æœ‰äºŒå±‚ç›´è¿çš„è™šæœºå¯èƒ½é€šè¿‡å…¶ä»– VPC è¿å‡ºå»çš„çš„è™šæœºï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬ç”¨åˆ°äº† <code>OPTIONAL MATCH</code> çš„è¡¨è¾¾ï¼Œè¡¨ç¤ºå¯èƒ½åŒ¹é…åˆ°çš„æ¨¡å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">server_a</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">--</span><span class="p">(</span><span class="n">net</span><span class="p">:</span><span class="n">neutron_network</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">--</span><span class="p">(</span><span class="n">server_b</span><span class="p">:</span><span class="o">`</span><span class="n">nova_instance</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">server_a</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;server-0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">server_b</span><span class="p">)</span><span class="o">--</span><span class="p">()</span><span class="o">--</span><span class="p">(</span><span class="n">other_net</span><span class="p">:</span><span class="n">neutron_network</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">--</span><span class="p">(</span><span class="n">server_c</span><span class="p">:</span><span class="o">`</span><span class="n">nova_instance</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WITH</span><span class="w"> </span><span class="n">server_a</span><span class="p">,</span><span class="w"> </span><span class="n">server_b</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">same_subnet_machines</span><span class="p">,</span><span class="w"> </span><span class="n">server_c</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">routeable_machines</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">routeable_machines</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">server_a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">same_subnet_machines</span><span class="p">.</span><span class="n">nova_instance</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">L2_connected_server</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">routeable_machines</span><span class="p">.</span><span class="n">nova_instance</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cross_vpc_server</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ç»“æœé‡Œï¼Œè·¨ç½‘ç»œæ½œåœ¨çš„ç›¸è¿ä¸»æœºè¿˜æœ‰ server-3ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">L2_connected_server</th>
<th style="text-align:left">cross_vpc_server</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">server-1</td>
<td style="text-align:left">server-3</td>
</tr>
</tbody>
</table>
<p>æˆ‘ä»¬å°†å…¶å¯è§†åŒ–ï¼ŒåŒæ ·ï¼Œä¿®æ”¹è¾“å‡ºä¸ºè·¯å¾„ <code>p</code> å’Œ <code>p1</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">server_a</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">--</span><span class="p">(</span><span class="n">net</span><span class="p">:</span><span class="n">neutron_network</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">--</span><span class="p">(</span><span class="n">server_b</span><span class="p">:</span><span class="o">`</span><span class="n">nova_instance</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">server_a</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;server-0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="n">p1</span><span class="o">=</span><span class="p">(</span><span class="n">server_b</span><span class="p">)</span><span class="o">--</span><span class="p">()</span><span class="o">--</span><span class="p">(</span><span class="n">other_net</span><span class="p">:</span><span class="n">neutron_network</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">--</span><span class="p">(</span><span class="n">server_c</span><span class="p">:</span><span class="o">`</span><span class="n">nova_instance</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒå¯èƒ½çš„è¿æ¥è·¯å¾„ä¸€ç›®äº†ç„¶</p>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/cross_vpc_vm.webp" title="cross_vpc_vm" data-thumbnail="/graph-enabled-infra-ops/cross_vpc_vm.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/cross_vpc_vm.webp"
            srcset="/graph-enabled-infra-ops/cross_vpc_vm.webp, /graph-enabled-infra-ops/cross_vpc_vm.webp 1.5x, /graph-enabled-infra-ops/cross_vpc_vm.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/cross_vpc_vm.webp">
    </a></figure></p>
<p>æœ‰äº†è·å¾—è¿™äº›ä¿¡æ¯çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥å¯ç¼–ç¨‹åœ°è¿æ¥å‘Šè­¦ã€çŠ¶æ€ã€å®‰å…¨é£æ§ã€ç½‘ç»œç­‰æ–¹æ–¹é¢é¢ç³»ç»Ÿäº†ï¼Œå› ä¸ºè¿™ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œè¿™é‡Œå°±ä¸åŠ ä»¥èµ˜è¿°äº†ï¼Œæ¬¢è¿å¤§å®¶æ¥ NebulaGraph ç¤¾åŒºåˆ†äº«ä½ ä»¬çš„å›¾æ´å¯Ÿä½¿ç”¨æ–¹å¼ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å­˜å‚¨ç›¸å…³çš„ä¾‹å­ã€‚</p>
<h3 id="é•œåƒäº‘ç›˜å¿«ç…§çš„è¡€ç¼˜" class="headerLink">
    <a href="#%e9%95%9c%e5%83%8f%e4%ba%91%e7%9b%98%e5%bf%ab%e7%85%a7%e7%9a%84%e8%a1%80%e7%bc%98" class="header-mark"></a>4.3 é•œåƒã€äº‘ç›˜ã€å¿«ç…§çš„è¡€ç¼˜</h3><p>åœ¨åŸºç¡€è®¾æ–½ä¸­ï¼Œäº‘ç›˜ï¼ˆiSCSIã€Cephã€NFSï¼‰ã€é•œåƒã€å¿«ç…§ä¹‹é—´æœ‰å¤šé‡å¤æ‚çš„å…³ç³»ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>ä¸€ä¸ªç³»ç»Ÿé•œåƒå¯èƒ½ä»æŸä¸€ä¸ªè™šæ‹ŸæœºæŒ‚è½½çš„äº‘ç›˜æˆ–è€…ä¸€ä¸ªå¿«ç…§åˆ›å»º</li>
<li>ä¸€ä¸ªäº‘ç›˜å¯èƒ½æ˜¯ä»ä¸€ä¸ªç³»ç»Ÿé•œåƒã€ä¸€ä¸ªå¿«ç…§æˆ–è€…å¦ä¸€ä¸ªäº‘ç›˜åˆ›å»º</li>
<li>ä¸€ä¸ªå¿«ç…§æ˜¯ä»ä¸€ä¸ªäº‘ç›˜åˆ›å»ºçš„</li>
</ul>
<p>è¿™ç§è¡€ç¼˜ä¿¡æ¯çš„è¯†åˆ«å’Œç®¡ç†æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ä¸‹è¾¹çš„æŸ¥è¯¢å¯ä»¥è·å¾—ç»™å®šçš„è™šæœº <code>server-0</code> çš„æ‰€æœ‰å­˜å‚¨è¡€ç¼˜ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">server_a</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">attached</span><span class="o">`|</span><span class="n">created_from</span><span class="o">|</span><span class="n">used_by</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">step1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">server_a</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;server-0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="n">p1</span><span class="o">=</span><span class="p">(</span><span class="n">step1</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">created_from</span><span class="o">*</span><span class="mi">1</span><span class="p">..</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">step2</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»“æœä¸­ï¼š</p>
<ul>
<li><code>server-0</code> çš„å¯åŠ¨é•œåƒï¼ˆè¿™é‡Œå®ƒæ˜¯ä»æœ¬åœ°ç›˜å¯åŠ¨çš„ï¼Œæ²¡æœ‰æŒ‚è½½äº‘ç›˜ï¼‰æ˜¯ä» <code>volume-1</code> åˆ›å»ºçš„</li>
<li><code>volume-1</code> æ˜¯ä» <code>cirros-0.5.2-x86_64-disk</code> è¿™ä¸ªé•œåƒåˆ›å»ºçš„</li>
<li>æ­¤å¤–ï¼Œè¿˜æœ‰å…¶ä»–æœ‰åˆ†å‰å…³ç³»çš„å­˜å‚¨èµ„æºå’Œä»–ä»¬ä¹Ÿæ¯æ¯ç›¸å…³</li>
</ul>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/storage_lineage_0.webp" title="storage_lineage_0" data-thumbnail="/graph-enabled-infra-ops/storage_lineage_0.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/storage_lineage_0.webp"
            srcset="/graph-enabled-infra-ops/storage_lineage_0.webp, /graph-enabled-infra-ops/storage_lineage_0.webp 1.5x, /graph-enabled-infra-ops/storage_lineage_0.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/storage_lineage_0.webp">
    </a></figure></p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸åªè€ƒè™‘å­˜å‚¨èµ„æºï¼Œå†çœ‹çœ‹æ¶‰åŠäº‘ç›˜ï¼ˆcinder_volumeï¼‰æŒ‚è½½ï¼ˆattachedï¼‰è¿™å±‚å…³ç³»ä¸‹çš„è¡€ç¼˜å…³ç³»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">server_a</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">attached</span><span class="o">`|</span><span class="n">created_from</span><span class="o">|</span><span class="n">used_by</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">step1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">server_a</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;server-4&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="n">p1</span><span class="o">=</span><span class="p">(</span><span class="n">step1</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">created_from</span><span class="o">|</span><span class="n">attached</span><span class="o">*</span><span class="mi">1</span><span class="p">..</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">step2</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ¸²æŸ“å›¾ä¸­è¯»å‡ºè¿™æ ·çš„æ´å¯Ÿï¼š</p>
<ul>
<li><code>server-4</code> çš„å¯åŠ¨é•œåƒï¼ˆè¿™é‡Œå®ƒæ˜¯ä»æœ¬åœ°ç›˜å¯åŠ¨çš„ï¼‰æ˜¯ä» <code>volume-1</code> åˆ›å»ºçš„
<ul>
<li>è€Œ <code>volume-1</code> ç°åœ¨æŒ‚è½½åœ¨ <code>server-6</code> ä¸Š</li>
<li><code>volume-1</code> æ˜¯ä» <code>cirros-0.5.2-x86_64-disk</code> è¿™ä¸ªé•œåƒåˆ›å»ºçš„</li>
<li>åŒæ · <code>cirros-0.5.2-x86_64-disk</code> é•œåƒè¢«å¾ˆå¤šå…¶ä»–è™šæœºåœ¨é‡‡ç”¨</li>
</ul>
</li>
<li><code>server-4</code> åŒæ—¶æŒ‚è½½äº†æ•°æ®ç›˜ <code>volume-2</code>
<ul>
<li>è€Œ <code>volume-2</code> æ˜¯ä¸€ä¸ªå¤šæŒ‚è½½çš„ç›˜ï¼Œå®ƒåŒæ—¶æŒ‚è½½åœ¨ <code>server-3</code> ä¹‹ä¸Š</li>
<li><code>server-3</code> çš„ç³»ç»Ÿå¯åŠ¨ç›˜æ˜¯ä»å¿«ç…§ <code>snapshot-202301111800-volume-1</code> å…‹éš†åˆ›å»ºçš„</li>
<li>å¿«ç…§ <code>snapshot-202301111800-volume-1</code> æ˜¯æ›¾ç»ä» <code>volume-1</code> åˆ›å»ºçš„</li>
<li><code>volume-1</code> ç°åœ¨æŒ‚è½½åœ¨ <code>server-6</code> ä¸Š
<ul>
<li>å¿«ç…§ä¸ä¸€å®šæ˜¯ä» <code>server-6</code> è€Œæ¥ï¼Œå› ä¸ºé•œåƒå¯èƒ½è¢«é‡æ–°æŒ‚è½½è¿‡</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/storage_lineage_1.webp" title="storage_lineage_1" data-thumbnail="/graph-enabled-infra-ops/storage_lineage_1.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/storage_lineage_1.webp"
            srcset="/graph-enabled-infra-ops/storage_lineage_1.webp, /graph-enabled-infra-ops/storage_lineage_1.webp 1.5x, /graph-enabled-infra-ops/storage_lineage_1.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/storage_lineage_1.webp">
    </a></figure></p>
<p>è€Œè¿™äº›è¡€ç¼˜ä¿¡æ¯å¯ä»¥è¢«ç”¨åœ¨èµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†ã€æ ¹å› åˆ†æã€å®‰å…¨å‘Šè­¦ã€çŠ¶æ€ä¼ å¯¼ä¸Šï¼Œè¿™é‡Œä¸åŠ ä»¥èµ˜è¿°ã€‚</p>
<h3 id="é«˜ç›¸å…³æ€§è™šæœºé¢„è­¦" class="headerLink">
    <a href="#%e9%ab%98%e7%9b%b8%e5%85%b3%e6%80%a7%e8%99%9a%e6%9c%ba%e9%a2%84%e8%ad%a6" class="header-mark"></a>4.4 é«˜ç›¸å…³æ€§è™šæœºé¢„è­¦</h3><p>ä¸‹é¢å†ç»™ä¸€ä¸ªèŠ‚ç‚¹ç›¸ä¼¼åº¦çš„åº”ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¨å›¾æˆ–è€…å­å›¾ä¸Šï¼Œåˆ©ç”¨å›¾ç®—æ³•æ‰¾åˆ°ä¸ä¸€ä¸ªè™šæœºåœ¨å›¾ä¸Šå…³ç³»çš„ç»´åº¦ä¸Šæœ€ç›¸ä¼¼çš„å…¶ä»–è™šæœºï¼ŒåŸºäºåœ¨è¿™ç§ç›¸å…³æ€§å¢åŠ æ–°çš„å…³ç³»ï¼Œå¹¶åœ¨å…³ç³»ä¸Šåšé£é™©äº‹ä»¶é¢„è­¦ã€‚</p>
<p>è¿™æ¬¡çš„å›¾ç®—æ³•åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸€ä¸ªå…¸å‹çš„ä»[å¿«é€Ÿå­å›¾éªŒè¯]åˆ°[å…¨å›¾ç”Ÿäº§åº”ç”¨çš„]å·¥ä½œæµã€‚</p>
<h4 id="åœ¨å­å›¾ä¸Šå¿«é€ŸéªŒè¯æµè§ˆå™¨å†…ç®—æ³•" class="headerLink">
    <a href="#%e5%9c%a8%e5%ad%90%e5%9b%be%e4%b8%8a%e5%bf%ab%e9%80%9f%e9%aa%8c%e8%af%81%e6%b5%8f%e8%a7%88%e5%99%a8%e5%86%85%e7%ae%97%e6%b3%95" class="header-mark"></a>4.4.1 åœ¨å­å›¾ä¸Šå¿«é€ŸéªŒè¯ï¼šæµè§ˆå™¨å†…ç®—æ³•</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¯•ç€ä» <code>server-0</code> çš„ä¸‰åº¦å­å›¾ä¸Šåšç®—æ³•çš„éªŒè¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">GET SUBGRAPH 3 STEPS FROM &#34;server-0&#34;
</span></span><span class="line"><span class="cl">YIELD VERTICES AS nodes, EDGES AS relationships;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°†ç»“æœæ¸²æŸ“åœ¨ç”»å¸ƒä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å­å›¾ä¸­åŒ…å«äº†å…¶ä»–å‡ ä¸ªè™šæœºï¼š</p>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/server_subgraph.webp" title="server_subgraph" data-thumbnail="/graph-enabled-infra-ops/server_subgraph.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/server_subgraph.webp"
            srcset="/graph-enabled-infra-ops/server_subgraph.webp, /graph-enabled-infra-ops/server_subgraph.webp 1.5x, /graph-enabled-infra-ops/server_subgraph.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/server_subgraph.webp">
    </a></figure></p>
<p>ç„¶åï¼Œæˆ‘ä»¬åˆ©ç”¨ explorer ä¸­çš„æµè§ˆå™¨å†…å›¾ç®—æ³•ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°éªŒè¯æˆ‘ä»¬çš„æƒ³æ³•ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ Jaccard SImilarity ç›¸ä¼¼æ€§ç®—æ³•ï¼Œè¿›è¡Œ <code>server-0</code> ä¸ <code>server-1,server-3,server-4,server-6</code> è¿­ä»£åˆ†åˆ«å¾—åˆ°ç›¸ä¼¼æ€§ï¼š</p>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/jacc_sim_browser.webp" title="jacc_sim_browser" data-thumbnail="/graph-enabled-infra-ops/jacc_sim_browser.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/jacc_sim_browser.webp"
            srcset="/graph-enabled-infra-ops/jacc_sim_browser.webp, /graph-enabled-infra-ops/jacc_sim_browser.webp 1.5x, /graph-enabled-infra-ops/jacc_sim_browser.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/jacc_sim_browser.webp">
    </a></figure></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œåœ¨ 3 æ­¥å­å›¾å†…ï¼Œå’Œ <code>server-0</code> æœ€è¿‘æ¥çš„è™šæœºæ˜¯ <code>server-4</code>ã€‚è¿›ä¸€æ­¥æˆ‘ä»¬å¯ä»¥ç®€å•åœ¨å­å›¾ä¸Šçœ‹çœ‹ä¸¤è€…ä¹‹é—´çš„è·¯å¾„ä½œä¸ºç›¸ä¼¼æ€§çš„è§£é‡Šï¼š</p>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/sim_explain.webp" title="sim_explain" data-thumbnail="/graph-enabled-infra-ops/sim_explain.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/sim_explain.webp"
            srcset="/graph-enabled-infra-ops/sim_explain.webp, /graph-enabled-infra-ops/sim_explain.webp 1.5x, /graph-enabled-infra-ops/sim_explain.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/sim_explain.webp">
    </a></figure></p>
<p>åœ¨è¿™ä¸ªå¯è§£é‡Šç»“æœä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ <code>server-0</code> ä¸ <code>server-4</code> ç›¸ä¼¼çš„åŸå› å¯èƒ½æ˜¯ï¼š</p>
<ul>
<li>åè½åœ¨åŒä¸€ä¸ªå®¿ä¸»æœºï¼šnode-0</li>
<li>ä½¿ç”¨åŒä¸€ä¸ªé•œåƒï¼šcirros_mod_from_volume-1</li>
</ul>
<p>å¦‚æ­¤ï¼Œæˆ‘ä»¬æœ€ç»ˆè½åœ°çš„é¢„è­¦æœºåˆ¶å¯èƒ½æ˜¯ï¼Œå½“ <code>server-0</code> å‡ºç°æŸä¸€é—®é¢˜ã€å‘Šè­¦æ—¶å€™ï¼Œç»™ç›¸ä¼¼çš„ server-4 ä¹Ÿè®¾å®šé¢„è­¦ï¼Œé¢„è­¦ç†ç”±å°±æ˜¯å®ƒä»¬åœ¨åŒæ ·ä¸»æœºã€åŒæ ·é•œåƒã€‚</p>
<h4 id="è½åœ°ç®—æ³•ä¸ºåº”ç”¨workflowanalytics" class="headerLink">
    <a href="#%e8%90%bd%e5%9c%b0%e7%ae%97%e6%b3%95%e4%b8%ba%e5%ba%94%e7%94%a8workflowanalytics" class="header-mark"></a>4.4.2 è½åœ°ç®—æ³•ä¸ºåº”ç”¨ï¼šWorkflow+Analytics</h4><p>æœ‰äº†å‰è¾¹çš„å¿«é€Ÿå®éªŒï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© workflow + NebulaGraph Analytics æŠŠå®ƒè½åœ°ä¸ºå…¨å›¾ä¸Šçš„ç®—æ³•ï¼Œåˆ©ç”¨ Analytics åˆ†å¸ƒå¼èƒ½åŠ›å»æ‰§è¡Œã€‚</p>
<p>åœ¨ç”Ÿäº§ä¸Šï¼Œæˆ‘ä»¬åˆ©ç”¨ Workflow çš„ DAG ç¼–æ’èƒ½åŠ›åˆ›å»ºä¸¤ä¸ªå‰åç›¸è¿çš„ä»»åŠ¡ï¼š</p>
<ul>
<li>å–ä¸´è¿‘è™šæœº</li>
<li>å…¨å›¾ç®—ç›¸ä¼¼åº¦</li>
</ul>
<p>ç¬¬ä¸€ä¸ªä»»åŠ¡å¦‚ä¸‹ï¼Œå®ƒå®æ—¶ä»ç»™å®šçš„è™šæœºï¼ˆè¿™é‡Œå†™æ­»äº† server-0ï¼Œä½†æ˜¯ workflow å¯ä»¥æŠŠè¿™é‡Œä½œä¸ºå‚æ•°åŒ–ï¼Œå¹¶å°è£…ä»»åŠ¡ä¸ºå¯ä»¥è¢« API è§¦å‘çš„å¼‚æ­¥æœåŠ¡ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="o">*</span><span class="mi">1</span><span class="p">..</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">nova_instance</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;server-0&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œ Query job æˆ‘ä»¬è¾“å‡ºå¾…æ¯”è¾ƒçš„å…¶ä»–è™šæœºçš„ vidã€‚</p>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/query_sim_server.webp" title="query_sim_server" data-thumbnail="/graph-enabled-infra-ops/query_sim_server.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/query_sim_server.webp"
            srcset="/graph-enabled-infra-ops/query_sim_server.webp, /graph-enabled-infra-ops/query_sim_server.webp 1.5x, /graph-enabled-infra-ops/query_sim_server.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/query_sim_server.webp">
    </a></figure></p>
<p>æ¥ç€ï¼ŒJaccardSImilarity job ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹© ids1 ä¸º server-0ï¼ˆè¿™é‡Œå¦‚ä¸Šï¼Œä¸Šçº¿æ—¶æ˜¯å‚æ•°åŒ–çš„ï¼‰ï¼Œids2 ä»ä¸Šæ¸¸å–ï¼ˆå‰è¾¹çš„ Query jobï¼‰ï¼Œé€‰æ‹©åœ¨ openstack å…¨å›¾æ‰«ææ‰€æœ‰ç±»å‹çš„è¾¹ã€‚<figure><a class="lightgallery" href="/graph-enabled-infra-ops/jacc_sim_workflow.webp" title="jacc_sim_workflow" data-thumbnail="/graph-enabled-infra-ops/jacc_sim_workflow.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/jacc_sim_workflow.webp"
            srcset="/graph-enabled-infra-ops/jacc_sim_workflow.webp, /graph-enabled-infra-ops/jacc_sim_workflow.webp 1.5x, /graph-enabled-infra-ops/jacc_sim_workflow.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/jacc_sim_workflow.webp">
    </a></figure></p>
<p>ä¿å­˜ã€è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç»“æœå¦‚ä¸‹ï¼ŒåŒºåˆ«æ˜¯è¿™æ¬¡å®ƒè¿ç®—äº†æ›´å¤šçš„ç›®æ ‡è™šæœºï¼Œå¹¶ä¸”è¿­ä»£ä½œç”¨èŒƒå›´æ˜¯å…¨å›¾è€Œéä¸€ä¸ªå­å›¾ï¼Œå¯ä»¥çœ‹åˆ°ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œè¿™æ˜¯å› ä¸ºå­å›¾ä¸Šå…³è”åº¦å¤§çš„ç‚¹å’Œç›¸è¿‘çš„è¾¹åœ¨ Jaccard ç®—æ³•é‡Œèµ·åˆ°äº†æ›´ä¸»è¦çš„ä½œç”¨ã€‚</p>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/jacc_result.webp" title="jacc_result" data-thumbnail="/graph-enabled-infra-ops/jacc_result.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/jacc_result.webp"
            srcset="/graph-enabled-infra-ops/jacc_result.webp, /graph-enabled-infra-ops/jacc_result.webp 1.5x, /graph-enabled-infra-ops/jacc_result.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/jacc_result.webp">
    </a></figure></p>
<h3 id="å®‰å…¨ç›¸å…³åœºæ™¯" class="headerLink">
    <a href="#%e5%ae%89%e5%85%a8%e7%9b%b8%e5%85%b3%e5%9c%ba%e6%99%af" class="header-mark"></a>4.5 å®‰å…¨ç›¸å…³åœºæ™¯</h3><p>åŸºç¡€è®¾æ–½èµ„æºä¸­çš„å…³è”å…³ç³»å’Œé‡‘èã€å†…å®¹ç³»ç»Ÿã€ç”µå•†é¢†åŸŸçš„é£æ§åœºæ™¯æœ‰ç›¸ä¼¼çš„åœ°æ–¹ï¼Œå¾ˆå¤šåœºæ™¯æœ¬è´¨ä¸Šåˆ©ç”¨åˆ°äº†å›¾è°±å…³ç³»ä¸­çš„çŸ¥è¯†ï¼Œåœ¨å›¾åº“ä¸Šå®æ—¶è·å–è¿™äº›å¤æ‚å¤šè·³å¤©ç„¶å¸¦æœ‰å¯è§£é‡Šæ€§çš„å®‰å…¨æ´å¯Ÿéå¸¸é€‚åˆã€‚</p>
<h4 id="ç§˜é’¥æ³„æ¼é£æ§åˆ†æ" class="headerLink">
    <a href="#%e7%a7%98%e9%92%a5%e6%b3%84%e6%bc%8f%e9%a3%8e%e6%8e%a7%e5%88%86%e6%9e%90" class="header-mark"></a>4.5.1 ç§˜é’¥æ³„æ¼é£æ§åˆ†æ</h4><p>å…ˆçœ‹ä¸€ä¸ªç§˜é’¥æ³„æ¼çš„åœºæ™¯ï¼šå‡è®¾ <code>key-0</code> è¢«å®‰å…¨éƒ¨é—¨ç¡®å®šè¢«æ³„æ¼äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯«ç§’æ—¶é—´å†…è·å¾—å¦‚ä¸‹æŸ¥è¯¢ï¼š</p>
<ul>
<li>ç›´æ¥é‡‡ç”¨äº†å¯†é’¥çš„è™šæœº</li>
<li>ä¸é‡‡ç”¨ç§˜é’¥çš„è™šæœºç½‘ç»œç›´è¿çš„æœºå™¨</li>
<li>ä¸é‡‡ç”¨ç§˜é’¥çš„è™šæœºè·¨ç½‘ç»œç›¸è¿çš„æœºå™¨</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">key_leaked</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">used_by</span><span class="o">`</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">involved_server</span><span class="p">:</span><span class="n">nova_instance</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">--</span><span class="p">(</span><span class="n">net</span><span class="p">:</span><span class="n">neutron_network</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">--</span><span class="p">(</span><span class="n">server_b</span><span class="p">:</span><span class="n">nova_instance</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">key_leaked</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;key-0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">server_b</span><span class="p">)</span><span class="o">--</span><span class="p">()</span><span class="o">--</span><span class="p">(</span><span class="n">other_net</span><span class="p">:</span><span class="n">neutron_network</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">--</span><span class="p">(</span><span class="n">server_c</span><span class="p">:</span><span class="n">nova_instance</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WITH</span><span class="w"> </span><span class="n">involved_server</span><span class="p">,</span><span class="w"> </span><span class="n">server_b</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">same_subnet_machines</span><span class="p">,</span><span class="w"> </span><span class="n">server_c</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cross_net_machines</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">cross_net_machines</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">involved_server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">involved_server</span><span class="p">.</span><span class="n">nova_instance</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">with_key</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">same_subnet_machines</span><span class="p">.</span><span class="n">nova_instance</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">l2_vms</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">cross_net_machines</span><span class="p">.</span><span class="n">nova_instance</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cross_vpc_vms</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è´´ä¸€ä¸‹éƒ¨åˆ†ç»“æœï¼Œæˆ‘ä»¬çŸ¥é“ server-4 é‡‡ç”¨äº†è¿™ä¸ª keypairï¼Œå¹¶ä¸” server-6 å’Œå®ƒåœ¨åŒä¸€ä¸ªç½‘ç»œï¼ŒåŒæ—¶ï¼Œæœ‰ä¸€å®šå¯èƒ½ï¼Œé€šè¿‡ server-6ï¼Œserver-1,2,0,5 ä¹Ÿå—åˆ°äº†å¨èƒã€å½±å“ï¼Œç›¸å…³çš„æœºå™¨å¯ä»¥è¢«è§¦å‘ä¸åŒçº§åˆ«çš„å‘Šè­¦æ¥é™ä½å®‰å…¨äº‹æ•…çš„å½±å“ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">with_key</th>
<th style="text-align:left">l2_vms</th>
<th style="text-align:left">cross_vpc_vms</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">server-4</td>
<td style="text-align:left">server-6</td>
<td style="text-align:left">server-1</td>
</tr>
<tr>
<td style="text-align:left">server-4</td>
<td style="text-align:left">server-6</td>
<td style="text-align:left">server-2</td>
</tr>
<tr>
<td style="text-align:left">server-4</td>
<td style="text-align:left">server-6</td>
<td style="text-align:left">server-0</td>
</tr>
<tr>
<td style="text-align:left">server-4</td>
<td style="text-align:left">server-6</td>
<td style="text-align:left">server-5</td>
</tr>
</tbody>
</table>
<p>è¿™ä¸ªæŸ¥è¯¢æ”¹é€ ä¸ºå¯è§†åŒ–ç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">key_leaked</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">used_by</span><span class="o">`</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">involved_server</span><span class="p">:</span><span class="n">nova_instance</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">--</span><span class="p">(</span><span class="n">net</span><span class="p">:</span><span class="n">neutron_network</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">--</span><span class="p">(</span><span class="n">server_b</span><span class="p">:</span><span class="n">nova_instance</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">key_leaked</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;key-0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="n">p1</span><span class="o">=</span><span class="p">(</span><span class="n">server_b</span><span class="p">)</span><span class="o">--</span><span class="p">()</span><span class="o">--</span><span class="p">(</span><span class="n">other_net</span><span class="p">:</span><span class="n">neutron_network</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">--</span><span class="p">(</span><span class="n">server_c</span><span class="p">:</span><span class="n">nova_instance</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="n">p1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ explorer é‡Œ åº”ç”¨ Dagre-LR çš„å¸ƒå±€ï¼Œä¸€å…³è”å…³ç³»å¾ˆæ¸…æ™°çš„è¢«å±•ç¤ºå‡ºæ¥ï¼Œä¹Ÿè®¸å¯ä»¥è€ƒè™‘æŠŠå®ƒå¼•ç”¨åœ¨å®‰å…¨äº‹æ•…çš„æŠ¥å‘Šåˆ†å‘ç»™è™šæœºç§Ÿæˆ·ã€‚</p>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/key_leaked.webp" title="key_leaked" data-thumbnail="/graph-enabled-infra-ops/key_leaked.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/key_leaked.webp"
            srcset="/graph-enabled-infra-ops/key_leaked.webp, /graph-enabled-infra-ops/key_leaked.webp 1.5x, /graph-enabled-infra-ops/key_leaked.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/key_leaked.webp">
    </a></figure></p>
<h4 id="é•œåƒäº‘ç›˜æ¼æ´èŒƒå›´åˆ†æ" class="headerLink">
    <a href="#%e9%95%9c%e5%83%8f%e4%ba%91%e7%9b%98%e6%bc%8f%e6%b4%9e%e8%8c%83%e5%9b%b4%e5%88%86%e6%9e%90" class="header-mark"></a>4.5.2 é•œåƒã€äº‘ç›˜æ¼æ´èŒƒå›´åˆ†æ</h4><p>ç±»ä¼¼çš„ï¼Œä¸€ä¸ªé•œåƒè¢«æ‰«å‡ºæ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥ç¬é—´æŸ¥åˆ°æ¶‰åŠåˆ°çš„èµ„æºï¼Œå¹¶åšå‡ºç›¸åº”</p>
<ul>
<li>é•œåƒæ–‡ä»¶æœ‰æ¼æ´</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">image_risky</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">created_from</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">step1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">image_risky</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;cirros-0.5.2-x86_64-disk&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="n">p1</span><span class="o">=</span><span class="p">(</span><span class="n">step1</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">created_from</span><span class="o">*</span><span class="mi">1</span><span class="p">..</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">step2</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/image_vulnerability.webp" title="image_vulnerability" data-thumbnail="/graph-enabled-infra-ops/image_vulnerability.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/image_vulnerability.webp"
            srcset="/graph-enabled-infra-ops/image_vulnerability.webp, /graph-enabled-infra-ops/image_vulnerability.webp 1.5x, /graph-enabled-infra-ops/image_vulnerability.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/image_vulnerability.webp">
    </a></figure></p>
<ul>
<li>ä¸€ä¸ªäº‘ç›˜æœ‰æ¼æ´</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">volume_risky</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">created_from</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">step1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">volume_risky</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;volume-1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="n">p1</span><span class="o">=</span><span class="p">(</span><span class="n">step1</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">created_from</span><span class="o">*</span><span class="mi">1</span><span class="p">..</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">step2</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/volume_vulnerability.webp" title="volume_vulnerability" data-thumbnail="/graph-enabled-infra-ops/volume_vulnerability.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/volume_vulnerability.webp"
            srcset="/graph-enabled-infra-ops/volume_vulnerability.webp, /graph-enabled-infra-ops/volume_vulnerability.webp 1.5x, /graph-enabled-infra-ops/volume_vulnerability.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/volume_vulnerability.webp">
    </a></figure></p>
<h4 id="æ½œåœ¨å®¿ä¸»æœºé€ƒç¦»å½±å“èŒƒå›´åˆ†æ" class="headerLink">
    <a href="#%e6%bd%9c%e5%9c%a8%e5%ae%bf%e4%b8%bb%e6%9c%ba%e9%80%83%e7%a6%bb%e5%bd%b1%e5%93%8d%e8%8c%83%e5%9b%b4%e5%88%86%e6%9e%90" class="header-mark"></a>4.5.3 æ½œåœ¨å®¿ä¸»æœºé€ƒç¦»å½±å“èŒƒå›´åˆ†æ</h4><p>æœ€åï¼Œæˆ‘ä»¬è®¨è®ºä¸€ä¸ªæ¯”è¾ƒä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼šå®¿ä¸»æœºé€ƒç¦»ã€‚</p>
<p>åœ¨æç«¯çš„æƒ…å†µä¸‹å¦‚æœåœ¨æˆ‘ä»¬å¾—åˆ°æ¶ˆæ¯ï¼Œ<code>server-0</code> å‘ç”Ÿäº†æœ‰å¯èƒ½å½±å“å®¿ä¸»æœºçš„å®‰å…¨æ—¶é—´çš„æ—¶å€™ï¼Œä»…ä»…å…³é—­è¿™ä¸ªå®¿ä¸»æœºæ˜¯ä¸å¤Ÿçš„ï¼Œå—å½±å“çš„èŒƒå›´å¯èƒ½å·²ç»æ‰©å¤§äº†ï¼Œç„¶è€Œï¼Œæˆ‘ä»¬ä¸å¯èƒ½å› ä¸ºè¿™æ ·å…³é—­æ•´ä¸ªæœºæˆ¿ï¼Œæ‰€ä»¥ï¼Œåˆ©ç”¨å›¾è°±è¾…åŠ©æ‰¾å‡ºå—å½±å“èŒƒå›´ä¼šæœ‰ä¸€äº›å¸®åŠ©ã€‚</p>
<p>ä¸‹é¢çš„æŸ¥è¯¢æ¨¡å¼æ˜¯ï¼š</p>
<ul>
<li>æ‰¾å‡ºå¯èƒ½è¢«å½±å“çš„å­ç½‘ï¼ˆVPCï¼‰ï¼Œæ ‡è®°æœ€é«˜çº§åˆ«é£é™©å­ç½‘ä¸ºåç»­å®šä½åšå‡†å¤‡</li>
<li>æ‰¾åˆ°å¯èƒ½è¢«æ§åˆ¶äº†çš„å®¿ä¸»æœº</li>
<li>ä»å®¿ä¸»æœºè§¦å‘ï¼Œæ‰¾å‡ºåŒä¸»æœºçš„å…¶ä»–è™šæœº</li>
<li>ä»å…¶ä»–è™šæœºè§¦å‘ï¼Œæ‰¾åˆ°å®ƒä»¬çš„å­ç½‘ï¼ˆVPCï¼‰</li>
<li>ä»å…¶ä»–è™šæœºè§¦å‘ï¼Œæ‰¾åˆ°å¯èƒ½å·²ç»è¢«å½±å“çš„ç½‘ç›˜ï¼ˆé˜²æ­¢è¢«æŒ‚è½½åˆ°å…¶ä»–æœºå™¨ï¼Œæ‰©å¤§å½±å“ï¼‰</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">server_escaping_hypervisor</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="o">`</span><span class="n">contains</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">hypervisor_compromised</span><span class="p">:</span><span class="n">nova_host</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">server_escaping_hypervisor</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;server-0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">server_escaping_hypervisor</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">attached</span><span class="p">]</span><span class="o">-</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">contains</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">impacted_subnet_high</span><span class="p">:</span><span class="n">neutron_network</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">hypervisor_compromised</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">contains</span><span class="o">`</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">server_same_host</span><span class="p">:</span><span class="n">nova_instance</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">server_same_host</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">attached</span><span class="p">]</span><span class="o">-</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">contains</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">impacted_subnet</span><span class="p">:</span><span class="n">neutron_network</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">server_same_host</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">attached</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">impacted_volume</span><span class="p">:</span><span class="n">cinder_volume</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">impacted_subnet_high</span><span class="p">.</span><span class="n">neutron_network</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">impacted_subnet_high</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">hypervisor_compromised</span><span class="p">.</span><span class="n">nova_host</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">hypervisor_compromised</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">impacted_subnet</span><span class="p">.</span><span class="n">neutron_network</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">impacted_subnet</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">[</span><span class="n">server_same_host</span><span class="p">.</span><span class="n">nova_instance</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">server_same_host</span><span class="p">.</span><span class="n">nova_instance</span><span class="p">.</span><span class="n">instance_name</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">server_same_host</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">impacted_volume</span><span class="p">.</span><span class="n">cinder_volume</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">impacted_volume</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœä¸­åˆ—å‡ºäº† server-0 è¢«æ§åˆ¶ä¹‹åï¼Œè€ƒè™‘å®¿ä¸»æœºé€ƒç¦»çš„æƒ…å†µä¸‹å¯èƒ½å—å½±å“çš„æ‰©æ•£èŒƒå›´ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">impacted_subnet_high</th>
<th style="text-align:left">hypervisor_compromised</th>
<th style="text-align:left">impacted_subnet</th>
<th style="text-align:left">server_same_host</th>
<th style="text-align:left">impacted_volume</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">shared</td>
<td style="text-align:left">node0</td>
<td style="text-align:left">shared</td>
<td style="text-align:left">[&ldquo;server-0&rdquo;, &ldquo;instance-00000001&rdquo;]</td>
<td style="text-align:left"><strong>Empty</strong></td>
</tr>
<tr>
<td style="text-align:left">shared</td>
<td style="text-align:left">node0</td>
<td style="text-align:left">shared</td>
<td style="text-align:left">[&ldquo;server-1&rdquo;, &ldquo;instance-00000002&rdquo;]</td>
<td style="text-align:left">ffaeb199-47f4-4d95-89b2-97fba3c1bcfe</td>
</tr>
<tr>
<td style="text-align:left">shared</td>
<td style="text-align:left">node0</td>
<td style="text-align:left">private</td>
<td style="text-align:left">[&ldquo;server-1&rdquo;, &ldquo;instance-00000002&rdquo;]</td>
<td style="text-align:left">ffaeb199-47f4-4d95-89b2-97fba3c1bcfe</td>
</tr>
<tr>
<td style="text-align:left">shared</td>
<td style="text-align:left">node0</td>
<td style="text-align:left">private</td>
<td style="text-align:left">[&ldquo;server-3&rdquo;, &ldquo;instance-00000005&rdquo;]</td>
<td style="text-align:left">c9db7c2e-c712-49d6-8019-14b82de8542d</td>
</tr>
<tr>
<td style="text-align:left">shared</td>
<td style="text-align:left">node0</td>
<td style="text-align:left">private</td>
<td style="text-align:left">[&ldquo;server-3&rdquo;, &ldquo;instance-00000005&rdquo;]</td>
<td style="text-align:left">volume-2</td>
</tr>
<tr>
<td style="text-align:left">shared</td>
<td style="text-align:left">node0</td>
<td style="text-align:left">public</td>
<td style="text-align:left">[&ldquo;server-4&rdquo;, &ldquo;instance-00000006&rdquo;]</td>
<td style="text-align:left">volume-2</td>
</tr>
</tbody>
</table>
<p>å’±ä»¬å†çœ‹çœ‹å®ƒçš„å¯è§†åŒ–ç»“æœã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">server_escaping_hypervisor</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="o">`</span><span class="n">contains</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">hypervisor_compromised</span><span class="p">:</span><span class="n">nova_host</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">server_escaping_hypervisor</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;server-0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="n">server_escaping_hypervisor</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">attached</span><span class="p">]</span><span class="o">-</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">contains</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">impacted_subnet_high</span><span class="p">:</span><span class="n">neutron_network</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="n">p1</span><span class="o">=</span><span class="p">(</span><span class="n">hypervisor_compromised</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">contains</span><span class="o">`</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">server_same_host</span><span class="p">:</span><span class="n">nova_instance</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="n">p2</span><span class="o">=</span><span class="p">(</span><span class="n">server_same_host</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">attached</span><span class="p">]</span><span class="o">-</span><span class="p">(:</span><span class="n">neutron_port</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">contains</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">impacted_subnet</span><span class="p">:</span><span class="n">neutron_network</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="n">p3</span><span class="o">=</span><span class="p">(</span><span class="n">server_same_host</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">attached</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">impacted_volume</span><span class="p">:</span><span class="n">cinder_volume</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é€‰æ‹© Dagre å¸ƒå±€ä¹‹åï¼Œå¯ä»¥æ¯”è¾ƒæ¸…æ™°çœ‹å‡ºå½±å“èµ„æºçš„èŒƒå›´ï¼Œä»è¿™äº›å¯èƒ½å—å½±å“çš„è™šæœºã€ç½‘ç»œã€ç½‘ç›˜å‡ºå‘ï¼Œå¯ä»¥è¿›ä¸€æ­¥é‡‡å–éœ€è¦çš„æªæ–½äº†ã€‚</p>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/hypervisor_escape.webp" title="hypervisor_escape" data-thumbnail="/graph-enabled-infra-ops/hypervisor_escape.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/hypervisor_escape.webp"
            srcset="/graph-enabled-infra-ops/hypervisor_escape.webp, /graph-enabled-infra-ops/hypervisor_escape.webp 1.5x, /graph-enabled-infra-ops/hypervisor_escape.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/hypervisor_escape.webp">
    </a></figure></p>
<h3 id="é‡ç‚¹å…³æ³¨èµ„æºæ£€æµ‹" class="headerLink">
    <a href="#%e9%87%8d%e7%82%b9%e5%85%b3%e6%b3%a8%e8%b5%84%e6%ba%90%e6%a3%80%e6%b5%8b" class="header-mark"></a>4.6 é‡ç‚¹å…³æ³¨èµ„æºæ£€æµ‹</h3><p>æœ€åï¼Œåˆ©ç”¨ Betweenness Centrality ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºåŸºç¡€è®¾æ–½ä¸­å½±å“é¢å¤§çš„é‚£äº›ï¼Œâ€è„†å¼±ç¯èŠ‚â€œï¼Œè¿™äº›èµ„æºä¸ä¸€å®šçœŸçš„å¤„åœ¨å±é™©çš„çŠ¶æ€ï¼Œåªæ˜¯è¯´ï¼Œå®ƒä»¬å¤„åœ¨äº†æ¯”è¾ƒé‡è¦çš„èµ„æºä¹‹é—´çš„äº¤æ±‡å¤„ï¼Œä¸€æ—¦å®ƒä»¬å‡ºé—®é¢˜ï¼Œå‡ºé—®é¢˜çš„ä»£ä»·å¯èƒ½ä¼šéå¸¸å¤§ã€‚</p>
<p>è¯†åˆ«å‡ºè¿™æ ·çš„èµ„æºä¹‹åæˆ‘ä»¬å¯ä»¥è€ƒè™‘ï¼š</p>
<ul>
<li>æœ‰é’ˆå¯¹æ€§é‡‡ç”¨æ›´æ¿€è¿›ã€æ˜‚è´µçš„å¥åº·æ£€æŸ¥ç­–ç•¥ï¼›</li>
<li>è®¾å®šæ›´é«˜çš„æ”¯æŒã€å…³åˆ‡çº§åˆ«ï¼›</li>
<li>ä¸»åŠ¨è¿ç§»ç›¸å…³è”çš„èµ„æºä»¥é™ä½â€è„†å¼±ç¯èŠ‚â€œå¯¹æ•´ä½“åŸºç¡€è®¾æ–½å¯ç”¨æ€§çš„å½±å“èŒƒå›´ï¼›</li>
</ul>
<p>è¿™æ¬¡ï¼Œæˆ‘ä»¬å°±åªåœ¨æµè§ˆå™¨å†…éƒ¨çš„å­å›¾ä¸Šåšç®—æ³•æµç¨‹éªŒè¯ï¼Œè¯»è€…æœ‹å‹ä»¬å¯ä»¥è‡ªå·±è¯•ç€åˆ©ç”¨å¼€æºçš„ NebulaGraph Algorithm æˆ–è€…ä»˜è´¹çš„ NebulaGraph Workflow+Analytics åšå…¨å›¾ä¸Šçš„ç­‰ä»·æ“ä½œã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨å‰è¾¹ç”¨è¿‡çš„æ–¹å¼å»æ‰«æå›¾ä¸Š 1000 ä¸ªç‚¹ï¼Œå¹¶ä¸”ä»å…¶å‡ºå‘ï¼Œè·³ä¸€è·³ï¼Œè·å¾—ä¸€ä¸ªæ¯”è¾ƒéšæœºçš„å­å›¾ï¼Œåœ¨æˆ‘ä»¬å½“å‰çš„æ•°æ®é›†ä¸‹ï¼Œè¿™å®é™…ä¸Šæå–äº†å…¨å›¾çš„æ•°æ®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MATCH (n) WITH n LIMIT 1000
</span></span><span class="line"><span class="cl">OPTIONAL MATCH p=(n)--()
</span></span><span class="line"><span class="cl">RETURN p, n
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å…¶ä¹‹ä¸Šï¼Œæˆ‘ä»¬è¿è¡Œ Betweenness Centrality ä¹‹åï¼Œå¾—åˆ° <code>node0</code> æ˜¯åˆ†å€¼æœ€å¤§çš„â€è„†å¼±ä¸€ç¯â€œï¼Œçš„ç¡®ï¼Œå®ƒæ˜¯æˆ‘ä»¬å½“å‰å®éªŒä¸­è´Ÿè½½æœ€å¤§çš„å®¿ä¸»æœºï¼Œå¯ä»¥æƒ³è±¡å®ƒç¡®å®æ˜¯æ•…éšœä¹‹åå…¨å±€å½±å“æœ€å¤§çš„ä¸€ä¸ªèµ„æºã€‚</p>
<p><figure><a class="lightgallery" href="/graph-enabled-infra-ops/bwteeness_centrality.webp" title="bwteeness_centrality" data-thumbnail="/graph-enabled-infra-ops/bwteeness_centrality.webp">
        <img
            
            loading="lazy"
            src="/graph-enabled-infra-ops/bwteeness_centrality.webp"
            srcset="/graph-enabled-infra-ops/bwteeness_centrality.webp, /graph-enabled-infra-ops/bwteeness_centrality.webp 1.5x, /graph-enabled-infra-ops/bwteeness_centrality.webp 2x"
            sizes="auto"
            alt="/graph-enabled-infra-ops/bwteeness_centrality.webp">
    </a></figure></p>
<h2 id="æ€»ç»“" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93" class="header-mark"></a>5 æ€»ç»“</h2><p>åœ¨æµ·é‡æ•°æ®ã€ä¼ä¸šäº‘ã€æ··åˆäº‘çš„å¤æ‚åŸºç¡€è®¾æ–½è¿ç»´åœºæ™¯ä¸‹ï¼Œåˆ©ç”¨å›¾æ•°æ®åº“å›¾ç®—æ³•çš„èƒ½åŠ›åšé«˜æ•ˆçš„è¾…åŠ©è¿ç»´å·¥ä½œæ˜¯ä¸€ä¸ªååˆ†å€¼å¾—çš„å°è¯•ä¸æŠ€æœ¯æŠ•èµ„ã€‚</p>
<p>NebulaGraph ä½œä¸ºé«˜æ€§èƒ½ã€å¼€æºã€åˆ†å¸ƒå¼çš„æ–°ä¸€ä»£äº‘åŸç”Ÿå›¾æ•°æ®åº“ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå€¼å¾—è€ƒè™‘çš„å›¾åŸºç¡€è®¾æ–½é€‰å‹ç›®æ ‡ã€‚</p>
<p>æ¬¢è¿å¤§å®¶åœ¨æ–‡æœ«ç•™è¨€è®¨è®ºï¼Œæœ¬æ–‡çš„å¯å¤ç°ç¯å¢ƒå’Œç¤ºä¾‹çš„ ETL ç®¡é“çš„ä»£ç ã€ç¤ºä¾‹æ•°æ®å…¨éƒ½åœ¨ <a href="https://github.com/wey-gu/openstack-graph/" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/openstack-graph/</a> å¼€æºï¼Œæ¬¢è¿å¤§å®¶æ¥ä¸€èµ·å®Œå–„ã€‚</p>
<blockquote>
<p>é¢˜å›¾ç‰ˆæƒï¼š<a href="https://unsplash.com/photos/Wv2U24G2F78" target="_blank" rel="noopener noreferrer">Ivan</a></p>
</blockquote>]]></description>
</item><item>
    <title>è¿æ¥å¾®ä¿¡ç¾¤ã€Slack å’Œ GitHubï¼šç¤¾åŒºå¼€æ”¾æ²Ÿé€šçš„åŸºç¡€è®¾æ–½æ­å»º</title>
    <link>https://siwei.io/build-open-communication-infra/</link>
    <pubDate>Mon, 19 Dec 2022 19:45:53 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/build-open-communication-infra/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/build-open-communication-infra/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>NebulaGraph ç¤¾åŒºå¦‚ä½•æ„å»ºå·¥å…·è®© Slackã€WeChat ä¸­å®è´µçš„ç¾¤èŠè®¨è®ºåŒæ­¥åˆ°å…¬å…±é¢†åŸŸ</p>
</blockquote>
<!--

[TOC]

-->
<h2 id="è¦å¼€æ”¾ä¸è¦å°é—­" class="headerLink">
    <a href="#%e8%a6%81%e5%bc%80%e6%94%be%e4%b8%8d%e8%a6%81%e5%b0%81%e9%97%ad" class="header-mark"></a>1 è¦å¼€æ”¾ï¼Œä¸è¦å°é—­</h2><p>åœ¨å¼€æºç¤¾åŒºä¸­ï¼Œå¼€æ”¾çš„ä¸€ä¸ªé‡è¦æ„ä¹‰æ˜¯ç¤¾åŒºå†…çš„æ²Ÿé€šã€è®¨è®ºåº”è¯¥æ˜¯é€æ˜ã€åŒ…å®¹å¹¶ä¸”æ–¹ä¾¿æ‰€æœ‰æˆå‘˜è®¿é—®çš„ã€‚è¿™æ„å‘³ç€ç¤¾åŒºä¸­çš„ä»»ä½•äººéƒ½åº”è¯¥èƒ½å¤Ÿå‚ä¸è®¨è®ºå’Œå†³ç­–è¿‡ç¨‹ï¼Œå¹¶ä¸”æ‰€æœ‰ç›¸å…³ä¿¡æ¯åº”è¯¥å…¬å¼€å’Œè‡ªç”±åœ°å…±äº«ã€‚</p>
<p>åœ¨å…¬å…±åœºåˆè¿›è¡Œæ²Ÿé€šåœ¨å¼€æºç†å¿µä¸­æ˜¯é‡è¦çš„ï¼Œæ­£å¼è¿™ç§æ–¹å¼ä½¿å¾—ç¤¾åŒºçš„æˆå‘˜å¯ä»¥è¿›è¡Œæœ‰æ•ˆåœ°å…±åŒå·¥ä½œï¼Œåˆ†äº«æƒ³æ³•å’Œåé¦ˆï¼Œä¸ºé¡¹ç›®æˆ–ç¤¾åŒºåšå‡ºè´¡çŒ®ã€‚</p>
<p>ä¸ºäº†æ›´æ¸…æ¥šè¡¨è¾¾ï¼Œæˆ‘ä¸¾å‡ ä¸ªåé¢çš„ä¾‹å­ï¼š</p>
<ul>
<li>
<p>è¦æ±‚è´¡çŒ®è€…ä½¿ç”¨å¯¹ä»–ä»¬æ¥è¯´éš¾ä»¥è®¿é—®æˆ–éš¾ä»¥ä½¿ç”¨çš„å·¥å…·å¯èƒ½ä¼šå¦¨ç¢å¼€æºç¤¾åŒºä¸­çš„å¼€æ”¾æ²Ÿé€šã€‚
è¿™å¯èƒ½æ˜¯ç”±äºå¤šç§åŸå› ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>å·¥å…·å¯èƒ½æ˜‚è´µæˆ–éœ€è¦è®¸å¯è¯ï¼Œè€Œå¹¶éæ‰€æœ‰è´¡çŒ®è€…éƒ½èƒ½è´Ÿæ‹…å¾—èµ·ã€‚</li>
<li>å·¥å…·å¯èƒ½éš¾ä»¥ä½¿ç”¨æˆ–éœ€è¦å¾ˆé«˜çš„æŠ€æœ¯ç»éªŒç§¯ç´¯ï¼Œè€Œå¹¶éæ‰€æœ‰è´¡çŒ®è€…éƒ½å…·å¤‡ã€‚</li>
<li>å·¥å…·å¯èƒ½åœ¨æŸäº›æ“ä½œç³»ç»Ÿæˆ–è®¾å¤‡ä¸Šä¸å…¼å®¹ï¼Œè¿™å¯èƒ½ä½¿ä¸€äº›è´¡çŒ®è€…éš¾ä»¥è®¿é—®å®ƒä»¬ã€‚</li>
</ul>
</li>
<li>
<p>åœ¨ä¸ä¸ç¤¾åŒºå…¶ä»–æˆå‘˜åˆ†äº«ä¸Šä¸‹æ–‡ã€è¿‡ç¨‹æˆ–ç»“æœçš„æƒ…å†µä¸‹ï¼Œåªåœ¨çº¿ä¸‹ï¼ˆä¾‹å¦‚é€šè¿‡å½“é¢æ²Ÿé€šã€IM æˆ–ç”µè¯ä¼šè®®ï¼‰è¿›è¡Œå†³ç­–å¯èƒ½ä¼šä½¿å¾ˆé‡è¦çš„çŸ¥è¯†åªè¢«å°‘æ•°è´¡çŒ®è€…æŒæ¡ã€‚</p>
<p>è¿™å¯èƒ½ä¼šé˜»æ­¢å…¶ä»–äººåœ¨è¿™äº›çŸ¥è¯†ä¹‹ä¸Šåšè´¡çŒ®æˆ–ä»ä¸­å­¦ä¹ ï¼Œé˜»ç¢äº†å¼€æºç¤¾åŒºæ‰€å¿…éœ€çš„å¼€æ”¾æ²Ÿé€šå’Œåä½œã€‚</p>
</li>
<li>
<p>æ²¡æœ‰æŠŠç³»ç»Ÿã€åŠŸèƒ½è®¾è®¡å’Œææ¡ˆä¿¡æ¯ä»¥å…¬å¼€æ–¹å¼æ–‡æ¡£åŒ–ã€å½’æ¡£ä¸‹æ¥ï¼Œä¾‹å¦‚åªæä¾›æŸä¸€ä¸ªå…¬å¸å†…ç½‘çš„é“¾æ¥ï¼Œä»è€Œå¯èƒ½ä¼¤å®³å¼€æºç¤¾åŒºçš„é€æ˜åº¦å’ŒåŒ…å®¹æ€§ã€‚</p>
<p>å› ä¸ºè¿™æ ·çš„ç»“æœæ˜¯ç¤¾åŒºçš„å…¶ä»–æˆå‘˜å¾ˆéš¾ä¿æŒå¯¹ç¤¾åŒºè¿›å±•çš„æ­£å¸¸äº†è§£ã€å°±æ›´ä¸ç”¨è¯´å‚ä¸è¿›æ¥åšè´¡çŒ®äº†ã€‚ä¸ºäº†ä¿ƒè¿›é€æ˜åº¦å’ŒåŒ…å®¹æ€§ï¼Œå¼€æºç¤¾åŒºåº”å°½é‡ç¡®ä¿æ‰€æœ‰é‡è¦çš„ä¿¡æ¯å…¬å¼€å’Œè‡ªç”±åœ°å…±äº«ã€å°½å¯èƒ½ä¿æœ‰ç»†èŠ‚åœ°è¢«å…¬å¼€å½’æ¡£ã€‚</p>
</li>
</ul>
<h2 id="æŒ‘æˆ˜" class="headerLink">
    <a href="#%e6%8c%91%e6%88%98" class="header-mark"></a>2 æŒ‘æˆ˜</h2><p>ä¸ºäº†ä½¿ç¤¾åŒºï¼ˆæˆ–å·¥ä½œç¯å¢ƒï¼‰çš„æ²Ÿé€šä¿æŒé€æ˜ã€é«˜æ•ˆå’Œå¥åº·ï¼Œå…¶å®å·²ç»å­˜åœ¨ä¸€äº›å…±è¯†ï¼Œå’Œé€šç”¨çš„åšæ³•ï¼š</p>
<ul>
<li>
<p>å¼‚æ­¥ä¼˜äºåŒæ­¥ï¼Œåœ¨åˆ†å¸ƒå¼å’Œå…¨çƒåä½œçš„æƒ…å†µä¸‹ï¼ŒåŒæ­¥é€šä¿¡åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æˆæœ¬é«˜ä¸”æ•ˆç‡ä½ã€‚</p>
<p>å› æ­¤ï¼Œæ¨èä½¿ç”¨ GitHub Discussion å’Œ StackOverflow è¿›è¡Œæé—®å¼çš„æ²Ÿé€šã€‚</p>
</li>
<li>
<p>ä¸“é¢˜ï¼ˆThreadï¼‰è®¨è®ºä¼˜äºå¹¿æ’­ï¼ˆFan out)ï¼Œæ³¨æ„åŠ›æ˜¯å®è´µçš„ï¼Œå‘æ‰€æœ‰äººç¾¤å‘æœ€ç»ˆå¸¸å¸¸å¯¼è‡´é‡è¦ä¿¡æ¯æ²¡æœ‰äººçœŸçš„è¯»ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ GitHub Discussion å’Œ Slack ä¸­è®¾æœ‰åˆ†ç±»ã€é¢‘é“ã€‚å»ºç«‹ SIG æ¥è®¨è®ºä¸€äº›æœ‰è¶£çš„ä¸»é¢˜ï¼ˆå¹¶å½’æ¡£æ²Ÿé€šçš„ç»“æœï¼‰ï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰äº‹æƒ…å¸¦åˆ°ç¤¾åŒºä¼šè®®å¹¿æ³›è®¨è®ºã€‚</p>
</li>
<li>
<p>ä¼˜å…ˆé€‰æ‹©å¯æœç´¢/æ–‡æœ¬ã€ç‰ˆæœ¬æ§åˆ¶ã€åä½œçš„æ–¹å¼ä¸å·¥å…·ï¼Œå¹¶åœ¨å¯èƒ½çš„æƒ…å†µä¸‹é¼“åŠ±æˆå‘˜ä»¬ç»™å…¶ä»–äººåé¦ˆï¼›åœ¨åŸºç¡€è®¾æ–½ä¸Šè·Ÿè¸ªæ–‡æ¡£ã€è®¾è®¡æµç¨‹ï¼Œå¹¶ä¸”æä¾›è¯„è®ºã€review çš„èƒ½åŠ›ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬ç”¨ etherpad.opendev.org æ¥è®°å½•ç¤¾åŒºä¼šè®®æ–‡æ¡£ã€‚</p>
</li>
</ul>
<p>ä½†æ˜¯ï¼Œå°±åƒæˆ‘ä»¬è¿˜æ˜¯éœ€è¦åŒæ­¥çš„æ²Ÿé€šã€æœ‰ IM å’Œä¼šè®®çš„éœ€æ±‚ä¸€æ ·ï¼Œè¿˜æ˜¯å­˜åœ¨ä¸€äº›ç‰¹ä¾‹çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¸èƒ½ç›²ç›®è¿½æ±‚å¼‚æ­¥ã€ç»å¯¹çš„å¼€æ”¾çš„ï¼Œæ­£å¦‚å‰è¾¹æåˆ°çš„ï¼Œèƒ½è®©æ›´å¤šå‚ä¸è€…å…¬å¹³ã€æ–¹ä¾¿ä¸ç¤¾åŒºè¿ç»“æœ¬èº«ä¹Ÿæ˜¯å¼€æ”¾çš„ä¸€éƒ¨åˆ†ï¼Œå°½ç®¡ä½¿ç”¨çš„åŸºç¡€è®¾æ–½æ˜¯å¯èƒ½æ˜¯å°é—­çš„ã€‚äº‹å®ä¸Šï¼Œå‡ ä¹æ‰€æœ‰çš„å¼€æºç¤¾åŒºéƒ½åœ¨ç”¨ç±»ä¼¼çš„æ–¹å¼å»ºç«‹ä»–ä»¬çš„å¼€æºç¤¾åŒºæ²Ÿé€šå¹³å°ï¼š</p>
<ul>
<li>
<p>Slack åœ¨ IM æ¶ˆæ¯ä¸­ä¸­æ”¯æŒä¸°å¯Œçš„æ ¼å¼åŒ–ï¼ˆæ”¯æŒ markdownï¼ï¼‰å’Œ Thread ç³»ç»Ÿï¼Œå…¶ç°ä»£åŒ–è®¾è®¡å’Œå¼€æ”¾/è½¯å®šä¹‰æ¥å£ä½¿æˆ‘ä»¬çš„å·¥ä½œæµç¨‹å¯èƒ½éå¸¸ä¼˜ç¾æµç•…ã€‚</p>
</li>
<li>
<p>ä¸ Slack ç›¸æ¯”ï¼Œå¾®ä¿¡åœ¨æŠ€æœ¯ç¤¾åŒºä¸­åœ¨è®¸å¤šæ–¹é¢éƒ½å¾ˆä¸ç†æƒ³ï¼ˆåªæ˜¯å› ä¸ºå®ƒä¸æ˜¯ä¸“ä¸ºè¿™æ ·åœºæ™¯è€Œè®¾è®¡çš„ï¼ï¼‰ï¼Œä½†åœ¨å›½å†…ï¼Œå®ƒæ˜¯ç¤¾åŒºä¸­æ‰€æœ‰äººéƒ½å¯ä»¥è®¿é—®çš„å”¯ä¸€å¹³å°ã€‚æ¯ä¸ªäººéƒ½æœ‰ä¸€ä¸ªå¾®ä¿¡è´¦å·ï¼Œè€Œåªæœ‰å¾ˆå°‘ä¸€éƒ¨åˆ†äººä¼šæ¯å¤©æŸ¥é‚®ä»¶ã€‚</p>
</li>
</ul>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬é¢ä¸´çš„é—®é¢˜æ˜¯ï¼Œåœ¨ NebulaGraph ç¤¾åŒºä¸­æœ‰ä¸¤ä¸ªå¹³å°æ‰¿æ‹…äº†æ²Ÿé€šçš„é‡è¦éƒ¨åˆ†ï¼Œä½†è¿™äº›ä¿¡æ¯åœ¨å‡ ä¸ªæœˆåå°±ä¼šæ¶ˆå¤±ï¼Œå®ƒä»¬åœ¨çŸ­æ—¶é—´å†…åªèƒ½è¢«å‰²è£‚çš„ä¸€éƒ¨åˆ†è´¡çŒ®è€…çœ‹åˆ°ï¼Œè€Œæœªæ¥æ²¡æœ‰äººæˆ–å…¶ä»–å¹³å°å¯ä»¥è¯»åˆ°ã€æœåˆ°å’Œå‚è€ƒã€å¼•ç”¨è¿™äº›æœ‰ä»·å€¼çš„è®¨è®ºã€‚</p>
<h2 id="æˆ‘ä»¬æ‘¸ç´¢çš„æ–¹æ¡ˆ" class="headerLink">
    <a href="#%e6%88%91%e4%bb%ac%e6%91%b8%e7%b4%a2%e7%9a%84%e6%96%b9%e6%a1%88" class="header-mark"></a>3 æˆ‘ä»¬æ‘¸ç´¢çš„æ–¹æ¡ˆ</h2><p>æ›¾ç»æœ‰ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä»¬ä¼šè‡ªå·±æ‰‹åŠ¨æ”¶é›† Slackã€å¾®ä¿¡ç¾¤é‡Œçš„è®¨è®ºæ‘˜è¦ï¼Œå®šæœŸåˆ†äº«ã€å½’æ¡£åœ¨å…¬å…±é¢†åŸŸï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿç¡®å®å¸¦æ¥äº†ä¸€äº›ä»·å€¼ï¼Œç„¶è€Œï¼Œæˆ‘ä»¬æœ€åéƒ½æ²¡åšæŒä¸‹å»ï¼ŒåŸå› å¾ˆç®€å•ï¼š1. è¿™å¤ªè´¹äº‹å„¿äº†ï¼Œå®Œå…¨ä¸ scaleï¼›2. è¿™ç§æ‘˜è¦å…¶å®ä¸å¥½å¹³è¡¡èƒ½è¢«å½’æ¡£ä¿¡æ¯çš„è£å‰ªç¨‹åº¦ï¼Œæœ‰æ—¶å€™ç»†èŠ‚éå¸¸é‡è¦å´ä¸å®¹æ˜“è¢«æ‘˜è¦ä¿ç•™ã€‚</p>
<h3 id="æå®š-slack-çš„ä¿¡æ¯å­¤å²›" class="headerLink">
    <a href="#%e6%90%9e%e5%ae%9a-slack-%e7%9a%84%e4%bf%a1%e6%81%af%e5%ad%a4%e5%b2%9b" class="header-mark"></a>3.1 æå®š Slack çš„ä¿¡æ¯å­¤å²›</h3><p>2022 å¹´ 10 æœˆï¼Œæˆ‘æ³¨æ„åˆ°äº† linen.dev è¿™ä¸ªå¼€æºé¡¹ç›®åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ª SaaS æœåŠ¡ï¼Œæœ‰äº†å®ƒï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ Discord å’Œ Slack ä¸­çš„æ¯ä¸ª thread ä¿ç•™ï¼Œå®ƒæ•´ç«™çœ‹èµ·æ¥å’Œ Discord/ Slack æœºä¼šæ ·ï¼Œä½†æ˜¯ï¼Œå®ƒå®Œå…¨æ˜¯å¯ä»¥åŒ¿åè¢«è®¿é—®ã€å¼•ç”¨å’Œè¢«æœç´¢å¼•æ“æœç´¢çš„ã€‚</p>
<p>ç»è¿‡å‡ ä¸ªæœˆçš„è¯„ä¼°ï¼Œæˆ‘ä»¬æœ€ç»ˆå†³å®šäº†è®¢é˜… linen.dev æœåŠ¡ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ï¼š</p>
<ul>
<li>ä¸ç”¨å»ç¢°ç°æœ‰çš„ Slackï¼Œæ‰€æœ‰ Slack çš„å¥½å¤„éƒ½èƒ½å¾—ä»¥ä¿ç•™</li>
<li>æœ‰äº†è¿™æ ·ä¸€ä¸ªç¤¾åŒºçš„ç«™ç‚¹ <a href="https://community-chat.nebula-graph.io/" target="_blank" rel="noopener noreferrer">https://community-chat.nebula-graph.io/</a>ï¼Œå…¶ä¸­ï¼ŒSlack ä¸­çš„æ¯ä¸ªå…¬å…±é¢‘é“å†…å®¹éƒ½èƒ½è¢«åŒ¿åè®¿é—®ã€èƒ½è¢«æœç´¢å¼•æ“æ”¶å½•ï¼Œè€Œè®¿å®¢è¿˜å¯ä»¥å¾ˆå®¹æ˜“çŸ¥é“æ€ä¹ˆåŠ å…¥æˆ‘ä»¬çš„ Slackï¼Œå¦‚å›¾å³ä¸Šè§’ï¼š</li>
</ul>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/208391200-8670f7f7-6e7a-4f62-84d3-3d2594ab9083.png" title="https://user-images.githubusercontent.com/1651790/208391200-8670f7f7-6e7a-4f62-84d3-3d2594ab9083.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/208391200-8670f7f7-6e7a-4f62-84d3-3d2594ab9083.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/208391200-8670f7f7-6e7a-4f62-84d3-3d2594ab9083.png"
            srcset="https://user-images.githubusercontent.com/1651790/208391200-8670f7f7-6e7a-4f62-84d3-3d2594ab9083.png, https://user-images.githubusercontent.com/1651790/208391200-8670f7f7-6e7a-4f62-84d3-3d2594ab9083.png 1.5x, https://user-images.githubusercontent.com/1651790/208391200-8670f7f7-6e7a-4f62-84d3-3d2594ab9083.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/208391200-8670f7f7-6e7a-4f62-84d3-3d2594ab9083.png">
    </a></figure>
è¿™ä¸ªç«™ä¼šå®æ—¶åŒæ­¥ Slack é‡Œçš„æ¶ˆæ¯ï¼Œé‡è¦çš„æ˜¯ï¼Œå®ƒæ˜¯é¢å‘æœç´¢å¼•æ“ä¼˜åŒ–çš„ï¼Œä½ å¯ä»¥æœæœ Kotlin ç¤¾åŒºé€šè¿‡ linen è¢«æ”¶å½•çš„ç½‘é¡µæœ‰å¤šå°‘ï¼Œæœè¿™ä¸ªï¼š<a href="https://www.google.com/search?q=site%3A&#43;slack-chats.kotlinlang.org" target="_blank" rel="noopener noreferrer">&ldquo;site: slack-chats.kotlinlang.org&rdquo;</a>ã€‚</p>
<ul>
<li>æ¯ä¸€ä¸ª thread éƒ½æœ‰ä¸€ä¸ªæ— éœ€ç™»å½•çš„åªè¯» URLï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿å»åˆ†äº«ã€å¼•ç”¨å®ƒï¼Œè™½ç„¶è¿™ä»¶äº‹å„¿æœ¬èº«å°±æ˜¯è¶…é“¾æ¥ã€URLçš„ä½œç”¨ï¼Œä½†æ˜¯åœ¨ç°åœ¨å·²ç»å˜å¾—éå¸¸ä¸å®¹æ˜“äº†ï¼Œæ¯”å¦‚<a href="https://www.nytimes.com/2022/09/16/technology/gen-z-tiktok-search-engine.html" target="_blank" rel="noopener noreferrer">è¿™ä¸ªæ–°é—»</a>é‡Œæåˆ°ç°åœ¨æ–°ä¸€ä»£çš„äººä»¬æ›´å€¾å‘äºåœ¨æŠ–éŸ³é‡Œæœç´¢è€Œä¸æ˜¯åœ¨å…¬å…±é¢†åŸŸé‡Œã€‚
æœ‰äº†å®ƒï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸å¼€å¿ƒåœ°åœ¨ GitHub é‡Œå¼•ç”¨ä»»æ„ä¸€ä¸ª Slack è®¨è®ºè¯é¢˜ï¼š
<figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/208390478-7a7a6213-677b-4385-8b3e-ea57f65ece7b.png" title="https://user-images.githubusercontent.com/1651790/208390478-7a7a6213-677b-4385-8b3e-ea57f65ece7b.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/208390478-7a7a6213-677b-4385-8b3e-ea57f65ece7b.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/208390478-7a7a6213-677b-4385-8b3e-ea57f65ece7b.png"
            srcset="https://user-images.githubusercontent.com/1651790/208390478-7a7a6213-677b-4385-8b3e-ea57f65ece7b.png, https://user-images.githubusercontent.com/1651790/208390478-7a7a6213-677b-4385-8b3e-ea57f65ece7b.png 1.5x, https://user-images.githubusercontent.com/1651790/208390478-7a7a6213-677b-4385-8b3e-ea57f65ece7b.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/208390478-7a7a6213-677b-4385-8b3e-ea57f65ece7b.png">
    </a></figure></li>
</ul>
<p>è§£å†³äº† Slack çš„é—®é¢˜ä¹‹åï¼Œå”¯ä¸€å‰©ä¸‹çš„ç—›ç‚¹å°±æ˜¯å¾®ä¿¡ç¾¤äº†ï¼Œæ¯å‘¨éƒ½æœ‰æŒºå¤šéå¸¸å®è´µçš„è®¨è®ºåœ¨ç¤¾åŒºç¾¤ä¸­è¿›è¡Œå´ä¸èƒ½è¢«ä¿ç•™ä¸‹æ¥ï¼ŒçœŸå®å¤ªä»¤äººå¿ƒç–¼äº†ï¼Œç»ˆäºæœ‰ä¸€å¤©ï¼Œæˆ‘ä»¬å†³å®šæŠŠè¿™ä¸ªé—®é¢˜è§£å†³ã€‚</p>
<h3 id="è§£å†³å¾®ä¿¡ç¾¤çš„ä¿¡æ¯å…¬å¼€åŒ–" class="headerLink">
    <a href="#%e8%a7%a3%e5%86%b3%e5%be%ae%e4%bf%a1%e7%be%a4%e7%9a%84%e4%bf%a1%e6%81%af%e5%85%ac%e5%bc%80%e5%8c%96" class="header-mark"></a>3.2 è§£å†³å¾®ä¿¡ç¾¤çš„ä¿¡æ¯å…¬å¼€åŒ–</h3><p>é¦–å…ˆï¼Œèƒ½ä¸èƒ½ç›´æ¥ç”¨ Linen ä¸€æŠŠæ¢­ï¼ŒåŒæ­¥ç¾¤æ¶ˆæ¯å‘¢ï¼Ÿæˆ‘ç¡®å®<a href="https://github.com/Linen-dev/linen.dev/issues/553" target="_blank" rel="noopener noreferrer">åœ¨ Linen ç¤¾åŒºå’Œä»–ä»¬çš„ Kam è®¨è®º</a>ç›´æ¥è§£å†³ IM åŒæ­¥çš„å¯èƒ½ï¼Œä¸è¿‡åˆ°ç°åœ¨ï¼Œä»–ä»¬éƒ½æ²¡æœ‰ä¼˜å…ˆè€ƒè™‘ğŸ˜­ã€‚</p>
<p>ç„¶åï¼Œæˆ‘å°±åœ¨æƒ³å¦‚æœç›´æ¥æŠŠå¾®ä¿¡åŒæ­¥åˆ° Slackï¼ŒLinen ä¸å°±èƒ½æŠŠå¾®ä¿¡çš„ä¿¡æ¯ä¹Ÿæ”¶å½•äº†å—ï¼Ÿ</p>
<p>åœ¨ <a href="https://twitter.com/wey_gu/status/1603307477239750657" target="_blank" rel="noopener noreferrer">Twitter ä¸Š</a> æ±‚åŠ©é»‘å®¢/å¼€æºç¤¾åŒº + ä¸€ç•ªè°ƒç ”ç¡®å®šäº†æ²¡æœ‰è¿™æ ·çš„ä¸œè¥¿å­˜åœ¨ä¹‹åï¼Œæˆ‘<a href="https://twitter.com/wey_gu/status/1603307477239750657?s=20&amp;t=UG6g_ASQ89QWnMqjLfmdqA" target="_blank" rel="noopener noreferrer">å†³å®šæä¸€ä¸ªï¼Œåšæˆå¼€æºé¡¹ç›®</a>ï¼Œæˆ‘èŠ±äº†ä¸€ç‚¹æ—¶é—´å®ç°äº†æœ€åˆçš„ç‰ˆæœ¬ã€‚</p>
<blockquote class="twitter-tweet" data-dnt="true"><p lang="zh" dir="ltr">çŸ³å¤´æ±¤æ¥äº† ğŸ‘‰ğŸ»ï¼š<a href="https://t.co/Fdhm9MkoBb">https://t.co/Fdhm9MkoBb</a><a href="https://twitter.com/hashtag/NebulaGraph?src=hash&amp;ref_src=twsrc%5Etfw">#NebulaGraph</a> ç¤¾åŒºå¾®ä¿¡ç¾¤ç°åœ¨å·²ç»ä¼šè¢«åŒæ­¥åˆ° slack äº†ã€‚</p>&mdash; Wey Gu å¤æ€ä¸º (@wey_gu) <a href="https://twitter.com/wey_gu/status/1603307477239750657?ref_src=twsrc%5Etfw">December 15, 2022</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>ä¸‡ä¸‡æ²¡æƒ³åˆ°ï¼Œå½“æˆ‘åšåˆ°æŠŠæ¶ˆæ¯ä»å¾®ä¿¡åŒæ­¥åˆ° Slack ä¹‹åï¼Œ<a href="https://github.com/Linen-dev/linen.dev/issues/761" target="_blank" rel="noopener noreferrer">éšä¹‹è€Œæ¥çš„é—®é¢˜</a>æ˜¯ï¼Œé€šè¿‡ Slack API å‘å‡ºçš„æ¶ˆæ¯ Linen å¹¶ä¸ä¼šæ”¶å½•ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘æ”¾å¼ƒäº† linen ä¸€æŠŠæ¢­çš„ç¾å¥½æ„¿æœ›ï¼Œè½¬è€Œè€ƒè™‘æŠŠæ¶ˆæ¯åŒæ­¥åˆ°å…¶ä»–å…¬å…±é¢†åŸŸï¼Œè€Œæˆ‘ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„å°±æ˜¯ GitHub Discussions ä¹‹ä¸­ï¼ŒåˆèŠ±äº†å‘¨æœ«çš„ä¸‹åˆåŠ æ™šä¸Šï¼ŒæŠŠå®ƒåšå‡ºæ¥äº†ï¼š</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/208398641-e7e8dcc8-eeaf-4647-8c5c-f37f118094f5.png" title="wechat-to-gh-discussion" data-thumbnail="https://user-images.githubusercontent.com/1651790/208398641-e7e8dcc8-eeaf-4647-8c5c-f37f118094f5.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/208398641-e7e8dcc8-eeaf-4647-8c5c-f37f118094f5.png"
            srcset="https://user-images.githubusercontent.com/1651790/208398641-e7e8dcc8-eeaf-4647-8c5c-f37f118094f5.png, https://user-images.githubusercontent.com/1651790/208398641-e7e8dcc8-eeaf-4647-8c5c-f37f118094f5.png 1.5x, https://user-images.githubusercontent.com/1651790/208398641-e7e8dcc8-eeaf-4647-8c5c-f37f118094f5.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/208398641-e7e8dcc8-eeaf-4647-8c5c-f37f118094f5.png">
    </a></figure></p>
<p>ç°åœ¨ï¼Œè¿™ä¸ªæœºå™¨äººç¨‹åºä¼šæŠŠé…ç½®å¥½çš„å¾®ä¿¡ç¾¤æ¶ˆæ¯åŒæ—¶åŒæ­¥åˆ° Slack é¢‘é“å’Œ GitHub Discussion ä¸­ç»™å®šçš„æ ‡ç­¾ä¸‹çš„ä¸»é¢˜ä¸­ï¼Œæ¯ä¸€ä¸ªç¾¤ä¸€ä¸ªç¤¼æ‹œæ˜¯ä¸€ä¸ªä¸»é¢˜ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯éƒ½æ˜¯ä¸»é¢˜ä¸‹çš„è¯„è®ºã€‚</p>
<h3 id="å°ç»“" class="headerLink">
    <a href="#%e5%b0%8f%e7%bb%93" class="header-mark"></a>3.3 å°ç»“</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¿ç•™äº†æ‰€æœ‰ Slack/å¾®ä¿¡çš„ç¾å¥½çš„ä¸€é¢çš„åŒæ—¶ï¼ŒæŠŠå®ƒä»¬ä¸­çš„è®¨è®ºæ¶ˆæ¯å†å²å…¨éƒ½å½’æ¡£ã€ç´¢å¼•å¹¶å…¬å¼€åˆ°è¿™ä¸¤ä¸ªåŸŸä¹‹ä¸‹äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆé…·å‘¢ï¼Ÿ</p>
<ul>
<li><a href="https://community-chat.nebula-graph.io/" target="_blank" rel="noopener noreferrer">https://community-chat.nebula-graph.io/</a></li>
<li><a href="https://github.com/vesoft-inc/nebula-community/discussions/categories/wechat-chat-history" target="_blank" rel="noopener noreferrer">https://github.com/vesoft-inc/nebula-community/discussions/categories/wechat-chat-history</a></li>
</ul>
<h3 id="åç»­å·¥ä½œ" class="headerLink">
    <a href="#%e5%90%8e%e7%bb%ad%e5%b7%a5%e4%bd%9c" class="header-mark"></a>3.4 åç»­å·¥ä½œ</h3><p>è¿™ä¸ªåŒæ­¥å¾®ä¿¡çš„é¡¹ç›®æ˜¯ Apache 2.0 åè®®å¼€æºçš„ï¼Œå¹¶ä¸”ç°åœ¨ç”±<a href="https://github.com/wey-gu" target="_blank" rel="noopener noreferrer">æˆ‘</a>å’Œ<a href="https://github.com/frostming" target="_blank" rel="noopener noreferrer">Frost Ming</a>åœ¨ç»´æŠ¤ï¼Œ<a href="https://github.com/wey-gu/chatroom-syncer/issues" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>è¿˜æœ‰å¾ˆå¤šå¾…å¢å¼ºã€å®ç°çš„æ–°åŠŸèƒ½ã€æ–°ä»»åŠ¡ï¼Œæ¬¢è¿å¤§å®¶æ¥è¯•ç©ã€è´¡çŒ®ã€‚è®©æˆ‘ä»¬ä¸€èµ·æŠŠå¼€æºç¤¾åŒºçš„æ²Ÿé€šåšçš„å¤šä¸€ç‚¹å¼€æ”¾ã€å°‘ä¸€ç‚¹å°é—­å§~</p>
<p>é¡¹ç›®åœ°å€ ğŸ‘‰ğŸ» <a href="https://github.com/wey-gu/chatroom-syncer" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/chatroom-syncer</a>.</p>
<h2 id="ç»“è®º" class="headerLink">
    <a href="#%e7%bb%93%e8%ae%ba" class="header-mark"></a>4 ç»“è®º</h2><p>æœ‰æ•ˆçš„æ²Ÿé€šæ˜¯æˆåŠŸçš„å¼€æºç¤¾åŒºçš„åŸºçŸ³ï¼Œå› ä¸ºå®ƒè®©åä½œã€åˆ†äº«æ€æƒ³ä¸çŸ¥è¯†ã€ä»¥åŠæ‰€æœ‰æˆå‘˜çš„å‚ä¸æˆä¸ºå¯èƒ½ã€‚ä¸ºäº†ç¡®ä¿æ²Ÿé€šé€æ˜ã€åŒ…å®¹å’Œæœ‰æ•ˆï¼Œå¯¹äºå¼€æºç¤¾åŒºæ¥è¯´ï¼Œè®©æ‰€æœ‰æˆå‘˜æœ‰æœºä¼šå‚ä¸è®¨è®ºå’Œå†³ç­–ä»¥åŠå…¬å¼€è‡ªç”±åœ°åˆ†äº«ç›¸å…³ä¿¡æ¯æ˜¯éå¸¸é‡è¦çš„ã€‚</p>
<p>æˆ‘ä»¬ NebulaGraph ç¤¾åŒºçš„å»ºè®¾è€…/è´¡çŒ®è€…å°†ç»§ç»­å¯»æ‰¾å’Œé»‘å®¢æ–¹æ³•ï¼Œä»¥å¼€æ”¾å’Œè‰¯å¥½çš„æ–¹å¼ä½¿äººä»¬è¿æ¥åœ¨ä¸€èµ·ï¼Œå’Œå¤§å®¶å…±å»ºæ›´å¥½çš„å¼€æºã€æŠ€æœ¯ç¤¾åŒºã€‚</p>
<blockquote>
<p>é¢˜å›¾ç‰ˆæƒï¼š<a href="https://unsplash.com/photos/N35J0N8ZglQ" target="_blank" rel="noopener noreferrer">Artem Beliaikin</a></p>
</blockquote>]]></description>
</item><item>
    <title>å›¾æ•°æ®åº“çš„ç¤¾äº¤ç½‘ç»œåº”ç”¨</title>
    <link>https://siwei.io/nebulagraph-sns/</link>
    <pubDate>Thu, 08 Dec 2022 15:30:33 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/nebulagraph-sns/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/nebulagraph-sns/featured-image.webp" referrerpolicy="no-referrer">
            </div><h1 id="å›¾æ•°æ®åº“çš„ç¤¾äº¤ç½‘ç»œåº”ç”¨" class="headerLink">
    <a href="#%e5%9b%be%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e7%a4%be%e4%ba%a4%e7%bd%91%e7%bb%9c%e5%ba%94%e7%94%a8" class="header-mark"></a>å›¾æ•°æ®åº“çš„ç¤¾äº¤ç½‘ç»œåº”ç”¨</h1><blockquote>
<p>æœ¬æ–‡æ˜¯ä¸€ä¸ªåŸºäº NebulaGraph ä¸Šè§£å†³ç¤¾äº¤ç½‘ç»œé—®é¢˜çš„å¸¸è§„æ–¹æ³•ç»¼è¿°ã€‚å…¶ä¸­ä»‹ç»çš„æ–¹æ³•æä¾›éƒ½äº† Playground ä¾›å¤§å®¶å­¦ä¹ ã€ç©è€ã€‚</p>
</blockquote>
<!--

[TOC]

-->
<p>ç¤¾äº¤ç½‘ç»œå¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œæ— è®ºæ˜¯å¾®ä¿¡ã€å¾®åšã€B ç«™è¿˜æ˜¯å¤§ä¼—ç‚¹è¯„ã€çŸ¥ä¹ã€é™Œé™Œç­‰æœåŠ¡ï¼Œå…¶æœ¬è´¨ä¸Šçš„ç”¨æˆ·éƒ½å½¢æˆäº†ç¤¾äº¤ç½‘ç»œã€‚</p>
<p>åœ¨ä¸€ä¸ªç¤¾äº¤ç½‘ç»œç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å›¾æ•°æ®åº“æ¥è¡¨ç¤ºç”¨æˆ·å’Œä»–ä»¬çš„è¿æ¥å…³ç³»ã€‚å›¾æ•°æ®åº“èƒ½å…è®¸å¯¹ç”¨æˆ·ä¹‹é—´çš„å…³ç³»è¿›è¡Œæœ‰æ•ˆçš„æŸ¥è¯¢ï¼Œä½¿å¾—å„ç§åŸºäºè¿æ¥æŸ¥æ‰¾ã€ç»Ÿè®¡ã€åˆ†æçš„ç¤¾äº¤ç½‘ç»œä¸Šçš„ä¸šåŠ¡å®ç°å˜å¾—å¯è¡Œã€é«˜æ•ˆã€‚</p>
<p>ä¾‹å¦‚ï¼Œå›¾å½¢æ•°æ®åº“å¯ä»¥ç”¨æ¥è¯†åˆ«ç½‘ç»œä¸­çš„â€œæœ‰å½±å“åŠ›ç”¨æˆ·â€ï¼Œæˆ–è€…æ ¹æ®ç”¨æˆ·ä¹‹é—´çš„å…±åŒç‚¹å¯¹æ–°çš„è¿æ¥ï¼ˆå¥½å‹å…³ç³»ã€å…³å¿ƒçš„å†…å®¹ï¼‰è¿›è¡Œæ¨èï¼Œå†æˆ–è€…å¯»æ‰¾ç¤¾ç¾¤ä¸­ç›¸èšé›†çš„ä¸åŒäººç¾¤ã€ç¤¾åŒºï¼Œè¿›è¡Œç”¨æˆ·ç”»åƒã€‚å›¾å½¢æ•°æ®åº“å› ä¸ºåœ¨èƒ½æ”¯æ’‘å¤æ‚å¤šè·³æŸ¥è¯¢çš„åŒæ—¶ä¹Ÿèƒ½æ”¯æŒå®æ—¶å†™å…¥ã€æ›´æ–°ï¼Œä½¿å…¶éå¸¸é€‚åˆåº”ç”¨åœ¨ç”¨æˆ·å…³ç³»ä¸æ–­å˜åŒ–çš„ç¤¾äº¤ç½‘ç»œç³»ç»Ÿä¹‹ä¸Šã€‚</p>
<h2 id="å›¾å»ºæ¨¡" class="headerLink">
    <a href="#%e5%9b%be%e5%bb%ba%e6%a8%a1" class="header-mark"></a>1 å›¾å»ºæ¨¡</h2><p>ä¸ºäº†ç»™å‡ºä¸€äº›å¸¸è§ç¤¾äº¤åœºæ™¯çš„åº”ç”¨ç¤ºä¾‹ï¼Œæˆ‘ä¼šæŠŠå¤§å¤šæ•°ä¾‹å­å»ºç«‹åœ¨ä¸€ä¸ªå…¸å‹çš„å°å‹ç¤¾äº¤ç½‘ç»œä¸Šï¼Œç¤¾äº¤ç½‘ç»œå¤©ç„¶å°±æ˜¯ä¸€å¼ ç½‘ç»œã€å›¾çš„å½¢æ€ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘åœ¨ NebulaGraph å®˜æ–¹ç¤ºä¾‹æ•°æ®é›†ï¼šç¯®çƒè¿åŠ¨å‘˜ä¹‹ä¸Šï¼Œå¢åŠ äº†ä¸‰ç§ç‚¹ï¼š</p>
<ul>
<li>åœ°å€</li>
<li>åœ°ç‚¹</li>
<li>æ–‡ç« </li>
</ul>
<p>äº”ç§è¾¹ï¼š</p>
<ul>
<li>å‘æ–‡</li>
<li>è¯„è®º</li>
<li>ä½åœ¨</li>
<li>å±äºï¼ˆåœ°ç‚¹ï¼‰</li>
</ul>
<p>å®ƒçš„å»ºæ¨¡éå¸¸è‡ªç„¶ï¼š</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/schema_sketch.webp" title="schema_sketch" data-thumbnail="/nebulagraph-sns/schema_sketch.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/schema_sketch.webp"
            srcset="/nebulagraph-sns/schema_sketch.webp, /nebulagraph-sns/schema_sketch.webp 1.5x, /nebulagraph-sns/schema_sketch.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/schema_sketch.webp">
    </a></figure></p>
<h2 id="æ•°æ®å¯¼å…¥" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e5%af%bc%e5%85%a5" class="header-mark"></a>2 æ•°æ®å¯¼å…¥</h2><h3 id="åŠ è½½é»˜è®¤æ•°æ®é›†" class="headerLink">
    <a href="#%e5%8a%a0%e8%bd%bd%e9%bb%98%e8%ae%a4%e6%95%b0%e6%8d%ae%e9%9b%86" class="header-mark"></a>2.1 åŠ è½½é»˜è®¤æ•°æ®é›†</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬åŠ è½½é»˜è®¤çš„ basketballplayer æ•°æ®é›†ã€‚</p>
<ul>
<li>
<p>åœ¨å‘½ä»¤è¡Œ console ä¹‹ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰§è¡Œ <code>:play basketballplayer</code> å°±å¯ä»¥ã€‚</p>
</li>
<li>
<p>è€Œåœ¨ NebulaGraph Studio/Explorer ä¹‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¬¢è¿é¡µç‚¹å‡»ä¸‹è½½å°±éƒ¨ç½²è¿™ä»½åŸºç¡€æ•°æ®é›†ã€‚</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/baskertballplayer_studio_starter.webp" title="baskertballplayer_studio_starter" data-thumbnail="/nebulagraph-sns/baskertballplayer_studio_starter.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/baskertballplayer_studio_starter.webp"
            srcset="/nebulagraph-sns/baskertballplayer_studio_starter.webp, /nebulagraph-sns/baskertballplayer_studio_starter.webp 1.5x, /nebulagraph-sns/baskertballplayer_studio_starter.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/baskertballplayer_studio_starter.webp">
    </a></figure></p>
</li>
</ul>
<h3 id="åŠ è½½ç¤¾äº¤ç½‘ç»œ-schema" class="headerLink">
    <a href="#%e5%8a%a0%e8%bd%bd%e7%a4%be%e4%ba%a4%e7%bd%91%e7%bb%9c-schema" class="header-mark"></a>2.2 åŠ è½½ç¤¾äº¤ç½‘ç»œ schema</h3><p>å…¶æ¬¡æˆ‘ä»¬æ‰§è¡Œä¸‹è¾¹çš„è¯­å¥ï¼Œé¦–å…ˆæ˜¯ Schema å®šä¹‰çš„è¯­å¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">post</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">created_post</span><span class="p">(</span><span class="n">post_time</span><span class="w"> </span><span class="k">timestamp</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">commented_at</span><span class="p">(</span><span class="n">post_time</span><span class="w"> </span><span class="k">timestamp</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="n">address</span><span class="p">(</span><span class="n">address</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">geo_point</span><span class="o">`</span><span class="w"> </span><span class="n">geography</span><span class="p">(</span><span class="n">point</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="n">place</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">geo_point</span><span class="o">`</span><span class="w"> </span><span class="n">geography</span><span class="p">(</span><span class="n">point</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">belong_to</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">lived_in</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åŠ è½½æ•°æ®" class="headerLink">
    <a href="#%e5%8a%a0%e8%bd%bd%e6%95%b0%e6%8d%ae" class="header-mark"></a>2.3 åŠ è½½æ•°æ®</h3><p>ç„¶åï¼Œåœ¨ç­‰ä¸¤ä¸ªå¿ƒè·³æ—¶é—´ä»¥ä¸Šä¹‹åï¼ˆ20ç§’ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œæ•°æ®æ’å…¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="n">VERTEX</span><span class="w"> </span><span class="n">post</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;post1&#34;</span><span class="p">:(</span><span class="s2">&#34;a beautify flower&#34;</span><span class="p">),</span><span class="w"> </span><span class="s2">&#34;post2&#34;</span><span class="p">:(</span><span class="s2">&#34;my first bike&#34;</span><span class="p">),</span><span class="w"> </span><span class="s2">&#34;post3&#34;</span><span class="p">:(</span><span class="s2">&#34;I can swim&#34;</span><span class="p">),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;post4&#34;</span><span class="p">:(</span><span class="s2">&#34;I love you, Dad&#34;</span><span class="p">),</span><span class="w"> </span><span class="s2">&#34;post5&#34;</span><span class="p">:(</span><span class="s2">&#34;I hate coriander&#34;</span><span class="p">),</span><span class="w"> </span><span class="s2">&#34;post6&#34;</span><span class="p">:(</span><span class="s2">&#34;my best friend, tom&#34;</span><span class="p">),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;post7&#34;</span><span class="p">:(</span><span class="s2">&#34;my best friend, jerry&#34;</span><span class="p">),</span><span class="w"> </span><span class="s2">&#34;post8&#34;</span><span class="p">:(</span><span class="s2">&#34;Frank, the cat&#34;</span><span class="p">),</span><span class="w"> </span><span class="s2">&#34;post9&#34;</span><span class="p">:(</span><span class="s2">&#34;sushi rocks&#34;</span><span class="p">),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;post10&#34;</span><span class="p">:(</span><span class="s2">&#34;I love you, Mom&#34;</span><span class="p">),</span><span class="w"> </span><span class="s2">&#34;post11&#34;</span><span class="p">:(</span><span class="s2">&#34;Let&#39;s have a party!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">created_post</span><span class="p">(</span><span class="n">post_time</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player100&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post1&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-01-01 00:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player111&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post2&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2016-11-23 10:04:50&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player101&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post3&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-11-11 10:44:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player103&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post4&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2014-12-01 20:45:11&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player102&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post5&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2015-03-01 00:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player104&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post6&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2017-09-21 23:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player125&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post7&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2018-01-01 00:44:23&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player106&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post8&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-01-01 00:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player117&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post9&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2022-01-01 22:23:30&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player108&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post10&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2011-01-01 10:00:30&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player100&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post11&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-11-01 11:10:30&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">commented_at</span><span class="p">(</span><span class="n">post_time</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player105&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post1&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-01-02 00:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player109&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post1&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2016-11-24 10:04:50&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player113&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post3&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-11-13 10:44:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player101&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post4&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2014-12-04 20:45:11&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player102&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post1&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2015-03-03 00:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player103&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post1&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2017-09-23 23:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player102&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post7&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2018-01-04 00:44:23&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player101&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post8&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-01-04 00:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player106&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post9&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2022-01-02 22:23:30&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player105&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post10&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2011-01-11 10:00:30&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player130&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post1&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-01-02 00:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player131&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post2&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2016-11-24 10:04:50&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player131&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post3&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-11-13 10:44:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player133&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post4&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2014-12-04 20:45:11&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player132&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post5&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2015-03-03 00:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player134&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post6&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2017-09-23 23:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player135&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post7&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2018-01-04 00:44:23&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player136&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post8&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-01-04 00:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player137&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post9&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2022-01-02 22:23:30&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player138&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post10&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2011-01-11 10:00:30&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player141&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post1&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-01-03 00:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player142&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post2&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2016-11-25 10:04:50&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player143&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post3&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-11-14 10:44:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player144&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post4&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2014-12-05 20:45:11&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player145&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post5&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2015-03-04 00:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player146&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post6&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2017-09-24 23:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player147&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post7&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2018-01-05 00:44:23&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player148&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post8&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-01-05 00:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player139&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post9&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2022-01-03 22:23:30&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player140&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post10&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2011-01-12 10:01:30&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player141&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post1&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-01-04 00:34:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player102&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post2&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2016-11-26 10:06:50&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player103&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post3&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-11-15 10:45:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player104&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post4&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2014-12-06 20:47:11&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player105&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post5&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2015-03-05 00:32:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player106&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post6&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2017-09-25 23:31:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player107&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post7&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2018-01-06 00:46:23&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player118&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post8&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-01-06 00:35:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player119&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post9&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2022-01-04 22:26:30&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player110&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post10&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2011-01-15 10:00:30&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player111&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post1&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2019-01-06 00:30:06&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player104&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post11&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2022-01-15 10:00:30&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player125&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post11&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2022-02-15 10:00:30&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player113&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post11&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2022-03-15 10:00:30&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player102&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post11&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2022-04-15 10:00:30&#34;</span><span class="p">)),</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player108&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;post11&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2022-05-15 10:00:30&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">VERTEX</span><span class="w"> </span><span class="o">`</span><span class="n">address</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">address</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">geo_point</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_0&#34;</span><span class="p">:(</span><span class="s2">&#34;Brittany Forge Apt. 718 East Eric  WV 97881&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_1&#34;</span><span class="p">:(</span><span class="s2">&#34;Richard Curve Kingstad  AZ 05660&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_2&#34;</span><span class="p">:(</span><span class="s2">&#34;Schmidt Key Lake Charles  AL 36174&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">13</span><span class="p">.</span><span class="mi">13</span><span class="p">,</span><span class="o">-</span><span class="mi">87</span><span class="p">.</span><span class="mi">65</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_3&#34;</span><span class="p">:(</span><span class="s2">&#34;5 Joanna Key Suite 704 Frankshire  OK 03035&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_4&#34;</span><span class="p">:(</span><span class="s2">&#34;1 Payne Circle Mitchellfort  LA 73053&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_5&#34;</span><span class="p">:(</span><span class="s2">&#34;2 Klein Mission New Annetteton  HI 05775&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_6&#34;</span><span class="p">:(</span><span class="s2">&#34;1 Vanessa Stravenue Suite 184 Baileyville  NY 46381&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_7&#34;</span><span class="p">:(</span><span class="s2">&#34;John Garden Port John  LA 54602&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_8&#34;</span><span class="p">:(</span><span class="s2">&#34;11 Webb Groves Tiffanyside  MN 14566&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_9&#34;</span><span class="p">:(</span><span class="s2">&#34;70 Robinson Locks Suite 113 East Veronica  ND 87845&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_10&#34;</span><span class="p">:(</span><span class="s2">&#34;24 Mcknight Port Apt. 028 Sarahborough  MD 38195&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_11&#34;</span><span class="p">:(</span><span class="s2">&#34;0337 Mason Corner Apt. 900 Toddmouth  FL 61464&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_12&#34;</span><span class="p">:(</span><span class="s2">&#34;7 Davis Station Apt. 691 Pittmanfort  HI 29746&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_13&#34;</span><span class="p">:(</span><span class="s2">&#34;1 Southport Street Apt. 098 Westport  KY 85907&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">120</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="mi">30</span><span class="p">.</span><span class="mi">16</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_14&#34;</span><span class="p">:(</span><span class="s2">&#34;Weber Unions Eddieland  MT 64619&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">26</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_15&#34;</span><span class="p">:(</span><span class="s2">&#34;1 Amanda Freeway Lisaland  NJ 94933&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">28</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_16&#34;</span><span class="p">:(</span><span class="s2">&#34;2 Klein HI 05775&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_17&#34;</span><span class="p">:(</span><span class="s2">&#34;Schmidt Key Lake Charles AL 13617&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">13</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">87</span><span class="p">.</span><span class="mi">60</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_18&#34;</span><span class="p">:(</span><span class="s2">&#34;Rodriguez Track East Connorfort  NC 63144&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span><span class="mi">30</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">VERTEX</span><span class="w"> </span><span class="o">`</span><span class="n">place</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">geo_point</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;WV&#34;</span><span class="p">:(</span><span class="s2">&#34;West Virginia&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">.</span><span class="mi">5</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;AZ&#34;</span><span class="p">:(</span><span class="s2">&#34;Arizona&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">.</span><span class="mi">5</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;AL&#34;</span><span class="p">:(</span><span class="s2">&#34;Alabama&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">13</span><span class="p">.</span><span class="mi">13</span><span class="p">,</span><span class="o">-</span><span class="mi">87</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;OK&#34;</span><span class="p">:(</span><span class="s2">&#34;Oklahoma&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">.</span><span class="mi">1</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;LA&#34;</span><span class="p">:(</span><span class="s2">&#34;Louisiana&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">.</span><span class="mi">1</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;HI&#34;</span><span class="p">:(</span><span class="s2">&#34;Hawaii&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">.</span><span class="mi">1</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;NY&#34;</span><span class="p">:(</span><span class="s2">&#34;New York&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">.</span><span class="mi">1</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;MN&#34;</span><span class="p">:(</span><span class="s2">&#34;Minnesota&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">.</span><span class="mi">1</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;ND&#34;</span><span class="p">:(</span><span class="s2">&#34;North Dakota&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">.</span><span class="mi">1</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;FL&#34;</span><span class="p">:(</span><span class="s2">&#34;Florida&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">.</span><span class="mi">1</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;KY&#34;</span><span class="p">:(</span><span class="s2">&#34;Kentucky&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">120</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="mi">30</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;MT&#34;</span><span class="p">:(</span><span class="s2">&#34;Montana&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">26</span><span class="p">.</span><span class="mi">1</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;NJ&#34;</span><span class="p">:(</span><span class="s2">&#34;New Jersey&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">28</span><span class="p">.</span><span class="mi">1</span><span class="p">)),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;NC&#34;</span><span class="p">:(</span><span class="s2">&#34;North Carolina&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span><span class="mi">30</span><span class="p">.</span><span class="mi">1</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">belong_to</span><span class="o">`</span><span class="p">()</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_0&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;WV&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_1&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;AZ&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_2&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;AL&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_3&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;OK&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_4&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;LA&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_5&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;HI&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_6&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;NY&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_7&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;LA&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_8&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;MN&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_9&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;ND&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_10&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;MD&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_11&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;FL&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_12&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;HI&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_13&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;KY&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_14&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;MT&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_15&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;NJ&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_16&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;HI&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_17&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;AL&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_18&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;NC&#34;</span><span class="p">:();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">lived_in</span><span class="o">`</span><span class="p">()</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player100&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_4&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player101&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_7&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player102&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_2&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player103&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_3&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player104&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_0&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player105&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_5&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player106&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_6&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player107&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_1&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player108&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_8&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player109&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_9&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player110&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_10&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player111&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_11&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player112&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_12&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player113&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_13&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player114&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_14&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player115&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_15&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player116&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_16&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player117&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_17&#34;</span><span class="p">:(),</span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;player118&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_18&#34;</span><span class="p">:();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ•°æ®åˆæ¢" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e5%88%9d%e6%8e%a2" class="header-mark"></a>2.4 æ•°æ®åˆæ¢</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹çœ‹æ•°æ®ç»Ÿè®¡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="p">[</span><span class="n">basketballplayer</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">SUBMIT</span><span class="w"> </span><span class="n">JOB</span><span class="w"> </span><span class="n">STATS</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="k">New</span><span class="w"> </span><span class="n">Job</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">10</span><span class="w">         </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">[</span><span class="n">basketballplayer</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="n">STATS</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+----------------+-------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="k">Type</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Name</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="k">Count</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+----------------+-------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Tag&#34;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;address&#34;</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">19</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Tag&#34;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;place&#34;</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">14</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Tag&#34;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;player&#34;</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">51</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Tag&#34;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;post&#34;</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">10</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Tag&#34;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;team&#34;</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">30</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Edge&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;belong_to&#34;</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">19</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Edge&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;commented_at&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">40</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Edge&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;created_post&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">10</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Edge&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;follow&#34;</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">81</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Edge&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;lived_in&#34;</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">19</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Edge&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;serve&#34;</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">152</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Space&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;vertices&#34;</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">124</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Space&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;edges&#34;</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">321</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+----------------+-------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Got</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="p">(</span><span class="n">time</span><span class="w"> </span><span class="n">spent</span><span class="w"> </span><span class="mi">1038</span><span class="o">/</span><span class="mi">51372</span><span class="w"> </span><span class="n">us</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥ä¸€ä¸‹æ‰€æœ‰çš„æ•°æ®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">()</span><span class="o">-</span><span class="p">[</span><span class="n">e</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">()</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10000</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºæ•°æ®é‡å¤ªå°äº†ï¼Œæ‰€ä»¥å¯ä»¥æŠŠæ‰€æœ‰æ•°æ®åœ¨ NebulaGraph Explorer ä¸­æ¸²æŸ“å‡ºæ¥ï¼š</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/match_all.webp" title="match_all" data-thumbnail="/nebulagraph-sns/match_all.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/match_all.webp"
            srcset="/nebulagraph-sns/match_all.webp, /nebulagraph-sns/match_all.webp 1.5x, /nebulagraph-sns/match_all.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/match_all.webp">
    </a></figure></p>
<h2 id="æ‰¾å‡ºç½‘ç»œä¸­çš„å…³é”®äººç‰©" class="headerLink">
    <a href="#%e6%89%be%e5%87%ba%e7%bd%91%e7%bb%9c%e4%b8%ad%e7%9a%84%e5%85%b3%e9%94%ae%e4%ba%ba%e7%89%a9" class="header-mark"></a>3 æ‰¾å‡ºç½‘ç»œä¸­çš„å…³é”®äººç‰©</h2><p>è¯†åˆ«ç¤¾äº¤ç½‘ç»œä¸­çš„æœ‰å½±å“çš„å…³é”®äººç‰©ä»¬ï¼ˆinfluencersï¼‰æ¶‰åŠä½¿ç”¨å„ç§æŒ‡æ ‡å’Œæ–¹æ³•æ¥è¯†åˆ«åœ¨ç‰¹å®šç½‘ç»œä¸­æ‹¥æœ‰å¤§é‡å½±å“åŠ›çš„ä¸ªäººã€‚è¿™å¯¹å¾ˆå¤šä¸šåŠ¡åœºæ™¯éƒ½æœ‰å¸®åŠ©éƒ½å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ç”¨äºè¥é”€æˆ–ç ”ç©¶ç½‘ç»œä¸­çš„ä¿¡æ¯ä¼ æ’­ã€‚</p>
<p>è¯†åˆ«ä»–ä»¬çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå…·ä½“çš„æ–¹æ³•å’Œè€ƒé‡çš„ä¿¡æ¯ã€å…³ç³»ã€è§’åº¦ä¹Ÿå–å†³äºè¿™äº›å…³é”®äººç‰©çš„ç±»å‹ã€å’Œè·å–ä»–ä»¬çš„ç›®çš„ã€‚</p>
<p>ä¸€äº›å¸¸è§çš„æ–¹æ³•åŒ…æ‹¬çœ‹ä¸€ä¸ªäººæ‹¥æœ‰çš„ç²‰ä¸æˆ–å†…å®¹è¢«æ¶ˆè´¹çš„æ•°é‡ï¼Œä»–ä»¬åœ¨å…¶å¸–å­ã€è§†é¢‘ä¸Šè¯»è€…çš„å‚ä¸åº¦ï¼Œä»¥åŠä»–ä»¬çš„å†…å®¹çš„å½±å“åŠ›ï¼ˆè½¬å‘ã€å¼•ç”¨ï¼‰ã€‚è¿™äº›æ–¹æ³•åœ¨å›¾ä¸Šä¹Ÿæ˜¯å¯ä»¥åšçš„ï¼Œä½†æ˜¯æ¯”è¾ƒå¹³å‡¡ï¼Œæˆ‘å°±ä¸ä¸¾ä¾‹äº†ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥è¯•ç€ç”¨è¯„ä¼°ã€è®¡ç®—èŠ‚ç‚¹é‡è¦æ€§çš„å›¾ç®—æ³•ï¼Œåœ¨å›¾ä¸Šå¾—å‡ºè¿™äº›å…³é”®äººç‰©ã€‚</p>
<h3 id="pagerank" class="headerLink">
    <a href="#pagerank" class="header-mark"></a>3.1 PageRank</h3><p>PageRank æ˜¯ä¸€ä¸ªéå¸¸â€œå¤è€çš„â€å›¾ç®—æ³•ï¼Œå®ƒé€šè¿‡è€ƒè™‘å›¾ä¸Šç‚¹ä¹‹é—´çš„å…³ç³»æ•°é‡å»è¿­ä»£ï¼Œå¾—åˆ°æ¯ä¸€ä¸ªç‚¹çš„å¾—åˆ†ï¼ˆRankï¼‰ï¼Œæœ€åˆç”± Google çš„åˆ›å§‹äºº Larry Page å’Œ Sergey Brin æå‡ºå¹¶åº”ç”¨åœ¨æ—©æœŸçš„ Google æœç´¢å¼•æ“ä¸­ï¼Œç”¨æ¥æ’åºæœç´¢ç»“æœï¼Œè¿™é‡Œçš„ Page å¯ä»¥æ˜¯ Larry Page çš„å§“å’Œ Web Page çš„åŒå…³äº†ã€‚</p>
<p>åœ¨ç°ä»£ã€å¤æ‚çš„æœç´¢å¼•æ“ä¸­ï¼ŒPageRank æ—©å°±å› ä¸ºå…¶è¿‡äºç®€å•è€Œè¢«å¼ƒç”¨ï¼Œä½†æ˜¯åœ¨å…¶ä»–å›¾ç»“æ„ç½‘ç»œåœºæ™¯ä¸­ï¼ŒPageRank ä»ç„¶åœ¨å‘å…‰å‘çƒ­ï¼Œç¤¾äº¤ç½‘ç»œä¸­æˆ‘ä»¬å¯ä»¥ç²—ç•¥åœ°è®¤ä¸ºæ‰€æœ‰é“¾æ¥çš„é‡è¦ç¨‹åº¦ç±»ä¼¼ï¼Œå»è¿è¡Œè¿™ä¸ªç®—æ³•æ‰¾å‡ºé‚£äº›å…³é”®çš„ç”¨æˆ·ã€‚</p>
<p>åœ¨ NebulaGraph ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ NebulaGraph Algorithmã€NebulaGraph Analytics å»åœ¨å¤§çš„å…¨å›¾ä¸Šè¿è¡Œ PageRankï¼Œè€Œåœ¨æ—¥å¸¸çš„åˆ†æã€éªŒè¯ã€è®¾è®¡é˜¶æ®µï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨å…¨é‡æ•°æ®ä¸Šè·‘ç»“æœï¼Œè€Œåœ¨å¾ˆå°çš„å­å›¾ä¸Šï¼ˆæœ€å¤šä¸Šä¸‡ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åœ¨æµè§ˆå™¨é‡Œè¾¹è¿è¡Œå„ç§å›¾ç®—æ³•å»å¾—å‡ºçº¿ä¸Šä¸šåŠ¡å¯ä»¥ç”¨çš„æ–¹æ³•ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±ç”¨ NebulaGraph Explorer å†…ç½®çš„æµè§ˆå™¨å†…å›¾ç®—æ³•åŠŸèƒ½æ‰§è¡Œä¸€ä¸‹ PageRank çœ‹çœ‹ï¼ˆå…·ä½“æ–¹æ³•è¿™é‡Œç•¥å»ï¼Œå¯ä»¥å‚è€ƒ<a href="https://docs.nebula-graph.com.cn/3.3.0/nebula-explorer/graph-explorer/graph-algorithm/" target="_blank" rel="noopener noreferrer">æ–‡æ¡£</a>ï¼Œä¸è¿‡å…¶å®å°±æ˜¯ç‚¹ä¸€ä¸‹é¼ æ ‡çš„äº‹å„¿ï¼‰ï¼š</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/PageRank.webp" title="PageRank" data-thumbnail="/nebulagraph-sns/PageRank.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/PageRank.webp"
            srcset="/nebulagraph-sns/PageRank.webp, /nebulagraph-sns/PageRank.webp 1.5x, /nebulagraph-sns/PageRank.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/PageRank.webp">
    </a></figure></p>
<p>æˆ‘ä»¬å¯ä»¥ä»ä¸Šè¾¹çœ‹åˆ°ï¼ŒPageRank è®¡ç®—ä¹‹åæ‰€æœ‰ç»¿è‰²çš„ playerï¼ˆäººï¼‰ä¸­ï¼Œ&ldquo;player.name: Tim Duncan&rdquo; æ˜¯æœ€å¤§çš„ä¸€ä¸ªç‚¹ï¼Œä¸ä¹‹ç›¸å…³è”çš„å…³ç³»çœ‹èµ·æ¥çš„ç¡®ä¸å°‘ï¼Œæˆ‘ä»¬åœ¨å›¾ä¸Šé€‰æ‹©ä»–ï¼Œå†å³é”®åé€‰ï¼Œé€‰æ‹©é™¤äº† Tim Duncan ä¹‹å¤–çš„æ‰€æœ‰ç‚¹ï¼Œç”¨é€€æ ¼é”®åˆ é™¤æ‰€æœ‰å…¶ä»–çš„ç‚¹ï¼Œç„¶ååœ¨ä»–ä½œä¸ºèµ·ç‚¹åŒå‘æ¢ç´¢å‡º1åˆ°5æ­¥ï¼Œå¯ä»¥å¾—åˆ° Tim Duncan çš„å­å›¾ï¼š</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/TimDuncan.webp" title="TimDuncan" data-thumbnail="/nebulagraph-sns/TimDuncan.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/TimDuncan.webp"
            srcset="/nebulagraph-sns/TimDuncan.webp, /nebulagraph-sns/TimDuncan.webp 1.5x, /nebulagraph-sns/TimDuncan.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/TimDuncan.webp">
    </a></figure></p>
<p>ä»å­å›¾ä¸­å¯ä»¥çœ‹åˆ° Tim Duncan å’Œéå¸¸å¤šå…¶ä»–çƒå‘˜æœ‰å…³æ³¨çš„å…³ç³»çš„åŒæ—¶ï¼Œä¸€äº›å…¶ä»–å¾ˆå—æ¬¢è¿çš„é˜Ÿå‘˜å’Œä»–ä¸€èµ·ä¸€æ ·æœå½¹è¿‡éå¸¸çƒ­é—¨çš„çƒ­åˆºï¼ˆSpursï¼‰é˜Ÿï¼Œè¿™äº›éƒ½å°è¯äº† PageRank çš„è¯„ä¼°æ–¹å¼ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å†çœ‹çœ‹å…¶ä»–åˆ¤å®šç»´åº¦ä¸‹çš„ç®—æ³•ä¼šä¸ä¼šå¾—å‡ºä¸€æ ·çš„ç»“è®ºå‘¢ï¼Ÿ</p>
<h3 id="betweenness-centrality" class="headerLink">
    <a href="#betweenness-centrality" class="header-mark"></a>3.2 Betweenness Centrality</h3><p>ä½œä¸ºå¦ä¸€ä¸ªæµè¡Œçš„èŠ‚ç‚¹é‡è¦æ€§ç®—æ³•ï¼Œé€šè¿‡è®¡ç®—ä¸€ä¸ªèŠ‚ç‚¹å¯¹äºå›¾ä¸­çš„ä¸­ä»‹ã€æ¡¥æ¢ä½œç”¨æ¥è¡¡é‡èŠ‚ç‚¹çš„é‡è¦æ€§ï¼Œè¿™é‡Œçš„æ¡¥æ¢ä½œç”¨æ˜¯æœ‰æ•°å­¦å®šä¹‰çš„é‡åŒ–ç®—æ³•ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è¯´äº†ï¼Œä¸è¿‡ä»æ„Ÿå®˜ä¸Šå¯ä»¥çœ‹å‡ºå®ƒæ˜¯å¦ä¸€ä¸ªè§’åº¦å¾ˆç¬¦åˆç›´è§‰åœ°å»è¯„ä¼°é‡è¦æ€§çš„æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬é‡æ–°åœ¨ç”»å¸ƒä¸ŠæŸ¥è¯¢æ‰€æœ‰çš„ç‚¹è¾¹ä¹‹åï¼Œåœ¨æµè§ˆå™¨é‡Œè¿è¡Œ Betweenness Centrality ç®—æ³•ï¼Œè¿™æ¬¡çš„ç»“æœæ˜¯ï¼š</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/Betweeness_centrality.webp" title="Betweeness_centrality" data-thumbnail="/nebulagraph-sns/Betweeness_centrality.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/Betweeness_centrality.webp"
            srcset="/nebulagraph-sns/Betweeness_centrality.webp, /nebulagraph-sns/Betweeness_centrality.webp 1.5x, /nebulagraph-sns/Betweeness_centrality.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/Betweeness_centrality.webp">
    </a></figure></p>
<p>ä»å®ƒçš„äº”è·³å†…å­å›¾å¯ä»¥çœ‹å‡ºï¼Œä¸ä¹‹å‰ PageRank æ‰€å¾—çš„å…³é”®äººç‰© Tim Duncan å‘ˆç°çš„æ˜Ÿæ˜ŸçŠ¶æ€ä¸åŒï¼ŒDejounte Murray çš„å­å›¾å‘ˆç°ç°‡çŠ¶ï¼Œåœ¨æ„Ÿå®˜ã€ç›´è§‰ä¸Šå¯ä»¥æƒ³è±¡ Dejounte Murray çœŸçš„åœ¨å¾ˆå¤šèŠ‚ç‚¹ä¹‹é—´çš„æœ€å°è·¯å¾„çš„å¿…ç»ä¹‹è·¯ä¸Šï¼Œè€Œ Tim Duncan åˆ™ä¼¼ä¹å’Œæ›´å¤šçš„é‡è¦è¿æ¥è€…äº§ç”Ÿäº†å…³è”ã€‚</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/DejounteMurray.webp" title="DejounteMurray" data-thumbnail="/nebulagraph-sns/DejounteMurray.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/DejounteMurray.webp"
            srcset="/nebulagraph-sns/DejounteMurray.webp, /nebulagraph-sns/DejounteMurray.webp 1.5x, /nebulagraph-sns/DejounteMurray.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/DejounteMurray.webp">
    </a></figure></p>
<p>åœ¨å®é™…çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸è¦é€šè¿‡ä¸åŒæ–¹å¼çš„å®šä¹‰çš„ç†è§£ã€ä¸åŒæ‰§è¡Œç»“æœçš„è¯•éªŒã€åˆ†æå»æ‰¾åˆ°æˆ‘ä»¬å…³æ³¨çš„å…³é”®äººç‰©äº§ç”Ÿå½±å“çš„ç»“æ„ç‰¹å¾ï¼Œç”¨æ¥é’ˆå¯¹ä¸åŒéœ€æ±‚é€‰æ‹©ä¸åŒçš„ç®—æ³•ã€‚</p>
<h2 id="æ‰¾å‡ºç¤¾åŒºèšé›†ç¾¤ä½“" class="headerLink">
    <a href="#%e6%89%be%e5%87%ba%e7%a4%be%e5%8c%ba%e8%81%9a%e9%9b%86%e7%be%a4%e4%bd%93" class="header-mark"></a>4 æ‰¾å‡ºç¤¾åŒºã€èšé›†ç¾¤ä½“</h2><p>ç¤¾äº¤ç½‘ç»œä¸­çš„ç¤¾åŒºæ£€æµ‹æ˜¯ä¸€ç§é€šè¿‡åˆ†æç¤¾äº¤å…³ç³»æ¥å‘ç°ç¤¾åŒºç»“æ„çš„æŠ€æœ¯ã€‚ç¤¾åŒºç»“æ„æ˜¯æŒ‡åœ¨ç¤¾äº¤ç½‘ç»œã€å›¾è°±ä¸­ç›¸äº’è”ç³»å¯†åˆ‡çš„ä¸€ç»„èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹é€šå¸¸å…·æœ‰ç›¸ä¼¼çš„ç‰¹å¾æˆ–å…´è¶£ã€‚ä¾‹å¦‚ï¼Œç¤¾åŒºç»“æ„å¯èƒ½è¡¨ç°ä¸ºç”¨æˆ·æ ¹æ®å…±åŒçš„è¯é¢˜æˆ–å…´è¶£èšé›†åœ¨ä¸€èµ·çš„ä¸€ç»„ç”¨æˆ·ã€‚</p>
<p>ç¤¾åŒºæ£€æµ‹çš„ç›®çš„æ˜¯é€šè¿‡å¯¹ç¤¾äº¤ç½‘ç»œè¿›è¡Œåˆ†æï¼Œæ‰¾å‡ºä¸åŒç¤¾åŒºçš„è¾¹ç•Œï¼Œå¹¶ç¡®å®šæ¯ä¸ªç¤¾åŒºä¸­çš„èŠ‚ç‚¹ã€‚è¿™ä¸€è¿‡ç¨‹å¯ä»¥é€šè¿‡ä½¿ç”¨å„ç§ç®—æ³•æ¥å®Œæˆï¼Œä¾‹å¦‚æ ‡ç­¾ä¼ æ’­ç®—æ³•ã€å¼±è”é€šåˆ†é‡ç®—æ³•å’Œ Louvain ç®—æ³•ç­‰ã€‚é€šè¿‡å‘ç°ç¤¾åŒºç»“æ„ï¼Œå¯ä»¥æ›´å¥½åœ°äº†è§£ç¤¾äº¤ç½‘ç»œçš„ç»“æ„å’Œç‰¹å¾ï¼Œå¹¶æœ‰åŠ©äºç¤¾äº¤ç½‘ç»œæœåŠ¡æä¾›æ–¹æ›´å¥½åœ°æ¨æ–­å’Œé¢„æµ‹ç¤¾äº¤ç½‘ç»œä¸­çš„è¡Œä¸ºï¼Œå¸®åŠ©åšå¥½ç¤¾äº¤ç½‘ç»œçš„æ²»ç†ã€å¹¿å‘ŠæŠ•æ”¾ã€å¸‚åœºè¥é”€ç­‰ã€‚</p>
<p>ç”±äºæˆ‘ä»¬çš„æ•°æ®é›†æ˜¯éçœŸå®çš„ï¼Œæˆ‘åœ¨ä¸åŒçš„ç®—æ³•ä¹‹ä¸‹å¾—å‡ºçš„ç»“æœå¹¶ä¸èƒ½å±•ç°å‡ºçœŸå®çš„æ„æ¶µï¼Œæ‰€ä»¥æœ¬ç« åªæ˜¯å±•ç¤ºä¸€ä¸‹åˆ©ç”¨å‡ ä¸ªå›¾ç®—æ³•è¿›è¡Œç¤¾åŒºè¯†åˆ«ä¹‹åçš„ç»“æœï¼Œåœ¨çœŸå®ä¸–ç•Œçš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿˜åº”è¯¥åœ¨æ­¤åŸºç¡€ä¹‹ä¸Šåˆ©ç”¨é¢†åŸŸçŸ¥è¯†æˆ–è€…å…¶ä»–æŠ€æœ¯æ‰‹æ®µååŒç»™å‡ºä¸åŒç¾¤ä½“ã€ç¤¾åŒºçš„ç”»åƒã€æ ‡ç­¾ã€‚</p>
<p>æ ‡ç­¾ä¼ æ’­ç®—æ³•æ•ˆæœï¼š</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/LPA.webp" title="LPA" data-thumbnail="/nebulagraph-sns/LPA.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/LPA.webp"
            srcset="/nebulagraph-sns/LPA.webp, /nebulagraph-sns/LPA.webp 1.5x, /nebulagraph-sns/LPA.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/LPA.webp">
    </a></figure></p>
<p>Louvain ç®—æ³•æ•ˆæœï¼š</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/Louvain.webp" title="Louvain" data-thumbnail="/nebulagraph-sns/Louvain.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/Louvain.webp"
            srcset="/nebulagraph-sns/Louvain.webp, /nebulagraph-sns/Louvain.webp 1.5x, /nebulagraph-sns/Louvain.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/Louvain.webp">
    </a></figure></p>
<p>å¼±è”é€šåˆ†é‡ç®—æ³•æ•ˆæœï¼š</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/WCC.webp" title="WCC" data-thumbnail="/nebulagraph-sns/WCC.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/WCC.webp"
            srcset="/nebulagraph-sns/WCC.webp, /nebulagraph-sns/WCC.webp 1.5x, /nebulagraph-sns/WCC.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/WCC.webp">
    </a></figure></p>
<p>åœ¨åè¾¹çš„ç« èŠ‚ï¼Œæˆ‘ä»¬æœ‰æœºä¼šå¯ä»¥åœ¨æ›´å°ã€æ›´ç®€å•çš„å­å›¾ä¸Šå†æ¬¡éªŒè¯è¿™å‡ ä¸ªç®—æ³•ï¼Œç»“æœä¼šæ›´æœ‰å¯è§£é‡Šæ€§ä¸€äº›ã€‚</p>
<h2 id="å¥½å‹äº²å¯†åº¦" class="headerLink">
    <a href="#%e5%a5%bd%e5%8f%8b%e4%ba%b2%e5%af%86%e5%ba%a6" class="header-mark"></a>5 å¥½å‹äº²å¯†åº¦</h2><p>é€šè¿‡ç¤¾åŒºè¯†åˆ«ç®—æ³•ï¼Œå…¶å®æ˜¯èƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼Œåœ¨å…¨å±€è®¡ç®—è·å¾—å…´è¶£ç›¸è¿‘ã€å…³è”ç´§å¯†çš„å¥½å‹çš„ã€‚é‚£ä¹ˆå¦‚ä½•è·å¾—ä¸€ä¸ªç»™å®šç”¨æˆ·çš„å…¶ä»–äº²å¯†å¥½å‹å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¡ç®—è¿™ä¸ªç”¨æˆ·çš„å¥½å‹ä¸­ï¼Œå’Œä»–å…±åŒå¥½å‹çš„ä¸ªæ•°æ¥æ’åºè·å¾—è¿™ä¸€ä¿¡æ¯ï¼</p>
<p>æˆ‘ä»¬æ‹¿ &ldquo;Tim Duncan&rdquo; ä¸¾ä¾‹ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œä»–çš„ä¸¤åº¦å¥½å‹ï¼ˆå¥½å‹çš„å¥½å‹ï¼š<code>(:player{name: &quot;Tim Duncan&quot;})-[:follow]-(f:player)-[:follow]-(fof:player)</code>ï¼‰å¦‚æœåŒæ—¶ä¹Ÿæ˜¯ä»–çš„å¥½å‹çš„è¯ï¼Œé‚£ä¹ˆä»–ä»¬è¿™ä¸ªä¸­é—´çš„å¥½å‹å°±æ˜¯ä»–å’Œè¿™ä¸ªæœ‹å‹çš„å…±åŒå¥½å‹ï¼ˆMutual Friendï¼‰ï¼Œé‚£ä¹ˆæœ‰ç†ç”±ç›¸ä¿¡é‚£äº›å’Œ Tim Duncan æœ‰æ›´å¤šå…±åŒå¥½å‹çš„äººå¯èƒ½è·Ÿä»–æœ‰æ›´é«˜äº²å¯†åº¦ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">start</span><span class="p">:</span><span class="o">`</span><span class="n">player</span><span class="o">`</span><span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Tim Duncan&#34;</span><span class="err">}</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="o">`</span><span class="n">player</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">fof</span><span class="p">:</span><span class="o">`</span><span class="n">player</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="n">start</span><span class="p">:</span><span class="o">`</span><span class="n">player</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">fof</span><span class="p">:</span><span class="o">`</span><span class="n">player</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">fof</span><span class="p">.</span><span class="o">`</span><span class="n">player</span><span class="o">`</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NrOfMutualF</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">NrOfMutualF</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªè®¡ç®—ç»“æœæ˜¯ï¼Œ&ldquo;Tony Parker&rdquo; å’Œ Tim æœ‰ 5 ä¸ªå…±åŒå¥½å‹ï¼Œæœ€ä¸ºäº²å¯†ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">fof.player.name</th>
<th style="text-align:left">NrOfMutualF</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Tony Parker</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left">Dejounte Murray</td>
<td style="text-align:left">4</td>
</tr>
<tr>
<td style="text-align:left">Manu Ginobili</td>
<td style="text-align:left">3</td>
</tr>
<tr>
<td style="text-align:left">Marco Belinelli</td>
<td style="text-align:left">3</td>
</tr>
<tr>
<td style="text-align:left">Danny Green</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">Boris Diaw</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">LaMarcus Aldridge</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">Tiago Splitter</td>
<td style="text-align:left">1</td>
</tr>
</tbody>
</table>
<p>ä¸‹é¢ï¼Œå’±ä»¬é€šè¿‡å¯è§†åŒ–æ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªç»“æœå§ï¼</p>
<p>å…ˆçœ‹çœ‹æ¯ä¸€ä¸ªå¥½å‹çš„å…±åŒå¥½å‹(f:)éƒ½æ˜¯è°ï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">start</span><span class="p">:</span><span class="n">player</span><span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Tim Duncan&#34;</span><span class="err">}</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">fof</span><span class="p">:</span><span class="n">player</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="n">start</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">fof</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">fof</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">fof.player.name</th>
<th style="text-align:left">collect(distinct f.player.name)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Boris Diaw</td>
<td style="text-align:left">[&ldquo;Tony Parker&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Manu Ginobili</td>
<td style="text-align:left">[&ldquo;Dejounte Murray&rdquo;, &ldquo;Tiago Splitter&rdquo;, &ldquo;Tony Parker&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">LaMarcus Aldridge</td>
<td style="text-align:left">[&ldquo;Tony Parker&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Tiago Splitter</td>
<td style="text-align:left">[&ldquo;Manu Ginobili&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Tony Parker</td>
<td style="text-align:left">[&ldquo;Dejounte Murray&rdquo;, &ldquo;Boris Diaw&rdquo;, &ldquo;Manu Ginobili&rdquo;, &ldquo;Marco Belinelli&rdquo;, &ldquo;LaMarcus Aldridge&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Dejounte Murray</td>
<td style="text-align:left">[&ldquo;Danny Green&rdquo;, &ldquo;Tony Parker&rdquo;, &ldquo;Manu Ginobili&rdquo;, &ldquo;Marco Belinelli&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Danny Green</td>
<td style="text-align:left">[&ldquo;Dejounte Murray&rdquo;, &ldquo;Marco Belinelli&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Marco Belinelli</td>
<td style="text-align:left">[&ldquo;Dejounte Murray&rdquo;, &ldquo;Danny Green&rdquo;, &ldquo;Tony Parker&rdquo;]</td>
</tr>
</tbody>
</table>
<p>ç„¶åæˆ‘ä»¬åœ¨ Explorer ä¸Šå¯è§†åŒ–ä¸€ä¸‹è¿™ä¸ªç»“æœï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠ Tim çš„é‡åº¦å¥½å‹è·¯å¾„å…¨æŸ¥å‡ºæ¥</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">start</span><span class="p">:</span><span class="n">player</span><span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Tim Duncan&#34;</span><span class="err">}</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">follow</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">fof</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç„¶åæˆ‘ä»¬åœ¨å…¶ä¸­æŒ‰ç…§åº¦å»æ¸²æŸ“èŠ‚ç‚¹å¤§å°ï¼Œå¹¶é€‰ä¸­ Tim å’Œ Tonyï¼Œå¹¶åœ¨ä¸¤è€…ä¹‹é—´æŸ¥è¯¢ follow ç±»å‹è¾¹ã€åŒå‘ã€æœ€å¤š 2 è·³çš„å…¨éƒ¨è·¯å¾„ï¼š</li>
</ul>
<p>å¯ä»¥çœ‹å‡ºä»–ä»¬ä¹‹é—´æ˜¯æœ€äº²å¯†çš„æœ‹å‹æ²¡è·‘äº†ï¼Œè€Œä¸”ä»–ä»¬çš„å…±åŒå¥½å‹ä¹Ÿåœ¨è·¯å¾„ä¹‹ä¸­ï¼š</p>
<p><code>[&quot;Dejounte Murray&quot;, &quot;Boris Diaw&quot;, &quot;Manu Ginobili&quot;, &quot;Marco Belinelli&quot;, &quot;LaMarcus Aldridge&quot;]</code></p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/closest_friend.webp" title="closest_friend" data-thumbnail="/nebulagraph-sns/closest_friend.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/closest_friend.webp"
            srcset="/nebulagraph-sns/closest_friend.webp, /nebulagraph-sns/closest_friend.webp 1.5x, /nebulagraph-sns/closest_friend.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/closest_friend.webp">
    </a></figure></p>
<h3 id="æœ‹å‹åœˆå­é‡Œçš„å°ç¾¤ä½“" class="headerLink">
    <a href="#%e6%9c%8b%e5%8f%8b%e5%9c%88%e5%ad%90%e9%87%8c%e7%9a%84%e5%b0%8f%e7%be%a4%e4%bd%93" class="header-mark"></a>5.1 æœ‹å‹åœˆå­é‡Œçš„å°ç¾¤ä½“</h3><p>è¿™æ—¶å€™ï¼Œå¦‚å‰è¾¹æåˆ°ï¼Œè¿™ä»½æ•°æ®é›†æœ¬èº«çš„éçœŸå®æ€§ï¼Œä½¿å¾—ç¤¾åŒºå‘ç°ç®—æ³•çš„ç»“æœä¸èƒ½å¾—åˆ°å…¶ä¸­æ´å¯Ÿçš„å†…æ¶µï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥æ¥ç€è¿™ä¸ªå°çš„å­å›¾ï¼Œçœ‹çœ‹ Tim çš„å¥½å‹ä¸­å¯ä»¥å¦‚ä½•åŒºåˆ†ç¾¤ç»„ã€ç¤¾åŒºå‘¢ï¼Œå’±ä»¬è·‘ä¸€ä¸ª Louvain ã€å¼±è”é€šåˆ†é‡ã€æ ‡ç­¾ä¼ æ’­çœ‹çœ‹ï¼š</p>
<ul>
<li>å¼±è”é€šåˆ†é‡ï¼Œå¯ä»¥æŠŠ Tim ç­‰æœ‹å‹ä»¬å¤§ä½“åˆ†å‰²å‡ºä¸¤ä¸‰ä¸ªç›¸äº’ä¸è¿é€šçš„éƒ¨åˆ†ï¼Œéå¸¸ç¬¦åˆè¿é€šåˆ†é‡çš„ç›´è§‚ç†è§£å’Œå®šä¹‰ã€‚</li>
</ul>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/Tim_wcc.webp" title="Tim_wcc" data-thumbnail="/nebulagraph-sns/Tim_wcc.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/Tim_wcc.webp"
            srcset="/nebulagraph-sns/Tim_wcc.webp, /nebulagraph-sns/Tim_wcc.webp 1.5x, /nebulagraph-sns/Tim_wcc.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/Tim_wcc.webp">
    </a></figure></p>
<ul>
<li>
<p>æ ‡ç­¾ä¼ æ’­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶è¿­ä»£æ¬¡æ•°æŒ‰éœ€å»é€šè¿‡éšæœºçš„ä¼ æ’­åˆ’å®šå‡ºä¸åŒçš„åˆ’åˆ†åº¦ï¼Œç»“æœå¯ä»¥æœ‰ä¸€å®šçš„åŒºåˆ†åº¦ï¼š</p>
<p>20 æ¬¡è¿­ä»£</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/Tim_LPA.webp" title="Tim_LPA" data-thumbnail="/nebulagraph-sns/Tim_LPA.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/Tim_LPA.webp"
            srcset="/nebulagraph-sns/Tim_LPA.webp, /nebulagraph-sns/Tim_LPA.webp 1.5x, /nebulagraph-sns/Tim_LPA.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/Tim_LPA.webp">
    </a></figure></p>
<p>1000 æ¬¡è¿­ä»£</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/Tim_LPA_1000.webp" title="Tim_LPA_1000" data-thumbnail="/nebulagraph-sns/Tim_LPA_1000.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/Tim_LPA_1000.webp"
            srcset="/nebulagraph-sns/Tim_LPA_1000.webp, /nebulagraph-sns/Tim_LPA_1000.webp 1.5x, /nebulagraph-sns/Tim_LPA_1000.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/Tim_LPA_1000.webp">
    </a></figure></p>
</li>
<li>
<p>Louvainï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒé«˜æ•ˆã€ç¨³å®šçš„ç®—æ³•ï¼ŒåŸºæœ¬ä¸Šåœ¨è¿™ä¸ªå­å›¾ä¸‹æˆ‘ä»¬å¯ä»¥åœ¨å¾ˆå°çš„è¿­ä»£æ¬¡æ•°ä¸‹å¾—åˆ°å¾ˆç¬¦åˆç›´è§‰çš„åˆ’åˆ†ï¼š</p>
</li>
</ul>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/Tim_Louvain.webp" title="Tim_Louvain" data-thumbnail="/nebulagraph-sns/Tim_Louvain.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/Tim_Louvain.webp"
            srcset="/nebulagraph-sns/Tim_Louvain.webp, /nebulagraph-sns/Tim_Louvain.webp 1.5x, /nebulagraph-sns/Tim_Louvain.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/Tim_Louvain.webp">
    </a></figure></p>
<h2 id="æ–°æœ‹å‹æ¨è" class="headerLink">
    <a href="#%e6%96%b0%e6%9c%8b%e5%8f%8b%e6%8e%a8%e8%8d%90" class="header-mark"></a>6 æ–°æœ‹å‹æ¨è</h2><p>æ¥ç€å‰è¾¹äºŒåº¦æœ‹å‹ï¼ˆæœ‹å‹çš„æœ‹å‹ï¼‰çš„æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“æŠŠé‚£äº›è¿˜ä¸æ˜¯æœ‹å‹çš„äºŒåº¦æœ‹å‹ä½œä¸ºæ¨èæ·»åŠ çš„å¥½å‹ï¼Œè€Œæ’åºè§„åˆ™åˆ™æ˜¯ä»–ä»¬ä¹‹é—´çš„å…±åŒå¥½å‹æ•°é‡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">start</span><span class="p">:</span><span class="n">player</span><span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Tim Duncan&#34;</span><span class="err">}</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">fof</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="p">(</span><span class="n">start</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">fof</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">fof</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">start</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">fof</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NrOfMutualF</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">NrOfMutualF</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th style="text-align:left">fof.player.name</th>
<th style="text-align:left">NrOfMutualF</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">LeBron James</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">James Harden</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">Chris Paul</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">Yao Ming</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">Damian Lillard</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">JaVale McGee</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">Kevin Durant</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">Kyle Anderson</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">Rudy Gay</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">Russell Westbrook</td>
<td style="text-align:left">1</td>
</tr>
</tbody>
</table>
<p>æ˜¾ç„¶ï¼ŒLeBron æœ€å€¼å¾—æ¨èï¼å†çœ‹çœ‹è¿™äº›å…±åŒå¥½å‹éƒ½æ˜¯è°ï¼Ÿ</p>
<table>
<thead>
<tr>
<th style="text-align:left">fof.player.name</th>
<th style="text-align:left">collect(distinct f.player.name)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">James Harden</td>
<td style="text-align:left">[&ldquo;Dejounte Murray&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">LeBron James</td>
<td style="text-align:left">[&ldquo;Danny Green&rdquo;, &ldquo;Dejounte Murray&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Chris Paul</td>
<td style="text-align:left">[&ldquo;Dejounte Murray&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Yao Ming</td>
<td style="text-align:left">[&ldquo;Shaquille O&rsquo;Neal&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Damian Lillard</td>
<td style="text-align:left">[&ldquo;LaMarcus Aldridge&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">JaVale McGee</td>
<td style="text-align:left">[&ldquo;Shaquille O&rsquo;Neal&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Kevin Durant</td>
<td style="text-align:left">[&ldquo;Dejounte Murray&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Kyle Anderson</td>
<td style="text-align:left">[&ldquo;Dejounte Murray&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Rudy Gay</td>
<td style="text-align:left">[&ldquo;LaMarcus Aldridge&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Russell Westbrook</td>
<td style="text-align:left">[&ldquo;Dejounte Murray&rdquo;]</td>
</tr>
</tbody>
</table>
<p>åŒæ ·ï¼Œæˆ‘ä»¬åœ¨åˆšæ‰çš„å­å›¾é‡Œæ‰¾æ‰¾ LeBron James å§ï¼æˆ‘ä»¬æŠŠå®ƒä¿©ä¹‹é—´çš„ä¸¤æ­¥ã€åŒå‘è·¯å¾„æ‰¾å‡ºæ¥ï¼Œæœç„¶åªä¼šç»è¿‡ <code>[&quot;Danny Green&quot;, &quot;Dejounte Murray&quot;]</code> å¹¶ä¸”ï¼Œæ²¡æœ‰ç›´æ¥çš„è¿æ¥ï¼š</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/Tim_newFriend.webp" title="Tim_newFriend" data-thumbnail="/nebulagraph-sns/Tim_newFriend.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/Tim_newFriend.webp"
            srcset="/nebulagraph-sns/Tim_newFriend.webp, /nebulagraph-sns/Tim_newFriend.webp 1.5x, /nebulagraph-sns/Tim_newFriend.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/Tim_newFriend.webp">
    </a></figure></p>
<p>ç°åœ¨ï¼Œç³»ç»Ÿä¼šç»™ä¸¤è¾¹å‘æé†’ï¼šâ€œheyï¼Œä¹Ÿè®¸ä½ ä»¬åº”è¯¥äº¤ä¸ªæœ‹å‹ï¼â€</p>
<h2 id="å…±åŒé‚»å±…" class="headerLink">
    <a href="#%e5%85%b1%e5%90%8c%e9%82%bb%e5%b1%85" class="header-mark"></a>7 å…±åŒé‚»å±…</h2><p>æŸ¥æ‰¾å…±åŒé‚»å±…æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„å›¾åº“æŸ¥è¯¢ï¼Œå®ƒçš„åœºæ™¯å¯èƒ½æ ¹æ®ä¸åŒçš„é‚»å±…å…³ç³»ï¼ŒèŠ‚ç‚¹ç±»å‹ï¼ŒåŒæ„ã€å¼‚æ„ï¼Œå¸¦æ¥ä¸åŒçš„åœºæ™¯ï¼Œå‰è¾¹ä¸¤ä¸ªåœºæ™¯ä¸‹çš„å…±åŒå¥½å‹æœ¬è´¨ä¸Šæ˜¯ä¸¤ç‚¹ä¹‹é—´çš„å…±åŒé‚»å±…ï¼Œç›´æ¥æŸ¥è¯¢è¿™æ ·çš„å…³ç³»ç”¨ OpenCypher çš„è¡¨è¾¾éå¸¸ç®€å•ã€‚</p>
<h3 id="ä¸¤ç‚¹ä¹‹é—´çš„å…±åŒé‚»å±…" class="headerLink">
    <a href="#%e4%b8%a4%e7%82%b9%e4%b9%8b%e9%97%b4%e7%9a%84%e5%85%b1%e5%90%8c%e9%82%bb%e5%b1%85" class="header-mark"></a>7.1 ä¸¤ç‚¹ä¹‹é—´çš„å…±åŒé‚»å±…</h3><p>æ¯”å¦‚è¿™ä¸ªè¡¨è¾¾å¯ä»¥æŸ¥è¯¢ä¸¤ä¸ªç”¨æˆ·ä¹‹é—´çš„å…±æ€§ã€äº¤é›†ï¼Œç»“æœå¯èƒ½æ˜¯å…±åŒå›¢é˜Ÿã€å»è¿‡çš„åœ°æ–¹ã€å…´è¶£çˆ±å¥½ã€å…±åŒå‚ä¸çš„å¸–å­å›å¤ç­‰ç­‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">v0</span><span class="o">`</span><span class="p">)</span><span class="o">--</span><span class="p">()</span><span class="o">--</span><span class="p">(</span><span class="o">`</span><span class="n">v1</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="o">`</span><span class="n">v0</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;player100&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="o">`</span><span class="n">v1</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;player104&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è€Œé™å®šäº†è¾¹çš„ç±»å‹ä¹‹åï¼Œè¿™ä¸ªæŸ¥è¯¢å°±é™å®šåœ¨å…±åŒå¥½å‹çš„æŸ¥è¯¢äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">v0</span><span class="p">)</span><span class="o">--</span><span class="p">(:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">)</span><span class="o">--</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;player100&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;player104&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¤šç‚¹ä¹‹é—´çš„å…±åŒé‚»å±…å†…å®¹æ¨é€" class="headerLink">
    <a href="#%e5%a4%9a%e7%82%b9%e4%b9%8b%e9%97%b4%e7%9a%84%e5%85%b1%e5%90%8c%e9%82%bb%e5%b1%85%e5%86%85%e5%ae%b9%e6%8e%a8%e9%80%81" class="header-mark"></a>7.2 å¤šç‚¹ä¹‹é—´çš„å…±åŒé‚»å±…ï¼šå†…å®¹æ¨é€</h3><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ç»™å‡ºä¸€ä¸ªå¤šç‚¹å…±åŒé‚»å±…çš„åœºæ™¯ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªæ–‡ç« è§¦å‘ï¼ŒæŸ¥å‡ºæ‰€æœ‰åœ¨è¿™ä¸ªæ–‡ç« ä¸Šæœ‰äº’åŠ¨çš„ç”¨æˆ·ï¼Œæ‰¾åˆ°è¿™ä¸€ç¾¤ä½“ä¸­çš„å…±åŒé‚»å±…ã€‚</p>
<p>è¿™ä¸ªå…±åŒé‚»å±…æœ‰ä»€ä¹ˆç”¨å¤„å‘¢ï¼Ÿå¾ˆè‡ªç„¶ï¼Œå¦‚æœè¿™ä¸ªå…±åŒé‚»å±…è¿˜æ²¡æœ‰å’Œè¿™ä¸ªæ–‡ç« æœ‰ä»»ä½•äº¤äº’ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªæ–‡ç« æ¨èç»™ä»–ã€‚</p>
<p>è¿™ä¸ªæŸ¥è¯¢çš„å®ç°å¾ˆæœ‰æ„æ€ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ª MATCH æ˜¯æŸ¥åˆ°æ‰€æœ‰ post11 æ–‡ç« ä¸‹ç•™è¨€å’Œä½œè€…è¿™äº›äººçš„æ€»äººæ•°</li>
<li>åœ¨ç¬¬äºŒä¸ª MATCH ä¹‹åï¼Œæˆ‘ä»¬æŸ¥åˆ°æ‰€æœ‰è¿™ç¾¤äººçš„ä¸€åº¦å¥½å‹è·¯å¾„ä¸­ï¼Œè¿™äº›æ–‡ç« è¿‡çš„äº¤äº’ç”¨æˆ·çš„ä¸€åº¦å¥½å‹çš„å‚ä¸è¿‡æ–‡ç« çš„æœ‹å‹æ•°é‡åˆšå¥½ç­‰äºè¿™ä¸ªå‚ä¸æ–‡ç« çš„ç”¨æˆ·çš„æ•°é‡çš„è¿™äº›äººï¼Œä»–ä»¬å…¶å®å°±æ˜¯è¿™äº›æ‰€æœ‰å‚ä¸ç”¨æˆ·çš„å…±åŒå¥½å‹ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">blog</span><span class="p">:</span><span class="n">post</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="n">e</span><span class="p">]</span><span class="o">-</span><span class="p">(:</span><span class="n">player</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">blog</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;post11&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">blog</span><span class="p">,</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">invoved_user_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">blog</span><span class="p">:</span><span class="n">post</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[]</span><span class="o">-</span><span class="p">(</span><span class="n">users</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">common_neighbor</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="nf">toSet</span><span class="p">(</span><span class="nf">collect</span><span class="p">(</span><span class="n">users</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">common_neighbor</span><span class="p">,</span><span class="w"> </span><span class="n">invoved_user_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="n">users</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">invoved_user_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">common_neighbor</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è€Œè¿™ä¸ªäººå°±æ˜¯&hellip;Tonyï¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">+-----------------------------------------------------+
</span></span><span class="line"><span class="cl">| common_neighbor                                     |
</span></span><span class="line"><span class="cl">+-----------------------------------------------------+
</span></span><span class="line"><span class="cl">| (&#34;player101&#34; :player{age: 36, name: &#34;Tony Parker&#34;}) |
</span></span><span class="line"><span class="cl">+-----------------------------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>è€Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ¨å¯è§†åŒ–ä¸­å›½éªŒè¯å®ƒï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">blog</span><span class="p">:</span><span class="n">post</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[]</span><span class="o">-</span><span class="p">(</span><span class="n">users</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">common_neighbor</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">blog</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;post11&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ¸²æŸ“è¿™ä¸ªæŸ¥è¯¢ç»“æœï¼Œç„¶åå†è¿™ç¯‡å«åš &ldquo;Let&rsquo;s have a party!&rdquo; çš„æ–‡ç« ä¸ Tony ä¹‹é—´æŸ¥æ‰¾è¯„è®ºã€poæ–‡ã€å…³æ³¨ä¸‰ç±»è¾¹çš„åŒå‘ã€ä¸¤è·³æŸ¥è¯¢ï¼Œå°±å¯ä»¥çœ‹åˆ°è¿™äº›å‚ä¸æ–‡ç« çš„äººä»¬æ— ä¸€ä¾‹å¤–ï¼Œéƒ½æ˜¯ Tony çš„å¥½å‹ï¼Œè€Œåªæœ‰ Tony è‡ªå·±è¿˜æ²¡å»æ–‡ç« é‡Œç•™è¨€ï¼</p>
<p>è€Œ Party æ€ä¹ˆå¯ä»¥å°‘äº† Tony å‘¢ï¼Ÿéš¾é“æ˜¯ä»–çš„æƒŠå–œç”Ÿæ—¥ Partyï¼ŒOppsï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯ä¸åº”è¯¥å‘Šè¯‰ä»–ï¼Ÿ</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/common_nbrs_tony.webp" title="common_nbrs_tony" data-thumbnail="/nebulagraph-sns/common_nbrs_tony.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/common_nbrs_tony.webp"
            srcset="/nebulagraph-sns/common_nbrs_tony.webp, /nebulagraph-sns/common_nbrs_tony.webp 1.5x, /nebulagraph-sns/common_nbrs_tony.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/common_nbrs_tony.webp">
    </a></figure></p>
<h2 id="ä¿¡æ¯æµ" class="headerLink">
    <a href="#%e4%bf%a1%e6%81%af%e6%b5%81" class="header-mark"></a>8 ä¿¡æ¯æµ</h2><p>æˆ‘åœ¨ä¹‹å‰å†™è¿‡åŸºäºå›¾æŠ€æœ¯çš„æ¨èç³»ç»Ÿå®ç°æ–¹æ³•ï¼Œå…¶ä¸­æè¿°äº†ç°ä»£æ¨èç³»ç»Ÿä¸­å†…å®¹è¿‡æ»¤ã€æ’åºæ–¹æ³•å¯ä»¥åœ¨å›¾è°±ä¸Šè¿›è¡Œï¼Œç¤¾äº¤ç½‘ç»œä¸­æœ‰ä¸€ç‚¹ç›¸ä¼¼ä½†åˆä¸åŒçš„åœºæ™¯æ˜¯ä¿¡æ¯æµï¼ˆFeedï¼‰ï¼Œå®ƒçš„äº§ç”Ÿç±»ä¼¼äºæ¨èç³»ç»Ÿä¸­çš„ä¸ªæ€§åŒ–ï¼ŒåŒæ—¶æœ‰å…·æœ‰å¾ˆé«˜çš„æ—¶æ•ˆæ€§ï¼Œå€ŸåŠ©äºåŒ…å«äº†å†…å®¹è¡Œä¸ºçŸ¥è¯†çš„ç¤¾äº¤å›¾è°±å¯ä»¥å¾ˆç›´è§‚ã€é«˜æ•ˆå»å®ç°ä¸ªæ€§åŒ–çš„ä¿¡æ¯æµç”Ÿæˆã€‚</p>
<h3 id="å¥½å‹å‚ä¸çš„å†…å®¹" class="headerLink">
    <a href="#%e5%a5%bd%e5%8f%8b%e5%8f%82%e4%b8%8e%e7%9a%84%e5%86%85%e5%ae%b9" class="header-mark"></a>8.1 å¥½å‹å‚ä¸çš„å†…å®¹</h3><p>æœ€ç®€å•ã€ç›´æ¥çš„ä¿¡æ¯æµå®šä¹‰å¯èƒ½å°±æ˜¯åœ¨æœ‹å‹åœˆã€å¾®åš feed ä¸Šåˆ·ä¸€ä¸‹å…³æ³¨çš„äººåˆ›å»ºã€å‚ä¸çš„å†…å®¹åˆ—è¡¨äº†ï¼Œå…ˆä¸è€ƒè™‘æ’åºçš„é—®é¢˜ï¼Œè¿™äº›å†…å®¹ä¸€å®šæ˜¯ï¼š</p>
<ul>
<li>ä¸€å®šæ—¶é—´æ®µå†…å¥½å‹åˆ›å»ºçš„å†…å®¹</li>
<li>ä¸€å®šæ—¶é—´ç«¯å†…å¥½å‹è¯„è®ºçš„å†…å®¹</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥ç”¨ cypher è¡¨è¾¾è¿™ä¸ªæŸ¥è¯¢ç”¨æˆ· id ä¸º player100 çš„ä¿¡æ¯æµï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">feed_owner</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">friend</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">feed_owner</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;player100&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">friend</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">newly_commented</span><span class="p">:</span><span class="n">commented_at</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">post</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">created_post</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">feed_owner</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">newly_commented</span><span class="p">.</span><span class="n">post_time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="kt">timestamp</span><span class="p">(</span><span class="s2">&#34;2010-01-01 00:00:00&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">friend</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">newly_created</span><span class="p">:</span><span class="n">created_post</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">po</span><span class="p">:</span><span class="n">post</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">newly_created</span><span class="p">.</span><span class="n">post_time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="kt">timestamp</span><span class="p">(</span><span class="s2">&#34;2010-01-01 00:00:00&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">friend</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nf">collect</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">po</span><span class="p">.</span><span class="n">post</span><span class="p">.</span><span class="n">title</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="s2">&#34;comment of &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">dst</span><span class="p">(</span><span class="n">newly_commented</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">AS</span><span class="w"> </span><span class="n">feeds</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="n">feeds</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">friend</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">feeds</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th style="text-align:left">friend.player.name</th>
<th style="text-align:left">feeds</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Boris Diaw</td>
<td style="text-align:left">[&ldquo;I love you, Mom&rdquo;, &ldquo;comment of post11&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Marco Belinelli</td>
<td style="text-align:left">[&ldquo;my best friend, tom&rdquo;, &ldquo;comment of post11&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Danny Green</td>
<td style="text-align:left">[&ldquo;comment of post1&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Tiago Splitter</td>
<td style="text-align:left">[&ldquo;comment of post1&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Dejounte Murray</td>
<td style="text-align:left">[&ldquo;comment of post11&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Tony Parker</td>
<td style="text-align:left">[&ldquo;I can swim&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">LaMarcus Aldridge</td>
<td style="text-align:left">[&ldquo;I hate coriander&rdquo;, &ldquo;comment of post11&rdquo;, &ldquo;comment of post1&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Manu Ginobili</td>
<td style="text-align:left">[&ldquo;my best friend, jerry&rdquo;, &ldquo;comment of post11&rdquo;, &ldquo;comment of post11&rdquo;]</td>
</tr>
</tbody>
</table>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›è¯„è®ºã€æ–‡ç« å‘é€åˆ°ç”¨æˆ·çš„ feed ä¹‹ä¸Šäº†ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿæ¥çœ‹çœ‹ä»–ä»¬åœ¨å›¾ä¸Šçš„æ ·å­å§ï¼Œæˆ‘ä»¬è¾“å‡ºæ‰€æœ‰æŸ¥åˆ°çš„è·¯å¾„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">feed_owner</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">friend</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">feed_owner</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;player100&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="n">p_comment</span><span class="o">=</span><span class="p">(</span><span class="n">friend</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">newly_commented</span><span class="p">:</span><span class="n">commented_at</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">post</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">created_post</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">feed_owner</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">newly_commented</span><span class="p">.</span><span class="n">post_time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="kt">timestamp</span><span class="p">(</span><span class="s2">&#34;2010-01-01 00:00:00&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="n">p_post</span><span class="o">=</span><span class="p">(</span><span class="n">friend</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">newly_created</span><span class="p">:</span><span class="n">created_post</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">po</span><span class="p">:</span><span class="n">post</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">newly_created</span><span class="p">.</span><span class="n">post_time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="kt">timestamp</span><span class="p">(</span><span class="s2">&#34;2010-01-01 00:00:00&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">p_comment</span><span class="p">,</span><span class="w"> </span><span class="n">p_post</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ¸²æŸ“åœ¨ Explorer ä¸Šï¼Œé€‰æ‹©â€œç¥ç»ç½‘ç»œâ€è¿™ä¸ªå¸ƒå±€ï¼Œå¯ä»¥å¾ˆæ¸…æ™°çœ‹å‡ºè¿™äº›ç²‰è‰²çš„æ–‡ç« èŠ‚ç‚¹ï¼Œè¿˜æœ‰ä»£è¡¨è¯„è®ºçš„è¾¹ã€‚</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/feed_from_friends.webp" title="feed_from_friends" data-thumbnail="/nebulagraph-sns/feed_from_friends.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/feed_from_friends.webp"
            srcset="/nebulagraph-sns/feed_from_friends.webp, /nebulagraph-sns/feed_from_friends.webp 1.5x, /nebulagraph-sns/feed_from_friends.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/feed_from_friends.webp">
    </a></figure></p>
<h3 id="é™„è¿‘å¥½å‹çš„å†…å®¹" class="headerLink">
    <a href="#%e9%99%84%e8%bf%91%e5%a5%bd%e5%8f%8b%e7%9a%84%e5%86%85%e5%ae%b9" class="header-mark"></a>8.2 é™„è¿‘å¥½å‹çš„å†…å®¹</h3><p>æˆ‘ä»¬å†è¿›ä¸€æ­¥ï¼ŒæŠŠåœ°ç†ä¿¡æ¯è€ƒè™‘è¿›æ¥ï¼Œè·å–é‚£äº›ä½å€çš„ç»çº¬åº¦å°äºä¸€å®šè·ç¦»æœ‹å‹ç›¸å…³çš„å†…å®¹ã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨åˆ°äº† NebulaGraph çš„ GeoSpatial åœ°ç†åŠŸèƒ½ï¼Œ<code>ST_Distance(home.address.geo_point, friend_addr.address.geo_point) AS distance WHERE distance &lt; 1000000</code> çš„çº¦æŸæ¡ä»¶å¸®æˆ‘ä»¬è¡¨è¾¾äº†è·ç¦»çš„é™åˆ¶ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">home</span><span class="p">:</span><span class="n">address</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">lived_in</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">feed_owner</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">follow</span><span class="o">`</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">friend</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">lived_in</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">friend_addr</span><span class="p">:</span><span class="n">address</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">feed_owner</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;player100&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">feed_owner</span><span class="p">,</span><span class="w"> </span><span class="n">friend</span><span class="p">,</span><span class="w"> </span><span class="nf">ST_Distance</span><span class="p">(</span><span class="n">home</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">geo_point</span><span class="p">,</span><span class="w"> </span><span class="n">friend_addr</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">geo_point</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">friend</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">newly_commented</span><span class="p">:</span><span class="n">commented_at</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">post</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">created_post</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">feed_owner</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">newly_commented</span><span class="p">.</span><span class="n">post_time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="kt">timestamp</span><span class="p">(</span><span class="s2">&#34;2010-01-01 00:00:00&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIONAL</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">friend</span><span class="p">:</span><span class="n">player</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">newly_created</span><span class="p">:</span><span class="n">created_post</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">po</span><span class="p">:</span><span class="n">post</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">newly_created</span><span class="p">.</span><span class="n">post_time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="kt">timestamp</span><span class="p">(</span><span class="s2">&#34;2010-01-01 00:00:00&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">friend</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nf">collect</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">po</span><span class="p">.</span><span class="n">post</span><span class="p">.</span><span class="n">title</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="s2">&#34;comment of &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">dst</span><span class="p">(</span><span class="n">newly_commented</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">AS</span><span class="w"> </span><span class="n">feeds</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="n">feeds</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">friend</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">feeds</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th style="text-align:left">friend.player.name</th>
<th style="text-align:left">feeds</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Marco Belinelli</td>
<td style="text-align:left">[&ldquo;my best friend, tom&rdquo;, &ldquo;comment of post11&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Tony Parker</td>
<td style="text-align:left">[&ldquo;I can swim&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">Danny Green</td>
<td style="text-align:left">[&ldquo;comment of post1&rdquo;]</td>
</tr>
</tbody>
</table>
<p>è¿™æ—¶å€™ï¼Œä»å¯è§†åŒ–è¿™ä¸ªç»“æœä¹Ÿå¯ä»¥çœ‹åˆ°ä½å€è¿™ä¸€å…³ç³»ï¼Œä»¥åŠå®ƒä»¬çš„ç»çº¬åº¦ä¿¡æ¯ï¼Œæˆ‘æ‰‹åŠ¨æ ¹æ®å®ƒä»¬çš„ç»çº¬åº¦ï¼ŒæŠŠåœ°å€çš„èŠ‚ç‚¹åœ¨å›¾ä¸Šæ’å¸ƒäº†ä¸€ä¸‹å¯ä»¥çœ‹åˆ°è¿™ä¸ª feed çš„ä¸»äºº Tim(player100) çš„ä½å€ï¼ˆ7ï¼Œ8ï¼‰åˆšå¥½åœ¨å…¶ä»–å¥½å‹ä½å€çš„ä¸­é—´ä½ç½®ï¼Œè¿™äº›ä¸´è¿‘å¥½å‹çš„ç›¸å…³çš„æ–‡ç« å’Œå‚ä¸è¯„è®ºçš„å†…å®¹å°†è¢«ä½œä¸ºä¿¡æ¯æµæ¨é€ç»™ Timï¼š</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/geo_feed.webp" title="geo_feed" data-thumbnail="/nebulagraph-sns/geo_feed.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/geo_feed.webp"
            srcset="/nebulagraph-sns/geo_feed.webp, /nebulagraph-sns/geo_feed.webp 1.5x, /nebulagraph-sns/geo_feed.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/geo_feed.webp">
    </a></figure></p>
<h2 id="æ—¶ç©ºå…³ç³»è¿½è¸ª" class="headerLink">
    <a href="#%e6%97%b6%e7%a9%ba%e5%85%b3%e7%b3%bb%e8%bf%bd%e8%b8%aa" class="header-mark"></a>9 æ—¶ç©ºå…³ç³»è¿½è¸ª</h2><p>æ—¶ç©ºå…³ç³»è¿½è¸ªè¿™ä¸ªå›¾è°±åº”ç”¨æ˜¯åœ¨å…¬å…±å®‰å…¨ã€ç‰©æµã€ç–«æƒ…é˜²æ§ç­‰åœºæ™¯ä¸‹ï¼Œåˆ©ç”¨å›¾éå†å°†ç¹æ‚ã€å‡Œä¹±çš„ä¿¡æ¯å……åˆ†åˆ©ç”¨èµ·æ¥çš„å…¸å‹åº”ç”¨ã€‚å½“æˆ‘ä»¬å»ºç«‹èµ·è¿™æ ·çš„å›¾è°±ä¹‹åå¾€å¾€åªéœ€è¦ç®€å•çš„å›¾æŸ¥è¯¢å°±å¯ä»¥è·å¾—éå¸¸æœ‰ç”¨çš„æ´å¯Ÿã€‚æœ¬ç« èŠ‚æˆ‘ç»™å¤§å®¶è·ç¦»ä¸€ä¸‹è¿™ä¸ªåº”ç”¨åœºæ™¯ã€‚</p>
<h3 id="æ•°æ®é›†" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e9%9b%86" class="header-mark"></a>9.1 æ•°æ®é›†</h3><p>ä¸ºæ­¤ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªè™šæ‹Ÿçš„æ•°æ®é›†ç”±æ¥æ„å»ºä¸€ä¸ªæ—¶ç©ºå…³ç³»å›¾è°±ã€‚æ•°æ®é›†çš„ç”Ÿæˆç¨‹åºå’Œä¸€ä»½å¯ä»¥ç›´æ¥ç”¨çš„æ–‡ä»¶éƒ½æ”¾åœ¨äº† GitHub ä¸Šï¼Œä»“åº“åœ°å€æ˜¯ï¼š <a href="https://github.com/wey-gu/covid-track-graph-datagen" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/covid-track-graph-datagen</a> ã€‚</p>
<p>å®ƒçš„æ•°æ®å»ºæ¨¡å¦‚ä¸‹ï¼š</p>
<img src="schema_covid.webp" alt="schema_covid" style="zoom:40%;" />
<p>åœ¨ä¸€ä¸ªå…¨æ–°çš„ç¯å¢ƒé‡Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹è¾¹çš„ 3 è¡Œå‘½ä»¤å°±å‡†å¤‡å¥½è¿™ä¸ªå›¾è°±ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># å®‰è£… NebulaGraph + NebulaGraph Studio</span>
</span></span><span class="line"><span class="cl">curl -fsSL nebula-up.siwei.io/install.sh <span class="p">|</span> bash -s -- v3
</span></span><span class="line"><span class="cl"><span class="c1"># ä¸‹è½½æ•°æ®é›†</span>
</span></span><span class="line"><span class="cl">git clone https://github.com/wey-gu/covid-track-graph-datagen <span class="o">&amp;&amp;</span> <span class="nb">cd</span> covid-track-graph-datagen
</span></span><span class="line"><span class="cl"><span class="c1"># å¯¼å…¥æ•°æ®é›†</span>
</span></span><span class="line"><span class="cl">docker run --rm -ti <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --network<span class="o">=</span>nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/:/root <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    vesoft/nebula-importer:v3.2.0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --config /root/nebula-importer-config.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæˆ‘ä»¬åœ¨ console é‡ŒæŸ¥çœ‹ä¸€ä¸‹æ•°æ®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">~/.nebula-up/console.sh
</span></span><span class="line"><span class="cl"><span class="c1"># è¿›å…¥ console äº†ï¼Œè¿›åˆ° covid_trace å›¾ç©ºé—´ï¼ˆåˆšæ‰åˆ›å»ºçš„ï¼‰</span>
</span></span><span class="line"><span class="cl">USE covid_trace<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ‰§è¡Œæ•°æ®ç»Ÿè®¡çš„ä»»åŠ¡</span>
</span></span><span class="line"><span class="cl">SHOW JOB STATS
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>root@nebula<span class="o">)</span> <span class="o">[</span>covid_trace<span class="o">]</span>&gt; SHOW STATS
</span></span><span class="line"><span class="cl">+---------+------------+--------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Type    <span class="p">|</span> Name       <span class="p">|</span> Count  <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------+------------+--------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Tag&#34;</span>   <span class="p">|</span> <span class="s2">&#34;äºº&#34;</span>       <span class="p">|</span> <span class="m">10000</span>  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Tag&#34;</span>   <span class="p">|</span> <span class="s2">&#34;åœ°å€&#34;</span>     <span class="p">|</span> <span class="m">1000</span>   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Tag&#34;</span>   <span class="p">|</span> <span class="s2">&#34;åŸå¸‚&#34;</span>     <span class="p">|</span> <span class="m">341</span>    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Tag&#34;</span>   <span class="p">|</span> <span class="s2">&#34;æ‘é•‡&#34;</span>     <span class="p">|</span> <span class="m">42950</span>  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Tag&#34;</span>   <span class="p">|</span> <span class="s2">&#34;çœä»½&#34;</span>     <span class="p">|</span> <span class="m">32</span>     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Tag&#34;</span>   <span class="p">|</span> <span class="s2">&#34;è”ç³»æ–¹å¼&#34;</span> <span class="p">|</span> <span class="m">0</span>      <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Tag&#34;</span>   <span class="p">|</span> <span class="s2">&#34;è¡Œæ”¿åŒº&#34;</span>   <span class="p">|</span> <span class="m">3134</span>   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Tag&#34;</span>   <span class="p">|</span> <span class="s2">&#34;è¡—é“&#34;</span>     <span class="p">|</span> <span class="m">667911</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Edge&#34;</span>  <span class="p">|</span> <span class="s2">&#34;ä½å€&#34;</span>     <span class="p">|</span> <span class="m">0</span>      <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Edge&#34;</span>  <span class="p">|</span> <span class="s2">&#34;åˆ°è®¿&#34;</span>     <span class="p">|</span> <span class="m">19986</span>  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Edge&#34;</span>  <span class="p">|</span> <span class="s2">&#34;åŒä½&#34;</span>     <span class="p">|</span> <span class="m">19998</span>  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Edge&#34;</span>  <span class="p">|</span> <span class="s2">&#34;å±äº&#34;</span>     <span class="p">|</span> <span class="m">715336</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Space&#34;</span> <span class="p">|</span> <span class="s2">&#34;vertices&#34;</span> <span class="p">|</span> <span class="m">725368</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Space&#34;</span> <span class="p">|</span> <span class="s2">&#34;edges&#34;</span>    <span class="p">|</span> <span class="m">755320</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------+------------+--------+
</span></span><span class="line"><span class="cl">Got <span class="m">14</span> rows <span class="o">(</span><span class="nb">time</span> spent 1087/46271 us<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä¸¤äººä¹‹é—´çš„å…³è”" class="headerLink">
    <a href="#%e4%b8%a4%e4%ba%ba%e4%b9%8b%e9%97%b4%e7%9a%84%e5%85%b3%e8%81%94" class="header-mark"></a>9.2 ä¸¤äººä¹‹é—´çš„å…³è”</h3><p>å¾ˆè‡ªç„¶ï¼Œåˆ©ç”¨è·¯å¾„æŸ¥è¯¢å°±å¯ä»¥äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># æœ€çŸ­
</span></span><span class="line"><span class="cl">FIND SHORTEST PATH FROM &#34;p_100&#34; TO &#34;p_101&#34; OVER * BIDIRECT YIELD PATH AS paths
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># æ‰€æœ‰è·¯å¾„
</span></span><span class="line"><span class="cl">FIND ALL PATH FROM &#34;p_100&#34; TO &#34;p_101&#34; OVER * BIDIRECT YIELD PATH AS paths | LIMIT 10
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€çŸ­è·¯å¾„ç»“æœï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">paths</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&lt;(&ldquo;p_100&rdquo;)&lt;-[:åŒä½@0 {}]-(&ldquo;p_2136&rdquo;)&lt;-[:åŒä½@0 {}]-(&ldquo;p_3708&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_125&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_101&rdquo;)&gt;</td>
</tr>
</tbody>
</table>
<p>æ‰€æœ‰è·¯å¾„ç»“æœï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">paths</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&lt;(&ldquo;p_100&rdquo;)&lt;-[:åŒä½@0 {}]-(&ldquo;p_2136&rdquo;)&lt;-[:åŒä½@0 {}]-(&ldquo;p_3708&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_125&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_101&rdquo;)&gt;</td>
</tr>
<tr>
<td style="text-align:left">&lt;(&ldquo;p_100&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_328&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_6976&rdquo;)&lt;-[:åŒä½@0 {}]-(&ldquo;p_261&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_352&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_101&rdquo;)&gt;</td>
</tr>
<tr>
<td style="text-align:left">&lt;(&ldquo;p_100&rdquo;)-[:åŒä½@0 {}]-&gt;(&ldquo;p_8709&rdquo;)-[:åŒä½@0 {}]-&gt;(&ldquo;p_9315&rdquo;)-[:åŒä½@0 {}]-&gt;(&ldquo;p_261&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_352&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_101&rdquo;)&gt;</td>
</tr>
<tr>
<td style="text-align:left">&lt;(&ldquo;p_100&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_328&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_6311&rdquo;)-[:åŒä½@0 {}]-&gt;(&ldquo;p_3941&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_345&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_101&rdquo;)&gt;</td>
</tr>
<tr>
<td style="text-align:left">&lt;(&ldquo;p_100&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_328&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_5046&rdquo;)-[:åŒä½@0 {}]-&gt;(&ldquo;p_3993&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_144&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_101&rdquo;)&gt;</td>
</tr>
<tr>
<td style="text-align:left">&lt;(&ldquo;p_100&rdquo;)-[:åŒä½@0 {}]-&gt;(&ldquo;p_3457&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_199&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_6771&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_458&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_101&rdquo;)&gt;</td>
</tr>
<tr>
<td style="text-align:left">&lt;(&ldquo;p_100&rdquo;)&lt;-[:åŒä½@0 {}]-(&ldquo;p_1462&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_922&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_5869&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_345&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_101&rdquo;)&gt;</td>
</tr>
<tr>
<td style="text-align:left">&lt;(&ldquo;p_100&rdquo;)&lt;-[:åŒä½@0 {}]-(&ldquo;p_9489&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_985&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_2733&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_458&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_101&rdquo;)&gt;</td>
</tr>
<tr>
<td style="text-align:left">&lt;(&ldquo;p_100&rdquo;)&lt;-[:åŒä½@0 {}]-(&ldquo;p_9489&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_905&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_2733&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_458&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_101&rdquo;)&gt;</td>
</tr>
<tr>
<td style="text-align:left">&lt;(&ldquo;p_100&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_89&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_1333&rdquo;)&lt;-[:åŒä½@0 {}]-(&ldquo;p_1683&rdquo;)-[:åˆ°è®¿@0 {}]-&gt;(&ldquo;a_345&rdquo;)&lt;-[:åˆ°è®¿@0 {}]-(&ldquo;p_101&rdquo;)&gt;</td>
</tr>
</tbody>
</table>
<p>æˆ‘ä»¬æŠŠæ‰€æœ‰è·¯å¾„è¿›è¡Œå¯è§†åŒ–æ¸²æŸ“ï¼Œæ ‡è®°å‡ºèµ·ç‚¹ç»ˆç‚¹çš„ä¸¤äººï¼Œå¹¶åœ¨å…¶ä¸­æŸ¥åˆ°ä»–ä»¬çš„æœ€çŸ­è·¯å¾„ï¼Œä»–ä»¬ä¹‹é—´çš„åƒä¸ä¸‡ç¼•å…³ç³»å°±ä¸€ç›®äº†ç„¶äº†ï¼Œæ— è®ºæ˜¯å•†ä¸šæ´å¯Ÿã€å…¬å…±å®‰å…¨è¿˜æ˜¯ç–«æƒ…é˜²æ§çš„ç›®çš„ï¼Œæœ‰äº†è¿™ä¸ªä¿¡æ¯ï¼Œç›¸åº”çš„å·¥ä½œéƒ½å¯ä»¥å¦‚è™æ·»ç¿¼åœ°å‘ä¸‹è¿›å±•ã€‚</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/find_path_two_people.webp" title="find_path_two_people" data-thumbnail="/nebulagraph-sns/find_path_two_people.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/find_path_two_people.webp"
            srcset="/nebulagraph-sns/find_path_two_people.webp, /nebulagraph-sns/find_path_two_people.webp 1.5x, /nebulagraph-sns/find_path_two_people.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/find_path_two_people.webp">
    </a></figure></p>
<p>å½“ç„¶ï¼Œåœ¨çœŸå®çš„ç³»ç»Ÿä¸Šï¼Œå¯èƒ½æˆ‘ä»¬åªéœ€è¦å…³å¿ƒä¸¤ä¸ªç”¨æˆ·ä¹‹é—´çš„å…³è”è¿œè¿‘ï¼Œå¾—å‡ºé‡åŒ–çš„è¯„ä¼°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">FIND SHORTEST PATH FROM &#34;p_100&#34; TO &#34;p_101&#34; OVER * BIDIRECT YIELD PATH AS paths |
</span></span><span class="line"><span class="cl">    YIELD collect(length($-.paths)) AS len | YIELD coalesce($-.len[0], -1) AS len
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœä¸­æˆ‘ä»¬åªå…³å¿ƒä»–ä»¬ä¹‹é—´æœ€çŸ­è·¯å¾„çš„é•¿åº¦ä¸ºï¼š4ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">len</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">4</td>
</tr>
</tbody>
</table>
<h3 id="æ—¶ç©ºç›¸äº¤çš„äºº" class="headerLink">
    <a href="#%e6%97%b6%e7%a9%ba%e7%9b%b8%e4%ba%a4%e7%9a%84%e4%ba%ba" class="header-mark"></a>9.3 æ—¶ç©ºç›¸äº¤çš„äºº</h3><p>è¿›ä¸€æ­¥æˆ‘ä»¬å¯ä»¥ç”¨å›¾è¯­ä¹‰å‹¾å‹’å‡ºæˆ‘ä»¬æƒ³ç¡®å®šçš„ä»»ä½•å¸¦æœ‰æ—¶é—´ä¸ç©ºé—´ä¿¡æ¯çš„æ¨¡å¼ï¼Œåœ¨å›¾è°±ä¸­å®æ—¶æŸ¥è¯¢å‡ºæ¥ï¼Œæ¯”å¦‚å¯¹ç»™å®šçš„äººï¼Œä»–çš„ id æ˜¯ p_101ï¼Œæˆ‘ä»¬ç›¸å·®åœ¨ç‰¹å®šæ—¶é—´é‡Œæ‰€æœ‰å’Œä»–æœ‰æ—¶ç©ºç›¸äº¤çš„äººï¼Œè¿™æ„å‘³ç€é‚£äº›äººåœ¨ p_101 è®¿é—®æŸä¸€åœ°æ–¹çš„æ—¶é—´æ®µä¹‹å†…ä¹Ÿé€—ç•™ã€è®¿é—®äº†è¿™äº›åœ°æ–¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="err">äºº</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="o">`</span><span class="n">visit0</span><span class="o">`</span><span class="p">:</span><span class="err">åˆ°è®¿</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">`</span><span class="n">addr</span><span class="o">`</span><span class="p">:</span><span class="err">åœ°å€</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="o">`</span><span class="n">visit1</span><span class="o">`</span><span class="p">:</span><span class="err">åˆ°è®¿</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span><span class="err">äºº</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;p_101&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">visit0</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">start_time</span><span class="o">`</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">`</span><span class="n">visit1</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">end_time</span><span class="o">`</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">visit0</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">end_time</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">`</span><span class="n">visit1</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">start_time</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="o">`</span><span class="n">addr</span><span class="o">`</span><span class="p">.</span><span class="err">åœ°å€</span><span class="p">.</span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="n">p1</span><span class="p">.</span><span class="err">äºº</span><span class="p">.</span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¾—åˆ°äº†å†æ¯ä¸€ä¸ªåˆ°è®¿åœ°ç‚¹çš„æ—¶ç©ºç›¸äº¤äººåˆ—è¡¨å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">addr.åœ°å€.name</th>
<th style="text-align:left">collect(p1.äºº.name)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">é—µè¡Œä»‡è·¯qåº§ 255960</td>
<td style="text-align:left">[&ldquo;å¾ç•…&rdquo;, &ldquo;ç‹ä½³&rdquo;, &ldquo;æ›¾äº®&rdquo;, &ldquo;å§œæ¡‚é¦™&rdquo;, &ldquo;é‚µç§€è‹±&rdquo;, &ldquo;éŸ¦å©·å©·&rdquo;, &ldquo;é™¶ç‰&rdquo;, &ldquo;é©¬å¤&rdquo;, &ldquo;é»„æƒ³&rdquo;, &ldquo;å¼ ç§€èŠ³&rdquo;, &ldquo;é¢œæ¡‚èŠ³&rdquo;, &ldquo;å¼ æ´‹&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">ä¸°éƒ½åŒ—äº¬è·¯Jåº§ 725701</td>
<td style="text-align:left">[&ldquo;é™ˆæ˜¥æ¢…&rdquo;, &ldquo;æ–½å©·å©·&rdquo;, &ldquo;äº•æˆ&rdquo;, &ldquo;èŒƒæ–‡&rdquo;, &ldquo;ç‹æ¥ &rdquo;, &ldquo;å°šæ˜&rdquo;, &ldquo;è–›ç§€ç&rdquo;, &ldquo;å®‹é‡‘å‡¤&rdquo;, &ldquo;æ¨é›ª&rdquo;, &ldquo;é‚“ä¸½å&rdquo;, &ldquo;ææ¨&rdquo;, &ldquo;æ¸©ä½³&rdquo;, &ldquo;å¶ç‰&rdquo;, &ldquo;å‘¨æ˜&rdquo;, &ldquo;ç‹æ¡‚ç&rdquo;, &ldquo;æ®µç‰å&rdquo;, &ldquo;é‡‘æˆ&rdquo;, &ldquo;é»„é‘«&rdquo;, &ldquo;é‚¬å…µ&rdquo;, &ldquo;é­æŸ³&rdquo;, &ldquo;ç‹å…°è‹±&rdquo;, &ldquo;æ¨æŸ³&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">æ™®é™€æ½œæ±Ÿè·¯Påº§ 210730</td>
<td style="text-align:left">[&ldquo;å‚¨å¹³&rdquo;, &ldquo;æ´ªçº¢éœ&rdquo;, &ldquo;æ²ˆç‰è‹±&rdquo;, &ldquo;ç‹æ´&rdquo;, &ldquo;è‘£ç‰è‹±&rdquo;, &ldquo;é‚“å‡¤è‹±&rdquo;, &ldquo;è°¢æµ·ç‡•&rdquo;, &ldquo;æ¢é›·&rdquo;, &ldquo;å¼ ç•…&rdquo;, &ldquo;ä»»ç‰å…°&rdquo;, &ldquo;è´¾å®‡&rdquo;, &ldquo;æ±ªæˆ&rdquo;, &ldquo;å­™ç´&rdquo;, &ldquo;çºªçº¢æ¢…&rdquo;, &ldquo;ç‹æ¬£&rdquo;, &ldquo;é™ˆå…µ&rdquo;, &ldquo;å¼ æˆ&rdquo;, &ldquo;ç‹ä¸œ&rdquo;, &ldquo;è°·éœ&rdquo;, &ldquo;æ—æˆ&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">æ™®é™€æ­¦è¡—fåº§ 706352</td>
<td style="text-align:left">[&ldquo;é‚¢æˆ&rdquo;, &ldquo;å¼ å»ºå†›&rdquo;, &ldquo;å¼ é‘«&rdquo;, &ldquo;æˆ´æ¶›&rdquo;, &ldquo;è”¡æ´‹&rdquo;, &ldquo;æ±ªç‡•&rdquo;, &ldquo;å°¹äº®&rdquo;, &ldquo;ä½•åˆ©&rdquo;, &ldquo;ä½•ç‰&rdquo;, &ldquo;å‘¨æ³¢&rdquo;, &ldquo;é‡‘ç§€ç&rdquo;, &ldquo;æ¨æ³¢&rdquo;, &ldquo;å¼ å¸…&rdquo;, &ldquo;å‘¨æŸ³&rdquo;, &ldquo;é©¬äº‘&rdquo;, &ldquo;å¼ å»ºå&rdquo;, &ldquo;ç‹ä¸½ä¸½&rdquo;, &ldquo;é™ˆä¸½&rdquo;, &ldquo;ä¸‡è&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">åŸä¸œè´µé˜³è¡—Oåº§ 110567</td>
<td style="text-align:left">[&ldquo;ææ´&rdquo;, &ldquo;é™ˆé™&rdquo;, &ldquo;ç‹å»ºå›½&rdquo;, &ldquo;æ–¹æ·‘å&rdquo;, &ldquo;å¤æƒ³&rdquo;, &ldquo;æ¼†è&rdquo;, &ldquo;è©¹æ¡‚èŠ±&rdquo;, &ldquo;ç‹æˆ&rdquo;, &ldquo;ææ…§&rdquo;, &ldquo;å­™å¨œ&rdquo;, &ldquo;é©¬ä¼Ÿ&rdquo;, &ldquo;è°¢æ°&rdquo;, &ldquo;ç‹é¹&rdquo;, &ldquo;é æ¡‚è‹±&rdquo;, &ldquo;è«æ¡‚è‹±&rdquo;, &ldquo;æ±ªé›·&rdquo;, &ldquo;é»„å½¬&rdquo;, &ldquo;æç‰æ¢…&rdquo;, &ldquo;ç¥çº¢æ¢…&rdquo;]</td>
</tr>
</tbody>
</table>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨å›¾ä¸Šå¯è§†åŒ–è¿™ä¸ªç»“æœçœ‹çœ‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="err">äºº</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="o">`</span><span class="n">visit0</span><span class="o">`</span><span class="p">:</span><span class="err">åˆ°è®¿</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">`</span><span class="n">addr</span><span class="o">`</span><span class="p">:</span><span class="err">åœ°å€</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="o">`</span><span class="n">visit1</span><span class="o">`</span><span class="p">:</span><span class="err">åˆ°è®¿</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span><span class="err">äºº</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;p_101&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">visit0</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">start_time</span><span class="o">`</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">`</span><span class="n">visit1</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">end_time</span><span class="o">`</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">visit0</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">end_time</span><span class="o">`</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">`</span><span class="n">visit1</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">start_time</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="n">paths</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœä¸­æˆ‘ä»¬æ ‡è®°äº† p_101 ä¸ºä¸åŒçš„å›¾æ ‡ï¼Œåœ¨ç”¨æ ‡ç­¾ä¼ æ’­ç®—æ³•è¯†åˆ«ä¸€ä¸‹èšé›†ç¤¾åŒºï¼Œæ˜¯ä¸æ˜¯ä¸€å›¾èƒœåƒè¨€å‘¢ï¼Ÿ</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/time_and_space.webp" title="time_and_space" data-thumbnail="/nebulagraph-sns/time_and_space.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/time_and_space.webp"
            srcset="/nebulagraph-sns/time_and_space.webp, /nebulagraph-sns/time_and_space.webp 1.5x, /nebulagraph-sns/time_and_space.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/time_and_space.webp">
    </a></figure></p>
<h3 id="æœ€è¿‘å»è¿‡çš„çœä»½" class="headerLink">
    <a href="#%e6%9c%80%e8%bf%91%e5%8e%bb%e8%bf%87%e7%9a%84%e7%9c%81%e4%bb%bd" class="header-mark"></a>9.4 æœ€è¿‘å»è¿‡çš„çœä»½</h3><p>æœ€åï¼Œæˆ‘ä»¬å†ç”¨ç®€å•çš„æŸ¥è¯¢æ¨¡å¼è¡¨è¾¾å‡ºä¸€ä¸ªäººåœ¨ç»™å®šæ—¶é—´å†…ï¼Œæ¯”å¦‚ä»ä¸€ä¸ªæ—¶é—´ç‚¹å¼€å§‹ï¼Œåˆ°è®¿è¿‡çš„æ‰€æœ‰çœä»½</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="err">äºº</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">visit</span><span class="p">:</span><span class="err">åˆ°è®¿</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">`</span><span class="n">addr</span><span class="o">`</span><span class="p">:</span><span class="err">åœ°å€</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="err">å±äº</span><span class="o">*</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">province</span><span class="p">:</span><span class="err">çœä»½</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;p_101&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">visit</span><span class="p">.</span><span class="n">start_time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1625469000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="n">province</span><span class="p">.</span><span class="err">çœä»½</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="n">addr</span><span class="p">.</span><span class="err">åœ°å€</span><span class="p">.</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>çœ‹èµ·æ¥ä»–/å¥¹å»è¿‡ä¸å°‘åœ°æ–¹å‘¢ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">province.çœä»½.name</th>
<th style="text-align:left">collect(addr.åœ°å€.name)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å››å·çœ</td>
<td style="text-align:left">[&ldquo;é—µè¡Œä»‡è·¯qåº§ 255960&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">å±±ä¸œçœ</td>
<td style="text-align:left">[&ldquo;åŸä¸œè´µé˜³è¡—Oåº§ 110567&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">äº‘å—çœ</td>
<td style="text-align:left">[&ldquo;ä¸°éƒ½åŒ—äº¬è·¯Jåº§ 725701&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">ç¦å»ºçœ</td>
<td style="text-align:left">[&ldquo;æ™®é™€æ½œæ±Ÿè·¯Påº§ 210730&rdquo;]</td>
</tr>
<tr>
<td style="text-align:left">å†…è’™å¤è‡ªæ²»åŒº</td>
<td style="text-align:left">[&ldquo;æ™®é™€æ­¦è¡—fåº§ 706352&rdquo;]</td>
</tr>
</tbody>
</table>
<p>è€è½¨è¿¹ï¼Œæˆ‘ä»¬åœ¨å›¾ä¸Šçœ‹çœ‹è¿™ä¸ªç»“æœå§ï¼Œè¿™æ¬¡ï¼Œæˆ‘ä»¬é€‰æ‹© Dagre-LR è¿™ä¸ªå¸ƒå±€æ¸²æŸ“ï¼Œç»“æœæ˜¯ä¸æ˜¯éå¸¸æ¸…æ™°å‘¢ï¼Ÿ</p>
<p><figure><a class="lightgallery" href="/nebulagraph-sns/visited_provinces.webp" title="visited_provinces" data-thumbnail="/nebulagraph-sns/visited_provinces.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-sns/visited_provinces.webp"
            srcset="/nebulagraph-sns/visited_provinces.webp, /nebulagraph-sns/visited_provinces.webp 1.5x, /nebulagraph-sns/visited_provinces.webp 2x"
            sizes="auto"
            alt="/nebulagraph-sns/visited_provinces.webp">
    </a></figure></p>
<h2 id="æ€»ç»“" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93" class="header-mark"></a>10 æ€»ç»“</h2><p>æˆ‘ä»¬ç»™å‡ºäº†ä¸å°‘ç¤¾äº¤ç½‘ç»œé‡Œçš„åº”ç”¨æ¡ˆä¾‹ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>æŸ¥æ‰¾å…³é”®çš„äºº</li>
<li>è¯†åˆ«èšé›†çš„äººç¾¤ã€ç¤¾ç¾¤</li>
<li>åˆ¤å®šä¸¤ä¸ªç”¨æˆ·ä¹‹é—´çš„äº²å¯†åº¦</li>
<li>æ¨èæ–°æœ‹å‹</li>
<li>åˆ©ç”¨å…±åŒé‚»å±…ç²¾å‡†æ¨é€é‡è¦å†…å®¹</li>
<li>æ ¹æ®å¥½å‹å…³ç³»ã€åœ°ç†ä½ç½®æ¨é€ä¿¡æ¯æµ</li>
<li>åˆ©ç”¨æ—¶ç©ºå…³ç³»å›¾è°±æŸ¥è¯¢äººä¸äººä¹‹é—´å…³ç³»ã€è·å–æ—¶ç©ºç›¸äº¤çš„äººã€è®¿é—®è¿‡çš„çœä»½</li>
</ul>
<p>ç¤¾äº¤ç½‘ç»œä½œä¸ºå¤©ç„¶çš„å›¾ç»“æ„ï¼Œéå¸¸é€‚åˆç”¨å›¾çš„æŠ€æœ¯æ¥å­˜å‚¨ã€æŸ¥è¯¢ã€è®¡ç®—ã€åˆ†æä¸å¯è§†åŒ–å»è§£å†³å…¶ä¸Šçš„å„å¼å„æ ·çš„é—®é¢˜ï¼ŒNebulaGraph çš„å¼ºå¤§å¤„ç†èƒ½åŠ›å’Œå¯è§†åŒ–èƒ½åŠ›ä½¿å¾—æˆ‘ä»¬å·²çŸ¥å¾ˆå¤šå…¬å¸åœ¨ä½¿ç”¨å®ƒä½œä¸ºç¤¾äº¤é¢†åŸŸçš„å›¾å­˜å‚¨ã€è®¡ç®—å±‚ï¼Œè¿™å…¶ä¸­åŒ…æ‹¬ï¼šç½‘æ˜“æ¸¸æˆã€å¾®ä¿¡ã€Lineã€Soulã€å¿«æ‰‹å’ŒçŸ¥ä¹ç­‰ç­‰å¾ˆå¤šè¡Œä¸šé¢†å…ˆçš„å›¢é˜Ÿï¼Œå¸Œæœ›å¤§å®¶é€šè¿‡æœ¬ç« èƒ½å¯¹ç¤¾äº¤é¢†åŸŸçš„å›¾æŠ€æœ¯åº”æœ‰æœ‰ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†ã€‚</p>
<blockquote>
<p>é¢˜å›¾ç‰ˆæƒï¼šby <a href="https://unsplash.com/photos/IBaVuZsJJTo" target="_blank" rel="noopener noreferrer">Ryoji</a></p>
</blockquote>]]></description>
</item><item>
    <title>chatGPT åŠ  NebulaGraph é¢„æµ‹ 2022 ä¸–ç•Œæ¯å† å†›çƒé˜Ÿ</title>
    <link>https://siwei.io/chatgpt-and-nebulagraph-predict-fifa-world-cup/</link>
    <pubDate>Tue, 06 Dec 2022 18:01:55 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/chatgpt-and-nebulagraph-predict-fifa-world-cup/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>ä¸€æ¬¡åˆ©ç”¨ chatGPT ç»™å‡ºæ•°æ®æŠ“å–ä»£ç ï¼Œå€ŸåŠ© NebulaGraph å›¾æ•°æ®åº“ä¸å›¾ç®—æ³•é¢„æµ‹ä½“è‚²èµ›äº‹çš„å°è¯•ã€‚</p>
</blockquote>
<!--

> chatGPT and Nebulagraph Predict Fifa World Cup

[TOC]

-->
<h2 id="è¹­çƒ­åº¦" class="headerLink">
    <a href="#%e8%b9%ad%e7%83%ad%e5%ba%a6" class="header-mark"></a>1 è¹­çƒ­åº¦</h2><p>æœ€è¿‘å› ä¸ºä¸–ç•Œæ¯è¿›è¡Œæ—¶ï¼Œè¢«è¿™ç¯‡ <a href="https://cambridge-intelligence.com/fifa-world-cup-2022-prediction/" target="_blank" rel="noopener noreferrer">Cambridge Intelligence</a> çš„æ–‡ç« å¯å‘ï¼ˆä»…ä»…åˆ©ç”¨æœ‰é™çš„ä¿¡æ¯é‡å’Œæ¡ä»¶ï¼Œå€ŸåŠ©å›¾ç®—æ³•çš„æ–¹æ³•åšåˆç†çš„å† å†›é¢„æµ‹ï¼‰ï¼Œè®¨è®ºåˆ°ä¹Ÿå¯ä»¥è¯•ç€ç”¨ NebulaGraph ç©ç©å† å†›é¢„æµ‹ï¼Œè¿˜èƒ½é¡ºé“ç§‘æ™®ä¸€æ³¢å›¾åº“æŠ€æœ¯å’Œå›¾ç®—æ³•ã€‚</p>
<p>æœ¬æ¥æƒ³ç€å‡ ä¸ªå°æ—¶æ’¸å‡ºæ¥ä¸€ä¸ªæ–¹æ¡ˆï¼Œè¢«æ•°æ®é›†çš„æ”¶é›†åŠé€€äº†ï¼Œæˆ‘æ˜¯æ˜¯åœ¨æ‡’å¾—å» <a href="https://en.wikipedia.org/wiki/2022_FIFA_World_Cup_squads" target="_blank" rel="noopener noreferrer">wikepedia</a> é‡ŒæŠ“å–å‡ºæ¥éœ€è¦çš„æ•°æ®ï¼Œç´¢æ€§å°±æŒ‰ä¸‹æ”¾äº†å‡ å¤©ã€‚</p>
<p>åŒæ—¶ï¼Œå¦ä¸€ä¸ªçƒ­æ½®æ˜¯æœ€è¿‘ OpenAI å‘å¸ƒäº† chatGPT æœåŠ¡ï¼Œå®ƒå¯ä»¥å®ç°å„ç§è¯­è¨€å¯æ˜¯å®ç°çš„å¤æ‚ä»»åŠ¡è®¾è®¡åŒ…æ‹¬ï¼š</p>
<ul>
<li>éšæ—¶å¸®ä½ å®ç°ä¸€æ®µä»€ä¹ˆæ ·çš„ä»£ç </li>
<li>æ¨¡æ‹Ÿæˆä»»æ„ä¸€ä¸ª prompt ç•Œé¢ï¼šshellã€pythonã€virtual machineã€ç”šè‡³ä½ åˆ›é€ çš„è¯­è¨€</li>
<li>å‡è®¾ã€å¸¦å…¥ä½ ç»™å®šçš„äººè®¾ï¼Œå’Œä½ èŠå¤©</li>
<li>å†™è¯—æ­Œã€rapã€æ•£æ–‡</li>
<li>æ‰¾å‡ºä¸€æ®µä»£ç çš„ bug</li>
<li>è§£é‡Šä¸€æ®µå¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼çš„å«ä¹‰</li>
</ul>
<p>chatGPT çš„ä¸Šä¸‹æ–‡èƒ½åŠ›ã€ç†è§£åŠ›åˆ°çš„å‰æ‰€æœªæœ‰çš„ç¨‹åº¦ä»¥è‡³äºæ‰€æœ‰äººéƒ½åœ¨è®¨è®ºæ–°çš„å·¥ä½œæ–¹å¼ï¼šå¦‚ä½•æŒæ¡è®©æœºå™¨å¸®åŠ©æˆ‘ä»¬å®Œæˆä»»åŠ¡ã€‚</p>
<p>æ‰€ä»¥ï¼Œå½“æˆ‘è¯•è¿‡è®© chatGPT å¸®æˆ‘å†™å¤æ‚çš„å›¾æ•°æ®åº“æŸ¥è¯¢è¯­å¥ã€è§£é‡Šå¤æ‚å›¾æŸ¥è¯¢è¯­å¥çš„å«ä¹‰ã€è§£é‡Šä¸€å¤§æ®µ <em>Bison</em> ä»£ç å«ä¹‰ä¹‹åæˆ‘æ‰æ„è¯†åˆ°ï¼šä¸ºä»€ä¹ˆä¸è®© chatGPT å¸®æˆ‘å†™å¥½æŠ“å–æ•°æ®çš„ä»£ç å‘¢ï¼Ÿ</p>
<h2 id="æŠ“å–æ•°æ®" class="headerLink">
    <a href="#%e6%8a%93%e5%8f%96%e6%95%b0%e6%8d%ae" class="header-mark"></a>2 æŠ“å–æ•°æ®</h2><p>æˆ‘çœŸè¯•äº†ä¸€ä¸‹ï¼Œç»“æœæ˜¯ï¼šå®Œå…¨å¯ä»¥ï¼Œè€Œä¸”ä¼¼ä¹çœŸçš„å¾ˆå®¹æ˜“ã€‚</p>
<p>æ•´ä¸ªè¿‡ç¨‹åŸºæœ¬ä¸Šæˆ‘åƒæ˜¯ä¸€ä¸ªä»£ç è€ƒè¯•çš„é¢è¯•å®˜ã€æˆ–è€…æ˜¯ä¸€ä¸ªäº§å“ç»ç†ï¼Œæå‡ºæˆ‘çš„éœ€æ±‚ï¼ŒchatGPT ç»™å‡ºä»£ç çš„å®ç°ã€‚æˆ‘ä»¬å†è¯•ç€è·‘èµ·æ¥ä»£ç ï¼Œæ‰¾åˆ°ä»£ç ä¸­ä¸åˆç†çš„åœ°æ–¹ï¼ŒæŒ‡å‡ºæ¥ã€ç»™å‡ºå»ºè®®ï¼ŒchatGPT å°±çœŸçš„èƒ½ç†è§£æˆ‘æŒ‡å‡ºçš„ç‚¹ï¼Œå¹¶ç»™å‡ºç›¸åº”çš„ä¿®æ­£ï¼Œåƒæ˜¯ï¼š</p>
<p><figure><a class="lightgallery" href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/chatGPT-correction-process.webp" title="/chatgpt-and-nebulagraph-predict-fifa-world-cup/chatGPT-correction-process.webp" data-thumbnail="/chatgpt-and-nebulagraph-predict-fifa-world-cup/chatGPT-correction-process.webp">
        <img
            
            loading="lazy"
            src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/chatGPT-correction-process.webp"
            srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/chatGPT-correction-process.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/chatGPT-correction-process.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/chatGPT-correction-process.webp 2x"
            sizes="auto"
            alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/chatGPT-correction-process.webp">
    </a></figure></p>
<p>è¿™ä¸€å…¨è¿‡ç¨‹æˆ‘å°±ä¸åœ¨è¿™é‡Œåˆ—å‡ºæ¥äº†ï¼Œä¸è¿‡æˆ‘æŠŠç”Ÿæˆçš„ä»£ç å’Œæ•´ä¸ªè®¨è®ºçš„è¿‡ç¨‹éƒ½åˆ†äº«åœ¨<a href="https://gist.github.com/wey-gu/78cb28bee130966e7d6e9d573b51deff" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»çœ‹çœ‹ã€‚</p>
<p>æœ€ç»ˆç”Ÿæˆçš„æ•°æ®æ˜¯ä¸€ä¸ª CSV æ–‡ä»¶ï¼š</p>
<ul>
<li>
<p>ä»£ç ç”Ÿæˆçš„æ–‡ä»¶ <a href="https://github.com/siwei-io/talks/files/10152775/world_cup_squads.csv" target="_blank" rel="noopener noreferrer">world_cup_squads.csv</a></p>
</li>
<li>
<p>æ‰‹åŠ¨ä¿®æ”¹ã€åˆ†å¼€äº†ç”Ÿæ—¥å’Œå¹´é¾„çš„åˆ— <a href="https://github.com/siwei-io/talks/files/10152923/world_cup_squads.csv" target="_blank" rel="noopener noreferrer">world_cup_squads_v0.csv</a></p>
<p>å®ƒåƒè¿™æ ·ï¼ŒåŒ…å«çš„ä¿¡æ¯æœ‰ï¼šçƒé˜Ÿã€å°ç»„ã€ç¼–å·ã€ä½ç½®ã€çƒå‘˜åå­—ã€ç”Ÿæ—¥ã€å¹´é¾„ã€å‚åŠ å›½é™…æ¯”èµ›åœºæ¬¡ã€è¿›çƒæ•°ã€æœå½¹ä¿±ä¹éƒ¨ã€‚</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Team,Group,No.,Pos.,Player,DOB,Age,Caps,Goals,Club
</span></span><span class="line"><span class="cl">Ecuador,A,1,1GK,HernÃ¡n GalÃ­ndez,(1987-03-30)30 March 1987,35,12,0,Aucas
</span></span><span class="line"><span class="cl">Ecuador,A,2,2DF,FÃ©lix Torres,(1997-01-11)11 January 1997,25,17,2,Santos Laguna
</span></span><span class="line"><span class="cl">Ecuador,A,3,2DF,Piero HincapiÃ©,(2002-01-09)9 January 2002,20,21,1,Bayer Leverkusen
</span></span><span class="line"><span class="cl">Ecuador,A,4,2DF,Robert Arboleda,(1991-10-22)22 October 1991,31,33,2,SÃ£o Paulo
</span></span><span class="line"><span class="cl">Ecuador,A,5,3MF,JosÃ© Cifuentes,(1999-03-12)12 March 1999,23,11,0,Los Angeles FC
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ‰‹åŠ¨åˆ é™¤äº† CSV è¡¨å¤´ <a href="https://github.com/siwei-io/talks/files/10152974/world_cup_squads_no_headers.csv" target="_blank" rel="noopener noreferrer">world_cup_squads_no_headers.csv</a></li>
</ul>
<h2 id="å›¾æ–¹æ³•é¢„æµ‹2022ä¸–ç•Œæ¯" class="headerLink">
    <a href="#%e5%9b%be%e6%96%b9%e6%b3%95%e9%a2%84%e6%b5%8b2022%e4%b8%96%e7%95%8c%e6%9d%af" class="header-mark"></a>3 å›¾æ–¹æ³•é¢„æµ‹2022ä¸–ç•Œæ¯</h2><h3 id="å›¾å»ºæ¨¡" class="headerLink">
    <a href="#%e5%9b%be%e5%bb%ba%e6%a8%a1" class="header-mark"></a>3.1 å›¾å»ºæ¨¡</h3><blockquote>
<p>å‰æï¼Œæœ¬æ–‡ä½¿ç”¨ NebulaGraph å’Œ NebulaGraph Explorerï¼Œä½ å¯ä»¥åœ¨é˜¿é‡Œäº‘ä¸Šå…è´¹ç”³è¯·åŠä¸ªæœˆçš„è¯•ç”¨ï¼Œå…¥å£é“¾æ¥æ˜¯ğŸ‘‰ğŸ» <a href="http://c.nxw.so/d52oz" target="_blank" rel="noopener noreferrer">http://c.nxw.so/d52oz</a> ï¼Œä¸è¦è¢«è¿™ä¸ªé™Œç”Ÿçš„çŸ­é“¾æ¥åŸŸåå“åˆ°ï¼Œå®ƒåªæ˜¯å¸®åŠ©æˆ‘ä»¬ç»Ÿè®¡æœ‰å¤šå°‘åŒå­¦é€šè¿‡è¿™é‡Œè®¿é—®åˆ° <a href="https://market.aliyun.com" target="_blank" rel="noopener noreferrer">https://market.aliyun.com</a> è€Œå·²ã€‚</p>
</blockquote>
<p>å›¾å»ºæ¨¡ï¼ˆGraph Modelingï¼‰æ˜¯æŠŠçœŸå®ä¸–ç•Œä¿¡æ¯ä»¥â€ç‚¹&ndash;&gt;è¾¹â€œçš„å›¾å½¢å¼å»æŠ½è±¡ä¸è¡¨ç¤ºã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬æ ¹æ®å…¬å…±é¢†åŸŸèƒ½å¤Ÿå®¹æ˜“è·å¾—ä¿¡æ¯ã€æŠŠå®ƒæ˜ å°„æˆå¦‚ä¸‹çš„ç‚¹ä¸è¾¹ï¼š</p>
<p>ç‚¹ï¼š</p>
<ul>
<li>playerï¼ˆçƒå‘˜ï¼‰</li>
<li>teamï¼ˆçƒé˜Ÿï¼‰</li>
<li>groupï¼ˆå°ç»„ï¼‰</li>
<li>clubï¼ˆä¿±ä¹éƒ¨ï¼‰</li>
</ul>
<p>è¾¹ï¼š</p>
<ul>
<li>groupedinï¼ˆçƒé˜Ÿå±äºå“ªä¸€å°ç»„ï¼‰</li>
<li>belongtoï¼ˆé˜Ÿå‘˜å±äºå›½å®¶é˜Ÿï¼‰</li>
<li>serveï¼ˆé˜Ÿå‘˜åœ¨ä¿±ä¹éƒ¨æœå½¹ï¼‰</li>
</ul>
<p>è€Œé˜Ÿå‘˜çš„å¹´é¾„ã€å‚åŠ å›½é™…åœºæ¬¡ï¼ˆcapsï¼‰ã€è¿›çƒæ•°ï¼ˆgoalsï¼‰åˆ™å¾ˆè‡ªç„¶ä½œä¸º player è¿™ä¸€ç±»ç‚¹çš„å±æ€§ã€‚</p>
<p>ä¸‹å›¾æ˜¯è¿™ä¸ª schema åœ¨ NebulaGraph Studio/Explorerï¼ˆåè¾¹ç§° Studio/Explorerï¼‰ ä¸­çš„æˆªå›¾ï¼š</p>
<p><figure><a class="lightgallery" href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/schema_fifa.webp" title="schema_fifa" data-thumbnail="/chatgpt-and-nebulagraph-predict-fifa-world-cup/schema_fifa.webp">
        <img
            
            loading="lazy"
            src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/schema_fifa.webp"
            srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/schema_fifa.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/schema_fifa.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/schema_fifa.webp 2x"
            sizes="auto"
            alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/schema_fifa.webp">
    </a></figure></p>
<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å³ä¸Šè§’æŠŠå®ƒä¿å­˜ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å›¾ç©ºé—´ï¼Œåº”ç”¨è¿™ä¸ªå›¾å»ºæ¨¡åˆ°å›¾ç©ºé—´é‡Œã€‚</p>
<blockquote>
<p>æ³¨ï¼šå‚è€ƒæ–‡æ¡£ <a href="https://docs.nebula-graph.com.cn/3.3.0/nebula-explorer/db-management/draft/" target="_blank" rel="noopener noreferrer">https://docs.nebula-graph.com.cn/3.3.0/nebula-explorer/db-management/draft/</a></p>
</blockquote>
<h3 id="å¯¼å…¥æ•°æ®è¿›-nebulagraph" class="headerLink">
    <a href="#%e5%af%bc%e5%85%a5%e6%95%b0%e6%8d%ae%e8%bf%9b-nebulagraph" class="header-mark"></a>3.2 å¯¼å…¥æ•°æ®è¿› NebulaGraph</h3><p>æœ‰äº†å›¾å»ºæ¨¡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¹‹å‰çš„ CSV æ–‡ä»¶ï¼ˆæ— è¡¨å¤´ç‰ˆæœ¬ï¼‰ä¸Šä¼ åˆ° Studio æˆ–è€… Explorer é‡Œï¼Œé€šè¿‡ç‚¹ã€é€‰å…³è”ä¸åŒçš„åˆ—åˆ°ç‚¹è¾¹ä¸­çš„ vid å’Œå±æ€§ï¼š</p>
<p><figure><a class="lightgallery" href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_config_mapping.webp" title="/chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_config_mapping.webp" data-thumbnail="/chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_config_mapping.webp">
        <img
            
            loading="lazy"
            src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_config_mapping.webp"
            srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_config_mapping.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_config_mapping.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_config_mapping.webp 2x"
            sizes="auto"
            alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_config_mapping.webp">
    </a></figure></p>
<p>ä¹‹åç‚¹å‡»å¯¼å…¥ï¼Œå°±æŠŠæ•´ä¸ªå›¾å¯¼å…¥åˆ° NebulaGraph äº†ï¼ŒæˆåŠŸä¹‹åï¼Œæˆ‘ä»¬è¿˜å¾—åˆ°äº†æ•´ä¸ªcsv &ndash;&gt; Nebula Importer çš„å…³è”é…ç½®æ–‡ä»¶ï¼š<a href="https://github.com/siwei-io/talks/files/10164014/config_fifa.yml.txt" target="_blank" rel="noopener noreferrer">nebula_importer_config_fifa.yml</a>ï¼Œä½ å¯ä»¥ç›´æ¥æ‹–æ‹½æ•´ä¸ªé…ç½®ï¼Œä¸ç”¨è‡ªå·±å»é…ç½®å®ƒäº†ã€‚</p>
<p><figure><a class="lightgallery" href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_log.webp" title="/chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_log.webp" data-thumbnail="/chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_log.webp">
        <img
            
            loading="lazy"
            src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_log.webp"
            srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_log.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_log.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_log.webp 2x"
            sizes="auto"
            alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/importer_log.webp">
    </a></figure></p>
<blockquote>
<p>æ³¨ï¼šå‚è€ƒæ–‡æ¡£ <a href="https://docs.nebula-graph.com.cn/3.3.0/nebula-explorer/db-management/11.import-data/" target="_blank" rel="noopener noreferrer">https://docs.nebula-graph.com.cn/3.3.0/nebula-explorer/db-management/11.import-data/</a></p>
</blockquote>
<p>å¯¼å…¥ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ schema ç•Œé¢é‡ŒæŸ¥çœ‹æ•°æ®ç»Ÿè®¡ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ 831 åçƒå‘˜å‚åŠ äº† 2022 å¡å¡”å°”ä¸–ç•Œæ¯ï¼Œä»–ä»¬æœå½¹åœ¨ 295 ä¸ªä¸åŒçš„ä¿±ä¹éƒ¨ï¼š</p>
<p><figure><a class="lightgallery" href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/data_stats.webp" title="/chatgpt-and-nebulagraph-predict-fifa-world-cup/data_stats.webp" data-thumbnail="/chatgpt-and-nebulagraph-predict-fifa-world-cup/data_stats.webp">
        <img
            
            loading="lazy"
            src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/data_stats.webp"
            srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/data_stats.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/data_stats.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/data_stats.webp 2x"
            sizes="auto"
            alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/data_stats.webp">
    </a></figure></p>
<blockquote>
<p>æ³¨ï¼šå‚è€ƒæ–‡æ¡£ <a href="https://docs.nebula-graph.com.cn/3.3.0/nebula-explorer/db-management/10.create-schema/#_6" target="_blank" rel="noopener noreferrer">https://docs.nebula-graph.com.cn/3.3.0/nebula-explorer/db-management/10.create-schema/#_6</a></p>
</blockquote>
<h3 id="æ¢ç´¢æ•°æ®" class="headerLink">
    <a href="#%e6%8e%a2%e7%b4%a2%e6%95%b0%e6%8d%ae" class="header-mark"></a>3.3 æ¢ç´¢æ•°æ®</h3><h4 id="æŸ¥è¯¢æ•°æ®" class="headerLink">
    <a href="#%e6%9f%a5%e8%af%a2%e6%95%b0%e6%8d%ae" class="header-mark"></a>3.3.1 æŸ¥è¯¢æ•°æ®</h4><p>ä¸‹é¢ï¼Œæˆ‘ä»¬è¯•ç€æŠŠæ‰€æœ‰çš„æ•°æ®å±•ç¤ºå‡ºæ¥çœ‹çœ‹å§ï¼Œé¦–å…ˆï¼Œå€ŸåŠ© NebulaGraph Explorerï¼Œæˆ‘ç”¨æ‹–æ‹½çš„æ–¹å¼ç”»å‡ºæ¥ä»»æ„ç±»å‹çš„ç‚¹ï¼ˆTAGï¼‰å’Œä»»æ„ç±»å‹ç‚¹ï¼ˆTAGï¼‰ä¹‹é—´çš„è¾¹ï¼Œè¿™é‡Œæˆ‘ä»¬çŸ¥é“æ‰€æœ‰çš„ç‚¹éƒ½æ˜¯è‡³å°‘åŒ…å«åœ¨ä¸€ä¸ªè¾¹é‡Œçš„ï¼Œæ‰€ä»¥ä¸ä¼šæ¼æ‰ä»»ä½•å­¤ç«‹çš„ç‚¹ã€‚</p>
<p><figure><a class="lightgallery" href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-0.webp" title="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-0.webp" data-thumbnail="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-0.webp">
        <img
            
            loading="lazy"
            src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-0.webp"
            srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-0.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-0.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-0.webp 2x"
            sizes="auto"
            alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-0.webp">
    </a></figure></p>
<p>è®©å®ƒå¸®æˆ‘ç”ŸæˆæŸ¥è¯¢çš„è¯­å¥ï¼Œè¿™é‡Œï¼Œå®ƒé»˜è®¤ LIMIT 100 äº†ï¼Œæˆ‘ä»¬æ‰‹åŠ¨æ”¹å¤§ä¸€äº›ï¼ˆ LIMIT 10000ï¼‰ï¼Œè®©å®ƒåœ¨ Console é‡Œæ‰§è¡Œã€‚</p>
<p><figure><a class="lightgallery" href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-1.webp" title="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-1.webp" data-thumbnail="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-1.webp">
        <img
            
            loading="lazy"
            src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-1.webp"
            srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-1.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-1.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-1.webp 2x"
            sizes="auto"
            alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query-builder-1.webp">
    </a></figure></p>
<h4 id="åˆæ­¥è§‚å¯Ÿæ•°æ®" class="headerLink">
    <a href="#%e5%88%9d%e6%ad%a5%e8%a7%82%e5%af%9f%e6%95%b0%e6%8d%ae" class="header-mark"></a>3.3.2 åˆæ­¥è§‚å¯Ÿæ•°æ®</h4><p>ç»“æœæ¸²æŸ“å‡ºæ¥æ˜¯è¿™æ ·å­ï¼Œå¯ä»¥çœ‹åˆ°å®ƒå¤©ç„¶å½¢æˆäº†ä¸€ç°‡ä¸€ç°‡çš„æ¨¡å¼ã€‚</p>
<p><figure><a class="lightgallery" href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bird_view.webp" title="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bird_view.webp" data-thumbnail="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bird_view.webp">
        <img
            
            loading="lazy"
            src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bird_view.webp"
            srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bird_view.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/bird_view.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/bird_view.webp 2x"
            sizes="auto"
            alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bird_view.webp">
    </a></figure></p>
<p>è¿™äº›å¤–å›´ã€å½¢æˆçš„ç°‡å¤šæ˜¯ä¸€äº›ç”±éä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æœ‰å…¨çƒå½±å“åŠ›çš„ä¿±ä¹éƒ¨ï¼Œå’Œéä¼ ç»Ÿçš„è¶³çƒå‰å®³çš„å›½å®¶é˜Ÿçš„çƒå‘˜ç»„æˆï¼Œå› ä¸ºé€šå¸¸è¿™äº›ä¿±ä¹éƒ¨åªæœ‰ä¸€ä¸¤ä¸ªçƒå‘˜ï¼Œè€Œä¸”ä»–ä»¬è¿˜é›†ä¸­åœ¨ä¸€ä¸ªå›½å®¶é˜Ÿã€åœ°åŒºï¼Œæ‰€ä»¥æ²¡æœ‰å’Œå¾ˆå¤šå…¶ä»–çƒå‘˜ã€å›½å®¶é˜Ÿäº§ç”Ÿè¿æ¥ã€‚</p>
<p><figure><a class="lightgallery" href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/edge_teams.webp" title="/chatgpt-and-nebulagraph-predict-fifa-world-cup/edge_teams.webp" data-thumbnail="/chatgpt-and-nebulagraph-predict-fifa-world-cup/edge_teams.webp">
        <img
            
            loading="lazy"
            src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/edge_teams.webp"
            srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/edge_teams.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/edge_teams.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/edge_teams.webp 2x"
            sizes="auto"
            alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/edge_teams.webp">
    </a></figure></p>
<h4 id="å›¾ç®—æ³•è¾…åŠ©åˆ†æ" class="headerLink">
    <a href="#%e5%9b%be%e7%ae%97%e6%b3%95%e8%be%85%e5%8a%a9%e5%88%86%e6%9e%90" class="header-mark"></a>3.3.3 å›¾ç®—æ³•è¾…åŠ©åˆ†æ</h4><p>åœ¨æˆ‘ç‚¹å‡»äº† Explorer ä¸­çš„ä¸¤ä¸ªæŒ‰é’®ä¹‹åï¼ˆè¯¦ç»†å‚è€ƒåè¾¹çš„æ–‡æ¡£é“¾æ¥ï¼‰ï¼Œåœ¨æµè§ˆå™¨é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•´ä¸ªå›¾å·²ç»å˜æˆï¼š</p>
<p><figure><a class="lightgallery" href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/Barcelona.webp" title="/chatgpt-and-nebulagraph-predict-fifa-world-cup/Barcelona.webp" data-thumbnail="/chatgpt-and-nebulagraph-predict-fifa-world-cup/Barcelona.webp">
        <img
            
            loading="lazy"
            src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/Barcelona.webp"
            srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/Barcelona.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/Barcelona.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/Barcelona.webp 2x"
            sizes="auto"
            alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/Barcelona.webp">
    </a></figure></p>
<blockquote>
<p>æ³¨ï¼šè¿™éƒ¨åˆ†åŠŸèƒ½å¯ä»¥å‚è€ƒæ–‡æ¡£ <a href="https://docs.nebula-graph.com.cn/3.3.0/nebula-explorer/graph-explorer/graph-algorithm/" target="_blank" rel="noopener noreferrer">https://docs.nebula-graph.com.cn/3.3.0/nebula-explorer/graph-explorer/graph-algorithm/</a></p>
</blockquote>
<p>è¿™é‡Œï¼Œåˆ©ç”¨åˆ°äº†ä¸¤ä¸ªå›¾ç®—æ³•æ¥åˆ†æè¿™é‡Œçš„æ´å¯Ÿï¼š</p>
<ol>
<li>åˆ©ç”¨ç‚¹çš„å‡ºå…¥åº¦ï¼Œæ”¹å˜ä»–ä»¬çš„æ˜¾ç¤ºå¤§å°çªå‡ºé‡è¦ç¨‹åº¦</li>
<li>åˆ©ç”¨ Louvain ç®—æ³•åŒºåˆ†ç‚¹çš„ç¤¾åŒºåˆ†å‰²</li>
</ol>
<p>å¯ä»¥çœ‹åˆ°çº¢è‰²çš„å¤§ç‚¹æ˜¯é¼é¼å¤§åçš„å·´å¡ç½—é‚£ï¼Œè€Œå®ƒçš„çƒå‘˜ä»¬ä¹Ÿè¢«çº¢è‰²æ ‡è®°äº†ã€‚</p>
<h3 id="é¢„æµ‹å† å†›ç®—æ³•" class="headerLink">
    <a href="#%e9%a2%84%e6%b5%8b%e5%86%a0%e5%86%9b%e7%ae%97%e6%b3%95" class="header-mark"></a>3.4 é¢„æµ‹å† å†›ç®—æ³•</h3><p>ä¸ºäº†èƒ½å……åˆ†åˆ©ç”¨å›¾çš„é­”æ³•ï¼ˆä¸å›¾ä¸Šçš„éšå«æ¡ä»¶ã€ä¿¡æ¯ï¼‰ï¼Œæˆ‘çš„æ€è·¯æ˜¯é€‰æ‹©ä¸€ç§åˆ©ç”¨é“¾æ¥è¿›è¡ŒèŠ‚ç‚¹é‡è¦ç¨‹åº¦åˆ†æçš„å›¾ç®—æ³•ï¼Œæ‰¾å‡ºæ‹¥æœ‰æ›´é«˜é‡è¦æ€§çš„ç‚¹ï¼Œå¯¹ä»–ä»¬å…¨å±€è¿­ä»£ã€æ’åºï¼Œä»è€Œè·å¾—å‰å‡ åçš„å›½å®¶é˜Ÿæ’åã€‚</p>
<p>è¿™äº›æ–¹æ³•å…¶å®å°±ä½“ç°åœ¨å‰å®³çš„çƒå‘˜åŒæ—¶æ‹¥æœ‰æ›´å¤§çš„ç¤¾åŒºã€è¿æ¥åº¦ï¼ŒåŒæ—¶ï¼Œä¸ºäº†å¢åŠ ä¼ ç»Ÿå¼ºé˜Ÿä¹‹é—´çš„åŒºåˆ†åº¦ï¼Œæˆ‘å‡†å¤‡æŠŠå‡ºåœºç‡ã€è¿›çƒæ•°çš„ä¿¡æ¯ä¹Ÿè€ƒè™‘è¿›æ¥ã€‚</p>
<p>æœ€ç»ˆï¼Œæˆ‘çš„ç®—æ³•æ˜¯ï¼š</p>
<ul>
<li>å–å‡ºæ‰€æœ‰çš„ (çƒå‘˜)-æœå½¹-&gt;(ä¿±ä¹éƒ¨) çš„å…³ç³»ï¼Œè¿‡æ»¤å…¶ä¸­è¿›çƒæ•°è¿‡å°‘ã€å•åœºè¿›çƒè¿‡å°‘çš„çƒå‘˜ï¼ˆä»¥å¹³è¡¡ä¸€äº›å¼±é˜Ÿçš„è€çƒå‘˜å¸¦æ¥çš„è¿‡å¤§å½±å“ï¼‰</li>
<li>ä»æ‰€æœ‰è¿‡æ»¤ä¹‹åçš„çƒå‘˜ä¸­å‘å¤–æ¢ç´¢ï¼Œè·å¾—å›½å®¶é˜Ÿ</li>
<li>åœ¨ä»¥ä¸Šçš„å­å›¾ä¸Šè¿è¡Œ Betweenness Centrality ç®—æ³•ï¼Œè®¡ç®—èŠ‚ç‚¹é‡è¦åº¦è¯„åˆ†</li>
</ul>
<h4 id="ç®—æ³•è¿‡ç¨‹" class="headerLink">
    <a href="#%e7%ae%97%e6%b3%95%e8%bf%87%e7%a8%8b" class="header-mark"></a>3.4.1 ç®—æ³•è¿‡ç¨‹</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬å–å‡ºæ‰€æœ‰è¿›çƒæ•°è¶…è¿‡ 10ï¼Œåœºå‡è¿›çƒè¶…è¿‡ 0.2 çš„ (çƒå‘˜)-æœå½¹-&gt;(ä¿±ä¹éƒ¨) çš„å­å›¾ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MATCH ()-[e]-&gt;()
</span></span><span class="line"><span class="cl">WITH e LIMIT 10000
</span></span><span class="line"><span class="cl">WITH e AS e WHERE e.goals &gt; 10 AND toFloat(e.goals)/e.caps &gt; 0.2
</span></span><span class="line"><span class="cl">RETURN e
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨ï¼šä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘æŠŠè¿›çƒæ•°å’Œå‡ºåœºæ•°ä¹Ÿä½œä¸ºäº† serve è¾¹ä¸Šçš„å±æ€§äº†ã€‚</p>
</blockquote>
<p><figure><a class="lightgallery" href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query_step0.webp" title="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query_step0.webp" data-thumbnail="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query_step0.webp">
        <img
            
            loading="lazy"
            src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query_step0.webp"
            srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query_step0.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/query_step0.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/query_step0.webp 2x"
            sizes="auto"
            alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/query_step0.webp">
    </a></figure></p>
<p>ç„¶åï¼Œæˆ‘ä»¬å…¨é€‰å›¾ä¸Šçš„æ‰€æœ‰ç‚¹ï¼Œç‚¹å‡»å·¦è¾¹çš„å·¥å…·æ ï¼Œé€‰æ‹©å‡ºæ–¹å‘çš„ <code>belongto</code> è¾¹ï¼Œå‘å¤–è¿›è¡Œå›¾æ‹“å±•ï¼ˆéå†ï¼‰ï¼ŒåŒæ—¶é€‰æ‹©å°†æ‹“å±•å¾—åˆ°çš„æ–°ç‚¹æ ‡è®°ä¸ºæ——å¸œçš„ iconï¼š</p>
<p><figure><a class="lightgallery" href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/treversal_step1.webp" title="treversal_step1" data-thumbnail="/chatgpt-and-nebulagraph-predict-fifa-world-cup/treversal_step1.webp">
        <img
            
            loading="lazy"
            src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/treversal_step1.webp"
            srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/treversal_step1.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/treversal_step1.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/treversal_step1.webp 2x"
            sizes="auto"
            alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/treversal_step1.webp">
    </a></figure></p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬è·å¾—äº†æœ€ç»ˆçš„å­å›¾ï¼Œæˆ‘ä»¬åˆ©ç”¨å·¥å…·æ é‡Œçš„æµè§ˆå™¨å†…çš„å›¾ç®—æ³•åŠŸèƒ½ï¼Œæ‰§è¡Œ BNCï¼ˆBetweenness Centralityï¼‰</p>
<p><figure><a class="lightgallery" href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bnc_step2.webp" title="bnc_step2" data-thumbnail="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bnc_step2.webp">
        <img
            
            loading="lazy"
            src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bnc_step2.webp"
            srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bnc_step2.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/bnc_step2.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/bnc_step2.webp 2x"
            sizes="auto"
            alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bnc_step2.webp">
    </a></figure></p>
<p>ç„¶åï¼Œè¿™ä¸ªå­å›¾å˜æˆäº†è¿™æ ·å­ï¼š</p>
<p><figure><a class="lightgallery" href="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bnc_predict.webp" title="bnc_predict" data-thumbnail="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bnc_predict.webp">
        <img
            
            loading="lazy"
            src="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bnc_predict.webp"
            srcset="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bnc_predict.webp, /chatgpt-and-nebulagraph-predict-fifa-world-cup/bnc_predict.webp 1.5x, /chatgpt-and-nebulagraph-predict-fifa-world-cup/bnc_predict.webp 2x"
            sizes="auto"
            alt="/chatgpt-and-nebulagraph-predict-fifa-world-cup/bnc_predict.webp">
    </a></figure></p>
<h2 id="é¢„æµ‹ç»“æœ" class="headerLink">
    <a href="#%e9%a2%84%e6%b5%8b%e7%bb%93%e6%9e%9c" class="header-mark"></a>4 é¢„æµ‹ç»“æœ</h2><p>æœ€ç»ˆï¼Œæˆ‘ä»¬æ ¹æ® Betweenness Centrality çš„å€¼ï¼Œæ’åºï¼Œå¯ä»¥å¾—åˆ°æœ€ç»ˆçš„è·èƒœçƒé˜Ÿåº”è¯¥æ˜¯ï¼šå·´è¥¿ ğŸ‡§ğŸ‡·ï¼</p>
<p>å…¶æ¬¡æ˜¯æ¯”åˆ©æ—¶ã€å¾·å›½ã€è‹±æ ¼å…°ã€æ³•å›½ã€é˜¿æ ¹å»·ï¼Œè®©æˆ‘ä»¬ç­‰ä¸¤ä¸ªç¤¼æ‹œå›æ¥çœ‹çœ‹é¢„æµ‹ç»“æœæ˜¯å¦å‡†ç¡®å§ :Dã€‚</p>
<p>æ³¨ï¼šæ’åºæ•°æ®ï¼ˆå…¶ä¸­è¿˜æœ‰éå‚èµ›çƒé˜Ÿçš„ç‚¹ï¼‰</p>
<table>
<thead>
<tr>
<th>Vertex</th>
<th><strong>Betweenness Centrality</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Brazil</strong>ğŸ‡§ğŸ‡·</td>
<td>3499</td>
</tr>
<tr>
<td><strong>Paris Saint-Germain</strong></td>
<td>3073.3333333333300</td>
</tr>
<tr>
<td><strong>Neymar</strong></td>
<td>3000</td>
</tr>
<tr>
<td><strong>Tottenham Hotspur</strong></td>
<td>2740</td>
</tr>
<tr>
<td><strong>Belgium</strong>ğŸ‡§ğŸ‡ª</td>
<td>2587.833333333330</td>
</tr>
<tr>
<td><strong>Richarlison</strong></td>
<td>2541</td>
</tr>
<tr>
<td><strong>Kevin De Bruyne</strong></td>
<td>2184</td>
</tr>
<tr>
<td><strong>Manchester City</strong></td>
<td>2125</td>
</tr>
<tr>
<td><strong>Ä°lkay GÃ¼ndoÄŸan</strong></td>
<td>2064</td>
</tr>
<tr>
<td><strong>Germany</strong>ğŸ‡©ğŸ‡ª</td>
<td>2046</td>
</tr>
<tr>
<td><strong>Harry Kane (captain</strong></td>
<td>1869</td>
</tr>
<tr>
<td><strong>England</strong>ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿</td>
<td>1864</td>
</tr>
<tr>
<td><strong>France</strong>ğŸ‡«ğŸ‡·</td>
<td>1858.6666666666700</td>
</tr>
<tr>
<td><strong>Argentina</strong>ğŸ‡¦ğŸ‡·</td>
<td>1834.6666666666700</td>
</tr>
<tr>
<td><strong>Bayern Munich</strong></td>
<td>1567</td>
</tr>
<tr>
<td><strong>Kylian MbappÃ©</strong></td>
<td>1535.3333333333300</td>
</tr>
<tr>
<td><strong>Lionel Messi (captain</strong></td>
<td>1535.3333333333300</td>
</tr>
<tr>
<td><strong>Gabriel Jesus</strong></td>
<td>1344</td>
</tr>
</tbody>
</table>
<blockquote>
<p>é¢˜å›¾ï¼šè¿™ä¸ªæ–‡ç« çš„å›¾ä¹Ÿæ˜¯ç”¨ OpenAI DALL-E 2 ç”Ÿæˆï¼Œå¹¶ç”¨ DALL-E 2 Outpainting æ‰©å……çš„ï¼Œ<a href="https://user-images.githubusercontent.com/1651790/205881462-ff007725-e270-4b1e-9062-7702f01021c1.png" target="_blank" rel="noopener noreferrer">åŸå›¾</a>ã€‚</p>
</blockquote>]]></description>
</item><item>
    <title>åŸºäºå¼€æºæŠ€æœ¯æ ˆçš„æ•°æ®è¡€ç¼˜ã€æ²»ç†å‚è€ƒè§£å†³æ–¹æ¡ˆ</title>
    <link>https://siwei.io/data-lineage-oss-ref-solution/</link>
    <pubDate>Fri, 25 Nov 2022 16:20:43 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/data-lineage-oss-ref-solution/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/data-lineage-oss-ref-solution/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>ä¹Ÿè®¸æˆ‘ä»¬æ²¡æœ‰å¿…è¦ä»å¤´åœ¨ NebulaGraph ä¸Šæ­å»ºè‡ªå·±çš„æ•°æ®è¡€ç¼˜é¡¹ç›®ï¼Œæœ¬æ–‡åˆ†äº«å¦‚ä½•ç”¨å¼€æºã€ç°ä»£çš„ DataOpsã€ETLã€Dashboardã€å…ƒæ•°æ®ã€æ•°æ®è¡€ç¼˜ç®¡ç†ç³»ç»Ÿæ„å»ºå¤§æ•°æ®æ²»ç†åŸºç¡€è®¾æ–½</p>
</blockquote>
<h2 id="å…ƒæ•°æ®æ²»ç†ç³»ç»Ÿ" class="headerLink">
    <a href="#%e5%85%83%e6%95%b0%e6%8d%ae%e6%b2%bb%e7%90%86%e7%b3%bb%e7%bb%9f" class="header-mark"></a>1 å…ƒæ•°æ®æ²»ç†ç³»ç»Ÿ</h2><p><strong>å…ƒæ•°æ®æ²»ç†</strong>ç³»ç»Ÿæ˜¯ä¸€ä¸ªæä¾›äº†æ‰€æœ‰æ•°æ®åœ¨å“ªã€å®ƒä»¬çš„æ ¼å¼åŒ–æ–¹å¼ã€ç”Ÿæˆã€è½¬æ¢ã€ä¾èµ–ã€å‘ˆç°å’Œæ‰€å±çš„<strong>ä¸€ç«™å¼è§†å›¾</strong>ã€‚</p>
<p>å…ƒæ•°æ®æ²»ç†ç³»ç»Ÿæ˜¯æ‰€æœ‰æ•°æ®ä»“åº“ã€æ•°æ®åº“ã€è¡¨ã€ä»ªè¡¨æ¿ã€ETL ä½œä¸šç­‰çš„<strong>ç›®å½•æ¥å£</strong>ï¼ˆcatalogï¼‰ï¼Œæœ‰äº†å®ƒï¼Œæˆ‘ä»¬å°±ä¸ç”¨åœ¨ç¾¤é‡Œå–Šâ€œå¤§å®¶å¥½ï¼Œæˆ‘å¯ä»¥æ›´æ”¹è¿™ä¸ªè¡¨çš„ schema å—ï¼Ÿâ€ï¼Œ â€œè¯·é—®è°çŸ¥é“æˆ‘å¦‚ä½•æ‰¾åˆ° table-view-foo-bar çš„åŸå§‹æ•°æ®ï¼Ÿâ€ï¼Œä¸€ä¸ªæˆç†Ÿçš„æ•°æ®æ²»ç†æ–¹æ¡ˆä¸­çš„å…ƒæ•°æ®æ²»ç†ç³»ç»Ÿï¼Œå¯¹æˆè§„æ¨¡çš„æ•°æ®å›¢é˜Ÿæ¥è¯´éå¸¸å¿…è¦ã€‚</p>
<p>å¯¹äºå¦ä¸€ä¸ªè¯ï¼š<strong>æ•°æ®è¡€ç¼˜</strong>åˆ™æ˜¯ä¼—å¤šéœ€è¦ç®¡ç†çš„å…ƒæ•°æ®ä¹‹ä¸€ï¼Œä¾‹å¦‚ï¼ŒæŸäº› Dashboard æ˜¯ æŸä¸€ä¸ª Table View çš„ä¸‹æ¸¸ï¼Œè€Œè¿™ä¸ª Table View åˆæ˜¯ä»å¦å¤–ä¸¤ä¸ªä¸Šæ¸¸çš„è¡¨ JOIN è€Œæ¥ä¸¤ã€‚ æˆ‘ä»¬æ˜¾ç„¶åº”è¯¥æ¸…æ™°çš„æŒæ¡ã€ç®¡ç†è¿™äº›ä¿¡æ¯ï¼Œå»æ„å»ºä¸€ä¸ªå¯ä¿¡ã€å¯æ§çš„ç³»ç»Ÿå’Œæ•°æ®è´¨é‡æ§åˆ¶ä½“ç³»ã€‚</p>
<h2 id="å‚è€ƒè§£å†³æ–¹æ¡ˆ" class="headerLink">
    <a href="#%e5%8f%82%e8%80%83%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88" class="header-mark"></a>2 å‚è€ƒè§£å†³æ–¹æ¡ˆ</h2><h3 id="æ–¹æ¡ˆçš„åŠ¨æœº" class="headerLink">
    <a href="#%e6%96%b9%e6%a1%88%e7%9a%84%e5%8a%a8%e6%9c%ba" class="header-mark"></a>2.1 æ–¹æ¡ˆçš„åŠ¨æœº</h3><p>å…ƒæ•°æ®å’Œæ•°æ®è¡€ç¼˜æœ¬è´¨ä¸Šéå¸¸é€‚åˆå›¾æ•°æ®å»ºæ¨¡ã€å›¾æ•°æ®åº“çš„åœºæ™¯ã€‚è¿™é‡Œå…¸å‹çš„æŸ¥è¯¢å°±æ˜¯é¢å‘å›¾å…³ç³»çš„æŸ¥è¯¢äº†ï¼Œåƒâ€œæŸ¥æ‰¾æ¯ä¸ªç»™å®šç»„ä»¶ï¼ˆå³è¡¨ï¼‰çš„æ‰€æœ‰ n æ·±åº¦æ•°æ®è¡€ç¼˜â€å°±æ˜¯ä¸€ä¸ª NebulaGraph ä¸­çš„<code>FIND ALL PATH</code> æŸ¥è¯¢ã€‚</p>
<p>ä½œä¸º NebulaGraph ç¤¾åŒºä¸­çš„ä¸€å‘˜ï¼Œæˆ‘å‘ç°äººä»¬åœ¨è®ºå›ã€ç¾¤é‡Œè®¨è®ºçš„æŸ¥è¯¢å’Œå›¾å»ºæ¨¡æ€»èƒ½çœ‹å‡ºæ¥å¾ˆå¤šäººéƒ½åœ¨ NebulaGraph ä¸Šä»å¤´æ­å»ºè‡ªå·±çš„æ•°æ®è¡€ç¼˜ç³»ç»Ÿï¼Œè€Œè¿™äº›å·¥ä½œçœ‹èµ·æ¥å¤§å¤šæ•°éƒ½æ˜¯é‡å¤é€ è½®å­ï¼ˆè€Œä¸”è½®å­å¹¶ä¸å®¹æ˜“é€ ï¼‰ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ ·çš„å…ƒæ•°æ®æ²»ç†ç³»ç»Ÿçš„è½®å­é‡Œï¼Œéƒ½éœ€è¦é‚£äº›åŠŸèƒ½ç»„ä»¶ï¼š</p>
<ul>
<li>å…ƒæ•°æ® extractor
<ul>
<li>è¿™éƒ¨åˆ†éœ€è¦ä»æ•°æ®æ ˆçš„ä¸åŒæ–¹ï¼ˆå¦‚æ•°æ®åº“ã€æ•°ä»“ã€Dashboardï¼Œç”šè‡³ä» ETL Pipeline å’Œåº”ç”¨ã€æœåŠ¡ç­‰ç­‰ï¼‰ä¸­ä»¥æ‹‰æˆ–è€…æ¨çš„æ–¹å¼è·å–ã€‚</li>
</ul>
</li>
<li>å…ƒæ•°æ®å­˜å‚¨
<ul>
<li>å¯ä»¥å­˜åœ¨æ•°æ®åº“ã€å›¾æ•°æ®åº“é‡Œï¼Œæˆ–è€…æœ‰æ—¶å€™å­˜æˆè¶…å¤§çš„ JSON manifest æ–‡ä»¶éƒ½è¡Œ</li>
</ul>
</li>
<li>å…ƒæ•°æ®ç›®å½•æ¥å£ç³»ç»Ÿï¼ˆCatalogï¼‰
<ul>
<li>æä¾› API å’Œ/æˆ– GUI ç•Œé¢ä»¥è¯»å–/å†™å…¥å…ƒæ•°æ®å’Œæ•°æ®è¡€ç¼˜çš„ç³»ç»Ÿ</li>
</ul>
</li>
</ul>
<p>åœ¨ NebulaGraph ç¤¾åŒºä¸­ï¼Œæˆ‘çœ‹åˆ°ä¸å°‘äººå› ä¸ºæé—®çš„æŸ¥è¯¢å’Œå»ºæ¨¡ä¸­æ˜æ˜¾æœ‰æ•°æ®è¡€ç¼˜çš„ç—•è¿¹ï¼Œæ„è¯†åˆ°å¤§å®¶éƒ½åœ¨ä»å¤´æ­å»ºæ•°æ®è¡€ç¼˜ç³»ç»Ÿã€‚è€ƒè™‘åˆ°ç³»ç»Ÿä¸­å…ƒæ•°æ®çš„æå–å¯¹è±¡éƒ½æ˜¯ä»å„ç§çŸ¥åæ•°æ®åº“ã€æ•°ä»“ã€æœ€ç»ˆçš„éœ€æ±‚ä¹Ÿå¤§ç›¸å¾„åº­ï¼Œè¿™ç§é‡å¤çš„å¼€å‘ã€ç ”ç©¶ã€æ¢ç´¢æ˜¯ä¸€ç§å¤§å¤§çš„æµªè´¹ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘å‡†å¤‡æ­å»ºä¸€ä¸ªèƒ½å¤Ÿå¯å‘å¤§å®¶çš„å‚è€ƒæ•°æ®è¡€ç¼˜ã€æ²»ç†æ–¹æ¡ˆï¼Œåˆ©ç”¨åˆ°å¸‚é¢ä¸Šæœ€å¥½çš„å¼€æºé¡¹ç›®ã€‚å¸Œæœ›èƒ½è®©æ‰“ç®—åœ¨ NebulaGraph ä¸Šå®šä¹‰å’Œè¿­ä»£è‡ªå·±çš„ Graph Model å¹¶åˆ›å»ºå†…éƒ¨å…ƒæ•°æ®å’Œ pipeline çš„äººå¯ä»¥ä»è¿™ä¸ªé¡¹ç›®ä¸­å—ç›Šï¼Œä»è€Œæ‹¥æœ‰ä¸€ä¸ªç›¸å¯¹å®Œå–„ã€è®¾è®¡ç²¾ç¾çš„å¼€ç®±å³ç”¨çš„å…ƒæ•°æ®æ²»ç†ç³»ç»Ÿï¼Œå’Œç›¸å¯¹æ›´å®Œå–„çš„å›¾æ¨¡å‹ã€‚</p>
<p>æˆ‘å°½é‡æŠŠè¿™ä¸ªæ–¹æ¡ˆåšçš„å®Œå¤‡ã€ç«¯åˆ°ç«¯ï¼ˆä¸åªæœ‰å…ƒæ•°æ®ç®¡ç†ï¼‰ï¼Œå¸Œæœ›ä¹Ÿèƒ½ä¸ºè€ƒè™‘åšåŸºäºå›¾åšæ•°æ®æ²»ç†çš„æ–°æ‰‹ä¸€äº›å¯å‘å’Œå‚è€ƒã€‚</p>
<p>ä¸‹å›¾æ˜¯æ•´ä¸ªæ–¹æ¡ˆçš„ç®€å•ç¤ºæ„å›¾ï¼š</p>
<p>å…¶ä¸­ä¸Šæ–¹æ˜¯å…ƒæ•°æ®çš„æ¥æºä¸å¯¼å…¥ã€ä¸‹æ–¹æ˜¯å…ƒæ•°æ®çš„å­˜å‚¨ä¸å±•ç¤ºã€å‘ç°ã€‚</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg" title="diagram-of-ref-project" data-thumbnail="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg"
            srcset="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg, https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg 1.5x, https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg">
    </a></figure></p>
<h3 id="æŠ€æœ¯æ ˆä»‹ç»" class="headerLink">
    <a href="#%e6%8a%80%e6%9c%af%e6%a0%88%e4%bb%8b%e7%bb%8d" class="header-mark"></a>2.2 æŠ€æœ¯æ ˆä»‹ç»</h3><p>ä¸‹è¾¹ä»‹ç»ä¸€ä¸‹å…¶ä¸­çš„æ¯ä¸€éƒ¨åˆ†ã€‚</p>
<h4 id="æ•°æ®åº“å’Œæ•°ä»“" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e5%ba%93%e5%92%8c%e6%95%b0%e4%bb%93" class="header-mark"></a>2.2.1 æ•°æ®åº“å’Œæ•°ä»“</h4><p>ä¸ºäº†å¤„ç†å’Œä½¿ç”¨åŸå§‹å’Œä¸­é—´æ•°æ®ï¼Œè¿™é‡Œä¸€å®šæ¶‰åŠè‡³å°‘ä¸€ä¸ªæ•°æ®åº“æˆ–è€…æ•°ä»“ã€‚</p>
<p>å®ƒå¯ä»¥æ˜¯ Hiveã€Apache Deltaã€TiDBã€Cassandraã€MySQL æˆ– Postgresï¼Œåœ¨è¿™ä¸ªå‚è€ƒé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€‰ä¸€ä¸ªç®€å•ã€æµè¡Œçš„ Postgresã€‚</p>
<p>âœ… - æ•°æ®ä»“åº“ï¼šPostgres</p>
<h4 id="æ•°æ®è¿ç»´-dataops" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e8%bf%90%e7%bb%b4-dataops" class="header-mark"></a>2.2.2 æ•°æ®è¿ç»´ DataOps</h4><p>æˆ‘ä»¬åº”è¯¥æœ‰æŸç§ DataOps çš„æ–¹æ¡ˆï¼Œè®© Pipeline å’Œç¯å¢ƒå…·æœ‰å¯é‡å¤æ€§ã€å¯æµ‹è¯•æ€§å’Œç‰ˆæœ¬æ§åˆ¶æ€§ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† GitLab åˆ›å»ºçš„ <a href="https://gitlab.com/meltano/meltano" target="_blank" rel="noopener noreferrer">Meltano</a>ã€‚</p>
<p>Meltano æ˜¯ä¸€ä¸ª just-work çš„ DataOps å¹³å°ï¼Œå®ƒä»¥ä¸€ç§ç¥å¥‡è€Œä¼˜é›…çš„æ–¹å¼å°† <a href="https://singer.io/" target="_blank" rel="noopener noreferrer">Singer</a> ä½œä¸º EL å’Œ <a href="https://getdbt.com/" target="_blank" rel="noopener noreferrer">dbt</a> ä½œä¸º T è¿æ¥èµ·æ¥ï¼Œå®ƒè¿˜è¿æ¥åˆ°å…¶ä»–ä¸€äº› dataInfra å®ç”¨ç¨‹åºï¼Œä¾‹å¦‚ Apache Superset å’Œ Apache Airflow ç­‰ã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬åˆçº³å…¥äº†ä¸€ä¸ªæˆå‘˜ï¼š</p>
<p>âœ… - GitOpsï¼šMeltano <a href="https://gitlab.com/meltano/meltano" target="_blank" rel="noopener noreferrer">https://gitlab.com/meltano/meltano</a></p>
<h4 id="etl" class="headerLink">
    <a href="#etl" class="header-mark"></a>2.2.3 ETL</h4><p>å¦‚å‰è¾¹æåˆ°ï¼Œæˆ‘ä»¬è¿˜åˆ©ç”¨ <a href="https://singer.io/" target="_blank" rel="noopener noreferrer">Singer</a> ä¸ Meltano ä¸€èµ·å°†æ¥è‡ªè®¸å¤šä¸åŒæ•°æ®æºçš„æ•°æ® Eï¼ˆæå–ï¼‰å’Œ Lï¼ˆåŠ è½½ï¼‰æ•°æ®ç›®æ ‡ï¼Œå¹¶ä½¿ç”¨ <a href="https://getdbt.com/" target="_blank" rel="noopener noreferrer">dbt</a> ä½œä¸º Transform çš„å¹³å°ã€‚</p>
<p>âœ… - ELï¼šSinger <a href="https://singer.io/" target="_blank" rel="noopener noreferrer">https://singer.io/</a></p>
<p>âœ… - T: dbt <a href="https://getdbt.com/" target="_blank" rel="noopener noreferrer">https://getdbt.com/</a></p>
<h4 id="æ•°æ®å¯è§†åŒ–" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e5%8f%af%e8%a7%86%e5%8c%96" class="header-mark"></a>2.2.4 æ•°æ®å¯è§†åŒ–</h4><p>åœ¨æ•°æ®ä¹‹ä¸Šåˆ›å»º Dashboardã€å›¾è¡¨å’Œè¡¨æ ¼æ¥è·å¾—æ´å¯Ÿæ˜¯å¾ˆç›´æ¥çš„éœ€æ±‚ï¼ˆå¯ä»¥æƒ³è±¡ä¸ºæƒ³è±¡å¤§æ•°æ®ä¹‹ä¸Šçš„ excel å›¾æ ‡åŠŸèƒ½ï¼‰ã€‚</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/172800854-8e01acae-696d-4e07-8e3e-a7d34dec8278.png" title="https://user-images.githubusercontent.com/1651790/172800854-8e01acae-696d-4e07-8e3e-a7d34dec8278.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/172800854-8e01acae-696d-4e07-8e3e-a7d34dec8278.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/172800854-8e01acae-696d-4e07-8e3e-a7d34dec8278.png"
            srcset="https://user-images.githubusercontent.com/1651790/172800854-8e01acae-696d-4e07-8e3e-a7d34dec8278.png, https://user-images.githubusercontent.com/1651790/172800854-8e01acae-696d-4e07-8e3e-a7d34dec8278.png 1.5x, https://user-images.githubusercontent.com/1651790/172800854-8e01acae-696d-4e07-8e3e-a7d34dec8278.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/172800854-8e01acae-696d-4e07-8e3e-a7d34dec8278.png">
    </a></figure></p>
<p><a href="https://superset.apache.org/" target="_blank" rel="noopener noreferrer">Apache Superset</a> æ˜¯æˆ‘å¾ˆå–œæ¬¢çš„å¼€æºæ•°æ®å¯è§†åŒ–é¡¹ç›®ï¼Œæˆ‘å‡†å¤‡ç”¨å®ƒæ¥ä½œä¸ºè¢«æ²»ç†ç®¡ç†çš„ç›®æ ‡ä¹‹ä¸€ï¼ŒåŒæ—¶ï¼Œä¹Ÿä¼šåˆ©ç”¨å®ƒçš„å¯è§†åŒ–ä½œä¸ºå…ƒæ•°æ®æ´å¯ŸåŠŸèƒ½çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>âœ… - Dashboardï¼šApache Superset <a href="https://superset.apache.org/" target="_blank" rel="noopener noreferrer">https://superset.apache.org/</a></p>
<h4 id="ä»»åŠ¡ç¼–æ’dag-job-orchestration" class="headerLink">
    <a href="#%e4%bb%bb%e5%8a%a1%e7%bc%96%e6%8e%92dag-job-orchestration" class="header-mark"></a>2.2.5 ä»»åŠ¡ç¼–æ’ï¼ˆDAG Job Orchestrationï¼‰</h4><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ DataOps ä½œä¸šã€ä»»åŠ¡ä¼šå¢é•¿åˆ°éœ€è¦ä¸€ä¸ªç¼–æ’ç³»ç»Ÿçš„è§„æ¨¡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <a href="https://airflow.apache.org/" target="_blank" rel="noopener noreferrer">Apache Airflow</a> æ¥è´Ÿè´£è¿™ä¸€å—ã€‚</p>
<p>âœ… - DAGï¼šApache Airflow <a href="https://airflow.apache.org/" target="_blank" rel="noopener noreferrer">https://airflow.apache.org/</a></p>
<h4 id="å…ƒæ•°æ®æ²»ç†" class="headerLink">
    <a href="#%e5%85%83%e6%95%b0%e6%8d%ae%e6%b2%bb%e7%90%86" class="header-mark"></a>2.2.6 å…ƒæ•°æ®æ²»ç†</h4><p>éšç€è¶Šæ¥è¶Šå¤šçš„ç»„ä»¶å’Œæ•°æ®è¢«å¼•å…¥æ•°æ®åŸºç¡€è®¾æ–½ï¼Œåœ¨æ•°æ®åº“ã€è¡¨ã€æ•°æ®å»ºæ¨¡(schema)ã€Dashboardã€DAGï¼ˆç¼–æ’ç³»ç»Ÿä¸­çš„æœ‰å‘æ— ç¯å›¾ï¼‰ã€åº”ç”¨ä¸æœåŠ¡çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸä¸­éƒ½å°†å­˜åœ¨æµ·é‡çš„å…ƒæ•°æ®ï¼Œéœ€è¦å¯¹å®ƒä»¬çš„ç®¡ç†å‘˜å’Œå›¢é˜Ÿè¿›è¡ŒååŒç®¡ç†ã€è¿æ¥å’Œå‘ç°ã€‚</p>
<p><a href="https://www.amundsen.io/amundsen/" target="_blank" rel="noopener noreferrer">Linux Foundation Amundsen</a> æ˜¯æˆ‘è®¤ä¸ºå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜çš„æœ€ä½³é¡¹ç›®ä¹‹ä¸€ã€‚</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/172801018-ecd67fa9-2743-451f-8734-b14f2a814199.png" title="https://user-images.githubusercontent.com/1651790/172801018-ecd67fa9-2743-451f-8734-b14f2a814199.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/172801018-ecd67fa9-2743-451f-8734-b14f2a814199.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/172801018-ecd67fa9-2743-451f-8734-b14f2a814199.png"
            srcset="https://user-images.githubusercontent.com/1651790/172801018-ecd67fa9-2743-451f-8734-b14f2a814199.png, https://user-images.githubusercontent.com/1651790/172801018-ecd67fa9-2743-451f-8734-b14f2a814199.png 1.5x, https://user-images.githubusercontent.com/1651790/172801018-ecd67fa9-2743-451f-8734-b14f2a814199.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/172801018-ecd67fa9-2743-451f-8734-b14f2a814199.png">
    </a></figure></p>
<p>âœ… - æ•°æ®å‘ç°ï¼šLinux Foundation Amundsen <a href="https://www.amundsen.io/amundsen/" target="_blank" rel="noopener noreferrer">https://www.amundsen.io/amundsen/</a></p>
<p>Amundsen ç”¨å›¾æ•°æ®åº“ä¸ºäº‹å®æºï¼ˆsingle source of truthï¼‰ä»¥åŠ é€Ÿå¤šè·³æŸ¥è¯¢ï¼ŒElastic Search ä¸ºå…¨æ–‡æœç´¢å¼•æ“ï¼Œå®ƒèƒ½å¯¹æ‰€æœ‰å…ƒæ•°æ®åŠå…¶è¡€ç¼˜è¿›è¡Œäº†é¡ºæ»‘çš„å¤„ç†è¿˜æä¾›äº†ä¼˜é›…çš„ UI å’Œ APIã€‚</p>
<p>Amundsen æ”¯æŒå¤šç§å›¾æ•°æ®åº“ä¸ºåç«¯ï¼Œè¿™é‡Œå’±ä»¬ç”¨ <a href="https://nebula-graph.com.cn" target="_blank" rel="noopener noreferrer">NebulaGraph</a>ã€‚</p>
<p>âœ… - å…¨æ–‡æœç´¢ï¼šElastic Search</p>
<p>âœ… - å›¾æ•°æ®åº“ï¼šNebulaGraph</p>
<p>ç°åœ¨ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½é½æ´»äº†ï¼Œå¼€å§‹ç»„è£…å®ƒä»¬å§ã€‚</p>
<h2 id="ç¯å¢ƒæ­å»ºä¸å„ç»„ä»¶åˆè¯†" class="headerLink">
    <a href="#%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba%e4%b8%8e%e5%90%84%e7%bb%84%e4%bb%b6%e5%88%9d%e8%af%86" class="header-mark"></a>3 ç¯å¢ƒæ­å»ºä¸å„ç»„ä»¶åˆè¯†</h2><p>æ•´ä¸ªé¡¹ç›®æ–¹æ¡ˆéƒ½æ˜¯å¼€æºçš„ï¼Œå¤§å®¶å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å®ƒçš„æ‰€æœ‰ç»†èŠ‚ï¼š</p>
<ul>
<li><a href="https://github.com/wey-gu/data-lineage-ref-solution" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/data-lineage-ref-solution</a></li>
</ul>
<p>æ•´ä¸ªé¡¹ç›®å¤§å®¶çš„å®éªŒä¸­æˆ‘éµå¾ªå°½é‡å¹²å‡€ã€é¼“åŠ±çš„åŸåˆ™ï¼Œéœ€è¦å‡è®¾åœ¨ä¸€ä¸ª unix-like çš„ç³»ç»Ÿä¸Šè¿è¡Œï¼Œæœ‰äº’è”ç½‘å’Œ Docker-Composeã€‚</p>
<blockquote>
<p>æ³¨ï¼šå‚è€ƒ <a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/compose/install/</a> åœ¨ç»§ç»­ä¹‹å‰å®‰è£… Docker å’Œ Docker Composeã€‚</p>
</blockquote>
<p>è¿™é‡Œæˆ‘ä»¬åœ¨ Ubuntu 20.04 LTS X86_64 ä¸Šè¿è¡Œå®ƒï¼Œä½†åœ¨å…¶ä»–å‘è¡Œç‰ˆæˆ– Linux ç‰ˆæœ¬ä¸Šåº”è¯¥ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚</p>
<h3 id="è¿è¡Œä¸€ä¸ªæ•°ä»“æ•°æ®åº“" class="headerLink">
    <a href="#%e8%bf%90%e8%a1%8c%e4%b8%80%e4%b8%aa%e6%95%b0%e4%bb%93%e6%95%b0%e6%8d%ae%e5%ba%93" class="header-mark"></a>3.1 è¿è¡Œä¸€ä¸ªæ•°ä»“ã€æ•°æ®åº“</h3><p>é¦–å…ˆï¼Œå®‰è£… Postgres ä½œä¸ºæˆ‘ä»¬çš„æ•°ä»“ã€‚</p>
<p>è¿™ä¸ªå•è¡Œå‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªä½¿ç”¨ docker åœ¨åå°è¿è¡Œçš„ Postgresï¼Œè¿›ç¨‹å…³é—­ä¹‹åå®¹å™¨ä¸ä¼šæ®‹ç•™è€Œæ˜¯è¢«æ¸…ç†æ‰ï¼ˆå› ä¸ºå‚æ•°<code>--rm</code>ï¼‰ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker run --rm --name postgres <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -e <span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>lineage_ref <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -e <span class="nv">POSTGRES_USER</span><span class="o">=</span>lineage_ref <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -e <span class="nv">POSTGRES_DB</span><span class="o">=</span>warehouse -d <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -p 5432:5432 postgres
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Postgres CLI æˆ– GUI å®¢æˆ·ç«¯æ¥éªŒè¯å®ƒã€‚</p>
<blockquote>
<p>æç¤ºï¼šå¯ä»¥ç”¨ VS Code æ’ä»¶ï¼š<a href="https://marketplace.visualstudio.com/items?itemName=mtxr.sqltools" target="_blank" rel="noopener noreferrer">SQL TOOLS</a> å¿«é€Ÿä»¥ GUI æ–¹å¼è¿æ¥åˆ°æ•°æ®åº“ï¼ˆæ”¯æŒ MariaDBã€Postgres ã€Cassandra ç­‰ï¼‰</p>
<p><a href="https://marketplace.visualstudio.com/items?itemName=mtxr.sqltools" target="_blank" rel="noopener noreferrer">https://marketplace.visualstudio.com/items?itemName=mtxr.sqltools</a></p>
</blockquote>
<h3 id="dataops-å·¥å…·é“¾éƒ¨ç½²" class="headerLink">
    <a href="#dataops-%e5%b7%a5%e5%85%b7%e9%93%be%e9%83%a8%e7%bd%b2" class="header-mark"></a>3.2 DataOps å·¥å…·é“¾éƒ¨ç½²</h3><p>ç„¶åï¼Œå®‰è£…æœ‰æœºç»“åˆäº† Singler å’Œ dbt çš„ Meltanoã€‚</p>
<p>Meltano å¸®åŠ©æˆ‘ä»¬ç®¡ç† ETL å·¥å…·ï¼ˆä½œä¸ºæ’ä»¶ï¼‰åŠå…¶æ‰€æœ‰é…ç½®å’Œ pipelineã€‚ è¿™äº›å…ƒä¿¡æ¯ä½äº meltano é…ç½®åŠå…¶ç³»ç»Ÿæ•°æ®åº“ï¼ˆhttps://docs.meltano.com/concepts/project#system-databaseï¼‰ä¸­ï¼Œå…¶ä¸­é…ç½®æ˜¯åŸºäºæ–‡ä»¶çš„ï¼ˆå¯ä»¥ä½¿ç”¨ GitOps ç®¡ç†ï¼‰ï¼Œå®ƒçš„é»˜è®¤ç³»ç»Ÿæ•°æ®åº“æ˜¯ SQLiteã€‚</p>
<h4 id="å®‰è£…-meltano" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85-meltano" class="header-mark"></a>3.2.1 å®‰è£… Meltano</h4><p>ä½¿ç”¨ Meltano çš„å·¥ä½œæµæ˜¯å¯åŠ¨ä¸€ä¸ªâ€œmeltano é¡¹ç›®â€å¹¶å¼€å§‹å°† Eã€L å’Œ T æ·»åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­ã€‚ é¡¹ç›®çš„å¯åŠ¨åªéœ€è¦ä¸€ä¸ª CLI å‘½ä»¤è°ƒç”¨ï¼š<code>meltano init yourprojectname</code>ï¼Œåœ¨é‚£ä¹‹å‰ï¼Œå¯ä»¥å…ˆç”¨ Python çš„åŒ…ç®¡ç†å™¨ï¼špip æˆ–è€… Docker é•œåƒå®‰è£… Meltanoï¼š</p>
<ul>
<li>åœ¨ python è™šæ‹Ÿç¯å¢ƒä¸­ä½¿ç”¨ pip å®‰è£… Meltanoï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir .venv
</span></span><span class="line"><span class="cl"><span class="c1"># example in a debian flavor Linux distro</span>
</span></span><span class="line"><span class="cl">sudo apt-get install python3-dev python3-pip python3-venv python3-wheel -y
</span></span><span class="line"><span class="cl">python3 -m venv .venv/meltano
</span></span><span class="line"><span class="cl"><span class="nb">source</span> .venv/meltano/bin/activate
</span></span><span class="line"><span class="cl">python3 -m pip install wheel
</span></span><span class="line"><span class="cl">python3 -m pip install meltano
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># init a project</span>
</span></span><span class="line"><span class="cl">mkdir meltano_projects <span class="o">&amp;&amp;</span> <span class="nb">cd</span> meltano_projects
</span></span><span class="line"><span class="cl"><span class="c1"># replace &lt;yourprojectname&gt; with your own one</span>
</span></span><span class="line"><span class="cl">touch .env
</span></span><span class="line"><span class="cl">meltano init &lt;yourprojectname&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æˆ–è€…ç”¨å®¹å™¨å®‰è£… Meltanoï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker pull meltano/meltano:latest
</span></span><span class="line"><span class="cl">docker run --rm meltano/meltano --version
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># init a project</span>
</span></span><span class="line"><span class="cl">mkdir meltano_projects <span class="o">&amp;&amp;</span> <span class="nb">cd</span> meltano_projects
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># replace &lt;yourprojectname&gt; with your own one</span>
</span></span><span class="line"><span class="cl">touch .env
</span></span><span class="line"><span class="cl">docker run --rm -v <span class="s2">&#34;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&#34;</span>:/projects <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             -w /projects --env-file .env <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             meltano/meltano init &lt;yourprojectname&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>é™¤äº† <code>meltano init</code>ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–å‘½ä»¤ï¼Œä¾‹å¦‚ <code>meltano etl</code> è¡¨ç¤º ETL çš„æ‰§è¡Œï¼Œè¿˜æœ‰ <code>meltano invoke &lt;plugin&gt;</code> æ¥è°ƒç”¨æ’ä»¶å‘½ä»¤ï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒå®ƒçš„é€ŸæŸ¥è¡¨ï¼ˆhttps://docs.meltano.com/reference/command-line-interfaceï¼‰ã€‚</p>
<h4 id="meltano-gui-ç•Œé¢" class="headerLink">
    <a href="#meltano-gui-%e7%95%8c%e9%9d%a2" class="header-mark"></a>3.2.2 Meltano GUI ç•Œé¢</h4><p>Meltano è¿˜å¸¦æœ‰ä¸€ä¸ªåŸºäº Web çš„ UIï¼Œæ‰§è¡Œ <code>ui</code> å­å‘½ä»¤å°±æ˜¯å¯åŠ¨å®ƒï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">meltano ui
</span></span></code></pre></td></tr></table>
</div>
</div><p>é»˜è®¤ä»–ä¼šè·‘åœ¨ http://localhost:5000 ä¸Šã€‚</p>
<p>å¯¹äº Docker è¿è¡Œçš„æƒ…å†µï¼Œåªéœ€è¦åœ¨æš´éœ² 5000 ç«¯å£çš„æƒ…å†µä¸‹è¿è¡Œå®¹å™¨å³å¯ï¼Œç”±äºå®¹å™¨çš„é»˜è®¤å‘½ä»¤å·²ç»æ˜¯ <code>meltano ui</code>ï¼Œæ‰€ä»¥ <code>run</code> çš„å‘½ä»¤åªéœ€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker run -v <span class="s2">&#34;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&#34;</span>:/project <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             -w /project <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             -p 5000:5000 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             meltano/meltano
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="meltano-é¡¹ç›®ç¤ºä¾‹" class="headerLink">
    <a href="#meltano-%e9%a1%b9%e7%9b%ae%e7%a4%ba%e4%be%8b" class="header-mark"></a>3.2.3 Meltano é¡¹ç›®ç¤ºä¾‹</h4><p>å†™åˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œæˆ‘æ³¨æ„åˆ° <a href="https://github.com/pnadolny13" target="_blank" rel="noopener noreferrer">Pat Nadolny</a> åˆ›å»ºäº†å¾ˆå¥½çš„ç¤ºä¾‹é¡¹ç›®åœ¨ <a href="https://github.com/pnadolny13/meltano_example_implementations/tree/main/meltano_projects/singer_dbt_jaffle" target="_blank" rel="noopener noreferrer">https://github.com/pnadolny13/meltano_example_implementations/tree/main/meltano_projects/singer_dbt_jaffle</a>ï¼Œå®ƒåˆ©ç”¨ dbt çš„ Meltano ç¤ºä¾‹æ•°æ®é›†ï¼Œé‡‡ç”¨ Airflow ç¼–æ’ ETL ä»»åŠ¡ï¼ˆhttps://github.com/pnadolny13/meltano_example_implementations/tree/main/meltano_projects/dbt_orchestrationï¼Œè¿˜æœ‰åˆ©ç”¨ Superset çš„ä¾‹å­ï¼ˆhttps://github.com/pnadolny13/meltano_example_implementations/tree/main/meltano_projects/jaffle_supersetï¼‰ã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘å°±ä¸é‡å¤é€ è½®å­äº†ï¼Œç›´æ¥åˆ©ç”¨ä»–çš„ä¾‹å­å§ã€‚</p>
<p>å’±ä»¬å¯ä»¥å‚ç…§ <a href="https://github.com/pnadolny13/meltano_example_implementations/tree/main/meltano_projects/singer_dbt_jaffle" target="_blank" rel="noopener noreferrer">https://github.com/pnadolny13/meltano_example_implementations/tree/main/meltano_projects/singer_dbt_jaffle</a>ï¼Œè¿è¡Œè¿™æ ·çš„æ•°æ®ç®¡é“ï¼ˆpipelineï¼‰ï¼š</p>
<ul>
<li><a href="https://hub.meltano.com/taps/csv" target="_blank" rel="noopener noreferrer">tap-CSV</a>(Singer)ï¼Œä» CSV æ–‡ä»¶ä¸­æå–æ•°æ®</li>
<li><a href="https://hub.meltano.com/targets/postgres" target="_blank" rel="noopener noreferrer">target-postgres</a>(Singer)ï¼Œå°†æ•°æ®åŠ è½½åˆ° Postgres</li>
<li><a href="https://hub.meltano.com/transformers/dbt" target="_blank" rel="noopener noreferrer">dbt</a>ï¼Œå°†æ•°æ®è½¬æ¢ä¸ºèšåˆè¡¨æˆ–è§†å›¾</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼Œå‰è¾¹æˆ‘ä»¬å·²ç»å¯åŠ¨äº† postgresï¼Œé‚£ä¸€æ­¥å¯ä»¥è·³è¿‡ã€‚</p>
</blockquote>
<p>æ“ä½œè¿‡ç¨‹æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/pnadolny13/meltano_example_implementations.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> meltano_example_implementations/meltano_projects/singer_dbt_jaffle/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">meltano install
</span></span><span class="line"><span class="cl">touch .env
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">PG_PASSWORD</span><span class="o">=</span><span class="s2">&#34;lineage_ref&#34;</span> &gt;&gt; .env
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">PG_USERNAME</span><span class="o">=</span><span class="s2">&#34;lineage_ref&#34;</span> &gt;&gt; .env
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Extract and Load(with Singer)</span>
</span></span><span class="line"><span class="cl">meltano run tap-csv target-postgres
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Trasnform(with dbt)</span>
</span></span><span class="line"><span class="cl">meltano run dbt:run
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Generate dbt docs</span>
</span></span><span class="line"><span class="cl">meltano invoke dbt docs generate
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Serve generated dbt docs</span>
</span></span><span class="line"><span class="cl">meltano invoke dbt docs to serve
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Then visit http://localhost:8080</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿æ¥åˆ° Postgres æ¥æŸ¥çœ‹ åŠ è½½å’Œè½¬æ¢åçš„æ•°æ®é¢„è§ˆå¦‚ä¸‹ï¼Œæˆªå›¾æ¥è‡ª VS Code çš„ SQLToolï¼š</p>
<p>Payments è¡¨é‡Œé•¿è¿™æ ·å­ï¼š</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png" title="https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png"
            srcset="https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png, https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png 1.5x, https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png">
    </a></figure></p>
<h3 id="æ­ä¸€ä¸ª-bi-dashboard-ç³»ç»Ÿ" class="headerLink">
    <a href="#%e6%90%ad%e4%b8%80%e4%b8%aa-bi-dashboard-%e7%b3%bb%e7%bb%9f" class="header-mark"></a>3.3 æ­ä¸€ä¸ª BI Dashboard ç³»ç»Ÿ</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†æ•°æ®ä»“åº“ä¸­çš„ä¸€äº›æ•°æ®ï¼Œç”¨ ETL å·¥å…·é“¾å°†ä¸åŒçš„æ•°æ®æºå¯¼äº†è¿›å»ï¼Œæ¥ä¸‹æ¥å¯ä»¥è¯•ç€ç”¨ä¸€ä¸‹è¿™äº›æ•°æ®äº†ã€‚</p>
<p>åƒä»ªè¡¨å¤§ç›˜ Dashbaord è¿™æ ·çš„ BI å·¥å…·èƒ½å¸®åŠ©æˆ‘ä»¬ä»æ•°æ®ä¸­è·å¾—æœ‰ç”¨çš„æ´å¯Ÿï¼Œä½¿ç”¨ Apache Supersetï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ›å»ºå’Œç®¡ç†åŸºäºè¿™äº›æ•°æ®æºçš„ Dashboard å’Œå„å¼å„æ ·çš„å›¾è¡¨ã€‚</p>
<p>æœ¬ç« çš„é‡ç‚¹ä¸åœ¨äº Apache Superset æœ¬èº«ï¼Œæ‰€ä»¥ï¼Œå’±ä»¬è¿˜æ˜¯å¤ç”¨ <a href="https://github.com/pnadolny13" target="_blank" rel="noopener noreferrer">Pat Nadolny</a> åœ¨çš„ä¾‹å­ <a href="https://github.com/pnadolny13/meltano_example_implementations/tree/main/meltano_projects/jaffle_superset" target="_blank" rel="noopener noreferrer">https://github.com/pnadolny13/meltano_example_implementations/tree/main/meltano_projects/jaffle_superset</a>ã€‚</p>
<h4 id="bootstrap-meltano-å’Œ-superset" class="headerLink">
    <a href="#bootstrap-meltano-%e5%92%8c-superset" class="header-mark"></a>3.3.1 Bootstrap Meltano å’Œ Superset</h4><p>åˆ›å»ºä¸€ä¸ªå®‰è£…äº† Meltano çš„ python venvï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir .venv
</span></span><span class="line"><span class="cl">python3 -m venv .venv/meltano
</span></span><span class="line"><span class="cl"><span class="nb">source</span> .venv/meltano/bin/activate
</span></span><span class="line"><span class="cl">python3 -m pip install wheel
</span></span><span class="line"><span class="cl">python3 -m pip install meltano
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‚è€ƒ Pat çš„ Guideï¼ˆhttps://github.com/pnadolny13/meltano_example_implementations/tree/main/meltano_projects/jaffle_supersetï¼‰ï¼Œç¨å¾®åšä¸€äº›ä¿®æ”¹ï¼š</p>
<ul>
<li>å…‹éš† repoï¼Œè¿›å…¥ <code>jaffle_superset</code> é¡¹ç›®</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/pnadolny13/meltano_example_implementations.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> meltano_example_implementations/meltano_projects/jaffle_superset/
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä¿®æ”¹meltanoé…ç½®æ–‡ä»¶ï¼Œè®© Superset è¿æ¥åˆ°æˆ‘ä»¬åˆ›å»ºçš„ Postgresï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vim meltano_projects/jaffle_superset/meltano.yml
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œï¼Œæˆ‘å°†ä¸»æœºåæ›´æ”¹ä¸ºâ€œ10.1.1.111â€ï¼Œè¿™æ˜¯æˆ‘å½“å‰ä¸»æœºçš„ IPï¼Œè€Œå¦‚æœè¯»è€…åœ¨ Windows æˆ–è€… macOS æœºå™¨çš„ Docker Desktop ä¸Šè·‘çš„è¯ï¼Œè¿™é‡Œä¸è¦ä¿®æ”¹ï¼Œå¦åˆ™è¦å‚è€ƒæˆ‘å»æ”¹æˆè‡ªå·±å®é™…çš„åœ°å€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gd">--- a/meltano_projects/jaffle_superset/meltano.yml
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+++ b/meltano_projects/jaffle_superset/meltano.yml
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gu">@@ -71,7 +71,7 @@ plugins:
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>               A list of database driver dependencies can be found here https://superset.apache.org/docs/databases/installing-database-drivers
</span></span><span class="line"><span class="cl">     config:
</span></span><span class="line"><span class="cl">       database_name: my_postgres
</span></span><span class="line"><span class="cl"><span class="gd">-      sqlalchemy_uri: postgresql+psycopg2://${PG_USERNAME}:${PG_PASSWORD}@host.docker.internal:${PG_PORT}/${PG_DATABASE}
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+      sqlalchemy_uri: postgresql+psycopg2://${PG_USERNAME}:${PG_PASSWORD}@10.1.1.168:${PG_PORT}/${PG_DATABASE}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>       tables:
</span></span><span class="line"><span class="cl">       - model.my_meltano_project.customers
</span></span><span class="line"><span class="cl">       - model.my_meltano_project.orders
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ·»åŠ  Postgres ç™»å½•çš„ä¿¡æ¯åˆ°  <code>.env</code> æ–‡ä»¶ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">PG_USERNAME</span><span class="o">=</span>lineage_ref &gt;&gt; .env
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">PG_PASSWORD</span><span class="o">=</span>lineage_ref &gt;&gt; .env
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å®‰è£… Meltano é¡¹ç›®ï¼Œè¿è¡Œ ETL ä»»åŠ¡</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">meltano install
</span></span><span class="line"><span class="cl">meltano run tap-csv target-postgres dbt:run
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è°ƒç”¨ã€å¯åŠ¨ supersetï¼Œè¿™é‡Œæ³¨æ„ <code>ui</code> ä¸æ˜¯ meltano çš„å†…éƒ¨å‘½ä»¤ï¼Œè€Œæ˜¯ä¸€ä¸ªé…ç½®è¿›å»çš„è‡ªå®šä¹‰è¡Œä¸ºï¼ˆuser-defined actionï¼‰</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">meltano invoke superset:ui
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åœ¨å¦ä¸€ä¸ªå‘½ä»¤è¡Œç»ˆç«¯ï¼Œæ‰§è¡Œå¦ä¸€ä¸ªè‡ªå®šä¹‰çš„å‘½ä»¤ <code>load_datasources</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">meltano invoke superset:load_datasources
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>é€šè¿‡æµè§ˆå™¨è®¿é—® http://localhost:8088/ å°±æ˜¯Superset çš„å›¾å½¢ç•Œé¢äº†ï¼š</li>
</ul>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168570300-186b56a5-58e8-4ff1-bc06-89fd77d74166.png" title="https://user-images.githubusercontent.com/1651790/168570300-186b56a5-58e8-4ff1-bc06-89fd77d74166.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168570300-186b56a5-58e8-4ff1-bc06-89fd77d74166.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168570300-186b56a5-58e8-4ff1-bc06-89fd77d74166.png"
            srcset="https://user-images.githubusercontent.com/1651790/168570300-186b56a5-58e8-4ff1-bc06-89fd77d74166.png, https://user-images.githubusercontent.com/1651790/168570300-186b56a5-58e8-4ff1-bc06-89fd77d74166.png 1.5x, https://user-images.githubusercontent.com/1651790/168570300-186b56a5-58e8-4ff1-bc06-89fd77d74166.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168570300-186b56a5-58e8-4ff1-bc06-89fd77d74166.png">
    </a></figure></p>
<h4 id="åˆ›å»ºä¸€ä¸ª-dashboard" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aa-dashboard" class="header-mark"></a>3.3.2 åˆ›å»ºä¸€ä¸ª Dashboard</h4><p>è¯•ä¸€ä¸‹åœ¨è¿™ä¸ª Meltano é¡¹ç›®ä¸­å®šä¹‰çš„ Postgres ä¸­çš„ ETL æ•°æ®ä¸Šåˆ›å»ºä¸€ä¸ª Dashboard å§</p>
<ul>
<li>ç‚¹å‡» <code>+ DASHBOARD</code>ï¼Œå¡«å†™ä»ªè¡¨ç›˜åç§°ï¼Œç„¶åç‚¹å‡» <code>SAVE</code>ï¼Œç„¶åç‚¹å‡» <code>+ CREATE A NEW CHART</code></li>
</ul>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168570363-c6b4f929-2aad-4f03-8e3e-b1b61f560ce5.png" title="https://user-images.githubusercontent.com/1651790/168570363-c6b4f929-2aad-4f03-8e3e-b1b61f560ce5.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168570363-c6b4f929-2aad-4f03-8e3e-b1b61f560ce5.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168570363-c6b4f929-2aad-4f03-8e3e-b1b61f560ce5.png"
            srcset="https://user-images.githubusercontent.com/1651790/168570363-c6b4f929-2aad-4f03-8e3e-b1b61f560ce5.png, https://user-images.githubusercontent.com/1651790/168570363-c6b4f929-2aad-4f03-8e3e-b1b61f560ce5.png 1.5x, https://user-images.githubusercontent.com/1651790/168570363-c6b4f929-2aad-4f03-8e3e-b1b61f560ce5.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168570363-c6b4f929-2aad-4f03-8e3e-b1b61f560ce5.png">
    </a></figure></p>
<ul>
<li>åœ¨æ–°å›¾è¡¨ï¼ˆCreate a new chartï¼‰è§†å›¾ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥é€‰æ‹©å›¾è¡¨ç±»å‹å’Œæ•°æ®é›†ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘é€‰æ‹©äº† <code>orders</code> è¡¨ä½œä¸ºæ•°æ®æºå’Œ <code>Pie Chart</code> å›¾è¡¨ç±»å‹ï¼š</li>
</ul>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168570927-9559a2a1-fed7-43be-9f6a-f6fb3c263830.png" title="https://user-images.githubusercontent.com/1651790/168570927-9559a2a1-fed7-43be-9f6a-f6fb3c263830.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168570927-9559a2a1-fed7-43be-9f6a-f6fb3c263830.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168570927-9559a2a1-fed7-43be-9f6a-f6fb3c263830.png"
            srcset="https://user-images.githubusercontent.com/1651790/168570927-9559a2a1-fed7-43be-9f6a-f6fb3c263830.png, https://user-images.githubusercontent.com/1651790/168570927-9559a2a1-fed7-43be-9f6a-f6fb3c263830.png 1.5x, https://user-images.githubusercontent.com/1651790/168570927-9559a2a1-fed7-43be-9f6a-f6fb3c263830.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168570927-9559a2a1-fed7-43be-9f6a-f6fb3c263830.png">
    </a></figure></p>
<ul>
<li>ç‚¹å‡»â€œCREATE NEW CHARTâ€åï¼Œæˆ‘ä»¬åœ¨å›¾è¡¨å®šä¹‰è§†å›¾ä¸­ï¼Œæˆ‘é€‰æ‹©äº†â€œstatusâ€çš„â€œQueryâ€ä¸ºâ€œDIMENSIONSâ€ï¼Œâ€œCOUNT(amount)â€ä¸ºâ€œMETRICâ€ã€‚ è‡³æ­¤ï¼Œå’±ä»¬å°±å¯ä»¥çœ‹åˆ°æ¯ä¸ªè®¢å•çŠ¶æ€åˆ†å¸ƒçš„é¥¼å›¾äº†ã€‚</li>
</ul>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168571130-a65ba88e-1ebe-4699-8783-08e5ecf54a0c.png" title="https://user-images.githubusercontent.com/1651790/168571130-a65ba88e-1ebe-4699-8783-08e5ecf54a0c.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168571130-a65ba88e-1ebe-4699-8783-08e5ecf54a0c.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168571130-a65ba88e-1ebe-4699-8783-08e5ecf54a0c.png"
            srcset="https://user-images.githubusercontent.com/1651790/168571130-a65ba88e-1ebe-4699-8783-08e5ecf54a0c.png, https://user-images.githubusercontent.com/1651790/168571130-a65ba88e-1ebe-4699-8783-08e5ecf54a0c.png 1.5x, https://user-images.githubusercontent.com/1651790/168571130-a65ba88e-1ebe-4699-8783-08e5ecf54a0c.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168571130-a65ba88e-1ebe-4699-8783-08e5ecf54a0c.png">
    </a></figure></p>
<ul>
<li>ç‚¹å‡» <code>SAVE</code> ï¼Œå®ƒä¼šè¯¢é—®åº”è¯¥å°†æ­¤å›¾è¡¨æ·»åŠ åˆ°å“ªä¸ª Dashboardï¼Œé€‰æ‹©åï¼Œå•å‡» <code>SAVE &amp; GO TO DASHBOARD</code>ã€‚</li>
</ul>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168571301-8ae69983-eda8-4e75-99cf-6904f583fc7c.png" title="https://user-images.githubusercontent.com/1651790/168571301-8ae69983-eda8-4e75-99cf-6904f583fc7c.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168571301-8ae69983-eda8-4e75-99cf-6904f583fc7c.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168571301-8ae69983-eda8-4e75-99cf-6904f583fc7c.png"
            srcset="https://user-images.githubusercontent.com/1651790/168571301-8ae69983-eda8-4e75-99cf-6904f583fc7c.png, https://user-images.githubusercontent.com/1651790/168571301-8ae69983-eda8-4e75-99cf-6904f583fc7c.png 1.5x, https://user-images.githubusercontent.com/1651790/168571301-8ae69983-eda8-4e75-99cf-6904f583fc7c.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168571301-8ae69983-eda8-4e75-99cf-6904f583fc7c.png">
    </a></figure></p>
<ul>
<li>ç„¶åï¼Œåœ¨ Dashboard ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‚£é‡Œçš„æ‰€æœ‰å›¾è¡¨ã€‚ æ‚¨å¯ä»¥çœ‹åˆ°æˆ‘è¿˜æ·»åŠ äº†å¦ä¸€ä¸ªå›¾è¡¨æ¥æ˜¾ç¤ºå®¢æˆ·è®¢å•æ•°é‡åˆ†å¸ƒï¼š</li>
</ul>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168571878-30a77057-1f66-448a-9bbd-0dedcee24cc9.png" title="https://user-images.githubusercontent.com/1651790/168571878-30a77057-1f66-448a-9bbd-0dedcee24cc9.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168571878-30a77057-1f66-448a-9bbd-0dedcee24cc9.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168571878-30a77057-1f66-448a-9bbd-0dedcee24cc9.png"
            srcset="https://user-images.githubusercontent.com/1651790/168571878-30a77057-1f66-448a-9bbd-0dedcee24cc9.png, https://user-images.githubusercontent.com/1651790/168571878-30a77057-1f66-448a-9bbd-0dedcee24cc9.png 1.5x, https://user-images.githubusercontent.com/1651790/168571878-30a77057-1f66-448a-9bbd-0dedcee24cc9.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168571878-30a77057-1f66-448a-9bbd-0dedcee24cc9.png">
    </a></figure></p>
<ul>
<li>ç‚¹  <code>Â·Â·Â·</code> çš„è¯ï¼Œè¿˜èƒ½çœ‹åˆ°åˆ·æ–°ç‡è®¾ç½®ã€ä¸‹è½½æ¸²æŸ“å›¾ç­‰å…¶ä»–çš„åŠŸèƒ½ã€‚</li>
</ul>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168573874-b5d57919-2866-4b3c-a4e5-55b6e6ef342e.png" title="https://user-images.githubusercontent.com/1651790/168573874-b5d57919-2866-4b3c-a4e5-55b6e6ef342e.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168573874-b5d57919-2866-4b3c-a4e5-55b6e6ef342e.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168573874-b5d57919-2866-4b3c-a4e5-55b6e6ef342e.png"
            srcset="https://user-images.githubusercontent.com/1651790/168573874-b5d57919-2866-4b3c-a4e5-55b6e6ef342e.png, https://user-images.githubusercontent.com/1651790/168573874-b5d57919-2866-4b3c-a4e5-55b6e6ef342e.png 1.5x, https://user-images.githubusercontent.com/1651790/168573874-b5d57919-2866-4b3c-a4e5-55b6e6ef342e.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168573874-b5d57919-2866-4b3c-a4e5-55b6e6ef342e.png">
    </a></figure></p>
<p>ç›®å‰ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•ä½†å…¸å‹çš„ homelab æ•°æ®æŠ€æœ¯æ ˆäº†ï¼Œå¹¶ä¸”æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯å¼€æºçš„ï¼</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨ CSV ä¸­æœ‰ 100 ä¸ªæ•°æ®é›†ï¼Œåœ¨æ•°æ®ä»“åº“ä¸­æœ‰ 200 ä¸ªè¡¨ï¼Œå¹¶ä¸”æœ‰å‡ ä¸ªæ•°æ®å·¥ç¨‹å¸ˆåœ¨è¿è¡Œä¸åŒçš„é¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®ä½¿ç”¨ã€ç”Ÿæˆä¸åŒçš„åº”ç”¨ä¸æœåŠ¡ã€Dashbaord å’Œæ•°æ®åº“ã€‚ å½“æœ‰äººæƒ³è¦æŸ¥æ‰¾ã€å‘ç°æˆ–è€…ä¿®æ”¹å…¶ä¸­çš„ä¸€äº›è¡¨ã€æ•°æ®é›†ã€Dashbaord å’Œç®¡é“ï¼Œåœ¨æ²Ÿé€šå’Œå·¥ç¨‹æ–¹é¢å¯èƒ½éƒ½æ˜¯éå¸¸ä¸å¥½ç®¡ç†çš„ã€‚</p>
<p>å¦‚å‰è¾¹æåˆ°çš„ï¼Œæˆ‘ä»¬éœ€è¦è¿™ä¸ªç¤ºä¾‹é¡¹ç›®çš„ä¸»è¦éƒ¨åˆ†ï¼šå…ƒæ•°æ®å‘ç°ç³»ç»Ÿã€‚</p>
<h3 id="å…ƒæ•°æ®å‘ç°ç³»ç»Ÿ" class="headerLink">
    <a href="#%e5%85%83%e6%95%b0%e6%8d%ae%e5%8f%91%e7%8e%b0%e7%b3%bb%e7%bb%9f" class="header-mark"></a>3.4 å…ƒæ•°æ®å‘ç°ç³»ç»Ÿ</h3><p>ç„¶åï¼Œæˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªå¸¦æœ‰ NebulaGraph å’Œ Elasticsearch çš„ Amundsenã€‚</p>
<blockquote>
<p>æ³¨ï¼šç›®å‰ã€NebulaGraph ä½œä¸º Amundsen åç«¯çš„ PRã€‘ï¼ˆhttps://github.com/amundsen-io/amundsen/pull/1817ï¼‰å°šæœªåˆå¹¶ï¼Œæˆ‘è¿˜åœ¨ä¸ Amundsen å›¢é˜Ÿåˆä½œï¼ˆhttps://github.com/amundsen-io/rfcs/pull/48ï¼‰æ¥å®ç°å®ƒã€‚</p>
</blockquote>
<p>æœ‰äº† Amundsenï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªåœ°æ–¹å‘ç°å’Œç®¡ç†æ•´ä¸ªæ•°æ®æ ˆä¸­çš„æ‰€æœ‰å…ƒæ•°æ®ã€‚</p>
<p>Amundsen ä¸»è¦æœ‰ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>å…ƒæ•°æ®å¯¼å…¥ Metadata Ingestion
<ul>
<li><a href="https://www.amundsen.io/amundsen/databuilder/" target="_blank" rel="noopener noreferrer">Amundsen Data builder</a></li>
</ul>
</li>
<li>å…ƒæ•°æ®ç›®å½•æœåŠ¡ Metadata Catalog
<ul>
<li><a href="https://www.amundsen.io/amundsen/frontend/" target="_blank" rel="noopener noreferrer">Amundsen Frontend service</a></li>
<li><a href="https://www.amundsen.io/amundsen/metadata/" target="_blank" rel="noopener noreferrer">Amundsen Metadata service</a></li>
<li><a href="https://www.amundsen.io/amundsen/search/" target="_blank" rel="noopener noreferrer">Amundsen Search service</a></li>
</ul>
</li>
</ul>
<p>å®ƒçš„å·¥ä½œåŸç†æ˜¯ï¼šåˆ©ç”¨ <code>Data builder</code> ä»ä¸åŒæ¥æºæå–å…ƒæ•°æ®ï¼Œå¹¶å°†å…ƒæ•°æ®æŒä¹…åŒ–åˆ° <code>Meta service</code> çš„åç«¯å­˜å‚¨å’Œ <code>Search service</code> çš„åç«¯å­˜å‚¨ä¸­ï¼Œç”¨æˆ·ä» <code>Froent service</code> æˆ–é€šè¿‡ <code>Meta Service</code> çš„APIã€‚</p>
<h4 id="éƒ¨ç½²-amundsen" class="headerLink">
    <a href="#%e9%83%a8%e7%bd%b2-amundsen" class="header-mark"></a>3.4.1 éƒ¨ç½² Amundsen</h4><h5 id="å…ƒæ•°æ®æœåŠ¡-metadata-service" class="headerLink">
    <a href="#%e5%85%83%e6%95%b0%e6%8d%ae%e6%9c%8d%e5%8a%a1-metadata-service" class="header-mark"></a>3.4.1.1 å…ƒæ•°æ®æœåŠ¡ Metadata service</h5><p>æˆ‘ä»¬ç”¨ docker-compose æ–‡ä»¶éƒ¨ç½²ä¸€ä¸ª Amundsen é›†ç¾¤ã€‚ ç”±äº NebulaGraph åç«¯æ”¯æŒå°šæœªåˆå¹¶ï¼Œè¿˜ä¸èƒ½ç”¨å®˜æ–¹çš„ä»£ç ï¼Œå…ˆç”¨æˆ‘è‡ªå·±çš„åˆ†å‰ç‰ˆæœ¬ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬å…‹éš†åŒ…å«æ‰€æœ‰å­æ¨¡å—çš„ repoï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone -b amundsen_nebula_graph --recursive git@github.com:wey-gu/amundsen.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> amundsen
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œå¯åŠ¨æ‰€æœ‰ç›®å½•æœåŠ¡ï¼ˆcatalog servicesï¼‰åŠå…¶åç«¯å­˜å‚¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose -f docker-amundsen-nebula.yml up
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨ï¼šå¯ä»¥æ·»åŠ  <code>-d</code> æ¥è®©å®¹å™¨åœ¨åå°è¿è¡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose -f docker-amundsen-nebula.yml up -d
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…³é—­åå°è¿è¡Œçš„é›†ç¾¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose -f docker-amundsen-nebula.yml stop
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ é™¤åå°è¿è¡Œçš„é›†ç¾¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose -f docker-amundsen-nebula.yml down
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<p>ç”±äºè¿™ä¸ª docker-compose æ–‡ä»¶æ˜¯ä¾›å¼€å‘äººå‘˜è¯•ç©ã€è°ƒè¯• Amundsen ç”¨çš„ï¼Œè€Œä¸æ˜¯ç»™ç”Ÿäº§éƒ¨ç½²å‡†å¤‡çš„ï¼Œå®ƒåœ¨å¯åŠ¨çš„æ—¶å€™ä¼šä»ä»£ç åº“æ„å»ºé•œåƒï¼Œç¬¬ä¸€æ¬¡è·‘çš„æ—¶å€™å¯åŠ¨ä¼šæ…¢ä¸€äº›ã€‚</p>
<p>éƒ¨ç½²å¥½äº†ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨ Data builder å°†ä¸€äº›ç¤ºä¾‹ã€è™šæ„çš„æ•°æ®åŠ è½½å­˜å‚¨é‡Œã€‚</p>
<h5 id="æŠ“å–å…ƒæ•°æ®-data-builder" class="headerLink">
    <a href="#%e6%8a%93%e5%8f%96%e5%85%83%e6%95%b0%e6%8d%ae-data-builder" class="header-mark"></a>3.4.1.2 æŠ“å–å…ƒæ•°æ® Data builder</h5><p>Amundsen Data builder å°±åƒ Meltano ç³»ç»Ÿä¸€æ ·ï¼Œåªä¸è¿‡æ˜¯ç”¨åœ¨å…ƒæ•°æ®çš„ä¸Šçš„ ETL ï¼Œå®ƒæŠŠå…ƒæ•°æ®åŠ è½½åˆ°â€œMeta serviceâ€å’Œâ€œSearch serviceâ€çš„åç«¯å­˜å‚¨ï¼šNebulaGraph å’Œ Elasticsearch é‡Œã€‚ è¿™é‡Œçš„ Data builder åªæ˜¯ä¸€ä¸ª python æ¨¡å—ï¼Œæ‰€æœ‰çš„å…ƒæ•°æ® ETL ä½œä¸šå¯ä»¥ä½œä¸ºè„šæœ¬è¿è¡Œï¼Œä¹Ÿå¯ä»¥ç”¨ Apache Airflow ç­‰ DAG å¹³å°è¿›è¡Œç¼–æ’ã€‚</p>
<p>å®‰è£… <a href="https://github.com/amundsen-io/amundsen/tree/main/databuilder" target="_blank" rel="noopener noreferrer">Amundsen Data builder</a>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> databuilder
</span></span><span class="line"><span class="cl">python3 -m venv .venv
</span></span><span class="line"><span class="cl"><span class="nb">source</span> .venv/bin/activate
</span></span><span class="line"><span class="cl">python3 -m pip install wheel
</span></span><span class="line"><span class="cl">python3 -m pip install -r requirements.txt
</span></span><span class="line"><span class="cl">python3 setup.py install
</span></span></code></pre></td></tr></table>
</div>
</div><p>è°ƒç”¨è¿™ä¸ªç¤ºä¾‹æ•°æ®æ„å»ºå™¨ ETL è„šæœ¬æ¥æŠŠç¤ºä¾‹çš„è™šæ‹Ÿæ•°æ®å¯¼è¿›å»ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python3 example/scripts/sample_data_loader_nebula.py
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="éªŒè¯ä¸€ä¸‹-amundsen" class="headerLink">
    <a href="#%e9%aa%8c%e8%af%81%e4%b8%80%e4%b8%8b-amundsen" class="header-mark"></a>3.4.1.3 éªŒè¯ä¸€ä¸‹ Amundsen</h5><p>åœ¨è®¿é—® Amundsen ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç”¨æˆ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># run a container with curl attached to amundsenfrontend</span>
</span></span><span class="line"><span class="cl">docker run -it --rm --net container:amundsenfrontend nicolaka/netshoot
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a user with id test_user_id</span>
</span></span><span class="line"><span class="cl">curl -X PUT -v http://amundsenmetadata:5002/user <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -H <span class="s2">&#34;Content-Type: application/json&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --data <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="s1">&#39;{&#34;user_id&#34;:&#34;test_user_id&#34;,&#34;first_name&#34;:&#34;test&#34;,&#34;last_name&#34;:&#34;user&#34;, &#34;email&#34;:&#34;test_user_id@mail.com&#34;}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">exit</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨ <a href="http://localhost:5000/" target="_blank" rel="noopener noreferrer">http://localhost:5000</a> æŸ¥çœ‹ UI å¹¶å°è¯•æœç´¢ <code>test</code>ï¼Œå®ƒåº”è¯¥ä¼šè¿”å›ä¸€äº›ç»“æœã€‚</p>
<p><figure><a class="lightgallery" href="https://github.com/amundsen-io/amundsen/raw/master/docs/img/search-page.png" title="https://github.com/amundsen-io/amundsen/raw/master/docs/img/search-page.png" data-thumbnail="https://github.com/amundsen-io/amundsen/raw/master/docs/img/search-page.png">
        <img
            
            loading="lazy"
            src="https://github.com/amundsen-io/amundsen/raw/master/docs/img/search-page.png"
            srcset="https://github.com/amundsen-io/amundsen/raw/master/docs/img/search-page.png, https://github.com/amundsen-io/amundsen/raw/master/docs/img/search-page.png 1.5x, https://github.com/amundsen-io/amundsen/raw/master/docs/img/search-page.png 2x"
            sizes="auto"
            alt="https://github.com/amundsen-io/amundsen/raw/master/docs/img/search-page.png">
    </a></figure></p>
<p>ç„¶åï¼Œå¯ä»¥å•å‡»å¹¶æµè§ˆåœ¨â€œsample_data_loader_nebula.pyâ€æœŸé—´åŠ è½½åˆ° Amundsen çš„é‚£äº›ç¤ºä¾‹å…ƒæ•°æ®ã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ NebulaStudio(http://localhost:7001) è®¿é—® NebulaGraph é‡Œçš„è¿™äº›æ•°æ®ã€‚</p>
<blockquote>
<p>æ³¨æ„åœ¨ Nebula Studio ä¸­ï¼Œé»˜è®¤ç™»å½•å­—æ®µä¸ºï¼š</p>
<ul>
<li>ä¸»æœºï¼š<code>graphd:9669</code></li>
<li>ç”¨æˆ·ï¼š<code>root</code></li>
<li>å¯†ç ï¼š<code>nebula</code></li>
</ul>
</blockquote>
<p>ä¸‹å›¾æ˜¾ç¤ºäº†æœ‰å…³ Amundsen ç»„ä»¶çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">       â”‚ Frontend:5000          â”‚ â”‚ Metadata Sources                       â”‚
</span></span><span class="line"><span class="cl">       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span class="line"><span class="cl">       â”‚ Metaservice:5001       â”‚ â”‚ â”‚        â”‚ â”‚         â”‚ â”‚             â”‚ â”‚
</span></span><span class="line"><span class="cl">       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚ â”‚ Foo DB â”‚ â”‚ Bar App â”‚ â”‚ X Dashboard â”‚ â”‚
</span></span><span class="line"><span class="cl">  â”Œâ”€â”€â”€â”€â”¼â”€â”¤ Nebula Proxy â”‚       â”‚ â”‚ â”‚        â”‚ â”‚         â”‚ â”‚             â”‚ â”‚
</span></span><span class="line"><span class="cl">  â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚ â”‚        â”‚ â”‚         â”‚ â”‚             â”‚ â”‚
</span></span><span class="line"><span class="cl">  â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span class="line"><span class="cl">â”Œâ”€â”¼â”€â”€â”€â”€â”¤ Search searvice:5002   â”‚ â”‚                  â”‚                     â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”‚                                             â”‚                       â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”‚ Databuilder     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”‚                 â”‚                                                   â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”Œâ”€â”€â”¼â”€â–º Extractor of Sources           â”œâ”€â–º nebula_search_data_extractor â”‚ â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”‚  â”‚ â”‚ Loader filesystem_csv_nebula   â”‚ â”‚ Loader Elastic FS loader     â”‚ â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”‚  â”‚ â”‚ Publisher nebula_csv_publisher â”‚ â”‚ Publisher Elasticsearch      â”‚ â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="cl">â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                 â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â–ºâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”‚ Nebula Graphâ”‚   â”‚                         â”‚ â”‚           â”‚
</span></span><span class="line"><span class="cl">â”‚ â””â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â” â”‚ â”‚           â”‚
</span></span><span class="line"><span class="cl">â”‚      â”‚     â”‚           â”‚           â”‚     â”‚MetaDâ”‚ â”‚ â”‚           â”‚
</span></span><span class="line"><span class="cl">â”‚      â”‚ â”Œâ”€â”€â”€â–¼â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”  â””â”€â”€â”€â”€â”€â”˜ â”‚ â”‚           â”‚
</span></span><span class="line"><span class="cl">â”‚ â”Œâ”€â”€â”€â”€â”¼â”€â–ºGraphDâ”‚    â”‚GraphDâ”‚    â”‚GraphDâ”‚          â”‚ â”‚           â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜  â”Œâ”€â”€â”€â”€â”€â” â”‚ â”‚           â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”‚ :9669                             â”‚MetaDâ”‚ â”‚ â”‚  Elastic  â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â””â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  Search   â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”‚ â”‚        â”‚ â”‚        â”‚ â”‚        â”‚          â”‚ â”‚  Cluster  â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”‚ â”‚StorageDâ”‚ â”‚StorageDâ”‚ â”‚StorageDâ”‚  â”Œâ”€â”€â”€â”€â”€â” â”‚ â”‚  :9200    â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”‚ â”‚        â”‚ â”‚        â”‚ â”‚        â”‚  â”‚MetaDâ”‚ â”‚ â”‚           â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜ â”‚ â”‚           â”‚
</span></span><span class="line"><span class="cl">â”‚ â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚           â”‚
</span></span><span class="line"><span class="cl">â”‚ â””â”€â”€â”€â”€â”¤ Nebula Studio:7001                        â”‚ â”‚           â”‚
</span></span><span class="line"><span class="cl">â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ç©¿é’ˆå¼•çº¿å…ƒæ•°æ®å‘ç°" class="headerLink">
    <a href="#%e7%a9%bf%e9%92%88%e5%bc%95%e7%ba%bf%e5%85%83%e6%95%b0%e6%8d%ae%e5%8f%91%e7%8e%b0" class="header-mark"></a>4 ç©¿é’ˆå¼•çº¿ï¼šå…ƒæ•°æ®å‘ç°</h2><p>è®¾ç½®å¥½åŸºæœ¬ç¯å¢ƒåï¼Œè®©æˆ‘ä»¬æŠŠæ‰€æœ‰ä¸œè¥¿ç©¿èµ·æ¥ã€‚è¿˜è®°å¾—æˆ‘ä»¬æœ‰ ELT ä¸€äº›æ•°æ®åˆ° PostgreSQL å—ï¼Ÿ</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png" title="https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png"
            srcset="https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png, https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png 1.5x, https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/167540494-01e3dbd2-6ab1-41d2-998e-3b79f755bdc7.png">
    </a></figure></p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•è®© Amundsen å‘ç°æœ‰å…³è¿™äº›æ•°æ®å’Œ ETL çš„å…ƒæ•°æ®å‘¢ï¼Ÿ</p>
<h3 id="æå–-postgres-å…ƒæ•°æ®" class="headerLink">
    <a href="#%e6%8f%90%e5%8f%96-postgres-%e5%85%83%e6%95%b0%e6%8d%ae" class="header-mark"></a>4.1 æå– Postgres å…ƒæ•°æ®</h3><p>æˆ‘ä»¬ä»æ•°æ®æºå¼€å§‹ï¼šé¦–å…ˆæ˜¯ Postgresã€‚</p>
<p>æˆ‘ä»¬ä¸º python3 å®‰è£… Postgres å®¢æˆ·ç«¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt-get install libpq-dev
</span></span><span class="line"><span class="cl">pip3 install Psycopg2
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ‰§è¡Œ-postgres-å…ƒæ•°æ®-etl" class="headerLink">
    <a href="#%e6%89%a7%e8%a1%8c-postgres-%e5%85%83%e6%95%b0%e6%8d%ae-etl" class="header-mark"></a>4.1.1 æ‰§è¡Œ Postgres å…ƒæ•°æ® ETL</h4><p>è¿è¡Œä¸€ä¸ªè„šæœ¬æ¥è§£æ Postgres å…ƒæ•°æ®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CREDENTIALS_POSTGRES_USER</span><span class="o">=</span>lineage_ref
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CREDENTIALS_POSTGRES_PASSWORD</span><span class="o">=</span>lineage_ref
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CREDENTIALS_POSTGRES_DATABASE</span><span class="o">=</span>warehouse
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">python3 example/scripts/sample_postgres_loader_nebula.py
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you look into the code of the sample script for loading Postgres metadata to Nebula, the main lines are quite straightforward:</p>
<p>æˆ‘ä»¬çœ‹çœ‹æŠŠ Postgres å…ƒæ•°æ®åŠ è½½åˆ° NebulaGraph çš„ç¤ºä¾‹è„šæœ¬çš„ä»£ç ï¼Œéå¸¸ç®€å•ç›´æ¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># part 1: PostgressMetadata --&gt; CSV --&gt; Nebula Graph</span>
</span></span><span class="line"><span class="cl"><span class="n">job</span> <span class="o">=</span> <span class="n">DefaultJob</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">conf</span><span class="o">=</span><span class="n">job_config</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">task</span><span class="o">=</span><span class="n">DefaultTask</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="n">extractor</span><span class="o">=</span><span class="n">PostgresMetadataExtractor</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">          <span class="n">loader</span><span class="o">=</span><span class="n">FsNebulaCSVLoader</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">      <span class="n">publisher</span><span class="o">=</span><span class="n">NebulaCsvPublisher</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="c1"># part 2: Metadata stored in NebulaGraph --&gt; Elasticsearch</span>
</span></span><span class="line"><span class="cl"><span class="n">extractor</span> <span class="o">=</span> <span class="n">NebulaSearchDataExtractor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">task</span> <span class="o">=</span> <span class="n">SearchMetadatatoElasticasearchTask</span><span class="p">(</span><span class="n">extractor</span><span class="o">=</span><span class="n">extractor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">job</span> <span class="o">=</span> <span class="n">DefaultJob</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="n">job_config</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸€ä¸ªå·¥ä½œè·¯å¾„æ˜¯ï¼š<code>PostgressMetadata --&gt; CSV --&gt; Nebula Graph</code></p>
<ul>
<li><code>PostgresMetadataExtractor</code> ç”¨äºä» Postgres ä¸­æå–/æå–å…ƒæ•°æ®ï¼Œå¯ä»¥å‚è€ƒæ–‡æ¡£ï¼ˆhttps://www.amundsen.io/amundsen/databuilder/#postgresmetadataextractorï¼‰ã€‚</li>
<li><code>FsNebulaCSVLoader</code> ç”¨äºå°†æå–çš„æ•°æ®ä¸­é—´æ”¾ç½®ä¸º CSV æ–‡ä»¶</li>
<li><code>NebulaCsvPublisher</code> ç”¨äºå°†å…ƒæ•°æ®ä»¥ CSV çš„å½¢å¼å‘å¸ƒåˆ° NebulaGraph</li>
</ul>
<p>ç¬¬äºŒä¸ªå·¥ä½œè·¯å¾„æ˜¯ï¼š<code>Metadata stored in NebulaGraph --&gt; Elasticsearch</code></p>
<ul>
<li><code>NebulaSearchDataExtractor</code> ç”¨äºè·å–å­˜å‚¨åœ¨ Nebula Graph ä¸­çš„å…ƒæ•°æ®</li>
<li><code>SearchMetadatatoElasticasearchTask</code> ç”¨äºä½¿ Elasticsearch å¯¹å…ƒæ•°æ®è¿›è¡Œç´¢å¼•ã€‚</li>
</ul>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è„šæœ¬ä¸­æˆ–ä½¿ç”¨ Apache Airflow ç­‰ç¼–æ’å¹³å°è§¦å‘è¿™äº›ä½œä¸šã€‚</p>
</blockquote>
<h4 id="éªŒè¯-postgres-ä¸­å…ƒæ•°æ®çš„è·å–" class="headerLink">
    <a href="#%e9%aa%8c%e8%af%81-postgres-%e4%b8%ad%e5%85%83%e6%95%b0%e6%8d%ae%e7%9a%84%e8%8e%b7%e5%8f%96" class="header-mark"></a>4.1.2 éªŒè¯ Postgres ä¸­å…ƒæ•°æ®çš„è·å–</h4><p>æœç´¢<code>payments</code>æˆ–è€…ç›´æ¥è®¿é—®http://localhost:5000/table_detail/warehouse/postgres/public/paymentsï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ Postgres çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚ï¼š</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168475180-ebfaa188-268c-4fbe-a614-135d56d07e5d.png" title="https://user-images.githubusercontent.com/1651790/168475180-ebfaa188-268c-4fbe-a614-135d56d07e5d.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168475180-ebfaa188-268c-4fbe-a614-135d56d07e5d.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168475180-ebfaa188-268c-4fbe-a614-135d56d07e5d.png"
            srcset="https://user-images.githubusercontent.com/1651790/168475180-ebfaa188-268c-4fbe-a614-135d56d07e5d.png, https://user-images.githubusercontent.com/1651790/168475180-ebfaa188-268c-4fbe-a614-135d56d07e5d.png 1.5x, https://user-images.githubusercontent.com/1651790/168475180-ebfaa188-268c-4fbe-a614-135d56d07e5d.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168475180-ebfaa188-268c-4fbe-a614-135d56d07e5d.png">
    </a></figure></p>
<p>ç„¶åï¼Œåƒä¸Šé¢çš„å±å¹•æˆªå›¾ä¸€æ ·ï¼Œå¯ä»¥è½»æ¾å®Œæˆå…ƒæ•°æ®ç®¡ç†æ“ä½œï¼Œå¦‚æ·»åŠ æ ‡ç­¾ã€æ‰€æœ‰è€…å’Œæè¿°ã€‚</p>
<h3 id="æå–-dbt-å…ƒæ•°æ®" class="headerLink">
    <a href="#%e6%8f%90%e5%8f%96-dbt-%e5%85%83%e6%95%b0%e6%8d%ae" class="header-mark"></a>4.2 æå– dbt å…ƒæ•°æ®</h3><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä» <a href="https://www.getdbt.com/" target="_blank" rel="noopener noreferrer">dbt</a> æœ¬èº«æå–å…ƒæ•°æ®ã€‚</p>
<p>Amundsen <a href="https://www.amundsen.io/amundsen/databuilder/#dbtextractor" target="_blank" rel="noopener noreferrer">DbtExtractor</a> ä¼šè§£æ <code>catalog.json</code> æˆ– <code>manifest.json</code> æ–‡ä»¶ä»¥å°†å…ƒæ•°æ®åŠ è½½åˆ° Amundsen å­˜å‚¨ï¼ˆNebulaGraph å’Œ Elasticsearch )ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ meltano ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨ <code>meltano invoke dbt docs generate</code> ç”Ÿæˆäº†è¿™ä¸ªæ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">14:23:15  Done.
</span></span><span class="line"><span class="cl">14:23:15  Building catalog
</span></span><span class="line"><span class="cl">14:23:15  Catalog written to /home/ubuntu/ref-data-lineage/meltano_example_implementations/meltano_projects/singer_dbt_jaffle/.meltano/transformers/dbt/target/catalog.json
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="dbt-å…ƒæ•°æ®-etl-çš„æ‰§è¡Œ" class="headerLink">
    <a href="#dbt-%e5%85%83%e6%95%b0%e6%8d%ae-etl-%e7%9a%84%e6%89%a7%e8%a1%8c" class="header-mark"></a>4.2.1 dbt å…ƒæ•°æ® ETL çš„æ‰§è¡Œ</h4><p>æˆ‘ä»¬è¯•ç€è§£æç¤ºä¾‹ dbt æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®å§ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ls -l example/sample_data/dbt/
</span></span><span class="line"><span class="cl">total <span class="m">184</span>
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> w w   <span class="m">5320</span> May <span class="m">15</span> 07:17 catalog.json
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> w w <span class="m">177163</span> May <span class="m">15</span> 07:17 manifest.json
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘å†™çš„è¿™ä¸ªç¤ºä¾‹çš„åŠ è½½ä¾‹å­å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python3 example/scripts/sample_dbt_loader_nebula.py
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ä¸»è¦çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># part 1: Dbt manifest --&gt; CSV --&gt; Nebula Graph</span>
</span></span><span class="line"><span class="cl"><span class="n">job</span> <span class="o">=</span> <span class="n">DefaultJob</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">conf</span><span class="o">=</span><span class="n">job_config</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">task</span><span class="o">=</span><span class="n">DefaultTask</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="n">extractor</span><span class="o">=</span><span class="n">DbtExtractor</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">          <span class="n">loader</span><span class="o">=</span><span class="n">FsNebulaCSVLoader</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">      <span class="n">publisher</span><span class="o">=</span><span class="n">NebulaCsvPublisher</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="c1"># part 2: Metadata stored in NebulaGraph --&gt; Elasticsearch</span>
</span></span><span class="line"><span class="cl"><span class="n">extractor</span> <span class="o">=</span> <span class="n">NebulaSearchDataExtractor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">task</span> <span class="o">=</span> <span class="n">SearchMetadatatoElasticasearchTask</span><span class="p">(</span><span class="n">extractor</span><span class="o">=</span><span class="n">extractor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">job</span> <span class="o">=</span> <span class="n">DefaultJob</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="n">job_config</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒå’Œ Postgres å…ƒæ•°æ® ETL çš„å”¯ä¸€åŒºåˆ«æ˜¯ <code>extractor=DbtExtractor()</code>ï¼Œå®ƒå¸¦æœ‰ä»¥ä¸‹é…ç½®ä»¥è·å–æœ‰å…³ dbt é¡¹ç›®çš„ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>æ•°æ®åº“åç§°</li>
<li>ç›®å½•_json</li>
<li>manifest_json</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">job_config</span> <span class="o">=</span> <span class="n">ConfigFactory</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;extractor.dbt.database_name&#39;</span><span class="p">:</span> <span class="n">database_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;extractor.dbt.catalog_json&#39;</span><span class="p">:</span> <span class="n">catalog_file_loc</span><span class="p">,</span>  <span class="c1"># File</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;extractor.dbt.manifest_json&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">manifest_data</span><span class="p">),</span>  <span class="c1"># JSON Dumped objecy</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;extractor.dbt.source_url&#39;</span><span class="p">:</span> <span class="n">source_url</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="éªŒè¯-dbt-æŠ“å–ç»“æœ" class="headerLink">
    <a href="#%e9%aa%8c%e8%af%81-dbt-%e6%8a%93%e5%8f%96%e7%bb%93%e6%9e%9c" class="header-mark"></a>4.2.2 éªŒè¯ dbt æŠ“å–ç»“æœ</h4><p>æœç´¢ <code>dbt_demo</code> æˆ–è€…ç›´æ¥è®¿é—® http://localhost:5000/table_detail/dbt_demo/snowflake/public/raw_inventory_valueï¼Œå¯ä»¥çœ‹åˆ°</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168479864-2f73ea73-265f-4cd2-999f-e7effbaf3ec1.png" title="https://user-images.githubusercontent.com/1651790/168479864-2f73ea73-265f-4cd2-999f-e7effbaf3ec1.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168479864-2f73ea73-265f-4cd2-999f-e7effbaf3ec1.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168479864-2f73ea73-265f-4cd2-999f-e7effbaf3ec1.png"
            srcset="https://user-images.githubusercontent.com/1651790/168479864-2f73ea73-265f-4cd2-999f-e7effbaf3ec1.png, https://user-images.githubusercontent.com/1651790/168479864-2f73ea73-265f-4cd2-999f-e7effbaf3ec1.png 1.5x, https://user-images.githubusercontent.com/1651790/168479864-2f73ea73-265f-4cd2-999f-e7effbaf3ec1.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168479864-2f73ea73-265f-4cd2-999f-e7effbaf3ec1.png">
    </a></figure></p>
<blockquote>
<p>å°æç¤ºï¼šæˆ‘ä»¬å¯ä»¥é€‰æ‹©å¯ç”¨ DEBUG log çº§åˆ«å»çœ‹å·²å‘é€åˆ° Elasticsearch å’Œ NebulaGraph çš„å†…å®¹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gd">- logging.basicConfig(level=logging.INFO)
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+ logging.basicConfig(level=logging.DEBUG)
</span></span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<p>æˆ–è€…ï¼Œåœ¨ NebulaStudio ä¸­æ¢ç´¢å¯¼å…¥çš„æ•°æ®ï¼š</p>
<p>é¦–å…ˆï¼Œç‚¹å‡» â€œStart with Verticesâ€ï¼Œå¡«å†™é¡¶ç‚¹ vidï¼š<code>snowflake://dbt_demo.public/fact_warehouse_inventory</code></p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168480047-26c28cde-5df8-40af-8da4-6ab0203094e2.png" title="https://user-images.githubusercontent.com/1651790/168480047-26c28cde-5df8-40af-8da4-6ab0203094e2.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168480047-26c28cde-5df8-40af-8da4-6ab0203094e2.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168480047-26c28cde-5df8-40af-8da4-6ab0203094e2.png"
            srcset="https://user-images.githubusercontent.com/1651790/168480047-26c28cde-5df8-40af-8da4-6ab0203094e2.png, https://user-images.githubusercontent.com/1651790/168480047-26c28cde-5df8-40af-8da4-6ab0203094e2.png 1.5x, https://user-images.githubusercontent.com/1651790/168480047-26c28cde-5df8-40af-8da4-6ab0203094e2.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168480047-26c28cde-5df8-40af-8da4-6ab0203094e2.png">
    </a></figure></p>
<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é¡¶ç‚¹æ˜¾ç¤ºä¸ºç²‰çº¢è‰²çš„ç‚¹ã€‚ è®©æˆ‘ä»¬ä¿®æ”¹ <code>Expand</code> / â€æ‹“å±•â€œé€‰é¡¹ï¼š</p>
<ul>
<li>æ–¹å‘ï¼šåŒå‘</li>
<li>æ­¥æ•°ï¼šå•å‘ã€ä¸‰æ­¥</li>
</ul>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168480101-7b7b5824-06d9-4155-87c9-798db0dc7612.png" title="https://user-images.githubusercontent.com/1651790/168480101-7b7b5824-06d9-4155-87c9-798db0dc7612.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168480101-7b7b5824-06d9-4155-87c9-798db0dc7612.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168480101-7b7b5824-06d9-4155-87c9-798db0dc7612.png"
            srcset="https://user-images.githubusercontent.com/1651790/168480101-7b7b5824-06d9-4155-87c9-798db0dc7612.png, https://user-images.githubusercontent.com/1651790/168480101-7b7b5824-06d9-4155-87c9-798db0dc7612.png 1.5x, https://user-images.githubusercontent.com/1651790/168480101-7b7b5824-06d9-4155-87c9-798db0dc7612.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168480101-7b7b5824-06d9-4155-87c9-798db0dc7612.png">
    </a></figure></p>
<p>å¹¶åŒå‡»é¡¶ç‚¹ï¼ˆç‚¹ï¼‰ï¼Œå®ƒå°†åŒå‘æ‹“å±• 3 æ­¥ï¼š</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168480280-1dc88d1b-1f1e-48fd-9997-972965522ef5.png" title="https://user-images.githubusercontent.com/1651790/168480280-1dc88d1b-1f1e-48fd-9997-972965522ef5.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168480280-1dc88d1b-1f1e-48fd-9997-972965522ef5.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168480280-1dc88d1b-1f1e-48fd-9997-972965522ef5.png"
            srcset="https://user-images.githubusercontent.com/1651790/168480280-1dc88d1b-1f1e-48fd-9997-972965522ef5.png, https://user-images.githubusercontent.com/1651790/168480280-1dc88d1b-1f1e-48fd-9997-972965522ef5.png 1.5x, https://user-images.githubusercontent.com/1651790/168480280-1dc88d1b-1f1e-48fd-9997-972965522ef5.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168480280-1dc88d1b-1f1e-48fd-9997-972965522ef5.png">
    </a></figure></p>
<p>ä»ä¸Šè¾¹è¿™ä¸ªæˆªå›¾é‡Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨å¯è§†åŒ–ä¹‹åçš„å›¾æ•°æ®åº“ä¸­ï¼Œè¿™äº›å…ƒæ•°æ®å¯ä»¥å¾ˆå®¹æ˜“è¢«æŸ¥çœ‹ã€åˆ†æï¼Œå¹¶ä»ä¸­è·å¾—æ´å¯Ÿã€‚</p>
<blockquote>
<p>å°è´´å£«ï¼Œæ‚¨å¯ä»¥ç‚¹å‡» ğŸ‘ å›¾æ ‡é€‰æ‹©ä¸€äº›è¦æ˜¾ç¤ºçš„å±æ€§ï¼Œæˆ‘åœ¨æˆªå›¾ä¹‹å‰å°±æ˜¯é€šè¿‡å®ƒè®©ä¸€äº›ä¿¡æ¯æ˜¾ç¤ºå‡ºæ¥çš„ã€‚</p>
</blockquote>
<p>è€Œä¸”ï¼Œæˆ‘ä»¬åœ¨ NebulaStudio ä¸­çœ‹åˆ°çš„ä¹Ÿä¸ Amundsen å…ƒæ•°æ®æœåŠ¡çš„æ•°æ®æ¨¡å‹ç›¸å‘¼åº”ï¼š</p>
<p><figure><a class="lightgallery" href="https://www.amundsen.io/amundsen/img/graph_model.png" title="https://www.amundsen.io/amundsen/img/graph_model.png" data-thumbnail="https://www.amundsen.io/amundsen/img/graph_model.png">
        <img
            
            loading="lazy"
            src="https://www.amundsen.io/amundsen/img/graph_model.png"
            srcset="https://www.amundsen.io/amundsen/img/graph_model.png, https://www.amundsen.io/amundsen/img/graph_model.png 1.5x, https://www.amundsen.io/amundsen/img/graph_model.png 2x"
            sizes="auto"
            alt="https://www.amundsen.io/amundsen/img/graph_model.png">
    </a></figure></p>
<p>æœ€åï¼Œè¯·è®°ä½æˆ‘ä»¬æ›¾åˆ©ç”¨ dbt æ¥è½¬æ¢meltano ä¸­çš„ä¸€äº›æ•°æ®ï¼Œå¹¶ä¸”æ¸…å•æ–‡ä»¶è·¯å¾„æ˜¯<code>.meltano/transformers/dbt/target/catalog.json</code>ï¼Œæ‚¨å¯ä»¥å°è¯•åˆ›å»ºä¸€ä¸ªæ•°æ®æ„å»ºå™¨ä½œä¸šæ¥å¯¼å…¥å®ƒã€‚</p>
<h3 id="æå–-superset-ä¸­çš„å…ƒæ•°æ®" class="headerLink">
    <a href="#%e6%8f%90%e5%8f%96-superset-%e4%b8%ad%e7%9a%84%e5%85%83%e6%95%b0%e6%8d%ae" class="header-mark"></a>4.3 æå– Superset ä¸­çš„å…ƒæ•°æ®</h3><p>Amundsen çš„ Superset extractor å¯ä»¥è·å–</p>
<ul>
<li>Dashboard å…ƒæ•°æ®æŠ½å– <a href="https://www.amundsen.io/amundsen/databuilder/databuilder/extractor/dashboard/apache_superset/apache_superset_metadata_extractor.py" target="_blank" rel="noopener noreferrer">https://www.amundsen.io/amundsen/databuilder/databuilder/extractor/dashboard/apache_superset/apache_superset_metadata_extractor.py</a></li>
<li>å›¾è¡¨å…ƒæ•°æ®æŠ½å– <a href="https://www.amundsen.io/amundsen/databuilder/databuilder" target="_blank" rel="noopener noreferrer">https://www.amundsen.io/amundsen/databuilder/databuilder</a> /extractor/dashboard/apache_superset/apache_superset_chart_extractor.py</li>
<li>Superset å…ƒç´ ä¸æ•°æ®æºï¼ˆè¡¨ï¼‰çš„å…³ç³»æŠ½å– <a href="https://www.amundsen.io/amundsen/databuilder/databuilder/extractor/dashboard/apache_superset/apache_superset_table_extractor.py" target="_blank" rel="noopener noreferrer">https://www.amundsen.io/amundsen/databuilder/databuilder/extractor/dashboard/apache_superset/apache_superset_table_extractor.py</a></li>
</ul>
<p>å’±ä»¬ç°åœ¨å°±å°è¯•æ‘„å–ä¹‹å‰åˆ›å»ºçš„ Superset Dashboard çš„å…ƒæ•°æ®ã€‚</p>
<h4 id="superset-å…ƒæ•°æ®-etl-çš„æ‰§è¡Œ" class="headerLink">
    <a href="#superset-%e5%85%83%e6%95%b0%e6%8d%ae-etl-%e7%9a%84%e6%89%a7%e8%a1%8c" class="header-mark"></a>4.3.1 Superset å…ƒæ•°æ® ETL çš„æ‰§è¡Œ</h4><p>ä¸‹è¾¹æ‰§è¡Œçš„ç¤ºä¾‹ Superset æå–è„šæœ¬å¯ä»¥ä»ä¸­è·å–æ•°æ®å¹¶å°†å…ƒæ•°æ®åŠ è½½åˆ° NebulaGraph å’Œ Elasticsearch ä¸­ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">python3</span> <span class="n">sample_superset_data_loader_nebula</span><span class="o">.</span><span class="n">py</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæˆ‘ä»¬å°†æ—¥å¿—è®°å½•çº§åˆ«è®¾ç½®ä¸ºâ€œDEBUGâ€ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥çœ‹åˆ°è¿™äº›ä¸­é—´çš„è¿‡ç¨‹æ—¥å¿—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># fetching metadata from superset</span>
</span></span><span class="line"><span class="cl"><span class="n">DEBUG</span><span class="p">:</span><span class="n">urllib3</span><span class="o">.</span><span class="n">connectionpool</span><span class="p">:</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8088</span> <span class="s2">&#34;POST /api/v1/security/login HTTP/1.1&#34;</span> <span class="mi">200</span> <span class="mi">280</span>
</span></span><span class="line"><span class="cl"><span class="n">INFO</span><span class="p">:</span><span class="n">databuilder</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">task</span><span class="p">:</span><span class="n">Running</span> <span class="n">a</span> <span class="n">task</span>
</span></span><span class="line"><span class="cl"><span class="n">DEBUG</span><span class="p">:</span><span class="n">urllib3</span><span class="o">.</span><span class="n">connectionpool</span><span class="p">:</span><span class="n">Starting</span> <span class="n">new</span> <span class="n">HTTP</span> <span class="n">connection</span> <span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">8088</span>
</span></span><span class="line"><span class="cl"><span class="n">DEBUG</span><span class="p">:</span><span class="n">urllib3</span><span class="o">.</span><span class="n">connectionpool</span><span class="p">:</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8088</span> <span class="s2">&#34;GET /api/v1/dashboard?q=(page_size:20,page:0,order_direction:desc) HTTP/1.1&#34;</span> <span class="mi">308</span> <span class="mi">374</span>
</span></span><span class="line"><span class="cl"><span class="n">DEBUG</span><span class="p">:</span><span class="n">urllib3</span><span class="o">.</span><span class="n">connectionpool</span><span class="p">:</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8088</span> <span class="s2">&#34;GET /api/v1/dashboard/?q=(page_size:20,page:0,order_direction:desc) HTTP/1.1&#34;</span> <span class="mi">200</span> <span class="mi">1058</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># insert Dashboard</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">DEBUG</span><span class="p">:</span><span class="n">databuilder</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">nebula_csv_publisher</span><span class="p">:</span><span class="n">Query</span><span class="p">:</span> <span class="n">INSERT</span> <span class="n">VERTEX</span> <span class="err">`</span><span class="n">Dashboard</span><span class="err">`</span> <span class="p">(</span><span class="err">`</span><span class="n">dashboard_url</span><span class="err">`</span><span class="p">,</span> <span class="err">`</span><span class="n">name</span><span class="err">`</span><span class="p">,</span> <span class="n">published_tag</span><span class="p">,</span> <span class="n">publisher_last_updated_epoch_ms</span><span class="p">)</span> <span class="n">VALUES</span>  <span class="s2">&#34;superset_dashboard://my_cluster.1/3&#34;</span><span class="p">:(</span><span class="s2">&#34;http://localhost:8088/superset/dashboard/3/&#34;</span><span class="p">,</span><span class="s2">&#34;my_dashboard&#34;</span><span class="p">,</span><span class="s2">&#34;unique_tag&#34;</span><span class="p">,</span><span class="n">timestamp</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># insert a DASHBOARD_WITH_TABLE relationship/edge</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">INFO</span><span class="p">:</span><span class="n">databuilder</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">nebula_csv_publisher</span><span class="p">:</span><span class="n">Importing</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">edge</span> <span class="n">files</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;/tmp/amundsen/dashboard/relationships/Dashboard_Table_DASHBOARD_WITH_TABLE.csv&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">DEBUG</span><span class="p">:</span><span class="n">databuilder</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">nebula_csv_publisher</span><span class="p">:</span><span class="n">Query</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">INSERT</span> <span class="n">edge</span> <span class="err">`</span><span class="n">DASHBOARD_WITH_TABLE</span><span class="err">`</span> <span class="p">(</span><span class="err">`</span><span class="n">END_LABEL</span><span class="err">`</span><span class="p">,</span> <span class="err">`</span><span class="n">START_LABEL</span><span class="err">`</span><span class="p">,</span> <span class="n">published_tag</span><span class="p">,</span> <span class="n">publisher_last_updated_epoch_ms</span><span class="p">)</span> <span class="n">VALUES</span> <span class="s2">&#34;superset_dashboard://my_cluster.1/3&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;postgresql+psycopg2://my_cluster.warehouse/orders&#34;</span><span class="p">:(</span><span class="s2">&#34;Table&#34;</span><span class="p">,</span><span class="s2">&#34;Dashboard&#34;</span><span class="p">,</span><span class="s2">&#34;unique_tag&#34;</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">()),</span> <span class="s2">&#34;superset_dashboard://my_cluster.1/3&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;postgresql+psycopg2://my_cluster.warehouse/customers&#34;</span><span class="p">:(</span><span class="s2">&#34;Table&#34;</span><span class="p">,</span><span class="s2">&#34;Dashboard&#34;</span><span class="p">,</span><span class="s2">&#34;unique_tag&#34;</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="éªŒè¯-superset-dashboard-å…ƒæ•°æ®" class="headerLink">
    <a href="#%e9%aa%8c%e8%af%81-superset-dashboard-%e5%85%83%e6%95%b0%e6%8d%ae" class="header-mark"></a>4.3.2 éªŒè¯ Superset Dashboard å…ƒæ•°æ®</h4><p>é€šè¿‡åœ¨ Amundsen ä¸­æœç´¢å®ƒï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥è·å¾— Dashboard ä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä» NebulaStudio è¿›è¡ŒéªŒè¯ã€‚</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168719624-738323dd-4c6e-475f-a370-f149181c6184.png" title="https://user-images.githubusercontent.com/1651790/168719624-738323dd-4c6e-475f-a370-f149181c6184.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168719624-738323dd-4c6e-475f-a370-f149181c6184.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168719624-738323dd-4c6e-475f-a370-f149181c6184.png"
            srcset="https://user-images.githubusercontent.com/1651790/168719624-738323dd-4c6e-475f-a370-f149181c6184.png, https://user-images.githubusercontent.com/1651790/168719624-738323dd-4c6e-475f-a370-f149181c6184.png 1.5x, https://user-images.githubusercontent.com/1651790/168719624-738323dd-4c6e-475f-a370-f149181c6184.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168719624-738323dd-4c6e-475f-a370-f149181c6184.png">
    </a></figure></p>
<blockquote>
<p>æ³¨ï¼šå¯ä»¥å‚é˜… <a href="https://www.amundsen.io/amundsen/databuilder/docs/dashboard_ingestion_guide/" target="_blank" rel="noopener noreferrer">Dashboard æŠ“å–æŒ‡å—</a> ä¸­çš„ Amundsen Dashboard å›¾å»ºæ¨¡ï¼š</p>
<p><figure><a class="lightgallery" href="https://www.amundsen.io/amundsen/databuilder/docs/assets/dashboard_graph_modeling.png?raw=true" title="dashboard_graph_modeling" data-thumbnail="https://www.amundsen.io/amundsen/databuilder/docs/assets/dashboard_graph_modeling.png?raw=true">
        <img
            
            loading="lazy"
            src="https://www.amundsen.io/amundsen/databuilder/docs/assets/dashboard_graph_modeling.png?raw=true"
            srcset="https://www.amundsen.io/amundsen/databuilder/docs/assets/dashboard_graph_modeling.png?raw=true, https://www.amundsen.io/amundsen/databuilder/docs/assets/dashboard_graph_modeling.png?raw=true 1.5x, https://www.amundsen.io/amundsen/databuilder/docs/assets/dashboard_graph_modeling.png?raw=true 2x"
            sizes="auto"
            alt="https://www.amundsen.io/amundsen/databuilder/docs/assets/dashboard_graph_modeling.png?raw=true">
    </a></figure></p>
</blockquote>
<h3 id="ç”¨-superset-é¢„è§ˆæ•°æ®" class="headerLink">
    <a href="#%e7%94%a8-superset-%e9%a2%84%e8%a7%88%e6%95%b0%e6%8d%ae" class="header-mark"></a>4.4 ç”¨ Superset é¢„è§ˆæ•°æ®</h3><p>Supersetå¯ä»¥ç”¨æ¥é¢„è§ˆè¿™æ ·çš„è¡¨æ ¼æ•°æ®ã€‚ ç›¸åº”çš„æ–‡æ¡£å¯ä»¥å‚è€ƒ <a href="https://www.amundsen.io/amundsen/frontend/docs/configuration/#preview-client" target="_blank" rel="noopener noreferrer">https://www.amundsen.io/amundsen/frontend/docs/configuration/#preview-client</a> ï¼Œå…¶ä¸­ <code>/superset/sql_json/</code> çš„ API è¢« Amundsen Frontend service è°ƒç”¨ï¼Œå–å¾—é¢„è§ˆä¿¡æ¯ã€‚</p>
<p><figure><a class="lightgallery" href="https://github.com/amundsen-io/amundsenfrontendlibrary/blob/master/docs/img/data_preview.png?raw=true" title="https://github.com/amundsen-io/amundsenfrontendlibrary/blob/master/docs/img/data_preview.png?raw=true" data-thumbnail="https://github.com/amundsen-io/amundsenfrontendlibrary/blob/master/docs/img/data_preview.png?raw=true">
        <img
            
            loading="lazy"
            src="https://github.com/amundsen-io/amundsenfrontendlibrary/blob/master/docs/img/data_preview.png?raw=true"
            srcset="https://github.com/amundsen-io/amundsenfrontendlibrary/blob/master/docs/img/data_preview.png?raw=true, https://github.com/amundsen-io/amundsenfrontendlibrary/blob/master/docs/img/data_preview.png?raw=true 1.5x, https://github.com/amundsen-io/amundsenfrontendlibrary/blob/master/docs/img/data_preview.png?raw=true 2x"
            sizes="auto"
            alt="https://github.com/amundsen-io/amundsenfrontendlibrary/blob/master/docs/img/data_preview.png?raw=true">
    </a></figure></p>
<h3 id="å¼€å¯æ•°æ®è¡€ç¼˜ä¿¡æ¯" class="headerLink">
    <a href="#%e5%bc%80%e5%90%af%e6%95%b0%e6%8d%ae%e8%a1%80%e7%bc%98%e4%bf%a1%e6%81%af" class="header-mark"></a>4.5 å¼€å¯æ•°æ®è¡€ç¼˜ä¿¡æ¯</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°æ®è¡€ç¼˜æ˜¯å…³é—­çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯ç”¨å®ƒï¼š</p>
<ol start="0">
<li><code>cd</code> åˆ° Amundsen ä»£ç ä»“åº“ä¸‹ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬è¿è¡Œ <code>docker-compose -f docker-amundsen-nebula.yml up</code> å‘½ä»¤çš„åœ°æ–¹</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> amundsen
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>ä¿®æ”¹ frontend ä¸‹çš„ typescript é…ç½®</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gd">--- a/frontend/amundsen_application/static/js/config/config-default.ts
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+++ b/frontend/amundsen_application/static/js/config/config-default.ts
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>   tableLineage: {
</span></span><span class="line"><span class="cl"><span class="gd">-    inAppListEnabled: false,
</span></span></span><span class="line"><span class="cl"><span class="gd">-    inAppPageEnabled: false,
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+    inAppListEnabled: true,
</span></span></span><span class="line"><span class="cl"><span class="gi">+    inAppPageEnabled: true,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>     externalEnabled: false,
</span></span><span class="line"><span class="cl">     iconPath: &#39;PATH_TO_ICON&#39;,
</span></span><span class="line"><span class="cl">     isBeta: false,
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>é‡æ–°æ„å»º docker é•œåƒï¼Œå…¶ä¸­å°†é‡å»ºå‰ç«¯å›¾åƒã€‚</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose -f docker-amundsen-nebula.yml build
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œé‡æ–°è¿è¡Œ <code>up -d</code> ä»¥ç¡®ä¿å‰ç«¯ç”¨æ–°çš„é…ç½®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose -f docker-amundsen-nebula.yml up -d
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœå¤§æ¦‚é•¿è¿™æ ·å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker-compose -f docker-amundsen-nebula.yml up -d
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">Recreating amundsenfrontend           ... <span class="k">done</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—® http://localhost:5000/lineage/table/gold/hive/test_schema/test_table1 çœ‹åˆ° <code>Lineage ï¼ˆbetaï¼‰</code> è¡€ç¼˜æŒ‰é’®å·²ç»æ˜¾ç¤ºå‡ºæ¥äº†ï¼š</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168838731-79d0e3bc-439e-4f6b-8ef7-83b37e9bcb12.png" title="https://user-images.githubusercontent.com/1651790/168838731-79d0e3bc-439e-4f6b-8ef7-83b37e9bcb12.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168838731-79d0e3bc-439e-4f6b-8ef7-83b37e9bcb12.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168838731-79d0e3bc-439e-4f6b-8ef7-83b37e9bcb12.png"
            srcset="https://user-images.githubusercontent.com/1651790/168838731-79d0e3bc-439e-4f6b-8ef7-83b37e9bcb12.png, https://user-images.githubusercontent.com/1651790/168838731-79d0e3bc-439e-4f6b-8ef7-83b37e9bcb12.png 1.5x, https://user-images.githubusercontent.com/1651790/168838731-79d0e3bc-439e-4f6b-8ef7-83b37e9bcb12.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168838731-79d0e3bc-439e-4f6b-8ef7-83b37e9bcb12.png">
    </a></figure></p>
<p>æˆ‘ä»¬å¯ä»¥ç‚¹å‡» <code>Downstream</code> åœ¨å­˜åœ¨çš„æ—¶å€™æŸ¥çœ‹è¯¥è¡¨çš„ä¸‹æ¸¸èµ„æºï¼š</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168839251-efd523af-d729-44cf-a40b-fa83a0852654.png" title="https://user-images.githubusercontent.com/1651790/168839251-efd523af-d729-44cf-a40b-fa83a0852654.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168839251-efd523af-d729-44cf-a40b-fa83a0852654.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168839251-efd523af-d729-44cf-a40b-fa83a0852654.png"
            srcset="https://user-images.githubusercontent.com/1651790/168839251-efd523af-d729-44cf-a40b-fa83a0852654.png, https://user-images.githubusercontent.com/1651790/168839251-efd523af-d729-44cf-a40b-fa83a0852654.png 1.5x, https://user-images.githubusercontent.com/1651790/168839251-efd523af-d729-44cf-a40b-fa83a0852654.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168839251-efd523af-d729-44cf-a40b-fa83a0852654.png">
    </a></figure></p>
<p>æˆ–è€…ç‚¹è¡€ç¼˜æŒ‰é’®æŸ¥çœ‹è¡€ç¼˜çš„å›¾è¡¨å¼ï¼š</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168838814-e6ff5152-c24b-470e-a46a-48f183ba7201.png" title="https://user-images.githubusercontent.com/1651790/168838814-e6ff5152-c24b-470e-a46a-48f183ba7201.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168838814-e6ff5152-c24b-470e-a46a-48f183ba7201.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168838814-e6ff5152-c24b-470e-a46a-48f183ba7201.png"
            srcset="https://user-images.githubusercontent.com/1651790/168838814-e6ff5152-c24b-470e-a46a-48f183ba7201.png, https://user-images.githubusercontent.com/1651790/168838814-e6ff5152-c24b-470e-a46a-48f183ba7201.png 1.5x, https://user-images.githubusercontent.com/1651790/168838814-e6ff5152-c24b-470e-a46a-48f183ba7201.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168838814-e6ff5152-c24b-470e-a46a-48f183ba7201.png">
    </a></figure></p>
<p>ä¹Ÿæœ‰ç”¨äºè¡€ç¼˜æŸ¥è¯¢çš„ APIã€‚ è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬ç”¨ cURL è°ƒç”¨ä¸‹è¿™ä¸ª APIï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker run -it --rm --net container:amundsenfrontend nicolaka/netshoot
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">curl <span class="s2">&#34;http://amundsenmetadata:5002/table/snowflake://dbt_demo.public/raw_inventory_value/lineage?depth=3&amp;direction=both&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„ API è°ƒç”¨æ˜¯æŸ¥è¯¢ä¸Šæ¸¸å’Œä¸‹æ¸¸æ–¹å‘çš„ linageï¼Œè¡¨ <code>snowflake://dbt_demo.public/raw_inventory_value</code> çš„æ·±åº¦ä¸º 3ã€‚</p>
<p>ç»“æœåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;depth&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;downstream_entities&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;level&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;usage&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;snowflake://dbt_demo.public/fact_daily_expenses&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;parent&#34;</span><span class="p">:</span> <span class="s2">&#34;snowflake://dbt_demo.public/fact_warehouse_inventory&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;badges&#34;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;source&#34;</span><span class="p">:</span> <span class="s2">&#34;snowflake&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;level&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;usage&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;snowflake://dbt_demo.public/fact_warehouse_inventory&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;parent&#34;</span><span class="p">:</span> <span class="s2">&#34;snowflake://dbt_demo.public/raw_inventory_value&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;badges&#34;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;source&#34;</span><span class="p">:</span> <span class="s2">&#34;snowflake&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;snowflake://dbt_demo.public/raw_inventory_value&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;direction&#34;</span><span class="p">:</span> <span class="s2">&#34;both&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;upstream_entities&#34;</span><span class="p">:</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®é™…ä¸Šï¼Œè¿™ä¸ªè¡€ç¼˜æ•°æ®å°±æ˜¯åœ¨æˆ‘ä»¬çš„ <a href="https://github.com/amundsen-io/amundsen/blob/main/databuilder/databuilder/extractor/dbt_extractor.py" target="_blank" rel="noopener noreferrer">DbtExtractor</a> æ‰§è¡ŒæœŸé—´æå–å’ŒåŠ è½½çš„ï¼Œå…¶ä¸­ <code>extractor .dbt.{DbtExtractor.EXTRACT_LINEAGE}</code> é»˜è®¤ä¸º <code>True</code>ï¼Œå› æ­¤åˆ›å»ºäº†è¡€ç¼˜å…ƒæ•°æ®å¹¶å°†å…¶åŠ è½½åˆ°äº† Amundsenã€‚</p>
<h4 id="åœ¨-nebulagraph-ä¸­æ´å¯Ÿè¡€ç¼˜" class="headerLink">
    <a href="#%e5%9c%a8-nebulagraph-%e4%b8%ad%e6%b4%9e%e5%af%9f%e8%a1%80%e7%bc%98" class="header-mark"></a>4.5.1 åœ¨ NebulaGraph ä¸­æ´å¯Ÿè¡€ç¼˜</h4><p>ä½¿ç”¨å›¾æ•°æ®åº“ä½œä¸ºå…ƒæ•°æ®å­˜å‚¨çš„ä¸¤ä¸ªä¼˜ç‚¹æ˜¯ï¼š</p>
<ul>
<li>å›¾æŸ¥è¯¢æœ¬èº«æ˜¯ä¸€ä¸ªçµæ´»çš„ DSL for lineage APIï¼Œä¾‹å¦‚ï¼Œè¿™ä¸ªæŸ¥è¯¢å¸®åŠ©æˆ‘ä»¬æ‰§è¡Œ Amundsen å…ƒæ•°æ® API çš„ç­‰ä»·çš„æŸ¥è¯¢ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">t</span><span class="p">:</span><span class="o">`</span><span class="k">Table</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="p">[:</span><span class="o">`</span><span class="n">HAS_UPSTREAM</span><span class="o">`|</span><span class="p">:</span><span class="o">`</span><span class="n">HAS_DOWNSTREAM</span><span class="o">`</span><span class="w"> </span><span class="o">*</span><span class="mi">1</span><span class="p">..</span><span class="mi">3</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;snowflake://dbt_demo.public/raw_inventory_value&#34;</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æˆ‘ä»¬ç°åœ¨ç”šè‡³å¯ä»¥åœ¨ NebulaGraph Studio æˆ–è€… Explorer çš„æ§åˆ¶å°ä¸­æŸ¥è¯¢å®ƒ</li>
</ul>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168844882-ca3d0587-7946-4e17-8264-9dc973a44673.png" title="https://user-images.githubusercontent.com/1651790/168844882-ca3d0587-7946-4e17-8264-9dc973a44673.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168844882-ca3d0587-7946-4e17-8264-9dc973a44673.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168844882-ca3d0587-7946-4e17-8264-9dc973a44673.png"
            srcset="https://user-images.githubusercontent.com/1651790/168844882-ca3d0587-7946-4e17-8264-9dc973a44673.png, https://user-images.githubusercontent.com/1651790/168844882-ca3d0587-7946-4e17-8264-9dc973a44673.png 1.5x, https://user-images.githubusercontent.com/1651790/168844882-ca3d0587-7946-4e17-8264-9dc973a44673.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168844882-ca3d0587-7946-4e17-8264-9dc973a44673.png">
    </a></figure></p>
<p>â€‹    ç„¶åæ¸²æŸ“è¿™ä¸ªç»“æœï¼š</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168845155-b0e7a5ce-3ddf-4cc9-89a3-aaf1bbb0f5ec.png" title="https://user-images.githubusercontent.com/1651790/168845155-b0e7a5ce-3ddf-4cc9-89a3-aaf1bbb0f5ec.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/168845155-b0e7a5ce-3ddf-4cc9-89a3-aaf1bbb0f5ec.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168845155-b0e7a5ce-3ddf-4cc9-89a3-aaf1bbb0f5ec.png"
            srcset="https://user-images.githubusercontent.com/1651790/168845155-b0e7a5ce-3ddf-4cc9-89a3-aaf1bbb0f5ec.png, https://user-images.githubusercontent.com/1651790/168845155-b0e7a5ce-3ddf-4cc9-89a3-aaf1bbb0f5ec.png 1.5x, https://user-images.githubusercontent.com/1651790/168845155-b0e7a5ce-3ddf-4cc9-89a3-aaf1bbb0f5ec.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168845155-b0e7a5ce-3ddf-4cc9-89a3-aaf1bbb0f5ec.png">
    </a></figure></p>
<h4 id="æå–æ•°æ®è¡€ç¼˜" class="headerLink">
    <a href="#%e6%8f%90%e5%8f%96%e6%95%b0%e6%8d%ae%e8%a1%80%e7%bc%98" class="header-mark"></a>4.5.2 æå–æ•°æ®è¡€ç¼˜</h4><p>è¿™äº›è¡€ç¼˜ä¿¡æ¯æ˜¯éœ€è¦æˆ‘ä»¬æ˜ç¡®æŒ‡å®šã€è·å–çš„ï¼Œè·å–çš„æ–¹å¼å¯ä»¥æ˜¯è‡ªå·±å†™çš„ extractorï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€äº›å·²ç»æœ‰çš„æ–¹å¼ã€‚æ¯”å¦‚ dbt çš„ extractorå’Œ Open Lineage é¡¹ç›®çš„ Amundsen extractorã€‚</p>
<h5 id="é€šè¿‡-dbt" class="headerLink">
    <a href="#%e9%80%9a%e8%bf%87-dbt" class="header-mark"></a>4.5.2.1 é€šè¿‡ dbt</h5><p>è¿™ä¸ªåœ¨åˆšæ‰å·²ç»å±•ç¤ºè¿‡äº†ï¼ŒDbt çš„ Extractor ä¼šä»è¡¨çº§åˆ«è·å–è¡€ç¼˜å’Œå…¶ä»– dbt ä¸­äº§ç”Ÿçš„å…ƒæ•°æ®ä¿¡æ¯ä¸€èµ·è¢«æ‹¿åˆ°ã€‚</p>
<h5 id="é€šè¿‡-open-lineage" class="headerLink">
    <a href="#%e9%80%9a%e8%bf%87-open-lineage" class="header-mark"></a>4.5.2.2 é€šè¿‡ Open Lineage</h5><p>Amundsen ä¸­çš„å¦ä¸€ä¸ªå¼€ç®±å³ç”¨çš„è¡€ç¼˜ Extractor æ˜¯ <a href="https://www.amundsen.io/amundsen/databuilder/#openlineagetablelineageextractor" target="_blank" rel="noopener noreferrer">OpenLineageTableLineageExtractor</a>ã€‚</p>
<p><a href="https://openlineage.io/" target="_blank" rel="noopener noreferrer">Open Lineage</a> æ˜¯ä¸€ä¸ªå¼€æ”¾çš„æ¡†æ¶ï¼Œå¯ä»¥å°†ä¸åŒæ¥æºçš„è¡€ç»Ÿæ•°æ®æ”¶é›†åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œå®ƒå¯ä»¥å°†è¡€ç»Ÿä¿¡æ¯è¾“å‡ºä¸º JSON æ–‡ä»¶ï¼šhttps://www.amundsen.io/amundsen/databuilder/#openlineagetablelineageextractor</p>
<p>ä¸‹è¾¹æ˜¯å®ƒçš„ Amundsen data builder ä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">dict_config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl">    <span class="sa">f</span><span class="s1">&#39;extractor.openlineage_tablelineage.</span><span class="si">{</span><span class="n">OpenLineageTableLineageExtractor</span><span class="o">.</span><span class="n">CLUSTER_NAME</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;datalab&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="sa">f</span><span class="s1">&#39;extractor.openlineage_tablelineage.</span><span class="si">{</span><span class="n">OpenLineageTableLineageExtractor</span><span class="o">.</span><span class="n">OL_DATASET_NAMESPACE_OVERRIDE</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;hive_table&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="sa">f</span><span class="s1">&#39;extractor.openlineage_tablelineage.</span><span class="si">{</span><span class="n">OpenLineageTableLineageExtractor</span><span class="o">.</span><span class="n">TABLE_LINEAGE_FILE_LOCATION</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;input_dir/openlineage_nd.json&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">task</span> <span class="o">=</span> <span class="n">DefaultTask</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">extractor</span><span class="o">=</span><span class="n">OpenLineageTableLineageExtractor</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">loader</span><span class="o">=</span><span class="n">FsNebulaCSVLoader</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å›é¡¾" class="headerLink">
    <a href="#%e5%9b%9e%e9%a1%be" class="header-mark"></a>5 å›é¡¾</h2><p>æ•´å¥—å…ƒæ•°æ®æ²»ç†/å‘ç°çš„æ–¹æ¡ˆæ€è·¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>å°†æ•´ä¸ªæ•°æ®æŠ€æœ¯æ ˆä¸­çš„ç»„ä»¶ä½œä¸ºå…ƒæ•°æ®æºï¼ˆä»ä»»ä½•æ•°æ®åº“ã€æ•°ä»“ï¼Œåˆ° dbtã€Airflowã€Openlineageã€Superset ç­‰å„çº§é¡¹ç›®ï¼‰</li>
<li>ä½¿ç”¨ Databuilderï¼ˆä½œä¸ºè„šæœ¬æˆ– DAGï¼‰è¿è¡Œå…ƒæ•°æ® ETLï¼Œä»¥ä½¿ç”¨ NebulaGraph å’Œ Elasticsearch å­˜å‚¨å’Œç´¢å¼•</li>
<li>ä»å‰ç«¯ UIï¼ˆä½¿ç”¨ Superset é¢„è§ˆï¼‰æˆ– API å»ä½¿ç”¨ã€æ¶ˆè´¹ã€ç®¡ç†å’Œå‘ç°å…ƒæ•°æ®</li>
<li>é€šè¿‡æŸ¥è¯¢å’Œ UI å¯¹ NebulaGraphï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—æ›´å¤šçš„å¯èƒ½æ€§ã€çµæ´»æ€§å’Œæ•°æ®ã€è¡€ç¼˜çš„æ´å¯Ÿ</li>
</ul>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg" title="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg" data-thumbnail="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg"
            srcset="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg, https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg 1.5x, https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg">
    </a></figure></p>
<h3 id="æ¶‰åŠåˆ°çš„å¼€æº" class="headerLink">
    <a href="#%e6%b6%89%e5%8f%8a%e5%88%b0%e7%9a%84%e5%bc%80%e6%ba%90" class="header-mark"></a>5.1 æ¶‰åŠåˆ°çš„å¼€æº</h3><p>æ­¤å‚è€ƒé¡¹ç›®ä¸­ä½¿ç”¨çš„æ‰€æœ‰é¡¹ç›®éƒ½æŒ‰å­—å…¸é¡ºåºåœ¨ä¸‹é¢åˆ—å‡ºã€‚</p>
<ul>
<li>Amundsen</li>
<li>Apache Airflow</li>
<li>Apache Superset</li>
<li>dbt</li>
<li>Elasticsearch</li>
<li>meltano</li>
<li>Nebula Graph</li>
<li>Open Lineage</li>
<li>singer</li>
</ul>
<blockquote>
<p>é¢˜å›¾ç‰ˆæƒï¼š <a href="https://unsplash.com/photos/PhnJhjH9Y9s" target="_blank" rel="noopener noreferrer">Phil Hearing</a></p>
</blockquote>]]></description>
</item><item>
    <title>NebulaGraph çš„äº‘åŸç”Ÿ API ç½‘å…³æœ€ä½³å®è·µ</title>
    <link>https://siwei.io/apisix-and-nebulagraph/</link>
    <pubDate>Wed, 16 Nov 2022 17:24:42 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/apisix-and-nebulagraph/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/apisix-and-nebulagraph/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>æœ¬æ–‡ä»‹ç»äº†åˆ©ç”¨å¼€æº API ç½‘å…³ APISIX åŠ é€Ÿ NebulaGraph å¤šä¸ªåœºæ™¯çš„è½åœ°æœ€ä½³å®è·µï¼šè´Ÿè½½å‡è¡¡ã€æš´éœ²æ¥å£ç»“æ„ä¸ TLS Terminationã€‚</p>
</blockquote>
<!--

[TOC]

-->
<h2 id="api-ç½‘å…³ä»‹ç»" class="headerLink">
    <a href="#api-%e7%bd%91%e5%85%b3%e4%bb%8b%e7%bb%8d" class="header-mark"></a>1 API ç½‘å…³ä»‹ç»</h2><h3 id="ä»€ä¹ˆæ˜¯-api-ç½‘å…³" class="headerLink">
    <a href="#%e4%bb%80%e4%b9%88%e6%98%af-api-%e7%bd%91%e5%85%b3" class="header-mark"></a>1.1 ä»€ä¹ˆæ˜¯ API ç½‘å…³</h3><p>API ç½‘å…³æ˜¯å®ƒä½äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„â€œä¸­é—´äººâ€ï¼Œç”¨äºç®¡ç†ã€ç›‘æ§å’Œä¿æŠ¤ APIã€‚å®ƒå¯ä»¥åœ¨ API ä¹‹å‰æ‰§è¡Œä¸€äº›æ“ä½œï¼Œä¾‹å¦‚èº«ä»½éªŒè¯ã€æˆæƒã€ç¼“å­˜ã€æ—¥å¿—è®°å½•ã€å®¡è®¡ã€æµé‡æ§åˆ¶ã€å®‰å…¨ã€é˜²ç«å¢™ã€å‹ç¼©ã€è§£å‹ç¼©ã€åŠ å¯†ã€è§£å¯†ç­‰ã€‚</p>
<p>API ç½‘å…³å¯ä»¥å·¥ä½œåœ¨ 4 å±‚å’Œ 7 å±‚ã€‚è·‘åœ¨ 7 å±‚çš„API ç½‘å…³å¯ä»¥ä½¿ç”¨å¤šç§åè®®ï¼Œä¾‹å¦‚ HTTPã€HTTPSã€WebSocketã€gRPCã€MQTT ç­‰ï¼Œåœ¨è¿™äº›åº”ç”¨å±‚åè®®ä¸­åšä¸€äº›æ“ä½œï¼Œä¾‹å¦‚è¯·æ±‚é‡å†™ã€è¯·æ±‚è½¬å‘ã€è¯·æ±‚åˆå¹¶ã€è¯·æ±‚é‡è¯•ã€è¯·æ±‚ç¼“å­˜ã€è¯·æ±‚é™æµã€è¯·æ±‚ç†”æ–­ã€è¯·æ±‚é™çº§ã€è¯·æ±‚é‰´æƒã€è¯·æ±‚ç›‘æ§ã€è¯·æ±‚æ—¥å¿—ã€è¯·æ±‚å®¡è®¡ã€è¯·æ±‚è½¬å‘ç­‰ç­‰ã€‚</p>
<p>è¿™é‡Œä¸¾ä¾‹ä¸€ä¸‹å€ŸåŠ© API ç½‘å…³å¯ä»¥åšçš„å…·ä½“çš„äº‹å„¿å§ï¼š</p>
<ul>
<li>æˆ‘ä»¬å¯ä»¥åœ¨ç½‘å…³å±‚å¢åŠ è®¤è¯å±‚ï¼Œæ¯”å¦‚ JWT è®¤è¯ã€OAuth2 è®¤è¯ã€OpenID è®¤è¯ç­‰ç­‰ï¼Œè¿™æ ·åˆ™ä¸éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡ä¸­éƒ½åšå…·ä½“çš„è®¤è¯é›†æˆå·¥ä½œï¼Œè¿™å¯ä»¥èŠ‚çœéå¸¸å¤šçš„å¼€å‘æˆæœ¬ã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥å€ŸåŠ©ç½‘å…³ç»™è·³æ¿æœº SSH æµé‡å¢åŠ æ— éœ€å®¢æˆ·ç«¯ä¿®æ”¹çš„å¤æ‚è®¤è¯ï¼Œæ¯”å¦‚è·³è½¬ä»»ä½•å®¢æˆ·ç«¯çš„ SSH ç™»å½•ï¼Œç»™å‡ºä¸€ä¸ªç½‘å€æˆ–è€…è¾“å…¥æ¡†ï¼Œå¼•å¯¼ç™»é™†è€…é€šè¿‡ç½‘é¡µçš„ SSO è®¤è¯ï¼ˆåŒ…å«å¤šå› ç´ è®¤è¯ï¼‰ï¼Œç„¶åå†é€šè¿‡ç½‘å…³è½¬å‘åˆ° SSH æœåŠ¡ã€‚</li>
<li>æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨ç½‘å…³å±‚åš Serverless æ•°æ®åº“ï¼TiDB ç¤¾åŒºçš„åŒå­¦ä»¬å°±åœ¨åšè¿™ä¸ªäº‹å„¿ï¼Œä»–ä»¬ä»æ™®é€šçš„ MySQL å®¢æˆ·ç«¯çš„ç™»å½•è¯·æ±‚ä¸­è§£æèƒ½æ¨æ–­å‡ºè½¬åˆ°éœ€è¦çš„ TiDB ç¤ºä¾‹çš„ä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨éœ€è¦ cold start å”¤é†’å®ä¾‹çš„æ—¶å€™æŠŠè¿æ¥ä¿æŒä½ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="https://disksing.com/tidb-gateway/" target="_blank" rel="noopener noreferrer">TiDB Gateway</a>ã€‚</li>
<li>å¦‚æœæˆ‘ä»¬ç‰¹åˆ«æƒ¨åœ¨ç»´æŠ¤ä¸€äº›å±å±±é¡¹ç›®ï¼Œä¸å¾—ä¸é’ˆå¯¹æ—§ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºå¯¹æ–°ç‰ˆæœ¬çš„æœåŠ¡ç«¯è¿›è¡Œå…¼å®¹ï¼Œè¿™æ—¶å€™ API ç½‘å…³ä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›è¯·æ±‚é‡å†™ï¼ŒæŠŠæ—§ç‰ˆæœ¬çš„è¯·æ±‚è½¬æ¢æˆæ–°ç‰ˆæœ¬çš„è¯·æ±‚ã€‚</li>
</ul>
<p>åªè¦è„‘æ´å¤§ï¼Œç†è®ºä¸ŠAPI çš„ç½‘å…³å¯ä»¥åšå¾ˆå¤šå¾ˆå¤šäº‹å„¿ï¼Œæ˜¾ç„¶ï¼Œä¸æ˜¯æ‰€æœ‰çš„äº‹æƒ…éƒ½æ˜¯é€‚åˆåœ¨è¿™ä¸€å±‚é¢å»åšçš„ï¼Œé€šå¸¸é‚£äº›æ¯”è¾ƒé€šç”¨çš„äº‹æƒ…æ‰é€‚åˆåœ¨è¿™ä¸€å±‚é¢å»åšï¼Œè¿™é‡Œæˆ‘åªæ˜¯ç»™å‡ºä¸€äº›å…¸å‹å’Œæç«¯çš„å…·ä½“ä¾‹å­ã€‚</p>
<h3 id="apache-apisix" class="headerLink">
    <a href="#apache-apisix" class="header-mark"></a>1.2 Apache APISIX</h3><p>API ç½‘å…³æ˜¯ä» LBã€Reverse Proxy é¡¹ç›®æ¼”è¿›è¿‡æ¥çš„ï¼Œéšç€äº‘åŸç”Ÿçš„å…´èµ·ï¼ŒAPI ç½‘å…³ä¹Ÿé€æ¸æˆä¸ºäº†äº‘åŸç”Ÿçš„ä¸€éƒ¨åˆ†ï¼Œæµè¡Œçš„å¼€æºçš„ç½‘å…³å°±æœ‰å¾ˆå¤šï¼š</p>
<ul>
<li><a href="github.com/nginx/nginx" rel="">Nginx</a></li>
<li><a href="github.com/apache/apisix" rel="">Apache APISIX</a></li>
<li><a href="github.com/Kong/kong" rel="">Kong</a></li>
<li><a href="github.com/luraproject/lura" rel="">Lura</a></li>
<li><a href="github.com/openresty/openresty" rel="">OpenResty</a></li>
<li><a href="github.com/TykTechnologies/tyk" rel="">Tyk</a></li>
<li><a href="github.com/traefik/traefik" rel="">Traefik</a></li>
<li><a href="github.com/istio/istio" rel="">Istio</a></li>
<li><a href="github.com/envoyproxy/envoy" rel="">Envoy</a></li>
</ul>
<p>è€Œä¸”å…¶ä¸­å¾ˆå¤šéƒ½æ˜¯åŸºäº Nginx/OpenResty çš„ä¸‹æ¸¸é¡¹ç›®ï¼Œè¿™é‡Œå°±ä»¥ Apache APISIX ä¸ºä¾‹ï¼Œä»‹ç»ä¸€ä¸‹ NebulaGraph å€ŸåŠ© API ç½‘å…³çš„å‡ ä¸ªå®è·µã€‚</p>
<h2 id="nebulagraph-ä»‹ç»" class="headerLink">
    <a href="#nebulagraph-%e4%bb%8b%e7%bb%8d" class="header-mark"></a>2 NebulaGraph ä»‹ç»</h2><p>NebulaGraph æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼å›¾æ•°æ®åº“ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>é«˜æ€§èƒ½ï¼šNebulaGraph çš„æ€§èƒ½å¯ä»¥è¾¾åˆ°æ¯ç§’ç™¾ä¸‡çº§çš„è¯»å†™ï¼Œå…·æœ‰æé«˜çš„æ‰©å±•æ€§ï¼Œåœ¨åƒäº¿ç‚¹ä¸‡äº¿è¾¹çš„è§„æ¨¡ä¸Šæ”¯æŒæ¯«ç§’çº§çš„æŸ¥è¯¢ã€‚</li>
<li>æ˜“æ‰©å±•ï¼šNebulaGraph çš„æ¶æ„æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå¯ä»¥åœ¨å¤šå°æœºå™¨ä¸Šæ‰©å±•ï¼Œæ¯å°æœºå™¨ä¸Šå¯ä»¥è¿è¡Œå¤šä¸ªæœåŠ¡è¿›ç¨‹ï¼Œå®ƒçš„æŸ¥è¯¢å±‚æ˜¯æ— çŠ¶æ€çš„è®¡ç®—å­˜å‚¨åˆ†ç¦»æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å¼•å…¥ä¸åŒé…ç½®ã€ä¸é€šç±»å‹çš„è®¡ç®—å±‚ï¼Œå®ç°åŒä¸€é›†ç¾¤ä¸Š TPã€APã€ å›¾è®¡ç®—ç­‰ä¸åŒè´Ÿè½½çš„æ··åˆæŸ¥è¯¢ã€‚</li>
<li>æ˜“ä½¿ç”¨ï¼šNebulaGraph çš„åŸç”ŸæŸ¥è¯¢è¯­è¨€æ˜¯ç±» SQL çš„ï¼Œæ˜“äºå­¦ä¹ å’Œä½¿ç”¨ï¼ŒåŒæ—¶æ”¯æŒ OpenCypherã€‚</li>
<li>ä¸°å¯Œç”Ÿæ€ï¼šNebulaGraph çš„ç”Ÿæ€ç³»ç»Ÿæ­£åœ¨ä¸æ–­å£®å¤§ï¼Œç›®å‰å·²ç»æœ‰äº†å¤šä¸ªå®¢æˆ·ç«¯ï¼ŒåŒ…æ‹¬ Javaã€Pythonã€Goã€C++ã€JavaScriptã€Sparkã€Flink ç­‰ï¼ŒåŒæ—¶ä¹Ÿæœ‰äº†å¤šä¸ªå¯è§†åŒ–å·¥å…·ï¼ŒåŒ…æ‹¬ NebulaGraph Studioã€Nebula Dashboardã€Nebula Explorer ç­‰ã€‚</li>
</ul>
<h2 id="æœ¬æ–‡è®¨è®ºçš„é—®é¢˜" class="headerLink">
    <a href="#%e6%9c%ac%e6%96%87%e8%ae%a8%e8%ae%ba%e7%9a%84%e9%97%ae%e9%a2%98" class="header-mark"></a>3 æœ¬æ–‡è®¨è®ºçš„é—®é¢˜</h2><p>æœ¬æ–‡ç»™å‡ºäº†åŸºäº NebulaGraph é›†ç¾¤åº”ç”¨ä¸­æ¶‰åŠåˆ° API ç½‘å…³çš„å‡ ä¸ªåœºæ™¯ã€‚</p>
<ul>
<li>æŸ¥è¯¢æ¥å£çš„è´Ÿè½½å‡è¡¡</li>
<li>åº•å±‚å­˜å‚¨æ¥å£çš„æš´éœ²</li>
<li>ä¼ è¾“å±‚çš„åŠ å¯†</li>
</ul>
<h3 id="æŸ¥è¯¢æ¥å£è´Ÿè½½å‡è¡¡" class="headerLink">
    <a href="#%e6%9f%a5%e8%af%a2%e6%8e%a5%e5%8f%a3%e8%b4%9f%e8%bd%bd%e5%9d%87%e8%a1%a1" class="header-mark"></a>3.1 æŸ¥è¯¢æ¥å£è´Ÿè½½å‡è¡¡</h3><p>é¦–å…ˆæ˜¯å›¾æ•°æ®åº“æŸ¥è¯¢æ¥å£ï¼ˆGraphDï¼‰çš„è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨çš„é—®é¢˜ã€‚</p>
<p>NebulaGraph å†…æ ¸ç”±ä¸‰ç§æœåŠ¡ç»„æˆï¼šGraphDã€MetaD å’Œ StorageDï¼š</p>
<p><figure><a class="lightgallery" href="https://docs-cdn.nebula-graph.com.cn/figures/nebula-graph-architecture_3.png" title="https://docs-cdn.nebula-graph.com.cn/figures/nebula-graph-architecture_3.png" data-thumbnail="https://docs-cdn.nebula-graph.com.cn/figures/nebula-graph-architecture_3.png">
        <img
            
            loading="lazy"
            src="https://docs-cdn.nebula-graph.com.cn/figures/nebula-graph-architecture_3.png"
            srcset="https://docs-cdn.nebula-graph.com.cn/figures/nebula-graph-architecture_3.png, https://docs-cdn.nebula-graph.com.cn/figures/nebula-graph-architecture_3.png 1.5x, https://docs-cdn.nebula-graph.com.cn/figures/nebula-graph-architecture_3.png 2x"
            sizes="auto"
            alt="https://docs-cdn.nebula-graph.com.cn/figures/nebula-graph-architecture_3.png">
    </a></figure></p>
<p>æ‰€ä»¥ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œé›†ç¾¤åªä¼šæš´éœ² GraphD çš„æ¥å£ï¼Œæä¾›ç»™å®¢æˆ·ç«¯è¿æ¥ï¼Œæ‰§è¡Œ nGQL çš„æŸ¥è¯¢ã€‚</p>
<p>è¿™å…¶ä¸­ï¼ŒGraphD æ˜¯æ— çŠ¶æ€çš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨å¤šä¸ª GraphD ä¹‹é—´åšè´Ÿè½½å‡è¡¡ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•ï¼šåŸºäºå®¢æˆ·ç«¯çš„ï¼ˆClient-Side LBï¼‰ï¼Œä¸åŸºäºä»£ç†çš„ã€‚</p>
<h4 id="å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡" class="headerLink">
    <a href="#%e5%ae%a2%e6%88%b7%e7%ab%af%e7%9a%84%e8%b4%9f%e8%bd%bd%e5%9d%87%e8%a1%a1" class="header-mark"></a>3.1.1 å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡</h4><p>å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨ç¨‹åºä¸­ï¼Œå®ç°è´Ÿè½½å‡è¡¡çš„é€»è¾‘ï¼ŒNebulaGraph çš„å„ä¸ªè¯­è¨€çš„å®¢æˆ·ç«¯é‡Œè¾¹å·²ç»å†…ç½®äº†ç®€å•çš„è½®è¯¢ï¼ˆRound-Robinï¼‰è´Ÿè½½å‡è¡¡ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å®¢æˆ·ç«¯é…ç½®å¤šä¸ª GraphD çš„åœ°å€å°±å¯ä»¥äº†ï¼š</p>
<p>æ¯”å¦‚æˆ‘ä»¬åœ¨åˆ›å»ºè¿æ¥æ± çš„æ—¶å€™ï¼ŒæŒ‡å®šäº†ä¸¤ä¸ªä¸åŒçš„ GraphD çš„åœ°å€ï¼ˆå¯¹åº”ä¸åŒè¿›ç¨‹å®ä¾‹ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula3.gclient.net</span> <span class="kn">import</span> <span class="n">ConnectionPool</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula3.Config</span> <span class="kn">import</span> <span class="n">Config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">config</span><span class="o">.</span><span class="n">max_connection_pool_size</span> <span class="o">=</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">ConnectionPool</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">connection_pool</span><span class="o">.</span><span class="n">init</span><span class="p">([(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">49433</span><span class="p">)],</span> <span class="n">config</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬åœ¨å–å¾—è¿æ¥çš„æ—¶å€™ï¼Œå°±ä¼šä»è¿æ¥æ± ä¸­éšæœºå–å¾—ä¸€ä¸ªè¿æ¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">connection0</span> <span class="o">=</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">connection1</span> <span class="o">=</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿™ä¸¤ä¸ªè¿æ¥çš„ GraphD åœ°å€æ˜¯ä¸åŒçš„</span>
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">connection0</span><span class="o">.</span><span class="n">_port</span><span class="p">,</span> <span class="n">connection1</span><span class="o">.</span><span class="n">_port</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="p">(</span><span class="mi">9669</span><span class="p">,</span> <span class="mi">49433</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡çš„é—®é¢˜åœ¨äºå®ƒçš„é…ç½®ã€å®ç°ç»†èŠ‚ä¸åº”ç”¨ä»£ç è€¦åˆåœ¨ä¸€èµ·ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ä¿®æ”¹è´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼Œå°±éœ€è¦ä¿®æ”¹åº”ç”¨ä»£ç ï¼Œè¿™æ ·å°±ä¼šå¢åŠ åº”ç”¨çš„å¤æ‚åº¦ã€‚</p>
<h4 id="ä»£ç†çš„è´Ÿè½½å‡è¡¡" class="headerLink">
    <a href="#%e4%bb%a3%e7%90%86%e7%9a%84%e8%b4%9f%e8%bd%bd%e5%9d%87%e8%a1%a1" class="header-mark"></a>3.1.2 ä»£ç†çš„è´Ÿè½½å‡è¡¡</h4><p>åŸºäºä»£ç†çš„è´Ÿè½½å‡è¡¡ï¼Œå°±æ˜¯åœ¨åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œå¢åŠ ä¸€ä¸ªä»£ç†å±‚ï¼Œæ¥å®ç°è´Ÿè½½å‡è¡¡çš„é€»è¾‘ï¼Œè¿™æ ·åº”ç”¨ç¨‹åºå°±ä¸éœ€è¦å…³å¿ƒè´Ÿè½½å‡è¡¡çš„é—®é¢˜äº†ã€‚åœ¨ k8s é‡Œçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ k8s çš„ Service æ¥å®ç°è¿™ä¸ªä»£ç†å±‚ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªåœ¨ Minikube ä¸­ä¸º NebulaGraph é›†ç¾¤ä¸­ GraphD åˆ›å»ºçš„ Serviceï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF | kubectl create -f -
</span></span></span><span class="line"><span class="cl"><span class="s">apiVersion: v1
</span></span></span><span class="line"><span class="cl"><span class="s">kind: Service
</span></span></span><span class="line"><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="cl"><span class="s">  labels:
</span></span></span><span class="line"><span class="cl"><span class="s">    app.kubernetes.io/cluster: nebula
</span></span></span><span class="line"><span class="cl"><span class="s">    app.kubernetes.io/component: graphd
</span></span></span><span class="line"><span class="cl"><span class="s">    app.kubernetes.io/managed-by: nebula-operator
</span></span></span><span class="line"><span class="cl"><span class="s">    app.kubernetes.io/name: nebula-graph
</span></span></span><span class="line"><span class="cl"><span class="s">  name: nebula-graphd-svc-nodeport
</span></span></span><span class="line"><span class="cl"><span class="s">  namespace: default
</span></span></span><span class="line"><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="cl"><span class="s">  externalTrafficPolicy: Local
</span></span></span><span class="line"><span class="cl"><span class="s">  ports:
</span></span></span><span class="line"><span class="cl"><span class="s">  - name: thrift
</span></span></span><span class="line"><span class="cl"><span class="s">    port: 9669
</span></span></span><span class="line"><span class="cl"><span class="s">    protocol: TCP
</span></span></span><span class="line"><span class="cl"><span class="s">    targetPort: 9669
</span></span></span><span class="line"><span class="cl"><span class="s">    nodePort: 30000
</span></span></span><span class="line"><span class="cl"><span class="s">  - name: http
</span></span></span><span class="line"><span class="cl"><span class="s">    port: 19669
</span></span></span><span class="line"><span class="cl"><span class="s">    protocol: TCP
</span></span></span><span class="line"><span class="cl"><span class="s">    targetPort: 19669
</span></span></span><span class="line"><span class="cl"><span class="s">    nodePort: 30001
</span></span></span><span class="line"><span class="cl"><span class="s">  selector:
</span></span></span><span class="line"><span class="cl"><span class="s">    app.kubernetes.io/cluster: nebula
</span></span></span><span class="line"><span class="cl"><span class="s">    app.kubernetes.io/component: graphd
</span></span></span><span class="line"><span class="cl"><span class="s">    app.kubernetes.io/managed-by: nebula-operator
</span></span></span><span class="line"><span class="cl"><span class="s">    app.kubernetes.io/name: nebula-graph
</span></span></span><span class="line"><span class="cl"><span class="s">  type: NodePort
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ›å»ºäº†å®ƒä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å®ƒæš´éœ²çš„å•ç‹¬ç«¯å£æ¥è®¿é—® NebulaGraph é›†ç¾¤ä¸­çš„ GraphD äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">connection_pool</span> <span class="o">=</span> <span class="n">ConnectionPool</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="p">:</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">init</span><span class="p">([(</span><span class="s1">&#39;192.168.49.2&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">)],</span> <span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">connection0</span> <span class="o">=</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">connection1</span> <span class="o">=</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">connection0</span><span class="o">.</span><span class="n">_ip</span><span class="p">,</span> <span class="n">connection1</span><span class="o">.</span><span class="n">_ip</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;192.168.49.2&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.49.2&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿æ¥å±‚é¢ä¸Šæ¥çœ‹ï¼Œå®¢æˆ·ç«¯åªçŸ¥é“ä»£ç†çš„åœ°å€ï¼Œè€Œä¸çŸ¥é“ NebulaGraph é›†ç¾¤ä¸­çš„ GraphD çš„åœ°å€ï¼Œè¿™æ ·å°±å®ç°äº†å®¢æˆ·ç«¯ä¸ NebulaGraph é›†ç¾¤ä¸­çš„ GraphD çš„è§£è€¦ã€‚</p>
<p>ç„¶è€Œï¼Œå½“æˆ‘ä»¬åœ¨ connection ä¹‹ä¸Šåˆ›å»º session çš„æ—¶å€™ï¼Œå°±èƒ½çœ‹åˆ°å®é™…ä¸Šå®¢æˆ·ç«¯çš„ä¸åŒè¯·æ±‚æ˜¯è½åœ¨äº†ä¸åŒçš„ GraphD ä¸Šçš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">session</span> <span class="o">=</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;nebula&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">session</span><span class="o">.</span><span class="n">_session_id</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="mi">1668670607568178</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">session1</span> <span class="o">=</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;nebula&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">session1</span><span class="o">.</span><span class="n">_session_id</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="mi">1668670625563307</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¾—åˆ°æ¯ä¸€ä¸ª session çš„ ID</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;SHOW SESSIONS&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å®ƒä»¬åˆ†åˆ«å¯¹åº”äº†ä¸¤ä¸ªä¸åŒçš„ graphd å®ä¾‹</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">ResultSet</span><span class="p">(</span><span class="n">keys</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;SessionId&#39;</span><span class="p">,</span> <span class="s1">&#39;UserName&#39;</span><span class="p">,</span> <span class="s1">&#39;SpaceName&#39;</span><span class="p">,</span> <span class="s1">&#39;CreateTime&#39;</span><span class="p">,</span> <span class="s1">&#39;UpdateTime&#39;</span><span class="p">,</span> <span class="s1">&#39;GraphAddr&#39;</span><span class="p">,</span> <span class="s1">&#39;Timezone&#39;</span><span class="p">,</span> <span class="s1">&#39;ClientIp&#39;</span><span class="p">],</span> <span class="n">values</span><span class="p">:</span> <span class="p">[</span><span class="mi">1668670607568178</span><span class="p">,</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="n">utc</span> <span class="n">datetime</span><span class="p">:</span> <span class="mi">2022</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">17</span><span class="n">T07</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mf">47.568178</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">utc</span> <span class="n">datetime</span><span class="p">:</span> <span class="mi">2022</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">17</span><span class="n">T07</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mf">47.575303</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&#34;nebula-graphd-0.nebula-graphd-svc.default.svc.cluster.local:9669&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&#34;172.17.0.1&#34;</span><span class="p">],[</span><span class="mi">1668670625563307</span><span class="p">,</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="n">utc</span> <span class="n">datetime</span><span class="p">:</span> <span class="mi">2022</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">17</span><span class="n">T07</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mf">05.563307</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">utc</span> <span class="n">datetime</span><span class="p">:</span> <span class="mi">2022</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">17</span><span class="n">T07</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mf">03.638910</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&#34;nebula-graphd-1.nebula-graphd-svc.default.svc.cluster.local:9669&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&#34;172.17.0.1&#34;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åº•å±‚å­˜å‚¨æ¥å£çš„æš´éœ²" class="headerLink">
    <a href="#%e5%ba%95%e5%b1%82%e5%ad%98%e5%82%a8%e6%8e%a5%e5%8f%a3%e7%9a%84%e6%9a%b4%e9%9c%b2" class="header-mark"></a>3.2 åº•å±‚å­˜å‚¨æ¥å£çš„æš´éœ²</h3><p>åœ¨ NebulaGraph ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ StorageClient æ¥è®¿é—®åº•å±‚çš„å­˜å‚¨æ¥å£ï¼Œè¿™ä¸ªæ¥å£å¯ä»¥ç”¨æ¥åšä¸€äº›åˆ†æå‹ã€æ•°æ®å…¨æ‰«æè®¡ç®—çš„å·¥ä½œã€‚</p>
<p>ç„¶è€Œå­˜å‚¨å±‚çš„åˆ†å¸ƒå¼æœåŠ¡å®ä¾‹ä¸åƒ GraphD é‚£æ ·ï¼Œå®ƒä»¬æ˜¯æœ‰çŠ¶æ€çš„ï¼Œè¿™å…¶å®ä¸ K8s æˆ–è€… Docker Compose çš„éƒ¨ç½²æ¨¡å‹æ˜¯ç›¸è¿èƒŒçš„ï¼Œå¦‚æœè®¿é—®çš„åº”ç”¨ StorageD å®¢æˆ·ç«¯åœ¨é›†ç¾¤å¤–éƒ¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ NebulaGraph é›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªå­˜å‚¨å®ä¾‹ä¸Šéƒ½éƒ¨ç½²ä¸€ä¸ªä»£ç†ï¼ˆServiceï¼‰ï¼Œè¿™éå¸¸ä¸æ–¹ä¾¿ï¼Œæœ‰æ—¶å€™è¿˜æ˜¯ä¸€ç§æµªè´¹ã€‚</p>
<p>æ­¤å¤–ï¼Œç”±äº NebulaGraph å†…éƒ¨æœåŠ¡å‘ç°æœºåˆ¶å’Œ StorageD å®¢æˆ·ç«¯çš„å®ç°æœºåˆ¶å†³å®šï¼Œæ¯ä¸€ä¸ª storaged æœåŠ¡å®ä½“éƒ½æ˜¯ç”±å…¶å†…éƒ¨çš„ <code>host:port</code> å”¯ä¸€ç¡®å®šå’Œå¯»å€çš„ï¼Œè¿™ç»™æˆ‘ä»¬ä¸­é—´çš„ä»£ç†å·¥ä½œä¹Ÿå¸¦æ¥äº†ä¸€äº›éº»çƒ¦ã€‚</p>
<p>æ€»ç»“æ¥çœ‹ï¼Œæˆ‘ä»¬çš„éœ€æ±‚æ˜¯ï¼š</p>
<ul>
<li>èƒ½å¤Ÿä»é›†ç¾¤å¤–éƒ¨è®¿é—® NebulaGraph çš„å­˜å‚¨å±‚æ¯ä¸€ä¸ªå®ä¾‹</li>
<li>æ¯ä¸€ä¸ªå®ä¾‹çš„è®¿é—®åœ°å€ï¼ˆhost:portï¼‰å’Œå†…éƒ¨çš„åœ°å€æ˜¯å®Œå…¨ä¸€è‡´çš„</li>
</ul>
<p>ä¸ºäº†å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œæˆ‘ä¹‹å‰çš„åšæ³•æ˜¯ä¸ºæ¯ä¸€ä¸ªå®ä¾‹å•ç‹¬éƒ¨ç½²ä¸€ä¸ª GraphD ä»£ç†ï¼ˆæ¶ˆè€—ä¸€ä¸ªåœ°å€ï¼Œä¿è¯ç«¯å£ä¸å˜ï¼‰ï¼Œå†åœ¨å¤–éƒ¨æ‰‹åŠ¨æ­ä¸€ä¸ª nginx ä½œä¸ºä»£ç†ï¼Œé…åˆ DNS æŠŠå†…éƒ¨çš„åœ°å€è§£æ nginx ä¸Šï¼Œç„¶åé€šè¿‡åŸŸåæ‰¾åˆ°ä¸Šæ¸¸ï¼ˆæ¯ä¸€ä¸ªå•ç‹¬çš„ GraphD ä»£ç†ï¼‰ã€‚</p>
<blockquote>
<p>æ³¨ï¼šæˆ‘åœ¨è¿™ä¸¤ä¸ª gist é‡Œç»™å‡ºäº†è¿™ä¸ªæ–¹æ³•çš„å®éªŒæ­¥éª¤ï¼š</p>
<ul>
<li><a href="https://gist.github.com/wey-gu/950e4f4c673badae375e59007d80d372" target="_blank" rel="noopener noreferrer">https://gist.github.com/wey-gu/950e4f4c673badae375e59007d80d372</a></li>
<li><a href="https://gist.github.com/wey-gu/699b9a2ef5dff5f0fb5f288d692ddfd5" target="_blank" rel="noopener noreferrer">https://gist.github.com/wey-gu/699b9a2ef5dff5f0fb5f288d692ddfd5</a></li>
</ul>
</blockquote>
<p>æœ€è¿‘ï¼Œæˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªç›¸å¯¹ä¼˜é›…çš„å¯ç»´æŠ¤çš„æ–¹å¼ï¼š</p>
<ul>
<li>åœ¨ NebulaGraph é›†ç¾¤åŒä¸€ä¸ªå‘½åç©ºé—´ä¸‹å¼•å…¥ä¸€ä¸ª APISIX ç½‘å…³</li>
<li>åˆ©ç”¨ APISIX ä¸­çš„ nginx TCP ä»£ç†çš„å°è£…ï¼š<a href="https://apisix.apache.org/docs/apisix/stream-proxy/" target="_blank" rel="noopener noreferrer">stream-proxy</a>æ¥æš´éœ² storeaged çš„æ¥å£</li>
<li>ä¸ºäº†æœ€ç»ˆåªåˆ©ç”¨ä¸€ä¸ªé›†ç¾¤çš„å‡ºå£ï¼ˆServiceï¼Œæˆ‘ä»¬åˆ©ç”¨å…¶æ”¯æŒçš„ TLSv1.3 ä¸­çš„ extend host name å­—æ®µï¼šSNI æ¥è·¯ç”±ä¸Šæ¸¸ï¼‰ï¼Œåšåˆ°ç”¨ä¸åŒåŸŸåçš„ TCP over TLS æŒ‡å‘åç«¯çš„ä¸åŒ storaged</li>
<li>æœ€ç»ˆï¼Œåªéœ€è¦ Storage å®¢æˆ·ç«¯èƒ½æ”¯æŒ TLSv1.3ï¼ˆå‘é€ SNIï¼‰ï¼Œå¹¶ä¸”èƒ½è§£ææ‰€æœ‰ StorageD çš„åœ°å€åˆ° APISIX çš„ Service ä¸Šå³å¯</li>
</ul>
<p>ç¤ºä¾‹å›¾ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">           â”‚  K8s Cluster                                                                       â”‚
</span></span><span class="line"><span class="cl">           â”‚                                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ NebulaGraph Cluster      â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚  APISIX API-GATEWAY                â”‚      â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚      â”‚       â”‚ Storaged-0   â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚ â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚ â”‚    â”‚       â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”‚ stream-proxy               â”‚   â”‚ â”‚    â”‚                          â”‚  â”‚
</span></span><span class="line"><span class="cl">  â”Œâ”€â”€â”€â”€â”€â”  â”‚ .â”€â”€â”€â”€â”€.  â”‚   â”‚                â”Œâ”€â”€â”€â”€â”      â”‚   â”‚ â”‚    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
</span></span><span class="line"><span class="cl">  â”‚     â”‚  â”‚â•±       â•² â”‚   â”‚  - addr: 9559  â”‚    â”‚â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”˜    â”‚       â”‚ Storaged-1   â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">â”â”â”« DNS â”£â”â”( Service )â•‹â”â”â”â•‹â–¶   tls: true   â”‚    â”‚      â”‚   â”‚ â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">  â”‚     â”‚  â”‚`.     ,&#39; â”‚   â”‚                â”‚    â”‚â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”˜    â”‚       â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">  â””â”€â”€â”€â”€â”€â”˜  â”‚  `â”€â”€â”€&#39;   â”‚   â”‚                â”‚    â”‚      â”‚   â”‚      â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”‚                â”‚SNI â”‚      â”‚   â”‚      â”‚                          â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”‚                â”‚    â”‚â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”‚                â”‚    â”‚      â”‚   â”‚ â”‚    â”‚       â”‚ Storaged-2   â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”‚                â”‚    â”‚      â”‚   â”‚ â””â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”‚                â”‚    â”‚â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”    â”‚       â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”‚                â””â”€â”€â”€â”€â”˜      â”‚   â”‚ â”‚    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚    â”‚                          â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚ â”‚    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚ â”‚    â”‚       â”‚ Storaged-3   â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚ â””â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚      â”‚       â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚      â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
</span></span><span class="line"><span class="cl">           â”‚                                                                                    â”‚
</span></span><span class="line"><span class="cl">           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li>åœ¨ APISIX ä¸­æ¯”è¾ƒä¼˜é›…åœ°ç»´æŠ¤ä»£ç†çš„é…ç½®ï¼Œå¹¶ä¸”å¯ä»¥ç”¨åˆ° APISIX è¿™äº›ç°ä»£åŒ–çš„æµé‡ç®¡ç†èƒ½åŠ›</li>
<li>ä¸éœ€è¦ä¸ºæ¯ä¸€ä¸ª StorageD å•ç‹¬åˆ›å»º Serviceï¼Œåªéœ€è¦ä¸€ä¸ª Serviceï¼Œå‡ºé›†ç¾¤åœ°å€ å°±å¯ä»¥äº†</li>
<li>ä¸ºæµé‡å¢åŠ äº† TLSv1.3 çš„åŠ å¯†ï¼Œæé«˜äº†å®‰å…¨æ€§åŒæ—¶æ²¡æœ‰ç»™ NebulaGraph é›†ç¾¤å†…éƒ¨çš„å—åŒ—æµé‡å¸¦æ¥çš„æ€§èƒ½æŸè€—</li>
</ul>
<p>åœ¨æœ¬æ–‡çš„ç»“å°¾ï¼Œæˆ‘ä¼šç»™å‡ºä¸€ä¸ªå®æ“çš„å®éªŒè¿‡ç¨‹ï¼Œè¿™é‡ŒåŒ…å«äº†æœ¬æ–‡æåˆ°çš„æ‰€æœ‰è¦ç‚¹å’Œç»†èŠ‚ã€‚</p>
<h3 id="ä¼ è¾“å±‚çš„åŠ å¯†" class="headerLink">
    <a href="#%e4%bc%a0%e8%be%93%e5%b1%82%e7%9a%84%e5%8a%a0%e5%af%86" class="header-mark"></a>3.3 ä¼ è¾“å±‚çš„åŠ å¯†</h3><p>æˆ‘ä»¬åœ¨å‰ä¸€ä¸ªé—®é¢˜ä¸­æåŠåˆ°äº†ï¼Œåœ¨ APISIX ç½‘å…³ä¸­ terminate TLSv1.3 çš„è¿æ¥ï¼Œå€ŸåŠ© SNI ä¿¡æ¯è·¯ç”± StorageD çš„æ–¹æ³•ï¼Œå…¶å®ï¼Œå•ç‹¬å°† GraphD æ¥å£çš„ TLS äº¤ç»™ç½‘å…³æ¥åšï¼Œå¥½å¤„ä¹Ÿæ˜¯éå¸¸æ˜æ˜¾çš„ï¼š</p>
<ul>
<li>è¯ä¹¦ç®¡ç†åœ¨ç»Ÿä¸€çš„ç½‘å…³æ§åˆ¶é¢åšï¼Œæ›´åŠ æ–¹ä¾¿</li>
<li>è¯ä¹¦è¿ç»´æ—  NebulaGraph é›†ç¾¤é…ç½®ä¾µå…¥ï¼ˆNebulaGraph åŸç”Ÿæ”¯æŒ TLS åŠ å¯†ï¼Œä½†æ˜¯åŠ å¯†ä¹‹åå¸¦æ¥äº†é›†ç¾¤å†…éƒ¨é€šä¿¡çš„å¼€é”€ï¼Œè€Œä¸”é…ç½®å’Œé›†ç¾¤å…¶ä»–å±‚é¢é…ç½®åœ¨ä¸€èµ·ï¼Œè¯ä¹¦æ›´æ–°æ¶‰åŠè¿›ç¨‹é‡å¯ï¼Œä¸å¤Ÿçµæ´»ï¼‰</li>
</ul>
<p>å…·ä½“çš„æ–¹æ³•åœ¨åè¾¹å®æ“ä¸­ä¹Ÿæ˜¯æœ‰ä½“ç°çš„ã€‚</p>
<h2 id="å®æ“åˆ©ç”¨-apisix-çš„-stream-proxy-æš´éœ²-storaged-çš„æ¥å£" class="headerLink">
    <a href="#%e5%ae%9e%e6%93%8d%e5%88%a9%e7%94%a8-apisix-%e7%9a%84-stream-proxy-%e6%9a%b4%e9%9c%b2-storaged-%e7%9a%84%e6%8e%a5%e5%8f%a3" class="header-mark"></a>4 å®æ“ï¼šåˆ©ç”¨ APISIX çš„ stream-proxy æš´éœ² StorageD çš„æ¥å£</h2><h3 id="å®éªŒç¯å¢ƒminikube" class="headerLink">
    <a href="#%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83minikube" class="header-mark"></a>4.1 å®éªŒç¯å¢ƒï¼šminikube</h3><p>æˆ‘ä»¬å°±åœ¨æœ¬åœ°çš„ minikube ä¸Šåšè¿™ä¸ªå®éªŒå§ï¼Œé¦–å…ˆå¯åŠ¨ä¸€ä¸ª minikubeï¼Œå› ä¸º APISIX å†…éƒ¨çš„ etcd éœ€è¦ç”¨åˆ° storageclassï¼Œæˆ‘ä»¬å¸¦ä¸Š ç©·äººç‰ˆçš„ storageclass æ’ä»¶ï¼ŒåŒæ—¶ï¼Œä¸ºäº†åœ¨ k8s å¤–éƒ¨è®¿é—® storaged çš„æ—¶å€™ç”¨å’Œå†…éƒ¨ç›¸åŒçš„åŸŸåå’Œç«¯å£ï¼Œæˆ‘ä»¬æŠŠ node-port å…è®¸çš„ç«¯å£æ‰©å……åˆ°å°äº 9779 çš„èŒƒå›´ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">minikube start <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --addons<span class="o">=</span><span class="s2">&#34;default-storageclass&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --extra-config<span class="o">=</span>apiserver.service-node-port-range<span class="o">=</span>1-65535
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®éªŒç¯å¢ƒnebulagraph-on-k8s" class="headerLink">
    <a href="#%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83nebulagraph-on-k8s" class="header-mark"></a>4.2 å®éªŒç¯å¢ƒï¼šNebulaGraph on K8s</h3><p>è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ Nebula Operator æ¥éƒ¨ç½² NebulaGraph é›†ç¾¤ï¼Œå…·ä½“çš„éƒ¨ç½²æ–¹æ³•å¯ä»¥å‚è€ƒ <a href="https://docs.nebula-graph.com.cn/3.3.0/nebula-operator/1.introduction-to-nebula-operator/" target="_blank" rel="noopener noreferrer">Nebula Operator æ–‡æ¡£</a>ã€‚</p>
<p>å’±ä»¬åšå®éªŒï¼Œå°±å·ä¸ªæ‡’ï¼Œç”¨æˆ‘å†™çš„ <a href="https://github.com/wey-gu/nebula-operator-kind" target="_blank" rel="noopener noreferrer">Nebula-Operator-KinD</a> æ¥ä¸€é”®éƒ¨ç½²ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -sL nebula-kind.siwei.io/install-on-k8s.sh <span class="p">|</span> bash
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®éªŒç¯å¢ƒapisix-on-k8s" class="headerLink">
    <a href="#%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83apisix-on-k8s" class="header-mark"></a>4.3 å®éªŒç¯å¢ƒï¼šAPISIX on k8s</h3><p>é¦–å…ˆæ˜¯å®‰è£…ï¼Œåœ¨ Helm å‚æ•°ä¸­æŒ‡å®šæ‰“å¼€ stream-proxy çš„å¼€å…³ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">helm repo add apisix https://charts.apiseven.com
</span></span><span class="line"><span class="cl">helm repo add bitnami https://charts.bitnami.com/bitnami
</span></span><span class="line"><span class="cl">helm repo update
</span></span><span class="line"><span class="cl">helm install apisix apisix/apisix <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set gateway.type<span class="o">=</span>NodePort <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set gateway.stream.enabled<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set ingress-controller.enabled<span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># dashboard ä¹Ÿè£…ä¸Šï¼Œæ–¹ä¾¿æˆ‘ä»¬ç»•è¿‡ admin API call åšä¸€äº›æ–¹ä¾¿çš„æ“ä½œã€‚</span>
</span></span><span class="line"><span class="cl">helm install apisix-dashboard apisix/apisix-dashboard
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œå› ä¸ºæˆªæ­¢åˆ°ç°åœ¨ï¼ŒAPISIX çš„ Helm Chart ä¹‹ä¸­å¹¶æ²¡æœ‰æä¾› stream-proxy TCP çš„ç›‘å¬ç«¯å£çš„ TLS æ”¯æŒçš„é…ç½®æ ¼å¼ï¼Œè§ <a href="https://github.com/apache/apisix-helm-chart/issues/348" target="_blank" rel="noopener noreferrer">https://github.com/apache/apisix-helm-chart/issues/348</a> ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ›´æ”¹ APISIX çš„ configmapï¼ŒæŠŠ stream-proxy çš„ TLS é…ç½®åŠ ä¸Šï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl edit ConfigMap apisix
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ç¼–è¾‘æŠŠ <code>stream_proxy.tcp</code> æ”¹å†™æˆè¿™æ ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">     </span><span class="nt">stream_proxy</span><span class="p">:</span><span class="w">                 </span><span class="c"># TCP/UDP proxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">only</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">tcp</span><span class="p">:</span><span class="w">                        </span><span class="c"># TCP proxy port list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span>- <span class="nt">addr</span><span class="p">:</span><span class="w"> </span><span class="m">9779</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">tls</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span>- <span class="nt">addr</span><span class="p">:</span><span class="w"> </span><span class="m">9559</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">tls</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦é‡å»º APISIX Podï¼Œå› ä¸º APISIX çš„ stream-proxy çš„ TLS é…ç½®æ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™åŠ è½½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é‡å»º APISIX Podï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl delete <span class="k">$(</span>kubectl get po -l <span class="s2">&#34;app.kubernetes.io/name=apisix&#34;</span> -o name<span class="k">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¼€å§‹å®éªŒ" class="headerLink">
    <a href="#%e5%bc%80%e5%a7%8b%e5%ae%9e%e9%aa%8c" class="header-mark"></a>4.4 å¼€å§‹å®éªŒ</h3><p>æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªå®éªŒçš„ç›®æ ‡ï¼Œå°±æ˜¯æŠŠ NebulaGraph çš„ StorageD çš„æ¥å£æš´éœ²å‡ºæ¥ï¼Œè®©å¤–éƒ¨çš„å®¢æˆ·ç«¯å¯ä»¥è®¿é—®åˆ°ï¼Œè€Œæš´éœ²çš„æ–¹å¼å¦‚å›¾ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">           â”‚  K8s Cluster                                                                       â”‚
</span></span><span class="line"><span class="cl">           â”‚                                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ NebulaGraph Cluster      â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚  APISIX API-GATEWAY                â”‚      â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚      â”‚       â”‚ Storaged-0   â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚ â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚ â”‚    â”‚       â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”‚ stream-proxy               â”‚   â”‚ â”‚    â”‚                          â”‚  â”‚
</span></span><span class="line"><span class="cl">  â”Œâ”€â”€â”€â”€â”€â”  â”‚ .â”€â”€â”€â”€â”€.  â”‚   â”‚                â”Œâ”€â”€â”€â”€â”      â”‚   â”‚ â”‚    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
</span></span><span class="line"><span class="cl">  â”‚     â”‚  â”‚â•±       â•² â”‚   â”‚  - addr: 9559  â”‚    â”‚â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”˜    â”‚       â”‚ Storaged-1   â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">â”â”â”« DNS â”£â”â”( Service )â•‹â”â”â”â•‹â–¶   tls: true   â”‚    â”‚      â”‚   â”‚ â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">  â”‚     â”‚  â”‚`.     ,&#39; â”‚   â”‚                â”‚    â”‚â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”˜    â”‚       â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">  â””â”€â”€â”€â”€â”€â”˜  â”‚  `â”€â”€â”€&#39;   â”‚   â”‚                â”‚    â”‚      â”‚   â”‚      â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”‚                â”‚SNI â”‚      â”‚   â”‚      â”‚                          â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”‚                â”‚    â”‚â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”‚                â”‚    â”‚      â”‚   â”‚ â”‚    â”‚       â”‚ Storaged-2   â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”‚                â”‚    â”‚      â”‚   â”‚ â””â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”‚                â”‚    â”‚â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”    â”‚       â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â”‚                â””â”€â”€â”€â”€â”˜      â”‚   â”‚ â”‚    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚    â”‚                          â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚ â”‚    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚ â”‚    â”‚       â”‚ Storaged-3   â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚ â””â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚      â”‚       â”‚              â”‚   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â”‚                                    â”‚      â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
</span></span><span class="line"><span class="cl">           â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
</span></span><span class="line"><span class="cl">           â”‚                                                                                    â”‚
</span></span><span class="line"><span class="cl">           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å·²ç»æœ‰äº†æ‰€æœ‰çš„æ¡†æ¶ï¼Œæˆ‘ä»¬è¦å¾€é‡Œå¡«ç®­å¤´å’Œåœ†åœˆäº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get po
</span></span><span class="line"><span class="cl">NAME                                         READY   STATUS     RESTARTS      AGE
</span></span><span class="line"><span class="cl">apisix-6d89854bc5-5m788                      1/1     Running    <span class="m">1</span> <span class="o">(</span>31h ago<span class="o">)</span>   2d4h
</span></span><span class="line"><span class="cl">apisix-dashboard-b544bd766-nh79j             1/1     Running    <span class="m">8</span> <span class="o">(</span>31h ago<span class="o">)</span>   2d10h
</span></span><span class="line"><span class="cl">apisix-etcd-0                                1/1     Running    <span class="m">2</span> <span class="o">(</span>31h ago<span class="o">)</span>   2d10h
</span></span><span class="line"><span class="cl">apisix-etcd-1                                1/1     Running    <span class="m">2</span> <span class="o">(</span>31h ago<span class="o">)</span>   2d10h
</span></span><span class="line"><span class="cl">apisix-etcd-2                                1/1     Running    <span class="m">2</span> <span class="o">(</span>31h ago<span class="o">)</span>   2d10h
</span></span><span class="line"><span class="cl">nebula-graphd-0                              1/1     Running    <span class="m">2</span> <span class="o">(</span>31h ago<span class="o">)</span>   3d4h
</span></span><span class="line"><span class="cl">nebula-metad-0                               1/1     Running    <span class="m">2</span> <span class="o">(</span>31h ago<span class="o">)</span>   3d4h
</span></span><span class="line"><span class="cl">nebula-storaged-0                            1/1     Running    <span class="m">2</span> <span class="o">(</span>31h ago<span class="o">)</span>   3d4h
</span></span><span class="line"><span class="cl">nebula-storaged-1                            1/1     Running    <span class="m">2</span> <span class="o">(</span>31h ago<span class="o">)</span>   3d4h
</span></span><span class="line"><span class="cl">nebula-storaged-2                            1/1     Running    <span class="m">2</span> <span class="o">(</span>31h ago<span class="o">)</span>   3d4h
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="é…ç½®-apisix-çš„-stream-proxy" class="headerLink">
    <a href="#%e9%85%8d%e7%bd%ae-apisix-%e7%9a%84-stream-proxy" class="header-mark"></a>4.4.1 é…ç½® APISIX çš„ stream-proxy</h4><p>å‚è€ƒ APISIX æ–‡æ¡£ï¼šhttps://apisix.apache.org/docs/apisix/stream-proxy/#accept-tls-over-tcp-connection</p>
<p>æˆ‘ä»¬ç”¨ APISIX çš„ API æ¥é…ç½® stream-proxyï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">apisix_api_key</span><span class="o">=</span><span class="s2">&#34;edd1c9f034335f136f87ad84b625c8f1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">apisix_pod</span><span class="o">=</span><span class="k">$(</span>kubectl get po -l <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="s2">&#34;app.kubernetes.io/name=apisix&#34;</span> -o name<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl <span class="nb">exec</span> -it <span class="nv">$apisix_pod</span> -- <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    curl http://127.0.0.1:9180/apisix/admin/stream_routes/1 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -H <span class="s2">&#34;X-API-KEY: </span><span class="nv">$apisix_api_key</span><span class="s2">&#34;</span> -X PUT -d <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">&#39;{
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;sni&#34;: &#34;nebula-storaged-0.nebula-storaged-headless.default.svc.cluster.local&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;upstream&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#34;nodes&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="s1">            &#34;172.17.0.13:9779&#34;: 1
</span></span></span><span class="line"><span class="cl"><span class="s1">        },
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#34;type&#34;: &#34;roundrobin&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">    }
</span></span></span><span class="line"><span class="cl"><span class="s1">}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl <span class="nb">exec</span> -it <span class="nv">$apisix_pod</span> -- <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    curl http://127.0.0.1:9180/apisix/admin/stream_routes/2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -H <span class="s2">&#34;X-API-KEY: </span><span class="nv">$apisix_api_key</span><span class="s2">&#34;</span> -X PUT -d <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">&#39;{
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;sni&#34;: &#34;nebula-storaged-1.nebula-storaged-headless.default.svc.cluster.local&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;upstream&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#34;nodes&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="s1">            &#34;172.17.0.18:9779&#34;: 1
</span></span></span><span class="line"><span class="cl"><span class="s1">        },
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#34;type&#34;: &#34;roundrobin&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">    }
</span></span></span><span class="line"><span class="cl"><span class="s1">}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl <span class="nb">exec</span> -it <span class="nv">$apisix_pod</span> -- <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    curl http://127.0.0.1:9180/apisix/admin/stream_routes/3 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -H <span class="s2">&#34;X-API-KEY: </span><span class="nv">$apisix_api_key</span><span class="s2">&#34;</span> -X PUT -d <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">&#39;{
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;sni&#34;: &#34;nebula-storaged-2.nebula-storaged-headless.default.svc.cluster.local&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;upstream&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#34;nodes&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="s1">            &#34;172.17.0.5:9779&#34;: 1
</span></span></span><span class="line"><span class="cl"><span class="s1">        },
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#34;type&#34;: &#34;roundrobin&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">    }
</span></span></span><span class="line"><span class="cl"><span class="s1">}&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨æ„ï¼Œå½“ä¸‹ï¼ŒAPISIX çš„ stream-proxy ä¸Šæ¸¸èŠ‚ç‚¹ä¸æ”¯æŒåŸŸåè§£æï¼Œæ˜¯å—é™äºä¸Šæ¸¸çš„ lua åº“ï¼Œè¯¦è§æˆ‘æŠ¥çš„ issueï¼šhttps://github.com/apache/apisix/issues/8334 ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿™é‡Œåº”è¯¥ç»™å‡ºæ¯ä¸€ä¸ª storaged çš„ SNI ç›¸åŒçš„åœ°å€ä½œä¸º <code>upstream.nodes</code>ï¼Œå¥½åƒï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl <span class="nb">exec</span> -it <span class="nv">$apisix_pod</span> -- <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    curl http://127.0.0.1:9180/apisix/admin/stream_routes/1 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -H <span class="s2">&#34;X-API-KEY: </span><span class="nv">$apisix_api_key</span><span class="s2">&#34;</span> -X PUT -d <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">&#39;{
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;sni&#34;: &#34;nebula-storaged-0.nebula-storaged-headless.default.svc.cluster.local&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;upstream&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#34;nodes&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="s1">            &#34;nebula-storaged-0.nebula-storaged-headless.default.svc.cluster.local&#34;: 1
</span></span></span><span class="line"><span class="cl"><span class="s1">        },
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#34;type&#34;: &#34;roundrobin&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">    }
</span></span></span><span class="line"><span class="cl"><span class="s1">}&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<h4 id="é…ç½®-apisix-ä¸­-storaged-åœ°å€çš„-tls-è¯ä¹¦" class="headerLink">
    <a href="#%e9%85%8d%e7%bd%ae-apisix-%e4%b8%ad-storaged-%e5%9c%b0%e5%9d%80%e7%9a%84-tls-%e8%af%81%e4%b9%a6" class="header-mark"></a>4.4.2 é…ç½® APISIX ä¸­ storaged åœ°å€çš„ TLS è¯ä¹¦</h4><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥äº‘åŸç”Ÿçš„æ–¹å¼å»ç®¡ç†è‡ªç­¾æˆ–è€…å…¬å…±ä¿¡ä»»çš„è¯ä¹¦ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬å°±æ‰‹åŠ¨åˆ©ç”¨ mkcert å·¥å…·æ¥åšè¿™ä»¶äº‹å„¿ã€‚</p>
<p>å®‰è£… mkcert</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># é¦–æ¬¡è¿è¡Œï¼Œéœ€è¦å®‰è£… mkcertï¼Œå¹¶ä¸”ç”Ÿæˆæ ¹è¯ä¹¦</span>
</span></span><span class="line"><span class="cl"><span class="c1"># macOS çš„è¯</span>
</span></span><span class="line"><span class="cl">brew install mkcert
</span></span><span class="line"><span class="cl"><span class="c1"># ubuntu çš„è¯</span>
</span></span><span class="line"><span class="cl">apt-get install wget libnss3-tools
</span></span><span class="line"><span class="cl"><span class="c1"># ç„¶åå†å» https://github.com/FiloSottile/mkcert/releases/ ä¸‹è½½ mkcert</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç­¾å‘è¯ä¹¦ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkcert <span class="s1">&#39;*.nebula-storaged-headless.default.svc.cluster.local&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ©ç”¨ APISIX-dashboard å°†è¯ä¹¦å¯¼å…¥åˆ° APISIX ä¹‹ä¸­</p>
<p>å•ç‹¬å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œè¿è¡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">POD_NAME</span><span class="o">=</span><span class="k">$(</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    kubectl get pods <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -l <span class="s2">&#34;app.kubernetes.io/name=apisix-dashboard,app.kubernetes.io/instance=apisix-dashboard&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&#34;{.items[0].metadata.name}&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONTAINER_PORT</span><span class="o">=</span><span class="k">$(</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    kubectl get pod <span class="nv">$POD_NAME</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&#34;{.spec.containers[0].ports[0].containerPort}&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">kubectl <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    port-forward <span class="nv">$POD_NAME</span> 8080:<span class="nv">$CONTAINER_PORT</span> --address<span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æµè§ˆå™¨è®¿é—® http://10.1.1.168:8080/ssl/list ï¼Œè´¦å·å¯†ç éƒ½æ˜¯ <code>admin</code> ï¼Œç‚¹å‡» <code>Create</code> æŒ‰é’®ï¼Œå°†åˆšåˆšç”Ÿæˆçš„è¯ä¹¦å¯¼å…¥åˆ° APISIX ä¹‹ä¸­ã€‚</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/202471244-7081b37e-1e8f-4298-8887-db2feefe74a2.png" title="https://user-images.githubusercontent.com/1651790/202471244-7081b37e-1e8f-4298-8887-db2feefe74a2.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/202471244-7081b37e-1e8f-4298-8887-db2feefe74a2.png">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/202471244-7081b37e-1e8f-4298-8887-db2feefe74a2.png"
            srcset="https://user-images.githubusercontent.com/1651790/202471244-7081b37e-1e8f-4298-8887-db2feefe74a2.png, https://user-images.githubusercontent.com/1651790/202471244-7081b37e-1e8f-4298-8887-db2feefe74a2.png 1.5x, https://user-images.githubusercontent.com/1651790/202471244-7081b37e-1e8f-4298-8887-db2feefe74a2.png 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/202471244-7081b37e-1e8f-4298-8887-db2feefe74a2.png">
    </a></figure></p>
<h4 id="å¢åŠ -apisix-çš„-nodeport-service" class="headerLink">
    <a href="#%e5%a2%9e%e5%8a%a0-apisix-%e7%9a%84-nodeport-service" class="header-mark"></a>4.4.3 å¢åŠ  APISIX çš„ NodePort Service</h4><p>åˆ›å»ºä¸€ä¸ª NodePort Serviceï¼Œç”¨äºæš´éœ² APISIX çš„ 9779 ç«¯å£ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¤–éƒ¨çš„ IP åœ°å€è®¿é—®åˆ° APISIX äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span class="line"><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="cl"><span class="s">  selector:
</span></span></span><span class="line"><span class="cl"><span class="s">    app.kubernetes.io/instance: apisix
</span></span></span><span class="line"><span class="cl"><span class="s">    app.kubernetes.io/name: apisix
</span></span></span><span class="line"><span class="cl"><span class="s">  ports:
</span></span></span><span class="line"><span class="cl"><span class="s">    - protocol: TCP
</span></span></span><span class="line"><span class="cl"><span class="s">      port: 9779
</span></span></span><span class="line"><span class="cl"><span class="s">      targetPort: 9779
</span></span></span><span class="line"><span class="cl"><span class="s">      name: thrift
</span></span></span><span class="line"><span class="cl"><span class="s">      nodePort: 9779
</span></span></span><span class="line"><span class="cl"><span class="s">  type: NodePort
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºå‰è¾¹ minikube ä¸­æˆ‘ä»¬é…ç½®äº†ç«¯å£çš„èŒƒå›´è¦†ç›–åˆ°äº† 9779ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª NodePort Service çš„ç«¯å£åœ¨å®¿ä¸»æœºä¸Šä¹Ÿå¯ä»¥ä» minikube ip çš„åŒä¸€ä¸ªç«¯å£è®¿é—®åˆ°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ minikube service apisix-svc
</span></span><span class="line"><span class="cl">$ minikube service list
</span></span><span class="line"><span class="cl"><span class="p">|</span>------------------------<span class="p">|</span>---------------------------------<span class="p">|</span>-------------------<span class="p">|</span>---------------------------<span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>       NAMESPACE        <span class="p">|</span>              NAME               <span class="p">|</span>    TARGET PORT    <span class="p">|</span>            URL            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>------------------------<span class="p">|</span>---------------------------------<span class="p">|</span>-------------------<span class="p">|</span>---------------------------<span class="p">|</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"><span class="p">|</span> default                <span class="p">|</span> apisix-svc                      <span class="p">|</span> thrift/9779       <span class="p">|</span> http://192.168.49.2:9779  <span class="p">|</span>&lt;---
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"><span class="p">|</span>------------------------<span class="p">|</span>---------------------------------<span class="p">|</span>-------------------<span class="p">|</span>---------------------------<span class="p">|</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ç„¶ï¼Œminikube å‡è®¾æˆ‘ä»¬çš„æœåŠ¡éƒ½æ˜¯ HTTP çš„ï¼Œç»™å‡ºçš„ URL æ˜¯ HTTP:// çš„ï¼Œä¸ç”¨ç†ä¼šå®ƒï¼Œæˆ‘ä»¬å¿ƒé‡ŒçŸ¥é“å®ƒæ˜¯ TCP over TLS å°±å¥½äº†ã€‚</p>
<h4 id="é…ç½®-k8s-å¤–éƒ¨-dns" class="headerLink">
    <a href="#%e9%85%8d%e7%bd%ae-k8s-%e5%a4%96%e9%83%a8-dns" class="header-mark"></a>4.4.4 é…ç½® K8s å¤–éƒ¨ DNS</h4><p>æˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸ª DNS æœåŠ¡ï¼Œè®©æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>nebula-storaged-0.nebula-storaged-headless.default.svc.cluster.local</code> ç­‰ä¸‰ä¸ªåŸŸåé€šè¿‡ minikube çš„ NodePort Service è®¿é—®åˆ°æˆ‘ä»¬çš„ NebulaGraph çš„ storaged æœåŠ¡ã€‚</p>
<p>è·å¾— minikube çš„ IP åœ°å€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ minikube ip
</span></span><span class="line"><span class="cl">192.168.49.2
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½® <code>/etc/hosts</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">192.168.49.2 nebula-storaged-0.nebula-storaged-headless.default.svc.cluster.local
</span></span><span class="line"><span class="cl">192.168.49.2 nebula-storaged-1.nebula-storaged-headless.default.svc.cluster.local
</span></span><span class="line"><span class="cl">192.168.49.2 nebula-storaged-2.nebula-storaged-headless.default.svc.cluster.local
</span></span><span class="line"><span class="cl">192.168.49.2 nebula-metad-0.nebula-metad-headless.default.svc.cluster.local
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="éªŒè¯-nebulagraph-storage-client-å¯ä»¥ä»æ‰€æœ‰çš„èŠ‚ç‚¹ä¸­è·å–åˆ°æ•°æ®" class="headerLink">
    <a href="#%e9%aa%8c%e8%af%81-nebulagraph-storage-client-%e5%8f%af%e4%bb%a5%e4%bb%8e%e6%89%80%e6%9c%89%e7%9a%84%e8%8a%82%e7%82%b9%e4%b8%ad%e8%8e%b7%e5%8f%96%e5%88%b0%e6%95%b0%e6%8d%ae" class="header-mark"></a>4.4.5 éªŒè¯ NebulaGraph Storage Client å¯ä»¥ä»æ‰€æœ‰çš„èŠ‚ç‚¹ä¸­è·å–åˆ°æ•°æ®</h4><p>è¿™é‡Œï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç”¨åˆ° python çš„å®¢æˆ·ç«¯ã€‚</p>
<p>ç”±äºåœ¨å†™æœ¬æ–‡çš„æ—¶å€™ï¼ŒNebulaGraph Python å®¢æˆ·ç«¯çš„ StorageClient å°šæœªæ”¯æŒ TLSï¼Œå¯¹å®ƒæ”¯æŒçš„ PR åˆšå¥½æ˜¯æˆ‘ä¸ºäº†æœ¬å®éªŒå†™çš„ï¼šhttps://github.com/vesoft-inc/nebula-python/pull/239 ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬è¦ä»æˆ‘çš„ä¸ªäººåˆ†æ”¯å®‰è£…è¿™ä¸ªå®¢æˆ·ç«¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/wey-gu/nebula-python.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> nebula-python
</span></span><span class="line"><span class="cl">python3 -m pip install .
</span></span><span class="line"><span class="cl">python3 -m pip install ipython
</span></span><span class="line"><span class="cl"><span class="c1"># è¿›å…¥ ipython</span>
</span></span><span class="line"><span class="cl">ipython
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬åœ¨ iPython ä¸­äº¤äº’å¼éªŒè¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula3.mclient</span> <span class="kn">import</span> <span class="n">MetaCache</span><span class="p">,</span> <span class="n">HostAddr</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula3.sclient.GraphStorageClient</span> <span class="kn">import</span> <span class="n">GraphStorageClient</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula3.Config</span> <span class="kn">import</span> <span class="n">SSL_config</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">ssl</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">meta_cache</span> <span class="o">=</span> <span class="n">MetaCache</span><span class="p">([(</span><span class="s1">&#39;nebula-metad-0.nebula-metad-headless.default.svc.cluster.local&#39;</span><span class="p">,</span> <span class="mi">9559</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">                       <span class="mi">50000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">storage_addrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">HostAddr</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;nebula-storaged-0.nebula-storaged-headless.default.svc.cluster.local&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">9779</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                 <span class="n">HostAddr</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;nebula-storaged-1.nebula-storaged-headless.default.svc.cluster.local&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">9779</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                 <span class="n">HostAddr</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;nebula-storaged-2.nebula-storaged-headless.default.svc.cluster.local&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">9779</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è‡ªç­¾è¯ä¹¦é…ç½®</span>
</span></span><span class="line"><span class="cl"><span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ssl_config</span> <span class="o">=</span> <span class="n">SSL_config</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ssl_config</span><span class="o">.</span><span class="n">cert_reqs</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_OPTIONAL</span>
</span></span><span class="line"><span class="cl"><span class="n">ssl_config</span><span class="o">.</span><span class="n">cert_reqs</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_OPTIONAL</span>
</span></span><span class="line"><span class="cl"><span class="n">ssl_config</span><span class="o">.</span><span class="n">ca_certs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&#34;~/.local/share/mkcert&#34;</span><span class="p">),</span> <span class="s1">&#39;rootCA.pem&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ssl_config</span><span class="o">.</span><span class="n">keyfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">current_dir</span><span class="p">,</span> <span class="s1">&#39;nebula-storaged-headless.default.svc.cluster.local+1-key.pem&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ssl_config</span><span class="o">.</span><span class="n">certfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">current_dir</span><span class="p">,</span> <span class="s1">&#39;nebula-storaged-headless.default.svc.cluster.local+1.pem&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å®ä¾‹åŒ– StorageClient</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">graph_storage_client</span> <span class="o">=</span> <span class="n">GraphStorageClient</span><span class="p">(</span><span class="n">meta_cache</span><span class="p">,</span> <span class="n">storage_addrs</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">ssl_config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># éªŒè¯å¯ä»¥ä»æ‰€æœ‰çš„èŠ‚ç‚¹ä¸­è·å–åˆ°æ•°æ®</span>
</span></span><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">graph_storage_client</span><span class="o">.</span><span class="n">scan_vertex</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">space_name</span><span class="o">=</span><span class="s1">&#39;basketballplayer&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">tag_name</span><span class="o">=</span><span class="s1">&#39;player&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">resp</span><span class="o">.</span><span class="n">has_next</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">vertex_data</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">vertex_data</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœâœ…ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player112&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Jonathon Simmons&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">29</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player1120&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;æå››&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">30</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player117&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Stephen Curry&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">31</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player119&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Kevin Durant&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">30</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player134&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Blake Griffin&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">30</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player141&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Ray Allen&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">43</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player144&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Shaquille O&#39;Neal&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">47</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player149&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Ben Simmons&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">22</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player100&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Tim Duncan&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player101&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Tony Parker&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">36</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player110&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Cory Joseph&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">27</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player126&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Kyrie Irving&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">26</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player131&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Paul George&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">28</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player133&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Yao Ming&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">38</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player140&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Grant Hill&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">46</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player105&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Danny Green&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">31</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player109&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;Tiago Splitter&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">34</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;player111&#34;</span> <span class="p">:</span><span class="n">player</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&#34;David West&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="mi">38</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ€»ç»“" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93" class="header-mark"></a>5 æ€»ç»“</h2><ul>
<li>NebulaGraph æŸ¥è¯¢æ¥å£çš„è´Ÿè½½å‡è¡¡å¯ä»¥å€ŸåŠ© K8s Serviceæ¥åšï¼›</li>
<li>NebulaGraph åº•å±‚å­˜å‚¨æ¥å£çš„æš´éœ²åœ¨ K8s ä¸­å¯ä»¥åˆ©ç”¨ APISIX Stream Proxy å’Œ SNI æ¥ä¼˜é›…å®ç°ï¼›</li>
<li>åˆ©ç”¨ API ç½‘å…³å¯¹å‡ºå£ä¼ è¾“å±‚çš„åŠ å¯†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œç›¸è¾ƒäºç”¨ NebulaGraph åŸç”Ÿçš„ TLS çš„æ–¹å¼ã€‚</li>
</ul>
<h2 id="ä¸€äº›å‘" class="headerLink">
    <a href="#%e4%b8%80%e4%ba%9b%e5%9d%91" class="header-mark"></a>6 ä¸€äº›å‘</h2><ul>
<li>
<p>å‘ç° fbthrift python å¹¶ä¸æ”¯æŒ å‘é€ extend host nameï¼ˆSNIï¼‰ï¼Œhttps://github.com/vesoft-inc/nebula-python/pull/238 ï¼Œå†™äº† PR å»åšæ”¯æŒï¼Œè¿™æ—¶å€™ APISIX ä¸­çš„æŠ¥é”™æ˜¯ <code>failed to find SNI: </code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">2022/11/15 10:18:26 [error] 78#78: *1744270 stream [lua] init.lua:842: stream_ssl_phase(): failed to fetch ssl config: failed to find SNI: 
</span></span><span class="line"><span class="cl">please check if the client requests via IP or uses an outdated protocol. If you need to report an issue, provide a packet capture file of the TLS handshake., context: 
</span></span><span class="line"><span class="cl">ssl_certificate_by_lua*, client: 172.17.0.1, server: 0.0.0.0:9779
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext.sslsocket_class" target="_blank" rel="noopener noreferrer">https://docs.python.org/3/library/ssl.html#ssl.SSLContext.sslsocket_class</a></li>
<li><a href="https://github.com/apache/thrift/commit/937228e030569bf25ceb379c9491426709792701" target="_blank" rel="noopener noreferrer">https://github.com/apache/thrift/commit/937228e030569bf25ceb379c9491426709792701</a></li>
<li><a href="https://github.com/apache/thrift/pull/894" target="_blank" rel="noopener noreferrer">https://github.com/apache/thrift/pull/894</a></li>
<li><a href="https://github.com/apache/thrift/blob/e8353cb46e9f5e71f9b76f55d6bf59530b7f98ef/lib/py/src/transport/TSSLSocket.py#L184" target="_blank" rel="noopener noreferrer">https://github.com/apache/thrift/blob/e8353cb46e9f5e71f9b76f55d6bf59530b7f98ef/lib/py/src/transport/TSSLSocket.py#L184</a></li>
</ul>
</li>
<li>
<p>å‘ç° APISIX stream é‡Œè¾¹ä¸è§£æä¸Šæ¸¸ node åŸŸåï¼Œæˆ‘æŸ¥äº†æ‰€æœ‰ä¸€æºœçš„ dns éƒ½æ²¡æœ‰é—®é¢˜ï¼Œå»æäº† issue æ‰çŸ¥é“æ˜¯å·²çŸ¥é—®é¢˜ï¼šhttps://github.com/apache/apisix/issues/8334ï¼Œåªå¥½å…ˆæ‰‹é… <code>IP:Port</code> ä½œç½¢ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">2022/11/15 12:26:59 [error] 44#44: *9538531 stream [lua] resolver.lua:47: parse_domain(): failed to parse domain: nebula-storaged-0.nebula-storaged-headless.default.svc.cluster.local, error: failed to query the DNS server: dns client error: 101 empty record received while prereading client data, client: 172.17.0.1, server: 0.0.0.0:9779
</span></span><span class="line"><span class="cl">2022/11/15 12:26:59 [error] 44#44: *9538531 stream [lua] upstream.lua:79: parse_domain_for_nodes(): dns resolver domain: nebula-storaged-0.nebula-storaged-headless.default.svc.cluster.local error: failed to query the DNS server: dns client error: 101 empty record received while prereading client data, client: 172.17.0.1, server: 0.0.0.0:9779
</span></span><span class="line"><span class="cl">2022/11/15 12:26:59 [error] 44#44: *9538531 stream [lua] init.lua:965: stream_preread_phase(): failed to set upstream: no valid upstream node while prereading client data, client: 172.17.0.1, server: 0.0.0.0:9779
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<blockquote>
<p>é¢˜å›¾ç‰ˆæƒ <a href="https://unsplash.com/photos/IlxX7xnbRF8" target="_blank" rel="noopener noreferrer">Lars</a></p>
</blockquote>]]></description>
</item><item>
    <title>åˆ©ç”¨ dbtï¼ŒåŸºäºè¡¨ç»“æ„çš„ Nebulagraph å›¾å»ºæ¨¡ä¸ ETL</title>
    <link>https://siwei.io/nebulagraph-etl-dbt/</link>
    <pubDate>Thu, 10 Nov 2022 20:19:45 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/nebulagraph-etl-dbt/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/nebulagraph-etl-dbt/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>å¦‚ä½•æŠŠç›¸å¯¹åŸå§‹çš„æ•°æ®å¤„ç†ã€å»ºæ¨¡å¹¶å¯¼å…¥ NebulaGraphï¼Ÿæœ¬æ–‡ç”¨ä¸€ä¸ªç«¯åˆ°ç«¯çš„ç¤ºä¾‹æ¼”ç¤ºï¼Œä»å¤šæ•°æ®æºèšåˆæ•°æ®ï¼Œæ¸…ç†ã€åˆ©ç”¨ dbt è½¬æ¢æˆ NebulaGraph å»ºæ¨¡çš„å±æ€§å›¾ç‚¹è¾¹è®°å½•ï¼Œæœ€åå¯¼å…¥æˆå›¾è°±çš„å…¨æµç¨‹ã€‚</p>
</blockquote>
<!--

[TOC]

-->
<h2 id="ä»»åŠ¡" class="headerLink">
    <a href="#%e4%bb%bb%e5%8a%a1" class="header-mark"></a>1 ä»»åŠ¡</h2><p>å‡è®¾ä½œä¸ºä¸€ä¸ªç±»ä¼¼äº Netflixã€çˆ±å¥‡è‰ºçš„æœåŠ¡æä¾›å•†ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ NebulaGraph æ­å»ºä¸€ä¸ªç”¨æˆ·-ç”µå½±çŸ¥è¯†å›¾è°±ï¼Œæ¥è¾…åŠ©æ”¯æ’‘æ¨èã€é—®ç­”å’Œæ¨èç†ç”±ç­‰å¸¸è§ç”±å›¾è°±æ”¯æ’‘çš„åœºæ™¯ã€‚</p>
<p>çŸ¥è¯†å›¾è°±éœ€è¦çš„æ•°æ®å­˜åœ¨åœ¨ä¸åŒçš„æ•°æ®æºï¼Œæ¯”å¦‚ä¸€äº›å…¬å¼€çš„ APIã€æ•°ä»“ä¸­çš„ä¸åŒæ•°æ®åº“ã€é™æ€çš„æ–‡ä»¶ç­‰ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤æ¥ä»æ•°æ®æ„å»ºå›¾è°±ï¼š</p>
<ul>
<li>åˆ†æå¯èƒ½è·å–çš„æ•°æ®</li>
<li>é€‰å–å…³å¿ƒçš„å…³è”å…³ç³»ï¼Œå›¾å»ºæ¨¡</li>
<li>æŠ½å–å…³è”å…³ç³»ï¼Œå¯¼å…¥å›¾æ•°æ®åº“</li>
</ul>
<h2 id="æ•°æ®æ¥æº" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e6%9d%a5%e6%ba%90" class="header-mark"></a>2 æ•°æ®æ¥æº</h2><p>å‡è®¾æˆ‘ä»¬çš„æ•°æ®æ¥æºæ˜¯ <a href="https://www.omdb.org/en/us/content/Help:DataDownload" target="_blank" rel="noopener noreferrer">OMDB</a> å’Œ <a href="https://grouplens.org/datasets/movielens/" target="_blank" rel="noopener noreferrer">MovieLens</a>ã€‚</p>
<p>OMDB æ˜¯ä¸€ä¸ªå¼€æ”¾çš„ç”µå½±æ•°æ®åº“ï¼Œæœ¬ä¾‹ä¸­æˆ‘ä»¬æ¨¡æ‹Ÿå…¬å¸å†…éƒ¨çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—çš„ä¿¡æ¯æœ‰ï¼š</p>
<ul>
<li>ç”µå½±</li>
<li>ç”µå½±çš„åˆ†ç±»</li>
<li>ç”µå½±ä¸­çš„å·¥ä½œäººå‘˜ï¼ˆå¯¼æ¼”ã€åŠ¨ä½œæŒ‡å¯¼ã€æ¼”å‘˜ã€åæœŸåˆ¶ä½œç­‰ï¼‰</li>
<li>ç”µå½±å°é¢ã€å®£ä¼ ç‰‡ç­‰</li>
</ul>
<p>MovieLens æ˜¯ä¸€ä¸ªå¼€æ”¾çš„æ•°æ®é›†ï¼Œæœ¬ä¾‹ä¸­æˆ‘ä»¬æ¨¡æ‹Ÿå…¬å¸å†…éƒ¨çš„ç”¨æˆ·æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—çš„ä¿¡æ¯æœ‰ï¼š</p>
<ul>
<li>ç”¨æˆ·</li>
<li>ç”µå½±</li>
<li>ç”¨æˆ·å¯¹ç”µå½±çš„è¯„åˆ†äº¤äº’</li>
</ul>
<h2 id="å›¾å»ºæ¨¡" class="headerLink">
    <a href="#%e5%9b%be%e5%bb%ba%e6%a8%a1" class="header-mark"></a>3 å›¾å»ºæ¨¡</h2><p>åœ¨å‰è¾¹æˆ‘ä»¬æ¨èç³»ç»Ÿçš„æ–‡ç« ä¸­æˆ‘ä»¬ä»‹ç»äº†æ¨èç³»ç»Ÿåœ¨å›¾ä¸Šçš„ä¸€äº›åŸºæœ¬çš„æ–¹æ³•ï¼ˆæ–‡ç« çš„é“¾æ¥æ˜¯ <a href="https://www.siwei.io/recommendation-system-with-graphdb/" target="_blank" rel="noopener noreferrer">www.siwei.io/recommendation-system-with-graphdb/</a>ï¼‰ã€‚å…¶ä¸­çš„åŸºäºå†…å®¹è¿‡æ»¤å…³æ³¨äº†ç”¨æˆ·&ndash;&gt;ç”µå½±ã€ç”µå½±&ndash;&gt;åˆ†ç±»ã€ç”µå½±&ndash;&gt;æ¼”å‘˜ã€ç”µå½±&ndash;&gt;å¯¼æ¼”çš„å…³ç³»ï¼ŒååŒè¿‡æ»¤çš„æ–¹æ³•åˆ™å…³æ³¨ç”¨æˆ·&ndash;&gt;ç”µå½±çš„å…³ç³»ï¼Œæ¨èç†ç”±æœåŠ¡åˆ™å…³æ³¨ä»¥ä¸Šæ‰€æœ‰çš„å…³ç³»ï¼Œæ‰€ä»¥æ€»ç»“èµ·æ¥ï¼Œæˆ‘ä»¬éœ€è¦çš„è¾¹æœ‰ï¼š</p>
<ul>
<li>
<p>watched(rate(double))</p>
</li>
<li>
<p>with_genre</p>
</li>
<li>
<p>directed_by</p>
</li>
<li>
<p>acted_by</p>
</li>
</ul>
<p>ç›¸åº”çš„ï¼Œå…¶ä¸­çš„é¡¶ç‚¹ç±»å‹ï¼Œæˆ‘ä»¬å…ˆæ ¹æ®å·²æœ‰çš„ä¿¡æ¯ä¸­ï¼Œé¡¶ç‚¹ä¸­å¯èƒ½éœ€è¦è¢«å…³æ³¨çš„ä¿¡æ¯ä½œä¸ºå±æ€§ï¼Œç»™å‡ºåˆå§‹çš„è§„åˆ’ï¼š</p>
<ul>
<li>
<p>user(user_id)</p>
</li>
<li>
<p>movie(name)</p>
</li>
<li>
<p>person(name, birthdate)</p>
</li>
<li>
<p>genre(name)</p>
</li>
</ul>
<p><figure><a class="lightgallery" href="/nebulagraph-etl-dbt/schema_0.webp" title="schema_0" data-thumbnail="/nebulagraph-etl-dbt/schema_0.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-etl-dbt/schema_0.webp"
            srcset="/nebulagraph-etl-dbt/schema_0.webp, /nebulagraph-etl-dbt/schema_0.webp 1.5x, /nebulagraph-etl-dbt/schema_0.webp 2x"
            sizes="auto"
            alt="/nebulagraph-etl-dbt/schema_0.webp">
    </a></figure></p>
<h2 id="æ•°æ®è½¬æ¢" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e8%bd%ac%e6%8d%a2" class="header-mark"></a>4 æ•°æ®è½¬æ¢</h2><p>æœ‰äº†ç›®æ ‡çš„å›¾è°±ç»“æ„å®šä¹‰ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ‰‹ä¸Šçš„æ•°æ®å¦‚ä½•æ˜ å°„åˆ°å®ƒã€‚</p>
<h3 id="omdb-æ•°æ®" class="headerLink">
    <a href="#omdb-%e6%95%b0%e6%8d%ae" class="header-mark"></a>4.1 OMDB æ•°æ®</h3><p>é¦–å…ˆæ˜¯ OMDB ä¸­çš„æ•°æ®ï¼Œå®ƒç”±å¾ˆå¤šè¡¨ç»„æˆï¼Œæ¯”å¦‚ <code>all_movies</code> è¿™å¼ è¡¨ï¼Œå­˜å‚¨äº†æ‰€æœ‰çš„ç”µå½±ã€ä»¥åŠå®ƒä»¬åœ¨ä¸åŒè¯­è¨€ä¸‹çš„åå­—ï¼š</p>
<table>
<thead>
<tr>
<th>movie_id</th>
<th>name</th>
<th>language_iso_639_1</th>
<th>official_translation</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Cowboy Bebop</td>
<td>de</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>Cowboy Bebop</td>
<td>en</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>Ariel - Abgebrannt in Helsinki</td>
<td>de</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>Shadows in Paradise</td>
<td>en</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>Im Schatten des Paradieses</td>
<td>de</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>Schatten im Paradies</td>
<td>de</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>è€Œ <code>all_casts</code> è¡¨æ ¼ä¸­ä¿æœ‰æ‰€æœ‰ç”µå½±ç›¸å…³çš„å·¥ä½œäººå‘˜ï¼š</p>
<table>
<thead>
<tr>
<th>movie_id</th>
<th>person_id</th>
<th>job_id</th>
<th>role</th>
<th>position</th>
</tr>
</thead>
<tbody>
<tr>
<td>11</td>
<td>1</td>
<td>21</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>11</td>
<td>1</td>
<td>13</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>11</td>
<td>2</td>
<td>15</td>
<td>Luke Skywalker</td>
<td>1</td>
</tr>
<tr>
<td>11</td>
<td>3</td>
<td>15</td>
<td>Han Solo</td>
<td>3</td>
</tr>
<tr>
<td>11</td>
<td>4</td>
<td>15</td>
<td>Leia Organa</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>ä½†æ˜¯è¿™é‡Œçš„æ¯ä¸€ä¸ªäººçš„å§“åç­‰ä¿¡æ¯ã€ä»¥åŠä»–/å¥¹åœ¨ç”µå½±ä¸­ä»»èŒçš„èŒä½ï¼Œåˆ™åˆ†åˆ«åœ¨å¦å¤–çš„è¡¨ä¸­ï¼š</p>
<ul>
<li>
<p><code>job_names</code></p>
<p>æ¯”å¦‚ 1 ä»£è¡¨ç¼–å‰§ã€2 ä»£è¡¨åˆ¶ä½œäººï¼Œæœ‰æ„æ€çš„æ˜¯ï¼Œå’Œç”µå½± id ä¸å§“åä¸€æ ·ï¼Œjob_id åˆ° name æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œå› ä¸º OMDB ä¸­çš„æ•°æ®éƒ½æ˜¯å¤šè¯­è¨€çš„ã€‚</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>job_id</th>
<th>name</th>
<th>language_iso_639_1</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Autoren</td>
<td>de</td>
</tr>
<tr>
<td>1</td>
<td>Writing Department</td>
<td>en</td>
</tr>
<tr>
<td>1</td>
<td>Departamento de redacciÃ³n</td>
<td>es</td>
</tr>
<tr>
<td>1</td>
<td>DÃ©partement Ã©criture</td>
<td>fr</td>
</tr>
<tr>
<td>1</td>
<td>Scenariusz</td>
<td>pl</td>
</tr>
<tr>
<td>2</td>
<td>Produzenten</td>
<td>de</td>
</tr>
<tr>
<td>2</td>
<td>Production Department</td>
<td>en</td>
</tr>
</tbody>
</table>
<ul>
<li><code>all_people</code></li>
</ul>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>birthday</th>
<th>deathday</th>
<th>gender</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>George Lucas</td>
<td>1944-05-14</td>
<td>\N</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>Mark Hamill</td>
<td>1951-09-25</td>
<td>\N</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>Harrison Ford</td>
<td>1942-07-13</td>
<td>\N</td>
<td>0</td>
</tr>
<tr>
<td>4</td>
<td>Carrie Fisher</td>
<td>1956-10-21</td>
<td>2016-12-27</td>
<td>1</td>
</tr>
<tr>
<td>5</td>
<td>Peter Cushing</td>
<td>1913-05-26</td>
<td>1994-08-11</td>
<td>0</td>
</tr>
<tr>
<td>6</td>
<td>Anthony Daniels</td>
<td>1946-02-21</td>
<td>\N</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>è¿™æ˜¯åœ¨æ•°æ®æ¥æºæ˜¯è¡¨ç»“æ„ã€RDBMS ä¸­ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå…¸å‹çš„æƒ…å†µï¼Œæ‰€ä»¥å¯¹äº <code>movie &lt;-[directed_by]-(person)</code> è¿™ä¸ªå…³ç³»ï¼Œå°±æ¶‰åŠäº† <code>all_movies</code>ï¼Œ<code>all_casts</code>ï¼Œ<code>all_people</code>ï¼Œ<code>job_names</code> å››ä¸ªè¡¨æ ¼</p>
<ul>
<li>directed_by
<ul>
<li>èµ·ç‚¹ person_id åœ¨ all_casts ä¹‹ä¸­</li>
<li>ç»ˆç‚¹ movie_id åœ¨ all_casts ä¹‹ä¸­
<ul>
<li>æ¡ä»¶æ˜¯ job_id ä¸º job_names ä¹‹ä¸­çš„ â€œdirectorâ€</li>
</ul>
</li>
</ul>
</li>
<li>movie
<ul>
<li>person_id åœ¨ all_casts ä¹‹ä¸­</li>
<li>åå­—æ¥è‡ª all_movies ä¸­æŒ‰ id æŸ¥æ‰¾ï¼Œlanguage ä¸º â€œenâ€</li>
</ul>
</li>
<li>person
<ul>
<li>movie_id åœ¨ all_casts ä¹‹ä¸­</li>
<li>åå­—ã€ç”Ÿæ—¥åœ¨ all_people ä¹‹ä¸­</li>
</ul>
</li>
</ul>
<p>æ‰€æœ‰ OMDB ä¸­æˆ‘ä»¬å…³å¿ƒçš„è¡¨çš„å…³è”å¦‚å›¾ï¼š</p>
<p><figure><a class="lightgallery" href="/nebulagraph-etl-dbt/modeling_omdb.webp" title="modeling_omdb" data-thumbnail="/nebulagraph-etl-dbt/modeling_omdb.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-etl-dbt/modeling_omdb.webp"
            srcset="/nebulagraph-etl-dbt/modeling_omdb.webp, /nebulagraph-etl-dbt/modeling_omdb.webp 1.5x, /nebulagraph-etl-dbt/modeling_omdb.webp 2x"
            sizes="auto"
            alt="/nebulagraph-etl-dbt/modeling_omdb.webp">
    </a></figure></p>
<h3 id="movielens-æ•°æ®é›†" class="headerLink">
    <a href="#movielens-%e6%95%b0%e6%8d%ae%e9%9b%86" class="header-mark"></a>4.2 MovieLens æ•°æ®é›†</h3><p>è€Œä¸Šè¾¹åªæ˜¯ä¸€ä¸ªæ•°æ®æºã€æ•°æ®è¡¨æˆ–è€…æ•°ä»“çš„æ•°æ®ï¼Œåœ¨çœŸå®åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä»å…¶ä»–æºå¤´æ”¶å–æ•°æ®ï¼Œå¹¶èšåˆèµ·æ¥ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä» MovieLens çš„æ•°æ®é›†ä¸­æŠ½å–éœ€è¦çš„çŸ¥è¯†ã€‚</p>
<p>è¿™é‡Œï¼Œæ¶‰åŠåˆ° MovieLens æ•°æ®é›†ï¼Œæˆ‘ä»¬åˆ©ç”¨çš„åªæœ‰ï¼šç”¨æˆ·&ndash;&gt;ç”µå½±ï¼Œè¿™ä¸€æ¡å…³ç³»ã€‚</p>
<ul>
<li><code>movies.csv</code></li>
</ul>
<table>
<thead>
<tr>
<th>movieId</th>
<th>title</th>
<th>genres</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Toy Story (1995)</td>
<td>Adventure</td>
</tr>
<tr>
<td>2</td>
<td>Jumanji (1995)</td>
<td>Adventure</td>
</tr>
<tr>
<td>3</td>
<td>Grumpier Old Men (1995)</td>
<td>Comedy</td>
</tr>
<tr>
<td>4</td>
<td>Waiting to Exhale (1995)</td>
<td>Comedy</td>
</tr>
</tbody>
</table>
<ul>
<li><code>ratings.csv</code></li>
</ul>
<table>
<thead>
<tr>
<th>userId</th>
<th>movieId</th>
<th>rating</th>
<th>timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>4</td>
<td>964982703</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td>4</td>
<td>964981247</td>
</tr>
<tr>
<td>1</td>
<td>6</td>
<td>4</td>
<td>964982224</td>
</tr>
</tbody>
</table>
<p>ä»ä¸¤ä¸ªè¡¨çš„æ•°æ®é¢„è§ˆä¼¼ä¹å¯ä»¥å¾—å‡ºï¼š</p>
<ul>
<li>watched
<ul>
<li>èµ·ç‚¹æ¥è‡ªäº <code>ratings.csv</code> ä¸­çš„ userId</li>
<li>ç»ˆç‚¹æ¥è‡ªäº <code>ratings.csv</code> ä¸­çš„ movieId</li>
<li>è¯„åˆ†æ¥è‡ªäº <code>ratings.csv</code> ä¸­çš„ rating</li>
</ul>
</li>
<li>user
<ul>
<li>æ¥è‡ªäº <code>ratings.csv</code> ä¸­çš„ userId</li>
</ul>
</li>
</ul>
<p>ç„¶è€Œï¼Œç»†å¿ƒçš„ä½ ä»¬ä¸€å®šå‘ç° MovieLens æ•°æ®é›†ä¸­çš„ movieId å’Œæ¥è‡ªäº OMDB ä¸­çš„ç”µå½± id å®Œå…¨æ˜¯ä¸åŒçš„ä¸¤å¥—ä½“ç³»ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è®©ä»–ä»¬å…³è”èµ·æ¥ï¼Œéœ€è¦å°† MovieLens é‡Œçš„ movieId è½¬æ¢æˆä¸º OMDB ä¸­çš„ç”µå½± idã€‚è€Œä»–ä»¬ä¹‹é—´çš„å…³è”æ¡ä»¶åˆ™æ˜¯ç”µå½±çš„æ ‡é¢˜ã€‚</p>
<p>ç„¶è€Œï¼Œé€šè§‚å¯Ÿï¼Œæˆ‘ä»¬çŸ¥é“ï¼š</p>
<ol>
<li>OMDB ç”µå½±ä¸­æ ‡é¢˜æ˜¯å¤šè¯­è¨€çš„</li>
<li>MovieLens ä¸­çš„æ ‡é¢˜ç»“å°¾å¸¦æœ‰<code>(1995)</code>è¿™æ ·çš„å¹´ä»½ä¿¡æ¯</li>
</ol>
<p>æ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆçš„ç»“è®ºä¸º</p>
<ul>
<li>watched
<ul>
<li>èµ·ç‚¹æ¥è‡ªäº <code>ratings.csv</code> ä¸­çš„ userId</li>
<li>ç»ˆç‚¹æ¥è‡ªäº <code>ratings.csv</code> ä¸­çš„ movieId
<ul>
<li><strong>ç»ˆç‚¹è¦ä» <code>movies.csv</code> ä¸­çš„ title ï¼Œåœ¨ OMDB ä¹‹ä¸­æŸ¥æ‰¾ï¼Œå¾—åˆ° OMDB çš„ movie_id</strong>
<ul>
<li>æŸ¥æ‰¾æ¡ä»¶ä¸ºå»æ‰å¹´ä»½ï¼Œä» OMDB çš„è‹±æ–‡æ ‡é¢˜ä¸­è¿›è¡ŒåŒ¹é…</li>
</ul>
</li>
</ul>
</li>
<li>è¯„åˆ†æ¥è‡ªäº <code>ratings.csv</code> ä¸­çš„ rating</li>
</ul>
</li>
<li>user
<ul>
<li>æ¥è‡ªäº <code>ratings.csv</code> ä¸­çš„ userId</li>
</ul>
</li>
</ul>
<p>ç°åœ¨ï¼Œè¿™ä¸ªè¡¨æ ¼ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹</p>
<p><figure><a class="lightgallery" href="/nebulagraph-etl-dbt/modeling_omdb_movielens.webp" title="modeling_omdb_movielens" data-thumbnail="/nebulagraph-etl-dbt/modeling_omdb_movielens.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-etl-dbt/modeling_omdb_movielens.webp"
            srcset="/nebulagraph-etl-dbt/modeling_omdb_movielens.webp, /nebulagraph-etl-dbt/modeling_omdb_movielens.webp 1.5x, /nebulagraph-etl-dbt/modeling_omdb_movielens.webp 2x"
            sizes="auto"
            alt="/nebulagraph-etl-dbt/modeling_omdb_movielens.webp">
    </a></figure></p>
<h3 id="æ˜ å°„æ•°æ®åˆ°å›¾è°±å±æ€§å›¾" class="headerLink">
    <a href="#%e6%98%a0%e5%b0%84%e6%95%b0%e6%8d%ae%e5%88%b0%e5%9b%be%e8%b0%b1%e5%b1%9e%e6%80%a7%e5%9b%be" class="header-mark"></a>4.3 æ˜ å°„æ•°æ®åˆ°å›¾è°±ï¼ˆå±æ€§å›¾ï¼‰</h3><p>æ€»ç»“èµ·æ¥ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å¤šä¸ªæ•°æ®æºä¸­çš„ä¸åŒè¡¨æ ¼ï¼ˆæˆ–è€…è¡¨æ ¼å½¢å¼çš„ CSV æ–‡ä»¶ï¼‰è¿›è¡Œèšåˆï¼Œè¿™æ ·çš„å¯¹åº”å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼šå…¶ä¸­è“è‰²è™šçº¿è¡¨ç¤ºå›¾ä¸­é¡¶ç‚¹çš„æ•°æ®ä¿¡æ¯æ¥æºï¼Œç²‰è‰²è™šçº¿è¡¨ç¤ºè¾¹ä¿¡æ¯çš„æ¥æºã€‚</p>
<p><figure><a class="lightgallery" href="/nebulagraph-etl-dbt/schema_mapping_to_graph.webp" title="schema_mapping_to_graph" data-thumbnail="/nebulagraph-etl-dbt/schema_mapping_to_graph.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-etl-dbt/schema_mapping_to_graph.webp"
            srcset="/nebulagraph-etl-dbt/schema_mapping_to_graph.webp, /nebulagraph-etl-dbt/schema_mapping_to_graph.webp 1.5x, /nebulagraph-etl-dbt/schema_mapping_to_graph.webp 2x"
            sizes="auto"
            alt="/nebulagraph-etl-dbt/schema_mapping_to_graph.webp">
    </a></figure></p>
<p>æœ€åï¼Œæˆ‘ä»¬è¿˜è¦å¯¹ä¸åŒè¡¨ä¸­ä¸ªä½“çš„ id è¿›è¡Œæ ¼å¼åŒ–ï¼Œæ¯”å¦‚ user_idï¼Œæ˜¯è‡ªå¢çš„æ•°å­—ï¼Œæˆ‘ä»¬è¦è½¬æ¢æˆå…¨å±€å”¯ä¸€çš„ vertex_idï¼Œä¸€ä¸ªæ–¹ä¾¿çš„æ–¹å¼æ˜¯åœ¨ç°æœ‰ id çš„åŸºç¡€ä¸Šå¢åŠ å­—ç¬¦ä¸²å‰ç¼€ï¼Œæ¯”å¦‚ <code>u_</code>ã€‚</p>
<p>æœ€ç»ˆï¼Œæ‹¿å¯¹äº <code>user -[watched]-&gt; movie</code> è¿™ä¸€ä¸ªå…³ç³»æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å¤„ç†å¾—åˆ°è¿™æ ·çš„è¡¨ç»“æ„æ•°æ®ï¼š</p>
<table>
<thead>
<tr>
<th>user_id</th>
<th>rating</th>
<th>title</th>
<th>omdb_movie_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>u_1</td>
<td>5</td>
<td>Seven (a.k.a. Se7en)</td>
<td>807</td>
</tr>
<tr>
<td>u_1</td>
<td>5</td>
<td>Star Wars: Episode IV - A New Hope</td>
<td>11</td>
</tr>
<tr>
<td>u_1</td>
<td>5</td>
<td>Star Wars: Episode IV - A New Hope</td>
<td>10</td>
</tr>
<tr>
<td>u_1</td>
<td>4</td>
<td>Mask, The</td>
<td>832</td>
</tr>
<tr>
<td>u_1</td>
<td>3</td>
<td>Mrs. Doubtfire</td>
<td>832</td>
</tr>
</tbody>
</table>
<p>å…¶ä¸­æ¯ä¸€è¡Œè®°å½•ä¸­å­˜åœ¨ä¸‰ä¸ªå›¾ä¸Šçš„ç»“æ„ä¿¡æ¯ï¼š</p>
<ul>
<li>user é¡¶ç‚¹ id</li>
<li>movie é¡¶ç‚¹ id</li>
<li>watched è¾¹çš„ rating å€¼</li>
</ul>
<h2 id="å·¥å…·" class="headerLink">
    <a href="#%e5%b7%a5%e5%85%b7" class="header-mark"></a>5 å·¥å…·</h2><p>åˆ°æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†æ•°æ®çš„åˆ†æä¸å»ºæ¨¡è®¾è®¡ï¼Œåœ¨è¿›å…¥â€æŠ½å–å…³è”å…³ç³»ï¼Œå¯¼å…¥å›¾æ•°æ®åº“â€œç¯èŠ‚ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸€ä¸‹æˆ‘ä»¬è¦ç”¨åˆ°çš„å·¥å…·ã€‚</p>
<p>â€æŠ½å–å…³è”å…³ç³»â€œå¯ä»¥ç®€å•è®¤ä¸ºæ˜¯ ETL ä¸­çš„ Extract å’Œ Transformã€‚æœ¬è´¨ä¸Šå°±æ˜¯å·¥ç¨‹ä¸Šæ‰§è¡Œæ•°æ®æ˜ å°„ä¸è½¬æ¢çš„å·¥ä½œï¼Œå¸‚é¢ä¸Šæœ‰å¾ˆå¤šä¸åŒé£æ ¼çš„å·¥å…·ã€å¼€æºé¡¹ç›®å¯ä»¥åšã€‚è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„å·¥å…·ï¼šdbtã€‚</p>
<h3 id="æ•°æ®è½¬æ¢åˆ©å™¨-dbt" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e8%bd%ac%e6%8d%a2%e5%88%a9%e5%99%a8-dbt" class="header-mark"></a>5.1 æ•°æ®è½¬æ¢åˆ©å™¨ dbt</h3><p>dbt æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®è½¬æ¢å·¥å…·ï¼Œä»–æœ‰éå¸¸æˆç†Ÿçš„ç¤¾åŒºå’Œç”Ÿæ€ï¼Œå¯ä»¥åœ¨å¤§å¤šæ•°ä¸»æµæ•°ä»“ä¹‹ä¸­è¿›è¡Œé«˜æ•ˆã€å¯æ§ã€é«˜è´¨é‡çš„æ•°æ®è½¬æ¢å·¥ä½œï¼Œæ— è®ºæ˜¯ä¸´æ—¶çš„è½¬æ¢å·¥ä½œï¼ˆad-hocï¼‰ï¼Œè¿˜æ˜¯åœ¨ç»™å®šçš„å®šæ—¶ pipeline ä¸­è¿›è¡Œå¤æ‚ç¼–æ’ï¼Œdbt éƒ½å¯ä»¥å¾ˆå¥½èƒœä»»ï¼Œä»–çš„ä¸€å¤§ç‰¹è‰²å°±æ˜¯ä½¿ç”¨ SQL-like è¯­è¨€å»æè¿°æ•°æ®è½¬æ¢çš„è§„åˆ™ï¼ŒåŸºäº GitOpsï¼Œå¯ä»¥éå¸¸ä¼˜é›…åœ°å»å¤šäººåä½œã€ç»´æŠ¤è¶…å¤§è§„æ¨¡æ•°æ®å›¢é˜Ÿé‡Œå¤æ‚çš„æ•°æ®å¤„ç†ä½œä¸šã€‚è€Œä¸”å†…ç½®çš„æ•°æ®æµ‹è¯•èƒ½åŠ›å¯ä»¥å¾ˆå¥½çš„æ§åˆ¶æ•°æ®çš„è´¨é‡ï¼Œåšåˆ°å¯å¤ç°ã€å¯æ§åˆ¶ã€‚</p>
<p>dbt ä¸ä»…æœ‰å¾ˆå¤šé›†æˆçš„å­é¡¹ç›®ï¼Œè¿˜èƒ½å’Œå¾ˆå¤šå…¶ä»–ä¼˜ç§€çš„å¼€æºé¡¹ç›®æœ‰æœºç»“åˆï¼ˆmeltanoã€AirFlowã€Amundsen ã€Superset ç­‰ç­‰ï¼‰ï¼Œå½¢æˆä¸€æ•´å¥—ç°ä»£çš„æ•°æ®åŸºç¡€è®¾æ–½ä½“ç³»ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰æ­å»ºçš„æ•°æ®è¡€ç¼˜ä¸å…ƒæ•°æ®æ²»ç†å‚è€ƒæ¶æ„æ–‡ç« ï¼šwww.siwei.io/en/data-lineage-oss-ref-solutionã€‚</p>
<p><figure><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg" title="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg" data-thumbnail="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg">
        <img
            
            loading="lazy"
            src="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg"
            srcset="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg, https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg 1.5x, https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg 2x"
            sizes="auto"
            alt="https://user-images.githubusercontent.com/1651790/168849779-4826f50e-ff87-4e78-b17f-076f91182c43.svg">
    </a></figure></p>
<p>ç®€å•æ¥è¯´ï¼Œdbt æ˜¯ä¸€ä¸ª python å†™çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨å®ƒçš„æ—¶å€™ï¼Œé’ˆå¯¹æ¯ä¸€ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºç‰¹å®šæ ¼å¼çš„é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…æ¶µä¸€ä¸ª YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨é…ç½®æ–‡ä»¶é‡ŒæŒ‡å®šæ•°æ®è½¬æ¢çš„æ¥æºä¿¡æ¯åœ¨å“ªé‡Œï¼Œç›®æ ‡åœ¨å“ªé‡Œï¼ˆå¤„ç†ä¹‹åçš„æ•°æ®å­˜å‚¨çš„åœ°æ–¹ï¼Œå¯èƒ½æ˜¯ Postgresï¼ŒBig Queryï¼ŒSpark ç­‰ï¼‰ã€‚åœ¨æ•°æ®æºä¸­ï¼Œæˆ‘ä»¬ç”¨ YAML æ–‡ä»¶å’Œ <code>.SQL</code> æ–‡ä»¶ä¸€èµ·æè¿°äº†â€ä»å“ªé‡Œå–å“ªäº›æ•°æ®ï¼Œå¦‚ä½•åšå˜æ¢ï¼Œè¾“å‡ºä»€ä¹ˆâ€œçš„ä¿¡æ¯ã€‚</p>
<p><figure><a class="lightgallery" href="/nebulagraph-etl-dbt/starter-project-dbt-cli.webp" title="starter-project-dbt-cli" data-thumbnail="/nebulagraph-etl-dbt/starter-project-dbt-cli.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-etl-dbt/starter-project-dbt-cli.webp"
            srcset="/nebulagraph-etl-dbt/starter-project-dbt-cli.webp, /nebulagraph-etl-dbt/starter-project-dbt-cli.webp 1.5x, /nebulagraph-etl-dbt/starter-project-dbt-cli.webp 2x"
            sizes="auto"
            alt="/nebulagraph-etl-dbt/starter-project-dbt-cli.webp">
    </a></figure></p>
<p>è¿™ä¸ªæˆªå›¾å°±æ˜¯ dbt å®˜æ–¹æ–‡æ¡£ä¸­çš„ç¤ºä¾‹é¡¹ç›®ä¸­çš„æ–‡ä»¶å’Œé…ç½®ï¼Œå¯ä»¥çœ‹åˆ° models/example é‡Œçš„ä¿¡æ¯å°±æ˜¯æœ€æ ¸å¿ƒçš„æ•°æ®è½¬æ¢ï¼ˆtransformï¼‰çš„è§„åˆ™ï¼Œè€Œæ‰€æœ‰çš„å…¶ä»–æ•°æ®éƒ½æ˜¯å’Œè¿™ä¸ªæ•°æ®è½¬æ¢ç›¸å…³çš„å…ƒæ•°æ®ï¼Œè¿™äº› dbt é¡¹ç›®æ–‡ä»¶éå¸¸é€‚åˆç”¨ git æ¥è¿›è¡Œç»´æŠ¤ï¼Œè¿›è¡Œç°ä»£ã€è‡ªåŠ¨åŒ–çš„ DataOpsã€‚</p>
<blockquote>
<p>æ³¨ï¼š</p>
<p>å¯ä»¥å‚è€ƒ dbt æ–‡æ¡£ä¸Šæ‰‹ç†è§£å®ƒï¼šhttps://docs.getdbt.com/docs/get-started/getting-started-dbt-core</p>
</blockquote>
<h3 id="nebulagraph-æ•°æ®å¯¼å…¥" class="headerLink">
    <a href="#nebulagraph-%e6%95%b0%e6%8d%ae%e5%af%bc%e5%85%a5" class="header-mark"></a>5.2 NebulaGraph æ•°æ®å¯¼å…¥</h3><p>ç»è¿‡ dbt å¯¹æ•°æ®è¿›è¡Œå¤„ç†ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ç›´æ¥æ˜ å°„åˆ°ä¸åŒç±»å‹çš„é¡¶ç‚¹ã€è¾¹ã€åŠå…¶å±æ€§çš„è¡¨ç»“æ„çš„ä¸­é—´æ•°æ®ï¼Œå®ƒä»¬å¯ä»¥æ˜¯ CSV çš„æ–‡ä»¶å½¢å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°ä»“ä¸­çš„è¡¨ï¼Œç”šè‡³å¯èƒ½æ˜¯ Spark ä¸­çš„ dataframeã€‚è€Œå°†å®ƒä»¬å¯¼å…¥ NebulaGraph æœ‰ä¸åŒçš„é€‰æ‹©ï¼Œå…¶ä¸­ NebulaGraph Exchangeï¼ŒNebula-Importerï¼Œè¿˜æœ‰ Nebula-Spark-Connector éƒ½å¯ä»¥ä½œä¸ºå¯¼å…¥æ•°æ®ã€‚</p>
<blockquote>
<p>æ³¨ï¼š</p>
<p>å¤§å®¶å¯ä»¥åœ¨ <a href="https://www.siwei.io/sketches/nebula-data-import-options" target="_blank" rel="noopener noreferrer">www.siwei.io/sketches/nebula-data-import-options</a> äº†è§£æ›´å¤š NebulaGraph æ•°æ®å¯¼å…¥ä¸åŒå·¥å…·çš„ä»‹ç»ï¼ŒçŸ¥é“å¦‚ä½•é€‰æ‹©ã€‚</p>
</blockquote>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘å°±ç”¨æœ€ç®€å•çš„ Nebula-Importer ä½œä¸ºä¾‹å­ã€‚</p>
<p>Nebula-Importer æ˜¯ä¸€ä¸ªç”¨ Golang å†™çš„å¼€æºå·¥å…·ï¼Œå®ƒå¯ä»¥ç¼–è¯‘æˆä¸€ä¸ªå•æ–‡ä»¶çš„äºŒè¿›åˆ¶ï¼Œé€šè¿‡é¢„é…ç½®çš„ YAML æ ¼å¼çš„æ–‡ä»¶ï¼Œè·å¾—ç»™å®šçš„ CSV æ–‡ä»¶åˆ° NebulaGraph ä¸­ç‚¹ã€è¾¹çš„å¯¹åº”å…³ç³»ï¼Œè¿›è¡Œè¯»å–å’Œå¯¼å…¥ã€‚</p>
<blockquote>
<p>æ³¨ï¼š</p>
<p>Nebula-Importer ä»£ç ï¼šhttps://github.com/vesoft-inc/nebula-importer/</p>
<p>Nebula-Importer æ–‡æ¡£ï¼šhttps://docs.nebula-graph.com.cn/master/nebula-importer/use-importer/</p>
</blockquote>
<h2 id="å®æ“" class="headerLink">
    <a href="#%e5%ae%9e%e6%93%8d" class="header-mark"></a>6 å®æ“</h2><p>ç°åœ¨æˆ‘ä»¬å°±å®æ“ä¸€ä¸‹å¦‚ä½•åˆ©ç”¨ dbt + Nebula-Importer è¿›è¡Œå¤šæ•°æ®æºèšåˆã€è½¬æ¢ã€å†å¯¼å…¥ NebulaGraph çš„è¿‡ç¨‹ï¼Œæ•´ä¸ªé¡¹ç›®çš„ä»£ç å·²ç»å¼€æºï¼Œä»“åº“åœ¨ <a href="https://github.com/wey-gu/movie-recommendation-dataset" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/movie-recommendation-dataset</a> ä¸Šï¼Œæ¬¢è¿å¤§å®¶å‚è€ƒã€å…±å»ºã€‚</p>
<p>æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>å°†æºæ•°æ®ç®€å•æ¸…æ´—ã€å¯¼å…¥æ•°ä»“ï¼ˆPostgresï¼‰ï¼ˆELï¼‰</li>
<li>ç”¨ dbt å¯¹æ•°æ®è¿›è¡Œè½¬æ¢ï¼ˆTransformï¼‰ã€å¯¼å‡ºä¸º CSV æ–‡ä»¶</li>
<li>ç”¨ Nebula Importer å°† CSV å¯¼å…¥ NebulaGraphï¼ˆLï¼‰</li>
</ul>
<p><figure><a class="lightgallery" href="/nebulagraph-etl-dbt/ETL_dbt_nebulagraph_importer.webp" title="ETL_dbt_nebulagraph_importer" data-thumbnail="/nebulagraph-etl-dbt/ETL_dbt_nebulagraph_importer.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-etl-dbt/ETL_dbt_nebulagraph_importer.webp"
            srcset="/nebulagraph-etl-dbt/ETL_dbt_nebulagraph_importer.webp, /nebulagraph-etl-dbt/ETL_dbt_nebulagraph_importer.webp 1.5x, /nebulagraph-etl-dbt/ETL_dbt_nebulagraph_importer.webp 2x"
            sizes="auto"
            alt="/nebulagraph-etl-dbt/ETL_dbt_nebulagraph_importer.webp">
    </a></figure></p>
<h3 id="å‡†å¤‡-dbt-ç¯å¢ƒ" class="headerLink">
    <a href="#%e5%87%86%e5%a4%87-dbt-%e7%8e%af%e5%a2%83" class="header-mark"></a>6.1 å‡†å¤‡ dbt ç¯å¢ƒ</h3><p>dbt æ˜¯ä¸€ä¸ª python é¡¹ç›®ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªè™šæ‹Ÿçš„ python3 ç¯å¢ƒé‡Œå®‰è£…å¥½ dbt å’Œ dbt-postgresã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python3 -m venv .venv
</span></span><span class="line"><span class="cl"><span class="nb">source</span> .venv/bin/activate
</span></span><span class="line"><span class="cl">pip install dbt-postgres
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ›å»ºä¸€ä¸ª dbt é¡¹ç›®ï¼Œå¹¶è¿›å…¥åˆ°ç©ºçš„é¡¹ç›®é‡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dbt init dbt_project
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> dbt_project
</span></span></code></pre></td></tr></table>
</div>
</div><p>çœ‹çœ‹é‡Œè¾¹çš„æ–‡ä»¶å§ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ tree .
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- README.md                      <span class="c1"># é¡¹ç›®è¯´æ˜ README</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- analyses
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- dbt_project.yml                <span class="c1"># é¡¹ç›®é…ç½®æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- macros
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- models                         <span class="c1"># transform æ¥æº</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   <span class="se">\-</span>- example
</span></span><span class="line"><span class="cl"><span class="p">|</span>       <span class="p">|</span>-- my_first_dbt_model.sql <span class="c1"># ä¸€ä¸ªæè¿°äº†å¦‚ä½•ä»å…ƒæ•°æ®ä¸­ SELECT å¹¶å¤„ç†çš„è§„åˆ™</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>       <span class="p">|</span>-- my_second_dbt_model.sql
</span></span><span class="line"><span class="cl"><span class="p">|</span>       <span class="se">\-</span>- schema.yml             <span class="c1"># è§„åˆ™æ–‡ä»¶çš„å…ƒæ•°æ®é…ç½®ï¼Œæè¿°äº† sql è§„åˆ™çš„å±æ€§</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- seeds                          <span class="c1"># æºæ•°æ®å¦‚æœæ˜¯ CSV æ–‡ä»¶ï¼Œå¯ä»¥æ”¾åˆ° seeds é‡Œ</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- snapshots
</span></span><span class="line"><span class="cl"><span class="se">\-</span>- tests
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">7</span> directories, <span class="m">5</span> files
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œå’±ä»¬æ‹‰ä¸€ä¸ªå®¹å™¨é‡Œçš„ Postgres å½“åšæˆ‘ä»¬è¿™ä¸ªé¡¹ç›®çš„æ•°ä»“ï¼Œå¦‚æœä½ å·²ç»æœ‰å„ç§å…¶ä»–æ•°ä»“ï¼Œå°±ä¸éœ€è¦è¿™ä¸€æ­¥äº†ï¼Œä¸è¿‡è¦æŠŠé¡¹ç›®ä¸­çš„é…ç½®æ–‡ä»¶ä½œç›¸åº”çš„ä¿®æ”¹ï¼Œå¹¶å®‰è£…ç›¸åº”çš„ dbt æ’ä»¶ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker run --rm --name postgres <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -e <span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>nebula <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -e <span class="nv">POSTGRES_USER</span><span class="o">=</span>nebula <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -e <span class="nv">POSTGRES_DB</span><span class="o">=</span>warehouse -d <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -p 5432:5432 postgres
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ•°æ®ä¸‹è½½ä¸é¢„å¤„ç†" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e4%b8%8b%e8%bd%bd%e4%b8%8e%e9%a2%84%e5%a4%84%e7%90%86" class="header-mark"></a>6.2 æ•°æ®ä¸‹è½½ä¸é¢„å¤„ç†</h3><p>æˆ‘ä»¬æŠŠæ•°æ®æ”¾åˆ°é¡¹ç›®çš„ raw_data ä¸‹å§</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p raw_data
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> raw_data
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼Œå‡è®¾ raw_data åœ¨ dbt_proeject ä¹‹ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">tree ..
</span></span><span class="line"><span class="cl">..
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- README.md
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- analyses
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- dbt_project.yml
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- macros
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- models
</span></span><span class="line"><span class="cl"><span class="p">|</span>   <span class="se">\-</span>- example
</span></span><span class="line"><span class="cl"><span class="p">|</span>       <span class="p">|</span>-- my_first_dbt_model.sql
</span></span><span class="line"><span class="cl"><span class="p">|</span>       <span class="p">|</span>-- my_second_dbt_model.sql
</span></span><span class="line"><span class="cl"><span class="p">|</span>       <span class="se">\-</span>- schema.yml
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- raw_data                       <span class="c1"># æ–°å»ºçš„ç›®å½•</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- seeds
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- snapshots
</span></span><span class="line"><span class="cl"><span class="se">\-</span>- tests
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">8</span> directories, <span class="m">5</span> files
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬æŠŠ omdb æ•°æ®ä¸‹è½½ä¹‹åï¼Œå†è§£å‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget www.omdb.org/data/all_people.csv.bz2
</span></span><span class="line"><span class="cl">wget www.omdb.org/data/all_people_aliases.csv.bz2
</span></span><span class="line"><span class="cl">wget www.omdb.org/data/people_links.csv.bz2
</span></span><span class="line"><span class="cl">wget www.omdb.org/data/all_casts.csv.bz2
</span></span><span class="line"><span class="cl">wget www.omdb.org/data/job_names.csv.bz2
</span></span><span class="line"><span class="cl">wget www.omdb.org/data/all_characters.csv.bz2
</span></span><span class="line"><span class="cl">wget www.omdb.org/data/movie_categories.csv.bz2
</span></span><span class="line"><span class="cl">wget www.omdb.org/data/movie_keywords.csv.bz2
</span></span><span class="line"><span class="cl">wget www.omdb.org/data/category_names.csv.bz2
</span></span><span class="line"><span class="cl">wget www.omdb.org/data/all_categories.csv.bz2
</span></span><span class="line"><span class="cl">wget www.omdb.org/data/all_movie_aliases_iso.csv.bz2
</span></span><span class="line"><span class="cl">bunzip2 *.bz2
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæ˜¯ MovieLens æ•°æ®é›†çš„ä¸‹è½½ã€è§£å‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://files.grouplens.org/datasets/movielens/ml-latest-small.zip
</span></span><span class="line"><span class="cl">unzip ml-latest-small.zip
</span></span><span class="line"><span class="cl">rm *.zip
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å¯¼å…¥æ•°ä»“è¿›è¡Œè½¬æ¢ï¼ˆTransformï¼‰ä¹‹å‰æˆ‘ä»¬åšä¸€äº›æ•°æ®çš„é¢„å¤„ç†ï¼Œç„¶åæŠŠä»–ä»¬æ”¾åˆ° <code>seeds</code> ä¹‹ä¸‹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># å› ä¸ºæ˜¯å®éªŒé¡¹ç›®ï¼Œæˆ‘ä»¬ç®€å•ç²—æš´åœ°å»æ‰å¸¦æœ‰è½¬ä¹‰çš„å¼•å·çš„æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬ä¼šè¢«è®¤ä¸ºæ˜¯æ— æ•ˆå­—ç¬¦ï¼Œå¤„ç†ä¹‹åçš„ç»“æœæ”¾åˆ° seeds ä¸‹è¾¹ã€‚</span>
</span></span><span class="line"><span class="cl">grep -v <span class="s1">&#39;\\&#34;&#39;</span> raw_data/all_movie_aliases_iso.csv &gt; seeds/all_movie_aliases_iso.csv
</span></span><span class="line"><span class="cl">grep -v <span class="s1">&#39;\\&#34;&#39;</span> raw_data/all_casts.csv &gt; seeds/all_casts.csv
</span></span><span class="line"><span class="cl">grep -v <span class="s1">&#39;\\&#34;&#39;</span> raw_data/all_characters.csv &gt; seeds/all_characters.csv
</span></span><span class="line"><span class="cl">grep -v <span class="s1">&#39;\\&#34;&#39;</span> raw_data/all_people.csv &gt; seeds/all_people.csv
</span></span><span class="line"><span class="cl">grep -v <span class="s1">&#39;\\&#34;&#39;</span> raw_data/category_names.csv &gt; seeds/category_names.csv
</span></span><span class="line"><span class="cl">grep -v <span class="s1">&#39;\\&#34;&#39;</span> raw_data/job_names.csv &gt; seeds/job_names.csv
</span></span><span class="line"><span class="cl"><span class="c1"># ä¸‹è¾¹çš„æ–‡ä»¶æ— éœ€å¤„ç†ï¼Œç›´æ¥æ”¾åˆ° seeds ä¸‹è¾¹ã€‚</span>
</span></span><span class="line"><span class="cl">cp raw_data/movie_categories.csv seeds/movie_categories.csv
</span></span><span class="line"><span class="cl">cp raw_data/movie_keywords.csv seeds/movie_keywords.csv
</span></span><span class="line"><span class="cl">cp raw_data/all_categories.csv seeds/all_categories.csv
</span></span><span class="line"><span class="cl">cp raw_data/ml-latest-small/ratings.csv seeds/movielens_ratings.csv
</span></span><span class="line"><span class="cl">cp raw_data/ml-latest-small/movies.csv seeds/movielens_movies.csv
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº† seeds ä¸‹è¾¹çš„æ–‡ä»¶ä¹‹åï¼Œå¯ä»¥ç”¨ä¸€ä¸ªå‘½ä»¤æŠŠä»–ä»¬å¯¼å…¥åˆ°æ•°ä»“é‡Œï¼š</p>
<blockquote>
<p>å‚è€ƒæ–‡æ¡£ï¼šhttps://docs.getdbt.com/docs/build/seeds</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dbt seed
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œè¿‡ç¨‹å› æ•°ä»“è€Œå¼‚ï¼Œç”¨æœ¬åœ°çš„ postgres å¯èƒ½è¦ç­‰ä¸€ä¼šå„¿æ‰èƒ½å®Œæˆï¼Œæ‰§è¡Œç»“æœå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ dbt seed
</span></span><span class="line"><span class="cl">05:58:27  Running with <span class="nv">dbt</span><span class="o">=</span>1.3.0
</span></span><span class="line"><span class="cl">05:58:27  Found <span class="m">2</span> models, <span class="m">4</span> tests, <span class="m">0</span> snapshots, <span class="m">0</span> analyses, <span class="m">289</span> macros, <span class="m">0</span> operations, <span class="m">11</span> seed files, <span class="m">0</span> sources, <span class="m">0</span> exposures, <span class="m">0</span> metrics
</span></span><span class="line"><span class="cl">05:58:28  
</span></span><span class="line"><span class="cl">05:58:28  Concurrency: <span class="m">8</span> threads <span class="o">(</span><span class="nv">target</span><span class="o">=</span><span class="s1">&#39;dev&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">05:58:28  
</span></span><span class="line"><span class="cl">05:58:28  <span class="m">1</span> of <span class="m">11</span> START seed file public.all_casts ....................................... <span class="o">[</span>RUN<span class="o">]</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">07:10:11  <span class="m">1</span> of <span class="m">11</span> OK loaded seed file public.all_casts ................................... <span class="o">[</span>INSERT <span class="m">1082228</span> in 4303.78s<span class="o">]</span>
</span></span><span class="line"><span class="cl">07:10:11  
</span></span><span class="line"><span class="cl">07:10:11  Finished running <span class="m">11</span> seeds in <span class="m">1</span> hours <span class="m">11</span> minutes and 43.93 seconds <span class="o">(</span>4303.93s<span class="o">)</span>.
</span></span><span class="line"><span class="cl">07:10:11  
</span></span><span class="line"><span class="cl">07:10:11  Completed successfully
</span></span><span class="line"><span class="cl">07:10:11  
</span></span><span class="line"><span class="cl">07:10:11  Done. <span class="nv">PASS</span><span class="o">=</span><span class="m">11</span> <span class="nv">WARN</span><span class="o">=</span><span class="m">0</span> <span class="nv">ERROR</span><span class="o">=</span><span class="m">0</span> <span class="nv">SKIP</span><span class="o">=</span><span class="m">0</span> <span class="nv">TOTAL</span><span class="o">=</span><span class="m">11</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ’°å†™-transform-model" class="headerLink">
    <a href="#%e6%92%b0%e5%86%99-transform-model" class="header-mark"></a>6.3 æ’°å†™ Transform model</h3><p>æˆ‘ä»¬åˆ›å»º model å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir models/movie_recommedation
</span></span><span class="line"><span class="cl">touch models/movie_recommedation/user_watched_movies.sql
</span></span><span class="line"><span class="cl">touch models/movie_recommedation/schema.yml
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ—¶å€™ models ä¸­çš„æ–‡ä»¶ç»“æ„å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ tree models
</span></span><span class="line"><span class="cl">models
</span></span><span class="line"><span class="cl"><span class="se">\-</span>- movie_recommedation
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- user_watched_movies.sql
</span></span><span class="line"><span class="cl">    <span class="se">\-</span>- schema.yml
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ª model ä¸‹è¾¹ç›®å‰åªæœ‰ä¸€ä¸ªè§„åˆ™ï¼Œå°±æ˜¯è´Ÿè´£å¤„ç†ç”¨æˆ·è§‚çœ‹ç”µå½±è¿™ä¸€ä¸ªè¾¹ä¸Šæ•°æ®çš„ SQL è¯­å¥ã€‚</p>
<p>æˆ‘ä»¬å¸Œæœ›è¾“å‡ºä¸‰åˆ—ï¼Œæ‰€ä»¥ <code>schema.yml</code> ä¸­çš„å†…å®¹æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">models</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">user_watched_movies</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;The edges between users and movies they have watched&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">columns</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;user id&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="l">not_null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">movie_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;movie id&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="l">not_null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">rating</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;rating given by user to movie&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="l">not_null</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼Œè¿™é‡Œçš„ tests çš„è¡¨è¾¾æ˜¯å¯¹æ•°æ®éªŒè¯ã€æµ‹è¯•çš„çº¦æŸï¼Œæœ‰äº†å®ƒï¼Œæˆ‘å¯ä»¥ç”¨ dbt è½»æ¾å¯¹æ•°æ®è´¨é‡è¿›è¡Œæµ‹è¯•ã€éªŒæ”¶ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦æ±‚è¿™é‡Œçš„ä¸‰ä¸ªå­—æ®µéƒ½æ˜¯ <code>not_null</code>ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬æ¥å†™ SQL å§ï¼Œ<code>user_watched_movies.sql</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="err">{{</span><span class="w"> </span><span class="n">config</span><span class="p">(</span><span class="n">materialized</span><span class="o">=</span><span class="s1">&#39;table&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> JOIN the movieielens_ratings table with the movieielens_movies table, and removing the movie title tailing the year of release
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">user_watched_movies</span><span class="w"> </span><span class="k">AS</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">moveielens_ratings</span><span class="p">.</span><span class="s2">&#34;userId&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">moveielens_ratings</span><span class="p">.</span><span class="s2">&#34;movieId&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">moveielens_ratings</span><span class="p">.</span><span class="n">rating</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">REGEXP_REPLACE</span><span class="p">(</span><span class="n">moveielens_movies</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; \(\d{4}\)$&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">moveielens_movies</span><span class="p">.</span><span class="n">genres</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">movielens_genres</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">moveielens_ratings</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">moveielens_movies</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">moveielens_movies</span><span class="p">.</span><span class="s2">&#34;movieId&#34;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">moveielens_ratings</span><span class="p">.</span><span class="s2">&#34;movieId&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* 
</span></span></span><span class="line"><span class="cl"><span class="cm"> JOIN user_watched_movies table with all_movie_aliase_iso table where language is English
</span></span></span><span class="line"><span class="cl"><span class="cm"> the join condition is the movie title
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">concat</span><span class="p">(</span><span class="s1">&#39;u_&#39;</span><span class="p">,</span><span class="n">user_watched_movies</span><span class="p">.</span><span class="s2">&#34;userId&#34;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">user_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">user_watched_movies</span><span class="p">.</span><span class="n">rating</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">user_watched_movies</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">all_movie_aliases_iso</span><span class="p">.</span><span class="s2">&#34;movie_id&#34;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OMDB_movie_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">user_watched_movies</span><span class="p">.</span><span class="n">movielens_genres</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">user_watched_movies</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">all_movie_aliases_iso</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_watched_movies</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="n">CONCAT</span><span class="p">(</span><span class="n">all_movie_aliases_iso</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">all_movie_aliases_iso</span><span class="p">.</span><span class="n">language_iso_639_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;en&#39;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è€Œè¿™ä¸ª SQL åšçš„äº‹æƒ…å°±æ˜¯ç»¿è‰²åœ†åœˆæ ‡æ³¨çš„éƒ¨åˆ†ï¼š</p>
<ul>
<li>ä» <code>moveielens_ratings</code> ä¸­é€‰ user idã€movie idã€ratingã€movie titleï¼ˆå»æ‰å¹´ä»½ï¼‰ï¼Œå­˜æˆ <code>user_watched_movies</code> çš„ä¸­é—´è¡¨æ ¼
<ul>
<li>movie title ä» <code>moveielens_movies</code> ä¸­<code> JOIN</code> ï¼Œé€šè¿‡ <code>movie_id</code> ç›¸åŒçš„åŒ¹é…æ¡ä»¶å–å¾—</li>
</ul>
</li>
<li>ä» <code>user_watched_movies</code> ä¸­é€‰ user idï¼ˆå¢åŠ å‰ç¼€ <code>u_</code>ï¼‰ã€ratingã€titleã€OMDB_movie_id
<ul>
<li>OMDB_movie_id ä» <code>all_movie_aliases_iso</code> ä¸­ <code>JOIN</code>ï¼Œé€šè¿‡ç›¸ä¼¼çš„ç”µå½±å§“ååŒ¹é… OMDB ç”µå½±ä¸­è‹±æ–‡æ ‡é¢˜å–å¾—</li>
<li>æœ€ç»ˆçš„å­—æ®µä½œä¸ºè¾“å‡º</li>
</ul>
</li>
</ul>
<p><figure><a class="lightgallery" href="/nebulagraph-etl-dbt/transform_select_joins_user_watched_movies.webp" title="transform_select_joins_user_watched_movies" data-thumbnail="/nebulagraph-etl-dbt/transform_select_joins_user_watched_movies.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-etl-dbt/transform_select_joins_user_watched_movies.webp"
            srcset="/nebulagraph-etl-dbt/transform_select_joins_user_watched_movies.webp, /nebulagraph-etl-dbt/transform_select_joins_user_watched_movies.webp 1.5x, /nebulagraph-etl-dbt/transform_select_joins_user_watched_movies.webp 2x"
            sizes="auto"
            alt="/nebulagraph-etl-dbt/transform_select_joins_user_watched_movies.webp">
    </a></figure></p>
<blockquote>
<p>å°è´´å£«ï¼šæˆ‘ä»¬å¯ä»¥åœ¨ Postgres çš„è¿æ¥å™¨ä¸­é€šè¿‡å¢åŠ  LIMIT å¿«é€Ÿè°ƒè¯•è‡ªå·±çš„ SQL è¯­å¥ã€‚</p>
</blockquote>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡ dbt æ¥æ‰§è¡Œã€æµ‹è¯•åˆšåˆšçš„è§„åˆ™ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dbt run -m user_watched_movies
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥å°±å¯ä»¥åœ¨ Postgresï¼ˆæ•°ä»“ï¼‰ä¸­çœ‹åˆ°æˆ‘ä»¬è½¬æ¢ä¹‹åçš„ä¸€ä¸ªè¡¨äº†ã€‚</p>
<p>ç±»ä¼¼çš„ï¼Œå¦‚æ³•ç‚®åˆ¶æ‰€æœ‰å…¶ä»–éƒ¨åˆ†çš„ Transform è§„åˆ™ï¼Œæˆ‘ä»¬å°±æœ‰è¿™ä¹ˆå¤š model äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ tree models
</span></span><span class="line"><span class="cl">models
</span></span><span class="line"><span class="cl"><span class="se">\-</span>- movie_recommedation
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- acted_by.sql
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- directed_by.sql
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- genres.sql
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- movies.sql
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- people.sql
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- schema.yml
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- user_watched_movies.sql
</span></span><span class="line"><span class="cl">    <span class="se">\-</span>- with_genre.sql
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†å¯¹ä»–ä»¬åˆ†åˆ«æ‰§è¡Œ transformï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dbt run -m acted_by
</span></span><span class="line"><span class="cl">dbt run -m directed_by
</span></span><span class="line"><span class="cl">dbt run -m with_genre
</span></span><span class="line"><span class="cl">dbt run -m people
</span></span><span class="line"><span class="cl">dbt run -m genres
</span></span><span class="line"><span class="cl">dbt run -m movies
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¯¼å‡ºæ•°æ®ä¸º-csv" class="headerLink">
    <a href="#%e5%af%bc%e5%87%ba%e6%95%b0%e6%8d%ae%e4%b8%ba-csv" class="header-mark"></a>6.4 å¯¼å‡ºæ•°æ®ä¸º CSV</h3><p>å®é™…ä¸Šï¼ŒNebulaGraph Exchange æœ¬èº«å°±æ”¯æŒæŠŠå¾ˆå¤šæ•°æ®æºï¼ˆPostgresï¼ŒClickhouseï¼ŒMySQLï¼ŒHive ç­‰ç­‰ï¼‰å¯¼å…¥ NebulaGraphï¼Œåªæ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¤„ç†çš„æ•°æ®é‡å¯¹äº NebulaGraph æ¥è¯´éå¸¸éå¸¸å°ï¼ˆåªæœ‰ç™¾ä¸‡çº§åˆ«çš„è¾¹è€Œå·²ï¼‰ï¼Œä½¿ç”¨æœ€è½»é‡çº§çš„ Nebula-Importer å°±è¶³å¤Ÿäº†ã€‚è€Œ Nebula-Importer èƒ½æ¶ˆè´¹çš„æ•°æ®åªæœ‰ CSV æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠåˆšæ‰çš„è¡¨éƒ½è¾“å‡ºä¸ºæ–‡ä»¶ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¿›å…¥ postgres çš„ consoleï¼Œæ‰§è¡Œ <code>COPY</code> å‘½ä»¤</p>
<blockquote>
<p>å‚è€ƒ Postgres æ–‡æ¡£ï¼šhttps://www.postgresql.org/docs/current/sql-copy.html</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">COPY</span><span class="w"> </span><span class="n">acted_by</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;/tmp/acted_by.csv&#39;</span><span class="w">  </span><span class="k">WITH</span><span class="w"> </span><span class="k">DELIMITER</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="w"> </span><span class="n">CSV</span><span class="w"> </span><span class="n">HEADER</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">COPY</span><span class="w"> </span><span class="n">directed_by</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;/tmp/directed_by.csv&#39;</span><span class="w">  </span><span class="k">WITH</span><span class="w"> </span><span class="k">DELIMITER</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="w"> </span><span class="n">CSV</span><span class="w"> </span><span class="n">HEADER</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">COPY</span><span class="w"> </span><span class="n">with_genre</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;/tmp/with_genre.csv&#39;</span><span class="w">  </span><span class="k">WITH</span><span class="w"> </span><span class="k">DELIMITER</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="w"> </span><span class="n">CSV</span><span class="w"> </span><span class="n">HEADER</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">COPY</span><span class="w"> </span><span class="n">people</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;/tmp/people.csv&#39;</span><span class="w">  </span><span class="k">WITH</span><span class="w"> </span><span class="k">DELIMITER</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="w"> </span><span class="n">CSV</span><span class="w"> </span><span class="n">HEADER</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">COPY</span><span class="w"> </span><span class="n">movies</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;/tmp/movies.csv&#39;</span><span class="w">  </span><span class="k">WITH</span><span class="w"> </span><span class="k">DELIMITER</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="w"> </span><span class="n">CSV</span><span class="w"> </span><span class="n">HEADER</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">COPY</span><span class="w"> </span><span class="n">genres</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;/tmp/genres.csv&#39;</span><span class="w">  </span><span class="k">WITH</span><span class="w"> </span><span class="k">DELIMITER</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="w"> </span><span class="n">CSV</span><span class="w"> </span><span class="n">HEADER</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- å¯¹äº user_watched_movies æˆ‘ä»¬ä¸è¾“å‡ºè¡¨å¤´ï¼Œå› ä¸ºè¿™ä¸ªæ–‡ä»¶ä¸­è®°å½•äº†ä¸¤ç§ç‚¹ã€ä¸€ç§è¾¹ï¼Œæ²¡æ³•è®© importer é€šè¿‡çº¦å®šå¥½çš„è¡¨å¤´è‡ªåŠ¨å¯¼å…¥ï¼Œåªèƒ½é€šè¿‡æ— è¡¨å¤´çš„æƒ…å†µä¸‹æŒ‡å®šç¬¬å‡ åˆ—å¯¹åº”ä»€ä¹ˆå­—æ®µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">COPY</span><span class="w"> </span><span class="n">user_watched_movies</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;/tmp/user_watched_movies.csv&#39;</span><span class="w">  </span><span class="k">WITH</span><span class="w"> </span><span class="k">DELIMITER</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="w"> </span><span class="n">CSV</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæŠŠ postgres å®¹å™¨é‡Œçš„æ–‡ä»¶å¯¼å…¥åˆ° to_nebulagraph è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p to_nebulagraph
</span></span><span class="line"><span class="cl">docker cp postgres:/tmp/. to_nebulagraph/
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¯¼å…¥-nebulagraph" class="headerLink">
    <a href="#%e5%af%bc%e5%85%a5-nebulagraph" class="header-mark"></a>6.5 å¯¼å…¥ NebulaGraph</h3><h4 id="åˆ›å»º-nebulagraph-é›†ç¾¤" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%ba-nebulagraph-%e9%9b%86%e7%be%a4" class="header-mark"></a>6.5.1 åˆ›å»º NebulaGraph é›†ç¾¤</h4><p>æˆ‘ä»¬å¯ä»¥ç”¨ Nebula-Up ä¸€é”®æ­èµ·ä¸€ä¸ªæµ‹è¯•çš„ NebulaGraph å•æœºé›†ç¾¤ï¼Œç„¶åå‚è€ƒæ•°æ®é›†çš„ GitHub ä»“åº“ï¼Œä¸€é”®å¯¼å…¥æ‰€éœ€æ•°æ®ï¼š</p>
<blockquote>
<p>æ³¨ï¼š</p>
<ul>
<li>
<p>Nebula-UPï¼šhttps://github.com/wey-gu/nebula-up</p>
</li>
<li>
<p>æ•°æ®é›†ä»“åº“ï¼šhttps://github.com/wey-gu/movie-recommendation-dataset</p>
</li>
</ul>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -fsSL nebula-up.siwei.io/install.sh <span class="p">|</span> bash
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="åˆ›å»º-schema" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%ba-schema" class="header-mark"></a>6.5.2 åˆ›å»º Schema</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå«åš <code>moviegraph</code> çš„å›¾ç©ºé—´ï¼Œé’ˆå¯¹å‰è¾¹çš„å»ºæ¨¡ï¼Œåˆ›å»ºç‚¹è¾¹ç±»å‹çš„ç»“æ„ï¼ˆSchemaï¼‰ï¼š</p>
<p>å…ˆè¿›å…¥ NebulaGraph çš„ consoleï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">~/.nebula-up/console.sh
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæ‰§è¡Œå¦‚ä¸‹ DDLï¼ˆData Definiation Languageï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">SPACE</span><span class="w"> </span><span class="n">moviegraph</span><span class="p">(</span><span class="n">partition_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">replica_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">vid_type</span><span class="o">=</span><span class="n">fixed_string</span><span class="p">(</span><span class="mi">32</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">:</span><span class="n">sleep</span><span class="w"> </span><span class="mi">20</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">USE</span><span class="w"> </span><span class="n">moviegraph</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="n">person</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">birthdate</span><span class="w"> </span><span class="n">string</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="n">movie</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="n">string</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="n">genre</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="n">string</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="k">user</span><span class="p">(</span><span class="n">user_id</span><span class="w"> </span><span class="n">string</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">acted_by</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">directed_by</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">with_genre</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="n">watched</span><span class="p">(</span><span class="n">rate</span><span class="w"> </span><span class="nb">float</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">exit</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="åˆ›å»º-nebula-importer-é…ç½®æ–‡ä»¶" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%ba-nebula-importer-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" class="header-mark"></a>6.5.3 åˆ›å»º Nebula-Importer é…ç½®æ–‡ä»¶</h4><p>è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªæè¿° CSV æ–‡ä»¶å’Œé›†ç¾¤ä¸­ç‚¹è¾¹æ•°æ®å¯¹åº”å…³ç³»çš„ YAML æ–‡ä»¶ã€‚è¯¦ç»†çš„æ ¼å¼å¯ä»¥å‚è€ƒæ–‡æ¡£ï¼šhttps://docs.nebula-graph.com.cn/master/nebula-importer/use-importer/ï¼Œæˆ–è€…è§†é¢‘æ•™ç¨‹ï¼šhttps://www.bilibili.com/video/BV1ny4y1u7i4 ã€‚</p>
<p>æœ€ç»ˆçš„é…ç½®æ–‡ä»¶æˆ‘å·²ç»é—®å¤§å®¶å†™å¥½äº†ï¼Œåœ¨ <a href="https://github.com/wey-gu/movie-recommendation-dataset/blob/main/nebula-importer.yaml" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/movie-recommendation-dataset/blob/main/nebula-importer.yaml</a> å¯ä»¥ä¸‹è½½å¾—åˆ°ã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬å°±ç›´æ¥ä¸‹è½½æˆ‘å†™å¥½äº†çš„é…ç½®æ–‡ä»¶ï¼Œæ³¨æ„ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸åº”è¯¥æ˜¯ dbt é¡¹ç›®æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬é€€å‡ºç›®å½•ï¼Œå‘ä¸Šä¸€å±‚ï¼ŒæŠŠå®ƒæ”¾åˆ° dbt_proeject å¤–è¾¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ..
</span></span><span class="line"><span class="cl">wget https://raw.githubusercontent.com/wey-gu/movie-recommendation-dataset/main/nebula-importer.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å¼€å§‹å¯¼å…¥" class="headerLink">
    <a href="#%e5%bc%80%e5%a7%8b%e5%af%bc%e5%85%a5" class="header-mark"></a>6.5.4 å¼€å§‹å¯¼å…¥</h4><p>è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬ç”¨å®¹å™¨åŒ–çš„ nebula-importerï¼Œé¿å…äº†å®‰è£…çš„æ­¥éª¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker run --rm -ti <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --network<span class="o">=</span>nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>:/root/ <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/dbt_project/to_nebulagraph/:/data <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    vesoft/nebula-importer:v3.2.0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --config /root/nebula-importer.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¾ˆå¿«ï¼Œæ‰€æœ‰çš„æ•°æ®å°±å¯¼å…¥åˆ° NebulaGraph ä¹‹ä¸­äº†ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡ Nebula-Consoleï¼Œæ‰§è¡Œä¸€äº›æŸ¥è¯¢çœ‹çœ‹ç»“æœï¼š</p>
<p>è¿›å…¥ console</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">~/.nebula-up/console.sh
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿›å…¥å›¾ç©ºé—´ã€æ‰§è¡Œ <code>SHOW STATS</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="n">USE</span><span class="w"> </span><span class="n">moviegraph</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SHOW</span><span class="w"> </span><span class="n">STATS</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="n">moviegraph</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="n">STATS</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+---------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="k">Type</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Name</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">Count</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+---------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Tag&#34;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;genre&#34;</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">14397</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Tag&#34;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;movie&#34;</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">20701</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Tag&#34;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;person&#34;</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">263907</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Tag&#34;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user&#34;</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">610</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Edge&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;acted_by&#34;</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">673763</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Edge&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;directed_by&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">101949</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Edge&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;watched&#34;</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">31781</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Edge&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;with_genre&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">194009</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Space&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;vertices&#34;</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">299615</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Space&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;edges&#34;</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">1001502</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+---------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Got</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="p">(</span><span class="n">time</span><span class="w"> </span><span class="n">spent</span><span class="w"> </span><span class="mi">1693</span><span class="o">/</span><span class="mi">15136</span><span class="w"> </span><span class="n">us</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡ Nebula-Studioï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å¯è§†åŒ–ç•Œé¢æ¢ç´¢è¿™ä¸ªå›¾è°±ï¼Œæ¯”å¦‚åœ¨å…¶ä¸­æ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢ï¼Œçœ‹ä¸€ä¸‹ç»™ç”¨æˆ· u_124 æ¨èç”µå½± 1891 çš„ç†ç”±å¯èƒ½æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="n">FIND</span><span class="w"> </span><span class="n">NOLOOP</span><span class="w"> </span><span class="n">PATH</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s2">&#34;1891&#34;</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">BIDIRECT</span><span class="w"> </span><span class="n">UPTO</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">STEPS</span><span class="w"> </span><span class="n">yield</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä»–çš„ç»“æœæ˜¯ï¼šæ›¾ç»å–œæ¬¢çš„æ˜Ÿæˆ˜ç”µå½±çš„å¤§éƒ¨åˆ†æ¼”èŒäººå‘˜éƒ½ä¹Ÿå‚ä¸äº†è¿™éƒ¨å’ŒåŒæ ·æ˜¯â€œå¥¥æ–¯å¡è·å¥–â€ä¸”â€œç»å…¸â€çš„ç”µå½±ã€‚</p>
<p><figure><a class="lightgallery" href="/nebulagraph-etl-dbt/reasoning_movie.webp" title="reasoning_movie" data-thumbnail="/nebulagraph-etl-dbt/reasoning_movie.webp">
        <img
            
            loading="lazy"
            src="/nebulagraph-etl-dbt/reasoning_movie.webp"
            srcset="/nebulagraph-etl-dbt/reasoning_movie.webp, /nebulagraph-etl-dbt/reasoning_movie.webp 1.5x, /nebulagraph-etl-dbt/reasoning_movie.webp 2x"
            sizes="auto"
            alt="/nebulagraph-etl-dbt/reasoning_movie.webp">
    </a></figure></p>
<blockquote>
<p>æˆ‘åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­ç»™å¤§å®¶ç”¨åŒä¸€ä¸ªå›¾è°±å±•ç¤ºäº†æ›´å¤šå›¾æ•°æ®åº“ã€å›¾ç®—æ³•åœ¨æ¨èç³»ç»Ÿä¸Šçš„åº”ç”¨ï¼Œå¦‚æœå¤§å®¶æ„Ÿå…´è¶£ï¼Œæ¬¢è¿é˜…è¯»ï¼šhttps://www.siwei.io/recommendation-system-with-graphdb/ ã€‚</p>
</blockquote>
<h2 id="æ€»ç»“" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93" class="header-mark"></a>7 æ€»ç»“</h2><p>å½“æˆ‘ä»¬æ‰“ç®—æŠŠæµ·é‡æ•°æ®åˆ©ç”¨å›¾æ•°æ®åº“çš„èƒ½åŠ›è¿›è¡ŒçŸ¥è¯†è½¬åŒ–ã€æ´å¯Ÿåˆ†æçš„æ—¶å€™ï¼Œå¾€å¾€ç¬¬ä¸€æ­¥å°±æ˜¯è¦åšå¤šæ•°æ®æºåˆ°å›¾æ•°æ®çš„è½¬æ¢ã€å¤„ç†ã€å»ºæ¨¡ã€‚å¯¹äºåœ¨æ— ä»ä¸‹æ‰‹çš„æ–°æ‰‹ä»¬æ¥è¯´ï¼Œä¸€ä¸ªå¯è¡Œçš„æ€è·¯æ˜¯ä»æ‰€æœ‰çš„ç›¸å…³ä¿¡æ¯å‡ºå‘ï¼Œå»è®¾æƒ³æœ€å…³æ³¨çš„å…³è”å…³ç³»ï¼ŒæŠŠè¾¹å†™å‡ºæ¥ï¼Œç„¶åå†ç½—åˆ—å¯ä»¥å–å¾—çš„ç‚¹ã€ä»¥åŠéœ€è¦çš„ç‚¹ã€è¾¹ä¸Šçš„å±æ€§ã€‚ç¡®å®šäº†åˆå§‹çš„å»ºæ¨¡ä¹‹åï¼Œå°±å¯ä»¥åˆ©ç”¨ ETL å·¥å…·æŠŠåŸå§‹çš„æ•°æ®æ¸…æ´—ã€ETL æˆç‚¹ã€è¾¹ç±»å‹çš„è¡¨ç»“æ„ï¼Œæœ€åï¼Œåˆ©ç”¨å¯¼å…¥å·¥å…·å¯¼å…¥ NebulaGraphã€‚</p>
<p>å€ŸåŠ©äº dbtï¼Œæˆ‘ä»¬å¯ä»¥ç‰ˆæœ¬æ§åˆ¶ã€æµ‹è¯•ã€è¿­ä»£æˆ‘ä»¬çš„å»ºæ¨¡ä¸æ•°æ®è½¬æ¢ï¼Œä¸€ç‚¹ç‚¹è¿›åŒ–ã€ä¸°å¯Œæ„å»ºçš„çŸ¥è¯†å›¾è°±ã€‚</p>
<blockquote>
<p>é¢˜å›¾ç‰ˆæƒï¼š<a href="https://unsplash.com/photos/Bu4lHKIHr-E" target="_blank" rel="noopener noreferrer">Claudio</a></p>
</blockquote>]]></description>
</item><item>
    <title>åŸºäºå›¾æ•°æ®åº“çš„æ¨èç³»ç»Ÿ</title>
    <link>https://siwei.io/recommendation-system-with-graphdb/</link>
    <pubDate>Tue, 25 Oct 2022 10:24:15 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/recommendation-system-with-graphdb/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/recommendation-system-with-graphdb/featured-image.webp" referrerpolicy="no-referrer">
            </div><h2 id="åŸºäºå›¾æ•°æ®åº“çš„æ¨èç³»ç»Ÿ" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%9b%be%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e6%8e%a8%e8%8d%90%e7%b3%bb%e7%bb%9f" class="header-mark"></a>1 åŸºäºå›¾æ•°æ®åº“çš„æ¨èç³»ç»Ÿ</h2><blockquote>
<p>æœ¬æ–‡æ˜¯ä¸€ä¸ªåŸºäº NebulaGraph ä¸Šå›¾ç®—æ³•ã€å›¾æ•°æ®åº“ã€æœºå™¨å­¦ä¹ ã€GNN çš„æ¨èç³»ç»Ÿæ–¹æ³•ç»¼è¿°ï¼Œå¤§éƒ¨åˆ†ä»‹ç»çš„æ–¹æ³•æä¾›äº† Playground ä¾›å¤§å®¶å­¦ä¹ ã€‚</p>
</blockquote>
<!--

[TOC]

-->
<h3 id="åŸºæœ¬æ¦‚å¿µ" class="headerLink">
    <a href="#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5" class="header-mark"></a>1.1 åŸºæœ¬æ¦‚å¿µ</h3><p>æ¨èç³»ç»Ÿè¯ç”Ÿçš„åˆè¡·æ˜¯è§£å†³äº’è”ç½‘æ—¶ä»£æ‰é¢ä¸´çš„ä¿¡æ¯é‡è¿‡è½½é—®é¢˜ï¼Œä»æœ€åˆçš„ Amazon å›¾ä¹¦æ¨èã€å•†å“æ¨èï¼Œåˆ°ç”µå½±ã€éŸ³ä¹ã€è§†é¢‘ã€æ–°é—»æ¨èï¼Œå¦‚ä»Šå¤§å¤šæ•°ç½‘ç«™ã€App ä¸­éƒ½æœ‰è‡³å°‘ä¸€ä¸ªåŸºäºæ¨èç³»ç»Ÿç”Ÿæˆçš„ä¾›ç”¨æˆ·é€‰æ‹©çš„ç‰©å“åˆ—è¡¨ç•Œé¢ã€‚è€Œè¿™äº›ç‰©å“çš„æ¨èåŸºæœ¬éƒ½æ˜¯åŸºäºç”¨æˆ·å–œå¥½ã€ç‰©å“çš„ç‰¹å¾ã€ç”¨æˆ·ä¸ç‰©å“äº¤äº’å†å²å’Œå…¶ä»–ç›¸å…³ä¸Šä¸‹æ–‡å»åšçš„ã€‚</p>
<p>ä¸€ä¸ªæ¨èç³»ç»Ÿä¼šåŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>æ•°æ®ã€ç‰¹å¾çš„å¤„ç†</li>
<li>ä»ç‰¹å¾å‡ºå‘ï¼Œç”Ÿæˆæ¨èåˆ—è¡¨</li>
<li>è¿‡æ»¤ã€æ’åºæ¨èåˆ—è¡¨</li>
</ul>
<p>è¿™å…¶ä¸­ï¼Œè¿‡æ»¤çš„æ ¸å¿ƒæ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§ï¼šåŸºäºå†…å®¹çš„è¿‡æ»¤ï¼ˆContent-Based Filteringï¼‰ã€ä¸ååŒè¿‡æ»¤ï¼ˆCollaborative Filteringï¼‰ã€‚</p>
<h4 id="åŸºäºå†…å®¹çš„è¿‡æ»¤" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%86%85%e5%ae%b9%e7%9a%84%e8%bf%87%e6%bb%a4" class="header-mark"></a>1.1.1 åŸºäºå†…å®¹çš„è¿‡æ»¤</h4><p>å†…å®¹è¿‡æ»¤æ–¹æ³•çš„æœ¬è´¨æ˜¯ç»™ç”¨æˆ·çš„åå¥½åšç”»åƒï¼ŒåŒæ—¶å¯¹æ‰€æœ‰å¾…æ¨èçš„ç‰©å“è®¡ç®—ç‰¹å¾ï¼Œåšç”¨æˆ·çš„ç”»åƒä¸å¾…æ¨èç‰©å“ç‰¹å¾ä¹‹é—´çš„è·ç¦»è¿ç®—ï¼Œè¿‡æ»¤å¾—åˆ°ç›¸è¿‘çš„ç‰©å“ã€‚</p>
<blockquote>
<p>ref: <a href="https://www.ise.bgu.ac.il/faculty/liorr/recsyshb/chContent.pdf" target="_blank" rel="noopener noreferrer">https://www.ise.bgu.ac.il/faculty/liorr/recsyshb/chContent.pdf</a></p>
</blockquote>
<p>å†…å®¹è¿‡æ»¤çš„æ–¹æ³•çš„å¥½å¤„æœ‰ï¼š</p>
<ul>
<li>æ¸…æ™°çš„å¯è§£é‡Šæ€§ï¼Œæ— è®ºæ˜¯å¯¹ç”¨æˆ·çš„ç”»åƒåˆ†æï¼Œè¿˜æ˜¯å¯¹ç‰©å“çš„è¿ç®—æœ¬èº«å¤©ç„¶å¸¦æ¥äº†æ’åºã€è¿‡æ»¤çš„å¯è§£é‡Šæ€§</li>
<li>ç”¨æˆ·æ•°æ®è¾“å…¥çš„ç‹¬ç«‹æ€§ï¼Œå¯¹ç»™å®šçš„å¾…æ¨èç”¨æˆ·æ¥è¯´ï¼Œåªéœ€è¦å•ç‹¬åˆ†æä»–ä»¬çš„ç”»åƒå’Œå†å²è¯„åˆ†å°±è¶³å¤Ÿäº†</li>
<li>è§„é¿æ–°ç‰©å“å†·å¯åŠ¨é—®é¢˜ï¼Œå¯¹äºæ–°çš„æ·»åŠ çš„ç‰©å“ï¼Œå³ä½¿æ²¡æœ‰ä»»ä½•å†å²çš„ç”¨æˆ·è¯„ä»·ï¼Œä¹Ÿå¯ä»¥åšå‡ºæ¨è</li>
</ul>
<p>åŒæ—¶ï¼ŒåŸºäºå†…å®¹è¿‡æ»¤çš„æŒ‘æˆ˜ä¸åŠ£åŠ¿ä¹Ÿæœ‰ï¼š</p>
<ul>
<li>ç‰¹å¾æå–ï¼Œæå–å¾…æ¨èç‰©å“çš„ç‰¹å¾å¹¶éæ€»æ˜¯å¾ˆå®¹æ˜“åœ°ï¼Œæ¯”å¦‚ç…§ç‰‡ã€è§†é¢‘ç­‰éçº¯æ–‡æœ¬çš„ç‰©å“ï¼Œè€Œä¸”å¾€å¾€è¿™äº›ç‰©å“çš„ç‰¹å¾æå–ä¾èµ–é¢†åŸŸä¸“å®¶çŸ¥è¯†ï¼Œæ¯”å¦‚ç”µå½±æ¨èç³»ç»Ÿä¸­éœ€è¦æŠ½ç¦»å‡ºå¯¼æ¼”ã€ç”µå½±åˆ†ç±»ç­‰é¢†åŸŸçŸ¥è¯†ä½œä¸ºç‰¹å¾</li>
<li>ä¸æ“…é•¿çªç ´èˆ’é€‚åœˆï¼Œå‘æ˜ç”¨æˆ·çš„æ½œåœ¨æ–°å…´è¶£ç‚¹</li>
<li>å­˜åœ¨æ–°ç”¨æˆ·å†·å¯åŠ¨é—®é¢˜ï¼Œå¯¹å°‘æœ‰ä¿¡æ¯ä½œä¸ºç”¨æˆ·ç”»åƒçš„ç”¨æˆ·æ¥è¯´ï¼Œç¼ºå°‘åšè¿›ä¸€æ­¥ç‰©å“ç”»åƒã€ç‰¹ç§è·ç¦»è¿ç®—çš„è¾“å…¥</li>
</ul>
<h4 id="åŸºäºååŒè¿‡æ»¤" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%8d%8f%e5%90%8c%e8%bf%87%e6%bb%a4" class="header-mark"></a>1.1.2 åŸºäºååŒè¿‡æ»¤</h4><p>ååŒè¿‡æ»¤æ–¹æ³•æœ¬è´¨æ˜¯ååŒç”¨æˆ·ä¸ç³»ç»Ÿä¹‹é—´çš„äº¤äº’è¡Œä¸ºå»ç»™å‡ºæ¨èç‰©å“ã€‚</p>
<p>ååŒè¿‡æ»¤çš„æ–¹æ³•åˆåˆ†ä¸º<strong>åŸºäºè®°å¿†</strong>ï¼ˆmemory-basedï¼‰çš„ä¸<strong>åŸºäºæ¨¡å‹</strong>ï¼ˆmodel-basedï¼‰çš„ã€‚</p>
<p>å‰è€…ä¸»è¦æœ‰ç‰©å“ä¸ç‰©å“ä¹‹é—´çš„ååŒè¿‡æ»¤ï¼ˆItemCFï¼‰å’Œç”¨æˆ·ä¸ç”¨æˆ·ä¹‹é—´çš„ååŒè¿‡æ»¤ï¼ˆUserCFï¼‰ï¼ŒItemCF ç®€å•æ¥è¯´æ˜¯æ¨èå’Œç”¨æˆ·ä¹‹å‰é€‰æ‹©è¿‡çš„ç‰©å“ç±»ä¼¼çš„ç‰©å“ï¼šæ ¹æ®è¡Œä¸ºæ‰¾ç‰©å“ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼ŒUserCF åˆ™æ¨èä¸ä¹‹æœ‰å…±åŒçˆ±å¥½çš„ç”¨æˆ·å–œæ¬¢çš„ç‰©å“ï¼šæ ¹æ®è¡Œä¸ºæ‰¾ç”¨æˆ·ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼›</p>
<p>è€Œåè€…åŸºäºå±•ç°ç”¨æˆ·å–œå¥½çš„å†å²å®è·µä¿¡æ¯ã€åˆ©ç”¨ç»Ÿè®¡ä¸æœºå™¨å­¦ä¹ æ–¹æ³•è®­ç»ƒæ¨¡å‹ï¼Œå¯¹æ–°çš„ç”¨æˆ·åå¥½è¿›è¡Œæ¨ç†ã€‚</p>
<p>ååŒè¿‡æ»¤çš„æ–¹æ³•çš„å¥½å¤„æœ‰ï¼š</p>
<ul>
<li>æ— éœ€å¯¹éç»“æ„åŒ–ç‰©å“è¿›è¡Œç‰¹å¾åˆ†æï¼Œå› ä¸ºååŒè¿‡æ»¤å…³æ³¨çš„æ˜¯ç”¨æˆ·å’Œç‰©å“ä¹‹é—´çš„ååŒäº¤äº’ï¼Œè¿™ç»•è¿‡äº†å¯¹ç‰©å“é¢†åŸŸçŸ¥è¯†å¤„ç†çš„éœ€æ±‚</li>
<li>å¯¹ç”¨æˆ·çš„ä¸ªæ€§åŒ–æ›´å¼ºï¼Œæ›´ç»†ï¼ŒåŸºäºè¡Œä¸ºçš„åˆ†æä½¿å¾—å¯¹ç”¨æˆ·åå¥½çš„åˆ’åˆ†æœ¬è´¨ä¸Šæ˜¯è¿ç»­çš„ï¼ˆç›¸æ¯”æ¥è¯´ï¼Œå¯¹ç”¨æˆ·åšç”»åƒçš„æ–¹æ³•åˆ™æ˜¯ç¦»æ•£çš„ï¼‰ï¼Œè¿™æ ·çš„æ¨èç»“æœä¼šæ›´åŠ â€œåƒäººåƒé¢â€ï¼ŒåŒæ—¶ï¼Œä¹Ÿä¼šè•´å«å†…å®¹è¿‡æ»¤ã€æœ‰é™çš„ç”»åƒè§’åº¦ä¹‹ä¸‹çš„â€œæƒŠå–œâ€æ¨è</li>
</ul>
<p>è€Œå®ƒçš„ç¼ºç‚¹æœ‰ï¼š</p>
<ul>
<li>æœ‰æ–°ç”¨æˆ·å’Œæ–°ç‰©ä»¶ä¸Šçš„å†·å¯åŠ¨é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬èº«ä¸Šéƒ½ç¼ºå°‘å†å²å–œå¥½è¡Œä¸ºçš„ä¿¡æ¯</li>
</ul>
<blockquote>
<p>ref: <a href="https://coek.info/pdf-a-dynamic-collaborative-filtering-system-via-a-weighted-clustering-approach-.html" target="_blank" rel="noopener noreferrer">https://coek.info/pdf-a-dynamic-collaborative-filtering-system-via-a-weighted-clustering-approach-.html</a></p>
</blockquote>
<p>ä»ä»¥ä¸Šä¸¤ç§ä¸»è¦çš„è¿‡æ»¤æ–¹å¼çš„ä¼˜åŠ£ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä»¬ä¹‹ä¸­å­˜åœ¨äº’è¡¥çš„åœ°æ–¹ï¼Œæ¯”å¦‚æ–°ç‰©ä»¶çš„å†·å¯åŠ¨ä¸Šï¼ŒåŸºäºå†…å®¹çš„è¿‡æ»¤æœ‰ä¼˜åŠ¿ï¼Œå¯¹äºä¸ªæ€§åŒ–ã€æƒŠå–œæ¨èè§’åº¦ï¼ŒååŒè¿‡æ»¤æœ‰ä¼˜åŠ¿ã€‚æ‰€ä»¥ï¼Œåœ¨çœŸå®ä¸–ç•Œä¸­ï¼Œæ¨èç³»ç»Ÿåœ¨å¤§å¤šæ¼”åŒ–åœ°æ¯”ä¸Šè¾¹çš„å½’ç±»å¤æ‚å¾—å¤šï¼Œè€Œä¸”å¸¸å¸¸æ˜¯å¤šç§æ–¹æ³•çš„èåˆã€‚</p>
<h3 id="åŸºäºå›¾çš„ä¸ªæ€§æ¨è" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%9b%be%e7%9a%84%e4%b8%aa%e6%80%a7%e6%8e%a8%e8%8d%90" class="header-mark"></a>1.2 åŸºäºå›¾çš„ä¸ªæ€§æ¨è</h3><p>å›¾æŠ€æœ¯ã€å›¾æ•°æ®åº“æŠ€æœ¯åœ¨æ¨èç³»ç»Ÿä¸­çš„åº”ç”¨æ˜¯å¤šæ–¹é¢çš„ï¼Œæœ¬ç« æˆ‘ä»¬å°±ä»å›¾æ•°æ®åº“çš„å‡ºå‘ç‚¹ä¸Šç»™å‡ºå¤šç§åº”ç”¨çš„ä¾‹å­ã€‚</p>
<h4 id="å»ºç«‹å›¾è°±" class="headerLink">
    <a href="#%e5%bb%ba%e7%ab%8b%e5%9b%be%e8%b0%b1" class="header-mark"></a>1.2.1 å»ºç«‹å›¾è°±</h4><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ç®€å•ä»‹ç»ä¸€ä¸‹æœ¬æ–‡ä½¿ç”¨çš„å›¾æ•°æ®é›†ã€‚</p>
<p>ä¸ºäº†ç»™å‡ºæ›´æ¥è¿‘å®é™…æƒ…å†µçš„ä¾‹å­ï¼Œæˆ‘ä»ä¸¤ä¸ªå…¬å¼€çš„æ•°æ®é›† <a href="https://www.omdb.org/en/us/content/Help:DataDownload" target="_blank" rel="noopener noreferrer">OMDB</a> å’Œ <a href="https://grouplens.org/datasets/movielens/" target="_blank" rel="noopener noreferrer">MovieLens</a> ä¸­åˆ†åˆ«æŠ½å–äº†éœ€è¦çš„ä¿¡æ¯ï¼Œç»„æˆäº†ä¸€ä¸ªæ—¢åŒ…å«ç”µå½±çš„å¡å¸ï¼ˆå¯¼æ¼”ã€æ¼”å‘˜ï¼‰å’Œç±»å‹ã€åˆåŒ…å«ç”¨æˆ·å¯¹ç”µå½±è¯„åˆ†è®°å½•çš„çŸ¥è¯†å›¾è°±ã€‚</p>
<p>å®ƒçš„ Scehma å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>é¡¶ç‚¹ï¼š</p>
<ul>
<li>
<p>user(user_id)</p>
</li>
<li>
<p>movie(name)</p>
</li>
<li>
<p>person(name, birthdate)</p>
</li>
<li>
<p>genre(name)</p>
</li>
</ul>
</li>
<li>
<p>è¾¹ï¼š</p>
<ul>
<li>
<p>watched(rate(double))</p>
</li>
<li>
<p>with_genre</p>
</li>
<li>
<p>directed_by</p>
</li>
<li>
<p>acted_by</p>
</li>
</ul>
</li>
</ul>
<p><figure><a class="lightgallery" href="/recommendation-system-with-graphdb/schema_0.webp" title="schema_0" data-thumbnail="/recommendation-system-with-graphdb/schema_0.webp">
        <img
            
            loading="lazy"
            src="/recommendation-system-with-graphdb/schema_0.webp"
            srcset="/recommendation-system-with-graphdb/schema_0.webp, /recommendation-system-with-graphdb/schema_0.webp 1.5x, /recommendation-system-with-graphdb/schema_0.webp 2x"
            sizes="auto"
            alt="/recommendation-system-with-graphdb/schema_0.webp">
    </a></figure></p>
<p>è¿™ä¸ªæ•°æ®çš„å‡†å¤‡ã€ETL è¿‡ç¨‹ä¼šåœ¨å¦å¤–çš„æ–‡ç« é‡Œè¯¦ç»†ä»‹ç»ï¼Œåœ¨è¿›å…¥ä¸‹ä¸€ç« èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ Nebula-Up ä¸€é”®æ­èµ·ä¸€ä¸ªæµ‹è¯•çš„ NebulaGraph å•æœºé›†ç¾¤ï¼Œç„¶åå‚è€ƒæ•°æ®é›†çš„ GitHub ä»“åº“ï¼Œä¸€é”®å¯¼å…¥æ‰€éœ€æ•°æ®ï¼š</p>
<blockquote>
<p>æ³¨ï¼š</p>
<ul>
<li>
<p>Nebula-UPï¼šhttps://github.com/wey-gu/nebula-up</p>
</li>
<li>
<p>æ•°æ®é›†ä»“åº“ï¼šhttps://github.com/wey-gu/movie-recommendation-dataset</p>
</li>
</ul>
</blockquote>
<p>è¿‡ç¨‹æœ€ç®€å•çš„æ“ä½œè¿‡ç¨‹ä¸ºï¼š</p>
<ul>
<li>ç”¨ Nebula-Up å®‰è£… NebulaGraph</li>
<li>å…‹éš† movie-recommendation-dataset</li>
<li>å¯¼å…¥æ•°æ®é›† NebulaGraph</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -fsSL nebula-up.siwei.io/install.sh <span class="p">|</span> bash
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">git clone https://github.com/wey-gu/movie-recommendation-dataset.git <span class="o">&amp;&amp;</span> <span class="nb">cd</span> movie-recommendation-dataset
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker run --rm -ti <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --network<span class="o">=</span>nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>:/root/ <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/dbt_project/to_nebulagraph/:/data <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    vesoft/nebula-importer:v3.2.0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --config /root/nebula-importer.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="åŸºäºå†…å®¹çš„è¿‡æ»¤-1" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%86%85%e5%ae%b9%e7%9a%84%e8%bf%87%e6%bb%a4-1" class="header-mark"></a>1.2.2 åŸºäºå†…å®¹çš„è¿‡æ»¤</h4><p>CBF çš„æ€æƒ³æ˜¯åˆ©ç”¨é¢†åŸŸçŸ¥è¯†ã€å†å²è®°å½•ã€å…ƒæ•°æ®åˆ†åˆ«å¯¹ç”¨æˆ·å’Œç‰©ä»¶åšç”»åƒã€æ‰“æ ‡ç­¾ï¼Œæœ€ç»ˆæ ¹æ®ç”¨æˆ·çš„æ ‡ç­¾ä¸å¾…æ¨èç‰©ä»¶ä¹‹é—´çš„è·ç¦»è¯„åˆ†æ’åºç»™å‡ºæ¨èã€‚</p>
<p>å¯¹ç”¨æˆ·çš„ç”»åƒä¸æ¶‰åŠå…¶ä»–ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä½†æ˜¯è¾“å…¥çš„ç‰¹å¾å¯èƒ½æ¥æºäºå…ƒæ•°æ®ï¼ˆç”Ÿæ—¥ã€å›½ç±ã€æ€§åˆ«ã€å¹´é¾„ï¼‰ï¼Œå†å²è®°å½•ï¼ˆè¯„è®ºã€æ‰“åˆ†ã€è´­ä¹°ã€æµè§ˆï¼‰ç­‰ç­‰ï¼Œåœ¨è¿™äº›åŸºç¡€ä¹‹ä¸Šå¯¹ç”¨æˆ·è¿›è¡Œæ ‡ç­¾æ ‡æ³¨ã€åˆ†ç±»ã€èšç±»ã€‚</p>
<p>å¯¹ç‰©ä»¶çš„ç”»åƒè¾“å…¥çš„ç‰¹å¾å¯èƒ½æ˜¯åŸºäºè¯­è¨€å¤„ç†ï¼ˆNLPã€TF-IDFã€LFMï¼‰ã€ä¸“å®¶æ ‡æ³¨ã€å¤šåª’ä½“å¤„ç†ï¼ˆè§†è§‰åˆ°æ–‡å­—å†NLPã€éŸ³é¢‘é£æ ¼å¤„ç†ã€éŸ³é¢‘åˆ°æ–‡å­—å†NLPï¼‰ç­‰ã€‚</p>
<p>æœ‰äº†ç”¨æˆ·ç”»åƒä¸ç‰©ä»¶çš„ç”»åƒç‰¹å¾ã€å¯¹ç”¨æˆ·æ¶‰åŠçš„ç”»åƒè¿›è¡Œç›¸å…³ç”»åƒç‰©ä»¶ä¸­æ–°å¯¹è±¡çš„è¿‘ä¼¼åº¦è®¡ç®—ï¼Œå†è¯„åˆ†åŠ æƒï¼Œå°±å¯ä»¥è·å¾—æœ€ç»ˆçš„æ¨èæ’åºäº†ã€‚è¿™å…¶ä¸­çš„è¿‘ä¼¼åº¦è®¡ç®—å¯ä»¥æ˜¯å¸¸è§çš„ KNNï¼Œä½™å¼¦ç›¸ä¼¼ï¼ŒJaccard ç›¸ä¼¼ç­‰å„ç§æ–¹æ³•ã€‚</p>
<p>CBF çš„æ–¹æ³•ä¸­æ²¡æœ‰é™å®šå…·ä½“å®ç°æ–¹å¼ï¼Œå¦‚å‰è¾¹ä»‹ç»ï¼Œå¯èƒ½æ˜¯åŸºäºæœºå™¨å­¦ä¹ ã€elasticsearchã€å›¾è°±ç­‰ä¸åŒçš„æ–¹æ³•ã€‚è¿™é‡Œä¸ºåˆ‡åˆæœ¬ç« çš„ä¸»é¢˜ï¼Œæˆ‘ç»™å‡ºä¸€ä¸ªåŸºäºå›¾æ•°æ®åº“ã€å›¾è°±ä¸Šçš„ CBF çš„ä¾‹å­ï¼Œåšä¸€ä¸ªç”µå½±æ¨èç³»ç»Ÿï¼Œèƒ½è®©è¯»è€…ç†è§£è¿™ä¸ªæ–¹æ³•çš„æ€æƒ³çš„åŒæ—¶ç†Ÿæ‚‰å›¾æ•°æ®åº“ã€çŸ¥è¯†å›¾è°±çš„æ–¹æ³•ã€‚</p>
<p>è¿™å…¶ä¸­ç”¨æˆ·çš„ç‰¹å¾æˆ‘ä»¬ç›´æ¥åˆ©ç”¨å†å²ç”µå½±è¯„ä»·è®°å½•ï¼Œè€Œæ¨èç‰©ä»¶ï¼šç”µå½±ï¼Œçš„ç”»åƒåˆ™æ¥è‡ªäºé¢†åŸŸä¸­çš„çŸ¥è¯†ã€‚è¿™äº›çŸ¥è¯†æœ‰ï¼šç”µå½±é£æ ¼ã€ç”µå½±çš„å¡æ–¯ã€å¯¼æ¼”ã€‚è¿‘ä¼¼åº¦è¿™é‡Œæˆ‘ä»¬å°±é‡‡ç”¨å›¾è°±ä¸­åŸºäºå…³ç³»çš„ Jaccard ç›¸ä¼¼åº¦ç®—æ³•ã€‚</p>
<h5 id="jaccard-index" class="headerLink">
    <a href="#jaccard-index" class="header-mark"></a>1.2.2.1 Jaccard Index</h5><p><a href="https://en.wikipedia.org/wiki/Jaccard_index" target="_blank" rel="noopener noreferrer">Jaccard Index</a> æ˜¯ä¸€ä¸ªæè¿°ä¸¤ä¸ªé›†åˆè·ç¦»çš„å®šä¹‰å…¬å¼ï¼Œéå¸¸ç®€å•ã€ç¬¦åˆç›´è§‰åœ°å–ä¸¤è€…çš„äº¤é›†ä¸å¹¶é›†æµ‹åº¦çš„æ¯”ä¾‹ï¼Œå®ƒçš„å®šä¹‰è®°ä¸ºï¼š
$$
J(A,B)= \frac {|A\cap B|}{|A\cup B|}
$$
è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠäº¤é›†ç†è§£ä¸º A ä¸ B å…±åŒè¿æ¥çš„ç‚¹ï¼ˆæœ‰å…±åŒçš„å¯¼æ¼”ã€ç”µå½±ç±»å‹ã€æ¼”å‘˜ï¼‰ï¼Œå¹¶é›†ç†è§£ä¸ºè¿™å‡ ç§å…³ç³»ä¸‹ä¸ A æˆ–è€… B ç›´è¿çš„æ‰€æœ‰ç‚¹ï¼Œè€Œæµ‹åº¦å°±ç›´æ¥ç”¨æ•°é‡è¡¨ç¤ºã€‚</p>
<h5 id="cbf-æ–¹æ³•åœ¨-nebulagraph-ä¸­çš„å®ç°" class="headerLink">
    <a href="#cbf-%e6%96%b9%e6%b3%95%e5%9c%a8-nebulagraph-%e4%b8%ad%e7%9a%84%e5%ae%9e%e7%8e%b0" class="header-mark"></a>1.2.2.2 CBF æ–¹æ³•åœ¨ NebulaGraph ä¸­çš„å®ç°</h5><p>CBF æ–¹æ³•åˆ†å¦‚ä¸‹å‡ æ­¥ï¼š</p>
<ul>
<li>æ‰¾å‡ºæ¨èç”¨æˆ·è¯„åˆ†è¿‡çš„ç”µå½±</li>
<li>ä»ç”¨æˆ·è¯„åˆ†è¿‡çš„ç”µå½±ï¼Œç»ç”±å¯¼æ¼”å¡å¸ã€ç”µå½±ç±»å‹æ‰¾åˆ°æ–°çš„å¾…æ¨èç”µå½±</li>
<li>å¯¹çœ‹è¿‡çš„ç”µå½±ä¸æ–°çš„ç”µå½±ï¼Œè—‰ç”±å¯¼æ¼”ã€å¡å¸ã€ç”µå½±ç±»å‹çš„å…³ç³»ï¼Œåœ¨å›¾ä¸Šåš Jaccard ç›¸ä¼¼æ€§è¿ç®—ï¼Œå¾—å‡ºæ¯ä¸€å¯¹çœ‹è¿‡çš„ç”µå½±å’Œå¾…æ¨èæ–°ç”µå½±ä¹‹é—´çš„ Jaccard ç³»æ•°</li>
<li>æŠŠç”¨æˆ·å¯¹çœ‹è¿‡ç”µå½±çš„è¯„åˆ†ä½œä¸ºåŠ æƒç³»æ•°ï¼Œé’ˆå¯¹å…¶åˆ°æ¯ä¸€ä¸ªæ–°ç”µå½±ä¹‹é—´çš„ Jaccard ç³»æ•°åŠ æƒè¯„åˆ†ï¼Œè·å¾—æ’åºåçš„æ¨èç”µå½±åˆ—è¡¨</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">//</span><span class="w"> </span><span class="err">ç”¨æˆ·</span><span class="w"> </span><span class="n">u_124</span><span class="w"> </span><span class="err">çœ‹è¿‡çš„ç”µå½±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">æ ¹æ®ç”µå½±çš„æ ‡æ³¨å…³ç³»æ‰¾åˆ°å¤‡é€‰æ¨èç”µå½±ï¼Œåˆ¨é™¤çœ‹è¿‡çš„ï¼ŒæŠŠè¯„åˆ†ã€äº¤é›†å…³è”é“¾è·¯çš„æ•°é‡ä¼ ä¸‹å»</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">directed_by</span><span class="o">|</span><span class="n">acted_by</span><span class="o">|</span><span class="n">with_genre</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">directed_by</span><span class="o">|</span><span class="n">acted_by</span><span class="o">|</span><span class="n">with_genre</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">recomm</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">.</span><span class="mi">5</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">recomm</span><span class="p">,</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="nf">COLLECT</span><span class="p">(</span><span class="n">intersection</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">intersection_size</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">intersection_size</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—</span><span class="w"> </span><span class="n">Jaccard</span><span class="w"> </span><span class="k">index</span><span class="o">-----------------------------------------------</span><span class="c1">--
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">// é’ˆå¯¹æ¯ä¸€å¯¹ m å’Œ recommï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">//</span><span class="w"> </span><span class="err">å¼€å§‹è®¡ç®—çœ‹è¿‡çš„ç”µå½±ï¼Œé›†åˆ</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">çš„éƒ¨åˆ†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">directed_by</span><span class="o">|</span><span class="n">acted_by</span><span class="o">|</span><span class="n">with_genre</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="n">recomm</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="nf">COLLECT</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">intersection</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">set_a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—æ¨èç”µå½±ï¼Œé›†åˆ</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="err">çš„éƒ¨åˆ†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">directed_by</span><span class="o">|</span><span class="n">acted_by</span><span class="o">|</span><span class="n">with_genre</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">recomm</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">set_a</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="nf">COLLECT</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">intersection</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">set_b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å¾—åˆ°å¹¶é›†æ•°é‡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="nf">toFloat</span><span class="p">(</span><span class="n">intersection_size</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="nf">toSet</span><span class="p">(</span><span class="n">set_a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">set_b</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_U_B</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å¾—åˆ°æ¯ä¸€å¯¹</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="err">å’Œ</span><span class="w"> </span><span class="n">recomm</span><span class="w"> </span><span class="err">çš„</span><span class="w"> </span><span class="n">Jaccard</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A_N_B</span><span class="o">/</span><span class="n">A_U_B</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="o">/</span><span class="nf">size</span><span class="p">(</span><span class="n">A_U_B</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">jaccard_index</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—</span><span class="w"> </span><span class="n">Jaccard</span><span class="w"> </span><span class="k">index</span><span class="o">-----------------------------------------------</span><span class="c1">--
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¾—åˆ°æ¯ä¸€ä¸ªè¢«æ¨èçš„ç”µå½± recomm_idï¼Œç»ç”±ä¸åŒçœ‹è¿‡ç”µå½±æ¨èé“¾è·¯çš„ç›¸ä¼¼åº¦ = è¯„åˆ† * jaccard_index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">WITH</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">rate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jaccard_index</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å¯¹æ¯ä¸€ä¸ª</span><span class="w"> </span><span class="n">recomm_id</span><span class="w"> </span><span class="err">æŒ‰ç…§</span><span class="w"> </span><span class="n">m_id</span><span class="w"> </span><span class="err">åŠ æƒæ±‚å¾—ç›¸ä¼¼åº¦çš„å’Œï¼Œä¸ºæ€»çš„æ¨èç¨‹åº¦è¯„åˆ†ï¼Œé™åºæ’åˆ—</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¾¹æŸ¥è¯¢çš„æ‰§è¡Œç»“æœæˆªå–å‡ºæ¥æ˜¯ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">recomm_id</th>
<th style="text-align:left">sim_score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1891</td>
<td style="text-align:left">0.2705882352941177</td>
</tr>
<tr>
<td style="text-align:left">1892</td>
<td style="text-align:left">0.22278481012658227</td>
</tr>
<tr>
<td style="text-align:left">1894</td>
<td style="text-align:left">0.15555555555555556</td>
</tr>
<tr>
<td style="text-align:left">808</td>
<td style="text-align:left">0.144</td>
</tr>
<tr>
<td style="text-align:left">1895</td>
<td style="text-align:left">0.13999999999999999</td>
</tr>
<tr>
<td style="text-align:left">85</td>
<td style="text-align:left">0.12631578947368421</td>
</tr>
<tr>
<td style="text-align:left">348</td>
<td style="text-align:left">0.12413793103448277</td>
</tr>
<tr>
<td style="text-align:left">18746</td>
<td style="text-align:left">0.11666666666666668</td>
</tr>
<tr>
<td style="text-align:left">628</td>
<td style="text-align:left">0.11636363636363636</td>
</tr>
<tr>
<td style="text-align:left">3005</td>
<td style="text-align:left">0.10566037735849057</td>
</tr>
</tbody>
</table>
<h5 id="å¯è§†åŒ–åˆ†æ" class="headerLink">
    <a href="#%e5%8f%af%e8%a7%86%e5%8c%96%e5%88%86%e6%9e%90" class="header-mark"></a>1.2.2.3 å¯è§†åŒ–åˆ†æ</h5><p>æˆ‘ä»¬æŠŠæ•´ä¸ªè¿‡ç¨‹ä¸­çš„ä¸€äº›æ­¥éª¤çš„æŸ¥è¯¢ä¿®æ”¹ä¸€ä¸‹ä¸º <code>p=xxx</code> çš„æ–¹å¼ï¼Œå¹¶æ¸²æŸ“å‡ºæ¥ï¼Œä¼šæ›´åŠ æ–¹ä¾¿ç†è§£</p>
<ul>
<li>
<p>ç”¨æˆ· u_124 çœ‹è¿‡çš„ã€è¯„åˆ†è¿‡çš„ç”µå½±</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">//</span><span class="w"> </span><span class="err">ç”¨æˆ·</span><span class="w"> </span><span class="n">u_124</span><span class="w"> </span><span class="err">çœ‹è¿‡çš„ç”µå½±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="/recommendation-system-with-graphdb/CBF_step0.webp" title="CBF_step0" data-thumbnail="/recommendation-system-with-graphdb/CBF_step0.webp">
        <img
            
            loading="lazy"
            src="/recommendation-system-with-graphdb/CBF_step0.webp"
            srcset="/recommendation-system-with-graphdb/CBF_step0.webp, /recommendation-system-with-graphdb/CBF_step0.webp 1.5x, /recommendation-system-with-graphdb/CBF_step0.webp 2x"
            sizes="auto"
            alt="/recommendation-system-with-graphdb/CBF_step0.webp">
    </a></figure></p>
</li>
<li>
<p>ä¸‹ä¸€æ­¥æ‰¾åˆ°è¿™äº›çœ‹è¿‡çš„ç”µå½±åœ¨ç›¸åŒçš„æ¼”å‘˜ã€å¯¼æ¼”ã€ç”µå½±ç±»å‹çš„å…³ç³»ä¸Šï¼Œå›¾è°±å…³è”çš„æ‰€æœ‰å…¶ä»–ç”µå½±</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">//</span><span class="w"> </span><span class="err">ç”¨æˆ·</span><span class="w"> </span><span class="n">u_124</span><span class="w"> </span><span class="err">çœ‹è¿‡çš„ç”µå½±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">æ ¹æ®ç”µå½±çš„æ ‡æ³¨å…³ç³»æ‰¾åˆ°å¤‡é€‰æ¨èç”µå½±ï¼Œåˆ¨é™¤çœ‹è¿‡çš„ï¼ŒæŠŠè¯„åˆ†ã€äº¤é›†å…³è”é“¾è·¯çš„æ•°é‡ä¼ ä¸‹å»</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">directed_by</span><span class="o">|</span><span class="n">acted_by</span><span class="o">|</span><span class="n">with_genre</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">directed_by</span><span class="o">|</span><span class="n">acted_by</span><span class="o">|</span><span class="n">with_genre</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">recomm</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="nf">COLLECT</span><span class="p">(</span><span class="n">intersection</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">intersection_size</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">intersection_size</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">500</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ç”¨æˆ·çœ‹è¿‡ç”µå½±ç»ç”±æ¼”å‘˜ã€ç±»å‹æ‰©æ•£å‡ºå¥½å¤šæ–°çš„ç”µå½±</p>
<p><figure><a class="lightgallery" href="/recommendation-system-with-graphdb/CBF_step1.webp" title="CBF_step1" data-thumbnail="/recommendation-system-with-graphdb/CBF_step1.webp">
        <img
            
            loading="lazy"
            src="/recommendation-system-with-graphdb/CBF_step1.webp"
            srcset="/recommendation-system-with-graphdb/CBF_step1.webp, /recommendation-system-with-graphdb/CBF_step1.webp 1.5x, /recommendation-system-with-graphdb/CBF_step1.webp 2x"
            sizes="auto"
            alt="/recommendation-system-with-graphdb/CBF_step1.webp">
    </a></figure></p>
</li>
<li>
<p>åœ¨å¾—åˆ°è¿™äº›å¾…æ¨èç”µå½±ä»¥åŠæ¨èè·¯å¾„ä¹‹åï¼Œé€šè¿‡ Jaccard ç³»æ•°ä¸ç”¨æˆ·åœ¨è·¯å¾„ç¬¬ä¸€æ¡è¾¹ä¸Šçš„è¯„åˆ†ç»¼åˆè¯„å®šä¹‹åï¼Œå¾—åˆ°äº†æœ€ç»ˆçš„ç»“æœï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠç»“æœå†å¯è§†åŒ–ä¸€ä¸‹ï¼šå–å¾—å®ƒä»¬å’Œç”¨æˆ·ä¹‹é—´çš„è·¯å¾„å¹¶æ¸²æŸ“å‡ºæ¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">//</span><span class="w"> </span><span class="err">ç”¨æˆ·</span><span class="w"> </span><span class="n">u_124</span><span class="w"> </span><span class="err">çœ‹è¿‡çš„ç”µå½±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">æ ¹æ®ç”µå½±çš„æ ‡æ³¨å…³ç³»æ‰¾åˆ°å¤‡é€‰æ¨èç”µå½±ï¼Œåˆ¨é™¤çœ‹è¿‡çš„ï¼ŒæŠŠè¯„åˆ†ã€äº¤é›†å…³è”é“¾è·¯çš„æ•°é‡ä¼ ä¸‹å»</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">directed_by</span><span class="o">|</span><span class="n">acted_by</span><span class="o">|</span><span class="n">with_genre</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">directed_by</span><span class="o">|</span><span class="n">acted_by</span><span class="o">|</span><span class="n">with_genre</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">recomm</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">.</span><span class="mi">5</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">recomm</span><span class="p">,</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="nf">COLLECT</span><span class="p">(</span><span class="n">intersection</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">intersection_size</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">intersection_size</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—</span><span class="w"> </span><span class="n">Jaccard</span><span class="w"> </span><span class="k">index</span><span class="o">-----------------------------------------------</span><span class="c1">--
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">// é’ˆå¯¹æ¯ä¸€å¯¹ m å’Œ recommï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">//</span><span class="w"> </span><span class="err">å¼€å§‹è®¡ç®—çœ‹è¿‡çš„ç”µå½±ï¼Œé›†åˆ</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">çš„éƒ¨åˆ†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">directed_by</span><span class="o">|</span><span class="n">acted_by</span><span class="o">|</span><span class="n">with_genre</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="n">recomm</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="nf">COLLECT</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">intersection</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">set_a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—æ¨èç”µå½±ï¼Œé›†åˆ</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="err">çš„éƒ¨åˆ†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">directed_by</span><span class="o">|</span><span class="n">acted_by</span><span class="o">|</span><span class="n">with_genre</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">recomm</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">set_a</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="nf">COLLECT</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">intersection</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">set_b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å¾—åˆ°å¹¶é›†æ•°é‡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="nf">toFloat</span><span class="p">(</span><span class="n">intersection_size</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="nf">toSet</span><span class="p">(</span><span class="n">set_a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">set_b</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_U_B</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å¾—åˆ°æ¯ä¸€å¯¹</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="err">å’Œ</span><span class="w"> </span><span class="n">recomm</span><span class="w"> </span><span class="err">çš„</span><span class="w"> </span><span class="n">Jaccard</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A_N_B</span><span class="o">/</span><span class="n">A_U_B</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="o">/</span><span class="nf">size</span><span class="p">(</span><span class="n">A_U_B</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">jaccard_index</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—</span><span class="w"> </span><span class="n">Jaccard</span><span class="w"> </span><span class="k">index</span><span class="o">-----------------------------------------------</span><span class="c1">--
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¾—åˆ°æ¯ä¸€ä¸ªè¢«æ¨èçš„ç”µå½± recomm_idï¼Œç»ç”±ä¸åŒçœ‹è¿‡ç”µå½±æ¨èé“¾è·¯çš„ç›¸ä¼¼åº¦ = è¯„åˆ† * jaccard_index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">WITH</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">rate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jaccard_index</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å¯¹æ¯ä¸€ä¸ª</span><span class="w"> </span><span class="n">recomm_id</span><span class="w"> </span><span class="err">æŒ‰ç…§</span><span class="w"> </span><span class="n">m_id</span><span class="w"> </span><span class="err">åŠ æƒæ±‚å¾—ç›¸ä¼¼åº¦çš„å’Œï¼Œä¸ºæ€»çš„æ¨èç¨‹åº¦è¯„åˆ†ï¼Œé™åºæ’åˆ—</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="nf">COLLECT</span><span class="p">(</span><span class="n">recomm_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recomm_ids</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">directed_by</span><span class="o">|</span><span class="n">acted_by</span><span class="o">|</span><span class="n">with_genre</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">directed_by</span><span class="o">|</span><span class="n">acted_by</span><span class="o">|</span><span class="n">with_genre</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">recomm</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">recomm_ids</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å“‡ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ™°åœ°çœ‹åˆ°æ¨èçš„ç†ç”±è·¯å¾„ï¼ˆå–œæ¬¢æ˜Ÿæˆ˜ï¼Œè¿›è€Œç”±å¤šæ¡å…±åŒçš„ç±»å‹ã€æ¼”å‘˜ã€å¯¼æ¼”å¼•å¯¼å‡ºæœªè§‚çœ‹çš„å‡ éƒ¨æ˜Ÿæˆ˜ç”µå½±ï¼‰ï¼Œè¿™å…¶å®å°±æ˜¯ CBF çš„ä¼˜åŠ¿ä¹‹ä¸€ï¼šå¤©ç„¶å…·æœ‰è¾ƒå¥½çš„å¯è§£é‡Šæ€§ã€‚</p>
<p><figure><a class="lightgallery" href="/recommendation-system-with-graphdb/CBF_step2.webp" title="CBF_step2" data-thumbnail="/recommendation-system-with-graphdb/CBF_step2.webp">
        <img
            
            loading="lazy"
            src="/recommendation-system-with-graphdb/CBF_step2.webp"
            srcset="/recommendation-system-with-graphdb/CBF_step2.webp, /recommendation-system-with-graphdb/CBF_step2.webp 1.5x, /recommendation-system-with-graphdb/CBF_step2.webp 2x"
            sizes="auto"
            alt="/recommendation-system-with-graphdb/CBF_step2.webp">
    </a></figure></p>
</li>
</ul>
<h4 id="åŸºäºè®°å¿†çš„ååŒè¿‡æ»¤" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e8%ae%b0%e5%bf%86%e7%9a%84%e5%8d%8f%e5%90%8c%e8%bf%87%e6%bb%a4" class="header-mark"></a>1.2.3 åŸºäºè®°å¿†çš„ååŒè¿‡æ»¤</h4><p>å‰è¾¹æˆ‘ä»¬æè¿‡äº†ï¼ŒååŒè¿‡æ»¤ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li>User-User CF æ˜¯åŸºäºå¤šä¸ªç”¨æˆ·å¯¹ç‰©ä»¶çš„å†å²è¡Œä¸ºï¼Œåˆ¤å®šç”¨æˆ·ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œç„¶åæ ¹æ®ç›¸ä¼¼ç”¨æˆ·çš„é€‰æ‹©æ¨èæ–°çš„ç‰©ä»¶ã€‚</li>
<li>Item-Item CF åˆ™æ˜¯åˆ¤æ–­ç‰©ä»¶ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œç»™ç”¨æˆ·æ¨èä»–å–œæ¬¢çš„ç‰©å“ç›¸ä¼¼çš„ç‰©å“ã€‚</li>
</ul>
<p>è¿™é‡Œï¼ŒItemCF çœ‹èµ·æ¥å’Œå‰è¾¹çš„ CBF æœ‰äº›ç±»ä¼¼ï¼Œä»–ä»¬çš„æ ¸å¿ƒåŒºåˆ«åœ¨äº CBF æ‰¾åˆ°ç›¸ä¼¼ç‰©ä»¶çš„æ–¹å¼æ˜¯åŸºäºç‰©ä»¶çš„â€œå†…å®¹â€æœ¬èº«ï¼Œæ˜¯ä¸€äº›é¢†åŸŸçŸ¥è¯†çš„ç”»åƒï¼Œè€Œ ItemCF çš„ååŒåˆ™æ˜¯è€ƒè™‘ç”¨æˆ·å¯¹ç‰©ä»¶çš„å†å²è¡Œä¸ºã€‚</p>
<h5 id="itemcf" class="headerLink">
    <a href="#itemcf" class="header-mark"></a>1.2.3.1 ItemCF</h5><p>è¿™ä¸ªæ–¹æ³•åˆ†å¦‚ä¸‹å‡ æ­¥ï¼š</p>
<ul>
<li>æ‰¾å‡ºæ¨èç”¨æˆ·è¯„åˆ†è¿‡çš„ç”µå½±</li>
<li>ç»ç”±ç”¨æˆ·çš„é«˜è¯„åˆ†ç”µå½±ï¼Œæ‰¾åˆ°å…¶ä»–ç»™å‡ºé«˜è¯„åˆ†ç”¨æˆ·æ‰€çœ‹è¿‡çš„æ–°çš„é«˜è¯„åˆ†ç”µå½±</li>
<li>å¯¹çœ‹è¿‡çš„ç”µå½±ä¸æ–°çš„ç”µå½±ï¼Œè—‰ç”±ç”¨æˆ·çš„è¯„åˆ†ï¼Œåœ¨å›¾ä¸Šåš Jaccard ç›¸ä¼¼æ€§è¿ç®—ï¼Œå¾—å‡ºæ¯ä¸€å¯¹çœ‹è¿‡çš„ç”µå½±å’Œå¾…æ¨èæ–°ç”µå½±ä¹‹é—´çš„ Jaccard ç³»æ•°</li>
<li>æŠŠç”¨æˆ·å¯¹çœ‹è¿‡ç”µå½±çš„è¯„åˆ†ä½œä¸ºåŠ æƒç³»æ•°ï¼Œé’ˆå¯¹å…¶åˆ°æ¯ä¸€ä¸ªæ–°ç”µå½±ä¹‹é—´çš„ Jaccard ç³»æ•°åŠ æƒè¯„åˆ†ï¼Œè·å¾—æ’åºåçš„æ¨èç”µå½±åˆ—è¡¨</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">//</span><span class="w"> </span><span class="err">ç”¨æˆ·</span><span class="w"> </span><span class="n">u_124</span><span class="w"> </span><span class="err">çœ‹è¿‡çš„å¹¶ç»™å‡ºé«˜è¯„åˆ†çš„ç”µå½±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">æ ¹æ®åŒæ ·ä¹Ÿçœ‹è¿‡è¿™äº›ç”µå½±ï¼Œå¹¶ç»™å‡ºé«˜è¯„åˆ†çš„ç”¨æˆ·ï¼Œå¾—å‡ºå¾…æ¨èçš„ç”µå½±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="n">e0</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">intersection</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">recomm</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">e0</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">3</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">.</span><span class="mi">5</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">recomm</span><span class="p">,</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="nf">COLLECT</span><span class="p">(</span><span class="n">intersection</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">intersection_size</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">intersection_size</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—</span><span class="w"> </span><span class="n">Jaccard</span><span class="w"> </span><span class="k">index</span><span class="o">-----------------------------------------------</span><span class="c1">--
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">// é’ˆå¯¹æ¯ä¸€å¯¹ m å’Œ recommï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">//</span><span class="w"> </span><span class="err">å¼€å§‹è®¡ç®—çœ‹è¿‡çš„ç”µå½±ï¼Œé›†åˆ</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">çš„éƒ¨åˆ†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="n">e0</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">intersection</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">e0</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="n">recomm</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="nf">COLLECT</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">intersection</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">set_a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—æ¨èç”µå½±ï¼Œé›†åˆ</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="err">çš„éƒ¨åˆ†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">intersection</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">recomm</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">set_a</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="nf">COLLECT</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">intersection</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">set_b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å¾—åˆ°å¹¶é›†æ•°é‡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="nf">toFloat</span><span class="p">(</span><span class="n">intersection_size</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="nf">toSet</span><span class="p">(</span><span class="n">set_a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">set_b</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_U_B</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å¾—åˆ°æ¯ä¸€å¯¹</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="err">å’Œ</span><span class="w"> </span><span class="n">recomm</span><span class="w"> </span><span class="err">çš„</span><span class="w"> </span><span class="n">Jaccard</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A_N_B</span><span class="o">/</span><span class="n">A_U_B</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="o">/</span><span class="nf">size</span><span class="p">(</span><span class="n">A_U_B</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">jaccard_index</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—</span><span class="w"> </span><span class="n">Jaccard</span><span class="w"> </span><span class="k">index</span><span class="o">-----------------------------------------------</span><span class="c1">--
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¾—åˆ°æ¯ä¸€ä¸ªè¢«æ¨èçš„ç”µå½± recomm_idï¼Œç»ç”±ä¸åŒçœ‹è¿‡ç”µå½±æ¨èé“¾è·¯çš„ç›¸ä¼¼åº¦ = è¯„åˆ† * jaccard_index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">WITH</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">rate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jaccard_index</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å¯¹æ¯ä¸€ä¸ª</span><span class="w"> </span><span class="n">recomm_id</span><span class="w"> </span><span class="err">æŒ‰ç…§</span><span class="w"> </span><span class="n">m_id</span><span class="w"> </span><span class="err">åŠ æƒæ±‚å¾—ç›¸ä¼¼åº¦çš„å’Œï¼Œä¸ºæ€»çš„æ¨èç¨‹åº¦è¯„åˆ†ï¼Œé™åºæ’åˆ—ï¼Œåªå–æ­£å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">recomm_id</th>
<th style="text-align:left">sim_score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">832</td>
<td style="text-align:left">0.8428369424692955</td>
</tr>
<tr>
<td style="text-align:left">114707</td>
<td style="text-align:left">0.7913842214590154</td>
</tr>
<tr>
<td style="text-align:left">64957</td>
<td style="text-align:left">0.6924673321504288</td>
</tr>
<tr>
<td style="text-align:left">120880</td>
<td style="text-align:left">0.5775219768736295</td>
</tr>
<tr>
<td style="text-align:left">807</td>
<td style="text-align:left">0.497532028328161</td>
</tr>
<tr>
<td style="text-align:left">473</td>
<td style="text-align:left">0.4748322300870322</td>
</tr>
<tr>
<td style="text-align:left">52797</td>
<td style="text-align:left">0.2311965559170528</td>
</tr>
<tr>
<td style="text-align:left">12768</td>
<td style="text-align:left">0.19642857142857142</td>
</tr>
<tr>
<td style="text-align:left">167058</td>
<td style="text-align:left">0.19642857142857142</td>
</tr>
</tbody>
</table>
<h5 id="å¯è§†åŒ–åˆ†æ-itemcf" class="headerLink">
    <a href="#%e5%8f%af%e8%a7%86%e5%8c%96%e5%88%86%e6%9e%90-itemcf" class="header-mark"></a>1.2.3.2 å¯è§†åŒ–åˆ†æ ItemCF</h5><p>åŒæ ·ï¼Œæˆ‘ä»¬æŠŠæ•´ä¸ªè¿‡ç¨‹ä¸­çš„ä¸€äº›æ­¥éª¤çš„æŸ¥è¯¢ä¿®æ”¹ä¸€ä¸‹ä¸º <code>p=xxx</code> çš„æ–¹å¼ï¼Œå¹¶æ¸²æŸ“å‡ºæ¥ï¼Œçœ‹çœ‹å¯ä»¥çœ‹å‡ºä»€ä¹ˆæœ‰æ„æ€çš„çš„æ´å¯Ÿã€‚</p>
<ul>
<li>
<p>æ‰¾å‡ºæ¨èç”¨æˆ·è¯„åˆ†è¿‡çš„ç”µå½±</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">//</span><span class="w"> </span><span class="err">ç”¨æˆ·</span><span class="w"> </span><span class="n">u_124</span><span class="w"> </span><span class="err">çœ‹è¿‡çš„å¹¶ç»™å‡ºé«˜è¯„åˆ†çš„ç”µå½±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒä»¬æ˜¯ï¼š</p>
<p><figure><a class="lightgallery" href="/recommendation-system-with-graphdb/ItemCF_step0.webp" title="ItemCF_step0" data-thumbnail="/recommendation-system-with-graphdb/ItemCF_step0.webp">
        <img
            
            loading="lazy"
            src="/recommendation-system-with-graphdb/ItemCF_step0.webp"
            srcset="/recommendation-system-with-graphdb/ItemCF_step0.webp, /recommendation-system-with-graphdb/ItemCF_step0.webp 1.5x, /recommendation-system-with-graphdb/ItemCF_step0.webp 2x"
            sizes="auto"
            alt="/recommendation-system-with-graphdb/ItemCF_step0.webp">
    </a></figure></p>
</li>
<li>
<p>ç»ç”±ç”¨æˆ·çš„é«˜è¯„åˆ†ç”µå½±ï¼Œæ‰¾åˆ°å…¶ä»–ç»™å‡ºé«˜è¯„åˆ†ç”¨æˆ·æ‰€çœ‹è¿‡çš„æ–°çš„é«˜è¯„åˆ†ç”µå½±ï¼Œä¿®æ”¹ç»“æœä¸ºè·¯å¾„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">//</span><span class="w"> </span><span class="err">ç”¨æˆ·</span><span class="w"> </span><span class="n">u_124</span><span class="w"> </span><span class="err">çœ‹è¿‡çš„å¹¶ç»™å‡ºé«˜è¯„åˆ†çš„ç”µå½±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">æ ¹æ®åŒæ ·ä¹Ÿçœ‹è¿‡è¿™äº›ç”µå½±ï¼Œå¹¶ç»™å‡ºé«˜è¯„åˆ†çš„ç”¨æˆ·ï¼Œå¾—å‡ºå¾…æ¨èçš„ç”µå½±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="n">e0</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">intersection</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">recomm</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">e0</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">3</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="nf">COLLECT</span><span class="p">(</span><span class="n">intersection</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">intersection_size</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">intersection_size</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">200</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°å¾…æ¨èçš„ç”µå½±åœ¨è·¯å¾„çš„å³è¾¹æœ«ç«¯ï¼Œä¸­é—´è¿æ¥ç€çš„éƒ½æ˜¯å…¶ä»–ç”¨æˆ·çš„æ¨èè®°å½•ï¼Œå®ƒçš„æ¨¡å¼å’Œ CBF çœŸçš„å¾ˆåƒï¼Œåªä¸è¿‡å…³è”çš„å…³ç³»ä¸æ˜¯å…·ä½“çš„å†…å®¹ï¼Œè€Œæ˜¯è¡Œä¸ºã€‚</p>
<p><figure><a class="lightgallery" href="/recommendation-system-with-graphdb/ItemCF_step1.webp" title="ItemCF_step1" data-thumbnail="/recommendation-system-with-graphdb/ItemCF_step1.webp">
        <img
            
            loading="lazy"
            src="/recommendation-system-with-graphdb/ItemCF_step1.webp"
            srcset="/recommendation-system-with-graphdb/ItemCF_step1.webp, /recommendation-system-with-graphdb/ItemCF_step1.webp 1.5x, /recommendation-system-with-graphdb/ItemCF_step1.webp 2x"
            sizes="auto"
            alt="/recommendation-system-with-graphdb/ItemCF_step1.webp">
    </a></figure></p>
</li>
<li>
<p>åœ¨å¯¹çœ‹è¿‡çš„ç”µå½±ä¸æ–°çš„ç”µå½±ï¼Œè—‰ç”±ç”¨æˆ·çš„è¯„åˆ†ï¼Œåœ¨å›¾ä¸Šåš Jaccard ç›¸ä¼¼æ€§è¿ç®—ï¼Œå¾—å‡ºæ¯ä¸€å¯¹çœ‹è¿‡çš„ç”µå½±å’Œå¾…æ¨èæ–°ç”µå½±ä¹‹é—´çš„ Jaccard ç³»æ•°ä¹‹åã€‚æŠŠç”¨æˆ·å¯¹çœ‹è¿‡ç”µå½±çš„è¯„åˆ†ä½œä¸ºåŠ æƒç³»æ•°ï¼Œé’ˆå¯¹å…¶åˆ°æ¯ä¸€ä¸ªæ–°ç”µå½±ä¹‹é—´çš„ Jaccard ç³»æ•°åŠ æƒè¯„åˆ†ï¼Œè·å¾—æ’åºåçš„æ¨èç”µå½±åˆ—è¡¨ï¼Œæˆ‘ä»¬åŒæ ·æ”¹é€ ä¸€ä¸‹æœ€ç»ˆçš„æŸ¥è¯¢ä¸ºè·¯å¾„ï¼Œå¹¶æ¸²æŸ“å‰ 500 æ¡è·¯å¾„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">//</span><span class="w"> </span><span class="err">ç”¨æˆ·</span><span class="w"> </span><span class="n">u_124</span><span class="w"> </span><span class="err">çœ‹è¿‡çš„å¹¶ç»™å‡ºé«˜è¯„åˆ†çš„ç”µå½±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">æ ¹æ®åŒæ ·ä¹Ÿçœ‹è¿‡è¿™äº›ç”µå½±ï¼Œå¹¶ç»™å‡ºé«˜è¯„åˆ†çš„ç”¨æˆ·ï¼Œå¾—å‡ºå¾…æ¨èçš„ç”µå½±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="n">e0</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">intersection</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">recomm</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">e0</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">3</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">.</span><span class="mi">5</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">recomm</span><span class="p">,</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="nf">COLLECT</span><span class="p">(</span><span class="n">intersection</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">intersection_size</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">intersection_size</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—</span><span class="w"> </span><span class="n">Jaccard</span><span class="w"> </span><span class="k">index</span><span class="o">-----------------------------------------------</span><span class="c1">--
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">// é’ˆå¯¹æ¯ä¸€å¯¹ m å’Œ recommï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">//</span><span class="w"> </span><span class="err">å¼€å§‹è®¡ç®—çœ‹è¿‡çš„ç”µå½±ï¼Œé›†åˆ</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">çš„éƒ¨åˆ†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="n">e0</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">intersection</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">e0</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="n">recomm</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="nf">COLLECT</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">intersection</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">set_a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—æ¨èç”µå½±ï¼Œé›†åˆ</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="err">çš„éƒ¨åˆ†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">intersection</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">recomm</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">set_a</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="nf">COLLECT</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">intersection</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">set_b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å¾—åˆ°å¹¶é›†æ•°é‡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="nf">toFloat</span><span class="p">(</span><span class="n">intersection_size</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="nf">toSet</span><span class="p">(</span><span class="n">set_a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">set_b</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_U_B</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å¾—åˆ°æ¯ä¸€å¯¹</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="err">å’Œ</span><span class="w"> </span><span class="n">recomm</span><span class="w"> </span><span class="err">çš„</span><span class="w"> </span><span class="n">Jaccard</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A_N_B</span><span class="o">/</span><span class="n">A_U_B</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="o">/</span><span class="nf">size</span><span class="p">(</span><span class="n">A_U_B</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">jaccard_index</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—</span><span class="w"> </span><span class="n">Jaccard</span><span class="w"> </span><span class="k">index</span><span class="o">-----------------------------------------------</span><span class="c1">--
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¾—åˆ°æ¯ä¸€ä¸ªè¢«æ¨èçš„ç”µå½± recomm_idï¼Œç»ç”±ä¸åŒçœ‹è¿‡ç”µå½±æ¨èé“¾è·¯çš„ç›¸ä¼¼åº¦ = è¯„åˆ† * jaccard_index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">WITH</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">rate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jaccard_index</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å¯¹æ¯ä¸€ä¸ª</span><span class="w"> </span><span class="n">recomm_id</span><span class="w"> </span><span class="err">æŒ‰ç…§</span><span class="w"> </span><span class="n">m_id</span><span class="w"> </span><span class="err">åŠ æƒæ±‚å¾—ç›¸ä¼¼åº¦çš„å’Œï¼Œä¸ºæ€»çš„æ¨èç¨‹åº¦è¯„åˆ†ï¼Œé™åºæ’åˆ—ï¼Œåªå–æ­£å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">recomm_id</span><span class="p">,</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">recomm_id</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="nf">COLLECT</span><span class="p">(</span><span class="n">recomm_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recomm_ids</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="n">e0</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">intersection</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">recomm</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">recomm_ids</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">500</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹å‡ºæœ€åŒ—æ¨èçš„ä¸¤ä¸ªç”µå½±æ˜¯è¢«å‡ ä¹æ‰€æœ‰çœ‹è¿‡å¹¶ç»™å‡ºä¸­é«˜è¯„åˆ†çš„ç”¨æˆ·å…±åŒçœ‹è¿‡çš„ä¸­é«˜è¯„åˆ†ç”µå½±</p>
<p><figure><a class="lightgallery" href="/recommendation-system-with-graphdb/ItemCF_step2.webp" title="ItemCF_step2" data-thumbnail="/recommendation-system-with-graphdb/ItemCF_step2.webp">
        <img
            
            loading="lazy"
            src="/recommendation-system-with-graphdb/ItemCF_step2.webp"
            srcset="/recommendation-system-with-graphdb/ItemCF_step2.webp, /recommendation-system-with-graphdb/ItemCF_step2.webp 1.5x, /recommendation-system-with-graphdb/ItemCF_step2.webp 2x"
            sizes="auto"
            alt="/recommendation-system-with-graphdb/ItemCF_step2.webp">
    </a></figure></p>
</li>
</ul>
<h5 id="å…³äºé«˜è¯„åˆ†" class="headerLink">
    <a href="#%e5%85%b3%e4%ba%8e%e9%ab%98%e8%af%84%e5%88%86" class="header-mark"></a>1.2.3.3 å…³äºâ€é«˜è¯„åˆ†â€œ</h5><p>è¿™å…¶ä¸­è¿˜æœ‰å¾ˆå¤šå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–çš„ç‚¹ï¼Œæ¯”å¦‚å…¶ä¸­å†™æ­»äº†â€œé«˜è¯„åˆ†â€æ˜¯é«˜äº 3 çš„è¯„åˆ†ï¼Œè¿™æ ·æœ‰æ—¶å€™ä¸å…æœ‰å¤±å®¢è§‚ï¼Œä¸€ä¸ªå¯èƒ½æ›´åˆç†å¯è¡Œçš„æ–¹å¼æ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªç”¨æˆ·ï¼Œå–å¾—è¿™ä¸ªç”¨æˆ·æ‰€æœ‰è¯„åˆ†çš„å¹³å‡å€¼ï¼Œç„¶åå–å¾—ä¸å¹³å‡å€¼ç›¸å·®çš„æ¯”ä¾‹æˆ–è€…ç»å¯¹å€¼åˆ¤å®šé«˜ä½ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬åœ¨é€šè¿‡ Jaccard ç›¸ä¼¼æ€§åˆ¤æ–­æ¯ä¸€ä¸ªçœ‹è¿‡çš„ç”µå½±å’Œå¯¹åº”æ¨èç”µå½±çš„ç›¸ä¼¼æ€§çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘è¿™æ¡å…³è”å…³ç³»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="n">e0</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">intersection</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹‹ä¸­ e0 ä¸ e1 çš„è¯„åˆ†æ•°å€¼çš„å› ç´ ï¼Œåªæ˜¯è¿‡æ»¤äº†ä½è¯„åˆ†çš„å…³ç³»ï¼Œè¿™é‡Œä¹Ÿæœ‰åšçš„æ›´åŠ ç»†è‡´çš„æå‡ç©ºé—´ã€‚</p>
<p>å®é™…ä¸Šï¼Œ Pearson Correlation Coefficient å°±æ˜¯è¿™æ ·ä¸€ç§è€ƒè™‘äº†å…³ç³»ä¸­çš„æ•°å€¼è¿›è¡Œç›¸ä¼¼æ€§è¿ç®—çš„æ–¹æ³•ã€‚</p>
<h5 id="pearson-correlation-coefficient" class="headerLink">
    <a href="#pearson-correlation-coefficient" class="header-mark"></a>1.2.3.4 Pearson Correlation Coefficient</h5><p><a href="https://en.wikipedia.org/wiki/Pearson_correlation_coefficient" target="_blank" rel="noopener noreferrer">Pearson Correlation Coefficient</a> ï¼ˆPCCï¼‰çš„å®šä¹‰ä¸ºï¼š
$$
r_{xy} =\frac{\sum ^n _{i=1}(x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum ^n _{i=1}(x_i - \bar{x})^2} \sqrt{\sum ^n _{i=1}(y_i - \bar{y})^2}}
$$
ç›¸æ¯” Jaccard Indexï¼Œå®ƒæŠŠå¯¹è±¡ä¹‹é—´å…³ç³»ä¸­çš„æ•°å€¼ä¸è‡ªèº«å’Œæ‰€æœ‰å¯¹è±¡çš„æ•°å€¼çš„å¹³å‡å€¼çš„å·®è¿›è¡Œç´¯åŠ è¿ç®—ï¼Œåœ¨è€ƒè™‘äº†æ•°å€¼æ¯”é‡çš„åŒäº‹è€ƒè™‘äº†æ•°å€¼åŸºäºå¯¹è±¡è‡ªèº«çš„ç›¸å¯¹å·®å¼‚ã€‚</p>
<h5 id="usercf" class="headerLink">
    <a href="#usercf" class="header-mark"></a>1.2.3.5 UserCF</h5><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±åˆ©ç”¨ Pearson Correlation Coefficient æ¥ä¸¾ä¾‹ UserCF æ–¹æ³•ã€‚</p>
<p>åŸºäºç”¨æˆ·çš„ååŒè¿‡æ»¤æ–¹æ³•åˆ†å¦‚ä¸‹å‡ æ­¥ï¼š</p>
<ul>
<li>æ‰¾å‡ºå’Œæ¨èç”¨æˆ·åŒæ ·ç»™å‡ºè¯„åˆ†è¿‡çš„ç”µå½±çš„ç”¨æˆ·</li>
<li>è¿ç®— Pearson Correlation Coefficient å¾—åˆ°å’Œæ¨èç”¨æˆ·å…´è¶£æ¥è¿‘çš„ç”¨æˆ·</li>
<li>é€šè¿‡å…´è¶£æ¥è¿‘ç”¨æˆ·å¾—åˆ°é«˜è¯„åˆ†æœªè§‚çœ‹ç”µå½±</li>
<li>æ ¹æ®è§‚çœ‹ç”¨æˆ·çš„ Pearson Correlation Coefficient åŠ æƒï¼Œæ’åºå¾—æ¨èç”µå½±åˆ—è¡¨</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">//</span><span class="w"> </span><span class="err">æ‰¾å‡ºå’Œç”¨æˆ·</span><span class="w"> </span><span class="n">u_2</span><span class="w"> </span><span class="err">çœ‹è¿‡ç›¸åŒç”µå½±çš„ç”¨æˆ·</span><span class="p">,</span><span class="w"> </span><span class="err">å¾—ç”µå½±è¯„åˆ†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e0</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">u_sim</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_2&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u_sim</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">&#34;u_2&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="p">,</span><span class="w"> </span><span class="nf">COLLECT</span><span class="p">(</span><span class="err">{</span><span class="n">e0</span><span class="p">:</span><span class="w"> </span><span class="n">e0</span><span class="p">,</span><span class="w"> </span><span class="n">e1</span><span class="p">:</span><span class="w"> </span><span class="n">e1</span><span class="err">}</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—</span><span class="w"> </span><span class="n">u_2</span><span class="w"> </span><span class="err">å’Œè¿™äº›ç”¨æˆ·çš„</span><span class="w"> </span><span class="n">pearson_cc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e0</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="p">,</span><span class="w"> </span><span class="nf">avg</span><span class="p">(</span><span class="n">e0</span><span class="p">.</span><span class="n">rate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u_mean</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u_sim</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="p">,</span><span class="w"> </span><span class="n">u_mean</span><span class="p">,</span><span class="w"> </span><span class="nf">avg</span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u_sim_mean</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e_</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">UNWIND</span><span class="w"> </span><span class="n">e_</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="nf">sum</span><span class="p">((</span><span class="n">e</span><span class="p">.</span><span class="n">e0</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_mean</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_sim_mean</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">numerator</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="nf">pow</span><span class="p">((</span><span class="n">e</span><span class="p">.</span><span class="n">e0</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_mean</span><span class="p">),</span><span class="mi">2</span><span class="p">)))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="nf">pow</span><span class="p">((</span><span class="n">e</span><span class="p">.</span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_sim_mean</span><span class="p">),</span><span class="mi">2</span><span class="p">)))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">denominator</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">denominator</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å–</span><span class="w"> </span><span class="n">pearson_cc</span><span class="w"> </span><span class="err">æœ€å¤§çš„</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="err">ä¸ªç›¸ä¼¼ç”¨æˆ·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="p">,</span><span class="w"> </span><span class="n">numerator</span><span class="o">/</span><span class="n">denominator</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">pearson_cc</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">pearson_cc</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å–ç›¸ä¼¼ç”¨æˆ·ç»™å‡ºé«˜è¯„åˆ†çš„æ–°ç”µå½±ï¼Œæ ¹æ®ç›¸ä¼¼ç”¨æˆ·ä¸ªæ•°å¯¹ç”¨æˆ·ç›¸ä¼¼ç¨‹åº¦</span><span class="w"> </span><span class="n">pearson_cc</span><span class="w"> </span><span class="err">åŠ æƒï¼Œè·å¾—æ¨èåˆ—è¡¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u_sim</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">recomm</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">recomm</span><span class="p">,</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">pearson_cc</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">recomm</th>
<th style="text-align:left">sim_score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">(&ldquo;64957&rdquo; :movie{name: &ldquo;Mother&rdquo;})</td>
<td style="text-align:left">14</td>
</tr>
<tr>
<td style="text-align:left">(&ldquo;10&rdquo; :movie{name: &ldquo;Star Wars&rdquo;})</td>
<td style="text-align:left">13</td>
</tr>
<tr>
<td style="text-align:left">(&ldquo;11&rdquo; :movie{name: &ldquo;Star Wars: A New Hope&rdquo;})</td>
<td style="text-align:left">13</td>
</tr>
<tr>
<td style="text-align:left">(&ldquo;55207&rdquo; :movie{name: &ldquo;Silence&rdquo;})</td>
<td style="text-align:left">12</td>
</tr>
<tr>
<td style="text-align:left">(&ldquo;170339&rdquo; :movie{name: &ldquo;Silence&rdquo;})</td>
<td style="text-align:left">12</td>
</tr>
<tr>
<td style="text-align:left">(&ldquo;9807&rdquo; :movie{name: &ldquo;Aladdin&rdquo;})</td>
<td style="text-align:left">8</td>
</tr>
<tr>
<td style="text-align:left">(&ldquo;45375&rdquo; :movie{name: &ldquo;X&rdquo;})</td>
<td style="text-align:left">7</td>
</tr>
<tr>
<td style="text-align:left">(&ldquo;87944&rdquo; :movie{name: &ldquo;Robin Hood&rdquo;})</td>
<td style="text-align:left">6</td>
</tr>
<tr>
<td style="text-align:left">(&ldquo;473&rdquo; :movie{name: &ldquo;Pi&rdquo;})</td>
<td style="text-align:left">6</td>
</tr>
<tr>
<td style="text-align:left">(&ldquo;807&rdquo; :movie{name: &ldquo;Seven&rdquo;})</td>
<td style="text-align:left">6</td>
</tr>
</tbody>
</table>
<h5 id="å¯è§†åŒ–åˆ†æ-usercf" class="headerLink">
    <a href="#%e5%8f%af%e8%a7%86%e5%8c%96%e5%88%86%e6%9e%90-usercf" class="header-mark"></a>1.2.3.6 å¯è§†åŒ–åˆ†æ UserCF</h5><p>å†çœ‹çœ‹ UserCF çš„å¯è§†åŒ–ç»“æœå§ï¼š</p>
<ul>
<li>
<p>æ‰¾å‡ºå’Œæ¨èç”¨æˆ·åŒæ ·ç»™å‡ºè¯„åˆ†è¿‡çš„ç”µå½±çš„ç”¨æˆ·</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">//</span><span class="w"> </span><span class="err">æ‰¾å‡ºå’Œç”¨æˆ·</span><span class="w"> </span><span class="n">u_2</span><span class="w"> </span><span class="err">çœ‹è¿‡ç›¸åŒç”µå½±çš„ç”¨æˆ·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e0</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">u_sim</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_2&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u_sim</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">&#34;u_2&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="/recommendation-system-with-graphdb/UserCF_step0.webp" title="UserCF_step0" data-thumbnail="/recommendation-system-with-graphdb/UserCF_step0.webp">
        <img
            
            loading="lazy"
            src="/recommendation-system-with-graphdb/UserCF_step0.webp"
            srcset="/recommendation-system-with-graphdb/UserCF_step0.webp, /recommendation-system-with-graphdb/UserCF_step0.webp 1.5x, /recommendation-system-with-graphdb/UserCF_step0.webp 2x"
            sizes="auto"
            alt="/recommendation-system-with-graphdb/UserCF_step0.webp">
    </a></figure></p>
</li>
<li>
<p>è¿ç®— Pearson Correlation Coefficient å¾—åˆ°å’Œæ¨èç”¨æˆ·å…´è¶£æ¥è¿‘çš„ç”¨æˆ·ï¼Œè¾“å‡ºè¿™äº›æ¥è¿‘çš„ç”¨æˆ·</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">//</span><span class="w"> </span><span class="err">æ‰¾å‡ºå’Œç”¨æˆ·</span><span class="w"> </span><span class="n">u_2</span><span class="w"> </span><span class="err">çœ‹è¿‡ç›¸åŒç”µå½±çš„ç”¨æˆ·</span><span class="p">,</span><span class="w"> </span><span class="err">å¾—ç”µå½±è¯„åˆ†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e0</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">u_sim</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_2&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u_sim</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">&#34;u_2&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="p">,</span><span class="w"> </span><span class="nf">COLLECT</span><span class="p">(</span><span class="err">{</span><span class="n">e0</span><span class="p">:</span><span class="w"> </span><span class="n">e0</span><span class="p">,</span><span class="w"> </span><span class="n">e1</span><span class="p">:</span><span class="w"> </span><span class="n">e1</span><span class="err">}</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—</span><span class="w"> </span><span class="n">u_2</span><span class="w"> </span><span class="err">å’Œè¿™äº›ç”¨æˆ·çš„</span><span class="w"> </span><span class="n">pearson_cc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e0</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="p">,</span><span class="w"> </span><span class="nf">avg</span><span class="p">(</span><span class="n">e0</span><span class="p">.</span><span class="n">rate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u_mean</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u_sim</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="p">,</span><span class="w"> </span><span class="n">u_mean</span><span class="p">,</span><span class="w"> </span><span class="nf">avg</span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u_sim_mean</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e_</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">UNWIND</span><span class="w"> </span><span class="n">e_</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="nf">sum</span><span class="p">((</span><span class="n">e</span><span class="p">.</span><span class="n">e0</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_mean</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_sim_mean</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">numerator</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="nf">pow</span><span class="p">((</span><span class="n">e</span><span class="p">.</span><span class="n">e0</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_mean</span><span class="p">),</span><span class="mi">2</span><span class="p">)))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="nf">pow</span><span class="p">((</span><span class="n">e</span><span class="p">.</span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_sim_mean</span><span class="p">),</span><span class="mi">2</span><span class="p">)))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">denominator</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">denominator</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å–</span><span class="w"> </span><span class="n">pearson_cc</span><span class="w"> </span><span class="err">æœ€å¤§çš„</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="err">ä¸ªç›¸ä¼¼ç”¨æˆ·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="p">,</span><span class="w"> </span><span class="n">numerator</span><span class="o">/</span><span class="n">denominator</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">pearson_cc</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">pearson_cc</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">u_sim</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¢é‡æ¸²æŸ“ï¼Œå¹¶ç»™ä»–ä»¬æ ‡è®°ä¸€ä¸‹é¢œè‰²ï¼š</p>
<p><figure><a class="lightgallery" href="/recommendation-system-with-graphdb/UserCF_step1.webp" title="UserCF_step1" data-thumbnail="/recommendation-system-with-graphdb/UserCF_step1.webp">
        <img
            
            loading="lazy"
            src="/recommendation-system-with-graphdb/UserCF_step1.webp"
            srcset="/recommendation-system-with-graphdb/UserCF_step1.webp, /recommendation-system-with-graphdb/UserCF_step1.webp 1.5x, /recommendation-system-with-graphdb/UserCF_step1.webp 2x"
            sizes="auto"
            alt="/recommendation-system-with-graphdb/UserCF_step1.webp">
    </a></figure></p>
</li>
<li>
<p>é€šè¿‡å…´è¶£æ¥è¿‘ç”¨æˆ·å¾—åˆ°é«˜è¯„åˆ†æœªè§‚çœ‹ç”µå½±ï¼Œæ ¹æ®è§‚çœ‹ç”¨æˆ·çš„ Pearson Correlation Coefficient åŠ æƒï¼Œæ’åºå¾—æ¨èç”µå½±åˆ—è¡¨ã€‚æˆ‘ä»¬æŠŠç»“æœè¾“å‡ºä¸ºè¿™äº›ç›¸ä¼¼ç”¨æˆ·çš„é«˜è¯„åˆ†ç”µå½±è·¯å¾„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">//</span><span class="w"> </span><span class="err">æ‰¾å‡ºå’Œç”¨æˆ·</span><span class="w"> </span><span class="n">u_2</span><span class="w"> </span><span class="err">çœ‹è¿‡ç›¸åŒç”µå½±çš„ç”¨æˆ·</span><span class="p">,</span><span class="w"> </span><span class="err">å¾—ç”µå½±è¯„åˆ†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e0</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">u_sim</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;u_2&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">u_sim</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">&#34;u_2&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="p">,</span><span class="w"> </span><span class="nf">COLLECT</span><span class="p">(</span><span class="err">{</span><span class="n">e0</span><span class="p">:</span><span class="w"> </span><span class="n">e0</span><span class="p">,</span><span class="w"> </span><span class="n">e1</span><span class="p">:</span><span class="w"> </span><span class="n">e1</span><span class="err">}</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">è®¡ç®—</span><span class="w"> </span><span class="n">u_2</span><span class="w"> </span><span class="err">å’Œè¿™äº›ç”¨æˆ·çš„</span><span class="w"> </span><span class="n">pearson_cc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e0</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="p">,</span><span class="w"> </span><span class="nf">avg</span><span class="p">(</span><span class="n">e0</span><span class="p">.</span><span class="n">rate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u_mean</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">u_sim</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="p">,</span><span class="w"> </span><span class="n">u_mean</span><span class="p">,</span><span class="w"> </span><span class="nf">avg</span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u_sim_mean</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e_</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">UNWIND</span><span class="w"> </span><span class="n">e_</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="nf">sum</span><span class="p">((</span><span class="n">e</span><span class="p">.</span><span class="n">e0</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_mean</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_sim_mean</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">numerator</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="nf">pow</span><span class="p">((</span><span class="n">e</span><span class="p">.</span><span class="n">e0</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_mean</span><span class="p">),</span><span class="mi">2</span><span class="p">)))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="nf">pow</span><span class="p">((</span><span class="n">e</span><span class="p">.</span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_sim_mean</span><span class="p">),</span><span class="mi">2</span><span class="p">)))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">denominator</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">denominator</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å–</span><span class="w"> </span><span class="n">pearson_cc</span><span class="w"> </span><span class="err">æœ€å¤§çš„</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="err">ä¸ªç›¸ä¼¼ç”¨æˆ·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">u_sim</span><span class="p">,</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="p">,</span><span class="w"> </span><span class="n">numerator</span><span class="o">/</span><span class="n">denominator</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">pearson_cc</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">pearson_cc</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å–ç›¸ä¼¼ç”¨æˆ·ç»™å‡ºé«˜è¯„åˆ†çš„æ–°ç”µå½±ï¼Œæ ¹æ®ç›¸ä¼¼ç”¨æˆ·ä¸ªæ•°å¯¹ç”¨æˆ·ç›¸ä¼¼ç¨‹åº¦</span><span class="w"> </span><span class="n">pearson_cc</span><span class="w"> </span><span class="err">åŠ æƒï¼Œè·å¾—æ¨èåˆ—è¡¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">u_sim</span><span class="p">:</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">e1</span><span class="p">:</span><span class="n">watched</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">recomm</span><span class="p">:</span><span class="o">`</span><span class="n">movie</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">recomm</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">watched_movies_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">rate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">recomm</span><span class="p">,</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">pearson_cc</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">sim_score</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¾—åˆ°çš„ç»“æœï¼Œæˆ‘ä»¬å¢é‡æ¸²æŸ“åˆ°ç”»å¸ƒä¸Šå¯ä»¥å¾—åˆ°ï¼šè¿™äº› UserCF æ¨èè€Œå¾—çš„ç”µå½±åœ¨è·¯å¾„æœ«ç«¯ï¼š</p>
<p><figure><a class="lightgallery" href="/recommendation-system-with-graphdb/UserCF_step2.webp" title="UserCF_step2" data-thumbnail="/recommendation-system-with-graphdb/UserCF_step2.webp">
        <img
            
            loading="lazy"
            src="/recommendation-system-with-graphdb/UserCF_step2.webp"
            srcset="/recommendation-system-with-graphdb/UserCF_step2.webp, /recommendation-system-with-graphdb/UserCF_step2.webp 1.5x, /recommendation-system-with-graphdb/UserCF_step2.webp 2x"
            sizes="auto"
            alt="/recommendation-system-with-graphdb/UserCF_step2.webp">
    </a></figure></p>
<p>åœ¨å¯è§†åŒ–ä¸­ï¼Œç›¸ä¼¼ç”¨æˆ·çš„é«˜è¯„åˆ†æœªè§‚çœ‹ç”µå½±è¢«æ¨èçš„æ€æƒ³æ˜¯ä¸æ˜¯ä¸€ç›®äº†ç„¶äº†å‘¢ï¼Ÿ</p>
</li>
</ul>
<h4 id="æ··åˆçš„æ–¹æ³•" class="headerLink">
    <a href="#%e6%b7%b7%e5%90%88%e7%9a%84%e6%96%b9%e6%b3%95" class="header-mark"></a>1.2.4 æ··åˆçš„æ–¹æ³•</h4><p>åœ¨çœŸå®ä¸–ç•Œä¸­ï¼ŒçœŸæ­£è¾¾åˆ°æœ€å¥½æ•ˆæœçš„æ–¹æ³•é€šå¸¸æ˜¯ç»“åˆæ‰€æœ‰ä¿¡æ¯çš„ä¸åŒæ–¹æ³•ï¼Œå…±åŒå·¥ä½œçš„ï¼Œè¿™æ ·æ—¢å¯ä»¥ä½¿å¾—ä¸åŒè§’åº¦çš„æœ‰ç”¨ä¿¡æ¯å¾—åˆ°å……åˆ†åˆ©ç”¨ï¼Œåˆèƒ½å¼¥è¡¥å•ä¸€æ–¹æ³•åœ¨ä¸åŒæ•°æ®é‡ã€ä¸åŒé˜¶æ®µçš„å¼±ç‚¹ã€‚</p>
<p>ç»“åˆçš„æ–¹æ³•åœ¨å·¥ç¨‹ä¸Šå¯ä»¥åƒå·®ä¸‡åˆ«ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œä¸è¿‡åœ¨ä¸‹è¾¹ä»‹ç»å¦ä¸€ç±»æ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šä¸¾ä¾‹ä¸€ç§æ··åˆçš„æ–¹å¼ï¼šåŸºäºæ¨¡å‹ã€‚</p>
<h4 id="åŸºäºæ¨¡å‹çš„æ–¹æ³•" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e6%a8%a1%e5%9e%8b%e7%9a%84%e6%96%b9%e6%b3%95" class="header-mark"></a>1.2.5 åŸºäºæ¨¡å‹çš„æ–¹æ³•</h4><p>ç›´è§‰ä¸Šï¼Œæˆ‘ä»¬çŸ¥é“é™¤äº†æ­£å‘çš„æ˜ç¡®é€šè¿‡åŸºäºå†…å®¹çš„ï¼ˆç”µå½±çš„é¢†åŸŸçŸ¥è¯†ã€å…³ç³»ï¼‰ã€ååŒçš„ï¼ˆç”¨æˆ·ä¸ç”¨æˆ·ã€ç”¨æˆ·ä¸ç”µå½±ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼‰çš„ç®—æ³•ï¼Œä¹Ÿå¯ä»¥æŠŠè¿™äº›ä¿¡æ¯ä½œä¸ºæœºå™¨å­¦ä¹ ä¸­çš„è¾“å…¥ç‰¹å¾ï¼Œç”¨ç»Ÿè®¡å­¦çš„æ–¹æ³•å¾—åˆ°ä¸€ä¸ªæ¨¡å‹ï¼Œç”¨æ¥é¢„æµ‹ç”¨æˆ·å¯èƒ½å–œæ¬¢çš„ç‰©ä»¶ï¼ˆç”µå½±ï¼‰ï¼Œè¿™å°±æ˜¯åŸºäºæ¨¡å‹çš„æ–¹æ³•ã€‚</p>
<p>åŸºäºæ¨¡å‹çš„æ–¹æ³•å¯ä»¥å¾ˆè‡ªç„¶åœ°æŠŠæŠŠä»¥ä¸Šå‡ ç§æ–¹æ³•çš„ä¿¡æ¯åŒæ—¶çº³å…¥ä¸ºç‰¹å¾ï¼Œè¿™æ ·ï¼Œå®ƒæœ¬è´¨ä¸Šä¹Ÿæ˜¯æ··åˆè¿‡æ»¤æ–¹æ³•çš„ä¸€ç§å®ç°äº†ã€‚</p>
<p>åŸºäºæ¨¡å‹ã€æœºå™¨å­¦ä¹ çš„æ¨èç³»ç»Ÿæ–¹æ³•æœ‰å¾ˆå¤šï¼Œè¿™é‡Œï¼Œå› ä¸ºæˆ‘ä»¬ç€é‡ä»¥å›¾ã€å›¾æ•°æ®åº“çš„å‡ºå‘ç‚¹ä»‹ç»ï¼Œæˆ‘å°±ä¸¾ä¾‹å…¶ä¸­çš„ä¸€ç§æ–¹æ³•ï¼šåŸºäºå›¾ç¥ç»ç½‘ç»œï¼ˆGNNï¼‰ã€‚</p>
<p>GNN çš„æ–¹æ³•å¯ä»¥å°†å›¾è°±ä¸­çš„å†…å®¹ä¿¡æ¯ï¼ˆå¯¼æ¼”ã€æ¼”å‘˜ã€ç±»å‹ï¼‰å’ŒååŒä¿¡æ¯ï¼ˆç”¨æˆ·-ç”¨æˆ·ã€ç”µå½±-ç”µå½±ã€ç”¨æˆ·-ç”µå½±ä¹‹é—´çš„ç›¸äº’å…³ç³»ï¼‰ä»¥çŸ¥è¯†çš„æ–¹å¼åµŒå…¥ï¼Œå¹¶ä¸”æ–¹æ³•ä¸­çš„æ¶ˆæ¯ä¼ é€’æ–¹å¼ä¿æœ‰äº†å›¾ä¸­çš„å±€éƒ¨æ€§ï¼ˆlocalityï¼‰ï¼Œè¿™ä½¿å¾—å®ƒå¯èƒ½æˆä¸ºä¸€ä¸ªéå¸¸æ–°é¢–ã€æœ‰æ•ˆçš„æ¨èç³»ç»Ÿæ¨¡å‹æ–¹æ³•ã€‚</p>
<h5 id="gnn--å›¾æ•°æ®åº“çš„æ¨èç³»ç»Ÿ" class="headerLink">
    <a href="#gnn--%e5%9b%be%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e6%8e%a8%e8%8d%90%e7%b3%bb%e7%bb%9f" class="header-mark"></a>1.2.5.1 GNN + å›¾æ•°æ®åº“çš„æ¨èç³»ç»Ÿ</h5><p><strong>ä¸ºä»€ä¹ˆéœ€è¦å›¾æ•°æ®åº“</strong>ï¼Ÿ</p>
<p>GNN çš„æ–¹æ³•ä¸­ï¼Œå›¾æ•°æ®åº“åªæ˜¯ä¸€ä¸ªå¯é€‰é¡¹ï¼Œè€Œæˆ‘ç»™çš„ GNN æ–¹æ³•çš„ç¤ºä¾‹ä¸­ï¼Œå›¾æ•°æ®åº“çš„å…³é”®ä½œç”¨æ˜¯å®ƒå¸¦æ¥äº†å®æ—¶æ€§çš„å¯èƒ½ã€‚</p>
<p>ä¸€ä¸ªå®æ—¶æ€§æ¨èç³»ç»Ÿè¦æ±‚åœ¨ç§’çº§å“åº”ä¸‹åˆ©ç”¨ GNN è®­ç»ƒæ¨¡å‹ä»è¿‘å®æ—¶çš„è¾“å…¥æ•°æ®ä¸­è¿›è¡Œæ¨ç†ï¼Œè¿™ç»™æˆ‘ä»¬æå‡ºçš„è¦æ±‚æ˜¯ï¼š</p>
<ul>
<li>è¾“å…¥æ•°æ®å¯ä»¥å®æ—¶ã€è¿‘å®æ—¶è·å–</li>
<li>æ¨ç†è¿ç®—å¯ä»¥å®æ—¶å®Œæˆ</li>
</ul>
<p>è€Œåˆ©ç”¨å½’çº³å‹ï¼ˆInductive modelï¼‰çš„æ¨¡å‹ä»å›¾æ•°æ®åº“ä¸­å®æ—¶è·å–æ–°çš„æ•°æ®å­å›¾ä½œä¸ºæ¨ç†è¾“å…¥æ˜¯ä¸€ä¸ªæ»¡è¶³è¿™æ ·è¦æ±‚å¯è¡Œçš„è®¾è®¡æ–¹å¼ã€‚</p>
<p>ä¸‹è¾¹æ˜¯ç®€å•çš„æµç¨‹å›¾ï¼š</p>
<ul>
<li>å·¦è¾¹æ˜¯æ¨¡å‹è®­ç»ƒï¼Œåœ¨å›¾è°±çš„äºŒåˆ†å›¾ï¼ˆuser å’Œ itemï¼‰ä¹‹ä¸Šå»ºæ¨¡
<ul>
<li>ç”¨æˆ·å’Œç‰©ä»¶ï¼ˆmovieï¼‰ä¹‹é—´çš„å…³ç³»é™¤äº†äº¤äº’å…³ç³»ä¹‹å¤–ï¼Œè¿˜æœ‰é¢„å…ˆå¤„ç†çš„å…³ç³»ï¼Œè¿™äº›å…³ç³»è¢«æŸ¥è¯¢è·å¾—åå†å†™å›å›¾æ•°æ®åº“ä¸­ä¾›åç»­æ¶ˆè´¹ä½¿ç”¨ï¼Œå…³ç³»æœ‰ï¼š
<ul>
<li>ç”¨æˆ·é—´â€œç›¸ä¼¼â€å…³ç³»</li>
<li>ç‰©ä»¶é—´ä¸åŒï¼ˆå…±åŒæ¼”å‘˜ã€ç±»å‹ã€å¯¼æ¼”ï¼‰å…³ç³»</li>
</ul>
</li>
<li>åˆ©ç”¨ Nebula-DGL å°†å›¾ä¸­éœ€è¦çš„ç‚¹ã€è¾¹åºåˆ—åŒ–ä¸º DGL å¯ä»¥æ¶ˆè´¹çš„å¯¹è±¡</li>
<li>åœ¨ DGL ä¸­åˆ†å‰²è®­ç»ƒã€æµ‹è¯•ã€éªŒè¯é›†ï¼Œåˆ©ç”¨ PinSAGE æ¨¡å‹è®­ç»ƒã€‚</li>
<li>å¯¼å‡ºæ¨¡å‹ç»™æ¨èç³»ç»Ÿä½¿ç”¨</li>
</ul>
</li>
</ul>
<blockquote>
<p>æ³¨ï¼š</p>
<ul>
<li>
<p>DGL æ˜¯éå¸¸æµè¡Œçš„å›¾æ·±åº¦å­¦ä¹ çŸ¿å»ºï¼Œé¡¹ç›®å®˜ç½‘ï¼šhttps://www.dgl.ai</p>
</li>
<li>
<p>Nebula-DGL æ˜¯ä¸€ä¸ª NebulaGraph åˆ° DGL çš„è¿æ¥å™¨ï¼Œé¡¹ç›®åœ°å€ï¼šhttps://github.com/wey-gu/nebula-dgl</p>
</li>
<li>
<p>PinSAGE å‚è€ƒ <a href="https://arxiv.org/abs/1806.01973" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1806.01973</a> è®ºæ–‡ï¼ŒDGL ä¸­çš„ PinSAGE å®ç°å…¶å®å¹¶ä¸æ˜¯å½’çº³å‹ï¼Œéœ€è¦åšä¸€äº›ä¿®æ”¹æ‰å¯ä»¥ã€‚</p>
</li>
</ul>
</blockquote>
<ul>
<li>å³è¾¹æ˜¯å¯¼å‡ºçš„æ¨¡å‹ä½œä¸ºæ¨ç†æ¥å£çš„æ¨èç³»ç»Ÿ
<ul>
<li>åŸºäºå›¾åº“çš„å®æ—¶å›¾è°±ä¸Šä¸€ç›´ä¼šæœ‰å®æ—¶çš„æ•°æ®æ›´æ–°ï¼ŒèŠ‚ç‚¹å¢å‡</li>
<li>å½“ç»™å®šçš„ç”¨æˆ·æ¨èè¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œå›¾åº“ä¸­ä»¥è¯¥ç”¨æˆ·ä¸ºèµ·ç‚¹çš„å­å›¾ä¼šè¢«è·å–ï¼ˆ1.ï¼‰ã€ä½œä¸ºè¾“å…¥å‘é€ç»™æ¨ç†æ¥å£ï¼ˆ2.ï¼‰</li>
<li>æ¨ç†æ¥å£æŠŠå­å›¾è¾“å…¥ç»™ä¹‹å‰è®­ç»ƒçš„æ¨¡å‹ï¼Œè·å¾—è¯¥ç”¨æˆ·åœ¨å­å›¾ä¸­å…³è”çš„æ–°ç‰©ä»¶ä¸­çš„è¯„åˆ†æ’åºï¼ˆ3.ï¼‰ä½œä¸ºæ¨èç»“æœ</li>
</ul>
</li>
</ul>
<p><figure><a class="lightgallery" href="/recommendation-system-with-graphdb/PinSAGE_RecommendationSystem.svg" title="PinSAGE_RecommendationSystem" data-thumbnail="/recommendation-system-with-graphdb/PinSAGE_RecommendationSystem.svg">
        <img
            
            loading="lazy"
            src="/recommendation-system-with-graphdb/PinSAGE_RecommendationSystem.svg"
            srcset="/recommendation-system-with-graphdb/PinSAGE_RecommendationSystem.svg, /recommendation-system-with-graphdb/PinSAGE_RecommendationSystem.svg 1.5x, /recommendation-system-with-graphdb/PinSAGE_RecommendationSystem.svg 2x"
            sizes="auto"
            alt="/recommendation-system-with-graphdb/PinSAGE_RecommendationSystem.svg">
    </a></figure></p>
<p>ç¯‡å¹…å…³ç³»ï¼Œæœ¬ç« æˆ‘å°±ä¸ç»™å‡ºç«¯åˆ°ç«¯çš„å®ä¾‹ä»£ç äº†ï¼Œåç»­æœ‰æœºä¼šæˆ‘ä¼šå°½é‡åšä¸€ä¸ª demo å‡ºæ¥çš„ã€‚</p>
<h3 id="æ¨èç³»ç»Ÿå¯è§£é‡Šæ€§" class="headerLink">
    <a href="#%e6%8e%a8%e8%8d%90%e7%b3%bb%e7%bb%9f%e5%8f%af%e8%a7%a3%e9%87%8a%e6%80%a7" class="header-mark"></a>1.3 æ¨èç³»ç»Ÿå¯è§£é‡Šæ€§</h3><p>åœ¨ç»“æŸæœ¬ç« ä¹‹å‰ï¼Œå†ä¸¾ä¸€ä¸ªå›¾æ•°æ®åº“åœ¨æ¨èç³»ç»Ÿä¸­çš„å…¸å‹åº”ç”¨ï¼šæ¨èç†ç”±ã€‚</p>
<p>ä¸‹å›¾æ˜¯ç¾å›¢ã€å¤§ä¼—ç‚¹è¯„ä¸­çš„ä¸€ä¸ªå¸¸è§çš„æœç´¢ã€æ¨èç»“æœï¼Œç°ä»£æ¨èç³»ç»Ÿçš„å¤æ‚åº¦æ˜¯éå¸¸å¤§çš„ï¼Œä¸€æ–¹é¢ç”±å¾ˆå¤šæ–¹æ³•è‡ªèº«çš„ç‰¹æ€§å†³å®šï¼Œå¦ä¸€æ–¹é¢æœ€ç»ˆçš„æ¨èå¯èƒ½æ˜¯å¤šä¸ªç³»ç»ŸååŒè·å¾—æœ€ç»ˆç»“æœæ’åï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¾ˆéš¾å¯¹æ¨èç»“æœè¿›è¡Œè§£é‡Šã€‚</p>
<p>å¾—ç›Šäºè¢«æ¨èç”¨æˆ·å’Œç‰©ä»¶ã€ä»¥åŠä»–ä»¬çš„å„ç§å„æ ·ç”»åƒæœ€ç»ˆå½¢æˆçš„çŸ¥è¯†å›¾è°±ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å›¾è°±ä¸­å¯¹æ¨èç»“æœè¿›è¡Œâ€œè·¯å¾„æŸ¥æ‰¾â€å°±å¯ä»¥è·å¾—å¾ˆæœ‰æ„ä¹‰çš„è§£é‡Šï¼Œåƒæ˜¯å¦‚ä¸‹æˆªå›¾çš„â€œåœ¨åŒ—äº¬å–œæ¬¢åŒ—äº¬èœçš„å±±ä¸œè€ä¹¡éƒ½è¯´è¿™å®¶åº—å¾ˆèµâ€å°±æ˜¯è¿™æ ·è·å¾—çš„è§£é‡Šã€‚</p>
<p><figure><a class="lightgallery" href="/recommendation-system-with-graphdb/reasoning.webp" title="reasoning" data-thumbnail="/recommendation-system-with-graphdb/reasoning.webp">
        <img
            
            loading="lazy"
            src="/recommendation-system-with-graphdb/reasoning.webp"
            srcset="/recommendation-system-with-graphdb/reasoning.webp, /recommendation-system-with-graphdb/reasoning.webp 1.5x, /recommendation-system-with-graphdb/reasoning.webp 2x"
            sizes="auto"
            alt="/recommendation-system-with-graphdb/reasoning.webp">
    </a></figure></p>
<blockquote>
<p>å›¾ç‰‡æ¥æºï¼šhttps://tech.meituan.com/2021/04/01/nebula-graph-practice-in-meituan.html</p>
</blockquote>
<h4 id="å¯è§£é‡Šæ€§çš„ä¾‹å­" class="headerLink">
    <a href="#%e5%8f%af%e8%a7%a3%e9%87%8a%e6%80%a7%e7%9a%84%e4%be%8b%e5%ad%90" class="header-mark"></a>1.3.1 å¯è§£é‡Šæ€§çš„ä¾‹å­</h4><p>å’±ä»¬å›åˆ°ç”µå½±æ¨èçš„å›¾è°±ä¸Šï¼Œæˆ‘ä»¬åœ¨å‰è¾¹çš„ç®—æ³•ä¸­æ›¾ç»è·å¾—è¿‡ç”¨æˆ· <code>u_124</code> çš„æ¨èç”µå½± <code>1891</code>ï¼ˆæ˜Ÿçƒå¤§æˆ˜ï¼šï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸€ä¸ªæŸ¥è¯¢è·å¾—å®ƒçš„æ¨èè§£é‡Šï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">FIND</span><span class="w"> </span><span class="n">NOLOOP</span><span class="w"> </span><span class="n">PATH</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s2">&#34;1891&#34;</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">BIDIRECT</span><span class="w"> </span><span class="n">UPTO</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">STEPS</span><span class="w"> </span><span class="n">yield</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¯ä»¥å¾ˆå¿«è·å¾— 20 æ¡è·¯å¾„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="n">moviegraph</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FIND</span><span class="w"> </span><span class="n">NOLOOP</span><span class="w"> </span><span class="n">PATH</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s2">&#34;u_124&#34;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s2">&#34;1891&#34;</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">BIDIRECT</span><span class="w"> </span><span class="n">UPTO</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">STEPS</span><span class="w"> </span><span class="n">yield</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">p</span><span class="w">                                                                                                   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;g_49&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">       </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;g_17&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">       </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;g_10281&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;p_4&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;p_3&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;p_24342&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;p_2&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;832&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;g_1110&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;g_1110&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;p_13463&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;p_12248&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;47981&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;g_10219&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;p_6&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;497&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;g_104&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;120880&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;g_104&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;g_104&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;p_130&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">acted_by</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;497&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;g_50&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11635&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;g_50&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="s2">&#34;u_124&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">watched</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;11&#34;</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="s2">&#34;g_50&#34;</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">with_genre</span><span class="o">@</span><span class="mi">0</span><span class="w"> </span><span class="err">{}</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="s2">&#34;1891&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="w">       </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+-----------------------------------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Got</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="nf">rows</span><span class="w"> </span><span class="p">(</span><span class="kt">time</span><span class="w"> </span><span class="n">spent</span><span class="w"> </span><span class="mi">267151</span><span class="o">/</span><span class="mi">278139</span><span class="w"> </span><span class="n">us</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Wed</span><span class="p">,</span><span class="w"> </span><span class="mi">09</span><span class="w"> </span><span class="n">Nov</span><span class="w"> </span><span class="mi">2022</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">56</span><span class="w"> </span><span class="n">CST</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬åœ¨ç»“æœå¯è§†åŒ–ä¸­å¯ä»¥å¾ˆå®¹æ˜“çœ‹å‡ºè¿™ä¸ªæ¨èçš„ç»“æœå¯ä»¥æ˜¯ï¼š</p>
<ul>
<li>æ›¾ç»å–œæ¬¢çš„æ˜Ÿæˆ˜ç”µå½±çš„å¤§éƒ¨åˆ†æ¼”èŒäººå‘˜éƒ½ä¹Ÿå‚ä¸äº†è¿™éƒ¨å’ŒåŒæ ·æ˜¯â€œå¥¥æ–¯å¡è·å¥–â€ä¸”â€œç»å…¸â€çš„ç”µå½±ã€‚</li>
</ul>
<p><figure><a class="lightgallery" href="/recommendation-system-with-graphdb/reasoning_movie.webp" title="reasoning_movie" data-thumbnail="/recommendation-system-with-graphdb/reasoning_movie.webp">
        <img
            
            loading="lazy"
            src="/recommendation-system-with-graphdb/reasoning_movie.webp"
            srcset="/recommendation-system-with-graphdb/reasoning_movie.webp, /recommendation-system-with-graphdb/reasoning_movie.webp 1.5x, /recommendation-system-with-graphdb/reasoning_movie.webp 2x"
            sizes="auto"
            alt="/recommendation-system-with-graphdb/reasoning_movie.webp">
    </a></figure></p>
<h3 id="æ€»ç»“" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93" class="header-mark"></a>1.4 æ€»ç»“</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬çŸ¥é“å›¾æ•°æ®åº“ä½œä¸ºæ¨èç³»ç»Ÿä¸­ä¿¡æ¯çš„æœ€ç»ˆå½¢å¼ï¼šçŸ¥è¯†å­˜åœ¨ï¼Œå¯ä»¥é€‚ç”¨åœ¨ä¸åŒç±»å‹æ–¹æ³•ä¸Šï¼Œå°½ç®¡å¾ˆå¤šæ–¹æ³•ä¸­ï¼Œå›¾åº“ä¸ä¸€å®šæ˜¯æœ€ç»ˆè½åœ°ç³»ç»Ÿæ–¹æ¡ˆçš„æœ€æµè¡Œé€‰æ‹©ï¼Œå›¾æ•°æ®åº“æ‰€å¸¦æ¥çš„å¯è§†åŒ–æ´å¯Ÿçš„æ½œåŠ›è¿˜æ˜¯éå¸¸å¤§çš„ã€‚</p>
<p>åŒæ—¶ï¼Œæ„å»ºçš„ç»¼åˆçŸ¥è¯†å›¾è°±ä¸Šçš„è§£é‡Šã€æ¨ç†èƒ½åŠ›ä¸ä¸€äº›å®æ—¶è¦æ±‚é«˜çš„å›¾æ–¹æ³•ä¸­ï¼ˆæ¯”å¦‚ GNNçš„åŸºäºæ¨¡å‹æ–¹æ³•ï¼‰ï¼Œèƒ½èµ·åˆ°å¸¦æ¥ç‹¬ä¸€æ— äºŒçš„ä½œç”¨ã€‚</p>
<p>é¢˜å›¾ç‰ˆæƒï¼š<a href="https://unsplash.com/@charlesdeluvio" target="_blank" rel="noopener noreferrer">charlesdeluvio</a></p>]]></description>
</item></channel>
</rss>
