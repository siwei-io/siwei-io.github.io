<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>æ‰€æœ‰æ–‡ç«  - siwei.io</title>
        <link>https://siwei.io/posts/</link>
        <description>æ‰€æœ‰æ–‡ç«  | siwei.io</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>weyl.gu@gmail.com (Wey Gu)</managingEditor>
            <webMaster>weyl.gu@gmail.com (Wey Gu)</webMaster><lastBuildDate>Mon, 15 Aug 2022 00:24:28 &#43;0800</lastBuildDate><atom:link href="https://siwei.io/posts/" rel="self" type="application/rss+xml" /><item>
    <title>åŸºäº NebulaGraph å›¾æ•°æ®åº“çš„æ¬ºè¯ˆæ£€æµ‹æ–¹æ³•ä¸ä»£ç ç¤ºä¾‹</title>
    <link>https://siwei.io/fraud-detection-with-nebulagraph/</link>
    <pubDate>Mon, 01 Aug 2022 01:15:05 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/fraud-detection-with-nebulagraph/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/fraud-detection-with-nebulagraph/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>æœ¬æ–‡æ˜¯ä¸€ä¸ªåŸºäº NebulaGraph ä¸Šå›¾ç®—æ³•ã€å›¾æ•°æ®åº“ã€æœºå™¨å­¦ä¹ ã€GNN çš„ Fraud Detection æ–¹æ³•ç»¼è¿°ï¼Œé™¤äº†åŸºæœ¬æ–¹æ³•æ€æƒ³çš„ä»‹ç»ä¹‹å¤–ï¼Œæˆ‘è¿˜ç»™å¤§å®¶å¼„äº†å¯ä»¥è·‘çš„ Playgroundã€‚</p>
</blockquote>
<blockquote>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™è¿˜æˆ‘ç¬¬ä¸€æ¬¡ç»™å¤§å®¶ä»‹ç» Nebula-DGL è¿™ä¸ªé¡¹ç›® ğŸ˜ã€‚</p>
</blockquote>
<!--

[TOC]

-->
<h2 id="åŸºäºå›¾æ•°æ®åº“çš„æ¬ºè¯ˆæ£€æµ‹æ–¹æ³•" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%9b%be%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e6%ac%ba%e8%af%88%e6%a3%80%e6%b5%8b%e6%96%b9%e6%b3%95" class="header-mark"></a>1 åŸºäºå›¾æ•°æ®åº“çš„æ¬ºè¯ˆæ£€æµ‹æ–¹æ³•</h2><h3 id="å»ºç«‹å›¾è°±" class="headerLink">
    <a href="#%e5%bb%ba%e7%ab%8b%e5%9b%be%e8%b0%b1" class="header-mark"></a>1.1 å»ºç«‹å›¾è°±</h3><p>é¦–å…ˆï¼Œå¯¹ç°æœ‰çš„å†å²æ•°æ®ã€æ ‡æ³¨ä¿¡æ¯é¢å‘å…³è”å…³ç³»è¿›è¡Œå±æ€§å›¾å»ºæ¨¡ã€‚è¿™ç§åŸå§‹æ•°æ®æ˜¯å¤šä¸ªè¡¨ç»“æ„ä¸­çš„é“¶è¡Œã€ç”µå­å•†åŠ¡æˆ–è€…ä¿é™©è¡Œä¸šé‡Œçš„äº¤æ˜“äº‹ä»¶è®°å½•ã€ç”¨æˆ·æ•°æ®å’Œé£æ§æ ‡æ³¨ï¼Œè€Œå»ºæ¨¡è¿‡ç¨‹å°±æ˜¯æŠ½è±¡å‡ºæˆ‘ä»¬å…³å¿ƒçš„å®ä½“ã€å®ä½“é—´çš„å…³è”å…³ç³»ã€å’Œå…¶ä¸­æœ‰æ„ä¹‰çš„å±æ€§ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œè‡ªç„¶äººã€å…¬å¸å®ä½“ã€ç”µè¯å·ç ã€åœ°å€ã€è®¾å¤‡ï¼ˆæ¯”å¦‚ç»ˆç«¯è®¾å¤‡ã€ç½‘ç»œåœ°å€ã€ç»ˆç«¯è®¾å¤‡æ‰€è¿æ¥çš„ WiFi SSID ç­‰ï¼‰ã€è®¢å•éƒ½æ˜¯å®ä½“æœ¬èº«ï¼Œå…¶ä»–ä¿¡æ¯æ¯”å¦‚é£é™©æ ‡æ³¨ï¼ˆæ˜¯å¦é«˜é£é™©ã€é£é™©æè¿°ç­‰ï¼‰ã€è‡ªç„¶äººå’Œå…¬å¸å®ä½“çš„ä¿¡æ¯ï¼ˆèŒä¸šã€æ”¶å…¥ã€å­¦å†ç­‰ï¼‰éƒ½ä½œä¸ºå®ä½“çš„å±æ€§æ¥å»ºæ¨¡ã€‚</p>
<p>ä¸‹å›¾æ˜¯ä¸€ä¸ªå¯ä»¥å‚è€ƒçš„è´·æ¬¾åæ¬ºè¯ˆçš„ç¤ºä¾‹å»ºæ¨¡ï¼Œå®ƒæ¥è‡ªä¸€ä»½ä½œè€…å¼€æºçš„å›¾ç»“æ„æ•°æ®ç”Ÿæˆé¡¹ç›®ã€‚</p>
<blockquote>
<p>æ³¨ï¼Œä½ å¯ä»¥è®¿é—® <a href="https://github.com/wey-gu/fraud-detection-datagen" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/fraud-detection-datagen</a> è·å–è¿™ä¸ªå¼€æºçš„æ•°æ®ç”Ÿæˆå™¨ä»£ç å’Œä¸€ä»½ç¤ºä¾‹çš„æ•°æ®ã€‚</p>
</blockquote>
<p><a class="lightgallery" href="https://github.com/wey-gu/fraud-detection-datagen/raw/main/images/fraud_detection_graph_model.svg" title="https://github.com/wey-gu/fraud-detection-datagen/raw/main/images/fraud_detection_graph_model.svg" data-thumbnail="https://github.com/wey-gu/fraud-detection-datagen/raw/main/images/fraud_detection_graph_model.svg">
        
    </a></p>
<h3 id="å›¾æ•°æ®åº“æŸ¥è¯¢è¯†åˆ«é£é™©" class="headerLink">
    <a href="#%e5%9b%be%e6%95%b0%e6%8d%ae%e5%ba%93%e6%9f%a5%e8%af%a2%e8%af%86%e5%88%ab%e9%a3%8e%e9%99%a9" class="header-mark"></a>1.2 å›¾æ•°æ®åº“æŸ¥è¯¢è¯†åˆ«é£é™©</h3><p>æœ‰äº†ä¸€å¼ å›Šæ‹¬äº†äººã€å…¬å¸ã€å†å²è´·æ¬¾ç”³è¯·è®°å½•ã€ç”µè¯ã€çº¿ä¸Šç”³è¯·ç½‘ç»œè®¾å¤‡çš„å›¾è°±ï¼Œæˆ‘ä»¬å¯ä»¥æŒ–æ˜ä¸€äº›æœ‰æ„æ€çš„ä¿¡æ¯ã€‚</p>
<p>äº‹å®ä¸Šï¼Œå¾ˆå¤šå€¼å¾—è¢«å‘ç°ã€å¹¶æœ‰æ•ˆé˜»æ­¢ä»è€Œæ­¢æŸçš„éª—ä¿è¡Œä¸ºæ˜¯å…·æœ‰ç¾¤ä½“èšé›†æ€§çš„ã€‚æ¯”å¦‚æ¬ºè¯ˆå›¢ä¼™å¯èƒ½æ˜¯ä¸€å°æ‰¹äººï¼ˆæ¯”å¦‚3åˆ°5äººï¼‰æœ‰ç»„ç»‡åœ°æ”¶é›†æ›´å¤§è§„æ¨¡çš„èº«ä»½è¯ä¿¡æ¯ï¼ˆæ¯”å¦‚30å¼ ï¼‰ï¼ŒåŒæ—¶å‘èµ·å¤šä¸ªé‡‘èæœºæ„å¤§é‡è´·æ¬¾ï¼Œç„¶ååœ¨æ”¾æ¬¾åé€‰æ‹©ä¸¢å¼ƒè¿™æ‰¹ç•™ä¸‹äº†è¿çº¦è®°å½•çš„èº«ä»½è¯ï¼Œå†è¿›ä¸€æ­¥é€‰æ‹©ä¸‹ä¸€æ‰¹èº«ä»½è¯ä¿¡æ¯å¦‚æ³•ç‚®åˆ¶ã€‚</p>
<p>è¿™ç§å›¢ä¼™ä½œæ¡ˆçš„æ–¹å¼å› ä¸ºåˆ©ç”¨äº†å¤§é‡æ–°çš„èº«ä»½ä¿¡æ¯ï¼Œå®Œå…¨åˆ©ç”¨å†å²è®°å½•å»é»‘åå•è§„é¿é£é™©çš„æ–¹å¼æ˜¯æ— æ•ˆçš„ã€‚ä¸è¿‡ï¼Œå€ŸåŠ©äºå…³è”å…³ç³»çš„è§†è§’ï¼Œè¿™äº›æ¨¡å¼æ˜¯ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥è¢«åŠæ—¶è¯†åˆ«å‡ºæ¥çš„ã€‚</p>
<p>è¿™äº›è§„å¯ä»¥è¢«è¯†åˆ«å‡ºçš„è§„å¾‹æˆ‘æŠŠå®ƒåˆ†æˆä¸¤ç§ï¼š</p>
<p>ä¸€ç§æ˜¯é£æ§ä¸“å®¶å¯ä»¥ç›´æ¥ç”¨æŸç§æ¨¡å¼æ¥æè¿°çš„ï¼Œä¾‹å¦‚ï¼šå’Œå·²ç»è¢«æ ‡æ³¨ä¸ºé«˜é£é™©çš„å®ä½“æœ‰ç›´æ¥æˆ–è€…é—´æ¥çš„å…³è”å…³ç³»ï¼ˆæ–°è®¢å•ç”³è¯·äººä½¿ç”¨äº†å’Œè¿‡å¾€é«˜é£é™©è®°å½•ç›¸åŒçš„ç½‘ç»œè®¾å¤‡ï¼‰ï¼Œè¿™ç§æ¨¡å¼å¯¹åº”åˆ°å›¾è°±ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªå›¾æŸ¥è¯¢å°±å¯ä»¥å®æ—¶ç»™å‡ºç»“æœã€‚</p>
<p>å¦ä¸€ç§æ˜¯éšå«åœ¨æ•°æ®çš„å…³è”å…³ç³»èƒŒåï¼Œéœ€è¦é€šè¿‡å›¾ç®—æ³•æŒ–æ˜å¾—å‡ºçš„ä¸€äº›é£é™©æç¤ºï¼Œä¾‹å¦‚ï¼šå°½ç®¡ç»™å®šçš„å®ä½“ä¸æœ‰é™çš„æ ‡æ³¨é«˜é£é™©å®ä½“æ²¡æœ‰åŒ¹é…çš„å…³è”ï¼Œä½†æ˜¯å®ƒåœ¨å›¾ä¸­å½¢æˆäº†èšé›†æ€§å¯èƒ½æç¤ºæˆ‘ä»¬è¿™å¯èƒ½æ˜¯ä¸€ä¸ªå°šæœªå¾—æ‰‹çš„è¿›è¡Œä¸­çš„å›¢ä¼™è´·æ¬¾è¯ˆéª—çš„å…¶ä¸­ä¸€æ¬¡ç”³è¯·ï¼Œè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡å®šæœŸåœ¨å†å²æ•°æ®ä¸­æ‰¹é‡æ‰§è¡Œç¤¾åŒºå‘ç°ç®—æ³•å¾—å‡ºï¼Œå¹¶åœ¨é«˜èšé›†ç¤¾åŒºä¸­åˆ©ç”¨ä¸­å¿ƒæ€§ç®—æ³•ç»™å‡ºæ ¸å¿ƒå®ä½“ï¼Œä¸€å¹¶æç¤ºç»™é£é™©ä¸“å®¶è¿›è¡Œåç»­è¯„ä¼°å’Œé£é™©æ ‡æ³¨ã€‚</p>
<h4 id="åŸºäºå›¾è°±ä¸ä¸“å®¶å›¾æ¨¡å¼åŒ¹é…çš„æ¬ºè¯ˆæ£€æµ‹ç¤ºä¾‹" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%9b%be%e8%b0%b1%e4%b8%8e%e4%b8%93%e5%ae%b6%e5%9b%be%e6%a8%a1%e5%bc%8f%e5%8c%b9%e9%85%8d%e7%9a%84%e6%ac%ba%e8%af%88%e6%a3%80%e6%b5%8b%e7%a4%ba%e4%be%8b" class="header-mark"></a>1.2.1 åŸºäºå›¾è°±ä¸ä¸“å®¶å›¾æ¨¡å¼åŒ¹é…çš„æ¬ºè¯ˆæ£€æµ‹ç¤ºä¾‹</h4><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬åˆ©ç”¨ Nebula-UP æ¥ä¸€é”®éƒ¨ç½²ä¸€å¥— NebulaGraph å›¾æ•°æ®åº“ï¼š</p>
<blockquote>
<p>æ›´å¤šè¯·å‚è€ƒ <a href="https://github.com/wey-gu/nebula-up/" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/nebula-up/</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -fsSL nebula-up.siwei.io/install.sh <span class="p">|</span> bash
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠå‰è¾¹å»ºæ¨¡çš„å›¾è°±åŠ è½½åˆ° NebulaGraph é‡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># å…‹éš†æ•°æ®é›†ä»£ç ä»“åº“</span>
</span></span><span class="line"><span class="cl">git clone https://github.com/wey-gu/fraud-detection-datagen.git
</span></span><span class="line"><span class="cl">cp -r data_sample_numerical_vertex_id data
</span></span><span class="line"><span class="cl"><span class="c1"># å»æ‰è¡¨å¤´</span>
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;1d&#39;</span> data/*.csv
</span></span><span class="line"><span class="cl">docker run --rm -ti <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --network<span class="o">=</span>nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>:/root/ <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/data/:/data <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    vesoft/nebula-importer:v3.1.0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --config /root/nebula_graph_importer.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº†è¿™æ ·ä¸€ä¸ªå›¾è°±ï¼Œé£æ§ä¸“å®¶å¯ä»¥åœ¨å¯è§†åŒ–æ¢ç´¢å·¥å…·ä¸­æŒ‰éœ€æ¢ç´¢å®ä½“ä¹‹é—´çš„å…³ç³»ï¼Œç»˜åˆ¶ç›¸åº”çš„é£é™©æ¨¡å¼ï¼š</p>
<p><a class="lightgallery" href="./viz_graph_query.webp" title="./viz_graph_query.webp" data-thumbnail="./viz_graph_query.webp">
        
    </a></p>
<p>åœ¨è¿™ä¸ªæ¢ç´¢æˆªå›¾é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ˜æ˜¾çœ‹åˆ°ä¸€ä¸ªç¾¤æ§è®¾å¤‡çš„é£é™©æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼å¯ä»¥è¢«äº¤ç»™å›¾æ•°æ®åº“å¼€å‘è€…ï¼ŒæŠ½è±¡æˆå¯ä»¥è¢«é£æ§åº”ç”¨å®šæœŸã€å®æ—¶æŸ¥è¯¢çš„è¯­å¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GRAPHQL" data-lang="GRAPHQL"><span class="line"><span class="cl"><span class="c">## é’ˆå¯¹ä¸€ç¬”äº¤æ˜“ç”³è¯·å…³è”æŸ¥è¯¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">n</span><span class="p">)</span><span class="w"> </span><span class="py">WHERE</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">n</span><span class="p">)</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&#34;200000010265&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">OPTIONAL</span><span class="w"> </span><span class="py">MATCH</span><span class="w"> </span><span class="py">p_shared_d</span><span class="p">=(</span><span class="py">n</span><span class="p">)</span><span class="err">-</span><span class="p">[:</span><span class="nc">used_device</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">d</span><span class="p">)</span><span class="err">&lt;-</span><span class="p">[:</span><span class="nc">used_device</span><span class="p">]</span><span class="err">-</span><span class="p">(:</span><span class="nc">applicant</span><span class="p">)</span><span class="err">-</span><span class="p">[:</span><span class="nc">with_phone_num</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">pn</span><span class="p">:</span><span class="nc">phone_num</span><span class="p">)</span><span class="err">&lt;-</span><span class="p">[</span><span class="py">e</span><span class="p">:</span><span class="nc">with_phone_num</span><span class="p">]</span><span class="err">-</span><span class="p">(:</span><span class="nc">applicant</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">RETURN</span><span class="w"> </span><span class="py">p_shared_d</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ¨æ­¤æ¨¡å‹ä¹‹ä¸Šï¼Œé€šè¿‡ä¿®æ”¹è¿”å›çš„å…³è”è®¾å¤‡è®¡æ•°ï¼Œä½œä¸ºæ„å‘æŒ‡æ ‡æŸ¥è¯¢çš„åˆ¤æ–­ APIï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-graphql" data-lang="graphql"><span class="line"><span class="cl"><span class="c">## ç¾¤æ§æŒ‡æ ‡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">n</span><span class="p">)</span><span class="w"> </span><span class="py">WHERE</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">n</span><span class="p">)</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&#34;200000010265&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">OPTIONAL</span><span class="w"> </span><span class="py">MATCH</span><span class="w"> </span><span class="py">p_shared_d</span><span class="p">=(</span><span class="py">n</span><span class="p">)</span><span class="err">-</span><span class="p">[:</span><span class="nc">used_device</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">d</span><span class="p">)</span><span class="err">&lt;-</span><span class="p">[:</span><span class="nc">used_device</span><span class="p">]</span><span class="err">-</span><span class="p">(:</span><span class="nc">applicant</span><span class="p">)</span><span class="err">-</span><span class="p">[:</span><span class="nc">with_phone_num</span><span class="p">]</span><span class="err">-&gt;</span><span class="p">(</span><span class="py">pn</span><span class="p">:</span><span class="nc">phone_num</span><span class="p">)</span><span class="err">&lt;-</span><span class="p">[</span><span class="py">e</span><span class="p">:</span><span class="nc">with_phone_num</span><span class="p">]</span><span class="err">-</span><span class="p">(:</span><span class="nc">applicant</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">RETURN</span><span class="w"> </span><span class="py">count</span><span class="p">(</span><span class="py">e</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªç›¸å¯¹æœ‰æ•ˆçš„é£æ§ç³»ç»Ÿï¼Œåˆ©ç”¨æœ‰é™çš„æ ‡æ³¨æ•°æ®å’Œä¸“å®¶èµ„æºï¼Œå»æ›´é«˜æ•ˆæ§åˆ¶å›¢ä¼™æ¬ºè¯ˆä½œæ¡ˆé£é™©ã€‚</p>
<p>å¦ä¸€ä¸ªåˆ©ç”¨æ ‡æ³¨é£é™©èŠ‚ç‚¹çš„æŸ¥è¯¢æ˜¯æ‰¾åˆ°ç›¸å…³è”èŠ‚ç‚¹é«˜é£é™©å±æ€§çš„æ•°é‡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-graphql" data-lang="graphql"><span class="line"><span class="cl"><span class="py">MATCH</span><span class="w"> </span><span class="py">p_</span><span class="p">=(</span><span class="py">p</span><span class="p">:</span><span class="nc">applicant</span><span class="p">)</span><span class="err">-</span><span class="p">[</span><span class="err">*</span><span class="py">1</span><span class="err">.</span><span class="mf">.2</span><span class="p">]</span><span class="err">-</span><span class="p">(</span><span class="py">p2</span><span class="p">:</span><span class="nc">applicant</span><span class="p">)</span><span class="w"> </span><span class="py">WHERE</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">p</span><span class="p">)==</span><span class="s">&#34;200000014810&#34;</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">p2</span><span class="err">.</span><span class="py">applicant</span><span class="err">.</span><span class="py">is_risky</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&#34;True&#34;</span><span class="w"> </span><span class="py">RETURN</span><span class="w"> </span><span class="py">p_</span><span class="w"> </span><span class="py">LIMIT</span><span class="w"> </span><span class="py">100</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥ä»è¿™ä¸ªè·¯å¾„æŸ¥è¯¢çœ‹åˆ° <code>200000014810</code> çš„ç›¸è¿æ¥çš„ç”³è¯·äººä¸­æœ‰ä¸å°‘æ˜¯é«˜é£é™©çš„ï¼ˆä¹Ÿèƒ½çœ‹å‡ºèšé›†çš„ deviceï¼‰ã€‚</p>
<p><a class="lightgallery" href="/fraud-detection-with-nebulagraph/is_risky_label.webp" title="/fraud-detection-with-nebulagraph/is_risky_label.webp" data-thumbnail="/fraud-detection-with-nebulagraph/is_risky_label.webp">
        
    </a></p>
<p>å¦‚æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ç›¸è¿é«˜é£é™©ç‚¹æ•°é‡ä¸ºä¸€ä¸ªæŒ‡æ ‡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-graphql" data-lang="graphql"><span class="line"><span class="cl"><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">p</span><span class="p">:</span><span class="nc">applicant</span><span class="p">)</span><span class="err">-</span><span class="p">[</span><span class="err">*</span><span class="py">1</span><span class="err">.</span><span class="mf">.2</span><span class="p">]</span><span class="err">-</span><span class="p">(</span><span class="py">p2</span><span class="p">:</span><span class="nc">applicant</span><span class="p">)</span><span class="w"> </span><span class="py">WHERE</span><span class="w"> </span><span class="py">id</span><span class="p">(</span><span class="py">p</span><span class="p">)==</span><span class="s">&#34;200000014810&#34;</span><span class="w"> </span><span class="py">AND</span><span class="w"> </span><span class="py">p2</span><span class="err">.</span><span class="py">applicant</span><span class="err">.</span><span class="py">is_risky</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&#34;True&#34;</span><span class="w"> </span><span class="py">RETURN</span><span class="w"> </span><span class="py">count</span><span class="p">(</span><span class="py">p2</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶è€Œï¼Œåœ¨ç°å®æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„å¤§å¤šæ•°æ ‡æ³¨æ•°æ®çš„è·å–è¿˜æ˜¯è¿‡äºæ˜‚è´µï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•æ˜¯æ›´æœ‰æ•ˆåˆ©ç”¨æœ‰é™çš„é£é™©æ ‡æ³¨å’Œå›¾ç»“æ„ï¼Œæ¥é¢„æµ‹å‡ºé£é™©å‘¢ï¼Ÿ</p>
<h3 id="åˆ©ç”¨å›¾æ‰©å……æ ‡æ³¨" class="headerLink">
    <a href="#%e5%88%a9%e7%94%a8%e5%9b%be%e6%89%a9%e5%85%85%e6%a0%87%e6%b3%a8" class="header-mark"></a>1.3 åˆ©ç”¨å›¾æ‰©å……æ ‡æ³¨</h3><p>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œ Xiaojin Z. å’Œ Zoubin G. åœ¨è®ºæ–‡ï¼š<a href="http://mlg.eng.cam.ac.uk/zoubin/papers/CMU-CALD-02-107.pdf" target="_blank" rel="noopener noreferrer">Learning from Labeled and Unlabeled Data with Label Propagation</a> ï¼ˆCMU-CALD-02-107ï¼‰ä¸­ï¼Œåˆ©ç”¨æ ‡ç­¾ä¼ æ’­ï¼ˆLabel Propagationï¼‰ç®—æ³•æ¥æŠŠæœ‰é™çš„æ ‡æ³¨ä¿¡æ¯åœ¨å›¾ä¸Šé€šè¿‡å…³è”å…³ç³»ä¼ æ’­åˆ°æ›´å¤šå®ä½“ä¸­ã€‚</p>
<p>è¿™æ ·ï¼Œåœ¨æˆ‘ä»¬å»ºç«‹çš„å›¾è°±ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å€ŸåŠ©æœ‰é™çš„é«˜é£é™©æ ‡æ³¨ï¼Œå»â€œä¼ æ’­â€äº§ç”Ÿæ›´å¤šçš„æ ‡æ³¨ä¿¡æ¯ã€‚è¿™äº›æ‰©å±•å‡ºæ¥çš„æ ‡æ³¨ä¿¡æ¯ä¸€æ–¹é¢å¯ä»¥åœ¨å®æ—¶çš„å›¾æŸ¥è¯¢ä¸­ç»™å‡ºæ›´å¤šçš„ç»“æœï¼Œå¦ä¸€æ–¹é¢ï¼Œå®ƒè¿˜èƒ½ä½œä¸ºé£æ§ä¸“å®¶é‡è¦çš„è¾“å…¥ä¿¡æ¯ï¼Œå¸®åŠ©æ¨è¿›åæ¬ºè¯ˆè°ƒæŸ¥è¡ŒåŠ¨çš„å¼€å±•ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®šæœŸç¦»çº¿åœ°å…¨å›¾æ‰«ææ•°æ®ï¼Œé€šè¿‡å›¾ç®—æ³•æ‰©å……ã€æ›´æ–°æ ‡æ³¨ï¼Œå†å°†æœ‰æ•ˆçš„æ›´æ–°æ ‡æ³¨å†™å›åˆ°å›¾è°±ä¹‹ä¸­ã€‚</p>
<blockquote>
<p>æ³¨ï¼Œç±»ä¼¼çš„æ–¹æ³•è¿˜æœ‰ SIGNDiffusionï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»äº†è§£ä¸€ä¸‹ã€‚</p>
</blockquote>
<h4 id="å›¾ç®—æ³•æ‰©å……æ¬ºè¯ˆé£é™©æ ‡æ³¨çš„ç¤ºä¾‹" class="headerLink">
    <a href="#%e5%9b%be%e7%ae%97%e6%b3%95%e6%89%a9%e5%85%85%e6%ac%ba%e8%af%88%e9%a3%8e%e9%99%a9%e6%a0%87%e6%b3%a8%e7%9a%84%e7%a4%ba%e4%be%8b" class="header-mark"></a>1.3.1 å›¾ç®—æ³•æ‰©å……æ¬ºè¯ˆé£é™©æ ‡æ³¨çš„ç¤ºä¾‹</h4><p>ä¸‹é¢ï¼Œæˆ‘ç»™å‡ºä¸€ä¸ªå¯ä»¥è·‘é€šçš„æ¡ˆä¾‹ï¼š</p>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ç”¨åˆ°äº† Yelp è¿™ä¸ªæ¬ºè¯ˆè¯†åˆ«çš„ç»å…¸æ•°æ®ï¼Œè¿™ä»½æ•°æ®ä¸åªä¼šç”¨åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåè¾¹ GNN æ–¹æ³•ä¸­çš„æ¡ˆä¾‹æˆ‘ä¹Ÿä¼šç”¨åˆ°å®ƒï¼Œæ‰€ä»¥å¤§å®¶å¯ä»¥è€å¿ƒæŠŠæ•°æ®å¯¼å…¥ NebulaGraphã€‚</p>
<p>å¯¼å…¥æ•°æ®åˆ°å›¾åº“</p>
<blockquote>
<p>ç”Ÿæˆå¯¼å…¥çš„æ–¹æ³•åœ¨è¿™é‡Œï¼Œhttps://github.com/wey-gu/nebulagraph-yelp-frauddetection</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ~
</span></span><span class="line"><span class="cl">git clone https://github.com/wey-gu/nebulagraph-yelp-frauddetection
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> nebulagraph-yelp-frauddetection
</span></span><span class="line"><span class="cl">python3 -m pip install -r requirements.txt
</span></span><span class="line"><span class="cl">python3 data_download.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯¼å…¥å›¾åº“</span>
</span></span><span class="line"><span class="cl">docker run --rm -ti <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --network<span class="o">=</span>nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/yelp_nebulagraph_importer.yaml:/root/importer.yaml <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/data:/root <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    vesoft/nebula-importer:v3.1.0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --config /root/importer.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æŸä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹å›¾ä¸Šçš„ç»Ÿè®¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">~/.nebula-up/console.sh -e <span class="s2">&#34;USE yelp; SHOW STATS&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>root@nebula<span class="o">)</span> <span class="o">[(</span>none<span class="o">)]</span>&gt; USE yelp<span class="p">;</span> SHOW STATS
</span></span><span class="line"><span class="cl">+---------+---------------------------------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Type    <span class="p">|</span> Name                                  <span class="p">|</span> Count   <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------+---------------------------------------+---------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Tag&#34;</span>   <span class="p">|</span> <span class="s2">&#34;review&#34;</span>                              <span class="p">|</span> <span class="m">45954</span>   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Edge&#34;</span>  <span class="p">|</span> <span class="s2">&#34;shares_restaurant_in_one_month_with&#34;</span> <span class="p">|</span> <span class="m">1147232</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Edge&#34;</span>  <span class="p">|</span> <span class="s2">&#34;shares_restaurant_rating_with&#34;</span>       <span class="p">|</span> <span class="m">6805486</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Edge&#34;</span>  <span class="p">|</span> <span class="s2">&#34;shares_user_with&#34;</span>                    <span class="p">|</span> <span class="m">98630</span>   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Space&#34;</span> <span class="p">|</span> <span class="s2">&#34;vertices&#34;</span>                            <span class="p">|</span> <span class="m">45954</span>   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="s2">&#34;Space&#34;</span> <span class="p">|</span> <span class="s2">&#34;edges&#34;</span>                               <span class="p">|</span> <span class="m">8051348</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------+---------------------------------------+---------+
</span></span><span class="line"><span class="cl">Got <span class="m">6</span> rows <span class="o">(</span><span class="nb">time</span> spent 1911/4488 us<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›®å‰ï¼Œå¸‚é¢ä¸Šçš„ LPA æ ‡ç­¾ä¼ æ’­ç®—æ³•éƒ½æ˜¯ç”¨æ¥åšç¤¾åŒºæ£€æµ‹çš„ï¼Œå¾ˆå°‘æœ‰å®ç°æ˜¯ç”¨æ¥åšæ ‡ç­¾æ‹“å±•çš„ï¼ˆåªæœ‰ SK-Learn ä¸­æœ‰è¿™ä¸ªå®ç°ï¼‰ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬å‚è€ƒ <a href="https://datascience.stackexchange.com/users/77683/thibaud-m" target="_blank" rel="noopener noreferrer">Thibaud M</a> ç»™å‡ºæ¥çš„å®ç°ã€‚</p>
<blockquote>
<p>åŸå§‹çš„è®¨è®ºå‚è€ƒï¼šhttps://datascience.stackexchange.com/a/55720/138720</p>
</blockquote>
<p>ä¸ºäº†è®©è¿™ä¸ªç®—æ³•è·‘çš„å¿«ä¸€ç‚¹ï¼Œä¼šä» NebulaGraph é‡Œå–ä¸€ä¸ªç‚¹çš„å­å›¾ï¼Œåœ¨è¿™ä¸ªå°çš„å­å›¾ä¸Šåšæ ‡æ³¨çš„æ‰©å……ï¼š</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª Jupyter çš„ Playgroundï¼Œ</p>
<blockquote>
<p>å‚è€ƒ <a href="https://github.com/wey-gu/nebula-dgl" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/nebula-dgl</a> ä¸­çš„ Playground è¿‡ç¨‹ï¼š</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/wey-gu/nebula-dgl.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> nebula-dgl
</span></span><span class="line"><span class="cl"><span class="c1"># è¿è¡Œ Jupyter Notebook</span>
</span></span><span class="line"><span class="cl">docker run -it --name dgl -p 8888:8888 --network nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v <span class="s2">&#34;</span><span class="nv">$PWD</span><span class="s2">&#34;</span>:/home/jovyan/work jupyter/datascience-notebook <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    start-notebook.sh --NotebookApp.token<span class="o">=</span><span class="s1">&#39;nebulagraph&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®¿é—®ï¼šhttp://localhost:8888/lab/tree/work?token=nebulagraph</p>
<p>å®‰è£…ä¾èµ–ï¼ˆè¿™äº›ä¾èµ–åœ¨åè¾¹çš„ GNN ä¾‹å­ä¸­ä¹Ÿä¼šè¢«ç”¨åˆ°ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">!</span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">vesoft</span><span class="o">-</span><span class="n">inc</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">python</span><span class="o">.</span><span class="n">git</span><span class="o">@</span><span class="mi">8</span><span class="n">c328c534413b04ccecfd42e64ce6491e09c6ca8</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬ä»å›¾ä¸­è¯»å–ä¸€ä¸ªå­å›¾ï¼Œä» <code>2048</code> è¿™ä¸ªç‚¹å¼€å§‹æ¢ç´¢ä¸¤æ­¥å†…çš„æ‰€æœ‰è¾¹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">tensor</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dgl</span> <span class="kn">import</span> <span class="n">DGLHeteroGraph</span><span class="p">,</span> <span class="n">heterograph</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula3.gclient.net</span> <span class="kn">import</span> <span class="n">ConnectionPool</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula3.Config</span> <span class="kn">import</span> <span class="n">Config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">config</span><span class="o">.</span><span class="n">max_connection_pool_size</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">ConnectionPool</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">connection_pool</span><span class="o">.</span><span class="n">init</span><span class="p">([(</span><span class="s1">&#39;graphd&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">)],</span> <span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">vertex_id</span> <span class="o">=</span> <span class="mi">2048</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;nebula&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">execute_json</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;USE yelp;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="sa">f</span><span class="s2">&#34;GET SUBGRAPH WITH PROP 2 STEPS FROM </span><span class="si">{</span><span class="n">vertex_id</span><span class="si">}</span><span class="s2"> YIELD VERTICES AS nodes, EDGES AS relationships;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># create node and nodedata</span>
</span></span><span class="line"><span class="cl"><span class="n">node_id_map</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key: vertex id in NebulaGraph, value: node id in dgl_graph</span>
</span></span><span class="line"><span class="cl"><span class="n">node_idx</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">features</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[[]]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="n">nodeid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">nodeid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_id_map</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">node_id_map</span><span class="p">[</span><span class="n">nodeid</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_idx</span>
</span></span><span class="line"><span class="cl">            <span class="n">node_idx</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">features</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;row&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="sa">f</span><span class="s2">&#34;review.f</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">features</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;row&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;review.is_fraud&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rur_start</span><span class="p">,</span> <span class="n">rur_end</span><span class="p">,</span> <span class="n">rsr_start</span><span class="p">,</span> <span class="n">rsr_end</span><span class="p">,</span> <span class="n">rtr_start</span><span class="p">,</span> <span class="n">rtr_end</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="n">edge</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shares_user_with&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rur_start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">            <span class="n">rur_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rsr_start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">            <span class="n">rsr_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rtr_start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">            <span class="n">rtr_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">rur_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_dict</span><span class="p">[(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="s1">&#39;shares_user_with&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rur_start</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rur_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">rsr_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_dict</span><span class="p">[(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rsr_start</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rsr_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">rtr_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_dict</span><span class="p">[(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rtr_start</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rtr_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># construct a dgl_graph, ref: https://docs.dgl.ai/en/0.9.x/generated/dgl.heterograph.html</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="p">:</span> <span class="n">DGLHeteroGraph</span> <span class="o">=</span> <span class="n">heterograph</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># load node features to dgl_graph</span>
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="mi">32</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># heterogeneous graph to heterogeneous graph, keep ndata and edata</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">dgl</span>
</span></span><span class="line"><span class="cl"><span class="n">hg</span> <span class="o">=</span> <span class="n">dgl</span><span class="o">.</span><span class="n">to_homogeneous</span><span class="p">(</span><span class="n">dgl_graph</span><span class="p">,</span> <span class="n">ndata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬ç”¨ä¸Šè¾¹æåˆ°çš„ Torch Label Spreading å®ç°ï¼Œåº”ç”¨åˆ°æˆ‘ä»¬çš„å›¾ä¸Šã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseLabelPropagation</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Base class for label propagation models.
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    adj_matrix: torch.FloatTensor
</span></span></span><span class="line"><span class="cl"><span class="s2">        Adjacency matrix of the graph.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adj_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">norm_adj_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="n">adj_matrix</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span> <span class="o">=</span> <span class="kc">None</span> 
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">labeled_mask</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@staticmethod</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@abstractmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_normalize</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&#34;_normalize must be implemented&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@abstractmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_propagate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&#34;_propagate must be implemented&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_one_hot_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Get the number of classes</span>
</span></span><span class="line"><span class="cl">        <span class="n">classes</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">classes</span> <span class="o">=</span> <span class="n">classes</span><span class="p">[</span><span class="n">classes</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span> <span class="o">=</span> <span class="n">classes</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># One-hot encode labeled data instances and zero rows corresponding to unlabeled instances</span>
</span></span><span class="line"><span class="cl">        <span class="n">unlabeled_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>  <span class="c1"># defensive copying</span>
</span></span><span class="line"><span class="cl">        <span class="n">labels</span><span class="p">[</span><span class="n">unlabeled_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">labels</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span><span class="p">[</span><span class="n">unlabeled_mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">labeled_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">unlabeled_mask</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span> <span class="n">tol</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Fits a semi-supervised learning label propagation model.
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">        labels: torch.LongTensor
</span></span></span><span class="line"><span class="cl"><span class="s2">            Tensor of size n_nodes indicating the class number of each node.
</span></span></span><span class="line"><span class="cl"><span class="s2">            Unlabeled nodes are denoted with -1.
</span></span></span><span class="line"><span class="cl"><span class="s2">        max_iter: int
</span></span></span><span class="line"><span class="cl"><span class="s2">            Maximum number of iterations allowed.
</span></span></span><span class="line"><span class="cl"><span class="s2">        tol: float
</span></span></span><span class="line"><span class="cl"><span class="s2">            Convergence tolerance: threshold to consider the system at steady state.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_one_hot_encode</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">prev_predictions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Stop iterations if the system is considered at a steady state</span>
</span></span><span class="line"><span class="cl">            <span class="n">variation</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span> <span class="o">-</span> <span class="n">prev_predictions</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">variation</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;The method stopped after </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> iterations, variation=</span><span class="si">{</span><span class="n">variation</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">prev_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_propagate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">predict_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">indices</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LabelPropagation</span><span class="p">(</span><span class="n">BaseLabelPropagation</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adj_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@staticmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_normalize</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Computes D^-1 * W&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">degs</span> <span class="o">=</span> <span class="n">adj_matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">degs</span><span class="p">[</span><span class="n">degs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># avoid division by 0 error</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">adj_matrix</span> <span class="o">/</span> <span class="n">degs</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_propagate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm_adj_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Put back already known labels</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_mask</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_mask</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LabelSpreading</span><span class="p">(</span><span class="n">BaseLabelPropagation</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adj_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@staticmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_normalize</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Computes D^-1/2 * W * D^-1/2&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">degs</span> <span class="o">=</span> <span class="n">adj_matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">norm</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">degs</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">norm</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">norm</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">adj_matrix</span> <span class="o">*</span> <span class="n">norm</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">norm</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_propagate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm_adj_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_labels</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">        ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">        alpha: float
</span></span></span><span class="line"><span class="cl"><span class="s2">            Clamping factor.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">nx_hg</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">to_networkx</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">adj_matrix</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">adjacency_matrix</span><span class="p">(</span><span class="n">nx_hg</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">labels</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Create input tensors</span>
</span></span><span class="line"><span class="cl"><span class="n">adj_matrix_t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">labels_t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Learn with Label Propagation</span>
</span></span><span class="line"><span class="cl"><span class="n">label_propagation</span> <span class="o">=</span> <span class="n">LabelPropagation</span><span class="p">(</span><span class="n">adj_matrix_t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Label Propagation: &#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">label_propagation</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">labels_t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">label_propagation_output_labels</span> <span class="o">=</span> <span class="n">label_propagation</span><span class="o">.</span><span class="n">predict_classes</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Learn with Label Spreading</span>
</span></span><span class="line"><span class="cl"><span class="n">label_spreading</span> <span class="o">=</span> <span class="n">LabelSpreading</span><span class="p">(</span><span class="n">adj_matrix_t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Label Spreading: &#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">label_spreading</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">labels_t</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">label_spreading_output_labels</span> <span class="o">=</span> <span class="n">label_spreading</span><span class="o">.</span><span class="n">predict_classes</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨å’±ä»¬çœ‹çœ‹æŸ“è‰²çš„ä¼ æ’­æ•ˆæœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">color_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&#34;blue&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&#34;green&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">input_labels_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_map</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">lprop_labels_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_map</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">label_propagation_output_labels</span><span class="o">.</span><span class="n">numpy</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl"><span class="n">lspread_labels_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_map</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">label_spreading_output_labels</span><span class="o">.</span><span class="n">numpy</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&#34;Raw data (2 classes)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&#34;Label Propagation&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&#34;Label Spreading&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">nx_hg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">nx_hg</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">input_labels_colors</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">nx_hg</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">lprop_labels_colors</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">nx_hg</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">lspread_labels_colors</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Legend</span>
</span></span><span class="line"><span class="cl"><span class="n">ax4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&#34;off&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">legend_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;orange&#34;</span><span class="p">,</span> <span class="s2">&#34;blue&#34;</span><span class="p">,</span> <span class="s2">&#34;green&#34;</span><span class="p">,</span> <span class="s2">&#34;red&#34;</span><span class="p">,</span> <span class="s2">&#34;cyan&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">legend_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;unlabeled&#34;</span><span class="p">,</span> <span class="s2">&#34;class 0&#34;</span><span class="p">,</span> <span class="s2">&#34;class 1&#34;</span><span class="p">,</span> <span class="s2">&#34;class 2&#34;</span><span class="p">,</span> <span class="s2">&#34;class 3&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">dummy_legend</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">legend_colors</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">dummy_legend</span><span class="p">,</span> <span class="n">legend_labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°æœ€åç”»å‡ºæ¥çš„ç»“æœï¼š</p>
<p><a class="lightgallery" href="./lpa_spread_notation_matplot.webp" title="./lpa_spread_notation_matplot.webp" data-thumbnail="./lpa_spread_notation_matplot.webp">
        
    </a></p>
<p>å¯ä»¥çœ‹åˆ°æœ‰ä¸€äº›è“è‰²æ ‡ç­¾è¢« Spread å¼€äº†ï¼Œå®é™…ä¸Šæˆ‘çš„è¿™ä¸ªä¾‹å­çš„æ•ˆæœå¹¶ä¸ç†æƒ³ï¼ˆå› ä¸ºè¿™ä¸ªä¾‹å­æï¼Œç»¿è‰²çš„æ‰æ˜¯é‡è¦çš„æ ‡ç­¾ï¼‰ï¼Œä¸è¿‡æˆ‘ç»™çš„å­å›¾å®åœ¨æ˜¯å¤ªå°äº†ï¼Œä¹Ÿæœ¬ä¸åº”è¯¥å¥¢æ±‚æœ‰å¥½çš„ç»“æœï¼Œåªæ˜¯ä¸ºäº†ä¸ªå¤§å®¶æ¼”ç¤ºä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚</p>
<h3 id="å¸¦æœ‰å›¾ç‰¹å¾çš„æœºå™¨å­¦ä¹ " class="headerLink">
    <a href="#%e5%b8%a6%e6%9c%89%e5%9b%be%e7%89%b9%e5%be%81%e7%9a%84%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0" class="header-mark"></a>1.4 å¸¦æœ‰å›¾ç‰¹å¾çš„æœºå™¨å­¦ä¹ </h3><p>åœ¨é£æ§é¢†åŸŸå¼€å§‹åˆ©ç”¨å›¾çš„æ€æƒ³å’Œèƒ½åŠ›ä¹‹å‰ï¼Œå·²ç»æœ‰å¾ˆå¤šåˆ©ç”¨æœºå™¨å­¦ä¹ çš„åˆ†ç±»ç®—æ³•åŸºäºå†å²æ•°æ®é¢„æµ‹é«˜é£é™©è¡Œä¸ºçš„æ–¹æ³•äº†ï¼Œè¿™äº›æ–¹æ³•æŠŠè®°å½•ä¸­é¢†åŸŸä¸“å®¶è®¤ä¸ºæœ‰å…³çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼šå¹´é¾„ã€å­¦å†ã€æ”¶å…¥ï¼‰ä½œä¸ºç‰¹å¾ï¼Œå†å²æ ‡æ³¨ä¿¡æ¯ä½œä¸ºæ ‡ç­¾å»è®­ç»ƒé£é™©é¢„æµ‹æ¨¡å‹ã€‚</p>
<p>é‚£ä¹ˆè¯»åˆ°çš„è¿™é‡Œï¼Œæˆ‘ä»¬æ˜¯å¦ä¼šæƒ³åˆ°åœ¨è¿™äº›æ–¹æ³•çš„åŸºç¡€ä¹‹ä¸Šï¼Œå¦‚æœæŠŠåŸºäºå›¾ç»“æ„çš„å±æ€§ä¹Ÿè€ƒè™‘è¿›æ¥ï¼Œä½œä¸ºç‰¹å¾å»è®­ç»ƒçš„æ¨¡å‹å¯èƒ½æ›´æœ‰æ•ˆå‘¢ï¼Ÿç­”æ¡ˆä¹Ÿæ˜¯è‚¯å®šçš„ï¼Œå·²ç»æœ‰å¾ˆå¤šè®ºæ–‡å’Œå·¥ç¨‹å®è·µæ­ç¤ºè¿™æ ·çš„æ¨¡å‹æ¯”æœªè€ƒè™‘å›¾ç‰¹å¾çš„ç®—æ³•æ›´åŠ æœ‰æ•ˆï¼šè¿™äº›è¢«å°è¯•æœ‰æ•ˆçš„å›¾ç»“æ„ç‰¹å¾å¯èƒ½æ˜¯å®ä½“çš„ PageRank å€¼ã€Degree å€¼æˆ–è€…æ˜¯æŸä¸€ä¸ªç¤¾åŒºå‘ç°ç®—æ³•å¾—å‡ºçš„ç¤¾åŒº idã€‚</p>
<p>åœ¨ç”Ÿäº§ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å®šæœŸä»å›¾è°±ä¸­è·å¾—å®æ—¶çš„å…¨å›¾ä¿¡æ¯ï¼Œåœ¨å›¾è®¡ç®—å¹³å°ä¸­åˆ†æè¿ç®—è·å¾—æ‰€éœ€ç‰¹å¾ï¼Œç»è¿‡é¢„å®šçš„æ•°æ®ç®¡é“ï¼Œå¯¼å…¥æœºå™¨å­¦ä¹ æ¨¡å‹ä¸­å‘¨æœŸè·å¾—æ–°çš„é£é™©æç¤ºï¼Œå¹¶å°†éƒ¨åˆ†ç»“æœå†™å›å›¾è°±æ–¹ä¾¿å…¶ä»–ç³»ç»Ÿå’Œä¸“å®¶æŠ½å–ã€å‚è€ƒã€‚</p>
<h4 id="å¸¦æœ‰å›¾ç‰¹å¾çš„æœºå™¨å­¦ä¹ æ¬ºè¯ˆæ£€æµ‹ç¤ºä¾‹" class="headerLink">
    <a href="#%e5%b8%a6%e6%9c%89%e5%9b%be%e7%89%b9%e5%be%81%e7%9a%84%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e6%ac%ba%e8%af%88%e6%a3%80%e6%b5%8b%e7%a4%ba%e4%be%8b" class="header-mark"></a>1.4.1 å¸¦æœ‰å›¾ç‰¹å¾çš„æœºå™¨å­¦ä¹ æ¬ºè¯ˆæ£€æµ‹ç¤ºä¾‹</h4><p>è¿™é‡Œï¼Œæœºå™¨å­¦ä¹ çš„æ–¹æ³•æˆ‘å°±ä¸æ¼”ç¤ºäº†ï¼Œå°±æ˜¯å¸¸è§çš„åˆ†ç±»æ–¹æ³•ï¼Œåœ¨æ­¤ä¹‹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®ä¸­é€šè¿‡å›¾ç®—æ³•è·å¾—ä¸€äº›æ–°çš„å±æ€§ï¼Œè¿™äº›å±æ€§å†å¤„ç†ä¸€ä¸‹ä½œä¸ºæ–°çš„ç‰¹å¾ã€‚æˆ‘åªæ¼”ç¤ºä¸€ä¸ªç¤¾åŒºå‘ç°çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¨å›¾è·‘ä¸€ä¸ª Louvainï¼Œå¾—å‡ºä¸åŒèŠ‚ç‚¹çš„ç¤¾åŒºå½’å±ï¼Œç„¶åæŠŠç¤¾åŒºçš„å€¼å½“åšä¸€ä¸ªåˆ†ç±»å¤„ç†æˆä¸ºæ•°å€¼çš„ç‰¹å¾ã€‚</p>
<p>è¿™ä¸ªä¾‹å­é‡Œæˆ‘ä»¬è¿˜ç”¨ <a href="https://github.com/wey-gu/fraud-detection-datagen" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/fraud-detection-datagen</a> è¿™ä¸ªæ•°æ®ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¿™ä¸ªä¾‹å­æˆ‘ç”¨åˆ°äº† <a href="https://github.com/vesoft-inc/nebula-algorithm/" target="_blank" rel="noopener noreferrer">Nebula-Algorithm</a> è¿™ä¸ªé¡¹ç›®ï¼Œå®ƒæ˜¯ä¸€ä¸ª Spark åº”ç”¨ï¼Œå¯ä»¥åœ¨ NebulaGraph å›¾åº“ä¸Šè¿è¡Œå¾ˆå¤šå¸¸ç”¨çš„å›¾ç®—æ³•ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éƒ¨ç½² Spark å’Œ Nebula Algorithmï¼Œè¿˜æ˜¯åˆ©ç”¨ Nebula-UPï¼Œä¸€é”®éƒ¨ç½²ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -fsSL nebula-up.siwei.io/all-in-one.sh <span class="p">|</span> bash -s -- v3 spark
</span></span></code></pre></td></tr></table>
</div>
</div><p>é›†ç¾¤èµ·æ¥ä¹‹åï¼Œå› ä¸ºéœ€è¦çš„é…ç½®æ–‡ä»¶æˆ‘å·²ç»æ”¾åœ¨äº† Nebula-UP å†…éƒ¨ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€è¡Œå°±å¯ä»¥è¿è¡Œç®—æ³•å•¦ï¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ~/.nebula-up/nebula-up/spark <span class="o">&amp;&amp;</span> ls -l
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -it sparkmaster /spark/bin/spark-submit <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --master <span class="s2">&#34;local&#34;</span> --conf spark.rpc.askTimeout<span class="o">=</span>6000s <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --class com.vesoft.nebula.algorithm.Main <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --driver-memory 4g /root/download/nebula-algo.jar <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -p /root/louvain.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>è€Œæœ€ç»ˆçš„ç»“æœå°±åœ¨ sparkmaster å®¹å™¨å†…çš„ <code>/output</code> é‡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># docker exec -it sparkmaster bash</span>
</span></span><span class="line"><span class="cl">ls -l /output
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¿™ä¸ª Louvain çš„å›¾ç‰¹å¾åšä¸€äº›å¤„ç†ï¼Œå¹¶å¼€å§‹ä¼ ç»Ÿçš„æ¨¡å‹è®­ç»ƒäº†ã€‚</p>
<h3 id="å›¾ç¥ç»ç½‘ç»œçš„æ–¹æ³•" class="headerLink">
    <a href="#%e5%9b%be%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c%e7%9a%84%e6%96%b9%e6%b3%95" class="header-mark"></a>1.5 å›¾ç¥ç»ç½‘ç»œçš„æ–¹æ³•</h3><p>ç„¶è€Œï¼Œè¿™äº›å›¾ç‰¹å¾çš„æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼š</p>
<ol>
<li>å›¾ç‰¹å¾å¹¶ä¸èƒ½æŠŠå…³è”å…³ç³»ï¼Œæ•°æ®çš„å±€éƒ¨æ€§å……åˆ†åæ˜ åˆ°æˆ‘ä»¬çš„æ¨¡å‹ã€æ–¹æ³•é‡Œï¼›</li>
<li>å›¾çš„ç‰¹å¾å·¥ç¨‹æ˜¯å¾ˆæ˜‚è´µã€ç¹ççš„ã€‚</li>
</ol>
<p>åœ¨æœ€è¿‘å‡ å¹´çš„æˆæœä¸­ï¼ŒåŸºäº GNN çš„æ–¹æ³•é€šè¿‡å°†å›¾ç»“æ„ä¸å±æ€§ä¿¡æ¯è¿›è¡ŒåµŒå…¥è¡¨ç¤ºï¼Œä½¿å¾—æˆ‘ä»¬èƒ½åœ¨ä¸è¿›è¡Œå›¾ç‰¹å¾æŠ½å–ã€ç‰¹å¾å·¥ç¨‹ã€ä¸“å®¶ä¸å·¥ç¨‹æ–¹æ³•çš„æ•°æ®æ ‡æ³¨çš„æƒ…å†µä¸‹ï¼Œå¾—åˆ°ç›¸æ¯”äºåŸºäºä¼ ç»Ÿå›¾ç‰¹å¾çš„æœºå™¨å­¦ä¹ æ›´å¥½çš„æ•ˆæœã€‚æœ‰æ„æ€çš„æ˜¯ï¼Œç°åœ¨æ­£æ˜¯è¿™äº›æ–¹æ³•å¿«é€Ÿè¢«å‘ç°ã€æ¼”è¿›çš„æ—¶æœŸï¼ŒåŸºäºå›¾çš„æ·±åº¦å­¦ä¹ æ˜¯ä¹‹å‰å‡ å¹´æœ€çƒ­é—¨çš„æœºå™¨å­¦ä¹ ç ”ç©¶æ–¹å‘ä¹‹ä¸€ã€‚</p>
<p>åŒæ—¶ï¼Œå›¾æ·±åº¦å­¦ä¹ çš„ä¸€äº›æ–¹æ³•å¯ä»¥åšåˆ° Inductive Learningâ€”â€”æ¨¡å‹å¯ä»¥åœ¨æ–°çš„ç‚¹ã€è¾¹ä¸Šè¿›è¡Œæ¨ç†ï¼Œè¿™æ ·ï¼Œé…åˆå›¾æ•°æ®åº“ä¸Šçº¿ä¸Šçš„å­å›¾æŸ¥è¯¢èƒ½åŠ›ï¼Œåœ¨çº¿å®æ—¶çš„é£é™©é¢„æµ‹ä¹Ÿå˜å¾—å¾ˆç®€å•å¯è¡Œäº†ã€‚</p>
<h4 id="åŸºäºå›¾è¡¨ç¤ºçš„å›¾ç¥ç»ç½‘ç»œæ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿç¤ºä¾‹" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%9b%be%e8%a1%a8%e7%a4%ba%e7%9a%84%e5%9b%be%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c%e6%ac%ba%e8%af%88%e6%a3%80%e6%b5%8b%e7%b3%bb%e7%bb%9f%e7%a4%ba%e4%be%8b" class="header-mark"></a>1.5.1 åŸºäºå›¾è¡¨ç¤ºçš„å›¾ç¥ç»ç½‘ç»œæ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿç¤ºä¾‹</h4><p>åˆ©ç”¨ GNN çš„æ–¹æ³•ä¸­ï¼Œå›¾æ•°æ®åº“å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œæ•°æ®çš„å­˜å‚¨å¯ä»¥åœ¨å…¶ä»–å‡ ç§å¸¸è§çš„ä»‹è´¨ä¹‹ä¸­ï¼Œä½†æ˜¯å›¾åº“èƒ½å¤Ÿæœ€å¤§åŒ–åŠ©ç›Šæ¨¡å‹è®­ç»ƒã€æ¨¡å‹æ›´æ–°ã€çº¿ä¸Šç»“æœçš„æ›´æ–°ã€‚å½“æˆ‘ä»¬æŠŠå›¾æ•°æ®åº“ä½œä¸ºæ•°æ®çš„å•ä¸€æ•°æ®æ¥æºï¼ˆsingle source of truthï¼‰çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„åŸºäºçº¿ä¸Šã€ç¦»çº¿ã€å›¾è°±çš„æ–¹æ³•å¯ä»¥å¾ˆå®¹æ˜“è¢«é›†æˆèµ·æ¥ï¼Œä»è€Œç»„åˆæ‰€æœ‰æ–¹æ³•çš„ä¼˜åŠ¿ä¸ç»“æœï¼Œåšå‡ºæ›´æœ‰æ•ˆçš„æ¬ºè¯ˆæ£€æµ‹å¤åˆç³»ç»Ÿã€‚</p>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­æˆ‘ä»¬ä¸€æ ·åˆ†ä¸ºï¼š<strong>æ•°æ®å¤„ç†</strong>ã€<strong>æ¨¡å‹è®­ç»ƒ</strong>ã€<strong>æ„å»ºæ£€æµ‹ç³»ç»Ÿ</strong>è¿™å‡ éƒ¨åˆ†ã€‚</p>
<blockquote>
<p>æ³¨ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨çš„çš„å·¥å…·ä¸º Deep Graph libraryï¼ˆDGLï¼‰ï¼ŒNebulaGraph å›¾æ•°æ®åº“å’Œä»–ä»¬ä¹‹é—´çš„æ¡¥æ¢ï¼ŒNebula-DGLã€‚</p>
<ul>
<li>DGL: <a href="https://www.dgl.ai/" target="_blank" rel="noopener noreferrer">https://www.dgl.ai/</a></li>
<li>Nebula-DGL: <a href="https://github.com/wey-gu/nebula-dgl" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/nebula-dgl</a> æˆ‘ä¹Ÿæ˜¯è¿™ä¸ªåº“çš„ä½œè€… ğŸ˜</li>
</ul>
</blockquote>
<h5 id="æ•°æ®é›†" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e9%9b%86" class="header-mark"></a>1.5.1.1 æ•°æ®é›†</h5><p>æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ•°æ®é›†æ˜¯ Yelp-Fraudï¼Œä»–ç›´æ¥æ¥è‡ªäºè®ºæ–‡ <a href="https://paperswithcode.com/paper/enhancing-graph-neural-network-based-fraud" target="_blank" rel="noopener noreferrer">Enhancing Graph Neural Network-based Fraud Detectors against Camouflaged Fraudsters</a>ã€‚</p>
<p>è¿™ä¸ªå›¾ä¸­æœ‰ä¸€ç§ç‚¹ï¼Œä¸‰ç§å…³ç³»ï¼š</p>
<ul>
<li>é¡¶ç‚¹ï¼šæ¥è‡ª Yelp ä¸­çš„é¤å…ã€é…’åº—çš„è¯„ä»·ï¼Œæœ‰ä¸¤ç±»å±æ€§ï¼š
<ul>
<li>æ¯ä¸€ä¸ªè¯„ä»·ä¸­æœ‰è¢«æ ‡æ³¨äº†çš„æ˜¯å¦æ˜¯è™šå‡ã€æ¬ºè¯ˆè¯„ä»·çš„æ ‡ç­¾</li>
<li>32 ä¸ªå·²ç»è¢«å¤„ç†è¿‡çš„æ•°å­—å‹å±æ€§</li>
</ul>
</li>
<li>è¾¹ï¼šä¸‰ç±»è¯„ä»·ä¹‹é—´çš„å…³è”å…³ç³»
<ul>
<li>R-U-Rï¼šä¸¤ä¸ªè¯„ä»·ç”±åŒä¸€ä¸ªç”¨æˆ·å‘å‡º shares_user_with</li>
<li>R-S-Rï¼šä¸¤ä¸ªè¯„ä»·æ˜¯åŒé¤å…åŒè¯„åˆ†ï¼ˆè¯„åˆ†å¯ä»¥æ˜¯1åˆ°5ï¼‰ shares_restaurant_rating_with</li>
<li>R-T-Rï¼šä¸¤ä¸ªè¯„ä»·æ˜¯åŒé¤å…åŒæäº¤æœˆä»½ shares_restaurant_in_one_month_with</li>
</ul>
</li>
</ul>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å‡è®¾è¿™ä¸ªå›¾å·²ç»åœ¨æˆ‘ä»¬çš„ NebulaGraph é‡Œè¾¹äº†ã€‚</p>
<blockquote>
<p>æ³¨ï¼Œæˆ‘å·²ç»å¸®å¤§å®¶æå‰åšå¥½äº†å°†è¿™å¼ å›¾å¯¼å…¥ NebulaGraph çš„å·¥ä½œï¼Œé•¿è¯çŸ­è¯´å°±æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># éƒ¨ç½² NebulaGraph</span>
</span></span><span class="line"><span class="cl">curl -fsSL nebula-up.siwei.io/install.sh <span class="p">|</span> bash
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ‹‰å–è¿™ä¸ªæ•°æ®çš„ Repo</span>
</span></span><span class="line"><span class="cl">git clone https://github.com/wey-gu/nebulagraph-yelp-frauddetection <span class="o">&amp;&amp;</span> <span class="nb">cd</span> nebulagraph-yelp-frauddetection
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å®‰è£…ä¾èµ–ï¼Œæ‰§è¡Œæ•°æ®ä¸‹è½½ç”Ÿæˆ</span>
</span></span><span class="line"><span class="cl">python3 -m pip install -r requirements.txt
</span></span><span class="line"><span class="cl">python3 data_download.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯¼å…¥åˆ° NebulaGraph</span>
</span></span><span class="line"><span class="cl">docker run --rm -ti <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> --network<span class="o">=</span>nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/yelp_nebulagraph_importer.yaml:/root/importer.yaml <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/data:/root <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> vesoft/nebula-importer:v3.1.0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> --config /root/importer.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯¦æƒ…å‚è€ƒï¼šhttps://github.com/wey-gu/nebulagraph-yelp-frauddetection</p>
</blockquote>
<h5 id="æ•°æ®å¤„ç†" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e5%a4%84%e7%90%86" class="header-mark"></a>1.5.1.2 æ•°æ®å¤„ç†</h5><p>è¿™éƒ¨åˆ†çš„ä»»åŠ¡æ˜¯å°†å›¾è°±ä¸­å’Œé£é™©ç›¸å…³å­å›¾çš„æ‹“æ‰‘ç»“æ„è¡¨ç¤ºå’Œå…¶ä¸­æœ‰å…³çš„ç‰¹å¾ï¼ˆå±æ€§ï¼‰è¿›è¡Œå·¥ç¨‹å¤„ç†ï¼Œåºåˆ—åŒ–æˆä¸º DGL çš„å›¾å¯¹è±¡ã€‚</p>
<p>DGL æœ¬èº«æ”¯æŒä»ç‚¹ã€è¾¹åˆ—è¡¨ï¼ˆedgelistï¼‰å½¢å¼ CSV æ–‡ä»¶ï¼Œæˆ–è€…ä» NetworkX å’Œ SciPy çš„åºåˆ—åŒ–ç¨€ç–çš„é‚»æ¥çŸ©é˜µï¼ˆadjacency matrixï¼‰çš„æ•°æ®æ¥æ„é€ å®ƒçš„å›¾å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåŸå§‹çš„å›¾æ•°æ®æˆ–è€…å›¾åº“ä¸­çš„æ•°æ®å…¨é‡å¯¼å‡ºä¸ºè¿™äº›å½¢å¼ï¼Œä¸è¿‡åœ¨çœŸå®çš„ä¾‹å­ä¸­å›¾åº“ä¸­çš„æ•°æ®æ˜¯å®æ—¶å˜åŒ–çš„ï¼Œèƒ½å¤Ÿç›´æ¥åœ¨ NebulaGraph ä¸­çš„å­å›¾ä¸Šåš GNN è®­ç»ƒä¸€èˆ¬æ¥è¯´æ˜¯æ›´ç†æƒ³ã€‚å¾—ç›Šäº Nebula-DGL è¿™ä¸ªåº“ï¼Œåšè¿™ä»¶äº‹å„¿æ˜¯å¾ˆè‡ªç„¶çš„ã€‚</p>
<blockquote>
<p>æ³¨ï¼ŒDGL å¤–éƒ¨æ•°æ®å‘˜å¯¼å…¥æ–‡æ¡£ï¼šhttps://docs.dgl.ai/guide/graph-external.html</p>
</blockquote>
<p>ç°åœ¨æˆ‘ä»¬å¼€å§‹è¿™ä¸ªæ•°æ®çš„å¯¼å…¥ï¼Œåœ¨è¿™ä¹‹å‰ï¼Œæˆ‘å…ˆä»‹ç»ä¸€ä¸‹ Nebula-DGLã€‚</p>
<p>Nebula-DGL å¯ä»¥æ ¹æ®ç»™å®šçš„æ˜ å°„å’Œè½¬æ¢è§„åˆ™ï¼ˆYAML æ ¼å¼ï¼‰ï¼Œå°† NebulaGraph ä¸­çš„é¡¶ç‚¹ã€è¾¹ï¼Œå’Œå®ƒä»¬çš„å±æ€§æŒ‰ç…§è§„åˆ™å¤„ç†æˆä¸ºç‚¹ã€è¾¹ã€å’Œå…¶ä¸­çš„æ ‡æ³¨ï¼ˆLabelï¼‰ä¸ç‰¹å¾ï¼ˆFeatureï¼‰ï¼Œä»è€Œæ„é€ ä¸º DGL çš„å›¾å¯¹è±¡ã€‚è¿™å…¶ä¸­ï¼Œå€¼å¾—ä¸€æçš„æ˜¯å±æ€§åˆ°ç‰¹å¾çš„è½¬æ¢ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œç‰¹å¾å¯èƒ½æ˜¯æŸä¸€ä¸ªå±æ€§çš„å€¼ã€ä¸€ä¸ªæˆ–è€…å¤šä¸ªå±æ€§çš„å€¼åšä¸€å®šçš„æ•°å­¦å˜æ¢ã€äº¦æˆ–æ˜¯å­—ç¬¦å‹çš„å±æ€§æŒ‰ç…§æšä¸¾è§„åˆ™è¾“å‡ºä¸ºæ•°å­—ã€‚ç›¸åº”çš„ï¼ŒNebula-DGL åœ¨è§„åˆ™ä¸­ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é’ˆå¯¹è¿™å‡ ç§æƒ…å†µåˆ©ç”¨ <code>filter</code> è¿›è¡Œè¡¨è¾¾ï¼š</p>
<ul>
<li>ç‰¹å¾ç›´æ¥é€‰å–å±æ€§çš„å€¼ï¼š</li>
</ul>
<p>è¿™ä¸ªä¾‹å­é‡Œï¼ŒNebulaGraph å›¾ä¸­ <code>follow</code> è¿™ä¸ªè¾¹å°†è¢«æŠ½å–ï¼Œè¾¹ä¸Šçš„å±æ€§ <code>degree</code> çš„å€¼å°†ç›´æ¥è¢«ä½œä¸ºåä¸º <code>degree</code> çš„ç‰¹å¾ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">edge_types</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">follow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">player</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">player</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">features</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">degree</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">degree</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">value</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç‰¹å¾ä»å±æ€§ä¸­ç»è¿‡æ•°å­¦å˜æ¢</li>
</ul>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŠŠ <code>serve</code> è¾¹ä¹‹ä¸­çš„ä¸¤ä¸ªå±æ€§è¿›è¡Œ <code>(end_year - start_year) / 30</code> çš„å¤„ç†ï¼Œå˜ä¸º <code>service_time</code> è¿™æ ·çš„ä¸€ä¸ªç‰¹å¾ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">edge_types</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">serve</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">player</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">team</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">features</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">service_time</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">start_year</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">end_year</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># The variable was mapped by order of properties</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">function</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">function</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;lambda start_year, end_year: (end_year - start_year) / 30&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æšä¸¾å±æ€§å€¼ä¸ºæ•°å­—ç‰¹å¾</li>
</ul>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŠŠ <code>team</code> é¡¶ç‚¹ä¸­çš„ <code>name</code> å±æ€§è¿›è¡Œæšä¸¾ï¼Œæ ¹æ®è¿™ä¸ªå¯¹äºæ˜¯è¥¿å²¸è¿˜æ˜¯ä¸œå²¸ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">vertex_tags</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">team</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">features</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">coast</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">str</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># 0 stand for the east coast, 1 stand for the west coast</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">enumeration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">enumeration</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">Celtics</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">Nets</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">Nuggets</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">Timberwolves</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">Thunder</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ... not showing all teams here</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªè½¬æ¢è§„åˆ™éå¸¸ç®€å•ç›´æ¥ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥å‚è€ƒ Nebula-DGL çš„å®Œæ•´ä¾‹å­äº†è§£å…¨éƒ¨ç»†èŠ‚ <a href="https://github.com/wey-gu/nebula-dgl/tree/main/example" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/nebula-dgl/tree/main/example</a>ã€‚è€Œæœ‰ä¸Šè¾¹æ•°æ®å¤„ç†è§„åˆ™çš„äº†è§£ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹å¤„ç†è¿™ä¸ª Yelp å›¾æ•°æ®äº†ã€‚</p>
<p>é¦–å…ˆï¼Œå®šä¹‰å¦‚ä¸‹è§„åˆ™ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬æŠŠé¡¶ç‚¹ review å’Œä¸‰ç§è¾¹éƒ½å¯¹åº”è¿‡æ¥äº†ï¼ŒåŒæ—¶ï¼Œreview ä¸Šçš„å±æ€§ä¹ŸæŒ‰ç…§åŸæœ¬çš„å€¼å¯¹åº”äº†è¿‡æ¥ï¼š</p>
<p><code>nebulagraph_yelp_dgl_mapper.yaml</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># If vertex id is string-typed, remap_vertex_id must be true.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">remap_vertex_id</span><span class="p">:</span><span class="w"> </span><span class="kc">True</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">space</span><span class="p">:</span><span class="w"> </span><span class="l">yelp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># str or int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">vertex_id_type</span><span class="p">:</span><span class="w"> </span><span class="l">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">vertex_tags</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">label</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">is_fraud</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">is_fraud</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">features</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">float</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">float</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f31</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f31</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">float</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">edge_types</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">shares_user_with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">shares_restaurant_rating_with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">shares_restaurant_in_one_month_with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">review</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">review</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬åœ¨å®‰è£…å¥½ Nebula-DGL ä¹‹ååªéœ€è¦è¿™å‡ è¡Œä»£ç å°±å¯ä»¥å°† NebulaGraph ä¸­çš„è¿™å¼ å›¾æ„é€ ä¸º DGL çš„ <code>DGLHeteroGraph</code> å›¾å¯¹è±¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula_dgl</span> <span class="kn">import</span> <span class="n">NebulaLoader</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">nebula_config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;graph_hosts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd1&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd2&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;nebula_user&#34;</span><span class="p">:</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;nebula_password&#34;</span><span class="p">:</span> <span class="s2">&#34;nebula&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># load feature_mapper from yaml file</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;nebulagraph_yelp_dgl_mapper.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">feature_mapper</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">nebula_loader</span> <span class="o">=</span> <span class="n">NebulaLoader</span><span class="p">(</span><span class="n">nebula_config</span><span class="p">,</span> <span class="n">feature_mapper</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">nebula_loader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="æ¨¡å‹è®­ç»ƒ" class="headerLink">
    <a href="#%e6%a8%a1%e5%9e%8b%e8%ae%ad%e7%bb%83" class="header-mark"></a>1.5.1.3 æ¨¡å‹è®­ç»ƒ</h5><p>è¿™é‡Œï¼Œæˆ‘ç”¨ <a href="https://cs.stanford.edu/people/jure/pubs/graphsage-nips17.pdf" target="_blank" rel="noopener noreferrer">GraphSAGE</a> ç®—æ³•çš„ç‚¹åˆ†ç±»ï¼ˆNode Classificationï¼‰æ–¹æ³•æ¥ä¸¾ä¾‹ï¼ŒGraphSAGE çš„åŸå§‹ç‰ˆæœ¬æ˜¯ä¸€ä¸ªå½’çº³å­¦ä¹ ï¼ˆInductive Learningï¼‰çš„ç®—æ³•ï¼Œè¿™é‡Œï¼Œå½’çº³å­¦ä¹ åŒºåˆ«äºå®ƒçš„åé¢ï¼š Transductive Learning ï¼Œå¯ä»¥æŠŠæ–°çš„æ•°æ®ç”¨åœ¨å®Œå…¨æ—§çš„å›¾ä¹‹ä¸Šä¹ å¾—çš„æ¨¡å‹ï¼Œè¿™æ ·è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹å¯ä»¥è¿›è¡Œçº¿ä¸Šå¢é‡æ•°æ®çš„æ¬ºè¯ˆæ£€æµ‹ï¼ˆè€Œä¸æ˜¯éœ€è¦é‡æ–°åŠ è½½ä¸ºå…¨å›¾è®­ç»ƒæ‰å¯ä»¥ï¼‰ã€‚</p>
<p><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/182301784-21850dac-0d47-4dd5-b66f-a28b87fe9d4d.svg" title="GraphSAGE_FraudDetection" data-thumbnail="https://user-images.githubusercontent.com/1651790/182301784-21850dac-0d47-4dd5-b66f-a28b87fe9d4d.svg">
        
    </a></p>
<p>æ¨¡å‹è®­ç»ƒç³»ç»Ÿï¼ˆå·¦è¾¹ï¼‰ï¼š</p>
<ul>
<li>è¾“å…¥ï¼šå¸¦æœ‰æ¬ºè¯ˆæ ‡æ³¨çš„å†å²äº¤æ˜“å›¾è°±</li>
<li>è¾“å‡ºï¼šä¸€ä¸ª GraphSAGE çš„ DGL æ¨¡å‹</li>
</ul>
<p>çº¿ä¸Šæ¨ç†ç³»ç»Ÿï¼ˆå³è¾¹ï¼‰ï¼š</p>
<ul>
<li>
<p>æ¨¡å‹ï¼šåŸºäºå¸¦æœ‰æ¬ºè¯ˆæ ‡æ³¨çš„å†å²äº¤æ˜“å›¾è°±åŸºäº GraphSAGE è®­ç»ƒ</p>
</li>
<li>
<p>è¾“å…¥ï¼šä¸€ç¬”æ–°çš„äº¤æ˜“</p>
</li>
<li>
<p>è¾“å‡ºï¼šè¿™ç¬”äº¤æ˜“æ˜¯å¦æ¶‰å«Œæ¬ºè¯ˆ</p>
</li>
</ul>
<p><strong>åˆ†å‰²æ•°æ®é›†</strong></p>
<p>æœºå™¨å­¦ä¹ è®­ç»ƒçš„è¿‡ç¨‹éœ€è¦åœ¨å·²ç»æœ‰çš„æ•°æ®ã€ä¿¡æ¯ä¸­åˆ†å‰²å‡ºç”¨æ¥è®­ç»ƒã€éªŒè¯å’Œæµ‹è¯•çš„å­é›†ï¼Œä»–ä»¬å¯ä»¥æ˜¯ä¸ç›¸äº¤çš„æ•´ä½“æ•°æ®çš„çœŸå­é›†ä¹Ÿå¯ä»¥å½¼æ­¤æœ‰é‡å ï¼Œåœ¨å®é™…çš„æƒ…å†µä¸­ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¯¹æ•°æ®çš„æ ‡æ³¨å¸¸å¸¸æ˜¯ä¸å……åˆ†çš„ï¼Œæ‰€ä»¥æŒ‰ç…§æ ‡æ³¨çš„æ¯”ä¾‹å»åˆ†å‰²æ•°æ®å¯èƒ½æ›´æœ‰æ„ä¹‰ä¸€äº›ï¼Œä¸‹è¾¹çš„ä¾‹å­æ˜¯æˆ‘æŒ‰ç…§ç‚¹ä¸Šæ˜¯å¦æ ‡æ³¨æ¬ºè¯ˆä¸ºæ ‡å‡†å»åˆ†å‰²æ•°æ®é›†ã€‚</p>
<p>è¿™é‡Œè¾¹æœ‰ä¸¤ä¸ªåœ°æ–¹å€¼å¾—æ³¨æ„ï¼š</p>
<ol>
<li><code>train_test_split</code> ä¸­çš„ <code>stratify=g.ndata['is_fraud']</code> ä»£è¡¨ä¿æŒ <code>is_fraud</code> çš„å€¼çš„åˆ†å¸ƒå»åˆ†å‰²ï¼Œç¬¦åˆæˆ‘ä»¬å‰è¾¹æåˆ°çš„æ€æƒ³ã€‚</li>
<li>æˆ‘ä»¬åˆ†å‰²çš„æ˜¯ <code>idx</code> ç´¢å¼•ï¼Œè¿™æ ·ï¼Œå¯ä»¥æœ€ç»ˆè·å¾—ä¸‰ä¸ªé›†åˆçš„ç´¢å¼•ï¼Œä¾›è®­ç»ƒã€éªŒè¯å’Œæµ‹è¯•æ—¶å€™ä½¿ç”¨ã€‚åŒæ—¶æˆ‘ä»¬è¿˜æŠŠå¯¹åº”é›†åˆ mask æ”¾åˆ°å›¾å¯¹è±¡ <code>g</code> é‡Œè¾¹å»äº†ã€‚</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Split the graph into train, validation, and test sets</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># features are g.ndata[&#39;f0&#39;], g.ndata[&#39;f1&#39;], g.ndata[&#39;f2&#39;], ... g.ndata[&#39;f31&#39;]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># label is in g.ndata[&#39;is_fraud&#39;]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># concatenate all features</span>
</span></span><span class="line"><span class="cl"><span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;f&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;is_fraud&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># numpy array as an index of range n</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># split based on value distribution of label: the property &#34;is_fraud&#34;, which is a binary variable.</span>
</span></span><span class="line"><span class="cl"><span class="n">X_train_and_val_idx</span><span class="p">,</span> <span class="n">X_test_idx</span><span class="p">,</span> <span class="n">y_train_and_val</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">idx</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;is_fraud&#39;</span><span class="p">],</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;is_fraud&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># split train and val</span>
</span></span><span class="line"><span class="cl"><span class="n">X_train_idx</span><span class="p">,</span> <span class="n">X_val_idx</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">X_train_and_val_idx</span><span class="p">,</span> <span class="n">y_train_and_val</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_train_and_val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># list of index to mask</span>
</span></span><span class="line"><span class="cl"><span class="n">train_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">train_mask</span><span class="p">[</span><span class="n">X_train_idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">val_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">val_mask</span><span class="p">[</span><span class="n">X_val_idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">test_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">test_mask</span><span class="p">[</span><span class="n">X_test_idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;train_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_mask</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;val_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_mask</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;test_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_mask</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å¼‚æ„å›¾è½¬æ¢ä¸ºåŒæ„å›¾</strong></p>
<p>GraphSAGE æ˜¯é’ˆå¯¹åŒæ„å›¾ï¼Œä¸”è¾¹æ—  feature çš„ç®—æ³•ï¼Œè€Œæˆ‘ä»¬å½“ä¸‹çš„ Yelp å›¾è°±æ˜¯å¼‚æ„çš„ï¼šä¸€ç±»ç‚¹ã€ä¸‰ç±»è¾¹ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•æ‰èƒ½ç”¨ GraphSAGE å»å»ºæ¨¡ Yelp å›¾è°±å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬é™¤äº†é€‰æ‹©ç”¨å…¶ä»–é’ˆå¯¹å¼‚æ„å›¾çš„ Inductive Learning æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜å¯æƒ³åŠæ³•æŠŠåŒæ„å›¾è½¬æ¢æˆå¼‚æ„å›¾ã€‚ä¸ºäº†åœ¨è½¬æ¢ä¸­ä¸ä¸¢å¤±é‡è¦çš„è¾¹ç±»å‹ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¾¹ç±»å‹å˜æˆæ•°å€¼ã€‚</p>
<p>è¿™é‡Œæˆ‘ç»™äº†ä¸€ç»´çš„ edge featureï¼Œå½“ç„¶ï¼ˆ3-1ï¼‰äºŒç»´ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># shares_restaurant_in_one_month_with: 1, b&#34;001&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># shares_restaurant_rating_with: 2, b&#34;010&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># shares_user_with: 4, b&#34;100&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨ï¼šå…¶å®å¦‚æœæƒ³ç”¨ 0, 1, 2 è¿™æ ·çš„åˆ†å¸ƒï¼Œè½¬æ¢åˆ°åŒæ„å›¾ä¹‹åçš„ <code>hg.edata['_TYPE']</code> ä¹Ÿæ˜¯å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨çš„ï¼Œè¯¦è§ <a href="https://docs.dgl.ai/en/0.9.x/generated/dgl.to_homogeneous.html" target="_blank" rel="noopener noreferrer">https://docs.dgl.ai/en/0.9.x/generated/dgl.to_homogeneous.html</a> ä¸­çš„ä¾‹å­ã€‚</p>
</blockquote>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># three types of edges</span>
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">g</span><span class="o">.</span><span class="n">etypes</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;shares_user_with&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">),),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_user_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_user_with&#39;</span><span class="p">),),</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">g</span><span class="o">.</span><span class="n">edata</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="p">{(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;review&#39;</span><span class="p">):</span> <span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;review&#39;</span><span class="p">):</span> <span class="n">tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="s1">&#39;shares_user_with&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">):</span> <span class="n">tensor</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">])}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å‚è€ƒï¼šhttps://discuss.dgl.ai/t/how-to-convert-from-a-heterogeneous-graph-to-a-homogeneous-graph-with-data/2764</p>
</blockquote>
<p>ç„¶åå°†å®ƒè½¬æ¢ä¸ºåŒæ„å›¾ï¼ŒæŠŠ <code>he</code> ä½œä¸ºè¦ä¿ç•™çš„ edataï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">hg</span> <span class="o">=</span> <span class="n">dgl</span><span class="o">.</span><span class="n">to_homogeneous</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">edata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">],</span> <span class="n">ndata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;train_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;val_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;test_mask&#39;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å‚è€ƒï¼šhttps://docs.dgl.ai/en/latest/guide/graph-heterogeneous.html?highlight=to_homogeneous#converting-heterogeneous-graphs-to-homogeneous-graphs</p>
</blockquote>
<p>é»˜è®¤çš„ GraphSAGE å®ç°æ˜¯æ²¡è€ƒè™‘ edge feature çš„ï¼Œæˆ‘ä»¬è¦ä¿®æ”¹æ¶ˆæ¯ä¼ é€’çš„æ­¥éª¤ï¼Œåœ¨åè¾¹ä¼šæ¶‰åŠåˆ°è¿™éƒ¨åˆ†çš„å®æ“ã€‚</p>
<blockquote>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://discuss.dgl.ai/t/frequently-asked-questions-faq/1681" target="_blank" rel="noopener noreferrer">https://discuss.dgl.ai/t/frequently-asked-questions-faq/1681</a> ï¼ˆé—®é¢˜13ï¼‰</li>
<li><a href="https://discuss.dgl.ai/t/using-node-and-edge-features-in-message-passing/762" target="_blank" rel="noopener noreferrer">https://discuss.dgl.ai/t/using-node-and-edge-features-in-message-passing/762</a></li>
</ul>
</blockquote>
<p><strong>æ¨¡å‹è®­ç»ƒä»£ç </strong></p>
<p>DGL å®˜æ–¹ç»™å‡ºäº†ä¾‹å­åœ¨ï¼šhttps://github.com/dmlc/dgl/tree/master/examples/pytorch/graphsageï¼Œæˆ‘åœ¨æµ‹è¯•çš„æ—¶å€™è¿˜ä¿®å¤äº†ä¸€ä¸ªå° bugã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬å¤„ç†è¿‡çš„åŒæ„å›¾é‡Œæ˜¯å¸¦æœ‰ edge feature çš„ï¼Œä¸èƒ½ç…§æ¬å®˜æ–¹çš„ GraphSAGE ä¾‹å­ä»£ç ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•æ¥å¤„ç†å®ƒï¼š</p>
<p>a. å¯ä»¥ç¨å¾®æ”¹åŠ¨ä¸€ä¸‹ <code>SAGEConv</code>æ¶ˆæ¯ä¼ é€’çš„éƒ¨åˆ†ï¼Œä»¥ mean èšåˆçš„æ–¹å¼ä¸ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">  graph.update_all(msg_fn, fn.mean(&#39;m&#39;, &#39;neigh&#39;))
</span></span><span class="line"><span class="cl"><span class="gi">+ graph.update_all(fn.copy_e(&#39;he&#39;, &#39;m&#39;), fn.mean(&#39;m&#39;, &#39;neigh&#39;))
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gd">- h_neigh = graph.dstdata[&#39;neigh&#39;]
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+ h_neigh = torch.cat((graph.dstdata[&#39;neigh&#39;], graph.dstdata[&#39;neigh_e&#39;].reshape(-1, 1)), 1)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªå¤„ç†ä¸­ï¼Œé™¤äº†ä¸Šè¾¹æ¶ˆæ¯ä¼ é€’éƒ¨åˆ†å¢åŠ  edge feature ä¹‹å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„ feature ç»´åº¦çš„å¤„ç†ã€‚</p>
<p>b. æŠŠè¾¹å‚æ•°ä½œä¸ºè¾¹æƒé‡ ï¼Œä»¥ mean èšåˆä¸ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gd">- graph.update_all(msg_fn, fn.mean(&#39;m&#39;, &#39;neigh&#39;))
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+ # consdier datatype with different weight, g.edata[&#39;he&#39;] as weight here
</span></span></span><span class="line"><span class="cl"><span class="gi">+ g.update_all(fn.u_mul_e(&#39;h&#39;, &#39;he&#39;, &#39;m&#39;), fn.mean(&#39;m&#39;, &#39;h&#39;))
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‹è¾¹ï¼Œæˆ‘ä»¬ä»¥æŠŠè¾¹çš„ç±»å‹ä½œä¸ºæƒé‡çš„æ–¹å¼ï¼Œ<code>mean</code>ä½œä¸ºèšåˆçš„æƒ…å†µä¸ºä¾‹æ¥å®æ“ï¼š</p>
<p>æˆ‘ä»¬æ¥ç»§æ‰¿ï¼Œå¹¶è¦†ç›–<code>SAGEConv</code>ï¼š</p>
<blockquote>
<p>æˆ‘ä»¬å…¶å®åªæ˜¯ä¿®æ”¹äº† Message Passing çš„éƒ¨åˆ†ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dgl</span> <span class="kn">import</span> <span class="n">function</span> <span class="k">as</span> <span class="n">fn</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dgl.utils</span> <span class="kn">import</span> <span class="n">check_eq_shape</span><span class="p">,</span> <span class="n">expand_as_pair</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SAGEConv</span><span class="p">(</span><span class="n">dglnn</span><span class="o">.</span><span class="n">SAGEConv</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">feat</span><span class="p">,</span> <span class="n">edge_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="sa">r</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Description
</span></span></span><span class="line"><span class="cl"><span class="s2">        -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">        Compute GraphSAGE layer.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">        ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">        graph : DGLGraph
</span></span></span><span class="line"><span class="cl"><span class="s2">            The graph.
</span></span></span><span class="line"><span class="cl"><span class="s2">        feat : torch.Tensor or pair of torch.Tensor
</span></span></span><span class="line"><span class="cl"><span class="s2">            If a torch.Tensor is given, it represents the input feature of shape
</span></span></span><span class="line"><span class="cl"><span class="s2">            :math:`(N, D_</span><span class="si">{in}</span><span class="s2">)`
</span></span></span><span class="line"><span class="cl"><span class="s2">            where :math:`D_</span><span class="si">{in}</span><span class="s2">` is size of input feature, :math:`N` is the number of nodes.
</span></span></span><span class="line"><span class="cl"><span class="s2">            If a pair of torch.Tensor is given, the pair must contain two tensors of shape
</span></span></span><span class="line"><span class="cl"><span class="s2">            :math:`(N_</span><span class="si">{in}</span><span class="s2">, D_{in_</span><span class="si">{src}</span><span class="s2">})` and :math:`(N_</span><span class="si">{out}</span><span class="s2">, D_{in_</span><span class="si">{dst}</span><span class="s2">})`.
</span></span></span><span class="line"><span class="cl"><span class="s2">        edge_weight : torch.Tensor, optional
</span></span></span><span class="line"><span class="cl"><span class="s2">            Optional tensor on the edge. If given, the convolution will weight
</span></span></span><span class="line"><span class="cl"><span class="s2">            with regard to the message.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Returns
</span></span></span><span class="line"><span class="cl"><span class="s2">        -------
</span></span></span><span class="line"><span class="cl"><span class="s2">        torch.Tensor
</span></span></span><span class="line"><span class="cl"><span class="s2">            The output feature of shape :math:`(N_</span><span class="si">{dst}</span><span class="s2">, D_</span><span class="si">{out}</span><span class="s2">)`
</span></span></span><span class="line"><span class="cl"><span class="s2">            where :math:`N_</span><span class="si">{dst}</span><span class="s2">` is the number of destination nodes in the input graph,
</span></span></span><span class="line"><span class="cl"><span class="s2">            :math:`D_</span><span class="si">{out}</span><span class="s2">` is the size of the output feature.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_compatibility_check</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">graph</span><span class="o">.</span><span class="n">local_scope</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">feat_src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feat_drop</span><span class="p">(</span><span class="n">feat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                <span class="n">feat_dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feat_drop</span><span class="p">(</span><span class="n">feat</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">feat_src</span> <span class="o">=</span> <span class="n">feat_dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feat_drop</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">graph</span><span class="o">.</span><span class="n">is_block</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">feat_dst</span> <span class="o">=</span> <span class="n">feat_src</span><span class="p">[:</span><span class="n">graph</span><span class="o">.</span><span class="n">number_of_dst_nodes</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">            <span class="n">msg_fn</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">copy_src</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">edge_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">assert</span> <span class="n">edge_weight</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">graph</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">edata</span><span class="p">[</span><span class="s1">&#39;_edge_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_weight</span>
</span></span><span class="line"><span class="cl">                <span class="n">msg_fn</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">u_mul_e</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;_edge_weight&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">h_self</span> <span class="o">=</span> <span class="n">feat_dst</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Handle the case of graphs without edges</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">graph</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;neigh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">feat_dst</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_src_feats</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">feat_dst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Determine whether to apply linear transformation before message passing A(XW)</span>
</span></span><span class="line"><span class="cl">            <span class="n">lin_before_mp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_src_feats</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_feats</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Message Passing</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggre_type</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_neigh</span><span class="p">(</span><span class="n">feat_src</span><span class="p">)</span> <span class="k">if</span> <span class="n">lin_before_mp</span> <span class="k">else</span> <span class="n">feat_src</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># graph.update_all(msg_fn, fn.mean(&#39;m&#39;, &#39;neigh&#39;))</span>
</span></span><span class="line"><span class="cl">                <span class="c1">#########################################################################</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># consdier datatype with different weight, g.edata[&#39;he&#39;] as weight here</span>
</span></span><span class="line"><span class="cl">                <span class="n">g</span><span class="o">.</span><span class="n">update_all</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">u_mul_e</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;he&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">),</span> <span class="n">fn</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="c1">#########################################################################</span>
</span></span><span class="line"><span class="cl">                <span class="n">h_neigh</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;neigh&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="ow">not</span> <span class="n">lin_before_mp</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">h_neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_neigh</span><span class="p">(</span><span class="n">h_neigh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggre_type</span> <span class="o">==</span> <span class="s1">&#39;gcn&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">check_eq_shape</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_neigh</span><span class="p">(</span><span class="n">feat_src</span><span class="p">)</span> <span class="k">if</span> <span class="n">lin_before_mp</span> <span class="k">else</span> <span class="n">feat_src</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>  <span class="c1"># heterogeneous</span>
</span></span><span class="line"><span class="cl">                    <span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_neigh</span><span class="p">(</span><span class="n">feat_dst</span><span class="p">)</span> <span class="k">if</span> <span class="n">lin_before_mp</span> <span class="k">else</span> <span class="n">feat_dst</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">graph</span><span class="o">.</span><span class="n">is_block</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">][:</span><span class="n">graph</span><span class="o">.</span><span class="n">num_dst_nodes</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">                    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">update_all</span><span class="p">(</span><span class="n">msg_fn</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;neigh&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">update_all</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">copy_e</span><span class="p">(</span><span class="s1">&#39;he&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">),</span> <span class="n">fn</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;neigh&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># divide in_degrees</span>
</span></span><span class="line"><span class="cl">                <span class="n">degs</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">in_degrees</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">feat_dst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">h_neigh</span> <span class="o">=</span> <span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;neigh&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">degs</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="ow">not</span> <span class="n">lin_before_mp</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">h_neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_neigh</span><span class="p">(</span><span class="n">h_neigh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggre_type</span> <span class="o">==</span> <span class="s1">&#39;pool&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc_pool</span><span class="p">(</span><span class="n">feat_src</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">update_all</span><span class="p">(</span><span class="n">msg_fn</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;neigh&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">update_all</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">copy_e</span><span class="p">(</span><span class="s1">&#39;he&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">),</span> <span class="n">fn</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;neigh&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">h_neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_neigh</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;neigh&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggre_type</span> <span class="o">==</span> <span class="s1">&#39;lstm&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feat_src</span>
</span></span><span class="line"><span class="cl">                <span class="n">graph</span><span class="o">.</span><span class="n">update_all</span><span class="p">(</span><span class="n">msg_fn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lstm_reducer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">h_neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_neigh</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;neigh&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Aggregator type </span><span class="si">{}</span><span class="s1"> not recognized.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aggre_type</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># GraphSAGE GCN does not require fc_self.</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggre_type</span> <span class="o">==</span> <span class="s1">&#39;gcn&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rst</span> <span class="o">=</span> <span class="n">h_neigh</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_self</span><span class="p">(</span><span class="n">h_self</span><span class="p">)</span> <span class="o">+</span> <span class="n">h_neigh</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># bias term</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rst</span> <span class="o">=</span> <span class="n">rst</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># activation</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># normalization</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">rst</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®šä¹‰æ¨¡å‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SAGE</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_size</span><span class="p">,</span> <span class="n">hid_size</span><span class="p">,</span> <span class="n">out_size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># three-layer GraphSAGE-mean</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dglnn</span><span class="o">.</span><span class="n">SAGEConv</span><span class="p">(</span><span class="n">in_size</span><span class="p">,</span> <span class="n">hid_size</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dglnn</span><span class="o">.</span><span class="n">SAGEConv</span><span class="p">(</span><span class="n">hid_size</span><span class="p">,</span> <span class="n">hid_size</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dglnn</span><span class="o">.</span><span class="n">SAGEConv</span><span class="p">(</span><span class="n">hid_size</span><span class="p">,</span> <span class="n">out_size</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">hid_size</span> <span class="o">=</span> <span class="n">hid_size</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">out_size</span> <span class="o">=</span> <span class="n">out_size</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">h</span> <span class="o">=</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="n">blocks</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="n">h</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">l</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">h</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">h</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">inference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Conduct layer-wise inference to get all the node embeddings.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">feat</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">sampler</span> <span class="o">=</span> <span class="n">MultiLayerFullNeighborSampler</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">prefetch_node_feats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">g</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">sampler</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">buffer_device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">pin_memory</span> <span class="o">=</span> <span class="p">(</span><span class="n">buffer_device</span> <span class="o">!=</span> <span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">g</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">hid_size</span> <span class="k">if</span> <span class="n">l</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_size</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">device</span><span class="o">=</span><span class="n">buffer_device</span><span class="p">,</span> <span class="n">pin_memory</span><span class="o">=</span><span class="n">pin_memory</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">feat</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">input_nodes</span><span class="p">,</span> <span class="n">output_nodes</span><span class="p">,</span> <span class="n">blocks</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">dataloader</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">x</span> <span class="o">=</span> <span class="n">feat</span><span class="p">[</span><span class="n">input_nodes</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="n">h</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span> <span class="c1"># len(blocks) = 1</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">l</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">h</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># by design, our output nodes are contiguous</span>
</span></span><span class="line"><span class="cl">                <span class="n">y</span><span class="p">[</span><span class="n">output_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">output_nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">buffer_device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">feat</span> <span class="o">=</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">y</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®šä¹‰è®­ç»ƒã€æ¨ç†çš„å‡½æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">dataloader</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_hats</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">it</span><span class="p">,</span> <span class="p">(</span><span class="n">input_nodes</span><span class="p">,</span> <span class="n">output_nodes</span><span class="p">,</span> <span class="n">blocks</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataloader</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">x</span> <span class="o">=</span> <span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">y_hats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">MF</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">y_hats</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">ys</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">layerwise_infer</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span> <span class="c1"># pred in buffer_device</span>
</span></span><span class="line"><span class="cl">        <span class="n">pred</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">label</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">nid</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">MF</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">val_idx</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># create sampler &amp; dataloader</span>
</span></span><span class="line"><span class="cl">    <span class="n">sampler</span> <span class="o">=</span> <span class="n">NeighborSampler</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>  <span class="c1"># fanout for [layer-0, layer-1, layer-2]</span>
</span></span><span class="line"><span class="cl">                              <span class="n">prefetch_node_feats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                              <span class="n">prefetch_labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">use_uva</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">train_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">sampler</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                  <span class="n">batch_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                  <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                  <span class="n">use_uva</span><span class="o">=</span><span class="n">use_uva</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">val_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">val_idx</span><span class="p">,</span> <span class="n">sampler</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">batch_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">use_uva</span><span class="o">=</span><span class="n">use_uva</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">opt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">5e-4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">total_loss</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">it</span><span class="p">,</span> <span class="p">(</span><span class="n">input_nodes</span><span class="p">,</span> <span class="n">output_nodes</span><span class="p">,</span> <span class="n">blocks</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">x</span> <span class="o">=</span> <span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">srcdata</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">y</span> <span class="o">=</span> <span class="n">blocks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dstdata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">y_hat</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">opt</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">opt</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">total_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">acc</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">val_dataloader</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Epoch </span><span class="si">{:05d}</span><span class="s2"> | Loss </span><span class="si">{:.4f}</span><span class="s2"> | Accuracy </span><span class="si">{:.4f}</span><span class="s2"> &#34;</span>
</span></span><span class="line"><span class="cl">              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">total_loss</span> <span class="o">/</span> <span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">acc</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä» NebulaGraph ä¸­åŠ è½½å›¾åˆ° DGLï¼Œå¾—åˆ°çš„æ˜¯ä¸€ä¸ªå¼‚æ„å›¾ï¼ˆä¸€ç±»ç‚¹ã€ä¸‰ç±»è¾¹ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula_dgl</span> <span class="kn">import</span> <span class="n">NebulaLoader</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">nebula_config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;graph_hosts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd1&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd2&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;nebula_user&#34;</span><span class="p">:</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;nebula_password&#34;</span><span class="p">:</span> <span class="s2">&#34;nebula&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;nebulagraph_yelp_dgl_mapper.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">     <span class="n">feature_mapper</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">nebula_loader</span> <span class="o">=</span> <span class="n">NebulaLoader</span><span class="p">(</span><span class="n">nebula_config</span><span class="p">,</span> <span class="n">feature_mapper</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">nebula_loader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span> <span class="c1"># This will take you some time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä½œä¸ºç©·äººï¼Œæˆ‘ä»¬ç”¨ CPU</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ†å‡ºè®­ç»ƒã€éªŒè¯ã€æµ‹è¯•é›†ï¼Œç„¶åè½¬æ¢æˆåŒæ„å›¾ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Split the graph into train, validation and test sets</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># features are g.ndata[&#39;f0&#39;], g.ndata[&#39;f1&#39;], g.ndata[&#39;f2&#39;], ... g.ndata[&#39;f31&#39;]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># label is in g.ndata[&#39;is_fraud&#39;]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># concatenate all features</span>
</span></span><span class="line"><span class="cl"><span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;is_fraud&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># numpy array as index of range n</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># features.append(idx)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># concatenate one dim with index of node</span>
</span></span><span class="line"><span class="cl"><span class="c1"># feature_and_idx = torch.stack(features, dim=1)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># split based on value distribution of label: the property &#34;is_fraud&#34;, which is a binary variable.</span>
</span></span><span class="line"><span class="cl"><span class="n">X_train_and_val_idx</span><span class="p">,</span> <span class="n">X_test_idx</span><span class="p">,</span> <span class="n">y_train_and_val</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">idx</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;is_fraud&#39;</span><span class="p">],</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;is_fraud&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># split train and val</span>
</span></span><span class="line"><span class="cl"><span class="n">X_train_idx</span><span class="p">,</span> <span class="n">X_val_idx</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">X_train_and_val_idx</span><span class="p">,</span> <span class="n">y_train_and_val</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_train_and_val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># list of index to mask</span>
</span></span><span class="line"><span class="cl"><span class="n">train_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">train_mask</span><span class="p">[</span><span class="n">X_train_idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">val_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">val_mask</span><span class="p">[</span><span class="n">X_val_idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">test_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">test_mask</span><span class="p">[</span><span class="n">X_test_idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;train_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_mask</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;val_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_mask</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;test_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_mask</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># shares_restaurant_in_one_month_with: 1, b&#34;001&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># shares_restaurant_rating_with: 2, b&#34;010&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># shares_user_with: 4, b&#34;100&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># set edata of shares_restaurant_in_one_month_with to n of 1 tensor array</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">),),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_user_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_user_with&#39;</span><span class="p">),),</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># heterogeneous graph to heterogeneous graph, keep ndata and edata</span>
</span></span><span class="line"><span class="cl"><span class="n">hg</span> <span class="o">=</span> <span class="n">dgl</span><span class="o">.</span><span class="n">to_homogeneous</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">edata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">],</span> <span class="n">ndata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;train_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;val_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;test_mask&#39;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®­ç»ƒã€æµ‹è¯•æ¨¡å‹ï¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># create GraphSAGE model</span>
</span></span><span class="line"><span class="cl"><span class="n">in_size</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">out_size</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">SAGE</span><span class="p">(</span><span class="n">in_size</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">out_size</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># model training</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">train</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X_train_idx</span><span class="p">,</span> <span class="n">X_val_idx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># test the model</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testing...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">acc</span> <span class="o">=</span> <span class="n">layerwise_infer</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">X_test_idx</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Test Accuracy </span><span class="si">{:.4f}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿è¡Œç»“æœ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Test Accuracy 0.9996</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº†æ¨¡å‹ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒåºåˆ—åŒ–æˆæ–‡ä»¶ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠæ¨¡å‹çš„å½¢å¼å’Œè¿™ä¸ªåºåˆ—åŒ–æ–‡ä»¶å†åŠ è½½æˆä¸€ä¸ª pyTorch å°±å¯ä»¥ç”¨å®ƒè¿›è¡Œæ¨ç†äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># save model</span>
</span></span><span class="line"><span class="cl"><span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="s2">&#34;fraud_d.model&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># load model</span>
</span></span><span class="line"><span class="cl"><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">SAGE</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&#34;fraud_d.model&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œæˆ‘ä»¬å¦‚ä½•æŠŠæ¨¡å‹æ”¾åˆ°æˆ‘ä»¬çš„çº¿ä¸Šæ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿé‡Œå‘¢ï¼Ÿ</p>
<h5 id="æ¨ç†æ¥å£" class="headerLink">
    <a href="#%e6%8e%a8%e7%90%86%e6%8e%a5%e5%8f%a3" class="header-mark"></a>1.5.1.4 æ¨ç†æ¥å£</h5><p>å‰è¾¹æåˆ°è¿‡ï¼Œ GraphSAGE æ˜¯æœ€ç®€å•çš„æ”¯æŒ Inductive Learning çš„æ¨¡å‹ï¼Œè€Œä¸Šè¾¹æˆ‘ä»¬çš„è®­ç»ƒæ¨ç†è¿‡ç¨‹å®é™…ä¸Šè¿˜ä¸æ˜¯è¿™æ ·çš„æˆ‘ä»¬çš„æµ‹è¯•å’Œè®­ç»ƒçš„å›¾æ˜¯åŒä¸€å¼ ï¼Œè™½ç„¶æ ‡æ³¨äº†è®­ç»ƒçš„ç‚¹çš„ç´¢å¼•ï¼Œä½†å®é™…ä¸Šæ˜¯æ•´å¼ å›¾ä½œä¸ºè¾“å…¥çš„ã€‚ä¸ºäº†åšåˆ°Inductive Learning æˆ‘ä»¬åªéœ€è¦æŠŠè®­ç»ƒå’Œæµ‹è¯•åˆ†æˆä¸¤ä¸ªæ— äº¤é›†çš„å­å›¾æ¥åšè®­ç»ƒå’Œæœ€ç»ˆæµ‹è¯•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Inductive Learning, our test dataset are new nodes and new edges</span>
</span></span><span class="line"><span class="cl"><span class="n">hg_train</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">X_train_idx</span><span class="p">,</span> <span class="n">X_val_idx</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># model training</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">train</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">hg_train</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">X_train_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">X_train_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hg_train</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># test the model</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testing...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">hg_test</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">X_test_idx</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sg_X_test_idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">hg_test</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">acc</span> <span class="o">=</span> <span class="n">layerwise_infer</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">hg_test</span><span class="p">,</span> <span class="n">sg_X_test_idx</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Test Accuracy </span><span class="si">{:.4f}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿è¡Œç»“æœ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Test Accuracy 0.9990</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸Šè¾¹çš„ä»£ç é‡Œï¼Œæµ‹è¯•æ‰€ç”¨åˆ°çš„å›¾å’Œè®­ç»ƒçš„å›¾æ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ç»„æ•°æ®ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬çš„çº¿ä¸Šç³»ç»Ÿå¯ä»¥æ˜¯ä¹‹å‰å®Œå…¨æ²¡æœ‰é‡åˆ°çš„æ•°æ®ï¼Œæˆ‘ä»¬åªè¦æŠŠå¯¹æ–°æ¥çš„ä¸€ä¸ªäº¤æ˜“è¯·æ±‚æ•°æ®å†™è¿› NebulaGraphï¼Œç„¶åå†ä»è¿™ä¸ªç‚¹è·å–ä¸€ä¸ªçº¿ä¸Šç³»ç»Ÿå¯ä»¥è¿”å›çš„å°å­å›¾ï¼Œå°±å¯ä»¥æŠŠå®ƒä½œä¸ºæ¨¡å‹æ¨ç†çš„è¾“å…¥ï¼Œè·å¾—å­å›¾çš„æ ‡ç­¾äº†ï¼</p>
<p><strong>æ–°çš„äº¤æ˜“è¯·æ±‚</strong>ï¼š</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬å‰è¾¹ç”»çš„çº¿ä¸Šæ¨ç†ç³»ç»Ÿçš„æµç¨‹å›¾ä¹ˆï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      
</span></span><span class="line"><span class="cl">      â”‚                     â”‚                          â”‚                 â”‚
</span></span><span class="line"><span class="cl">â”€â”€â”€â”€â”€â–¶â”‚ Transaction Record  â”œâ”€â”€â”€â”€â”€â”€2. Fraud Risk â”€â”€â”€â”€â”€â–¶â”‚  Inference API  â”‚â—€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">      â”‚                     â”‚â—€â”€â”€â”€â”€Prediction with â”€â”€â”€â”€â”€â”¤                 â”‚     â”‚
</span></span><span class="line"><span class="cl">      â”‚                     â”‚        Sub Graph         â”‚                 â”‚     â”‚
</span></span><span class="line"><span class="cl">      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
</span></span><span class="line"><span class="cl">           â”‚           â–²                                        â”‚              â”‚
</span></span><span class="line"><span class="cl">           â”‚           â”‚                                        â”‚              â”‚
</span></span><span class="line"><span class="cl">       0. Insert   1. Get New                              3.req: Node         â”‚
</span></span><span class="line"><span class="cl">         Record    Record Sub                            Classification        â”‚
</span></span><span class="line"><span class="cl">           â”‚         Graph                                      â”‚              â”‚
</span></span><span class="line"><span class="cl">           â–¼           â”‚                                        â”‚              â”‚
</span></span><span class="line"><span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      3.resp: â”‚
</span></span><span class="line"><span class="cl">â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚                          Predictedâ”‚
</span></span><span class="line"><span class="cl">â”‚â”‚   Graph of Historical Transactions   â”‚â”‚ â”‚                             Risk  â”‚
</span></span><span class="line"><span class="cl">â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚                                   â”‚
</span></span><span class="line"><span class="cl">â”‚                   .â”€.              .   â”‚ â”‚                                   â”‚
</span></span><span class="line"><span class="cl">â”‚                  (   )â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€( )  â”‚ â”‚                                   â”‚
</span></span><span class="line"><span class="cl">â”‚                   `â”€&#39;              &#39;   â”‚ â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
</span></span><span class="line"><span class="cl">â”‚  .       .â”€.       â•²             â—     â”‚ â”‚      â”‚ GNN Model Î›          â”‚     â”‚
</span></span><span class="line"><span class="cl">â”‚ ( )â—€â”€â”€â”€â”€(   )       â•²           â•±      â”‚ â”‚  â”Œâ”€â”€â”€â”´â”€â”        â•± â•²      â”Œâ”€â”€â”´â”€â”€â”  â”‚
</span></span><span class="line"><span class="cl">â”‚  &#39;       `â”€&#39;         â•²       . â•±       â”‚ â”‚  â”œâ”€â”€â”€â”€â”€â”¤       â•±   â•²     â”œâ”€â”€â”€â”€â”€â”¤  â”‚
</span></span><span class="line"><span class="cl">â”‚  â•²       â—€            â•²     ( )        â”‚ â””â”€â–¶â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â–¶â–•     â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”¤â”€â”€â”˜
</span></span><span class="line"><span class="cl">â”‚   â•²  .  â•±              â—     &#39;         â”‚    â”œâ”€â”€â”€â”€â”€â”¤       â•²   â•±     â”œâ”€â”€â”€â”€â”€â”¤   
</span></span><span class="line"><span class="cl">â”‚    â—€( )â•±               .â”€.         .â”€. â”‚    â””â”€â”€â”€â”¬â”€â”˜        â•² â•±      â””â”€â”€â”¬â”€â”€â”˜   
</span></span><span class="line"><span class="cl">â”‚      &#39;                (   )â—€â”€â”€â”€â”€â”€â”€(   )â”‚        â”‚           V          â”‚      
</span></span><span class="line"><span class="cl">â”‚                        `â”€&#39;         `â”€&#39; â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      
</span></span><span class="line"><span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å‡è®¾è¿™ä¸ªæ–°çš„äº¤æ˜“è¯·æ±‚å·²ç»å‘èµ·äº†ï¼Œè¿™æ¡äº¤æ˜“è®°å½•å·²ç»è¢«æ›´æ–°åœ¨å›¾è°±é‡Œäº†ï¼Œå’±ä»¬éšä¾¿å–ä¸€ä¸ªç‚¹ä½œä¸ºè¿™æ ·çš„è¯·æ±‚å§</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-graphql" data-lang="graphql"><span class="line"><span class="cl"><span class="py">MATCH</span><span class="w"> </span><span class="p">(</span><span class="py">n</span><span class="p">:</span><span class="nc">review</span><span class="p">)</span><span class="w"> </span><span class="py">RETURN</span><span class="w"> </span><span class="py">n</span><span class="w"> </span><span class="py">LIMIT</span><span class="w"> </span><span class="py">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GRAPHQL" data-lang="GRAPHQL"><span class="line"><span class="cl"><span class="err">+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">|</span><span class="w"> </span><span class="py">n</span><span class="w">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </span><span class="p">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">|</span><span class="w"> </span><span class="p">(</span><span class="py">2048</span><span class="w"> </span><span class="p">:</span><span class="nc">review</span><span class="p">{</span><span class="py">f0</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.0</span><span class="p">,</span><span class="w"> </span><span class="py">f1</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.08034700155258179</span><span class="p">,</span><span class="w"> </span><span class="py">f10</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.3952670097351074</span><span class="p">,</span><span class="w"> </span><span class="py">f11</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.18671999871730804</span><span class="p">,</span><span class="w"> </span><span class="py">f12</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.2836120128631592</span><span class="p">,</span><span class="w"> </span><span class="py">f13</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.2843089997768402</span><span class="p">,</span><span class="w"> </span><span class="py">f14</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.38148200511932373</span><span class="p">,</span><span class="w"> </span><span class="py">f15</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.3816460072994232</span><span class="p">,</span><span class="w"> </span><span class="py">f16</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.9999740123748779</span><span class="p">,</span><span class="w"> </span><span class="py">f17</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.6430919766426086</span><span class="p">,</span><span class="w"> </span><span class="py">f18</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.9999740123748779</span><span class="p">,</span><span class="w"> </span><span class="py">f19</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.5051100254058838</span><span class="p">,</span><span class="w"> </span><span class="py">f2</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.12382200360298157</span><span class="p">,</span><span class="w"> </span><span class="py">f20</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.4940490126609802</span><span class="p">,</span><span class="w"> </span><span class="py">f21</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.7766339778900146</span><span class="p">,</span><span class="w"> </span><span class="py">f22</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.7705119848251343</span><span class="p">,</span><span class="w"> </span><span class="py">f23</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.9480599761009216</span><span class="p">,</span><span class="w"> </span><span class="py">f24</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.4032529890537262</span><span class="p">,</span><span class="w"> </span><span class="py">f25</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.12437800318002701</span><span class="p">,</span><span class="w"> </span><span class="py">f26</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.3184080123901367</span><span class="p">,</span><span class="w"> </span><span class="py">f27</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.5223879814147949</span><span class="p">,</span><span class="w"> </span><span class="py">f28</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.4278610050678253</span><span class="p">,</span><span class="w"> </span><span class="py">f29</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.343284010887146</span><span class="p">,</span><span class="w"> </span><span class="py">f3</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.42868199944496155</span><span class="p">,</span><span class="w"> </span><span class="py">f30</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.37313398718833923</span><span class="p">,</span><span class="w"> </span><span class="py">f31</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.328357994556427</span><span class="p">,</span><span class="w"> </span><span class="py">f4</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.9999849796295166</span><span class="p">,</span><span class="w"> </span><span class="py">f5</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.9999849796295166</span><span class="p">,</span><span class="w"> </span><span class="py">f6</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.9999849796295166</span><span class="p">,</span><span class="w"> </span><span class="py">f7</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.4850809872150421</span><span class="p">,</span><span class="w"> </span><span class="py">f8</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.454602986574173</span><span class="p">,</span><span class="w"> </span><span class="py">f9</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="mf">.8863419890403748</span><span class="p">,</span><span class="w"> </span><span class="py">is_fraud</span><span class="p">:</span><span class="w"> </span><span class="nc">0</span><span class="p">})</span><span class="w"> </span><span class="p">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¥½ï¼Œå®ƒæ˜¯ 2048 è¿™ä¸ªç‚¹ã€‚å®ƒçš„ä¸‹ä¸€æ­¥æ˜¯ <code>1. Get New Record Subgraph</code> æˆ‘ä»¬æ¥è·å–å®ƒçš„å­å›¾ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">GET</span><span class="w"> </span><span class="n">SUBGRAPH</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">PROP</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="mi">2048</span><span class="w"> </span><span class="n">YIELD</span><span class="w"> </span><span class="n">VERTICES</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes</span><span class="p">,</span><span class="w"> </span><span class="n">EDGES</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">relationships</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°è¿”å›çš„ç»“æœå…¶å®è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œä¸è¿‡å¯¹äº NebulaGraph æ¥è¯´ï¼Œè¿™ä¸ªå­å›¾ç»“æœè¿”å›æ˜¯åœ¨ 10 ms å·¦å³è·å–çš„ï¼Œè¿™é‡Œæˆ‘å°±ä¸è´´å‡ºæ¥äº†ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ NebulaGraph Studio æˆ–è€… Explorer ä¸­å¯ä»¥æŠŠç»“æœæ¸²æŸ“å‡ºæ¥ï¼ˆå¯è§†åŒ–å±•ç¤ºçš„ Query å¯ä»¥å»æ‰ <code>WITH PROP</code> ï¼Œå¯ä»¥ç»™æµè§ˆå™¨çœç‚¹å†…å­˜ï¼‰ï¼Œç»“æœå°±æ›´å®¹æ˜“è®©äººè„‘ç†è§£äº†ï¼š</p>
<p><a class="lightgallery" href="./subgraph_console_view.webp" title="./subgraph_console_view.webp" data-thumbnail="./subgraph_console_view.webp">
        
    </a></p>
<p><a class="lightgallery" href="./subgraph_viz.webp" title="./subgraph_viz.webp" data-thumbnail="./subgraph_viz.webp">
        
    </a></p>
<p>ç°åœ¨æˆ‘ä»¬å°±æ¥å®ç°è¿™ä¸€æ­¥çš„ä»£ç å§ï¼Œå®ƒçš„è¾“å…¥æ˜¯ç‚¹çš„ idï¼š<code>vertex_id</code>ã€‚è¾“å‡ºæ˜¯ä¸€ä¸ª <code>dgl_graph</code>ï¼Œç”¨æ¥ä¼ ç»™æ¨ç†æ¥å£ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># get SUBGRAPH of one node</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">tensor</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dgl</span> <span class="kn">import</span> <span class="n">DGLHeteroGraph</span><span class="p">,</span> <span class="n">heterograph</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula3.gclient.net</span> <span class="kn">import</span> <span class="n">ConnectionPool</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula3.Config</span> <span class="kn">import</span> <span class="n">Config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">config</span><span class="o">.</span><span class="n">max_connection_pool_size</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">connection_pool</span> <span class="o">=</span> <span class="n">ConnectionPool</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">connection_pool</span><span class="o">.</span><span class="n">init</span><span class="p">([(</span><span class="s1">&#39;graphd&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">)],</span> <span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">vertex_id</span> <span class="o">=</span> <span class="mi">2048</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;nebula&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">execute_json</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;USE yelp;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="sa">f</span><span class="s2">&#34;GET SUBGRAPH WITH PROP 2 STEPS FROM </span><span class="si">{</span><span class="n">vertex_id</span><span class="si">}</span><span class="s2"> YIELD VERTICES AS nodes, EDGES AS relationships;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œæˆ‘ç”¨åˆ°äº† Nebula-Python è¿™ä¸ª NebulaGraph çš„ Python SDK/Clientï¼Œé€šè¿‡ <code>execute_json</code> æ‰§è¡Œè·å¾—äº†è¿™ä¸ªäº¤æ˜“çš„å­å›¾ã€‚ä¸‹ä¸€æ­¥ï¼Œå’±ä»¬éœ€è¦æŠŠå®ƒæ„é€ æˆä¸€ä¸ª <code>dgl_graph</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># create node and nodedata</span>
</span></span><span class="line"><span class="cl"><span class="n">node_id_map</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key: vertex id in NebulaGraph, value: node id in dgl_graph</span>
</span></span><span class="line"><span class="cl"><span class="n">node_idx</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">features</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[[]]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="n">nodeid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">nodeid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_id_map</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">node_id_map</span><span class="p">[</span><span class="n">nodeid</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_idx</span>
</span></span><span class="line"><span class="cl">            <span class="n">node_idx</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">features</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;row&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="sa">f</span><span class="s2">&#34;review.f</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">features</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;row&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;review.is_fraud&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">- R-U-Rï¼šä¸¤ä¸ªè¯„ä»·ç”±åŒä¸€ä¸ªç”¨æˆ·å‘å‡º shares_user_with
</span></span></span><span class="line"><span class="cl"><span class="s2">- R-S-Rï¼šä¸¤ä¸ªè¯„ä»·æ˜¯åŒé¤å…åŒè¯„åˆ†ï¼ˆè¯„åˆ†å¯ä»¥æ˜¯1åˆ°5ï¼‰ shares_restaurant_rating_with
</span></span></span><span class="line"><span class="cl"><span class="s2">- R-T-Rï¼šä¸¤ä¸ªè¯„ä»·æ˜¯åŒé¤å…åŒæäº¤æœˆä»½ shares_restaurant_in_one_month_with
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">rur_start</span><span class="p">,</span> <span class="n">rur_end</span><span class="p">,</span> <span class="n">rsr_start</span><span class="p">,</span> <span class="n">rsr_end</span><span class="p">,</span> <span class="n">rtr_start</span><span class="p">,</span> <span class="n">rtr_end</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="n">edge</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shares_user_with&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rur_start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">            <span class="n">rur_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rsr_start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">            <span class="n">rsr_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rtr_start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">            <span class="n">rtr_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id_map</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">rur_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_dict</span><span class="p">[(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="s1">&#39;shares_user_with&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rur_start</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rur_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">rsr_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_dict</span><span class="p">[(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rsr_start</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rsr_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">rtr_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_dict</span><span class="p">[(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rtr_start</span><span class="p">),</span> <span class="n">tensor</span><span class="p">(</span><span class="n">rtr_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># construct a dgl_graph</span>
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="p">:</span> <span class="n">DGLHeteroGraph</span> <span class="o">=</span> <span class="n">heterograph</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®é™…ä¸Šæˆ‘å°±æ˜¯æŒ‰ç…§ DGL æ–‡æ¡£ï¼šhttps://docs.dgl.ai/en/0.9.x/generated/dgl.heterograph.htmlï¼Œä¸­çš„æ–¹å¼å»æ„é€  <code>data_dict</code>ï¼Œç„¶åç”¨ <code>heterograph()</code> å°±æŠŠç»“æœè½¬æ¢ä¸ºæƒ³è¦çš„ dgl_graph äº†ï¼Œå…¶ä¸­ <code>node_id_map</code> æ˜¯ NebulaGraph ä¹‹ä¸­ Vertex_ID åˆ°è¿™ä¸ªå¯¹è±¡ä¸­ node_id çš„å­—å…¸ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å†æŠŠ node feature ä¹ŸåŠ è½½è¿›å»ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># load node features to dgl_graph</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">dgl_graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="sa">f</span><span class="s2">&#34;f</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="mi">32</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å¼€å§‹æ¨ç†ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŠŠå®ƒè½¬æ¢æˆåŒæ„å›¾ï¼Œå’Œå‰è¾¹å®Œå…¨ä¸€æ ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># to homogeneous graph</span>
</span></span><span class="line"><span class="cl"><span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dgl_graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="sa">f</span><span class="s2">&#34;f</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">dgl_graph</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_restaurant_in_one_month_with&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">dgl_graph</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_restaurant_rating_with&#39;</span><span class="p">),),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dgl_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;shares_user_with&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">dgl_graph</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(</span><span class="s1">&#39;shares_user_with&#39;</span><span class="p">),),</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># heterogeneous graph to heterogeneous graph, keep ndata and edata</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">dgl</span>
</span></span><span class="line"><span class="cl"><span class="n">hg</span> <span class="o">=</span> <span class="n">dgl</span><span class="o">.</span><span class="n">to_homogeneous</span><span class="p">(</span><span class="n">dgl_graph</span><span class="p">,</span> <span class="n">edata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;he&#39;</span><span class="p">],</span> <span class="n">ndata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feat&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œæˆ‘ä»¬çš„æ¨ç†æ¥å£å°±æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">do_inference</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span> <span class="c1"># pred in buffer_device</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">pred</span><span class="p">[</span><span class="n">node_idx</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¯ä»¥è°ƒç”¨ä¸€ä¸ªä¸€ä¸‹è¯•è¯•æ¨ç†æˆ‘ä»¬è¿™ä¸ªæ–°çš„ç‚¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">node_idx</span> <span class="o">=</span> <span class="n">node_id_map</span><span class="p">[</span><span class="n">vertex_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">4096</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">do_inference</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½åœ¨è¿™ä¸ªå°å­å›¾ä¸Šè®¡ç®—ä»–çš„æ­£ç¡®ç‡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test_inference</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span> <span class="c1"># pred in buffer_device</span>
</span></span><span class="line"><span class="cl">        <span class="n">pred</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">label</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">nid</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">MF</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">node_idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">node_id_map</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl"><span class="n">acc</span> <span class="o">=</span> <span class="n">test_inference</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Test Accuracy </span><span class="si">{:.4f}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¾“å‡ºç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">307</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">test_inference</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>     <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>     <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>         <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span> <span class="c1"># pred in buffer</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span> <span class="n">_device</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>         <span class="n">pred</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>         <span class="n">label</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">nid</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">MF</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span> <span class="n">node_idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">node_id_map</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span> <span class="n">acc</span> <span class="o">=</span> <span class="n">test_inference</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Test Accuracy </span><span class="si">{:.4f}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="mi">100</span><span class="o">%|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">&lt;</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mf">130.31</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="mi">100</span><span class="o">%|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">&lt;</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mf">152.29</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="mi">100</span><span class="o">%|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">&lt;</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mf">173.55</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Test</span> <span class="n">Accuracy</span> <span class="mf">0.9688</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªç¤ºä¾‹é¡¹ç›®çš„ä»£ç åœ¨ï¼š<a href="https://github.com/wey-gu/NebulaGraph-Fraud-Detection-GNN" target="_blank" rel="noopener noreferrer">github.com/wey-gu/NebulaGraph-Fraud-Detection-GNN</a> ï¼Œå¦‚æœ‰é—®é¢˜æ¬¢è¿ç•™è¨€ã€ISSUEã€‚</p>
<h3 id="æ€»ç»“" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93" class="header-mark"></a>1.6 æ€»ç»“</h3><p>æ€»ç»“èµ·æ¥ï¼Œæ¬ºè¯ˆæ£€æµ‹çš„æ–¹æ³•æœ‰ï¼š</p>
<ul>
<li>åœ¨ä¸€ä¸ªäº¤æ˜“å†å²ã€é£æ§çš„å›¾è°±ä¸Šï¼Œé€šè¿‡å›¾æ¨¡å¼æŸ¥è¯¢ç›´æ¥è·å¾—é£é™©æç¤º</li>
<li>å®šæœŸåˆ©ç”¨å›¾ç®—æ³•æ‰©å……é£é™©æ ‡æ³¨ï¼Œå†™å›å›¾åº“</li>
<li>å®šæœŸè®¡ç®—å›¾è°±ä¸­çš„å›¾ç‰¹å¾ï¼Œå’Œå…¶ä»–ç‰¹å¾ä¸€èµ·ç”¨ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ–¹æ³•ç¦»çº¿é¢„æµ‹é£é™©</li>
<li>å°†å›¾è°±ä¸­çš„å±æ€§å¤„ç†æˆä¸ºç‚¹ã€è¾¹ç‰¹å¾ï¼Œç”¨å›¾ç¥ç»ç½‘ç»œæ–¹æ³•ç¦»çº¿é¢„æµ‹é£é™©ï¼Œéƒ¨åˆ†å¯ä»¥ Inductive Learning çš„æ–¹æ³•ç»“åˆå›¾åº“å¯ä»¥å®ç°åœ¨çº¿é£é™©é¢„æµ‹</li>
</ul>
<blockquote>
<p>Feature Image credit goes to <a href="https://unsplash.com/photos/BW0vK-FA3eg" target="_blank" rel="noopener noreferrer">https://unsplash.com/photos/BW0vK-FA3eg</a></p>
</blockquote>]]></description>
</item><item>
    <title>åŸºäº NebulaGraph å›¾æ•°æ®åº“çš„ ID Resolution æ–¹æ³•ä¸ä»£ç ç¤ºä¾‹</title>
    <link>https://siwei.io/identity-resolution/</link>
    <pubDate>Sun, 14 Aug 2022 18:18:16 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/identity-resolution/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/identity-resolution/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>æœ¬æ–‡æ˜¯ä¸€ä¸ªåŸºäº NebulaGraph ä¸Šçš„å›¾ç®—æ³•ã€å›¾æ•°æ®åº“ã€å›¾ç¥ç»ç½‘ç»œçš„ ID-Mapping æ–¹æ³•ç»¼è¿°ï¼Œé™¤äº†åŸºæœ¬æ–¹æ³•æ€æƒ³çš„ä»‹ç»ä¹‹å¤–ï¼Œæˆ‘è¿˜ç»™å¤§å®¶å¼„äº†å¯ä»¥è·‘çš„ Playgroundã€‚</p>
</blockquote>
<blockquote>
<p>æœ¬æ–‡è¿˜åœ¨æ’°å†™ä¸­ï¼ŒTBD çš„ç« èŠ‚è¿˜è¯·è§è°…ã€‚</p>
</blockquote>
<!--

[TOC]

-->
<h2 id="åŸºäºå›¾æ•°æ®åº“çš„ç”¨æˆ·-id-è¯†åˆ«æ–¹æ³•" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%9b%be%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e7%94%a8%e6%88%b7-id-%e8%af%86%e5%88%ab%e6%96%b9%e6%b3%95" class="header-mark"></a>1 åŸºäºå›¾æ•°æ®åº“çš„ç”¨æˆ· ID è¯†åˆ«æ–¹æ³•</h2><p>ç”¨æˆ· ID è¯†åˆ«ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„å›¾æŠ€æœ¯åº”ç”¨åœºæ™¯ï¼Œåœ¨ä¸åŒçš„è¯­å¢ƒä¸‹å®ƒå¯èƒ½è¿˜è¢«å«åš Entity Correlationï¼ˆå®ä½“å…³è”ï¼‰ã€Entity Linkingï¼ˆå®ä½“é“¾æ¥ï¼‰ã€ID Mappingï¼ˆèº«ä»½æ˜ å°„ï¼‰ç­‰ç­‰ã€‚ID è¯†åˆ«è§£å†³çš„é—®é¢˜æ˜¯æ‰¾å‡ºç›¸åŒçš„ç”¨æˆ·åœ¨åŒä¸€ä¸ªç³»ç»Ÿæˆ–è€…ä¸åŒç³»ç»Ÿä¸­çš„ä¸åŒè´¦å·ã€‚</p>
<p>ç”±äº ID è¯†åˆ«å¤©ç„¶åœ°æ˜¯ä¸€ä¸ªå…³è”å…³ç³»é—®é¢˜ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå…¸å‹çš„å›¾ã€å›¾æ•°æ®åº“åº”ç”¨åœºæ™¯ã€‚</p>
<h3 id="å»ºç«‹å›¾è°±" class="headerLink">
    <a href="#%e5%bb%ba%e7%ab%8b%e5%9b%be%e8%b0%b1" class="header-mark"></a>1.1 å»ºç«‹å›¾è°±</h3><h4 id="å›¾å»ºæ¨¡" class="headerLink">
    <a href="#%e5%9b%be%e5%bb%ba%e6%a8%a1" class="header-mark"></a>1.1.1 å›¾å»ºæ¨¡</h4><p>æˆ‘ä»¬ä»ä¸€ä¸ªæœ€ç®€å•ã€ç›´æ¥çš„å›¾è°±å¼€å§‹ï¼Œå¦‚ä¸‹è¾¹çš„å›¾ç»“æ„ç¤ºæ„æ˜¾ç¤ºï¼Œæˆ‘ä»¬å®šä¹‰äº†ç‚¹ï¼š</p>
<ul>
<li>user
<ul>
<li>Prop: [name, email, birthday, address, phone_num]</li>
</ul>
</li>
<li>phone</li>
<li>email</li>
<li>device</li>
<li>ip</li>
<li>address</li>
</ul>
<p>åœ¨ä»–ä»¬ä¹‹é—´æœ‰å¾ˆè‡ªç„¶çš„è¾¹ï¼š</p>
<ul>
<li>used_device
<ul>
<li>Prop: time</li>
</ul>
</li>
<li>logged_in_from
<ul>
<li>Prop: time</li>
</ul>
</li>
<li>has_phone</li>
<li>has_address</li>
<li>has_email</li>
</ul>
<p><a class="lightgallery" href="https://raw.githubusercontent.com/wey-gu/identity-correlation-datagen/main/images/schema.svg?refresh=true" title="schema digram" data-thumbnail="https://raw.githubusercontent.com/wey-gu/identity-correlation-datagen/main/images/schema.svg?refresh=true">
        
    </a></p>
<h4 id="æ•°æ®" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae" class="header-mark"></a>1.1.2 æ•°æ®</h4><p>è¿™ä»½æ•°æ®æ˜¯å¼€æºçš„ï¼Œåœ°å€åœ¨ <a href="https://github.com/wey-gu/identity-correlation-datagen" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/identity-correlation-datagen</a></p>
<h4 id="å†™å…¥-nebulagraph" class="headerLink">
    <a href="#%e5%86%99%e5%85%a5-nebulagraph" class="header-mark"></a>1.1.3 å†™å…¥ NebulaGraph</h4><blockquote>
<p>åˆ©ç”¨ Nebula Upï¼Œä¸€è¡Œéƒ¨ç½² NebulaGraph</p>
<p>åœ°å€ï¼šhttps://github.com/wey-gu/nebula-up/</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -fsSL nebula-up.siwei.io/install.sh <span class="p">|</span> bash
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<p>å›¾å»ºæ¨¡çš„ Schema å¯¹åº”çš„ NebulaGraph DDL æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="err">åˆ›å»ºä¸€ä¸ªå«åš</span><span class="w"> </span><span class="n">entity_resolution</span><span class="w"> </span><span class="err">çš„å›¾ç©ºé—´</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">SPACE</span><span class="w"> </span><span class="n">entity_resolution</span><span class="w"> </span><span class="p">(</span><span class="n">vid_type</span><span class="o">=</span><span class="n">FIXED_STRING</span><span class="p">(</span><span class="mi">30</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">USE</span><span class="w"> </span><span class="n">entity_resolution</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="err">åˆ›å»ºç‚¹çš„ç±»å‹</span><span class="w"> </span><span class="n">TAG</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">email</span><span class="o">`</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">phone_num</span><span class="o">`</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">birthday</span><span class="o">`</span><span class="w"> </span><span class="nb">date</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">address</span><span class="o">`</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">`</span><span class="n">address</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">address</span><span class="o">`</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">`</span><span class="n">device</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">uuid</span><span class="o">`</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">`</span><span class="n">email</span><span class="o">`</span><span class="w"> </span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">`</span><span class="n">ip</span><span class="o">`</span><span class="w"> </span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">`</span><span class="n">phone</span><span class="o">`</span><span class="w"> </span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="err">åˆ›å»ºè¾¹çš„ç±»å‹</span><span class="w"> </span><span class="n">Edge</span><span class="w"> </span><span class="k">Type</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">used_device</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">time</span><span class="o">`</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">logged_in_from</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">time</span><span class="o">`</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">has_phone</span><span class="o">`</span><span class="w"> </span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">has_address</span><span class="o">`</span><span class="w"> </span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">has_email</span><span class="o">`</span><span class="w"> </span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºå†™å…¥æ•°æ®çš„ DMLï¼Œè¿™é‡Œåªç»™å‡º <code>user</code> ï¼Œ<code>email</code> ç±»å‹ç‚¹ã€<code>has_email</code> ç±»å‹è¾¹çš„ä¾‹å­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="n">VERTEX</span><span class="w"> </span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">email</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">birthday</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">address</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">phone_num</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_1&#34;</span><span class="p">:(</span><span class="s2">&#34;heathermoore@johnson.com&#34;</span><span class="p">,</span><span class="s2">&#34;Miranda Miller&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1957-08-27&#34;</span><span class="p">),</span><span class="s2">&#34;Brittany Forge Apt. 718 East Eric  WV 97881&#34;</span><span class="p">,</span><span class="s2">&#34;+1-652-450-5443x00562&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_2&#34;</span><span class="p">:(</span><span class="s2">&#34;holly@welch.org&#34;</span><span class="p">,</span><span class="s2">&#34;Holly Pollard&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1990-10-19&#34;</span><span class="p">),</span><span class="s2">&#34;1 Amanda Freeway Lisaland  NJ 94933&#34;</span><span class="p">,</span><span class="s2">&#34;600-192-2985x041&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_3&#34;</span><span class="p">:(</span><span class="s2">&#34;julia.h.24@gmail.com&#34;</span><span class="p">,</span><span class="s2">&#34;Julia Hall&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1927-08-24&#34;</span><span class="p">),</span><span class="s2">&#34;Rodriguez Track East Connorfort  NC 63144&#34;</span><span class="p">,</span><span class="s2">&#34;1248361783&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_4&#34;</span><span class="p">:(</span><span class="s2">&#34;franklin.b@gibson.biz&#34;</span><span class="p">,</span><span class="s2">&#34;Franklin Barnett&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;2020-03-01&#34;</span><span class="p">),</span><span class="s2">&#34;Richard Curve Kingstad  AZ 05660&#34;</span><span class="p">,</span><span class="s2">&#34;(224)497-9312&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_5&#34;</span><span class="p">:(</span><span class="s2">&#34;4kelly@yahoo.com&#34;</span><span class="p">,</span><span class="s2">&#34;April Kelly&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1967-12-01&#34;</span><span class="p">),</span><span class="s2">&#34;Schmidt Key Lake Charles  AL 36174&#34;</span><span class="p">,</span><span class="s2">&#34;410.138.1816x98702&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_6&#34;</span><span class="p">:(</span><span class="s2">&#34;steven.web@johnson.com&#34;</span><span class="p">,</span><span class="s2">&#34;Steven Webb&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1955-04-24&#34;</span><span class="p">),</span><span class="s2">&#34;5 Joanna Key Suite 704 Frankshire  OK 03035&#34;</span><span class="p">,</span><span class="s2">&#34;3666519376&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_7&#34;</span><span class="p">:(</span><span class="s2">&#34;Jessica_Torres@morris.com&#34;</span><span class="p">,</span><span class="s2">&#34;Jessica Torres&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1958-09-03&#34;</span><span class="p">),</span><span class="s2">&#34;1 Payne Circle Mitchellfort  LA 73053&#34;</span><span class="p">,</span><span class="s2">&#34;535-357-3112x4903&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_8&#34;</span><span class="p">:(</span><span class="s2">&#34;brettglenn@gmail.com&#34;</span><span class="p">,</span><span class="s2">&#34;Brett Glenn&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1992-09-03&#34;</span><span class="p">),</span><span class="s2">&#34;Weber Unions Eddieland  MT 64619&#34;</span><span class="p">,</span><span class="s2">&#34;660.391.3730&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_9&#34;</span><span class="p">:(</span><span class="s2">&#34;veronica.j@yahoo.com&#34;</span><span class="p">,</span><span class="s2">&#34;Veronica Jordan&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1947-06-08&#34;</span><span class="p">),</span><span class="s2">&#34;2 Klein Mission New Annetteton  HI 05775&#34;</span><span class="p">,</span><span class="s2">&#34;810-252-6218&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_10&#34;</span><span class="p">:(</span><span class="s2">&#34;steven@phelps-craig.info&#34;</span><span class="p">,</span><span class="s2">&#34;Steven Brooks&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1954-06-14&#34;</span><span class="p">),</span><span class="s2">&#34;1 Vanessa Stravenue Suite 184 Baileyville  NY 46381&#34;</span><span class="p">,</span><span class="s2">&#34;+1-665-328-8103x3448&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_11&#34;</span><span class="p">:(</span><span class="s2">&#34;ReginaldTheMan@hotmail.com&#34;</span><span class="p">,</span><span class="s2">&#34;Reginald Mccullough&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1915-04-12&#34;</span><span class="p">),</span><span class="s2">&#34;John Garden Port John  LA 54602&#34;</span><span class="p">,</span><span class="s2">&#34;030.088.4523x94511&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_12&#34;</span><span class="p">:(</span><span class="s2">&#34;Jennifer.f@carroll-acosta.com&#34;</span><span class="p">,</span><span class="s2">&#34;Jennifer Foster&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1988-04-30&#34;</span><span class="p">),</span><span class="s2">&#34;11 Webb Groves Tiffanyside  MN 14566&#34;</span><span class="p">,</span><span class="s2">&#34;(489)306-8558x98227&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_13&#34;</span><span class="p">:(</span><span class="s2">&#34;Philip66@yahoo.com&#34;</span><span class="p">,</span><span class="s2">&#34;Philip Garcia&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1955-12-01&#34;</span><span class="p">),</span><span class="s2">&#34;70 Robinson Locks Suite 113 East Veronica  ND 87845&#34;</span><span class="p">,</span><span class="s2">&#34;490-088-7610x9437&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_14&#34;</span><span class="p">:(</span><span class="s2">&#34;Ann@hernandez.com&#34;</span><span class="p">,</span><span class="s2">&#34;Ann Williams&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1947-05-28&#34;</span><span class="p">),</span><span class="s2">&#34;24 Mcknight Port Apt. 028 Sarahborough  MD 38195&#34;</span><span class="p">,</span><span class="s2">&#34;868.057.4056x4814&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_15&#34;</span><span class="p">:(</span><span class="s2">&#34;Jessica@turner.com&#34;</span><span class="p">,</span><span class="s2">&#34;Jessica Stewart&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1951-11-28&#34;</span><span class="p">),</span><span class="s2">&#34;0337 Mason Corner Apt. 900 Toddmouth  FL 61464&#34;</span><span class="p">,</span><span class="s2">&#34;(335)408-3835x883&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_16&#34;</span><span class="p">:(</span><span class="s2">&#34;Sandra311@hotmail.com&#34;</span><span class="p">,</span><span class="s2">&#34;Sandra Dougherty&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1908-06-03&#34;</span><span class="p">),</span><span class="s2">&#34;7 Davis Station Apt. 691 Pittmanfort  HI 29746&#34;</span><span class="p">,</span><span class="s2">&#34;+1-189-827-0744x27614&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_17&#34;</span><span class="p">:(</span><span class="s2">&#34;Sharon91@gmail.com&#34;</span><span class="p">,</span><span class="s2">&#34;Sharon Mccoy&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1958-09-01&#34;</span><span class="p">),</span><span class="s2">&#34;1 Southport Street Apt. 098 Westport  KY 85907&#34;</span><span class="p">,</span><span class="s2">&#34;(814)898-9079x898&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_18&#34;</span><span class="p">:(</span><span class="s2">&#34;Sharon91+001@gmail.com&#34;</span><span class="p">,</span><span class="s2">&#34;Kathryn Miller&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1958-09-01&#34;</span><span class="p">),</span><span class="s2">&#34;1 Southport Street Apt. 098 Westport  KY 85907&#34;</span><span class="p">,</span><span class="s2">&#34;(814)898-9079x898&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_19&#34;</span><span class="p">:(</span><span class="s2">&#34;brettglenn@googlemail.com&#34;</span><span class="p">,</span><span class="s2">&#34;Bretty Glenn&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1991-09-03&#34;</span><span class="p">),</span><span class="s2">&#34;Weber Unions Eddieland  MT 64619&#34;</span><span class="p">,</span><span class="s2">&#34;660-391-3730&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_20&#34;</span><span class="p">:(</span><span class="s2">&#34;julia.h.24@yahoo.com&#34;</span><span class="p">,</span><span class="s2">&#34;Julia H.&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;1927-08-24&#34;</span><span class="p">),</span><span class="s2">&#34;Rodriguez Track East Connorfort NC 63144&#34;</span><span class="p">,</span><span class="s2">&#34;1248361783&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_21&#34;</span><span class="p">:(</span><span class="s2">&#34;holly@welch.org&#34;</span><span class="p">,</span><span class="s2">&#34;Holly&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;0000-10-19&#34;</span><span class="p">),</span><span class="s2">&#34;1 Amanda Freeway Lisaland  NJ 94933&#34;</span><span class="p">,</span><span class="s2">&#34;(600)-192-2985&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_22&#34;</span><span class="p">:(</span><span class="s2">&#34;veronica.j@yahoo.com&#34;</span><span class="p">,</span><span class="s2">&#34;Veronica Jordan&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;0000-06-08&#34;</span><span class="p">),</span><span class="s2">&#34;2 Klein HI 05775&#34;</span><span class="p">,</span><span class="s2">&#34;(810)-252-6218&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_23&#34;</span><span class="p">:(</span><span class="s2">&#34;4kelly@hotmail.com&#34;</span><span class="p">,</span><span class="s2">&#34;Kelly April&#34;</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">&#34;2010-01-01&#34;</span><span class="p">),</span><span class="s2">&#34;Schmidt Key Lake Charles AL 13617&#34;</span><span class="p">,</span><span class="s2">&#34;410-138-1816&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">VERTEX</span><span class="w"> </span><span class="o">`</span><span class="n">email</span><span class="o">`</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;heathermoore@johnson.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;holly@welch.org&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;julia.h.24@gmail.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;franklin.b@gibson.biz&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;4kelly@yahoo.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;steven.web@johnson.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Jessica_Torres@morris.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;brettglenn@gmail.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;veronica.j@yahoo.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;steven@phelps-craig.info&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;ReginaldTheMan@hotmail.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Jennifer.f@carroll-acosta.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Philip66@yahoo.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Ann@hernandez.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Jessica@turner.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Sandra311@hotmail.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Sharon91@gmail.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Sharon91+001@gmail.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;brettglenn@googlemail.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;julia.h.24@yahoo.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;holly@welch.org&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;veronica.j@yahoo.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;4kelly@hotmail.com&#34;</span><span class="p">:();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">VERTEX</span><span class="w"> </span><span class="o">`</span><span class="n">ip</span><span class="o">`</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;202.123.513.12&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;202.41.23.11&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;143.1.23.4&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;143.1.23.12&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;153.42.2.8&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;9.1.4.1&#34;</span><span class="p">:();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">VERTEX</span><span class="w"> </span><span class="o">`</span><span class="n">device</span><span class="o">`</span><span class="p">(</span><span class="o">`</span><span class="n">uuid</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;device_0&#34;</span><span class="p">:(</span><span class="s2">&#34;2a8e791d-0183-4df2-aa36-5ac82151be93&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;device_1&#34;</span><span class="p">:(</span><span class="s2">&#34;f9be6a11-f74b-45f5-a9ea-bb3af5a868a2&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;device_2&#34;</span><span class="p">:(</span><span class="s2">&#34;ae083379-91f5-4cd3-b2b3-273960979dab&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;device_3&#34;</span><span class="p">:(</span><span class="s2">&#34;c0981d43-1e59-4cd5-a1e1-e88cd9e792a5&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;device_4&#34;</span><span class="p">:(</span><span class="s2">&#34;e730dd8a-fcd3-47b4-be4a-0190610e6f02&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">has_email</span><span class="o">`</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_1&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;heathermoore@johnson.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_2&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;holly@welch.org&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_3&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;julia.h.24@gmail.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_4&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;franklin.b@gibson.biz&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_5&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;4kelly@yahoo.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_6&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;steven.web@johnson.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_7&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Jessica_Torres@morris.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_8&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;brettglenn@gmail.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_9&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;veronica.j@yahoo.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_10&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;steven@phelps-craig.info&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_11&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;ReginaldTheMan@hotmail.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_12&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Jennifer.f@carroll-acosta.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_13&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Philip66@yahoo.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_14&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Ann@hernandez.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_15&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Jessica@turner.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_16&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Sandra311@hotmail.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_17&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Sharon91@gmail.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_18&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Sharon91+001@gmail.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_19&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;brettglenn@googlemail.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_20&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;julia.h.24@yahoo.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_21&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;holly@welch.org&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_22&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;veronica.j@yahoo.com&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_23&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;4kelly@hotmail.com&#34;</span><span class="p">:();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">used_device</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">time</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_2&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;device_0&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:00:00&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_21&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;device_0&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:01:00&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_18&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;device_1&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:02:00&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_17&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;device_1&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:03:00&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_22&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;device_2&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:04:00&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_9&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;device_3&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:05:00&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_9&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;device_2&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:06:00&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_23&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;device_4&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:07:00&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">logged_in_from</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">time</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_2&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;202.123.513.12&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:00:00&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_21&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;202.41.23.11&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:01:00&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_18&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;143.1.23.4&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:02:00&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_17&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;143.1.23.12&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:03:00&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_22&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;153.42.2.8&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:04:00&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_9&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;153.42.2.8&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:05:00&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_9&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;153.42.2.8&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:06:00&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_23&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;9.1.4.1&#34;</span><span class="p">:(</span><span class="k">timestamp</span><span class="p">(</span><span class="s2">&#34;2021-03-01T08:07:00&#34;</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ ¹æ®ç¡®å®šè§„åˆ™è·å–-id-æ˜ å°„å…³ç³»" class="headerLink">
    <a href="#%e6%a0%b9%e6%8d%ae%e7%a1%ae%e5%ae%9a%e8%a7%84%e5%88%99%e8%8e%b7%e5%8f%96-id-%e6%98%a0%e5%b0%84%e5%85%b3%e7%b3%bb" class="header-mark"></a>1.2 æ ¹æ®ç¡®å®šè§„åˆ™è·å– ID æ˜ å°„å…³ç³»</h3><p>æœ€ç®€å•ã€ç›´æ¥çš„æ–¹æ³•ï¼Œåœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹ä¹Ÿå¯èƒ½æ˜¯æœ‰ç”¨çš„ï¼Œè¯•æƒ³åƒ emailã€IP åœ°å€ã€ä¸Šç½‘è®¾å¤‡è¿™äº›æœ‰ä¸¥æ ¼ç»“æ„çš„æ•°æ®ï¼Œåœ¨å®ƒä»¬æˆä¸ºå›¾è°±ä¸­çš„ç‚¹çš„æ—¶å€™ï¼Œç®€å•çš„ç›¸ç­‰å…³ç³»å°±è¶³ä»¥æ‰¾å‡ºè¿™æ ·å¯¹åº”å…³ç³»ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>æ‹¥æœ‰ç›¸åŒçš„ email</li>
<li>ä½¿ç”¨è¿‡ç›¸åŒçš„ IP åœ°å€</li>
<li>ä½¿ç”¨è¿‡ç›¸åŒçš„è®¾å¤‡</li>
</ul>
<p>åœ¨å‰è¾¹çš„å›¾è°±ã€å›¾æ•°æ®åº“ä¸­ï¼Œæ‹¥æœ‰ç›¸åŒçš„ email å¯ä»¥ç›´æ¥è¡¨è¾¾ä¸ºå¦‚ä¸‹çš„å›¾æ¨¡å¼ï¼ˆGraph Patternï¼‰ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(:user)-[:has_email]-&gt;(:email)&lt;-[:has_email]-[:user]
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‹å›¾ä¸ºé¡¶ç‚¹ï¼š user ä¸è¾¹ï¼šhas_email çš„ä¸€ä¸ªå›¾çš„å¯è§†åŒ–ç»“æœï¼Œå¯ä»¥çœ‹åˆ°è¿™å…¶ä¸­æœ‰ä¸¤ä¸ªä¸‰ä¸ªç‚¹ç›¸è¿çš„ä¸²æ­£æ˜¯ç¬¦åˆæ‹¥æœ‰ç›¸åŒ email çš„æ¨¡å¼çš„ç‚¹ã€‚</p>
<blockquote>
<p>æ³¨ï¼š</p>
<ul>
<li>è¿™ä¸ªç»“æœçš„æ•°æ®æºåœ¨ <a href="https://github.com/wey-gu/identity-correlation-datagen/tree/main/sample/hand_crafted" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/identity-correlation-datagen/tree/main/sample/hand_crafted</a></li>
<li>å¦‚æœé€šè¿‡çº¿ä¸Šè®¿é—®æœ¬æ–‡ï¼Œä½ å¯ä»¥é¼ æ ‡æ‚¬åœï¼ˆè·å–ç‚¹ä¸Šçš„å±æ€§ï¼‰å’Œæ¡†é€‰æ”¾å¤§æ¯ä¸€ä¸ªç‚¹å’Œå­å›¾å“¦ã€‚</li>
</ul>
</blockquote>
<iframe src="https://datapane.com/reports/v7JN2E7/user-shared-email/embed/" width="100%" height="540px" style="border: none;">IFrame not supported</iframe>
<p>æ˜¾ç„¶ï¼Œåœ¨æ„å»º ID Mapping ç³»ç»Ÿçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°±æ˜¯é€šè¿‡åœ¨å›¾æ•°æ®åº“ä¸­ç›´æ¥æŸ¥è¯¢ï¼Œå¯è§†åŒ–æ¸²æŸ“ç»“æœæ¥çœ‹åˆ°ç­‰æ•ˆçš„æ´å¯Ÿï¼Œè¿™ä¸ªæŸ¥è¯¢å¯ä»¥å†™æˆï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MATCH p=(:user)-[:has_email]-&gt;(:email)&lt;-[:has_email]-(:user)
</span></span><span class="line"><span class="cl">RETURN p limit 10
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>NebulaGraph ä¸­çš„æŸ¥è¯¢ç»“æœ</p>
</blockquote>
<p><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/186616734-31a010e3-5a0d-4072-8477-7cf753b348a1.png" title="https://user-images.githubusercontent.com/1651790/186616734-31a010e3-5a0d-4072-8477-7cf753b348a1.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/186616734-31a010e3-5a0d-4072-8477-7cf753b348a1.png">
        
    </a></p>
<blockquote>
<p>åŒæ ·ï¼Œåœ¨ä¸Šè¾¹äº¤äº’å›¾ä¸­å¯ä»¥æ”¾å¤§çœ‹åˆ°è¿™ä¸¤å¯¹æ‹¥æœ‰ç›¸åŒ email å…³è”èµ·æ¥çš„è´¦å·ï¼š</p>
</blockquote>
<p><a class="lightgallery" href="./shared_email.webp" title="./shared_email.webp" data-thumbnail="./shared_email.webp">
        
    </a></p>
<p>ç„¶è€Œï¼Œåœ¨æ›´å¤šçœŸå®ä¸–ç•Œä¸­ï¼Œè¿™æ ·çš„æ¨¡å¼åŒ¹é…å¾€å¾€ä¸èƒ½è§£å†³æ›´å¤šç¨å¾®å¤æ‚ä¸€ç‚¹çš„æƒ…å½¢ï¼š</p>
<p>æ¯”å¦‚ä»ä¸Šè¾¹çš„å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªåŒ¹é…äº†çš„æ˜ å°„ä¸­ï¼Œ<code>holly@welch.org</code> å…³è”ä¸‹çš„ä¸¤ä¸ªç”¨æˆ·çš„å§“åæ˜¯ä¸åŒçš„ï¼Œè€Œ <code>veronica.j@yahoo.com</code> å…³è”ä¸‹çš„ä¸¤ä¸ªç”¨æˆ·å§“åæ˜¯å®Œå…¨ç›¸åŒçš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">user_2,holly@welch.org,Holly Pollard,1990-10-19,1 Amanda Freeway Lisaland  NJ 94933,600-192-2985x041
</span></span><span class="line"><span class="cl">user_21,holly@welch.org,Holly,0000-10-19,1 Amanda Freeway Lisaland  NJ 94933,(600)-192-2985
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†æ¯”å¦‚ <code>Sharon91@gmail.com</code> å’Œ <code>Sharon91+001@gmail.com</code> ï¼Œè¿™ä¸¤ä¸ªäººçš„å§“åä¸åŒï¼Œä½†æ˜¯æ‰‹æœºå’Œåœ°å€å´æ˜¯ç›¸åŒçš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">user_17,Sharon91@gmail.com,Sharon Mccoy,1958-09-01,1 Southport Street Apt. 098 Westport  KY 85907,(814)898-9079x898
</span></span><span class="line"><span class="cl">user_18,Sharon91+001@gmail.com,Kathryn Miller,1958-09-01,1 Southport Street Apt. 098 Westport  KY 85907,(814)898-9079x898
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¯”è¾ƒåº†å¹¸çš„æ˜¯æˆ‘ä»¬åªéœ€è¦å¢åŠ ç±»ä¼¼äº&quot;æ‹¥æœ‰ç›¸åŒé‚®ç®±&quot;ã€&ldquo;æ‹¥æœ‰ç›¸åŒåœ°å€&rdquo;ã€&ldquo;æ‹¥æœ‰ç›¸åŒç”µè¯&quot;ç­‰å…¶ä»–æ¡ä»¶å°±å¯ä»¥æŠŠè¿™ç§æƒ…å†µè€ƒè™‘è¿›æ¥äº†ï¼Œè€Œéšä¹‹è€Œæ¥çš„é—®é¢˜æ˜¯ï¼š</p>
<ul>
<li>ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½è‡³å°‘å­˜åœ¨æŸä¸€ä¸ªç¡®å®šæ¡ä»¶çš„ç›¸ç­‰ï¼ˆäºŒå…ƒçš„æ˜¯ä¸å¦ï¼‰ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ä¸€æ¡ç¡®å®šçš„è¾¹å»è¿æ¥å®ƒä»¬ï¼Œæ¯”å¦‚è¿™ä¸¤ä¸ªè´¦æˆ·ä¸­ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">user_5,4kelly@yahoo.com,April Kelly,1967-12-01,Schmidt Key Lake Charles AL 36174,410.138.1816x98702
</span></span><span class="line"><span class="cl">user_23,4kelly@hotmail.com,Kelly April,2010-01-01,Schmidt Key Lake Charles AL 13617,410-138-1816
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¦‚ä½•è¡¨ç° <code>4kelly@yahoo.com</code> ä¸ <code>4kelly@hotmail.com</code> çš„ç›¸ä¼¼æ€§ï¼Ÿ</li>
<li>å¦‚ä½•å°†å¤šç§åŒ¹é…è§„åˆ™çš„ä¿¡æ¯éƒ½çº³å…¥å…³è”ç³»ç»Ÿï¼Ÿ</li>
</ul>
<h3 id="éç¡®å®šè§„åˆ™åŸºäºå¤åˆæ¡ä»¶é‡åŒ–æ–¹æ³•" class="headerLink">
    <a href="#%e9%9d%9e%e7%a1%ae%e5%ae%9a%e8%a7%84%e5%88%99%e5%9f%ba%e4%ba%8e%e5%a4%8d%e5%90%88%e6%9d%a1%e4%bb%b6%e9%87%8f%e5%8c%96%e6%96%b9%e6%b3%95" class="header-mark"></a>1.3 éç¡®å®šè§„åˆ™åŸºäºå¤åˆæ¡ä»¶é‡åŒ–æ–¹æ³•</h3><p>å‰è¾¹æåˆ°äº†å‡ ç§ç¡®å®šè§„åˆ™æ— æ³•å¤„ç†çš„æƒ…å†µï¼Œå®ƒä»¬å¯ä»¥å½’ç»“ä¸ºè¿™ä¸¤ç‚¹ï¼š</p>
<ol>
<li>éœ€è¦å¤šå› ç´ ï¼ˆè§„åˆ™ï¼‰è¿›è¡Œç»¼åˆè€ƒè™‘ä¸åˆ¤å®š</li>
<li>éœ€è¦å¯¹éç¡®å®šæ¡ä»¶ï¼ˆå±æ€§ï¼‰è¿›è¡Œå¤„ç†ï¼ŒæŒ–æ˜éšå«ç›¸ç­‰ã€ç›¸ä¼¼çš„å…³è”å…³ç³»ï¼ˆè¾¹ï¼‰</li>
</ol>
<p>å¯¹äº 1. ï¼Œå¾ˆè‡ªç„¶å¯ä»¥æƒ³åˆ°å¯¹å¤šç§å…³è”æ¡ä»¶è¿›è¡Œé‡åŒ–è¯„åˆ†ï¼ˆscoreï¼‰ï¼ŒæŒ‰ç…§å¤šç§æ¡ä»¶çš„é‡è¦ç¨‹åº¦è¿›è¡ŒåŠ æƒï¼Œç»™å‡ºè®¤å®šä¸ºå…³è”çš„æ€»åˆ†çš„é˜ˆå€¼ã€‚</p>
<p>æœ‰äº†å¤šå› ç´ è¯„åˆ†çš„æœºåˆ¶ï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘å¦‚ä½•åœ¨ç¡®å®šçš„å¤šå› ç´ åŸºç¡€ä¹‹ä¸Šï¼Œå¢åŠ å¯¹ä¸ç¡®å®šå› ç´ çš„å¤„ç†ï¼Œä»è€Œè§£å†³ 2.çš„æƒ…å†µã€‚è¿™é‡Œï¼Œéç¡®å®šçš„æ¡ä»¶å¯èƒ½æ˜¯ï¼š</p>
<p>a. è¡¨ç°ç»“æ„åŒ–æ•°æ®çš„ç›¸ä¼¼æ€§ï¼š<code>Sharon91@gmail.com</code> ä¸ <code>Sharon91+001@gmail.com</code></p>
<p>b. è¡¨ç°éç»“æ„åŒ–æ•°æ®çš„ç›¸ä¼¼æ€§ï¼š</p>
<ul>
<li><code>Schmidt Key Lake Charles AL 36174</code> ä¸ <code>Schmidt Key Lake Charles AL 13617</code></li>
<li><code>600-192-2985x041</code> ä¸<code>(600)-192-2985</code></li>
</ul>
<p>å¯¹äº a. çš„ç»“æ„åŒ–æ•°æ®ä¸­çš„ç›¸ä¼¼æ€§ï¼Œæœ‰ä¸¤ä¸ªæ€è·¯æ˜¯å¯ä»¥è€ƒè™‘çš„ï¼š</p>
<ul>
<li>ç›´æ¥è¿›è¡Œä¸¤ä¸ªå€¼çš„ç›¸ä¼¼åº¦
<ul>
<li>ç›´æ¥åˆ¤å®šå­å­—ç¬¦ä¸²</li>
<li>è¿ç®— Jaccard index ç­‰ç±»ä¼¼çš„ç›¸ä¼¼åº¦</li>
</ul>
</li>
<li>æ‹†åˆ†ä¸ºæ›´ç»†ç²’çš„å¤šä¸ªå±æ€§
<ul>
<li>å°† email <code>foo+num@bar.com</code> æ‹†åˆ†æˆä¸‰ä¸ªå­å±æ€§ email_handle: <code>foo</code>, email_alias: <code>num</code>, email_domain: <code>bar.com</code>
<ul>
<li>ç„¶åå°±å¯ä»¥è®¾è®¡è¯¦ç»†çš„ç¡®å®šæ€§è§„åˆ™ï¼šemail.handle ç›¸ç­‰ã€ç”šè‡³å†åœ¨æ­¤åŸºç¡€ä¸Šåº”ç”¨å…¶ä»–éç¡®å®šè§„åˆ™</li>
<li>æœ‰æ—¶å€™ï¼Œæ¯”å¦‚å¯¹äº email_domain å­—æ®µï¼Œæˆ‘ä»¬è¿˜çŸ¥é“ gmail.com å’Œ googlemail.com æ˜¯ç­‰ä»·çš„ï¼Œè¿™é‡Œçš„å¤„ç†ä¹Ÿæ˜¯å¯ä»¥è€ƒè™‘çš„ï¼ˆåƒæ˜¯<code>user_19,brettglenn@googlemail.com</code> ä¸ <code>user_8,brettglenn@gmail.com</code>ï¼Œä½†ä»é‚®ç®±åˆ¤æ–­èƒŒåå°±æ˜¯åŒä¸€ä¸ªæŒæœ‰è€…)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>è€Œå¯¹äº b. çš„éç»“æ„å±æ€§ç›¸ä¼¼æ€§è·ç¦»ï¼Œå¤„ç†æ–¹å¼å¯ä»¥æ ¹æ®å…·ä½“çš„ domain knowledge åƒå·®ä¸‡åˆ«ï¼š</p>
<ul>
<li>åƒ <code>Schmidt Key Lake Charles AL 36174</code> ä¸ <code>Schmidt Key Lake Charles AL 13617</code> çš„åœ°å€ä¿¡æ¯ï¼Œé™¤äº†å¯ä»¥ç”¨å€¼çš„ç›¸ä¼¼åº¦ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æŠŠå®ƒè½¬æ¢æˆåœ°ç†ç±»å‹çš„å±æ€§ï¼Œæ¯”å¦‚ä¸€ä¸ªç»çº¬åº¦ç»„æˆçš„ç‚¹ï¼Œä»è€Œè®¡ç®—ä¸¤ä¸ªç‚¹ä¹‹é—´çš„åœ°ç†è·ç¦»ï¼Œæ ¹æ®ç»™å®šçš„è·ç¦»å€¼æ¥æ‰“åˆ†ã€‚</li>
</ul>
<blockquote>
<p>æ³¨ï¼Œä½ çŸ¥é“å—ï¼ŸNebulaGraph å›¾æ•°æ®åº“ä¸­åŸç”Ÿæ”¯æŒåœ°ç†ç±»å‹çš„å±æ€§ä¸ç´¢å¼•ï¼Œå¯ä»¥ç›´æ¥åˆ›å»º Point ç±»å‹çš„åœ°ç†å±æ€§ï¼Œå¹¶è®¡ç®—ä¸¤ä¸ª Point ä¹‹é—´çš„è·ç¦»ã€‚</p>
</blockquote>
<ul>
<li>å¯¹äº <code>600-192-2985x041</code> ä¸<code>(600)-192-2985</code> è¿™ç§å­—ç¬¦ä¸²å½¢å¼çš„ç”µè¯å·ç ï¼Œåˆ™å¯ä»¥ç»Ÿä¸€è½¬åŒ–ä¸º<code>&lt;å›½å®¶ç &gt;+&lt;åŒºåŸŸç &gt;+&lt;æœ¬åœ°å·ç &gt;+&lt;åˆ†æœºå·&gt;</code>è¿™æ ·çš„ç»“æ„åŒ–æ•°æ®ï¼Œè¿›ä¸€æ­¥æŒ‰ç…§ç»“æ„åŒ–æ•°æ®çš„æ–¹å¼å¤„ç†ã€‚</li>
<li>å¦‚æœè´¦å·å­˜åœ¨å›¾ç‰‡å¯¹è±¡ URLï¼Œå¯ä»¥å¯¹æ¯”å…¶æ–‡ä»¶ç›¸ä¼¼åº¦ã€‚</li>
</ul>
<p>å¦å¤–ï¼Œå¯¹äºéç»“æ„å±æ€§çš„ç›¸ä¼¼æ€§è®¡ç®—æˆ‘ä»¬è¦å°½é‡é¿å…ä¸¤ä¸¤ç©·ä¸¾è¿ç®—çš„æ–¹å¼ï¼ˆç¬›å¡å°”ç§¯ï¼‰ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæŒ‡æ•°å¢é•¿çš„é‡çº§ï¼Œä¸€ä¸ªå¯è¡Œçš„æ–¹æ³•æ˜¯åªæ¯”è¾ƒå»ºç«‹äº†ç¡®å®šæ€§å…³ç³»ï¼ˆæ¯”å¦‚ç›¸åŒé‚®ä»¶å‰ç¼€ï¼šemail_handleï¼Œåœ°å€åœ¨ç›¸åŒè¡—åŒºï¼ŒIP åœ¨åŒä¸€ä¸ªç½‘æ®µç­‰ï¼‰çš„å®ä½“ã€‚</p>
<p><strong>å°ç»“</strong></p>
<p>æ€»ç»“æ¥çœ‹ï¼Œä¸ºäº†è§£å†³çœŸå®ä¸–ç•Œæ•°æ®çš„å¤æ‚æƒ…å½¢ï¼ŒåŸºäºå¤åˆæ¡ä»¶çš„é‡åŒ–æ–¹æ³•æœ‰ï¼š</p>
<ul>
<li>
<p>é€šè¿‡ç»†åŒ–ç»“æ„æ•°æ®ï¼ˆæ¯”å¦‚é‚®ç®±å­—æ®µæ‹†åˆ†ä¸ºå­å±æ€§æˆ–è€…ç‚¹ï¼‰ã€æˆ–è€…è½¬å˜ä¸ºç»“æ„åŒ–æ•°æ®ï¼ˆå¤„ç†å­—ç¬¦ä¸²å½¢å¼çš„ç”µè¯å·ç ï¼‰å»ºç«‹ç›¸ä¼¼ç»“æ„åŒ–æ•°æ®ä¹‹é—´çš„ç¡®å®šå…³è”ï¼›</p>
</li>
<li>
<p>åœ¨æœ‰é™å­˜åœ¨ç¡®å®šæ€§å…³è”çš„ç‚¹ä¹‹é—´ï¼ˆé¿å…ä¸¤ä¸¤ç©·ä¸¾ï¼‰ï¼Œè¿ç®—å…¶ä»–é‡åŒ–ã€éç¡®å®šç›¸ä¼¼æ€§ï¼ˆå­—ç¬¦è·ç¦»ã€åœ°ç†è·ç¦»ç­‰ã€å›¾ç‰‡æ–‡ä»¶ç›¸ä¼¼åº¦ï¼‰ï¼›</p>
</li>
<li>
<p>ä¸ºä¸åŒå…³ç³»èµ‹äºˆåŠ æƒï¼Œè®¡ç®—ç›¸ä¼¼åº¦æ€»åˆ†ï¼›</p>
</li>
</ul>
<h4 id="åŸºäºå¤åˆæ¡ä»¶é‡åŒ–æ–¹æ³•å®æ“" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%a4%8d%e5%90%88%e6%9d%a1%e4%bb%b6%e9%87%8f%e5%8c%96%e6%96%b9%e6%b3%95%e5%ae%9e%e6%93%8d" class="header-mark"></a>1.3.1 åŸºäºå¤åˆæ¡ä»¶é‡åŒ–æ–¹æ³•å®æ“</h4><p>ä¸‹è¾¹ï¼Œæˆ‘ä»¬æ¥ç»™å‡ºè¿™ç³»åˆ—æ–¹æ³•çš„å®æ“æ¡ˆä¾‹ã€‚</p>
<p><strong>1. ç»†åŒ–ç»“æ„æ•°æ®</strong></p>
<blockquote>
<p>é€šè¿‡ç»†åŒ–ç»“æ„æ•°æ®ï¼ˆæ¯”å¦‚é‚®ç®±å­—æ®µæ‹†åˆ†ä¸ºå­å±æ€§æˆ–è€…ç‚¹ï¼‰ã€æˆ–è€…è½¬å˜ä¸ºç»“æ„åŒ–æ•°æ®ï¼ˆå¤„ç†å­—ç¬¦ä¸²å½¢å¼çš„ç”µè¯å·ç ï¼‰å»ºç«‹ç›¸ä¼¼ç»“æ„åŒ–æ•°æ®ä¹‹é—´çš„ç¡®å®šå…³è”ï¼›</p>
</blockquote>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠ email çš„ç‚¹æ‹†æˆå‰ç¼€ email_handle ä¸åç¼€ email_domainï¼Œè‡ªç„¶åœ°ï¼Œä¼šäº§ç”Ÿè¿™æ ·çš„è¾¹ï¼š</p>
<ul>
<li>has_email_with_handle (user -&gt; email_handle)</li>
<li>has_email_with_domain (user -&gt; email_domain)</li>
<li>with_handle (email -&gt; email_handle)</li>
<li>with_domain (email -&gt; email_domain)</li>
</ul>
<p>ç„¶è€Œï¼Œå¯ä»¥æƒ³è§ email_domain æ˜¯ä¸€ä¸ªæ½œåœ¨çš„è¶…çº§èŠ‚ç‚¹ï¼Œå¹¶ä¸”ï¼Œå®ƒçš„åŒºåˆ†åº¦åœ¨å¾ˆå¤šæƒ…å†µä¸‹æ˜¯å¾ˆå°çš„ï¼Œæ¯”å¦‚ <code>gmail.com</code> è¿™ä¸ªå…¬å…±é‚®ç®±åç¼€æ²¡æœ‰å¾ˆå¤§çš„å…³è”æ€§æ„ä¹‰ã€‚æˆ‘ä»¬å¯ä»¥åªç•™ä¸‹ email.handle ä½œä¸ºç‚¹ï¼Œè€Œå¯¹äº email_domainï¼ŒæŠŠå®ƒç•™åœ¨è¾¹ä¸­ä½œä¸ºå±æ€§ï¼š</p>
<ul>
<li>has_email_with_handle (user -&gt; email_handle)
<ul>
<li>Prop:
<ul>
<li>email_domain</li>
</ul>
</li>
</ul>
</li>
<li>with_handle (email -&gt; email_handle)
<ul>
<li>Prop:
<ul>
<li>email_domain</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>å¯¹åº”çš„æ–°çš„ç‚¹ç±»å‹ã€è¾¹ç±»å‹çš„ NebulaGraph DDL è¯­å¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="err">æ–°çš„ç‚¹ç±»å‹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">`</span><span class="n">email_handle</span><span class="o">`</span><span class="w"> </span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="err">æ–°çš„è¾¹ç±»å‹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">has_email_with_handle</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">email_domain</span><span class="o">`</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">with_handle</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">email_domain</span><span class="o">`</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹åº”æ–°çš„ç‚¹ã€è¾¹çš„ DML è¯­å¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="n">VERTEX</span><span class="w"> </span><span class="o">`</span><span class="n">email_handle</span><span class="o">`</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;4kelly&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Ann&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;brettglenn&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;franklin.b&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;heathermoore&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;holly&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Jennifer.f&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Jessica&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Jessica_Torres&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;julia.h.24&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Philip66&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;ReginaldTheMan&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Sandra311&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Sharon91&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;steven&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;steven.web&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;veronica.j&#34;</span><span class="p">:();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">has_email_with_handle</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">email_domain</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_1&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;heathermoore&#34;</span><span class="p">:(</span><span class="s2">&#34;johnson.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_2&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;holly&#34;</span><span class="p">:(</span><span class="s2">&#34;welch.org&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_3&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;julia.h.24&#34;</span><span class="p">:(</span><span class="s2">&#34;gmail.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_4&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;franklin.b&#34;</span><span class="p">:(</span><span class="s2">&#34;gibson.biz&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_5&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;4kelly&#34;</span><span class="p">:(</span><span class="s2">&#34;yahoo.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_6&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;steven.web&#34;</span><span class="p">:(</span><span class="s2">&#34;johnson.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_7&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Jessica_Torres&#34;</span><span class="p">:(</span><span class="s2">&#34;morris.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_8&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;brettglenn&#34;</span><span class="p">:(</span><span class="s2">&#34;gmail.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_9&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;veronica.j&#34;</span><span class="p">:(</span><span class="s2">&#34;yahoo.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_10&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;steven&#34;</span><span class="p">:(</span><span class="s2">&#34;phelps-craig.info&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_11&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;ReginaldTheMan&#34;</span><span class="p">:(</span><span class="s2">&#34;hotmail.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_12&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Jennifer.f&#34;</span><span class="p">:(</span><span class="s2">&#34;carroll-acosta.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_13&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Philip66&#34;</span><span class="p">:(</span><span class="s2">&#34;yahoo.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_14&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Ann&#34;</span><span class="p">:(</span><span class="s2">&#34;hernandez.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_15&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Jessica&#34;</span><span class="p">:(</span><span class="s2">&#34;turner.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_16&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Sandra311&#34;</span><span class="p">:(</span><span class="s2">&#34;hotmail.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_17&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Sharon91&#34;</span><span class="p">:(</span><span class="s2">&#34;gmail.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_18&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Sharon91&#34;</span><span class="p">:(</span><span class="s2">&#34;gmail.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_19&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;brettglenn&#34;</span><span class="p">:(</span><span class="s2">&#34;googlemail.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_20&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;julia.h.24&#34;</span><span class="p">:(</span><span class="s2">&#34;yahoo.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_21&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;holly&#34;</span><span class="p">:(</span><span class="s2">&#34;welch.org&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_22&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;veronica.j&#34;</span><span class="p">:(</span><span class="s2">&#34;yahoo.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_23&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;4kelly&#34;</span><span class="p">:(</span><span class="s2">&#34;hotmail.com&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">with_handle</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">email_domain</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;heathermoore@johnson.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;heathermoore&#34;</span><span class="p">:(</span><span class="s2">&#34;johnson.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;holly@welch.org&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;holly&#34;</span><span class="p">:(</span><span class="s2">&#34;welch.org&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;julia.h.24@gmail.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;julia.h.24&#34;</span><span class="p">:(</span><span class="s2">&#34;gmail.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;franklin.b@gibson.biz&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;franklin.b&#34;</span><span class="p">:(</span><span class="s2">&#34;gibson.biz&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;4kelly@yahoo.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;4kelly&#34;</span><span class="p">:(</span><span class="s2">&#34;yahoo.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;steven.web@johnson.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;steven.web&#34;</span><span class="p">:(</span><span class="s2">&#34;johnson.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Jessica_Torres@morris.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Jessica_Torres&#34;</span><span class="p">:(</span><span class="s2">&#34;morris.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;brettglenn@gmail.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;brettglenn&#34;</span><span class="p">:(</span><span class="s2">&#34;gmail.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;veronica.j@yahoo.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;veronica.j&#34;</span><span class="p">:(</span><span class="s2">&#34;yahoo.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;steven@phelps-craig.info&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;steven&#34;</span><span class="p">:(</span><span class="s2">&#34;phelps-craig.info&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;ReginaldTheMan@hotmail.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;ReginaldTheMan&#34;</span><span class="p">:(</span><span class="s2">&#34;hotmail.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Jennifer.f@carroll-acosta.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Jennifer.f&#34;</span><span class="p">:(</span><span class="s2">&#34;carroll-acosta.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Philip66@yahoo.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Philip66&#34;</span><span class="p">:(</span><span class="s2">&#34;yahoo.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Ann@hernandez.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Ann&#34;</span><span class="p">:(</span><span class="s2">&#34;hernandez.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Jessica@turner.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Jessica&#34;</span><span class="p">:(</span><span class="s2">&#34;turner.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Sandra311@hotmail.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Sandra311&#34;</span><span class="p">:(</span><span class="s2">&#34;hotmail.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Sharon91@gmail.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Sharon91&#34;</span><span class="p">:(</span><span class="s2">&#34;gmail.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;Sharon91+001@gmail.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;Sharon91&#34;</span><span class="p">:(</span><span class="s2">&#34;gmail.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;brettglenn@googlemail.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;brettglenn&#34;</span><span class="p">:(</span><span class="s2">&#34;googlemail.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;julia.h.24@yahoo.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;julia.h.24&#34;</span><span class="p">:(</span><span class="s2">&#34;yahoo.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;holly@welch.org&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;holly&#34;</span><span class="p">:(</span><span class="s2">&#34;welch.org&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;veronica.j@yahoo.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;veronica.j&#34;</span><span class="p">:(</span><span class="s2">&#34;yahoo.com&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;4kelly@hotmail.com&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;4kelly&#34;</span><span class="p">:(</span><span class="s2">&#34;hotmail.com&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ï¼Œç»è¿‡è¿™ä¸ªå¤„ç†ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°æ›´å¤šå…³è”çš„ç”¨æˆ·äº†ï¼Œå®ƒå¯ä»¥ç”¨è¿™ä¸ªå›¾æŸ¥è¯¢è¡¨è¾¾ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="p">(:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_email_with_handle</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">email_handle</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">has_email_with_handle</span><span class="p">]</span><span class="o">-</span><span class="p">(:</span><span class="k">user</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/186620749-d3ff1059-e6c6-4263-aa82-9fa72a6478ee.png" title="https://user-images.githubusercontent.com/1651790/186620749-d3ff1059-e6c6-4263-aa82-9fa72a6478ee.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/186620749-d3ff1059-e6c6-4263-aa82-9fa72a6478ee.png">
        
    </a></p>
<p><strong>2. éç¡®å®šæ€§ç›¸ä¼¼æ€§</strong></p>
<blockquote>
<p>åœ¨æœ‰é™å­˜åœ¨ç¡®å®šæ€§å…³è”çš„ç‚¹ä¹‹é—´ï¼ˆé¿å…ä¸¤ä¸¤ç©·ä¸¾ï¼‰ï¼Œè¿ç®—å…¶ä»–é‡åŒ–ã€éç¡®å®šç›¸ä¼¼æ€§ï¼ˆå­—ç¬¦è·ç¦»ã€åœ°ç†è·ç¦»ç­‰ã€å›¾ç‰‡æ–‡ä»¶ç›¸ä¼¼åº¦ï¼‰ï¼›</p>
</blockquote>
<p>è¿™é‡Œç”¨åœ°å€çš„åœ°ç†è·ç¦»æ¥åšä¸ºä¾‹å­ï¼Œæˆ‘ä»¬é¢„å…ˆå¤„ç†æ¯ä¸€ä¸ªåœ°å€ï¼Œå°†å®ƒä»¬çš„ç»çº¬åº¦å¯¼å…¥å›¾è°±ã€‚</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬æ›´æ”¹åœ°å€è¿™ä¸ªç‚¹çš„ç±»å‹ <code>address</code> çš„ schemaï¼š</p>
<ul>
<li>address
<ul>
<li>Prop: geo_pointï¼ˆ<code>geography(point)</code> ç»çº¬åº¦ç±»å‹ï¼‰</li>
</ul>
</li>
</ul>
<p>å¯¹åº”è¿‡æ¥ï¼Œå®ƒçš„ DDL å˜åŒ–æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gd">-CREATE TAG `address` ()
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+CREATE TAG `address`(`geo_point` geography(point));
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å·²ç»å»ºç«‹äº†åˆå§‹çš„ <code>address</code> TAG ä¹‹ä¸Šï¼Œå¯ä»¥ç”¨ <code>ALTER TAG</code> çš„ DDL å»ä¿®æ”¹ <code>address</code> çš„å®šä¹‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">ALTER</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">`</span><span class="n">address</span><span class="o">`</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">geo_point</span><span class="o">`</span><span class="w"> </span><span class="n">geography</span><span class="p">(</span><span class="n">point</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å¯ä»¥ç”¨ <code>SHOW CREATE TAG</code> æŸ¥çœ‹ä¿®æ”¹ä¹‹åçš„ Schema</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="n">entity_resolution</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">`</span><span class="n">address</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">Tag</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">Create</span><span class="w"> </span><span class="n">Tag</span><span class="w">                         </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;address&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;CREATE TAG `address` (            |
</span></span></span><span class="line"><span class="cl"><span class="s2">|           |  `address` string NOT NULL,        |
</span></span></span><span class="line"><span class="cl"><span class="s2">|           |  `geo_point` geography(point) NULL |
</span></span></span><span class="line"><span class="cl"><span class="s2">|           | ) ttl_duration = 0, ttl_col = &#34;&#34;&#34;</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+------------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<p>å¯¹åº”çš„ç‚¹ã€è¾¹çš„ DMLï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="err">æ’å…¥è¾¹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">has_address</span><span class="o">`</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_1&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_0&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_2&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_15&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_3&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_18&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_4&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_1&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_5&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_2&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_6&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_3&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_7&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_4&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_8&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_14&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_9&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_5&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_10&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_6&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_11&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_7&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_12&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_8&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_13&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_9&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_14&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_10&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_15&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_11&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_16&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_12&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_17&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_13&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_18&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_13&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_19&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_14&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_20&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_18&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_21&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_15&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_22&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_16&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_23&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;addr_17&#34;</span><span class="p">:();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="err">æ’å…¥ç‚¹ï¼Œ</span><span class="n">geo_point</span><span class="w"> </span><span class="err">æ˜¯åœ°å€çš„ç»çº¬åº¦</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">VERTEX</span><span class="w"> </span><span class="o">`</span><span class="n">address</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">address</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">geo_point</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_0&#34;</span><span class="p">:(</span><span class="s2">&#34;Brittany Forge Apt. 718 East Eric  WV 97881&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_1&#34;</span><span class="p">:(</span><span class="s2">&#34;Richard Curve Kingstad  AZ 05660&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_2&#34;</span><span class="p">:(</span><span class="s2">&#34;Schmidt Key Lake Charles  AL 36174&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">13</span><span class="p">.</span><span class="mi">13</span><span class="p">,</span><span class="o">-</span><span class="mi">87</span><span class="p">.</span><span class="mi">65</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_3&#34;</span><span class="p">:(</span><span class="s2">&#34;5 Joanna Key Suite 704 Frankshire  OK 03035&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_4&#34;</span><span class="p">:(</span><span class="s2">&#34;1 Payne Circle Mitchellfort  LA 73053&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_5&#34;</span><span class="p">:(</span><span class="s2">&#34;2 Klein Mission New Annetteton  HI 05775&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_6&#34;</span><span class="p">:(</span><span class="s2">&#34;1 Vanessa Stravenue Suite 184 Baileyville  NY 46381&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_7&#34;</span><span class="p">:(</span><span class="s2">&#34;John Garden Port John  LA 54602&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_8&#34;</span><span class="p">:(</span><span class="s2">&#34;11 Webb Groves Tiffanyside  MN 14566&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_9&#34;</span><span class="p">:(</span><span class="s2">&#34;70 Robinson Locks Suite 113 East Veronica  ND 87845&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_10&#34;</span><span class="p">:(</span><span class="s2">&#34;24 Mcknight Port Apt. 028 Sarahborough  MD 38195&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_11&#34;</span><span class="p">:(</span><span class="s2">&#34;0337 Mason Corner Apt. 900 Toddmouth  FL 61464&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_12&#34;</span><span class="p">:(</span><span class="s2">&#34;7 Davis Station Apt. 691 Pittmanfort  HI 29746&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_13&#34;</span><span class="p">:(</span><span class="s2">&#34;1 Southport Street Apt. 098 Westport  KY 85907&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">120</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="mi">30</span><span class="p">.</span><span class="mi">16</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_14&#34;</span><span class="p">:(</span><span class="s2">&#34;Weber Unions Eddieland  MT 64619&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">26</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_15&#34;</span><span class="p">:(</span><span class="s2">&#34;1 Amanda Freeway Lisaland  NJ 94933&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">28</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_16&#34;</span><span class="p">:(</span><span class="s2">&#34;2 Klein HI 05775&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_17&#34;</span><span class="p">:(</span><span class="s2">&#34;Schmidt Key Lake Charles AL 13617&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">13</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">87</span><span class="p">.</span><span class="mi">60</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;addr_18&#34;</span><span class="p">:(</span><span class="s2">&#34;Rodriguez Track East Connorfort  NC 63144&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span><span class="mi">30</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº†ç»çº¬åº¦ä¿¡æ¯ï¼Œç»“åˆ NebulaGraph åŸç”Ÿå¯¹äº Geo Spatial ç©ºé—´åœ°ç†å±æ€§çš„å¤„ç†èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾è·å¾—ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»ï¼ˆå•ä½ï¼šç±³ï¼‰</p>
<p>å¦‚ä¸‹ï¼Œ<code>ST_Distance(ST_Point(13.13, -87.65),ST_Point(13.12, -87.60))</code> è¡¨ç¤ºä¸¤ä¸ªåœ°çƒä¸Šçš„ç‚¹ <code>ST_Point(13.13, -87.65)</code> å’Œ <code>ST_Point(13.12, -87.60))</code> ä¹‹é—´çš„è·ç¦»æ˜¯ <code>5559.9459840993895</code> ç±³ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">RETURN</span><span class="w"> </span><span class="n">ST_Distance</span><span class="p">(</span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">13</span><span class="p">.</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">87</span><span class="p">.</span><span class="mi">65</span><span class="p">),</span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">13</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">87</span><span class="p">.</span><span class="mi">60</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">--------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">distance</span><span class="w">           </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">--------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">5559</span><span class="p">.</span><span class="mi">9459840993895</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">--------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æŸ¥è¯¢è¯­å¥æ¥è¡¨è¾¾â€æ‰€æœ‰æ‹¥æœ‰ç›¸åŒé‚®ç®±å‰ç¼€ç”¨æˆ·ä¹‹é—´çš„è·ç¦»â€œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_start</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_email_with_handle</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">email_handle</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">has_email_with_handle</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">v_end</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_start</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_address</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">a_start</span><span class="p">:</span><span class="n">address</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_end</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_address</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">a_end</span><span class="p">:</span><span class="n">address</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">v_start</span><span class="p">,</span><span class="w"> </span><span class="n">v_end</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Distance</span><span class="p">(</span><span class="n">a_start</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">geo_point</span><span class="p">,</span><span class="w"> </span><span class="n">a_end</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">geo_point</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="n">a_start</span><span class="p">,</span><span class="w"> </span><span class="n">a_end</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œï¼Œä¸ºäº†å±•ç°å‡ºé’ˆå¯¹ â€éç¡®å®šæ€§â€œ æ¡ä»¶ä¹‹é—´çš„ â€ç›¸ä¼¼æ€§â€ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåœ°å€ä¸­å­—ç¬¦ä¸²å®Œå…¨ç›¸åŒçš„ç»“æœè¿‡æ»¤æ‰ï¼Œ<code>WHERE a_start.address.address != a_end.address.address</code>ï¼Œå¦‚æ­¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_start</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_email_with_handle</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">email_handle</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">has_email_with_handle</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">v_end</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_start</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_address</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">a_start</span><span class="p">:</span><span class="n">address</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_end</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_address</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">a_end</span><span class="p">:</span><span class="n">address</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">a_start</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">address</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">a_end</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">address</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">v_start</span><span class="p">.</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">v_end</span><span class="p">.</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Distance</span><span class="p">(</span><span class="n">a_start</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">geo_point</span><span class="p">,</span><span class="w"> </span><span class="n">a_end</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">geo_point</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="n">a_start</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">a_end</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">address</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒçš„ç»“æœæ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">+</span><span class="c1">-------------------+-------------------+--------------------+--------------------------------------------+--------------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">v_start</span><span class="p">.</span><span class="k">user</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">v_end</span><span class="p">.</span><span class="k">user</span><span class="p">.</span><span class="n">name</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">distance</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">a_start</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">address</span><span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="n">a_end</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">address</span><span class="w">                      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-------------------+-------------------+--------------------+--------------------------------------------+--------------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;April Kelly&#34;</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Kelly April&#34;</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">5559</span><span class="p">.</span><span class="mi">9459840993895</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Schmidt Key Lake Charles  AL 36174&#34;</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Schmidt Key Lake Charles AL 13617&#34;</span><span class="w">        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Veronica Jordan&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Veronica Jordan&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;2 Klein Mission New Annetteton  HI 05775&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;2 Klein HI 05775&#34;</span><span class="w">                         </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Kelly April&#34;</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;April Kelly&#34;</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">5559</span><span class="p">.</span><span class="mi">9459840993895</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Schmidt Key Lake Charles AL 13617&#34;</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Schmidt Key Lake Charles  AL 36174&#34;</span><span class="w">       </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Veronica Jordan&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;Veronica Jordan&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;2 Klein HI 05775&#34;</span><span class="w">                         </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;2 Klein Mission New Annetteton  HI 05775&#34;</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-------------------+-------------------+--------------------+--------------------------------------------+--------------------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹å‡ºï¼š</p>
<ul>
<li><code>user_5</code> ä¸ <code>user_23</code> ä¹‹é—´çš„åœ°å€è·ç¦»åªç›¸å·® 5559 ç±³ï¼Œå› ä¸ºä»–ä»¬çš„åœ°å€å°±åœ¨ä¸€ä¸ªè¡—åŒº</li>
<li>è€Œ <code>user_9</code> ä¸ <code>user_13</code> ä¹‹é—´è·ç¦»ç›¸å·® 0 ç±³ï¼Œå› ä¸ºå®ƒä»¬ï¼ˆ&ldquo;2 Klein Mission New Annetteton  HI 05775&rdquo; ä¸ &ldquo;2 Klein HI 05775&rdquo;ï¼‰å®é™…ä¸Šæ˜¯å®Œå…¨ç›¸åŒçš„åœ°å€ã€‚</li>
</ul>
<p>è¿™å°±æ˜¯åˆ©ç”¨å±æ€§çš„å…·ä½“å«ä¹‰ï¼ˆdomain knowledgeï¼‰è®¡ç®—çš„å®è´¨è·ç¦»çš„ä¸€ä¸ªæœ€å¥½çš„è¯ é‡Šï¼Œå¤§å®¶å¯ä»¥å€ŸåŠ©äºå›¾æ•°æ®åº“ä¸­æŸ¥è¯¢è¯­å¥æè¿°èƒ½åŠ›æˆ–è€…åˆ©ç”¨å…¶ä»–ç³»ç»Ÿå»è¿ç®—ç”¨æˆ·é—´éç¡®å®šæ€§ç‰¹å¾çš„é‡åŒ–è·ç¦»/ç›¸ä¼¼åº¦ã€‚</p>
<p><strong>3. åŠ æƒè¯„åˆ†</strong></p>
<blockquote>
<p>ä¸ºä¸åŒå…³ç³»èµ‹äºˆåŠ æƒï¼Œè®¡ç®—ç›¸ä¼¼åº¦æ€»åˆ†ï¼›</p>
</blockquote>
<p>ä¸‹è¾¹æ˜¯ä¸€ä¸ªåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥ç»¼åˆè€ƒé‡çš„å¤šç§å…³è”å…³ç³»ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
<p>ç¡®å®šæ€§å…³ç³»</p>
<ul>
<li>åŒåï¼ˆç²¾ç¡®åŒ¹é…ï¼‰</li>
<li>ç›¸åŒç”µè¯ï¼ˆæ ¼å¼åŒ–å¤„ç†ï¼‰</li>
<li>ä½¿ç”¨è¿‡ç›¸åŒè®¾å¤‡ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰</li>
<li>åŒé‚®ä»¶å‰ç¼€ï¼ˆç²¾ç»†åŒ–å¤„ç†ï¼‰</li>
</ul>
<p>éç¡®å®šæ€§</p>
<ul>
<li>åœ°å€è·ç¦»ï¼ˆå¤„ç†æˆç»çº¬åº¦ï¼Œè®¡ç®—åœ°çƒçƒé¢è·ç¦»ï¼‰</li>
<li>å¤´åƒå›¾ç‰‡èƒŒæ™¯ç›¸ä¼¼åº¦ï¼ˆè®­ç»ƒæ¨¡å‹è®¡ç®—å›¾åƒè·ç¦»ï¼‰</li>
</ul>
<p>ä¸€ä¸ªå¾ˆç›´è§‰çš„æ–¹æ³•å°±æ˜¯å°†å¤šç§æ¡ä»¶æŒ‰ç…§ä¸åŒçš„æƒé‡åŠ æƒï¼Œè·å¾—ä¸¤ç‚¹é—´çš„æ€»â€œç–‘ä¼¼ç›¸åŒè´¦å·â€çš„è¯„åˆ†ã€‚</p>
<p>æœ¬ä¾‹ä¸­ï¼Œä¸ºæ±‚ç®€æ´ï¼Œæˆ‘ä»¬åªç»™å‡ºè€ƒè™‘â€œåŒé‚®ä»¶å‰ç¼€â€ã€â€œåŒåâ€ä¸â€œåœ°ç†è·ç¦»å°äº 10KMâ€çš„ç»¼åˆåŠ æƒï¼Œå¹¶ä¸”è®¤ä¸ºä¸¤ä¸ªå› ç´ çš„æƒé‡éƒ½æ˜¯ 1ã€‚</p>
<blockquote>
<p>æ³¨ï¼Œä¸ºäº†é˜²æ­¢ä¸¤ä¸¤å…¨åŒ¹é…ï¼Œæˆ‘ä»¬ä»ç›¸åŒé‚®ä»¶å‰ç¼€æ¡ä»¶ä½œä¸ºåˆå§‹åŒ¹é…æ¡ä»¶ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_start</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_email_with_handle</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">email_handle</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">has_email_with_handle</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">v_end</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_start</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_address</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">a_start</span><span class="p">:</span><span class="n">address</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_end</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_address</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">a_end</span><span class="p">:</span><span class="n">address</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">v_start</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">v_end</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">v_start</span><span class="p">.</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s_name</span><span class="p">,</span><span class="w"> </span><span class="n">v_end</span><span class="p">.</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e_name</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Distance</span><span class="p">(</span><span class="n">a_start</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">geo_point</span><span class="p">,</span><span class="w"> </span><span class="n">a_end</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">geo_point</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">distance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">shared_email_handle</span><span class="p">,</span><span class="w"> </span><span class="n">s_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">e_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">shared_name</span><span class="p">,</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">shared_location</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœæ˜¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">+</span><span class="c1">-----------+-----------+---------------------+-------------+-----------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">e</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">shared_email_handle</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">shared_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">shared_location</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+-----------+---------------------+-------------+-----------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_5&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_23&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="k">false</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_9&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_22&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_21&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_2&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="k">false</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_2&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_21&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="k">false</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_22&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_9&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_20&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_3&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="k">false</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_3&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_20&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="k">false</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_18&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_17&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="k">false</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_17&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_18&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="k">false</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_19&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_8&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="k">false</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_8&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_19&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="k">false</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_23&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_5&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="k">false</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+-----------+---------------------+-------------+-----------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬è®¡ç®—åŠ æƒåˆ†æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_start</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_email_with_handle</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">email_handle</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">has_email_with_handle</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">v_end</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_start</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_address</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">a_start</span><span class="p">:</span><span class="n">address</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_end</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_address</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">a_end</span><span class="p">:</span><span class="n">address</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">v_start</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">v_end</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">v_start</span><span class="p">.</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s_name</span><span class="p">,</span><span class="w"> </span><span class="n">v_end</span><span class="p">.</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e_name</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Distance</span><span class="p">(</span><span class="n">a_start</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">geo_point</span><span class="p">,</span><span class="w"> </span><span class="n">a_end</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">geo_point</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">distance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">shared_email_handle</span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">s_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">e_name</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">shared_name</span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">shared_location</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">shared_email_handle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">shared_name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">shared_location</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœæ˜¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">+</span><span class="c1">-----------+-----------+-------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">e</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+-----------+-------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_9&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_22&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_22&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_9&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_5&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_23&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_21&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_2&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_2&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_21&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_20&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_3&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_3&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_20&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_18&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_17&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_17&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_18&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_19&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_8&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_8&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_19&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_23&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_5&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+-----------+-------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="åˆ©ç”¨-active-learning-çš„æ–¹æ³•äº¤äº’å¼å­¦ä¹ è¯„åˆ†æƒé‡" class="headerLink">
    <a href="#%e5%88%a9%e7%94%a8-active-learning-%e7%9a%84%e6%96%b9%e6%b3%95%e4%ba%a4%e4%ba%92%e5%bc%8f%e5%ad%a6%e4%b9%a0%e8%af%84%e5%88%86%e6%9d%83%e9%87%8d" class="header-mark"></a>1.3.2 åˆ©ç”¨ Active Learning çš„æ–¹æ³•äº¤äº’å¼å­¦ä¹ è¯„åˆ†æƒé‡</h4><p>å®é™…åº”ç”¨ä¸­ï¼Œä¸åŒå› ç´ çš„åŠ æƒå…³ç³»ä¹Ÿä¸æ˜¯é‚£ä¹ˆå®¹æ˜“è½»æ˜“ç»™å‡ºçš„ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æœ‰é™çš„äººåŠ›åˆ¤æ–­è¿›è¡Œ Active Learning çš„äº¤äº’è®­ç»ƒæ¥ä¹ å¾—æƒé‡ã€‚</p>
<p>TBD</p>
<h3 id="åˆ©ç”¨æ–°çš„è¾¹è¿æ¥ä¸åŒæ–¹æ³•" class="headerLink">
    <a href="#%e5%88%a9%e7%94%a8%e6%96%b0%e7%9a%84%e8%be%b9%e8%bf%9e%e6%8e%a5%e4%b8%8d%e5%90%8c%e6%96%b9%e6%b3%95" class="header-mark"></a>1.4 åˆ©ç”¨æ–°çš„è¾¹è¿æ¥ä¸åŒæ–¹æ³•</h3><p>è¿›ä¸€æ­¥ï¼Œå¯¹äºè¿™äº›ç¡®å®šï¼ˆæ˜¯å¦äºŒå…ƒçš„ï¼‰æˆ–éç¡®å®šï¼ˆé‡åŒ–çš„ï¼‰å…³ç³»ï¼Œåˆ©ç”¨å›¾åº“ä¸å¤–éƒ¨ç³»ç»Ÿè·å¾—äº†å…³è”å…³ç³»ä¹‹åï¼Œå¸¸å¸¸å¯ä»¥ç›´æ¥æŠŠå®ƒä»¬å®šä¹‰ä¸ºå›¾è°±ä¸­ç›´è¿çš„è¾¹ï¼Œå†™å›å›¾åº“ï¼Œæä¾›ç»™å…¶ä»–ç®—æ³•ã€ç³»ç»Ÿä½œä¸ºè¾“å…¥ï¼Œåšè¿›ä¸€æ­¥è¿­ä»£ã€è®¡ç®—ã€‚</p>
<h4 id="åˆ›å»ºå•ç‹¬çš„ç›´è¿è¾¹" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%ba%e5%8d%95%e7%8b%ac%e7%9a%84%e7%9b%b4%e8%bf%9e%e8%be%b9" class="header-mark"></a>1.4.1 åˆ›å»ºå•ç‹¬çš„ç›´è¿è¾¹</h4><p>å‡è®¾ä¹‹å‰å¯¹é‚®ä»¶ã€åœ°å€ã€å§“åçš„å¤„ç†ä¹‹åï¼ŒæŠŠç»“æœä½œä¸ºç”¨æˆ·å®ä½“ä¹‹å‰çš„ç›´è¿è¾¹æ’å…¥å›¾è°±ï¼Œè¿™äº›ç§è¾¹å«åšï¼š</p>
<ul>
<li>shared_similar_email</li>
<li>shared_similar_location</li>
<li>shared_name</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="n">DDL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">shared_similar_email</span><span class="o">`</span><span class="w"> </span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">shared_similar_location</span><span class="o">`</span><span class="w"> </span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">shared_name</span><span class="o">`</span><span class="w"> </span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="n">DML</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">shared_similar_email</span><span class="o">`</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_5&#34;</span><span class="w"> </span><span class="o">-&gt;</span><span class="s2">&#34;user_23&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_9&#34;</span><span class="w"> </span><span class="o">-&gt;</span><span class="s2">&#34;user_22&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_21&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_2&#34;</span><span class="w"> </span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_2&#34;</span><span class="w"> </span><span class="o">-&gt;</span><span class="s2">&#34;user_21&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_22&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_9&#34;</span><span class="w"> </span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_20&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_3&#34;</span><span class="w"> </span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_3&#34;</span><span class="w"> </span><span class="o">-&gt;</span><span class="s2">&#34;user_20&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_18&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_17&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_17&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_18&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_19&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_8&#34;</span><span class="w"> </span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_8&#34;</span><span class="w"> </span><span class="o">-&gt;</span><span class="s2">&#34;user_19&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_23&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_5&#34;</span><span class="w"> </span><span class="p">:();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">shared_name</span><span class="o">`</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_9&#34;</span><span class="w"> </span><span class="o">-&gt;</span><span class="s2">&#34;user_22&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_22&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_9&#34;</span><span class="w"> </span><span class="p">:();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">shared_similar_location</span><span class="o">`</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_5&#34;</span><span class="w"> </span><span class="o">-&gt;</span><span class="s2">&#34;user_23&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_9&#34;</span><span class="w"> </span><span class="o">-&gt;</span><span class="s2">&#34;user_22&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_21&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_2&#34;</span><span class="w"> </span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_2&#34;</span><span class="w"> </span><span class="o">-&gt;</span><span class="s2">&#34;user_21&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_22&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_9&#34;</span><span class="w"> </span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_20&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_3&#34;</span><span class="w"> </span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_3&#34;</span><span class="w"> </span><span class="o">-&gt;</span><span class="s2">&#34;user_20&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_18&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_17&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_17&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_18&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_19&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_8&#34;</span><span class="w"> </span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_8&#34;</span><span class="w"> </span><span class="o">-&gt;</span><span class="s2">&#34;user_19&#34;</span><span class="p">:(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_23&#34;</span><span class="o">-&gt;</span><span class="s2">&#34;user_5&#34;</span><span class="w"> </span><span class="p">:();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="åˆ›å»ºå¤åˆè¯„åˆ†ä¹‹åçš„è¾¹" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%ba%e5%a4%8d%e5%90%88%e8%af%84%e5%88%86%e4%b9%8b%e5%90%8e%e7%9a%84%e8%be%b9" class="header-mark"></a>1.4.2 åˆ›å»ºå¤åˆè¯„åˆ†ä¹‹åçš„è¾¹</h4><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æŸ¥è¯¢ç»¼åˆåˆ†æ•°å¤§äº 2 çš„ç‚¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_start</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_email_with_handle</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">email_handle</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">has_email_with_handle</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">v_end</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_start</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_address</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">a_start</span><span class="p">:</span><span class="n">address</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_end</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">has_address</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">a_end</span><span class="p">:</span><span class="n">address</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">v_start</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">v_end</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">v_start</span><span class="p">.</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s_name</span><span class="p">,</span><span class="w"> </span><span class="n">v_end</span><span class="p">.</span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e_name</span><span class="p">,</span><span class="w"> </span><span class="n">ST_Distance</span><span class="p">(</span><span class="n">a_start</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">geo_point</span><span class="p">,</span><span class="w"> </span><span class="n">a_end</span><span class="p">.</span><span class="n">address</span><span class="p">.</span><span class="n">geo_point</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">distance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">shared_email_handle</span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">s_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">e_name</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">shared_name</span><span class="p">,</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">shared_location</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">shared_email_handle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">shared_name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">shared_location</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæ ¹æ®è¿”å›ç»“æœå»ºç«‹æ–°çš„è¾¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="n">DDL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">is_similar_to</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="n">score</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="n">DML</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="n">EDGE</span><span class="w"> </span><span class="o">`</span><span class="n">is_similar_to</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">score</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_22&#34;</span><span class="w"> </span><span class="o">-&gt;</span><span class="s2">&#34;user_9&#34;</span><span class="p">:(</span><span class="mi">3</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;user_9&#34;</span><span class="w"> </span><span class="o">-&gt;</span><span class="s2">&#34;user_22&#34;</span><span class="p">:(</span><span class="mi">3</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åŸºäºå›¾ç®—æ³•çš„æ–¹æ³•" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%9b%be%e7%ae%97%e6%b3%95%e7%9a%84%e6%96%b9%e6%b3%95" class="header-mark"></a>1.5 åŸºäºå›¾ç®—æ³•çš„æ–¹æ³•</h3><p>å‰è¾¹çš„æ–¹æ³•ä¸­æˆ‘ä»¬ç›´æ¥åˆ©ç”¨äº†ç”¨æˆ·çš„å„é¡¹å±æ€§ã€è¡Œä¸ºäº‹ä»¶ä¸­äº§ç”Ÿçš„å…³ç³»ï¼Œå¹¶åˆ©ç”¨å„ç§å±æ€§ã€å€¼ç›¸ä¼¼åº¦çš„æ–¹æ³•å»ºç«‹äº†åŸºäºæ¦‚ç‡æˆ–è€…å¸¦æœ‰è¯„åˆ†çš„å…³è”å…³ç³»ã€‚è€Œåœ¨é€šè¿‡å…¶ä»–æ–¹æ³•å¢åŠ äº†æ–°çš„è¾¹ä¹‹åçš„å›¾ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨å›¾ç®—æ³•çš„æ–¹æ³•æ¥æ˜ å°„æ½œåœ¨çš„ç›¸åŒç”¨æˆ· IDã€‚</p>
<h4 id="å›¾ç›¸ä¼¼æ€§ç®—æ³•" class="headerLink">
    <a href="#%e5%9b%be%e7%9b%b8%e4%bc%bc%e6%80%a7%e7%ae%97%e6%b3%95" class="header-mark"></a>1.5.1 å›¾ç›¸ä¼¼æ€§ç®—æ³•</h4><p>åˆ©ç”¨èŠ‚ç‚¹ç›¸ä¼¼æ€§å›¾ç®—æ³•ï¼Œæ¯”å¦‚ Jaccard Indexã€ä½™å¼¦ç›¸ä¼¼åº¦ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥æˆ–è€… a. åˆ©ç”¨å›¾åº“ä¹‹ä¸Šçš„å›¾è®¡ç®—å¹³å°å…¨é‡è®¡ç®—ç›¸ä¼¼åº¦ï¼Œæˆ–è€… b. ç”¨å›¾æŸ¥è¯¢è¯­å¥å®ç°å…¨å›¾/ç»™å®šçš„ç‚¹ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œæœ€åç»™ç›¸ä¼¼åº¦ä¸€å®šçš„é˜ˆå€¼æ¥å¸®åŠ©å»ºç«‹æ–°çš„ï¼ˆè€ƒè™‘äº†æ¶‰åŠè¾¹çš„ï¼‰æ˜ å°„å…³ç³»ã€‚</p>
<blockquote>
<p>æ³¨ï¼Œè¿™é‡Œçš„ Jaccard index å’Œæˆ‘ä»¬å‰è¾¹æåˆ°çš„æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„æ–¹æ³•æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡æˆ‘ä»¬ç°åœ¨æåŠçš„æ˜¯åº”ç”¨åœ¨å›¾ä¸Šçš„ç‚¹ä¹‹é—´å­˜åœ¨ç›¸è¿ç‚¹ä½œä¸ºç®—æ³•ä¸­çš„â€œäº¤é›†â€çš„å®ç°ã€‚</p>
</blockquote>
<h4 id="ç¤¾åŒºå‘ç°ç®—æ³•" class="headerLink">
    <a href="#%e7%a4%be%e5%8c%ba%e5%8f%91%e7%8e%b0%e7%ae%97%e6%b3%95" class="header-mark"></a>1.5.2 ç¤¾åŒºå‘ç°ç®—æ³•</h4><p>è‡ªç„¶åœ°ï¼Œè¿˜å¯ä»¥ç”¨ç¤¾åŒºå‘ç°çš„ç®—æ³•å…¨å›¾æ‰¾å‡ºç»™å®šçš„åŸºäºè¾¹ä¹‹ä¸‹çš„ç¤¾åŒºåˆ’åˆ†ï¼Œè°ƒè¯•ç®—æ³•ï¼Œä½¿å¾—ç›®æ ‡åˆ’åˆ†ç¤¾åŒºå†…éƒ¨ç‚¹ä¸ºä¼°è®¡çš„ç›¸åŒç”¨æˆ·ã€‚</p>
<h4 id="åŸºäºå›¾ç®—æ³•çš„æ–¹æ³•-1" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%9b%be%e7%ae%97%e6%b3%95%e7%9a%84%e6%96%b9%e6%b3%95-1" class="header-mark"></a>1.5.3 åŸºäºå›¾ç®—æ³•çš„æ–¹æ³•</h4><h5 id="åŸºäºå›¾æŸ¥è¯¢çš„-jaccard-å®ç°" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%9b%be%e6%9f%a5%e8%af%a2%e7%9a%84-jaccard-%e5%ae%9e%e7%8e%b0" class="header-mark"></a>1.5.3.1 åŸºäºå›¾æŸ¥è¯¢çš„ Jaccard å®ç°</h5><p><a href="https://en.wikipedia.org/wiki/Jaccard_index" target="_blank" rel="noopener noreferrer">Jaccard Index</a> æ˜¯ä¸€ä¸ªæè¿°ä¸¤ä¸ªé›†åˆè·ç¦»çš„å®šä¹‰å…¬å¼ï¼Œéå¸¸ç®€å•ã€ç¬¦åˆç›´è§‰ï¼Œå®ƒçš„å®šä¹‰ä¸ºï¼š
$$
J(A,B)= \frac {|A\cap B|}{|A\cup B|}
$$
è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠäº¤é›†ç†è§£ä¸º A ä¸ B å…±åŒè¿æ¥çš„ç‚¹ï¼ˆè®¾å¤‡ã€IPã€é‚®ç®±å‰ç¼€ã€åœ°å€ï¼‰ï¼Œè€Œå¹¶é›†ç†è§£ä¸ºè¿™å‡ ç§å…³ç³»ä¸‹ä¸ A æˆ–è€… B ç›´è¿çš„æ‰€æœ‰ç‚¹ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬ç”¨è¿™æ ·çš„ NebulaGraph OpenCypher æŸ¥è¯¢å°±å¯ä»¥ç®—å‡ºè‡³å°‘åŒ…å«ä¸€è·³å…³ç³»çš„ç‚¹å’Œå®ƒç›¸å…³çš„ç‚¹ã€ä»¥åŠ Jaccard Index å€¼ï¼Œè¶Šå¤§ä»£è¡¨å…³è”åº¦è¶Šå¤§ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_start</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">used_device</span><span class="o">|</span><span class="n">logged_in_from</span><span class="o">|</span><span class="n">has_email_with_handle</span><span class="o">|</span><span class="n">has_address</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">shared_components</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">used_device</span><span class="o">|</span><span class="n">logged_in_from</span><span class="o">|</span><span class="n">has_email_with_handle</span><span class="o">|</span><span class="n">has_address</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">v_end</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">v_start</span><span class="p">,</span><span class="w"> </span><span class="n">v_end</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">shared_components</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">intersection_size</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_start</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">used_device</span><span class="o">|</span><span class="n">logged_in_from</span><span class="o">|</span><span class="n">has_email_with_handle</span><span class="o">|</span><span class="n">has_address</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">shared_components</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">v_start</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">v_start</span><span class="p">,</span><span class="w"> </span><span class="n">v_end</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="n">COLLECT</span><span class="p">(</span><span class="n">id</span><span class="p">(</span><span class="n">shared_components</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">set_a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v_end</span><span class="p">:</span><span class="k">user</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">used_device</span><span class="o">|</span><span class="n">logged_in_from</span><span class="o">|</span><span class="n">has_email_with_handle</span><span class="o">|</span><span class="n">has_address</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">shared_components</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w">  </span><span class="n">v_start</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">v_end</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">v_end</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="n">set_a</span><span class="p">,</span><span class="w"> </span><span class="n">COLLECT</span><span class="p">(</span><span class="n">id</span><span class="p">(</span><span class="n">shared_components</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">set_b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">v_start</span><span class="p">,</span><span class="w"> </span><span class="n">v_end</span><span class="p">,</span><span class="w"> </span><span class="n">toFloat</span><span class="p">(</span><span class="n">intersection_size</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">intersection_size</span><span class="p">,</span><span class="w"> </span><span class="n">toSet</span><span class="p">(</span><span class="n">set_a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">set_b</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_U_B</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="n">v_start</span><span class="p">,</span><span class="w"> </span><span class="n">v_end</span><span class="p">,</span><span class="w"> </span><span class="n">intersection_size</span><span class="o">/</span><span class="k">size</span><span class="p">(</span><span class="n">A_U_B</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">jaccard_index</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">jaccard_index</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»“æœé‡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">+</span><span class="c1">-----------+-----------+---------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">v_start</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">v_end</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">jaccard_index</span><span class="w">       </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+-----------+---------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_8&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_19&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="w">                 </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_19&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_8&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="w">                 </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_20&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_3&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">6666666666666666</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_3&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_20&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">6666666666666666</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_21&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_2&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="w">                 </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_18&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_17&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="w">                 </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_17&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_18&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="w">                 </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_2&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_21&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="w">                 </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_22&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_9&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="w">                 </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_9&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_22&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="w">                 </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_23&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_5&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="w">                 </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_5&#34;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_23&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="w">                 </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_21&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_20&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">16666666666666666</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_20&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user_21&#34;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">16666666666666666</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+-----------+---------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>user_8 ä¸ user_19 çš„ç³»æ•°æ˜¯æœ€å¤§çš„çš„ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä»–ä»¬ä¹‹é—´çš„è¿æ¥ï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">FIND</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">PATH</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s2">&#34;user_8&#34;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s2">&#34;user_19&#34;</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">BIDIRECT</span><span class="w"> </span><span class="n">YIELD</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æœç„¶ï¼Œä»–ä»¬ä¹‹é—´çš„ç›¸ä¼¼åº¦å¾ˆå¤§ï¼š</p>
<p><a class="lightgallery" href="https://user-images.githubusercontent.com/1651790/187080900-48994824-811f-492b-a43c-e8d781331ffa.png" title="https://user-images.githubusercontent.com/1651790/187080900-48994824-811f-492b-a43c-e8d781331ffa.png" data-thumbnail="https://user-images.githubusercontent.com/1651790/187080900-48994824-811f-492b-a43c-e8d781331ffa.png">
        
    </a></p>
<h5 id="åŸºäº-nebulagraph-algorithm-å›¾è®¡ç®—å¹³å°çš„-jaccard-æ–¹æ³•" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e-nebulagraph-algorithm-%e5%9b%be%e8%ae%a1%e7%ae%97%e5%b9%b3%e5%8f%b0%e7%9a%84-jaccard-%e6%96%b9%e6%b3%95" class="header-mark"></a>1.5.3.2 åŸºäº NebulaGraph Algorithm å›¾è®¡ç®—å¹³å°çš„ Jaccard æ–¹æ³•</h5><h6 id="å‰é¢æ–¹æ³•çš„å±€é™" class="headerLink">
    <a href="#%e5%89%8d%e9%9d%a2%e6%96%b9%e6%b3%95%e7%9a%84%e5%b1%80%e9%99%90" class="header-mark"></a>1.5.3.2.1 å‰é¢æ–¹æ³•çš„å±€é™</h6><p>åˆ©ç”¨å›¾æ•°æ®åº“æŸ¥è¯¢è®¡ç®— Jaccard ç³»æ•°çš„æ–¹æ³•æœ‰ä¸¤æ–¹é¢å±€é™ã€‚</p>
<p>é¦–å…ˆï¼Œä¸ºäº†é˜²æ­¢ä¸¤ä¸¤è¿ç®—ï¼Œæˆ‘ä»¬å‡è®¾äº†æ‰€æœ‰å€¼å¾—è¢«è¿ç®—çš„ç‚¹ä¹‹é—´å·²ç»å­˜åœ¨æŸç§ç¡®å®šé“¾æ¥ï¼ˆå¯¹åº” MATCH ç¬¬ä¸€è¡Œï¼‰ï¼Œè™½ç„¶è¿™æ ·çš„å‡è®¾åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯å¯ä»¥ç²—ç•¥è¢«æ¥å—çš„ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ç§å‹ç¼©å’Œå¦¥åã€‚</p>
<p>å…¶æ¬¡ï¼Œåœ¨æ•°æ®é‡å¾ˆå¤§çš„æƒ…å½¢é‡Œï¼Œè¿™æ ·çš„æŸ¥è¯¢å°†ä¸å…·æœ‰å¯æ“ä½œæ€§ã€‚</p>
<h6 id="æ›´-scale-çš„æ–¹æ³•" class="headerLink">
    <a href="#%e6%9b%b4-scale-%e7%9a%84%e6%96%b9%e6%b3%95" class="header-mark"></a>1.5.3.2.2 æ›´ Scale çš„æ–¹æ³•</h6><p>ä¸ºäº†èƒ½å¤„ç†æ›´å¤§è§„æ¨¡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Spark ç­‰å¹¶è¡Œè®¡ç®—å¹³å°è¿›è¡Œç®—æ³•æ‰§è¡Œï¼›</p>
<p>åœ¨å…¨å›¾è¿ç®—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å±€éƒ¨æ•æ„Ÿå“ˆå¸Œ MinHash æ¥å¯¹ä¸¤ä¸¤æ¯”å¯¹é™ç»´ï¼Œåº†å¹¸çš„æ˜¯ï¼ŒSpark ä¸­æä¾›äº† MinHash çš„å®ç°ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼</p>
<blockquote>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://aksakalli.github.io/2016/03/01/jaccard-similarity-with-minhash.html" target="_blank" rel="noopener noreferrer">https://aksakalli.github.io/2016/03/01/jaccard-similarity-with-minhash.html</a></li>
<li><a href="https://en.wikipedia.org/wiki/MinHash" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/MinHash</a></li>
<li><a href="https://spark.apache.org/docs/3.1.1/api/python/reference/api/pyspark.ml.feature.MinHashLSH.html" target="_blank" rel="noopener noreferrer">https://spark.apache.org/docs/3.1.1/api/python/reference/api/pyspark.ml.feature.MinHashLSH.html</a></li>
<li><a href="https://github.com/apache/spark/blob/master/mllib/src/main/scala/org/apache/spark/ml/feature/LSH.scala" target="_blank" rel="noopener noreferrer">https://github.com/apache/spark/blob/master/mllib/src/main/scala/org/apache/spark/ml/feature/LSH.scala</a></li>
</ul>
</blockquote>
<blockquote>
<p>MinHash çš„æ€æƒ³ï¼š</p>
<p>è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¦‚ç‡å»æœ‰æŸä¼°è®¡ Jaccard ç³»æ•°ï¼Œè¿™é‡Œçš„é™ç»´ä½“ç°åœ¨å®ƒç”¨ bit map å»æ•°å­—åŒ–æ¯ä¸€ä¸ªé›†åˆï¼Œéšæœºå®šä¹‰ä¸åŒçš„é›†åˆä¸Šçš„ shuffleï¼ˆä¹±åºï¼‰å˜æ¢ï¼Œå–å˜æ¢ä¹‹å hash çš„æœ€å°å€¼ã€‚è¿™é‡Œï¼Œä¸¤ä¸ªé›†åˆçš„éšæœºå˜æ¢åæœ€å°å€¼ ç›¸ç­‰çš„æ¦‚ç‡æ˜¯ç­‰äº Jaccard ç³»æ•°çš„ã€‚æ‰€ä»¥ï¼Œè¿™æ ·å·æ¢æ¢æŸ±ï¼Œå°±æŠŠéœ€è¦ä¸¤ä¸¤é›†åˆè¿ç®—æ¯”è¾ƒçš„ç®—æ³•å˜æˆåªéœ€è¦å¯¹æ¯ä¸€ä¸ªé›†åˆåšå¸¸æ•°æ¬¡éšæœºå˜æ¢å–æœ€å°çš„é™ç»´è¿‘ä¼¼è¿ç®—äº†ã€‚</p>
</blockquote>
<p>åœ¨å›¾ä¸Šï¼Œå¯¹äºæ¯ä¸€ä¸ªç‚¹ï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒçš„é‚»å±…å°±æ˜¯è¿™ä¸ªç‚¹çš„é›†åˆï¼Œé‚£ä¹ˆåœ¨ Spark ä¸­è¿ç®— Jaccard ç³»æ•°çš„è¿‡ç¨‹å°±æ˜¯ï¼š</p>
<ol>
<li>è·å–æ¯ä¸€ä¸ªç‚¹çš„é‚»å±…é›†åˆ</li>
<li>å¯¹ç‚¹çš„é‚»å±…è¿›è¡Œ MinHash è¿ç®—ï¼Œè·å¾— Jaccard ç³»æ•°</li>
</ol>
<p>åº†å¹¸çš„æ˜¯ï¼Œå¼€æºçš„ NebulaGraph Algorithm å·²ç»æä¾›äº†è¿™ä¸ªç®—æ³•çš„å®ç°ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è®¿é—® <a href="https://github.com/vesoft-inc/nebula-algorithm/blob/master/nebula-algorithm/src/main/scala/com/vesoft/nebula/algorithm/lib/JaccardAlgo.scala" target="_blank" rel="noopener noreferrer">nebula-algorithm/src/main/scala/com/vesoft/nebula/algorithm/lib/JaccardAlgo.scala</a> äº†è§£å®ƒçš„å®ç°ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨ NebulaGraph Algorithm å°±å¯ä»¥äº†ï¼Œä½¿ç”¨æ–¹æ³•å‚è€ƒ NebulaGraph Algorithm æ–‡æ¡£ã€‚</p>
<blockquote>
<p>æ³¨ï¼Œ<a href="https://github.com/vesoft-inc/nebula-algorithm/blob/master/nebula-algorithm/src/main/resources/application.conf" target="_blank" rel="noopener noreferrer">é…ç½®</a>ä¸­ jaccard.tol çš„æ„æ¶µæ˜¯ <a href="https://github.com/apache/spark/blob/master/mllib/src/main/scala/org/apache/spark/ml/feature/LSH.scala" target="_blank" rel="noopener noreferrer">approxSimilarityJoin</a> ä¸­çš„ threshold ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">approxSimilarityJoin</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">datasetA</span><span class="k">:</span> <span class="kt">Dataset</span><span class="o">[</span><span class="k">_</span><span class="o">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">datasetB</span><span class="k">:</span> <span class="kt">Dataset</span><span class="o">[</span><span class="k">_</span><span class="o">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">threshold</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">distCol</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Dataset</span><span class="o">[</span><span class="k">_</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Filter the joined datasets where the distance are smaller than the threshold.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">joinedDatasetWithDist</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="n">distCol</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<p>è¯»è€…åˆ°è¿™é‡Œåº”è¯¥ä¼šæ³¨æ„åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¾ç„¶æ˜¯å‡è®¾æ‰€æœ‰çš„ç‚¹éƒ½æ˜¯ç”¨æˆ·å®ä½“ï¼Œè¾¹æ˜¯ä»–ä»¬ä¹‹é—´çš„ç›´è¿å…³ç³»çš„ã€‚æ‰€ä»¥å†åº”ç”¨è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºç»è¿‡é¢„å¤„ç†çš„ç›´è¿è¾¹ï¼Œè¿™ä¸ªæ­¥éª¤æ­£æ˜¯å‰è¾¹ç« èŠ‚â€œåˆ©ç”¨æ–°çš„è¾¹è¿æ¥ä¸åŒæ–¹æ³•â€ä¸­çš„å†…å®¹ã€‚</p>
<h5 id="åŸºäº-nebulagraph-algorithm-å›¾è®¡ç®—å¹³å°ç¤¾åŒºå‘ç°ç®—æ³•" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e-nebulagraph-algorithm-%e5%9b%be%e8%ae%a1%e7%ae%97%e5%b9%b3%e5%8f%b0%e7%a4%be%e5%8c%ba%e5%8f%91%e7%8e%b0%e7%ae%97%e6%b3%95" class="header-mark"></a>1.5.3.3 åŸºäº NebulaGraph Algorithm å›¾è®¡ç®—å¹³å°ç¤¾åŒºå‘ç°ç®—æ³•</h5><p>æåˆ°åŸºäºå…¨å›¾çš„ç®—æ³•ï¼Œæˆ‘ä»¬è‡ªç„¶å¯ä»¥æƒ³åˆ°å¯ä»¥åˆ©ç”¨ç¤¾åŒºå‘ç°çš„æ‰‹æ®µå»å¸®åŠ©è¯†åˆ«ç›¸åŒç”¨æˆ·çš„ä¸åŒè´¦å·ï¼Œå¼±è”é€šåˆ†é‡ï¼ˆWCCï¼‰ã€Louvain ç®—æ³•éƒ½æ˜¯å¸¸è§çš„æ‰‹æ®µã€‚</p>
<p>åŒæ ·ï¼ŒNebulaGraph Algorithm å¼€ç®±å³ç”¨åœ°æä¾›äº†è¿™ä¸¤ç§ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ¨ NebulaGraph å¾—å‡ºç¤¾åŒºåˆ’åˆ†ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šåšå¤åˆæ–¹æ³•çš„è¯†åˆ«ã€‚</p>
<h5 id="ä¸Šæ‰‹åŸºäº-nebulagraph-algorithm-å›¾è®¡ç®—æ–¹æ³•" class="headerLink">
    <a href="#%e4%b8%8a%e6%89%8b%e5%9f%ba%e4%ba%8e-nebulagraph-algorithm-%e5%9b%be%e8%ae%a1%e7%ae%97%e6%96%b9%e6%b3%95" class="header-mark"></a>1.5.3.4 ä¸Šæ‰‹åŸºäº NebulaGraph Algorithm å›¾è®¡ç®—æ–¹æ³•</h5><p>å› ä¸ºç¯‡å¹…å…³ç³»ï¼Œè¿™é‡Œä¸å±•ç¤º NebulaGraph Algorithm æ–¹æ³•çš„ä¸Šæ‰‹ç¯èŠ‚ï¼Œç±»ä¼¼äºåœ¨ä¹‹å‰ Fraud Detection æ–¹æ³•æ–‡ç« ä¸­çš„å¯¹åº”ç« èŠ‚ï¼Œä½ å¯ä»¥åˆ©ç”¨ Nebula-Up çš„ all-in-one æ¨¡å¼ï¼Œä¸€è¡Œå‘½ä»¤æ­å»ºè¿™æ ·çš„ç¯å¢ƒå¹¶äº²è‡ªä½“éªŒã€‚</p>
<blockquote>
<ul>
<li>Nebula-Up éƒ¨ç½²å‘½ä»¤ï¼š<code>curl -fsSL nebula-up.siwei.io/all-in-one.sh | bash -s -- v3 spark</code></li>
</ul>
</blockquote>
<h3 id="åŸºäºå›¾ç¥ç»ç½‘ç»œçš„æ–¹æ³•" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e%e5%9b%be%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c%e7%9a%84%e6%96%b9%e6%b3%95" class="header-mark"></a>1.6 åŸºäºå›¾ç¥ç»ç½‘ç»œçš„æ–¹æ³•</h3><p>æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œåœ¨è®²ä»¥ä¸Šä¸åŒçš„æ–¹æ³•ç›¸ç»“åˆçš„æ—¶å€™ï¼Œä¼šæŠŠå‰å¯¼æ–¹æ³•çš„ç»“æœä½œä¸ºå›¾ä¸Šçš„è¾¹ï¼Œè¿›è€Œä½œä¸ºåè¾¹çš„æ–¹æ³•çš„è¾“å…¥ï¼Œè€Œç›¸åŒç”¨æˆ· ID çš„è¯†åˆ«æœ¬è´¨ä¸Šå°±æ˜¯åœ¨å›¾ä¸Šå»é¢„æµ‹ç”¨æˆ·ä¹‹é—´é“¾æ¥ã€è¾¹ã€‚</p>
<p>åœ¨ GNN çš„æ–¹æ³•ä¸­ï¼Œé™¤äº†æˆ‘ä»¬åœ¨æ¬ºè¯ˆæ£€æµ‹ä¸­åˆ©ç”¨åˆ°çš„èŠ‚ç‚¹åˆ†ç±»ï¼ˆå±æ€§é¢„æµ‹ï¼‰ä¹‹å¤–ï¼Œé“¾æ¥é¢„æµ‹ï¼ˆLink Predictionï¼‰ä¹Ÿæ˜¯å¦ä¸€ä¸ªå¸¸è§çš„ç®—æ³•ç›®æ ‡å’Œåº”ç”¨åœºæ™¯ã€‚è‡ªç„¶åœ°ï¼Œå¯ä»¥æƒ³åˆ°ç”¨ GNN çš„æ–¹æ³•ç»“åˆ 1. é GNN æ–¹æ³•è·å¾—çš„ã€ 2. å·²ç»æœ‰çš„äººä¸ºæ ‡æ³¨çš„é“¾æ¥ï¼Œæ¥å­¦ä¹ ã€é¢„æµ‹å›¾ä¸Šçš„ ID æ˜ å°„ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒGNN çš„æ–¹æ³•åªèƒ½åˆ©ç”¨æ•°å­—å‹çš„ featureã€å±æ€§ï¼Œæˆ‘ä»¬æ²¡åŠæ³•æŠŠéæ•°å­—å‹çš„å±æ€§åƒåœ¨åˆ†ç±»æƒ…å†µé‡Œé‚£æ ·æšä¸¾ä¸ºæ•°å€¼ï¼Œç›¸åï¼Œæˆ‘ä»¬åœ¨çœŸæ­£çš„ GNN ä¹‹å‰ï¼Œå¯ä»¥ç”¨å…¶ä»–çš„å›¾æ–¹æ³•å»å»ºç«‹åŸºäºæ‰“åˆ†ã€æˆ–è€…ç›¸ä¼¼åº¦çš„è¾¹å»ºç«‹ã€‚è¿™æ—¶å€™ï¼Œè¿™äº›å‰è¾¹çš„æ–¹æ³•æˆä¸ºäº† GNN é“¾è·¯é¢„æµ‹çš„ç‰¹å¾å·¥ç¨‹ã€‚</p>
<h4 id="åŸºäº-gnn-çš„å®æ“" class="headerLink">
    <a href="#%e5%9f%ba%e4%ba%8e-gnn-%e7%9a%84%e5%ae%9e%e6%93%8d" class="header-mark"></a>1.6.1 åŸºäº GNN çš„å®æ“</h4><p>å’Œåœ¨ &ldquo;<a href="https://www.siwei.io/fraud-detection-with-nebulagraph/" target="_blank" rel="noopener noreferrer">åŸºäº NebulaGraph å›¾æ•°æ®åº“çš„æ¬ºè¯ˆæ£€æµ‹æ–¹æ³•ä¸ä»£ç ç¤ºä¾‹</a>&rdquo; çš„æ¬ºè¯ˆæ£€æµ‹ç±»ä¼¼ï¼Œæˆ‘å°†ç»™å‡ºçš„ä¾‹å­ä¹Ÿæ˜¯ GNN ç»“åˆå›¾æ•°æ®åº“åšå®æ—¶é¢„æµ‹çš„ä¾‹å­ã€‚</p>
<h5 id="hdeicdm2021httpsieeexploreieeeorgdocument9679130" class="headerLink">
    <a href="#hdeicdm2021httpsieeexploreieeeorgdocument9679130" class="header-mark"></a>1.6.1.1 <a href="https://ieeexplore.ieee.org/document/9679130" target="_blank" rel="noopener noreferrer">HDE[ICDM2021]</a></h5><p>æˆ‘ä»¬åˆ©ç”¨ <a href="http://www.shichuan.org/doc/116.pdf" target="_blank" rel="noopener noreferrer">Heterogeneous Graph Neural Network with Distance Encoding</a> ç»™å‡ºçš„æ–¹æ³•æ¥åš Inductive Learning çš„å¼‚æ„ GNN ä¸Šçš„é“¾è·¯é¢„æµ‹ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬å°†ç”¨ä¸€ä¸ªæ›´æ–¹ä¾¿çš„ GNN å·¥å…·ï¼Œ<a href="https://github.com/BUPT-GAMMA/OpenHGNN" target="_blank" rel="noopener noreferrer">OpenHGNN</a>ï¼Œæœ‰äº†å®ƒï¼Œæœ¬ä¾‹ä¸­çš„ä»£ç é‡ä¹Ÿä¼šå¤§å¤§ä¸‹é™ã€‚</p>
<blockquote>
<p>æ³¨ï¼šOpenHGNN æ˜¯ç”±åŒ—é‚® GAMMA Lab å¼€å‘çš„åŸºäº PyTorch å’Œ DGL çš„å¼€æºå¼‚è´¨å›¾ç¥ç»ç½‘ç»œå·¥å…·åŒ…ã€‚</p>
</blockquote>
<h5 id="æ•°æ®é›†" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e9%9b%86" class="header-mark"></a>1.6.1.2 æ•°æ®é›†</h5><p>æœ¬åˆ©çš„æ•°æ®é›†æ˜¯å‰è¾¹æ–¹æ³•ä¸­å»ºç«‹åœ¨ NebulaGraph ä¸­çš„å›¾è°±ï¼Œå€ŸåŠ©äº Nebula-DGLï¼Œæˆ‘ä»¬å¯ä»¥ä¸€è¡Œä»£ç æŠŠ NebulaGraph ä¸­çš„å›¾åŠ è½½åˆ° DGL ä¹‹ä¸­ã€‚</p>
<blockquote>
<p>æ³¨ï¼š</p>
<ol>
<li>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨çš„çš„å·¥å…·ä¸º Deep Graph libraryï¼ˆDGLï¼‰ï¼ŒNebulaGraph å›¾æ•°æ®åº“å’Œä»–ä»¬ä¹‹é—´çš„æ¡¥æ¢ï¼ŒNebula-DGLã€‚</p>
<ul>
<li>
<p>DGL: <a href="https://www.dgl.ai/" target="_blank" rel="noopener noreferrer">https://www.dgl.ai/</a></p>
</li>
<li>
<p>Nebula-DGL: <a href="https://github.com/wey-gu/nebula-dgl" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/nebula-dgl</a></p>
</li>
</ul>
</li>
<li>
<p>ä½ å¯ä»¥ç›´æ¥ load è¿™ä¸ª .ngql æ–‡ä»¶åˆ° NebulaGraphã€‚</p>
<ul>
<li><a href="https://github.com/wey-gu/identity-correlation-datagen/raw/main/sample/hand_crafted/entity_resolution.ngql" target="_blank" rel="noopener noreferrer">https://github.com/wey-gu/identity-correlation-datagen/raw/main/sample/hand_crafted/entity_resolution.ngql</a></li>
</ul>
</li>
</ol>
</blockquote>
<h5 id="æ•°æ®å¤„ç†" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e5%a4%84%e7%90%86" class="header-mark"></a>1.6.1.3 æ•°æ®å¤„ç†</h5><p>ä¸ºäº†å°† NebulaGraph å›¾è°±è¿›è¡Œå·¥ç¨‹å¤„ç†ï¼Œåºåˆ—åŒ–æˆä¸º DGL çš„å›¾å¯¹è±¡ï¼Œæˆ‘ä»¬è¦é€šè¿‡ Nebula-DGL çš„ YAML é…ç½®æ–‡ä»¶ API æè¿°æ‰€éœ€çš„ç‚¹ã€è¾¹ç±»å‹ä»¥åŠå…³å¿ƒçš„å±æ€§ï¼ˆç‰¹å¾ï¼‰ã€‚</p>
<p>æˆ‘ä»¬çœ‹ä¸‹ç°åœ¨çš„å›¾ä¸­æœ‰å“ªäº›ç‚¹ã€è¾¹ç±»å‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="n">entity_resolution</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="n">TAGS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">Name</span><span class="w">           </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;address&#34;</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;device&#34;</span><span class="w">       </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;email&#34;</span><span class="w">        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;email_handle&#34;</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;ip&#34;</span><span class="w">           </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;phone&#34;</span><span class="w">        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;user&#34;</span><span class="w">         </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Got</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="p">(</span><span class="n">time</span><span class="w"> </span><span class="n">spent</span><span class="w"> </span><span class="mi">1335</span><span class="o">/</span><span class="mi">7357</span><span class="w"> </span><span class="n">us</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="n">root</span><span class="o">@</span><span class="n">nebula</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="n">entity_resolution</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="n">EDGES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">Name</span><span class="w">                      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;has_address&#34;</span><span class="w">             </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;has_email&#34;</span><span class="w">               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;has_email_with_handle&#34;</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;has_phone&#34;</span><span class="w">               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;is_similar_to&#34;</span><span class="w">           </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;logged_in_from&#34;</span><span class="w">          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;shared_name&#34;</span><span class="w">             </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;shared_similar_email&#34;</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;shared_similar_location&#34;</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;used_device&#34;</span><span class="w">             </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;with_handle&#34;</span><span class="w">             </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Got</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="p">(</span><span class="n">time</span><span class="w"> </span><span class="n">spent</span><span class="w"> </span><span class="mi">1439</span><span class="o">/</span><span class="mi">30418</span><span class="w"> </span><span class="n">us</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸è€ƒè™‘å±æ€§(ç‰¹å¾)ã€‚</p>
<blockquote>
<p><code>nebulagraph_entity_resolution_dgl_mapper.yaml</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># If vertex id is string-typed, remap_vertex_id must be true.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">remap_vertex_id</span><span class="p">:</span><span class="w"> </span><span class="kc">True</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">space</span><span class="p">:</span><span class="w"> </span><span class="l">entity_resolution</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># str or int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">vertex_id_type</span><span class="p">:</span><span class="w"> </span><span class="l">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">vertex_tags</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">address</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">device</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">email_handle</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ip</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">edge_types</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">has_email_with_handle</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">email_handle</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">is_similar_to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">shared_similar_location</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">has_address</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">address</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">logged_in_from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">ip</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">used_device</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">start_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end_vertex_tag</span><span class="p">:</span><span class="w"> </span><span class="l">device</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬åœ¨å®‰è£…å¥½ Nebula-DGL ä¹‹ååªéœ€è¦è¿™å‡ è¡Œä»£ç å°±å¯ä»¥å°† NebulaGraph ä¸­çš„è¿™å¼ å›¾æ„é€ ä¸º DGL çš„ <code>DGLHeteroGraph</code> å›¾å¯¹è±¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">nebula_dgl</span> <span class="kn">import</span> <span class="n">NebulaLoader</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">nebula_config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;graph_hosts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd1&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;graphd2&#39;</span><span class="p">,</span> <span class="mi">9669</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;nebula_user&#34;</span><span class="p">:</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;nebula_password&#34;</span><span class="p">:</span> <span class="s2">&#34;nebula&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># load feature_mapper from yaml file</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;nebulagraph_entity_resolution_dgl_mapper.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">feature_mapper</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">nebula_loader</span> <span class="o">=</span> <span class="n">NebulaLoader</span><span class="p">(</span><span class="n">nebula_config</span><span class="p">,</span> <span class="n">feature_mapper</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">nebula_loader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="æ¨¡å‹è®­ç»ƒ" class="headerLink">
    <a href="#%e6%a8%a1%e5%9e%8b%e8%ae%ad%e7%bb%83" class="header-mark"></a>1.6.1.4 æ¨¡å‹è®­ç»ƒ</h5><p>å‚è€ƒ <a href="https://github.com/BUPT-GAMMA/OpenHGNN/blob/main/examples/customization/custom_link_prediction_dataset.py" target="_blank" rel="noopener noreferrer">custom_link_prediction_dataset.py</a></p>
<blockquote>
<p><code>HDE_link_predict.py</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span> <span class="k">as</span> <span class="nn">th</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">openhgnn</span> <span class="kn">import</span> <span class="n">Experiment</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">openhgnn.dataset</span> <span class="kn">import</span> <span class="n">AsLinkPredictionDataset</span><span class="p">,</span> <span class="n">generate_random_hg</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dgl</span> <span class="kn">import</span> <span class="n">transforms</span> <span class="k">as</span> <span class="n">T</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dgl</span> <span class="kn">import</span> <span class="n">DGLHeteroGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dgl.data</span> <span class="kn">import</span> <span class="n">DGLDataset</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dgl.dataloading.negative_sampler</span> <span class="kn">import</span> <span class="n">GlobalUniform</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">meta_paths_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;APA&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;has_email_with_handle&#39;</span><span class="p">,</span> <span class="s1">&#39;email_handle&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;is_similar_to&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;shared_similar_location&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;has_address&#39;</span><span class="p">,</span> <span class="s1">&#39;address&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;logged_in_from&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;used_device&#39;</span><span class="p">,</span> <span class="s1">&#39;device&#39;</span><span class="p">)]}</span>
</span></span><span class="line"><span class="cl"><span class="n">target_link</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;is_similar_to&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">target_link_r</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;is_similar_to&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyLPDataset</span><span class="p">(</span><span class="n">DGLDataset</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;entity_resolution&#39;</span><span class="p">,</span> <span class="n">force_reload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">g</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Generate a random heterogeneous graph with labels on target node type.</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_g</span> <span class="o">=</span> <span class="n">transform_hg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Some models require meta paths, you can set meta path dict for this dataset.</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@property</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">meta_paths_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">meta_paths_dict</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">transform_hg</span><span class="p">(</span><span class="n">g</span><span class="p">:</span> <span class="n">DGLHeteroGraph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DGLHeteroGraph</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">transform</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span><span class="n">T</span><span class="o">.</span><span class="n">ToSimple</span><span class="p">(),</span> <span class="n">T</span><span class="o">.</span><span class="n">AddReverse</span><span class="p">()])</span>
</span></span><span class="line"><span class="cl">    <span class="n">hg</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">hg</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">train_with_custom_lp_dataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;HDE&#39;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="s1">&#39;link_prediction&#39;</span><span class="p">,</span> <span class="n">gpu</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">experiment</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">myLPDataset</span> <span class="o">=</span> <span class="n">AsLinkPredictionDataset</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">MyLPDataset</span><span class="p">(</span><span class="n">g</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">target_link</span><span class="o">=</span><span class="n">target_link</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">target_link_r</span><span class="o">=</span><span class="n">target_link_r</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">split_ratio</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">force_reload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">train_with_custom_lp_dataset</span><span class="p">(</span><span class="n">myLPDataset</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>TBDï¼šå°šéœ€æŠŠ g å¤„ç†æˆä¸º MyLPDataset() å¯ä»¥æ¥å—çš„æ•°æ®ã€‚</p>
</blockquote>
<h5 id="ä¿å­˜æ¨¡å‹" class="headerLink">
    <a href="#%e4%bf%9d%e5%ad%98%e6%a8%a1%e5%9e%8b" class="header-mark"></a>1.6.1.5 ä¿å­˜æ¨¡å‹</h5><p>OpenHGNN ä¸­ä¿å­˜è‡ªå®šä¹‰æ•°æ®é›†çš„æ¨¡å‹çš„æ”¯æŒï¼Œæœ‰äº›é—®é¢˜ï¼Œå‚è€ƒ <a href="https://github.com/BUPT-GAMMA/OpenHGNN/issues/112" target="_blank" rel="noopener noreferrer">https://github.com/BUPT-GAMMA/OpenHGNN/issues/112</a></p>
<h5 id="åº”ç”¨è½åœ°" class="headerLink">
    <a href="#%e5%ba%94%e7%94%a8%e8%90%bd%e5%9c%b0" class="header-mark"></a>1.6.1.6 åº”ç”¨è½åœ°</h5><p>å‚è€ƒï¼šhttps://github.com/wey-gu/NebulaGraph-Fraud-Detection-GNN</p>
<blockquote>
<p>Feature image credit by <a href="https://unsplash.com/photos/2fn_pxLMS9g" target="_blank" rel="noopener noreferrer">Cosmin Serbin</a></p>
</blockquote>]]></description>
</item><item>
    <title>nGQL ç®€æ˜æ•™ç¨‹ï¼Œç¬¬ä¸€æœŸ</title>
    <link>https://siwei.io/ngql-tutorial/</link>
    <pubDate>Mon, 15 Aug 2022 00:24:28 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/ngql-tutorial/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/ngql-tutorial/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>æœ¬æ–‡æ—¨åœ¨è®©æ–°æ‰‹å¿«é€Ÿäº†è§£ nGQLï¼ŒæŒæ¡æ–¹å‘ï¼Œä¹‹åå¯ä»¥è„šè¸©åœ¨åœ°ä¸Šå€ŸåŠ©æ–‡æ¡£å†™å‡ºä»»ä½•å¿ƒä¸­çš„ NebulaGraph å›¾æŸ¥è¯¢ã€‚</p>
</blockquote>
<h2 id="è§†é¢‘" class="headerLink">
    <a href="#%e8%a7%86%e9%a2%91" class="header-mark"></a>1 è§†é¢‘</h2><p>æœ¬æ•™ç¨‹çš„è§†é¢‘ç‰ˆåœ¨<a href="https://bilibili.com/video/BV1PT411P7w8" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>ã€‚</p>
<div class="bilibili"><iframe src="//player.bilibili.com/player.html?bvid=BV1PT411P7w8&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe></div>

<h2 id="å¼€å§‹ä¹‹å‰" class="headerLink">
    <a href="#%e5%bc%80%e5%a7%8b%e4%b9%8b%e5%89%8d" class="header-mark"></a>2 å¼€å§‹ä¹‹å‰</h2><p>æœ¬æ–‡å‡è®¾ä½ å·²ç»åœ¨æ–‡æ¡£çœ‹è¿‡<a href="https://docs.nebula-graph.com.cn/3.2.0/2.quick-start/1.quick-start-workflow/" target="_blank" rel="noopener noreferrer">å¿«é€Ÿå…¥é—¨æµç¨‹</a>ï¼Œéƒ¨ç½²ã€è¿æ¥è¿‡ NebulaGraphï¼Œå¹¶ä¸”çœ‹è¿‡äº†<a href="https://docs.nebula-graph.com.cn/3.2.0/2.quick-start/4.nebula-graph-crud/" target="_blank" rel="noopener noreferrer">å¸¸ç”¨å‘½ä»¤</a>ã€‚å¦‚æœæ‚¨è¿˜æ²¡çœ‹è¿‡è¿™ä¸¤ä¸ªæ–‡æ¡£ï¼Œå¼ºçƒˆå»ºè®®å…ˆå¿«é€Ÿè¿‡ä¸€éã€‚</p>
<h3 id="æ•™ç¨‹ç›®æ ‡" class="headerLink">
    <a href="#%e6%95%99%e7%a8%8b%e7%9b%ae%e6%a0%87" class="header-mark"></a>2.1 æ•™ç¨‹ç›®æ ‡</h3><p>æœ¬æ•™ç¨‹ç›®çš„åœ¨äºè®©æ–°æ‰‹å¤§æ¦‚çŸ¥é“äº† NebulaGraph çš„æŸ¥è¯¢è¯­å¥åï¼Œè§£å†³â€œä¸çŸ¥é“ä»€ä¹ˆæ ·çš„æŸ¥è¯¢åº”è¯¥ç”¨ä»€ä¹ˆè¯­å¥â€çš„é—®é¢˜ã€‚</p>
<h3 id="ngql-æ˜¯ä»€ä¹ˆ" class="headerLink">
    <a href="#ngql-%e6%98%af%e4%bb%80%e4%b9%88" class="header-mark"></a>2.2 nGQL æ˜¯ä»€ä¹ˆ</h3><p>æˆ‘ä»¬å…ˆå¼ºè°ƒä¸€ä¸‹æ¦‚å¿µï¼šnGQL æ˜¯ NebulaGraph Graph Query Language çš„ç¼©å†™ï¼Œå®ƒè¡¨ç¤º NebulaGraph çš„æŸ¥è¯¢è¯­è¨€ï¼Œè€Œ nGQL çš„è¯­å¥å¯ä»¥ä¸ä¸¥è°¨åœ°åˆ†ä¸ºè¿™å‡ éƒ¨åˆ†ï¼š</p>
<ul>
<li>NebulaGraph ç‹¬æœ‰ DQL æŸ¥è¯¢è¯­å¥ï¼ˆData Query Languageï¼‰</li>
<li>NebulaGraph OpenCypher DQL</li>
<li>NebulaGraph DML å†™è¯­å¥ï¼ˆData Mutation Languageï¼‰</li>
<li>NebulaGraph DDL Schema è¯­å¥ï¼ˆData Definition Language)</li>
<li>NebulaGraph Admin Queries ç®¡ç†è¯­å¥</li>
</ul>
<p>è¿™é‡Œï¼Œä½œä¸ºç®€æ˜æ•™ç¨‹ä¸€æŠŠæ¢­ï¼Œæˆ‘ä»¬åªå…³æ³¨å‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œåè¾¹çš„å†…å®¹ä¼šåœ¨ Part 2 ä¸­ä»‹ç»ã€‚</p>
<h3 id="ngql-é€ŸæŸ¥è¡¨-cheatsheet" class="headerLink">
    <a href="#ngql-%e9%80%9f%e6%9f%a5%e8%a1%a8-cheatsheet" class="header-mark"></a>2.3 nGQL é€ŸæŸ¥è¡¨ Cheatsheet</h3><blockquote>
<p>å¤§å®¶å¯ä»¥æŠ¥é”™è¿™ä»½å•é¡µé€ŸæŸ¥è¡¨ï¼Œä¸€æ¬¡äº†è§£æ‰€æœ‰ nGQL çš„ç”¨æ³•ã€‚</p>
<p><a href="./ngql-cheatsheet-cn.png" rel="">åŸå§‹æ–‡ä»¶é“¾æ¥</a></p>
</blockquote>
<p><a class="lightgallery" href="/ngql-tutorial/ngql-cheatsheet-cn.webp" title="ngql-cheatsheet" data-thumbnail="/ngql-tutorial/ngql-cheatsheet-cn.webp">
        
    </a></p>
<h2 id="nebulagraph-ç‹¬æœ‰-dql" class="headerLink">
    <a href="#nebulagraph-%e7%8b%ac%e6%9c%89-dql" class="header-mark"></a>3 NebulaGraph ç‹¬æœ‰ DQL</h2><p>NebulaGraph çš„ç‹¬æœ‰è¯»æŸ¥è¯¢è¯­å¥çš„è®¾è®¡éå¸¸ç®€ä»‹ï¼Œå¯¹åˆå­¦è€…éå¸¸å‹å¥½ï¼Œç»“åˆäº†ç®¡é“çš„æ¦‚å¿µï¼Œåšåˆ°äº†åªæ¶‰åŠäº†å‡ ä¸ªå…³é”®è¯å°±å¯ä»¥æè¿°å¤§å¤šæ•°å›¾æŸ¥è¯¢æ¨¡å¼ã€‚</p>
<p>ç”¨ä¸€å¥è¯æè¿°æ¥è¯´ï¼ŒnGQL çš„ç‹¬æœ‰ DQL ä¸€å…±åˆ†æˆå››ç±»è¯­å¥ï¼š</p>
<ul>
<li>å›¾æ‹“å±•ï¼š<code>GO</code></li>
<li>ç´¢å¼•åæŸ¥ï¼š<code>LOOKUP</code></li>
<li>å–å±æ€§ï¼š<code>FETCH PROP</code></li>
<li>è·¯å¾„ä¸å­å›¾ï¼š<code>FIND PATH</code> ä¸ <code>GET SUBGRAPH</code></li>
</ul>
<p>å’Œå‡ ä¸ªç‰¹åˆ«çš„å…ƒç´ </p>
<ul>
<li>
<p>ç®¡é“ï¼š<code>|</code></p>
</li>
<li>
<p>å¼•ç”¨å±æ€§: <code>$</code> å¼€å¤´çš„å‡ ä¸ªç¬¦å·ï¼Œç”¨æ¥æè¿°ä¸€äº›ç‰¹å®šçš„ä¸Šä¸‹æ–‡</p>
</li>
</ul>
<h3 id="å›¾æ‹“å±•-go" class="headerLink">
    <a href="#%e5%9b%be%e6%8b%93%e5%b1%95-go" class="header-mark"></a>3.1 å›¾æ‹“å±• GO</h3><p><code>GO</code> çš„è¯­ä¹‰éå¸¸ç›´è§‚ï¼šä»<strong>ç»™å®šçš„èµ·ç‚¹</strong>ï¼Œå‘å¤–æ‹“å±•ï¼ŒæŒ‰éœ€<strong>è¿”å›ç»ˆç‚¹</strong>ã€èµ·ç‚¹çš„ä¿¡æ¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="err">å›¾æ‹“å±•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">STEPS</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s2">&#34;player102&#34;</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="n">follow</span><span class="w"> </span><span class="n">YIELD</span><span class="w"> </span><span class="n">dst</span><span class="p">(</span><span class="n">edge</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="err">â”€â”€â”€â”¬â”€â”€â”€</span><span class="w">      </span><span class="err">â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€</span><span class="w">      </span><span class="err">â”€â”¬â”€â”€â”€â”€</span><span class="w">       </span><span class="err">â”€â”€â”¬â”€â”€â”€â”€â”€â”€</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">       
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                 
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">è¿”å›æœ€åä¸€è·³è¾¹çš„ç»ˆç‚¹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w">                     
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â””â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">ä»</span><span class="w"> </span><span class="n">follow</span><span class="w"> </span><span class="err">è¿™ä¸ªè¾¹</span><span class="p">[</span><span class="err">å‡ºæ–¹å‘</span><span class="p">]</span><span class="err">æ¢ç´¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w">                                    
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">èµ·ç‚¹æ˜¯</span><span class="w"> </span><span class="s2">&#34;player102&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">â”‚</span><span class="w">                                                 
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">æ¢ç´¢</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="err">æ­¥</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å‚è€ƒ <a href="https://docs.nebula-graph.com.cn/3.2.0/3.ngql-guide/7.general-query-statements/3.go/" target="_blank" rel="noopener noreferrer">GO è¯­å¥æ–‡æ¡£</a>ï¼Œäº†è§£å¦‚ä½•ï¼š</p>
<ul>
<li>æŒ‡å®šåæ–¹å‘æ‹“å±•ã€åŒå‘æ‹“å±•</li>
<li>æŒ‡å®šå¯å˜è·³æ•°æ‹“å±•</li>
<li>åŸºäºæ‰€æœ‰ç±»å‹è¾¹æ‹“å±•</li>
<li>è¿”å›å…¶ä»–ä¿¡æ¯</li>
</ul>
</blockquote>
<h3 id="lookup-åŸºäºç´¢å¼•åæŸ¥-id" class="headerLink">
    <a href="#lookup-%e5%9f%ba%e4%ba%8e%e7%b4%a2%e5%bc%95%e5%8f%8d%e6%9f%a5-id" class="header-mark"></a>3.2 LOOKUP åŸºäºç´¢å¼•åæŸ¥ ID</h3><p>å’Œ <code>GO</code> ä¸ºä»å·²çŸ¥çš„ç‚¹å‡ºå‘ç›¸åï¼Œ<code>LOOKUP</code> æ˜¯ä¸€ä¸ªç±»ä¼¼äº SQL é‡Œ <code>SELECT</code> è¯­ä¹‰çš„å…³é”®å­—ï¼Œå®ƒå®é™…çš„ä½œç”¨ä¹Ÿç±»ä¼¼ä¸å…³ç³»å‹æ•°æ®åº“ä¸­çš„æ‰«è¡¨ã€‚</p>
<p><code>LOOKUP</code> éœ€è¦æ‰‹åŠ¨æ˜ç¡®å»ºç«‹ç›¸åº” TAGã€è¾¹ç±»å‹ä¸Šç´¢å¼•æ‰èƒ½å…è®¸ç›¸åº”çš„æŸ¥è¯¢ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆ-lookup-éœ€è¦ç´¢å¼•" class="headerLink">
    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88-lookup-%e9%9c%80%e8%a6%81%e7%b4%a2%e5%bc%95" class="header-mark"></a>3.2.1 ä¸ºä»€ä¹ˆ <code>LOOKUP</code> éœ€è¦ç´¢å¼•ï¼Ÿ</h4><p>å› ä¸º NebulaGraph ä¸­çš„æ•°æ®é»˜è®¤æ˜¯æŒ‰ç…§é‚»æ¥è¡¨çš„å½¢å¼å­˜å‚¨ï¼Œåœ¨åˆ†å¸ƒå¼è®¾è®¡ä¸­ï¼Œæ‰«æä¸€ä¸ªç±»å‹çš„ç‚¹ã€è¾¹æ˜¯éå¸¸æ˜‚è´µçš„ï¼Œæ‰€ä»¥å®ƒè¢«é»˜è®¤ç¦æ­¢äº†ã€‚è€Œåˆ›å»ºç›¸åº”çš„ç´¢å¼•ç±»ä¼¼äºå¢åŠ äº†ç±»ä¼¼äºè¡¨ç»“æ„æ•°æ®åº“çš„æ’åºæ•°æ®ï¼Œå¯ä»¥ç”¨æ¥åšç±»ä¼¼äº <code>SELECT</code> çš„æŸ¥è¯¢ã€‚</p>
<p>åˆ›å»ºç´¢å¼•çš„ä»£ä»·æ˜¯ä»€ä¹ˆï¼ˆå¢åŠ å†™å…¥è´Ÿæ‹…ï¼‰ï¼Ÿç´¢å¼•ä¼šåŠ é€Ÿè¯»ä¹ˆï¼ˆä¸ä¼šï¼Œå®ƒæ˜¯æä¾›äº† LOOKUP çš„å¯èƒ½æ€§ï¼ŒåŸç”Ÿå›¾çš„æŸ¥è¯¢ä¸éœ€è¦ç´¢å¼•åŠ é€Ÿï¼‰ï¼Ÿç­‰ç­‰æ›´è¯¦ç»†çš„é—®é¢˜è¯·å‚é˜…æˆ‘ä¹‹å‰çš„<a href="https://www.siwei.io/nebula-index-explained/" target="_blank" rel="noopener noreferrer">ç´¢å¼•è¯¦è§£æ–‡ç« </a>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="err">ç´¢å¼•åæŸ¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">LOOKUP</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">player</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&#34;Tony Parker&#34;</span><span class="w"> </span><span class="n">YIELD</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">vertex</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="err">â”€â”€â”¬â”€â”€â”€</span><span class="w">  </span><span class="err">â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w">  </span><span class="err">â”€â”€â”¬â”€â”€â”€â”€â”€â”€</span><span class="w">       
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">             
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">                                 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">è¿”å›æŸ¥åˆ°ç‚¹çš„</span><span class="w"> </span><span class="n">VID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">                                            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">è¿‡æ»¤æ¡ä»¶æ˜¯å±æ€§</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="err">çš„å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="err">â”‚</span><span class="w">                                                        
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">æ ¹æ®ç‚¹çš„ç±»åˆ«</span><span class="o">/</span><span class="n">TAG</span><span class="w"> </span><span class="n">player</span><span class="w"> </span><span class="err">æŸ¥è¯¢</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>è¿›ä¸€æ­¥å‚è€ƒ <a href="https://docs.nebula-graph.com.cn/3.2.0/3.ngql-guide/7.general-query-statements/5.lookup/" target="_blank" rel="noopener noreferrer">LOOKUP è¯­å¥æ–‡æ¡£</a>ï¼Œäº†è§£å¦‚ä½•ï¼š</p>
<ul>
<li>è¿”å›å±æ€§</li>
<li>æ ¹æ®è¾¹çš„ç±»å‹æŸ¥è¯¢è¾¹</li>
<li>äº†è§£ LOOKUP æŸ¥è¯¢çš„å‰æã€<a href="https://docs.nebula-graph.com.cn/3.2.0/3.ngql-guide/14.native-index-statements/" target="_blank" rel="noopener noreferrer">ç´¢å¼•</a>ï¼Œ<a href="https://www.siwei.io/nebula-index-explained/" target="_blank" rel="noopener noreferrer">ç´¢å¼•è¯¦è§£</a></li>
</ul>
</blockquote>
<h3 id="fetch-prop-è·å–å±æ€§" class="headerLink">
    <a href="#fetch-prop-%e8%8e%b7%e5%8f%96%e5%b1%9e%e6%80%a7" class="header-mark"></a>3.3 FETCH PROP è·å–å±æ€§</h3><p>å¦‚å­—é¢æ„æ€ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªç‚¹ã€è¾¹çš„ IDï¼Œæƒ³è¦è·å–å®ƒä¸Šè¾¹çš„å±æ€§ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è¦ç”¨ <code>FETCH PROP</code> è€Œé <code>LOOKUP</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="err">å–å±æ€§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FETCH</span><span class="w"> </span><span class="n">PROP</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">player</span><span class="w"> </span><span class="s2">&#34;player100&#34;</span><span class="w"> </span><span class="n">YIELD</span><span class="w"> </span><span class="n">properties</span><span class="p">(</span><span class="n">vertex</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="err">â”€â”€â”¬â”€â”€â”€</span><span class="w">  </span><span class="err">â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€</span><span class="w">       </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">         
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span><span class="w">                     
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">è¿”å›ç‚¹çš„</span><span class="w"> </span><span class="n">player</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="err">ä¸‹æ‰€æœ‰å±æ€§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span><span class="w">                               
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">ä»</span><span class="w"> </span><span class="s2">&#34;player100&#34;</span><span class="w"> </span><span class="err">è¿™ä¸ªç‚¹è·å–</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="err">â”‚</span><span class="w">                                         
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">è·å–</span><span class="w"> </span><span class="n">player</span><span class="w"> </span><span class="err">è¿™ä¸ª</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="err">ä¸‹çš„å±æ€§</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>è¿›ä¸€æ­¥å‚è€ƒ <a href="https://docs.nebula-graph.com.cn/3.2.0/3.ngql-guide/7.general-query-statements/4.fetch/" target="_blank" rel="noopener noreferrer">FETCH PROP è¯­å¥æ–‡æ¡£</a>ï¼Œäº†è§£å¦‚ä½•ï¼š</p>
<ul>
<li>è¿”å›æŸä¸€ä¸ªå±æ€§</li>
<li>è·å–ç»™å®šè¾¹çš„å±æ€§</li>
</ul>
</blockquote>
<h3 id="è·¯å¾„æŸ¥æ‰¾-find-path" class="headerLink">
    <a href="#%e8%b7%af%e5%be%84%e6%9f%a5%e6%89%be-find-path" class="header-mark"></a>3.4 è·¯å¾„æŸ¥æ‰¾ FIND PATH</h3><p>å¦‚æœæˆ‘ä»¬ä»ç»™å®šçš„èµ·ç‚¹ã€ç»ˆç‚¹ä¸­ï¼Œæ‰¾åˆ°ä¹‹é—´çš„æ‰€æœ‰è·¯å¾„ï¼Œä¸€å®šè¦ç”¨ <code>FIND PATH</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="err">èµ·ç‚¹ç»ˆç‚¹é—´è·¯å¾„</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">FIND</span><span class="w"> </span><span class="n">SHORTEST</span><span class="w"> </span><span class="n">PATH</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s2">&#34;player102&#34;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s2">&#34;team204&#34;</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="err">\</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="err">â”€â”€â”¬â”€â”€â”€â”€â”€</span><span class="w">            </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">â”€â”€â”€â”¬â”€â”€â”€</span><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">YIELD</span><span class="err">â”‚</span><span class="n">path</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w"> </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">               </span><span class="err">â”‚</span><span class="w">       
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="err">â”‚â”€â”€â”€â”€â”¬â”€â”€â”€â”€</span><span class="w">  </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">       
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                                  
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">ç»ç”±æ‰€æœ‰ç±»å‹çš„è¾¹å‡ºå‘æ¢ç´¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w">                                        
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">      </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">ä»ç»™å®šçš„èµ·ç‚¹ã€ç»ˆç‚¹</span><span class="w"> </span><span class="n">VID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                                               
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">è¿”å›è·¯å¾„ä¸º</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="err">åˆ—</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="err">â”‚</span><span class="w">                                                    
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">æŸ¥æ‰¾æœ€çŸ­è·¯å¾„</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>è¿›ä¸€æ­¥å‚è€ƒ <a href="https://docs.nebula-graph.com.cn/3.2.0/3.ngql-guide/16.subgraph-and-path/2.find-path/" target="_blank" rel="noopener noreferrer">FIND PATH è¯­å¥æ–‡æ¡£</a>ï¼Œäº†è§£å¦‚ä½•ï¼š</p>
<ul>
<li>è¿”å›è·¯å¾„ä¸­çš„å±æ€§</li>
<li>è®¾å®šæ‹“å±•æ–¹å‘</li>
</ul>
</blockquote>
<h3 id="å•ç‚¹å­å›¾-get-subgraph" class="headerLink">
    <a href="#%e5%8d%95%e7%82%b9%e5%ad%90%e5%9b%be-get-subgraph" class="header-mark"></a>3.5 å•ç‚¹å­å›¾ GET SUBGRAPH</h3><p>å’Œè·¯å¾„æŸ¥æ‰¾ç±»ä¼¼ï¼Œä½†æ˜¯æˆ‘ä»¬åªç»™å®šä¸€ä¸ªèµ·ç‚¹å’Œæ‹“å±•éƒ¨ç½²ï¼Œç”¨ <code>GET SUBGRAPH</code> å¯ä»¥å¸®æˆ‘ä»¬è·å–åŒæ ·çš„ BFS å‡ºå»çš„å­å›¾</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="err">å•ç‚¹</span><span class="w"> </span><span class="n">BFS</span><span class="w"> </span><span class="err">å­å›¾</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GET</span><span class="w"> </span><span class="n">SUBGRAPH</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">STEPS</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s2">&#34;player101&#34;</span><span class="w"> </span><span class="err">\</span><span class="w">           
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="err">â”€â”€â”€â”¬â”€â”€â”€</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w">             
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">YIELD</span><span class="w"> </span><span class="n">VERTICES</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes</span><span class="p">,</span><span class="w"> </span><span class="n">EDGES</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">relationships</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="err">â”€â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                     
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">ä»</span><span class="w"> </span><span class="s2">&#34;player101&#34;</span><span class="w"> </span><span class="err">å¼€å§‹è§¦å‘</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="err">â”‚</span><span class="w">                                              
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">è·å–</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="err">æ­¥çš„æ¢ç´¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="err">â”‚</span><span class="w">                                              
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">è¿”å›æ‰€æœ‰çš„ç‚¹ã€è¾¹</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>è¿›ä¸€æ­¥å‚è€ƒ <a href="https://docs.nebula-graph.com.cn/3.2.0/3.ngql-guide/16.subgraph-and-path/1.get-subgraph/" target="_blank" rel="noopener noreferrer">GET SUBGRAPH è¯­å¥æ–‡æ¡£</a>ï¼Œäº†è§£å¦‚ä½•ï¼š</p>
<ul>
<li>è¿”å›å¸¦æœ‰å±æ€§çš„ç‚¹ã€è¾¹</li>
<li>è®¾å®šæ‹“å±•æ–¹å‘</li>
</ul>
</blockquote>
<h3 id="åˆ©ç”¨ç®¡é“å’Œå±æ€§å¼•ç”¨ç¬¦" class="headerLink">
    <a href="#%e5%88%a9%e7%94%a8%e7%ae%a1%e9%81%93%e5%92%8c%e5%b1%9e%e6%80%a7%e5%bc%95%e7%94%a8%e7%ac%a6" class="header-mark"></a>3.6 åˆ©ç”¨ç®¡é“å’Œå±æ€§å¼•ç”¨ç¬¦</h3><p>NebulaGraph çš„ç®¡é“è®¾è®¡å’Œ Unix-Shell çš„è®¾è®¡å¾ˆåƒï¼Œå¯ä»¥å°†ç®€å•çš„å‡ ç§è¯­å¥ç»“åˆèµ·æ¥ï¼Œæœ‰å¼ºå¤§çš„è¡¨è¾¾åŠ›ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="err">ä½¿ç”¨é€šé“</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s2">&#34;player100&#34;</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="n">follow</span><span class="w"> </span><span class="n">YIELD</span><span class="w"> </span><span class="n">dst</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">did</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="err">\</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">â”€â”¬â”€</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">GO</span><span class="w"> </span><span class="k">FROM</span><span class="err">â”‚$</span><span class="o">-</span><span class="p">.</span><span class="n">did</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="n">follow</span><span class="w"> </span><span class="n">YIELD</span><span class="w"> </span><span class="n">dst</span><span class="p">(</span><span class="n">edge</span><span class="p">);</span><span class="w">           </span><span class="err">â”‚</span><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="err">â”‚â”€â”€â”€â”€â”¬â”€â”€</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                                      
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">ç®¡é“å°†å·¦è¾¹çš„</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">è¾“å‡ºä½œä¸ºå³è¾¹è¯­å¥è¾“å…¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                                              
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">ä»ç®¡é“å·¦è¾¹çš„</span><span class="w"> </span><span class="n">did</span><span class="w"> </span><span class="err">å±æ€§å¼€å§‹æ¢ç´¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="err">â”‚</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">ç¬¬ä¸€ä¸ªæŸ¥è¯¢è¯­å¥</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>è¿›ä¸€æ­¥å‚è€ƒ <a href="https://docs.nebula-graph.com.cn/3.2.0/3.ngql-guide/5.operators/5.property-reference/" target="_blank" rel="noopener noreferrer">å¼•ç”¨å±æ€§æ–‡æ¡£</a>ã€<a href="https://docs.nebula-graph.com.cn/3.2.0/3.ngql-guide/5.operators/4.pipe/" target="_blank" rel="noopener noreferrer">ç®¡é“æ–‡æ¡£</a>äº†è§£ï¼š</p>
<ul>
<li>æ›´å¤šå±æ€§å¼•ç”¨å®šä¹‰</li>
<li>æ›´å¤šä¾‹å­</li>
<li>ç»“åˆ LOOKUP, GO, FETCH çš„è¯­å¥</li>
</ul>
</blockquote>
<p>é™¤äº†ä»¥ä¸Šçš„é›†ä¸­è¡¨è¾¾ä¹‹å¤–ï¼ŒNebulaGraph ç‹¬æœ‰æŸ¥è¯¢è¯­å¥è¿˜æœ‰èšåˆçš„è¡¨è¾¾å‚è€ƒ <a href="https://docs.nebula-graph.com.cn/3.2.0/3.ngql-guide/8.clauses-and-options/group-by/" target="_blank" rel="noopener noreferrer">GROUP-BY</a>ï¼Œå¦å¤–åœ¨æ–‡æ¡£é‡Œè¿˜æœ‰ä¸€ä¸ª <a href="https://docs.nebula-graph.com.cn/3.2.0/2.quick-start/6.cheatsheet-for-ngql-command/" target="_blank" rel="noopener noreferrer">Cheatsheet</a> ä¾›å¤§å®¶æŸ¥è¯¢ä¸€äº›å¤æ‚ä¸€ç‚¹æŸ¥è¯¢çš„ä¾‹å­ã€‚</p>
<h3 id="nebulagraph-opencypher-dql" class="headerLink">
    <a href="#nebulagraph-opencypher-dql" class="header-mark"></a>3.7 NebulaGraph OpenCypher DQL</h3><p>ä» 2.0 èµ·ï¼ŒOpenCypher çš„ <code>MATCH</code> è¯­å¥ä¹Ÿè¢« NebulaGraph åŸç”Ÿæ”¯æŒäº†ï¼Œè™½ç„¶è¿™é‡Œæ˜¯ä¸€ä¸ªæ–¹è¨€ï¼ˆæœ‰ä¸€äº›ç»†èŠ‚å·®å¼‚ï¼‰ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MATCH &lt;pattern&gt; [&lt;clause_1&gt;] RETURN &lt;output&gt;  [&lt;clause_2&gt;];
</span></span></code></pre></td></tr></table>
</div>
</div><p>MATCH çš„åŸºæœ¬è¡¨è¾¾æ˜¯ä»¥ <code>(v:tag_a)</code> åŒ…è£¹çš„ç‚¹ <code>--&gt;</code> æˆ–è€… <code>&lt;-[:edge_type_1]-</code> è¡¨è¾¾çš„è¾¹ç»„æˆçš„æ¨¡å¼ï¼Œä¸ <code>RETURN</code> è¡¨è¾¾çš„è¾“å‡ºã€‚</p>
<p>å¦‚æœæ‚¨ä» Cypher çš„æŸ¥è¯¢è¯­å¥å…¥é—¨å›¾æ•°æ®åº“ï¼Œå¯ä»¥ä»ä¸‹è¾¹å‡ ä¸ªä¾‹å­äº†è§£åˆ°å‡ ä¸ª NebulaGraph é‡Œçš„ç»†èŠ‚å·®å¼‚ï¼š</p>
<ul>
<li>å¢åŠ äº† <code>WHERE id(v) == &quot;foo&quot;</code> çš„è¡¨è¾¾</li>
<li><code>==</code> è¡¨è¾¾ç›¸ç­‰åˆ¤æ–­è€Œä¸æ˜¯ <code>=</code></li>
<li>ç‚¹çš„å±æ€§è¡¨è¾¾éœ€è¦å¡«å†™ TAGï¼Œä¾‹å¦‚ <code>v3.player.name</code> è€Œä¸æ˜¯ <code>v3.name</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MATCH (v:player{name:&#34;Tim Duncan&#34;})--&gt;(v2)&lt;--(v3) \
</span></span><span class="line"><span class="cl">    RETURN v3.player.name AS Name;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MATCH (v:player) \
</span></span><span class="line"><span class="cl">    WHERE NOT (v)--() \
</span></span><span class="line"><span class="cl">    RETURN v;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MATCH (v:player)--(v2) \
</span></span><span class="line"><span class="cl">    WHERE id(v2) IN [&#34;player101&#34;, &#34;player102&#34;] \
</span></span><span class="line"><span class="cl">    RETURN v;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MATCH (m)-[]-&gt;(n) WHERE id(m)==&#34;player100&#34; \
</span></span><span class="line"><span class="cl">OPTIONAL MATCH (n)-[]-&gt;(l) WHERE id(n)==&#34;player125&#34; \
</span></span><span class="line"><span class="cl">    RETURN id(m), id(n), id(l);
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>è¿›ä¸€æ­¥å‚è€ƒ <a href="https://docs.nebula-graph.com.cn/3.2.0/3.ngql-guide/7.general-query-statements/2.match/" target="_blank" rel="noopener noreferrer">MATCH æ–‡æ¡£</a>äº†è§£ï¼š</p>
</blockquote>
<ul>
<li>æ›´å¤šä¾‹å­</li>
<li>å¯å˜è·³æ•°çš„ MATCH è¡¨è¾¾</li>
<li>å¤š MATCH</li>
<li>OPTIONAL MATCH</li>
</ul>
<blockquote>
<p>é¢˜å›¾ç‰ˆæƒï¼šDALLÂ·E Open-AIï¼Œ<a href="./featured-image-raw.webp" rel="">åŸå›¾</a></p>
<p>Featured image was generated with key words: learning spells of the nebula magic, with DALLÂ·E Open-AI.</p>
</blockquote>]]></description>
</item><item>
    <title>Nebula Graph çš„ Java æ•°æ®è§£æå®è·µä¸æŒ‡å¯¼</title>
    <link>https://siwei.io/nebula-java-happy-parsing-guide/</link>
    <pubDate>Thu, 25 Nov 2021 19:47:53 &#43;0800</pubDate><author>
        <name>Wey Gu</name>
    </author><guid>https://siwei.io/nebula-java-happy-parsing-guide/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/nebula-java-happy-parsing-guide/featured-image.webp" referrerpolicy="no-referrer">
            </div><blockquote>
<p>å¦‚ä½•å¿«é€Ÿã€å³æ—¶ã€ç¬¦åˆç›´è§‰åœ°å»å¤„ç† Nebula Java Client ä¸­çš„æ•°æ®è§£æï¼Ÿè¯»è¿™ä¸€ç¯‡å°±å¤Ÿäº†ã€‚</p>
</blockquote>
<blockquote>
<p>æ›´æ–°: 2022-Aug-10, adapted to nebulagraph 3.x</p>
</blockquote>
<h2 id="å…³é”®æ­¥éª¤å‡ è¡Œå‡†å¤‡ä¸€ä¸ªå¹²å‡€çš„äº¤äº’å¼-nebula-java-repl-ç¯å¢ƒ" class="headerLink">
    <a href="#%e5%85%b3%e9%94%ae%e6%ad%a5%e9%aa%a4%e5%87%a0%e8%a1%8c%e5%87%86%e5%a4%87%e4%b8%80%e4%b8%aa%e5%b9%b2%e5%87%80%e7%9a%84%e4%ba%a4%e4%ba%92%e5%bc%8f-nebula-java-repl-%e7%8e%af%e5%a2%83" class="header-mark"></a>1 å…³é”®æ­¥éª¤ï¼šå‡ è¡Œå‡†å¤‡ä¸€ä¸ªå¹²å‡€çš„äº¤äº’å¼ Nebula Java REPL ç¯å¢ƒ</h2><p>å¤šäºäº† <a href="https://github.com/albertlatacz/java-repl/" target="_blank" rel="noopener noreferrer">Java-REPL</a> æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ï¼ˆåƒ iPython é‚£æ ·ï¼‰å»å®æ—¶äº¤äº’åœ°è°ƒè¯•ã€åˆ†æ Nebula Java å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ç”¨å®ƒçš„ Docker é•œåƒå¯ä»¥å¾ˆå¹²å‡€çš„å»æå®šï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker pull albertlatacz/java-repl
</span></span><span class="line"><span class="cl">docker run --rm -it <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --network<span class="o">=</span>nebula-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v ~:/root <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    albertlatacz/java-repl <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    bash
</span></span><span class="line"><span class="cl">apt update -y <span class="o">&amp;&amp;</span> apt install ca-certificates -y
</span></span><span class="line"><span class="cl">wget https://dlcdn.apache.org/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz --no-check-certificate
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tar xzvf apache-maven-3.8.6-bin.tar.gz
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">wget https://github.com/vesoft-inc/nebula-java/archive/refs/tags/v3.0.0.tar.gz
</span></span><span class="line"><span class="cl">tar xzvf v3.0.0.tar.gz
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> nebula-java-3.0.0/
</span></span><span class="line"><span class="cl">../apache-maven-3.8.6/bin/mvn dependency:copy-dependencies
</span></span><span class="line"><span class="cl">../apache-maven-3.8.6/bin/mvn -B package -Dmaven.test.skip<span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">java -jar ../javarepl/javarepl.jar
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ—¶å€™ï¼Œåœ¨æ‰§è¡Œå®Œ <code>java -jar ../javarepl/javarepl.jar</code> ä¹‹åï¼Œæˆ‘ä»¬å°±è¿›å…¥äº†äº¤äº’å¼çš„ Java Shellï¼ˆREPLï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ— éœ€åšç¼–è¯‘ï¼Œæ‰§è¡Œï¼Œprint è¿™æ ·çš„æ…¢åé¦ˆæ¥è°ƒè¯•å’Œç ”ç©¶æˆ‘ä»¬çš„ä»£ç äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@a2e26ba62bb6</span><span class="o">:/</span><span class="n">javarepl</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">3</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="err">#</span> <span class="n">java</span> <span class="o">-</span><span class="n">jar</span> <span class="o">../</span><span class="n">javarepl</span><span class="o">/</span><span class="n">javarepl</span><span class="o">.</span><span class="na">jar</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Welcome</span> <span class="n">to</span> <span class="n">JavaREPL</span> <span class="n">version</span> <span class="nf">428</span> <span class="o">(</span><span class="n">Java</span> <span class="nf">HotSpot</span><span class="o">(</span><span class="n">TM</span><span class="o">)</span> <span class="n">64</span><span class="o">-</span><span class="n">Bit</span> <span class="n">Server</span> <span class="n">VM</span><span class="o">,</span> <span class="n">Java</span> <span class="n">1</span><span class="o">.</span><span class="na">8</span><span class="o">.</span><span class="na">0_111</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Type</span> <span class="n">expression</span> <span class="n">to</span> <span class="n">evaluate</span><span class="o">,</span> <span class="o">:</span><span class="n">help</span> <span class="k">for</span> <span class="n">more</span> <span class="n">options</span> <span class="n">or</span> <span class="n">press</span> <span class="n">tab</span> <span class="n">to</span> <span class="n">auto</span><span class="o">-</span><span class="n">complete</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Connected</span> <span class="n">to</span> <span class="n">local</span> <span class="n">instance</span> <span class="n">at</span> <span class="n">http</span><span class="o">:</span><span class="c1">//localhost:43707
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Hello, World!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Hello</span><span class="o">,</span> <span class="n">World</span><span class="o">!</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆæˆ‘ä»¬åœ¨ <code>java&gt;</code> æç¤ºç¬¦ä¸‹ï¼Œè¿™äº›æ¥æŠŠå¿…é¡»çš„ç±»è·¯å¾„å’Œå¯¼å…¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">:</span><span class="n">cp</span> <span class="o">/</span><span class="n">javarepl</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">3</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">client</span><span class="o">-</span><span class="n">3</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">jar</span>
</span></span><span class="line"><span class="cl"><span class="o">:</span><span class="n">cp</span> <span class="o">/</span><span class="n">javarepl</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">3</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">dependency</span><span class="o">/</span><span class="n">fastjson</span><span class="o">-</span><span class="n">1</span><span class="o">.</span><span class="na">2</span><span class="o">.</span><span class="na">78</span><span class="o">.</span><span class="na">jar</span>
</span></span><span class="line"><span class="cl"><span class="o">:</span><span class="n">cp</span> <span class="o">/</span><span class="n">javarepl</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">3</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">dependency</span><span class="o">/</span><span class="n">slf4j</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">1</span><span class="o">.</span><span class="na">7</span><span class="o">.</span><span class="na">25</span><span class="o">.</span><span class="na">jar</span>
</span></span><span class="line"><span class="cl"><span class="o">:</span><span class="n">cp</span> <span class="o">/</span><span class="n">javarepl</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">3</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">dependency</span><span class="o">/</span><span class="n">slf4j</span><span class="o">-</span><span class="n">log4j12</span><span class="o">-</span><span class="n">1</span><span class="o">.</span><span class="na">7</span><span class="o">.</span><span class="na">25</span><span class="o">.</span><span class="na">jar</span>
</span></span><span class="line"><span class="cl"><span class="o">:</span><span class="n">cp</span> <span class="o">/</span><span class="n">javarepl</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">3</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">dependency</span><span class="o">/</span><span class="n">commons</span><span class="o">-</span><span class="n">pool2</span><span class="o">-</span><span class="n">2</span><span class="o">.</span><span class="na">2</span><span class="o">.</span><span class="na">jar</span>
</span></span><span class="line"><span class="cl"><span class="o">:</span><span class="n">cp</span> <span class="o">/</span><span class="n">javarepl</span><span class="o">/</span><span class="n">nebula</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">3</span><span class="o">.</span><span class="na">0</span><span class="o">.</span><span class="na">0</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">dependency</span><span class="o">/</span><span class="n">log4j</span><span class="o">-</span><span class="n">1</span><span class="o">.</span><span class="na">2</span><span class="o">.</span><span class="na">17</span><span class="o">.</span><span class="na">jar</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.alibaba.fastjson.JSON</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.alibaba.fastjson.JSONObject</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.ErrorCode</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.NebulaPoolConfig</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.data.CASignedSSLParam</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.data.HostAddress</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.data.ResultSet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.data.SelfSignedSSLParam</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.data.ValueWrapper</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.net.NebulaPool</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.vesoft.nebula.client.graph.net.Session</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.UnsupportedEncodingException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.lang.reflect.*</span><span class="o">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¯ä»¥ä»è¿™ Java ç¯å¢ƒè¿æ¥åˆ° Nebula Graph é‡Œï¼Œä¸‹è¾¹çš„ä¾‹å­é‡Œæˆ‘ç”¨äº†è‡ªå·±çš„ GraphD çš„ IP å’Œç«¯å£ä½œä¸ºä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">NebulaPoolConfig</span> <span class="n">nebulaPoolConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NebulaPoolConfig</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">nebulaPoolConfig</span><span class="o">.</span><span class="na">setMaxConnSize</span><span class="o">(</span><span class="n">10</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">HostAddress</span><span class="o">&gt;</span> <span class="n">addresses</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="n">HostAddress</span><span class="o">(</span><span class="s">&#34;192.168.8.127&#34;</span><span class="o">,</span> <span class="n">9669</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="n">NebulaPool</span> <span class="n">pool</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NebulaPool</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">pool</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">addresses</span><span class="o">,</span> <span class="n">nebulaPoolConfig</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="na">getSession</span><span class="o">(</span><span class="s">&#34;root&#34;</span><span class="o">,</span> <span class="s">&#34;nebula&#34;</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é€šè¿‡è°ƒç”¨-execute-æ–¹æ³•è·å¾—ä¸å¤ªå®¹æ˜“æ‡‚çš„-resultset-å¯¹è±¡" class="headerLink">
    <a href="#%e9%80%9a%e8%bf%87%e8%b0%83%e7%94%a8-execute-%e6%96%b9%e6%b3%95%e8%8e%b7%e5%be%97%e4%b8%8d%e5%a4%aa%e5%ae%b9%e6%98%93%e6%87%82%e7%9a%84-resultset-%e5%af%b9%e8%b1%a1" class="header-mark"></a>2 é€šè¿‡è°ƒç”¨ <code>execute</code> æ–¹æ³•è·å¾—ä¸å¤ªå®¹æ˜“æ‡‚çš„ ResultSet å¯¹è±¡</h2><p>åˆšæ¥è§¦è¿™é‡Œçš„å¤§å®¶ä¸€å®šå¯¹è¿™ä¸ª ResultSet å¯¹è±¡æœ‰äº›æ„ï¼Œå€ŸåŠ©æˆ‘ä»¬çš„ç¯å¢ƒï¼Œå’±ä»¬æ¥ååˆ†é’ŸæŠŠå®ƒæé€šå§ï¼Œè¿™é‡Œæˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªç®€å•çš„è¿”å› Vertex é¡¶ç‚¹çš„ç»“æœçœ‹çœ‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ResultSet</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&#34;USE basketballplayer;MATCH (n:player) WHERE n.name==\&#34;Tim Duncan\&#34; RETURN n&#34;</span><span class="o">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‚è€ƒ ResultSet çš„ä»£ç ï¼š</p>
<blockquote>
<p>Reference: <a href="https://github.dev/vesoft-inc/nebula-java/blob/master/client/src/main/java/com/vesoft/nebula/client/graph/data/ResultSet.java" target="_blank" rel="noopener noreferrer">client/graph/data/ResultSet.java</a></p>
</blockquote>
<p>å¥½å§ï¼Œå…¶å®å¯ä»¥å…ˆä¸çœ‹ï¼Œè·Ÿç€æˆ‘çš„æ•™ç¨‹å¾€ä¸‹èµ°å§ï¼Œæˆ‘ä»¬çŸ¥é“ç»“æœéƒ½æ˜¯äºŒç»´çš„è¡¨ï¼ŒResultSet æä¾›äº†å¸¸è§çš„é’ˆå¯¹è¡Œã€åˆ—çš„ä¸€äº›æ–¹æ³•ï¼Œé€šå¸¸ï¼Œæˆ‘ä»¬æ˜¯è·å–æ¯ä¸€è¡Œï¼Œç„¶åè§£æå®ƒï¼Œè€Œå…³é”®çš„é—®é¢˜æ˜¯æ¯ä¸€ä¸ªå€¼è¦æ€ä¹ˆå¤„ç†ï¼Œå¯¹å§ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">resp</span><span class="o">.</span><span class="na">isSucceeded</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Boolean</span> <span class="n">res9</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">resp</span><span class="o">.</span><span class="na">rowsSize</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span> <span class="n">res16</span> <span class="o">=</span> <span class="n">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="na">getRows</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ArrayList</span> <span class="n">rows</span> <span class="o">=</span> <span class="o">[</span><span class="n">Row</span> <span class="o">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">values</span> <span class="o">:</span> <span class="o">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">Value</span> <span class="n">vVal</span><span class="o">:</span><span class="n">Vertex</span> <span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">vid</span> <span class="o">:</span> <span class="o">&lt;</span><span class="n">Value</span> <span class="n">sVal</span><span class="o">:</span><span class="n">70</span> <span class="n">6c</span> <span class="n">61</span> <span class="n">79</span> <span class="n">65</span> <span class="n">72</span> <span class="n">31</span> <span class="n">30</span> <span class="n">30</span><span class="o">&gt;,</span>
</span></span><span class="line"><span class="cl">        <span class="n">tags</span> <span class="o">:</span> <span class="o">[</span>
</span></span><span class="line"><span class="cl">          <span class="n">Tag</span> <span class="o">(</span>
</span></span><span class="line"><span class="cl">              <span class="n">name</span> <span class="o">:</span> <span class="n">70</span> <span class="n">6C</span> <span class="n">61</span> <span class="n">79</span> <span class="n">65</span> <span class="n">72</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">              <span class="n">props</span> <span class="o">:</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="o">[</span><span class="n">B</span><span class="nd">@5264a468</span> <span class="o">:</span> <span class="o">&lt;</span><span class="n">Value</span> <span class="n">iVal</span><span class="o">:</span><span class="n">42</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="o">[</span><span class="n">B</span><span class="nd">@496b8e10</span> <span class="o">:</span> <span class="o">&lt;</span><span class="n">Value</span> <span class="n">sVal</span><span class="o">:</span><span class="n">54</span> <span class="n">69</span> <span class="n">6d</span> <span class="n">20</span> <span class="n">44</span> <span class="n">75</span> <span class="n">6e</span> <span class="n">63</span> <span class="n">61</span> <span class="n">6e</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">]</span>
</span></span><span class="line"><span class="cl">      <span class="o">)&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">)]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">row0</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="na">rowValues</span><span class="o">(</span><span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Iterable</span><span class="o">&lt;</span><span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ValueWrapper</span><span class="o">&gt;</span> <span class="n">res10</span> <span class="o">=</span> <span class="n">ColumnName</span><span class="o">:</span> <span class="o">[</span><span class="n">n</span><span class="o">],</span> <span class="n">Values</span><span class="o">:</span> <span class="o">[(</span><span class="s">&#34;player100&#34;</span> <span class="o">:</span><span class="n">player</span> <span class="o">{</span><span class="n">name</span><span class="o">:</span> <span class="s">&#34;Tim Duncan&#34;</span><span class="o">,</span> <span class="n">age</span><span class="o">:</span> <span class="n">42</span><span class="o">})]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å…¶å®å›åˆ°è¿™æ¬¡çš„ query ï¼Œå…¶å®æ˜¯è¿”å›ä¸€ä¸ª vertexï¼šé¡¶ç‚¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(root@nebula) [basketballplayer]&gt; match (n:player) WHERE n.name == &#34;Tim Duncan&#34; return n
</span></span><span class="line"><span class="cl">+----------------------------------------------------+
</span></span><span class="line"><span class="cl">| n                                                  |
</span></span><span class="line"><span class="cl">+----------------------------------------------------+
</span></span><span class="line"><span class="cl">| (&#34;player100&#34; :player{age: 42, name: &#34;Tim Duncan&#34;}) |
</span></span><span class="line"><span class="cl">+----------------------------------------------------+
</span></span><span class="line"><span class="cl">Got 1 rows (time spent 2116/44373 us)
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡ä¸Šè¾¹çš„å‡ ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å…¶å®èƒ½å¤Ÿè·å¾—è¿™ä¸ªé¡¶ç‚¹çš„å€¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">v</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;com.vesoft.nebula.Value&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span><span class="o">.</span><span class="na">getDeclaredMethods</span><span class="o">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ª <code>com.vesoft.nebula.Value</code> çš„å€¼çš„ç±»æä¾›çš„æ–¹æ³•ç‰¹åˆ«ç‰¹åˆ«åŸå§‹ï¼Œè¿™ä¹Ÿæ˜¯è®©å¤§å®¶çŠ¯æ„çš„åŸå› ï¼Œåœ¨è¿™ä¸ªæ•™ç¨‹é‡Œæœ€é‡è¦çš„ä¸€ä¸ªå¸¦èµ°çš„ç»éªŒï¼ˆé™¤äº†åˆ©ç”¨ REPLä¹‹å¤–ï¼‰å°±æ˜¯ï¼šé™¤éå¿…è¦ï¼Œä¸è¦å»å–è¿™ä¸ªåŸå§‹çš„ç±»ï¼Œæˆ‘ä»¬åº”è¯¥å»å–å¾— <code>ValueWrapper</code> å°è£…ä¹‹åçš„å€¼ï¼ï¼ï¼</p>
<blockquote>
<p>æ³¨æ„ï¼šå…¶å®æˆ‘ä»¬æœ‰æ›´è½»æ¾åœ°æ–¹æ³•ï¼Œå°±æ˜¯ç”¨ executeJson ç›´æ¥è·å¾— JSON stringï¼Œåˆ«æ‹…å¿ƒï¼Œä¼šåœ¨åè¾¹æåˆ°ï¼Œä¸è¿‡è¿™ä¸ªæ–¹æ³•è¦ 2.6 ä¹‹åæ‰æ”¯æŒã€‚</p>
</blockquote>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•ä½¿ç”¨ <code>ValueWrapper</code> å°è£…å‘¢ï¼Ÿå…¶å®ç­”æ¡ˆå·²ç»åœ¨ä¸Šè¾¹äº†ï¼Œå¤§å®¶å¯ä»¥å›å»çœ‹çœ‹ï¼Œresp.rowValues(0) çš„ç±»å‹æ­£æ˜¯ ValueWrapper çš„å¯è¿­ä»£å¯¹è±¡ï¼</p>
<p>æ‰€ä»¥ï¼Œæ­£ç¡®æ‰“å¼€æ–¹å¼æ˜¯è¿­å®ƒï¼è¿­å®ƒï¼è¿­å®ƒï¼å…¶å®è¿™ä¸ªå°±æ˜¯ä»£ç åº“é‡Œçš„ GraphClientExample çš„ä¸€éƒ¨åˆ†ä¾‹å­äº†ï¼Œæˆ‘ä»¬æŠŠå®ƒè¿­ä»£å–å‡ºæ¥ï¼Œæ”¾åˆ° <code>wrappedValueList</code> é‡Œæ…¢æ…¢æŠŠç©ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">ValueWrapper</span><span class="o">&gt;</span> <span class="n">wrappedValueList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">resp</span><span class="o">.</span><span class="na">rowsSize</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ResultSet</span><span class="o">.</span><span class="na">Record</span> <span class="n">record</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="na">rowValues</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">ValueWrapper</span> <span class="n">value</span> <span class="o">:</span> <span class="n">record</span><span class="o">.</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">wrappedValueList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isLong</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asLong</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isBoolean</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asBoolean</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isDouble</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asDouble</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isString</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isTime</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asTime</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isDate</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asDate</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isDateTime</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asDateTime</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isVertex</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asNode</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isEdge</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asRelationship</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isPath</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asPath</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isList</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asList</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isSet</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asSet</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">isMap</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%15s |&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">asMap</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¾¹è¿™äº›å¾ˆä¸‘çš„ if å°±æ˜¯å…³é”®äº†ï¼Œæˆ‘ä»¬çŸ¥é“ query çš„è¿”å›å€¼å¯èƒ½æ˜¯å¤šç§ç±»å‹çš„ï¼Œä»–ä»¬åˆ†ä¸ºï¼š</p>
<ul>
<li>å›¾è¯­ä¹‰çš„ï¼šç‚¹ã€è¾¹ã€è·¯å¾„</li>
<li>æ•°æ®ç±»å‹ï¼šStringï¼Œæ—¥æœŸï¼Œåˆ—è¡¨ï¼Œé›†åˆ ç­‰ç­‰ç­‰</li>
</ul>
<p>è¿™é‡Œçš„å…³é”®æ˜¯ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ <code>ValueWrapper</code> ä¸ºæˆ‘ä»¬å‡†å¤‡å¥½çš„ <code>asXxx</code> æ–¹æ³•ï¼Œå¦‚æœè¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªé¡¶ç‚¹ï¼Œä¹ˆè¿™ä¸ª Xxx å°±æ˜¯ Nodeï¼ŒåŒç†å¦‚æœæ˜¯è¾¹çš„è¯ï¼Œè¿™ä¸ª Xxx å°±æ˜¯ Relationshipã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ç»™å¤§å®¶çœ‹çœ‹å’±ä»¬è¿™ä¸ªè¿”å›ç‚¹ç»“æœçš„æƒ…å†µä¸‹çš„ <code>asNode()</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">v</span> <span class="o">=</span> <span class="n">wrappedValueList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ValueWrapper</span> <span class="n">v</span> <span class="o">=</span> <span class="o">(</span><span class="s">&#34;player100&#34;</span> <span class="o">:</span><span class="n">player</span> <span class="o">{</span><span class="n">name</span><span class="o">:</span> <span class="s">&#34;Tim Duncan&#34;</span><span class="o">,</span> <span class="n">age</span><span class="o">:</span> <span class="n">42</span><span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">v</span><span class="o">.</span><span class="na">asNode</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span> <span class="n">res16</span> <span class="o">=</span> <span class="o">(</span><span class="s">&#34;player100&#34;</span> <span class="o">:</span><span class="n">player</span> <span class="o">{</span><span class="n">name</span><span class="o">:</span> <span class="s">&#34;Tim Duncan&#34;</span><span class="o">,</span> <span class="n">age</span><span class="o">:</span> <span class="n">42</span><span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">node</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="na">asNode</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span> <span class="n">node</span> <span class="o">=</span> <span class="o">(</span><span class="s">&#34;player100&#34;</span> <span class="o">:</span><span class="n">player</span> <span class="o">{</span><span class="n">name</span><span class="o">:</span> <span class="s">&#34;Tim Duncan&#34;</span><span class="o">,</span> <span class="n">age</span><span class="o">:</span> <span class="n">42</span><span class="o">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå€ŸåŠ©äº Java çš„ reflection ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªäº¤äº’ç¨‹åºé‡Œåšç±»ä¼¼äº Python é‡Œ <code>dir()</code> çš„äº‹æƒ…ï¼Œå®æ—¶åœ°å»è·å–ä¸€ä¸ªç±»æ”¯æŒçš„æ–¹æ³•ï¼Œåƒè¿™æ ·ï¼Œçœå»äº†æŸ¥ä»£ç ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">rClass</span><span class="o">=</span><span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;com.vesoft.nebula.client.graph.data.ResultSet&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span> <span class="n">r</span> <span class="o">=</span> <span class="kd">class</span> <span class="nc">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">rClass</span><span class="o">.</span><span class="na">getDeclaredMethods</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Method</span><span class="o">[]</span> <span class="n">res20</span> <span class="o">=</span> <span class="o">[</span><span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getColumnNames</span><span class="o">(),</span> <span class="kd">public</span> <span class="kt">int</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">rowsSize</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet$Record</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">rowValues</span><span class="o">(</span><span class="kt">int</span><span class="o">),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">colValues</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getErrorMessage</span><span class="o">(),</span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">isSucceeded</span><span class="o">(),</span> <span class="kd">public</span> <span class="kt">int</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getSpaceName</span><span class="o">(),</span> <span class="kd">public</span> <span class="kt">int</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getLatency</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">PlanDescription</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getPlanDesc</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getRows</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">getComment</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ResultSet</span><span class="o">.</span><span class="na">keys</span><span class="o">()]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">nodeClass</span><span class="o">=</span><span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;com.vesoft.nebula.client.graph.data.Node&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span> <span class="n">nodeClass</span> <span class="o">=</span> <span class="kd">class</span> <span class="nc">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">nodeClass</span><span class="o">.</span><span class="na">getDeclaredMethods</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Method</span><span class="o">[]</span> <span class="n">res20</span> <span class="o">=</span> <span class="o">[</span><span class="kd">public</span> <span class="kt">boolean</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">hasTagName</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">),</span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">hasLabel</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">tagNames</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">HashMap</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">properties</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">UnsupportedEncodingException</span><span class="o">,</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">labels</span><span class="o">(),</span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">values</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">),</span> <span class="kd">public</span> <span class="kt">int</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">ValueWrapper</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span> <span class="n">com</span><span class="o">.</span><span class="na">vesoft</span><span class="o">.</span><span class="na">nebula</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">Node</span><span class="o">.</span><span class="na">keys</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">UnsupportedEncodingException</span><span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>çœ‹åˆ°è¿™é‡Œï¼Œå¤§å®¶åº”è¯¥çœ‹åˆ°äº†è¿™ä¸ªå°è£…äº†çš„ ValueWrapper çš„å¥½å¤„äº†å§ï¼Ÿå®ƒæä¾›äº†æ–¹ä¾¿çš„ç¬¦åˆç›´è§‰çš„æ–¹æ³•ï¼Œå¯¹äº Node ç±»å‹æ¥è¯´ï¼Œå®ƒæä¾›äº† <code>tagNames()</code>, <code>properties()</code>, <code>labels()</code> ç­‰ç­‰éå¸¸å¥½ç”¨çš„æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">properties</span><span class="o">(</span><span class="s">&#34;player&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">HashMap</span> <span class="n">res11</span> <span class="o">=</span> <span class="o">{</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;Tim Duncan&#34;</span><span class="o">,</span> <span class="n">age</span><span class="o">=</span><span class="n">42</span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">tagNames</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ArrayList</span> <span class="n">res12</span> <span class="o">=</span> <span class="o">[</span><span class="n">player</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">labels</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ArrayList</span> <span class="n">res13</span> <span class="o">=</span> <span class="o">[</span><span class="n">player</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">values</span><span class="o">(</span><span class="s">&#34;player&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ArrayList</span> <span class="n">res14</span> <span class="o">=</span> <span class="o">[</span><span class="n">42</span><span class="o">,</span> <span class="s">&#34;Tim Duncan&#34;</span><span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬è¿™é‡Œåªå±•ç¤ºäº†é¡¶ç‚¹æ•°æ®ç±»å‹çš„å¤„ç†ã€è§£ææ–¹å¼ï¼ˆ<code>RETURN n</code>ï¼‰ï¼Œåƒå…¶ä»–çš„æ•°æ®ç±»å‹æ¯”å¦‚è¾¹ï¼ˆedgeï¼‰è·¯å¾„ï¼ˆpathï¼‰æˆ–è€…åœ°ç†æ•°æ®ã€æ—¶é—´æ•°æ®ï¼Œç”¨è¿™ç§æ–¹å¼ï¼ˆçœ‹æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Œå†äº¤äº’åœ°å»è¯•è¯•æ–¹æ³•æ€ä¹ˆç”¨ï¼‰ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå¯¹å§ï¼Ÿ</p>
<h2 id="ç›´æ¥è¿”å›-json-çš„-executejson-æ–¹æ³•" class="headerLink">
    <a href="#%e7%9b%b4%e6%8e%a5%e8%bf%94%e5%9b%9e-json-%e7%9a%84-executejson-%e6%96%b9%e6%b3%95" class="header-mark"></a>3 ç›´æ¥è¿”å› JSON çš„ <code>executeJson</code> æ–¹æ³•</h2><p>æœ€åï¼Œå¥½æ¶ˆæ¯æ˜¯ï¼Œä» 2.6 å¼€å§‹ï¼Œnebula å¯ä»¥ç›´æ¥è¿”å› JSON çš„ String äº†ï¼Œæˆ‘ä»¬ä¸Šè¾¹çš„çº ç»“ä¹Ÿéƒ½ä¸æ˜¯å¿…è¦çš„äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">java</span><span class="o">&gt;</span> <span class="n">String</span> <span class="n">resp_json</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">executeJson</span><span class="o">(</span><span class="s">&#34;USE basketballplayer;MATCH (n:player) WHERE n.name==\&#34;Tim Duncan\&#34; RETURN n&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">resp_json</span> <span class="o">=</span> <span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">{
</span></span></span><span class="line"><span class="cl"><span class="s">   &#34;</span><span class="n">errors</span><span class="s">&#34;:[
</span></span></span><span class="line"><span class="cl"><span class="s">      {
</span></span></span><span class="line"><span class="cl"><span class="s">         &#34;</span><span class="n">code</span><span class="s">&#34;:0
</span></span></span><span class="line"><span class="cl"><span class="s">      }
</span></span></span><span class="line"><span class="cl"><span class="s">   ],
</span></span></span><span class="line"><span class="cl"><span class="s">   &#34;</span><span class="n">results</span><span class="s">&#34;:[
</span></span></span><span class="line"><span class="cl"><span class="s">      {
</span></span></span><span class="line"><span class="cl"><span class="s">         &#34;</span><span class="n">spaceName</span><span class="s">&#34;:&#34;</span><span class="n">basketballplayer</span><span class="s">&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">         &#34;</span><span class="n">data</span><span class="s">&#34;:[
</span></span></span><span class="line"><span class="cl"><span class="s">            {
</span></span></span><span class="line"><span class="cl"><span class="s">               &#34;</span><span class="n">meta</span><span class="s">&#34;:[
</span></span></span><span class="line"><span class="cl"><span class="s">                  {
</span></span></span><span class="line"><span class="cl"><span class="s">                     &#34;</span><span class="n">type</span><span class="s">&#34;:&#34;</span><span class="n">vertex</span><span class="s">&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">                     &#34;</span><span class="n">id</span><span class="s">&#34;:&#34;</span><span class="n">player100</span><span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">                  }
</span></span></span><span class="line"><span class="cl"><span class="s">               ],
</span></span></span><span class="line"><span class="cl"><span class="s">               &#34;</span><span class="n">row</span><span class="s">&#34;:[
</span></span></span><span class="line"><span class="cl"><span class="s">                  {
</span></span></span><span class="line"><span class="cl"><span class="s">                     &#34;</span><span class="n">player</span><span class="o">.</span><span class="na">age</span><span class="s">&#34;:42,
</span></span></span><span class="line"><span class="cl"><span class="s">                     &#34;</span><span class="n">player</span><span class="o">.</span><span class="na">name</span><span class="s">&#34;:&#34;</span><span class="n">Tim</span> <span class="n">Duncan</span><span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">                  }
</span></span></span><span class="line"><span class="cl"><span class="s">               ]
</span></span></span><span class="line"><span class="cl"><span class="s">            }
</span></span></span><span class="line"><span class="cl"><span class="s">         ],
</span></span></span><span class="line"><span class="cl"><span class="s">         &#34;</span><span class="n">columns</span><span class="s">&#34;:[
</span></span></span><span class="line"><span class="cl"><span class="s">            &#34;</span><span class="n">n</span><span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">         ],
</span></span></span><span class="line"><span class="cl"><span class="s">         &#34;</span><span class="n">errors</span><span class="s">&#34;:{
</span></span></span><span class="line"><span class="cl"><span class="s">            &#34;</span><span class="n">code</span><span class="s">&#34;:0
</span></span></span><span class="line"><span class="cl"><span class="s">         },
</span></span></span><span class="line"><span class="cl"><span class="s">         &#34;</span><span class="n">latencyInUs</span><span class="s">&#34;:4761
</span></span></span><span class="line"><span class="cl"><span class="s">      }
</span></span></span><span class="line"><span class="cl"><span class="s">   ]
</span></span></span><span class="line"><span class="cl"><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ç›¸ä¿¡å¤§å®¶è‚¯å®šæ¯”æˆ‘æ›´æ“…é•¿å¤„ç† JSON çš„ç»“æœäº†å“ˆ~~</p>
<h2 id="ç»“è®º" class="headerLink">
    <a href="#%e7%bb%93%e8%ae%ba" class="header-mark"></a>4 ç»“è®º</h2><ul>
<li>å¦‚æœæˆ‘ä»¬æœ‰æ¡ä»¶ï¼ˆ2.6ä»¥åï¼‰ç”¨ JSONï¼Œæƒ…å†µä¼šå¾ˆå®¹æ˜“ï¼Œå¯èƒ½å¤§å®¶ä¸å¤ªéœ€è¦æœ¬æ–‡çš„æ–¹æ³•ï¼ˆä¸è¿‡æœ‰äº¤äº’ç¯å¢ƒè¿˜æ˜¯å¾ˆæ–¹ä¾¿å§ï¼Ÿï¼‰</li>
<li>å¦‚æœæˆ‘ä»¬ä¸å¾—ä¸å’Œ resultSet æ‰“äº¤é“ï¼Œè®°å¾—ç”¨ ValueWrapper ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ç”¨ asNode()ï¼ŒasRelationship() å’Œ asPath() ï¼Œå°è£…ä¹‹åçš„å€¼æ¯”åŸå§‹çš„å€¼å¯çˆ±å¤ªå¤šäº†ï¼
<ul>
<li>é€šè¿‡ REPL å·¥å…·ï¼Œç»“åˆ Java çš„ reflection åŠ ä¸Š æºä»£ç æœ¬èº«ï¼Œåˆ†ææ•°æ®çš„å¤„ç†å°†å˜å¾—å¼‚å¸¸é¡ºæ»‘</li>
</ul>
</li>
</ul>
<p>Happy Graphing!</p>
<blockquote>
<p>Picture Creditï¼š<a href="https://unsplash.com/photos/0wIHsm2_1fc" target="_blank" rel="noopener noreferrer">leunesmedia</a></p>
</blockquote>]]></description>
</item></channel>
</rss>
